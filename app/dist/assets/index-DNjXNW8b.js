function _mergeNamespaces(it,_){for(var lt=0;lt<_.length;lt++){const ft=_[lt];if(typeof ft!="string"&&!Array.isArray(ft)){for(const mt in ft)if(mt!=="default"&&!(mt in it)){const pt=Object.getOwnPropertyDescriptor(ft,mt);pt&&Object.defineProperty(it,mt,pt.get?pt:{enumerable:!0,get:()=>ft[mt]})}}}return Object.freeze(Object.defineProperty(it,Symbol.toStringTag,{value:"Module"}))}(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const mt of document.querySelectorAll('link[rel="modulepreload"]'))ft(mt);new MutationObserver(mt=>{for(const pt of mt)if(pt.type==="childList")for(const gt of pt.addedNodes)gt.tagName==="LINK"&&gt.rel==="modulepreload"&&ft(gt)}).observe(document,{childList:!0,subtree:!0});function lt(mt){const pt={};return mt.integrity&&(pt.integrity=mt.integrity),mt.referrerPolicy&&(pt.referrerPolicy=mt.referrerPolicy),mt.crossOrigin==="use-credentials"?pt.credentials="include":mt.crossOrigin==="anonymous"?pt.credentials="omit":pt.credentials="same-origin",pt}function ft(mt){if(mt.ep)return;mt.ep=!0;const pt=lt(mt);fetch(mt.href,pt)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(it){return it&&it.__esModule&&Object.prototype.hasOwnProperty.call(it,"default")?it.default:it}function getAugmentedNamespace(it){if(it.__esModule)return it;var _=it.default;if(typeof _=="function"){var lt=function ft(){return this instanceof ft?Reflect.construct(_,arguments,this.constructor):_.apply(this,arguments)};lt.prototype=_.prototype}else lt={};return Object.defineProperty(lt,"__esModule",{value:!0}),Object.keys(it).forEach(function(ft){var mt=Object.getOwnPropertyDescriptor(it,ft);Object.defineProperty(lt,ft,mt.get?mt:{enumerable:!0,get:function(){return it[ft]}})}),lt}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$3=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(it){return it===null||typeof it!="object"?null:(it=z$1&&it[z$1]||it["@@iterator"],typeof it=="function"?it:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(it,_,lt){this.props=it,this.context=_,this.refs=D$1,this.updater=lt||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(it,_){if(typeof it!="object"&&typeof it!="function"&&it!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,it,_,"setState")};E$1.prototype.forceUpdate=function(it){this.updater.enqueueForceUpdate(this,it,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(it,_,lt){this.props=it,this.context=_,this.refs=D$1,this.updater=lt||B$1}var H$2=G$1.prototype=new F;H$2.constructor=G$1;C$1(H$2,E$1.prototype);H$2.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$2(it,_,lt){var ft,mt={},pt=null,gt=null;if(_!=null)for(ft in _.ref!==void 0&&(gt=_.ref),_.key!==void 0&&(pt=""+_.key),_)J.call(_,ft)&&!L$1.hasOwnProperty(ft)&&(mt[ft]=_[ft]);var bt=arguments.length-2;if(bt===1)mt.children=lt;else if(1<bt){for(var wt=Array(bt),vt=0;vt<bt;vt++)wt[vt]=arguments[vt+2];mt.children=wt}if(it&&it.defaultProps)for(ft in bt=it.defaultProps,bt)mt[ft]===void 0&&(mt[ft]=bt[ft]);return{$$typeof:l$2,type:it,key:pt,ref:gt,props:mt,_owner:K$1.current}}function N$2(it,_){return{$$typeof:l$2,type:it.type,key:_,ref:it.ref,props:it.props,_owner:it._owner}}function O$1(it){return typeof it=="object"&&it!==null&&it.$$typeof===l$2}function escape$1(it){var _={"=":"=0",":":"=2"};return"$"+it.replace(/[=:]/g,function(lt){return _[lt]})}var P$1=/\/+/g;function Q$1(it,_){return typeof it=="object"&&it!==null&&it.key!=null?escape$1(""+it.key):_.toString(36)}function R$1(it,_,lt,ft,mt){var pt=typeof it;(pt==="undefined"||pt==="boolean")&&(it=null);var gt=!1;if(it===null)gt=!0;else switch(pt){case"string":case"number":gt=!0;break;case"object":switch(it.$$typeof){case l$2:case n$2:gt=!0}}if(gt)return gt=it,mt=mt(gt),it=ft===""?"."+Q$1(gt,0):ft,I$1(mt)?(lt="",it!=null&&(lt=it.replace(P$1,"$&/")+"/"),R$1(mt,_,lt,"",function(vt){return vt})):mt!=null&&(O$1(mt)&&(mt=N$2(mt,lt+(!mt.key||gt&&gt.key===mt.key?"":(""+mt.key).replace(P$1,"$&/")+"/")+it)),_.push(mt)),1;if(gt=0,ft=ft===""?".":ft+":",I$1(it))for(var bt=0;bt<it.length;bt++){pt=it[bt];var wt=ft+Q$1(pt,bt);gt+=R$1(pt,_,lt,wt,mt)}else if(wt=A$1(it),typeof wt=="function")for(it=wt.call(it),bt=0;!(pt=it.next()).done;)pt=pt.value,wt=ft+Q$1(pt,bt++),gt+=R$1(pt,_,lt,wt,mt);else if(pt==="object")throw _=String(it),Error("Objects are not valid as a React child (found: "+(_==="[object Object]"?"object with keys {"+Object.keys(it).join(", ")+"}":_)+"). If you meant to render a collection of children, use an array instead.");return gt}function S$2(it,_,lt){if(it==null)return it;var ft=[],mt=0;return R$1(it,ft,"","",function(pt){return _.call(lt,pt,mt++)}),ft}function T$1(it){if(it._status===-1){var _=it._result;_=_(),_.then(function(lt){(it._status===0||it._status===-1)&&(it._status=1,it._result=lt)},function(lt){(it._status===0||it._status===-1)&&(it._status=2,it._result=lt)}),it._status===-1&&(it._status=0,it._result=_)}if(it._status===1)return it._result.default;throw it._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$1(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(it,_,lt){S$2(it,function(){_.apply(this,arguments)},lt)},count:function(it){var _=0;return S$2(it,function(){_++}),_},toArray:function(it){return S$2(it,function(_){return _})||[]},only:function(it){if(!O$1(it))throw Error("React.Children.only expected to receive a single React element child.");return it}};react_production_min.Component=E$1;react_production_min.Fragment=p$3;react_production_min.Profiler=r$3;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$1;react_production_min.cloneElement=function(it,_,lt){if(it==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+it+".");var ft=C$1({},it.props),mt=it.key,pt=it.ref,gt=it._owner;if(_!=null){if(_.ref!==void 0&&(pt=_.ref,gt=K$1.current),_.key!==void 0&&(mt=""+_.key),it.type&&it.type.defaultProps)var bt=it.type.defaultProps;for(wt in _)J.call(_,wt)&&!L$1.hasOwnProperty(wt)&&(ft[wt]=_[wt]===void 0&&bt!==void 0?bt[wt]:_[wt])}var wt=arguments.length-2;if(wt===1)ft.children=lt;else if(1<wt){bt=Array(wt);for(var vt=0;vt<wt;vt++)bt[vt]=arguments[vt+2];ft.children=bt}return{$$typeof:l$2,type:it.type,key:mt,ref:pt,props:ft,_owner:gt}};react_production_min.createContext=function(it){return it={$$typeof:u$1,_currentValue:it,_currentValue2:it,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},it.Provider={$$typeof:t$1,_context:it},it.Consumer=it};react_production_min.createElement=M$2;react_production_min.createFactory=function(it){var _=M$2.bind(null,it);return _.type=it,_};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(it){return{$$typeof:v$2,render:it}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(it){return{$$typeof:y$1,_payload:{_status:-1,_result:it},_init:T$1}};react_production_min.memo=function(it,_){return{$$typeof:x$1,type:it,compare:_===void 0?null:_}};react_production_min.startTransition=function(it){var _=V$1.transition;V$1.transition={};try{it()}finally{V$1.transition=_}};react_production_min.unstable_act=X$1;react_production_min.useCallback=function(it,_){return U$1.current.useCallback(it,_)};react_production_min.useContext=function(it){return U$1.current.useContext(it)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(it){return U$1.current.useDeferredValue(it)};react_production_min.useEffect=function(it,_){return U$1.current.useEffect(it,_)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(it,_,lt){return U$1.current.useImperativeHandle(it,_,lt)};react_production_min.useInsertionEffect=function(it,_){return U$1.current.useInsertionEffect(it,_)};react_production_min.useLayoutEffect=function(it,_){return U$1.current.useLayoutEffect(it,_)};react_production_min.useMemo=function(it,_){return U$1.current.useMemo(it,_)};react_production_min.useReducer=function(it,_,lt){return U$1.current.useReducer(it,_,lt)};react_production_min.useRef=function(it){return U$1.current.useRef(it)};react_production_min.useState=function(it){return U$1.current.useState(it)};react_production_min.useSyncExternalStore=function(it,_,lt){return U$1.current.useSyncExternalStore(it,_,lt)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const index$1=getDefaultExportFromCjs(reactExports),React=_mergeNamespaces({__proto__:null,default:index$1},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q(it,_,lt){var ft,mt={},pt=null,gt=null;lt!==void 0&&(pt=""+lt),_.key!==void 0&&(pt=""+_.key),_.ref!==void 0&&(gt=_.ref);for(ft in _)m$2.call(_,ft)&&!p$2.hasOwnProperty(ft)&&(mt[ft]=_[ft]);if(it&&it.defaultProps)for(ft in _=it.defaultProps,_)mt[ft]===void 0&&(mt[ft]=_[ft]);return{$$typeof:k$1,type:it,key:pt,ref:gt,props:mt,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(it){function _(bs,ba){var Zn=bs.length;bs.push(ba);e:for(;0<Zn;){var Qn=Zn-1>>>1,ip=bs[Qn];if(0<mt(ip,ba))bs[Qn]=ba,bs[Zn]=ip,Zn=Qn;else break e}}function lt(bs){return bs.length===0?null:bs[0]}function ft(bs){if(bs.length===0)return null;var ba=bs[0],Zn=bs.pop();if(Zn!==ba){bs[0]=Zn;e:for(var Qn=0,ip=bs.length,Sm=ip>>>1;Qn<Sm;){var Pm=2*(Qn+1)-1,Cm=bs[Pm],Im=Pm+1,Rm=bs[Im];if(0>mt(Cm,Zn))Im<ip&&0>mt(Rm,Cm)?(bs[Qn]=Rm,bs[Im]=Zn,Qn=Im):(bs[Qn]=Cm,bs[Pm]=Zn,Qn=Pm);else if(Im<ip&&0>mt(Rm,Zn))bs[Qn]=Rm,bs[Im]=Zn,Qn=Im;else break e}}return ba}function mt(bs,ba){var Zn=bs.sortIndex-ba.sortIndex;return Zn!==0?Zn:bs.id-ba.id}if(typeof performance=="object"&&typeof performance.now=="function"){var pt=performance;it.unstable_now=function(){return pt.now()}}else{var gt=Date,bt=gt.now();it.unstable_now=function(){return gt.now()-bt}}var wt=[],vt=[],Ct=1,Rt=null,Mt=3,Ot=!1,Nt=!1,Ht=!1,Kt=typeof setTimeout=="function"?setTimeout:null,hr=typeof clearTimeout=="function"?clearTimeout:null,Qt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function mr(bs){for(var ba=lt(vt);ba!==null;){if(ba.callback===null)ft(vt);else if(ba.startTime<=bs)ft(vt),ba.sortIndex=ba.expirationTime,_(wt,ba);else break;ba=lt(vt)}}function br(bs){if(Ht=!1,mr(bs),!Nt)if(lt(wt)!==null)Nt=!0,$a(Fr);else{var ba=lt(vt);ba!==null&&ro(br,ba.startTime-bs)}}function Fr(bs,ba){Nt=!1,Ht&&(Ht=!1,hr(Nr),Nr=-1),Ot=!0;var Zn=Mt;try{for(mr(ba),Rt=lt(wt);Rt!==null&&(!(Rt.expirationTime>ba)||bs&&!ga());){var Qn=Rt.callback;if(typeof Qn=="function"){Rt.callback=null,Mt=Rt.priorityLevel;var ip=Qn(Rt.expirationTime<=ba);ba=it.unstable_now(),typeof ip=="function"?Rt.callback=ip:Rt===lt(wt)&&ft(wt),mr(ba)}else ft(wt);Rt=lt(wt)}if(Rt!==null)var Sm=!0;else{var Pm=lt(vt);Pm!==null&&ro(br,Pm.startTime-ba),Sm=!1}return Sm}finally{Rt=null,Mt=Zn,Ot=!1}}var kr=!1,Br=null,Nr=-1,jn=5,Yn=-1;function ga(){return!(it.unstable_now()-Yn<jn)}function Kn(){if(Br!==null){var bs=it.unstable_now();Yn=bs;var ba=!0;try{ba=Br(!0,bs)}finally{ba?Xn():(kr=!1,Br=null)}}else kr=!1}var Xn;if(typeof Qt=="function")Xn=function(){Qt(Kn)};else if(typeof MessageChannel<"u"){var eo=new MessageChannel,lp=eo.port2;eo.port1.onmessage=Kn,Xn=function(){lp.postMessage(null)}}else Xn=function(){Kt(Kn,0)};function $a(bs){Br=bs,kr||(kr=!0,Xn())}function ro(bs,ba){Nr=Kt(function(){bs(it.unstable_now())},ba)}it.unstable_IdlePriority=5,it.unstable_ImmediatePriority=1,it.unstable_LowPriority=4,it.unstable_NormalPriority=3,it.unstable_Profiling=null,it.unstable_UserBlockingPriority=2,it.unstable_cancelCallback=function(bs){bs.callback=null},it.unstable_continueExecution=function(){Nt||Ot||(Nt=!0,$a(Fr))},it.unstable_forceFrameRate=function(bs){0>bs||125<bs?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):jn=0<bs?Math.floor(1e3/bs):5},it.unstable_getCurrentPriorityLevel=function(){return Mt},it.unstable_getFirstCallbackNode=function(){return lt(wt)},it.unstable_next=function(bs){switch(Mt){case 1:case 2:case 3:var ba=3;break;default:ba=Mt}var Zn=Mt;Mt=ba;try{return bs()}finally{Mt=Zn}},it.unstable_pauseExecution=function(){},it.unstable_requestPaint=function(){},it.unstable_runWithPriority=function(bs,ba){switch(bs){case 1:case 2:case 3:case 4:case 5:break;default:bs=3}var Zn=Mt;Mt=bs;try{return ba()}finally{Mt=Zn}},it.unstable_scheduleCallback=function(bs,ba,Zn){var Qn=it.unstable_now();switch(typeof Zn=="object"&&Zn!==null?(Zn=Zn.delay,Zn=typeof Zn=="number"&&0<Zn?Qn+Zn:Qn):Zn=Qn,bs){case 1:var ip=-1;break;case 2:ip=250;break;case 5:ip=1073741823;break;case 4:ip=1e4;break;default:ip=5e3}return ip=Zn+ip,bs={id:Ct++,callback:ba,priorityLevel:bs,startTime:Zn,expirationTime:ip,sortIndex:-1},Zn>Qn?(bs.sortIndex=Zn,_(vt,bs),lt(wt)===null&&bs===lt(vt)&&(Ht?(hr(Nr),Nr=-1):Ht=!0,ro(br,Zn-Qn))):(bs.sortIndex=ip,_(wt,bs),Nt||Ot||(Nt=!0,$a(Fr))),bs},it.unstable_shouldYield=ga,it.unstable_wrapCallback=function(bs){var ba=Mt;return function(){var Zn=Mt;Mt=ba;try{return bs.apply(this,arguments)}finally{Mt=Zn}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(it){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+it,lt=1;lt<arguments.length;lt++)_+="&args[]="+encodeURIComponent(arguments[lt]);return"Minified React error #"+it+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(it,_){ha(it,_),ha(it+"Capture",_)}function ha(it,_){for(ea[it]=_,it=0;it<_.length;it++)da.add(_[it])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(it){return ja.call(ma,it)?!0:ja.call(la,it)?!1:ka.test(it)?ma[it]=!0:(la[it]=!0,!1)}function pa(it,_,lt,ft){if(lt!==null&&lt.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return ft?!1:lt!==null?!lt.acceptsBooleans:(it=it.toLowerCase().slice(0,5),it!=="data-"&&it!=="aria-");default:return!1}}function qa(it,_,lt,ft){if(_===null||typeof _>"u"||pa(it,_,lt,ft))return!0;if(ft)return!1;if(lt!==null)switch(lt.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function v$1(it,_,lt,ft,mt,pt,gt){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=ft,this.attributeNamespace=mt,this.mustUseProperty=lt,this.propertyName=it,this.type=_,this.sanitizeURL=pt,this.removeEmptyString=gt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(it){z[it]=new v$1(it,0,!1,it,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(it){var _=it[0];z[_]=new v$1(_,1,!1,it[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(it){z[it]=new v$1(it,2,!1,it.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(it){z[it]=new v$1(it,2,!1,it,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(it){z[it]=new v$1(it,3,!1,it.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(it){z[it]=new v$1(it,3,!0,it,null,!1,!1)});["capture","download"].forEach(function(it){z[it]=new v$1(it,4,!1,it,null,!1,!1)});["cols","rows","size","span"].forEach(function(it){z[it]=new v$1(it,6,!1,it,null,!1,!1)});["rowSpan","start"].forEach(function(it){z[it]=new v$1(it,5,!1,it.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(it){return it[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(it){var _=it.replace(ra,sa);z[_]=new v$1(_,1,!1,it,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(it){var _=it.replace(ra,sa);z[_]=new v$1(_,1,!1,it,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(it){var _=it.replace(ra,sa);z[_]=new v$1(_,1,!1,it,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(it){z[it]=new v$1(it,1,!1,it.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(it){z[it]=new v$1(it,1,!1,it.toLowerCase(),null,!0,!0)});function ta(it,_,lt,ft){var mt=z.hasOwnProperty(_)?z[_]:null;(mt!==null?mt.type!==0:ft||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(qa(_,lt,mt,ft)&&(lt=null),ft||mt===null?oa(_)&&(lt===null?it.removeAttribute(_):it.setAttribute(_,""+lt)):mt.mustUseProperty?it[mt.propertyName]=lt===null?mt.type===3?!1:"":lt:(_=mt.attributeName,ft=mt.attributeNamespace,lt===null?it.removeAttribute(_):(mt=mt.type,lt=mt===3||mt===4&&lt===!0?"":""+lt,ft?it.setAttributeNS(ft,_,lt):it.setAttribute(_,lt))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(it){return it===null||typeof it!="object"?null:(it=Ja&&it[Ja]||it["@@iterator"],typeof it=="function"?it:null)}var A=Object.assign,La;function Ma(it){if(La===void 0)try{throw Error()}catch(lt){var _=lt.stack.trim().match(/\n( *(at )?)/);La=_&&_[1]||""}return`
`+La+it}var Na=!1;function Oa(it,_){if(!it||Na)return"";Na=!0;var lt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(vt){var ft=vt}Reflect.construct(it,[],_)}else{try{_.call()}catch(vt){ft=vt}it.call(_.prototype)}else{try{throw Error()}catch(vt){ft=vt}it()}}catch(vt){if(vt&&ft&&typeof vt.stack=="string"){for(var mt=vt.stack.split(`
`),pt=ft.stack.split(`
`),gt=mt.length-1,bt=pt.length-1;1<=gt&&0<=bt&&mt[gt]!==pt[bt];)bt--;for(;1<=gt&&0<=bt;gt--,bt--)if(mt[gt]!==pt[bt]){if(gt!==1||bt!==1)do if(gt--,bt--,0>bt||mt[gt]!==pt[bt]){var wt=`
`+mt[gt].replace(" at new "," at ");return it.displayName&&wt.includes("<anonymous>")&&(wt=wt.replace("<anonymous>",it.displayName)),wt}while(1<=gt&&0<=bt);break}}}finally{Na=!1,Error.prepareStackTrace=lt}return(it=it?it.displayName||it.name:"")?Ma(it):""}function Pa(it){switch(it.tag){case 5:return Ma(it.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return it=Oa(it.type,!1),it;case 11:return it=Oa(it.type.render,!1),it;case 1:return it=Oa(it.type,!0),it;default:return""}}function Qa(it){if(it==null)return null;if(typeof it=="function")return it.displayName||it.name||null;if(typeof it=="string")return it;switch(it){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof it=="object")switch(it.$$typeof){case Ca:return(it.displayName||"Context")+".Consumer";case Ba:return(it._context.displayName||"Context")+".Provider";case Da:var _=it.render;return it=it.displayName,it||(it=_.displayName||_.name||"",it=it!==""?"ForwardRef("+it+")":"ForwardRef"),it;case Ga:return _=it.displayName||null,_!==null?_:Qa(it.type)||"Memo";case Ha:_=it._payload,it=it._init;try{return Qa(it(_))}catch{}}return null}function Ra(it){var _=it.type;switch(it.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return it=_.render,it=it.displayName||it.name||"",_.displayName||(it!==""?"ForwardRef("+it+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(_);case 8:return _===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function Sa(it){switch(typeof it){case"boolean":case"number":case"string":case"undefined":return it;case"object":return it;default:return""}}function Ta(it){var _=it.type;return(it=it.nodeName)&&it.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Ua(it){var _=Ta(it)?"checked":"value",lt=Object.getOwnPropertyDescriptor(it.constructor.prototype,_),ft=""+it[_];if(!it.hasOwnProperty(_)&&typeof lt<"u"&&typeof lt.get=="function"&&typeof lt.set=="function"){var mt=lt.get,pt=lt.set;return Object.defineProperty(it,_,{configurable:!0,get:function(){return mt.call(this)},set:function(gt){ft=""+gt,pt.call(this,gt)}}),Object.defineProperty(it,_,{enumerable:lt.enumerable}),{getValue:function(){return ft},setValue:function(gt){ft=""+gt},stopTracking:function(){it._valueTracker=null,delete it[_]}}}}function Va(it){it._valueTracker||(it._valueTracker=Ua(it))}function Wa(it){if(!it)return!1;var _=it._valueTracker;if(!_)return!0;var lt=_.getValue(),ft="";return it&&(ft=Ta(it)?it.checked?"true":"false":it.value),it=ft,it!==lt?(_.setValue(it),!0):!1}function Xa(it){if(it=it||(typeof document<"u"?document:void 0),typeof it>"u")return null;try{return it.activeElement||it.body}catch{return it.body}}function Ya(it,_){var lt=_.checked;return A({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:lt??it._wrapperState.initialChecked})}function Za(it,_){var lt=_.defaultValue==null?"":_.defaultValue,ft=_.checked!=null?_.checked:_.defaultChecked;lt=Sa(_.value!=null?_.value:lt),it._wrapperState={initialChecked:ft,initialValue:lt,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function ab(it,_){_=_.checked,_!=null&&ta(it,"checked",_,!1)}function bb(it,_){ab(it,_);var lt=Sa(_.value),ft=_.type;if(lt!=null)ft==="number"?(lt===0&&it.value===""||it.value!=lt)&&(it.value=""+lt):it.value!==""+lt&&(it.value=""+lt);else if(ft==="submit"||ft==="reset"){it.removeAttribute("value");return}_.hasOwnProperty("value")?cb(it,_.type,lt):_.hasOwnProperty("defaultValue")&&cb(it,_.type,Sa(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(it.defaultChecked=!!_.defaultChecked)}function db(it,_,lt){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var ft=_.type;if(!(ft!=="submit"&&ft!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+it._wrapperState.initialValue,lt||_===it.value||(it.value=_),it.defaultValue=_}lt=it.name,lt!==""&&(it.name=""),it.defaultChecked=!!it._wrapperState.initialChecked,lt!==""&&(it.name=lt)}function cb(it,_,lt){(_!=="number"||Xa(it.ownerDocument)!==it)&&(lt==null?it.defaultValue=""+it._wrapperState.initialValue:it.defaultValue!==""+lt&&(it.defaultValue=""+lt))}var eb=Array.isArray;function fb(it,_,lt,ft){if(it=it.options,_){_={};for(var mt=0;mt<lt.length;mt++)_["$"+lt[mt]]=!0;for(lt=0;lt<it.length;lt++)mt=_.hasOwnProperty("$"+it[lt].value),it[lt].selected!==mt&&(it[lt].selected=mt),mt&&ft&&(it[lt].defaultSelected=!0)}else{for(lt=""+Sa(lt),_=null,mt=0;mt<it.length;mt++){if(it[mt].value===lt){it[mt].selected=!0,ft&&(it[mt].defaultSelected=!0);return}_!==null||it[mt].disabled||(_=it[mt])}_!==null&&(_.selected=!0)}}function gb(it,_){if(_.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A({},_,{value:void 0,defaultValue:void 0,children:""+it._wrapperState.initialValue})}function hb(it,_){var lt=_.value;if(lt==null){if(lt=_.children,_=_.defaultValue,lt!=null){if(_!=null)throw Error(p$1(92));if(eb(lt)){if(1<lt.length)throw Error(p$1(93));lt=lt[0]}_=lt}_==null&&(_=""),lt=_}it._wrapperState={initialValue:Sa(lt)}}function ib(it,_){var lt=Sa(_.value),ft=Sa(_.defaultValue);lt!=null&&(lt=""+lt,lt!==it.value&&(it.value=lt),_.defaultValue==null&&it.defaultValue!==lt&&(it.defaultValue=lt)),ft!=null&&(it.defaultValue=""+ft)}function jb(it){var _=it.textContent;_===it._wrapperState.initialValue&&_!==""&&_!==null&&(it.value=_)}function kb(it){switch(it){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(it,_){return it==null||it==="http://www.w3.org/1999/xhtml"?kb(_):it==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":it}var mb,nb=function(it){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,lt,ft,mt){MSApp.execUnsafeLocalFunction(function(){return it(_,lt,ft,mt)})}:it}(function(it,_){if(it.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in it)it.innerHTML=_;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=mb.firstChild;it.firstChild;)it.removeChild(it.firstChild);for(;_.firstChild;)it.appendChild(_.firstChild)}});function ob(it,_){if(_){var lt=it.firstChild;if(lt&&lt===it.lastChild&&lt.nodeType===3){lt.nodeValue=_;return}}it.textContent=_}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(it){qb.forEach(function(_){_=_+it.charAt(0).toUpperCase()+it.substring(1),pb[_]=pb[it]})});function rb(it,_,lt){return _==null||typeof _=="boolean"||_===""?"":lt||typeof _!="number"||_===0||pb.hasOwnProperty(it)&&pb[it]?(""+_).trim():_+"px"}function sb(it,_){it=it.style;for(var lt in _)if(_.hasOwnProperty(lt)){var ft=lt.indexOf("--")===0,mt=rb(lt,_[lt],ft);lt==="float"&&(lt="cssFloat"),ft?it.setProperty(lt,mt):it[lt]=mt}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(it,_){if(_){if(tb[it]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(p$1(137,it));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(p$1(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(p$1(61))}if(_.style!=null&&typeof _.style!="object")throw Error(p$1(62))}}function vb(it,_){if(it.indexOf("-")===-1)return typeof _.is=="string";switch(it){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(it){return it=it.target||it.srcElement||window,it.correspondingUseElement&&(it=it.correspondingUseElement),it.nodeType===3?it.parentNode:it}var yb=null,zb=null,Ab=null;function Bb(it){if(it=Cb(it)){if(typeof yb!="function")throw Error(p$1(280));var _=it.stateNode;_&&(_=Db(_),yb(it.stateNode,it.type,_))}}function Eb(it){zb?Ab?Ab.push(it):Ab=[it]:zb=it}function Fb(){if(zb){var it=zb,_=Ab;if(Ab=zb=null,Bb(it),_)for(it=0;it<_.length;it++)Bb(_[it])}}function Gb(it,_){return it(_)}function Hb(){}var Ib=!1;function Jb(it,_,lt){if(Ib)return it(_,lt);Ib=!0;try{return Gb(it,_,lt)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(it,_){var lt=it.stateNode;if(lt===null)return null;var ft=Db(lt);if(ft===null)return null;lt=ft[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(ft=!ft.disabled)||(it=it.type,ft=!(it==="button"||it==="input"||it==="select"||it==="textarea")),it=!ft;break e;default:it=!1}if(it)return null;if(lt&&typeof lt!="function")throw Error(p$1(231,_,typeof lt));return lt}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(it,_,lt,ft,mt,pt,gt,bt,wt){var vt=Array.prototype.slice.call(arguments,3);try{_.apply(lt,vt)}catch(Ct){this.onError(Ct)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(it){Ob=!0,Pb=it}};function Tb(it,_,lt,ft,mt,pt,gt,bt,wt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(it,_,lt,ft,mt,pt,gt,bt,wt){if(Tb.apply(this,arguments),Ob){if(Ob){var vt=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=vt)}}function Vb(it){var _=it,lt=it;if(it.alternate)for(;_.return;)_=_.return;else{it=_;do _=it,_.flags&4098&&(lt=_.return),it=_.return;while(it)}return _.tag===3?lt:null}function Wb(it){if(it.tag===13){var _=it.memoizedState;if(_===null&&(it=it.alternate,it!==null&&(_=it.memoizedState)),_!==null)return _.dehydrated}return null}function Xb(it){if(Vb(it)!==it)throw Error(p$1(188))}function Yb(it){var _=it.alternate;if(!_){if(_=Vb(it),_===null)throw Error(p$1(188));return _!==it?null:it}for(var lt=it,ft=_;;){var mt=lt.return;if(mt===null)break;var pt=mt.alternate;if(pt===null){if(ft=mt.return,ft!==null){lt=ft;continue}break}if(mt.child===pt.child){for(pt=mt.child;pt;){if(pt===lt)return Xb(mt),it;if(pt===ft)return Xb(mt),_;pt=pt.sibling}throw Error(p$1(188))}if(lt.return!==ft.return)lt=mt,ft=pt;else{for(var gt=!1,bt=mt.child;bt;){if(bt===lt){gt=!0,lt=mt,ft=pt;break}if(bt===ft){gt=!0,ft=mt,lt=pt;break}bt=bt.sibling}if(!gt){for(bt=pt.child;bt;){if(bt===lt){gt=!0,lt=pt,ft=mt;break}if(bt===ft){gt=!0,ft=pt,lt=mt;break}bt=bt.sibling}if(!gt)throw Error(p$1(189))}}if(lt.alternate!==ft)throw Error(p$1(190))}if(lt.tag!==3)throw Error(p$1(188));return lt.stateNode.current===lt?it:_}function Zb(it){return it=Yb(it),it!==null?$b(it):null}function $b(it){if(it.tag===5||it.tag===6)return it;for(it=it.child;it!==null;){var _=$b(it);if(_!==null)return _;it=it.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(it){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,it,void 0,(it.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(it){return it>>>=0,it===0?32:31-(pc(it)/qc|0)|0}var rc=64,sc=4194304;function tc(it){switch(it&-it){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return it&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return it&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return it}}function uc(it,_){var lt=it.pendingLanes;if(lt===0)return 0;var ft=0,mt=it.suspendedLanes,pt=it.pingedLanes,gt=lt&268435455;if(gt!==0){var bt=gt&~mt;bt!==0?ft=tc(bt):(pt&=gt,pt!==0&&(ft=tc(pt)))}else gt=lt&~mt,gt!==0?ft=tc(gt):pt!==0&&(ft=tc(pt));if(ft===0)return 0;if(_!==0&&_!==ft&&!(_&mt)&&(mt=ft&-ft,pt=_&-_,mt>=pt||mt===16&&(pt&4194240)!==0))return _;if(ft&4&&(ft|=lt&16),_=it.entangledLanes,_!==0)for(it=it.entanglements,_&=ft;0<_;)lt=31-oc(_),mt=1<<lt,ft|=it[lt],_&=~mt;return ft}function vc(it,_){switch(it){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(it,_){for(var lt=it.suspendedLanes,ft=it.pingedLanes,mt=it.expirationTimes,pt=it.pendingLanes;0<pt;){var gt=31-oc(pt),bt=1<<gt,wt=mt[gt];wt===-1?(!(bt&lt)||bt&ft)&&(mt[gt]=vc(bt,_)):wt<=_&&(it.expiredLanes|=bt),pt&=~bt}}function xc(it){return it=it.pendingLanes&-1073741825,it!==0?it:it&1073741824?1073741824:0}function yc(){var it=rc;return rc<<=1,!(rc&4194240)&&(rc=64),it}function zc(it){for(var _=[],lt=0;31>lt;lt++)_.push(it);return _}function Ac(it,_,lt){it.pendingLanes|=_,_!==536870912&&(it.suspendedLanes=0,it.pingedLanes=0),it=it.eventTimes,_=31-oc(_),it[_]=lt}function Bc(it,_){var lt=it.pendingLanes&~_;it.pendingLanes=_,it.suspendedLanes=0,it.pingedLanes=0,it.expiredLanes&=_,it.mutableReadLanes&=_,it.entangledLanes&=_,_=it.entanglements;var ft=it.eventTimes;for(it=it.expirationTimes;0<lt;){var mt=31-oc(lt),pt=1<<mt;_[mt]=0,ft[mt]=-1,it[mt]=-1,lt&=~pt}}function Cc(it,_){var lt=it.entangledLanes|=_;for(it=it.entanglements;lt;){var ft=31-oc(lt),mt=1<<ft;mt&_|it[ft]&_&&(it[ft]|=_),lt&=~mt}}var C=0;function Dc(it){return it&=-it,1<it?4<it?it&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(it,_){switch(it){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(_.pointerId)}}function Tc(it,_,lt,ft,mt,pt){return it===null||it.nativeEvent!==pt?(it={blockedOn:_,domEventName:lt,eventSystemFlags:ft,nativeEvent:pt,targetContainers:[mt]},_!==null&&(_=Cb(_),_!==null&&Fc(_)),it):(it.eventSystemFlags|=ft,_=it.targetContainers,mt!==null&&_.indexOf(mt)===-1&&_.push(mt),it)}function Uc(it,_,lt,ft,mt){switch(_){case"focusin":return Lc=Tc(Lc,it,_,lt,ft,mt),!0;case"dragenter":return Mc=Tc(Mc,it,_,lt,ft,mt),!0;case"mouseover":return Nc=Tc(Nc,it,_,lt,ft,mt),!0;case"pointerover":var pt=mt.pointerId;return Oc.set(pt,Tc(Oc.get(pt)||null,it,_,lt,ft,mt)),!0;case"gotpointercapture":return pt=mt.pointerId,Pc.set(pt,Tc(Pc.get(pt)||null,it,_,lt,ft,mt)),!0}return!1}function Vc(it){var _=Wc(it.target);if(_!==null){var lt=Vb(_);if(lt!==null){if(_=lt.tag,_===13){if(_=Wb(lt),_!==null){it.blockedOn=_,Ic(it.priority,function(){Gc(lt)});return}}else if(_===3&&lt.stateNode.current.memoizedState.isDehydrated){it.blockedOn=lt.tag===3?lt.stateNode.containerInfo:null;return}}}it.blockedOn=null}function Xc(it){if(it.blockedOn!==null)return!1;for(var _=it.targetContainers;0<_.length;){var lt=Yc(it.domEventName,it.eventSystemFlags,_[0],it.nativeEvent);if(lt===null){lt=it.nativeEvent;var ft=new lt.constructor(lt.type,lt);wb=ft,lt.target.dispatchEvent(ft),wb=null}else return _=Cb(lt),_!==null&&Fc(_),it.blockedOn=lt,!1;_.shift()}return!0}function Zc(it,_,lt){Xc(it)&&lt.delete(_)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(it,_){it.blockedOn===_&&(it.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(it){function _(mt){return ad(mt,it)}if(0<Kc.length){ad(Kc[0],it);for(var lt=1;lt<Kc.length;lt++){var ft=Kc[lt];ft.blockedOn===it&&(ft.blockedOn=null)}}for(Lc!==null&&ad(Lc,it),Mc!==null&&ad(Mc,it),Nc!==null&&ad(Nc,it),Oc.forEach(_),Pc.forEach(_),lt=0;lt<Qc.length;lt++)ft=Qc[lt],ft.blockedOn===it&&(ft.blockedOn=null);for(;0<Qc.length&&(lt=Qc[0],lt.blockedOn===null);)Vc(lt),lt.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(it,_,lt,ft){var mt=C,pt=cd.transition;cd.transition=null;try{C=1,fd(it,_,lt,ft)}finally{C=mt,cd.transition=pt}}function gd(it,_,lt,ft){var mt=C,pt=cd.transition;cd.transition=null;try{C=4,fd(it,_,lt,ft)}finally{C=mt,cd.transition=pt}}function fd(it,_,lt,ft){if(dd){var mt=Yc(it,_,lt,ft);if(mt===null)hd(it,_,ft,id$2,lt),Sc(it,ft);else if(Uc(mt,it,_,lt,ft))ft.stopPropagation();else if(Sc(it,ft),_&4&&-1<Rc.indexOf(it)){for(;mt!==null;){var pt=Cb(mt);if(pt!==null&&Ec(pt),pt=Yc(it,_,lt,ft),pt===null&&hd(it,_,ft,id$2,lt),pt===mt)break;mt=pt}mt!==null&&ft.stopPropagation()}else hd(it,_,ft,null,lt)}}var id$2=null;function Yc(it,_,lt,ft){if(id$2=null,it=xb(ft),it=Wc(it),it!==null)if(_=Vb(it),_===null)it=null;else if(lt=_.tag,lt===13){if(it=Wb(_),it!==null)return it;it=null}else if(lt===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;it=null}else _!==it&&(it=null);return id$2=it,null}function jd(it){switch(it){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var it,_=ld,lt=_.length,ft,mt="value"in kd?kd.value:kd.textContent,pt=mt.length;for(it=0;it<lt&&_[it]===mt[it];it++);var gt=lt-it;for(ft=1;ft<=gt&&_[lt-ft]===mt[pt-ft];ft++);return md=mt.slice(it,1<ft?1-ft:void 0)}function od(it){var _=it.keyCode;return"charCode"in it?(it=it.charCode,it===0&&_===13&&(it=13)):it=_,it===10&&(it=13),32<=it||it===13?it:0}function pd(){return!0}function qd(){return!1}function rd(it){function _(lt,ft,mt,pt,gt){this._reactName=lt,this._targetInst=mt,this.type=ft,this.nativeEvent=pt,this.target=gt,this.currentTarget=null;for(var bt in it)it.hasOwnProperty(bt)&&(lt=it[bt],this[bt]=lt?lt(pt):pt[bt]);return this.isDefaultPrevented=(pt.defaultPrevented!=null?pt.defaultPrevented:pt.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var lt=this.nativeEvent;lt&&(lt.preventDefault?lt.preventDefault():typeof lt.returnValue!="unknown"&&(lt.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var lt=this.nativeEvent;lt&&(lt.stopPropagation?lt.stopPropagation():typeof lt.cancelBubble!="unknown"&&(lt.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),_}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(it){return it.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(it){return it.relatedTarget===void 0?it.fromElement===it.srcElement?it.toElement:it.fromElement:it.relatedTarget},movementX:function(it){return"movementX"in it?it.movementX:(it!==yd&&(yd&&it.type==="mousemove"?(wd=it.screenX-yd.screenX,xd=it.screenY-yd.screenY):xd=wd=0,yd=it),wd)},movementY:function(it){return"movementY"in it?it.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(it){return"clipboardData"in it?it.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(it){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(it):(it=Od[it])?!!_[it]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(it){if(it.key){var _=Md[it.key]||it.key;if(_!=="Unidentified")return _}return it.type==="keypress"?(it=od(it),it===13?"Enter":String.fromCharCode(it)):it.type==="keydown"||it.type==="keyup"?Nd[it.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(it){return it.type==="keypress"?od(it):0},keyCode:function(it){return it.type==="keydown"||it.type==="keyup"?it.keyCode:0},which:function(it){return it.type==="keypress"?od(it):it.type==="keydown"||it.type==="keyup"?it.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(it){return"deltaX"in it?it.deltaX:"wheelDeltaX"in it?-it.wheelDeltaX:0},deltaY:function(it){return"deltaY"in it?it.deltaY:"wheelDeltaY"in it?-it.wheelDeltaY:"wheelDelta"in it?-it.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(it,_){switch(it){case"keyup":return $d.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(it){return it=it.detail,typeof it=="object"&&"data"in it?it.data:null}var ie=!1;function je(it,_){switch(it){case"compositionend":return he(_);case"keypress":return _.which!==32?null:(fe=!0,ee);case"textInput":return it=_.data,it===ee&&fe?null:it;default:return null}}function ke(it,_){if(ie)return it==="compositionend"||!ae&&ge(it,_)?(it=nd(),md=ld=kd=null,ie=!1,it):null;switch(it){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return de&&_.locale!=="ko"?null:_.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(it){var _=it&&it.nodeName&&it.nodeName.toLowerCase();return _==="input"?!!le[it.type]:_==="textarea"}function ne(it,_,lt,ft){Eb(ft),_=oe(_,"onChange"),0<_.length&&(lt=new td("onChange","change",null,lt,ft),it.push({event:lt,listeners:_}))}var pe=null,qe=null;function re(it){se(it,0)}function te(it){var _=ue(it);if(Wa(_))return it}function ve(it,_){if(it==="change")return _}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(it){if(it.propertyName==="value"&&te(qe)){var _=[];ne(_,qe,it,xb(it)),Jb(re,_)}}function Ce(it,_,lt){it==="focusin"?(Ae(),pe=_,qe=lt,pe.attachEvent("onpropertychange",Be)):it==="focusout"&&Ae()}function De(it){if(it==="selectionchange"||it==="keyup"||it==="keydown")return te(qe)}function Ee(it,_){if(it==="click")return te(_)}function Fe(it,_){if(it==="input"||it==="change")return te(_)}function Ge(it,_){return it===_&&(it!==0||1/it===1/_)||it!==it&&_!==_}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(it,_){if(He(it,_))return!0;if(typeof it!="object"||it===null||typeof _!="object"||_===null)return!1;var lt=Object.keys(it),ft=Object.keys(_);if(lt.length!==ft.length)return!1;for(ft=0;ft<lt.length;ft++){var mt=lt[ft];if(!ja.call(_,mt)||!He(it[mt],_[mt]))return!1}return!0}function Je(it){for(;it&&it.firstChild;)it=it.firstChild;return it}function Ke(it,_){var lt=Je(it);it=0;for(var ft;lt;){if(lt.nodeType===3){if(ft=it+lt.textContent.length,it<=_&&ft>=_)return{node:lt,offset:_-it};it=ft}e:{for(;lt;){if(lt.nextSibling){lt=lt.nextSibling;break e}lt=lt.parentNode}lt=void 0}lt=Je(lt)}}function Le(it,_){return it&&_?it===_?!0:it&&it.nodeType===3?!1:_&&_.nodeType===3?Le(it,_.parentNode):"contains"in it?it.contains(_):it.compareDocumentPosition?!!(it.compareDocumentPosition(_)&16):!1:!1}function Me(){for(var it=window,_=Xa();_ instanceof it.HTMLIFrameElement;){try{var lt=typeof _.contentWindow.location.href=="string"}catch{lt=!1}if(lt)it=_.contentWindow;else break;_=Xa(it.document)}return _}function Ne(it){var _=it&&it.nodeName&&it.nodeName.toLowerCase();return _&&(_==="input"&&(it.type==="text"||it.type==="search"||it.type==="tel"||it.type==="url"||it.type==="password")||_==="textarea"||it.contentEditable==="true")}function Oe(it){var _=Me(),lt=it.focusedElem,ft=it.selectionRange;if(_!==lt&&lt&&lt.ownerDocument&&Le(lt.ownerDocument.documentElement,lt)){if(ft!==null&&Ne(lt)){if(_=ft.start,it=ft.end,it===void 0&&(it=_),"selectionStart"in lt)lt.selectionStart=_,lt.selectionEnd=Math.min(it,lt.value.length);else if(it=(_=lt.ownerDocument||document)&&_.defaultView||window,it.getSelection){it=it.getSelection();var mt=lt.textContent.length,pt=Math.min(ft.start,mt);ft=ft.end===void 0?pt:Math.min(ft.end,mt),!it.extend&&pt>ft&&(mt=ft,ft=pt,pt=mt),mt=Ke(lt,pt);var gt=Ke(lt,ft);mt&&gt&&(it.rangeCount!==1||it.anchorNode!==mt.node||it.anchorOffset!==mt.offset||it.focusNode!==gt.node||it.focusOffset!==gt.offset)&&(_=_.createRange(),_.setStart(mt.node,mt.offset),it.removeAllRanges(),pt>ft?(it.addRange(_),it.extend(gt.node,gt.offset)):(_.setEnd(gt.node,gt.offset),it.addRange(_)))}}for(_=[],it=lt;it=it.parentNode;)it.nodeType===1&&_.push({element:it,left:it.scrollLeft,top:it.scrollTop});for(typeof lt.focus=="function"&&lt.focus(),lt=0;lt<_.length;lt++)it=_[lt],it.element.scrollLeft=it.left,it.element.scrollTop=it.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(it,_,lt){var ft=lt.window===lt?lt.document:lt.nodeType===9?lt:lt.ownerDocument;Te||Qe==null||Qe!==Xa(ft)||(ft=Qe,"selectionStart"in ft&&Ne(ft)?ft={start:ft.selectionStart,end:ft.selectionEnd}:(ft=(ft.ownerDocument&&ft.ownerDocument.defaultView||window).getSelection(),ft={anchorNode:ft.anchorNode,anchorOffset:ft.anchorOffset,focusNode:ft.focusNode,focusOffset:ft.focusOffset}),Se&&Ie(Se,ft)||(Se=ft,ft=oe(Re,"onSelect"),0<ft.length&&(_=new td("onSelect","select",null,_,lt),it.push({event:_,listeners:ft}),_.target=Qe)))}function Ve(it,_){var lt={};return lt[it.toLowerCase()]=_.toLowerCase(),lt["Webkit"+it]="webkit"+_,lt["Moz"+it]="moz"+_,lt}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(it){if(Xe[it])return Xe[it];if(!We[it])return it;var _=We[it],lt;for(lt in _)if(_.hasOwnProperty(lt)&&lt in Ye)return Xe[it]=_[lt];return it}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(it,_){df.set(it,_),fa(_,[it])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(it,_,lt){var ft=it.type||"unknown-event";it.currentTarget=lt,Ub(ft,_,void 0,it),it.currentTarget=null}function se(it,_){_=(_&4)!==0;for(var lt=0;lt<it.length;lt++){var ft=it[lt],mt=ft.event;ft=ft.listeners;e:{var pt=void 0;if(_)for(var gt=ft.length-1;0<=gt;gt--){var bt=ft[gt],wt=bt.instance,vt=bt.currentTarget;if(bt=bt.listener,wt!==pt&&mt.isPropagationStopped())break e;nf(mt,bt,vt),pt=wt}else for(gt=0;gt<ft.length;gt++){if(bt=ft[gt],wt=bt.instance,vt=bt.currentTarget,bt=bt.listener,wt!==pt&&mt.isPropagationStopped())break e;nf(mt,bt,vt),pt=wt}}}if(Qb)throw it=Rb,Qb=!1,Rb=null,it}function D(it,_){var lt=_[of];lt===void 0&&(lt=_[of]=new Set);var ft=it+"__bubble";lt.has(ft)||(pf(_,it,2,!1),lt.add(ft))}function qf(it,_,lt){var ft=0;_&&(ft|=4),pf(lt,it,ft,_)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(it){if(!it[rf]){it[rf]=!0,da.forEach(function(lt){lt!=="selectionchange"&&(mf.has(lt)||qf(lt,!1,it),qf(lt,!0,it))});var _=it.nodeType===9?it:it.ownerDocument;_===null||_[rf]||(_[rf]=!0,qf("selectionchange",!1,_))}}function pf(it,_,lt,ft){switch(jd(_)){case 1:var mt=ed;break;case 4:mt=gd;break;default:mt=fd}lt=mt.bind(null,_,lt,it),mt=void 0,!Lb||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(mt=!0),ft?mt!==void 0?it.addEventListener(_,lt,{capture:!0,passive:mt}):it.addEventListener(_,lt,!0):mt!==void 0?it.addEventListener(_,lt,{passive:mt}):it.addEventListener(_,lt,!1)}function hd(it,_,lt,ft,mt){var pt=ft;if(!(_&1)&&!(_&2)&&ft!==null)e:for(;;){if(ft===null)return;var gt=ft.tag;if(gt===3||gt===4){var bt=ft.stateNode.containerInfo;if(bt===mt||bt.nodeType===8&&bt.parentNode===mt)break;if(gt===4)for(gt=ft.return;gt!==null;){var wt=gt.tag;if((wt===3||wt===4)&&(wt=gt.stateNode.containerInfo,wt===mt||wt.nodeType===8&&wt.parentNode===mt))return;gt=gt.return}for(;bt!==null;){if(gt=Wc(bt),gt===null)return;if(wt=gt.tag,wt===5||wt===6){ft=pt=gt;continue e}bt=bt.parentNode}}ft=ft.return}Jb(function(){var vt=pt,Ct=xb(lt),Rt=[];e:{var Mt=df.get(it);if(Mt!==void 0){var Ot=td,Nt=it;switch(it){case"keypress":if(od(lt)===0)break e;case"keydown":case"keyup":Ot=Rd;break;case"focusin":Nt="focus",Ot=Fd;break;case"focusout":Nt="blur",Ot=Fd;break;case"beforeblur":case"afterblur":Ot=Fd;break;case"click":if(lt.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ot=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ot=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ot=Vd;break;case $e:case af:case bf:Ot=Hd;break;case cf:Ot=Xd;break;case"scroll":Ot=vd;break;case"wheel":Ot=Zd;break;case"copy":case"cut":case"paste":Ot=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ot=Td}var Ht=(_&4)!==0,Kt=!Ht&&it==="scroll",hr=Ht?Mt!==null?Mt+"Capture":null:Mt;Ht=[];for(var Qt=vt,mr;Qt!==null;){mr=Qt;var br=mr.stateNode;if(mr.tag===5&&br!==null&&(mr=br,hr!==null&&(br=Kb(Qt,hr),br!=null&&Ht.push(tf(Qt,br,mr)))),Kt)break;Qt=Qt.return}0<Ht.length&&(Mt=new Ot(Mt,Nt,null,lt,Ct),Rt.push({event:Mt,listeners:Ht}))}}if(!(_&7)){e:{if(Mt=it==="mouseover"||it==="pointerover",Ot=it==="mouseout"||it==="pointerout",Mt&&lt!==wb&&(Nt=lt.relatedTarget||lt.fromElement)&&(Wc(Nt)||Nt[uf]))break e;if((Ot||Mt)&&(Mt=Ct.window===Ct?Ct:(Mt=Ct.ownerDocument)?Mt.defaultView||Mt.parentWindow:window,Ot?(Nt=lt.relatedTarget||lt.toElement,Ot=vt,Nt=Nt?Wc(Nt):null,Nt!==null&&(Kt=Vb(Nt),Nt!==Kt||Nt.tag!==5&&Nt.tag!==6)&&(Nt=null)):(Ot=null,Nt=vt),Ot!==Nt)){if(Ht=Bd,br="onMouseLeave",hr="onMouseEnter",Qt="mouse",(it==="pointerout"||it==="pointerover")&&(Ht=Td,br="onPointerLeave",hr="onPointerEnter",Qt="pointer"),Kt=Ot==null?Mt:ue(Ot),mr=Nt==null?Mt:ue(Nt),Mt=new Ht(br,Qt+"leave",Ot,lt,Ct),Mt.target=Kt,Mt.relatedTarget=mr,br=null,Wc(Ct)===vt&&(Ht=new Ht(hr,Qt+"enter",Nt,lt,Ct),Ht.target=mr,Ht.relatedTarget=Kt,br=Ht),Kt=br,Ot&&Nt)t:{for(Ht=Ot,hr=Nt,Qt=0,mr=Ht;mr;mr=vf(mr))Qt++;for(mr=0,br=hr;br;br=vf(br))mr++;for(;0<Qt-mr;)Ht=vf(Ht),Qt--;for(;0<mr-Qt;)hr=vf(hr),mr--;for(;Qt--;){if(Ht===hr||hr!==null&&Ht===hr.alternate)break t;Ht=vf(Ht),hr=vf(hr)}Ht=null}else Ht=null;Ot!==null&&wf(Rt,Mt,Ot,Ht,!1),Nt!==null&&Kt!==null&&wf(Rt,Kt,Nt,Ht,!0)}}e:{if(Mt=vt?ue(vt):window,Ot=Mt.nodeName&&Mt.nodeName.toLowerCase(),Ot==="select"||Ot==="input"&&Mt.type==="file")var Fr=ve;else if(me(Mt))if(we)Fr=Fe;else{Fr=De;var kr=Ce}else(Ot=Mt.nodeName)&&Ot.toLowerCase()==="input"&&(Mt.type==="checkbox"||Mt.type==="radio")&&(Fr=Ee);if(Fr&&(Fr=Fr(it,vt))){ne(Rt,Fr,lt,Ct);break e}kr&&kr(it,Mt,vt),it==="focusout"&&(kr=Mt._wrapperState)&&kr.controlled&&Mt.type==="number"&&cb(Mt,"number",Mt.value)}switch(kr=vt?ue(vt):window,it){case"focusin":(me(kr)||kr.contentEditable==="true")&&(Qe=kr,Re=vt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(Rt,lt,Ct);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(Rt,lt,Ct)}var Br;if(ae)e:{switch(it){case"compositionstart":var Nr="onCompositionStart";break e;case"compositionend":Nr="onCompositionEnd";break e;case"compositionupdate":Nr="onCompositionUpdate";break e}Nr=void 0}else ie?ge(it,lt)&&(Nr="onCompositionEnd"):it==="keydown"&&lt.keyCode===229&&(Nr="onCompositionStart");Nr&&(de&&lt.locale!=="ko"&&(ie||Nr!=="onCompositionStart"?Nr==="onCompositionEnd"&&ie&&(Br=nd()):(kd=Ct,ld="value"in kd?kd.value:kd.textContent,ie=!0)),kr=oe(vt,Nr),0<kr.length&&(Nr=new Ld(Nr,it,null,lt,Ct),Rt.push({event:Nr,listeners:kr}),Br?Nr.data=Br:(Br=he(lt),Br!==null&&(Nr.data=Br)))),(Br=ce?je(it,lt):ke(it,lt))&&(vt=oe(vt,"onBeforeInput"),0<vt.length&&(Ct=new Ld("onBeforeInput","beforeinput",null,lt,Ct),Rt.push({event:Ct,listeners:vt}),Ct.data=Br))}se(Rt,_)})}function tf(it,_,lt){return{instance:it,listener:_,currentTarget:lt}}function oe(it,_){for(var lt=_+"Capture",ft=[];it!==null;){var mt=it,pt=mt.stateNode;mt.tag===5&&pt!==null&&(mt=pt,pt=Kb(it,lt),pt!=null&&ft.unshift(tf(it,pt,mt)),pt=Kb(it,_),pt!=null&&ft.push(tf(it,pt,mt))),it=it.return}return ft}function vf(it){if(it===null)return null;do it=it.return;while(it&&it.tag!==5);return it||null}function wf(it,_,lt,ft,mt){for(var pt=_._reactName,gt=[];lt!==null&&lt!==ft;){var bt=lt,wt=bt.alternate,vt=bt.stateNode;if(wt!==null&&wt===ft)break;bt.tag===5&&vt!==null&&(bt=vt,mt?(wt=Kb(lt,pt),wt!=null&&gt.unshift(tf(lt,wt,bt))):mt||(wt=Kb(lt,pt),wt!=null&&gt.push(tf(lt,wt,bt)))),lt=lt.return}gt.length!==0&&it.push({event:_,listeners:gt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(it){return(typeof it=="string"?it:""+it).replace(xf,`
`).replace(yf,"")}function Af(it,_,lt){if(_=zf(_),zf(it)!==_&&lt)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(it,_){return it==="textarea"||it==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(it){return Hf.resolve(null).then(it).catch(If)}:Ff;function If(it){setTimeout(function(){throw it})}function Kf(it,_){var lt=_,ft=0;do{var mt=lt.nextSibling;if(it.removeChild(lt),mt&&mt.nodeType===8)if(lt=mt.data,lt==="/$"){if(ft===0){it.removeChild(mt),bd(_);return}ft--}else lt!=="$"&&lt!=="$?"&&lt!=="$!"||ft++;lt=mt}while(lt);bd(_)}function Lf(it){for(;it!=null;it=it.nextSibling){var _=it.nodeType;if(_===1||_===3)break;if(_===8){if(_=it.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return it}function Mf(it){it=it.previousSibling;for(var _=0;it;){if(it.nodeType===8){var lt=it.data;if(lt==="$"||lt==="$!"||lt==="$?"){if(_===0)return it;_--}else lt==="/$"&&_++}it=it.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(it){var _=it[Of];if(_)return _;for(var lt=it.parentNode;lt;){if(_=lt[uf]||lt[Of]){if(lt=_.alternate,_.child!==null||lt!==null&&lt.child!==null)for(it=Mf(it);it!==null;){if(lt=it[Of])return lt;it=Mf(it)}return _}it=lt,lt=it.parentNode}return null}function Cb(it){return it=it[Of]||it[uf],!it||it.tag!==5&&it.tag!==6&&it.tag!==13&&it.tag!==3?null:it}function ue(it){if(it.tag===5||it.tag===6)return it.stateNode;throw Error(p$1(33))}function Db(it){return it[Pf]||null}var Sf=[],Tf=-1;function Uf(it){return{current:it}}function E(it){0>Tf||(it.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(it,_){Tf++,Sf[Tf]=it.current,it.current=_}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(it,_){var lt=it.type.contextTypes;if(!lt)return Vf;var ft=it.stateNode;if(ft&&ft.__reactInternalMemoizedUnmaskedChildContext===_)return ft.__reactInternalMemoizedMaskedChildContext;var mt={},pt;for(pt in lt)mt[pt]=_[pt];return ft&&(it=it.stateNode,it.__reactInternalMemoizedUnmaskedChildContext=_,it.__reactInternalMemoizedMaskedChildContext=mt),mt}function Zf(it){return it=it.childContextTypes,it!=null}function $f(){E(Wf),E(H$1)}function ag(it,_,lt){if(H$1.current!==Vf)throw Error(p$1(168));G(H$1,_),G(Wf,lt)}function bg(it,_,lt){var ft=it.stateNode;if(_=_.childContextTypes,typeof ft.getChildContext!="function")return lt;ft=ft.getChildContext();for(var mt in ft)if(!(mt in _))throw Error(p$1(108,Ra(it)||"Unknown",mt));return A({},lt,ft)}function cg(it){return it=(it=it.stateNode)&&it.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G(H$1,it),G(Wf,Wf.current),!0}function dg(it,_,lt){var ft=it.stateNode;if(!ft)throw Error(p$1(169));lt?(it=bg(it,_,Xf),ft.__reactInternalMemoizedMergedChildContext=it,E(Wf),E(H$1),G(H$1,it)):E(Wf),G(Wf,lt)}var eg=null,fg=!1,gg=!1;function hg(it){eg===null?eg=[it]:eg.push(it)}function ig(it){fg=!0,hg(it)}function jg(){if(!gg&&eg!==null){gg=!0;var it=0,_=C;try{var lt=eg;for(C=1;it<lt.length;it++){var ft=lt[it];do ft=ft(!0);while(ft!==null)}eg=null,fg=!1}catch(mt){throw eg!==null&&(eg=eg.slice(it+1)),ac(fc,jg),mt}finally{C=_,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(it,_){kg[lg++]=ng,kg[lg++]=mg,mg=it,ng=_}function ug(it,_,lt){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=it;var ft=rg;it=sg;var mt=32-oc(ft)-1;ft&=~(1<<mt),lt+=1;var pt=32-oc(_)+mt;if(30<pt){var gt=mt-mt%5;pt=(ft&(1<<gt)-1).toString(32),ft>>=gt,mt-=gt,rg=1<<32-oc(_)+mt|lt<<mt|ft,sg=pt+it}else rg=1<<pt|lt<<mt|ft,sg=it}function vg(it){it.return!==null&&(tg(it,1),ug(it,1,0))}function wg(it){for(;it===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;it===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(it,_){var lt=Bg(5,null,null,0);lt.elementType="DELETED",lt.stateNode=_,lt.return=it,_=it.deletions,_===null?(it.deletions=[lt],it.flags|=16):_.push(lt)}function Cg(it,_){switch(it.tag){case 5:var lt=it.type;return _=_.nodeType!==1||lt.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(it.stateNode=_,xg=it,yg=Lf(_.firstChild),!0):!1;case 6:return _=it.pendingProps===""||_.nodeType!==3?null:_,_!==null?(it.stateNode=_,xg=it,yg=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(lt=qg!==null?{id:rg,overflow:sg}:null,it.memoizedState={dehydrated:_,treeContext:lt,retryLane:1073741824},lt=Bg(18,null,null,0),lt.stateNode=_,lt.return=it,it.child=lt,xg=it,yg=null,!0):!1;default:return!1}}function Dg(it){return(it.mode&1)!==0&&(it.flags&128)===0}function Eg(it){if(I){var _=yg;if(_){var lt=_;if(!Cg(it,_)){if(Dg(it))throw Error(p$1(418));_=Lf(lt.nextSibling);var ft=xg;_&&Cg(it,_)?Ag(ft,lt):(it.flags=it.flags&-4097|2,I=!1,xg=it)}}else{if(Dg(it))throw Error(p$1(418));it.flags=it.flags&-4097|2,I=!1,xg=it}}}function Fg(it){for(it=it.return;it!==null&&it.tag!==5&&it.tag!==3&&it.tag!==13;)it=it.return;xg=it}function Gg(it){if(it!==xg)return!1;if(!I)return Fg(it),I=!0,!1;var _;if((_=it.tag!==3)&&!(_=it.tag!==5)&&(_=it.type,_=_!=="head"&&_!=="body"&&!Ef(it.type,it.memoizedProps)),_&&(_=yg)){if(Dg(it))throw Hg(),Error(p$1(418));for(;_;)Ag(it,_),_=Lf(_.nextSibling)}if(Fg(it),it.tag===13){if(it=it.memoizedState,it=it!==null?it.dehydrated:null,!it)throw Error(p$1(317));e:{for(it=it.nextSibling,_=0;it;){if(it.nodeType===8){var lt=it.data;if(lt==="/$"){if(_===0){yg=Lf(it.nextSibling);break e}_--}else lt!=="$"&&lt!=="$!"&&lt!=="$?"||_++}it=it.nextSibling}yg=null}}else yg=xg?Lf(it.stateNode.nextSibling):null;return!0}function Hg(){for(var it=yg;it;)it=Lf(it.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(it){zg===null?zg=[it]:zg.push(it)}var Kg=ua.ReactCurrentBatchConfig;function Lg(it,_,lt){if(it=lt.ref,it!==null&&typeof it!="function"&&typeof it!="object"){if(lt._owner){if(lt=lt._owner,lt){if(lt.tag!==1)throw Error(p$1(309));var ft=lt.stateNode}if(!ft)throw Error(p$1(147,it));var mt=ft,pt=""+it;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===pt?_.ref:(_=function(gt){var bt=mt.refs;gt===null?delete bt[pt]:bt[pt]=gt},_._stringRef=pt,_)}if(typeof it!="string")throw Error(p$1(284));if(!lt._owner)throw Error(p$1(290,it))}return it}function Mg(it,_){throw it=Object.prototype.toString.call(_),Error(p$1(31,it==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":it))}function Ng(it){var _=it._init;return _(it._payload)}function Og(it){function _(hr,Qt){if(it){var mr=hr.deletions;mr===null?(hr.deletions=[Qt],hr.flags|=16):mr.push(Qt)}}function lt(hr,Qt){if(!it)return null;for(;Qt!==null;)_(hr,Qt),Qt=Qt.sibling;return null}function ft(hr,Qt){for(hr=new Map;Qt!==null;)Qt.key!==null?hr.set(Qt.key,Qt):hr.set(Qt.index,Qt),Qt=Qt.sibling;return hr}function mt(hr,Qt){return hr=Pg(hr,Qt),hr.index=0,hr.sibling=null,hr}function pt(hr,Qt,mr){return hr.index=mr,it?(mr=hr.alternate,mr!==null?(mr=mr.index,mr<Qt?(hr.flags|=2,Qt):mr):(hr.flags|=2,Qt)):(hr.flags|=1048576,Qt)}function gt(hr){return it&&hr.alternate===null&&(hr.flags|=2),hr}function bt(hr,Qt,mr,br){return Qt===null||Qt.tag!==6?(Qt=Qg(mr,hr.mode,br),Qt.return=hr,Qt):(Qt=mt(Qt,mr),Qt.return=hr,Qt)}function wt(hr,Qt,mr,br){var Fr=mr.type;return Fr===ya?Ct(hr,Qt,mr.props.children,br,mr.key):Qt!==null&&(Qt.elementType===Fr||typeof Fr=="object"&&Fr!==null&&Fr.$$typeof===Ha&&Ng(Fr)===Qt.type)?(br=mt(Qt,mr.props),br.ref=Lg(hr,Qt,mr),br.return=hr,br):(br=Rg(mr.type,mr.key,mr.props,null,hr.mode,br),br.ref=Lg(hr,Qt,mr),br.return=hr,br)}function vt(hr,Qt,mr,br){return Qt===null||Qt.tag!==4||Qt.stateNode.containerInfo!==mr.containerInfo||Qt.stateNode.implementation!==mr.implementation?(Qt=Sg(mr,hr.mode,br),Qt.return=hr,Qt):(Qt=mt(Qt,mr.children||[]),Qt.return=hr,Qt)}function Ct(hr,Qt,mr,br,Fr){return Qt===null||Qt.tag!==7?(Qt=Tg(mr,hr.mode,br,Fr),Qt.return=hr,Qt):(Qt=mt(Qt,mr),Qt.return=hr,Qt)}function Rt(hr,Qt,mr){if(typeof Qt=="string"&&Qt!==""||typeof Qt=="number")return Qt=Qg(""+Qt,hr.mode,mr),Qt.return=hr,Qt;if(typeof Qt=="object"&&Qt!==null){switch(Qt.$$typeof){case va:return mr=Rg(Qt.type,Qt.key,Qt.props,null,hr.mode,mr),mr.ref=Lg(hr,null,Qt),mr.return=hr,mr;case wa:return Qt=Sg(Qt,hr.mode,mr),Qt.return=hr,Qt;case Ha:var br=Qt._init;return Rt(hr,br(Qt._payload),mr)}if(eb(Qt)||Ka(Qt))return Qt=Tg(Qt,hr.mode,mr,null),Qt.return=hr,Qt;Mg(hr,Qt)}return null}function Mt(hr,Qt,mr,br){var Fr=Qt!==null?Qt.key:null;if(typeof mr=="string"&&mr!==""||typeof mr=="number")return Fr!==null?null:bt(hr,Qt,""+mr,br);if(typeof mr=="object"&&mr!==null){switch(mr.$$typeof){case va:return mr.key===Fr?wt(hr,Qt,mr,br):null;case wa:return mr.key===Fr?vt(hr,Qt,mr,br):null;case Ha:return Fr=mr._init,Mt(hr,Qt,Fr(mr._payload),br)}if(eb(mr)||Ka(mr))return Fr!==null?null:Ct(hr,Qt,mr,br,null);Mg(hr,mr)}return null}function Ot(hr,Qt,mr,br,Fr){if(typeof br=="string"&&br!==""||typeof br=="number")return hr=hr.get(mr)||null,bt(Qt,hr,""+br,Fr);if(typeof br=="object"&&br!==null){switch(br.$$typeof){case va:return hr=hr.get(br.key===null?mr:br.key)||null,wt(Qt,hr,br,Fr);case wa:return hr=hr.get(br.key===null?mr:br.key)||null,vt(Qt,hr,br,Fr);case Ha:var kr=br._init;return Ot(hr,Qt,mr,kr(br._payload),Fr)}if(eb(br)||Ka(br))return hr=hr.get(mr)||null,Ct(Qt,hr,br,Fr,null);Mg(Qt,br)}return null}function Nt(hr,Qt,mr,br){for(var Fr=null,kr=null,Br=Qt,Nr=Qt=0,jn=null;Br!==null&&Nr<mr.length;Nr++){Br.index>Nr?(jn=Br,Br=null):jn=Br.sibling;var Yn=Mt(hr,Br,mr[Nr],br);if(Yn===null){Br===null&&(Br=jn);break}it&&Br&&Yn.alternate===null&&_(hr,Br),Qt=pt(Yn,Qt,Nr),kr===null?Fr=Yn:kr.sibling=Yn,kr=Yn,Br=jn}if(Nr===mr.length)return lt(hr,Br),I&&tg(hr,Nr),Fr;if(Br===null){for(;Nr<mr.length;Nr++)Br=Rt(hr,mr[Nr],br),Br!==null&&(Qt=pt(Br,Qt,Nr),kr===null?Fr=Br:kr.sibling=Br,kr=Br);return I&&tg(hr,Nr),Fr}for(Br=ft(hr,Br);Nr<mr.length;Nr++)jn=Ot(Br,hr,Nr,mr[Nr],br),jn!==null&&(it&&jn.alternate!==null&&Br.delete(jn.key===null?Nr:jn.key),Qt=pt(jn,Qt,Nr),kr===null?Fr=jn:kr.sibling=jn,kr=jn);return it&&Br.forEach(function(ga){return _(hr,ga)}),I&&tg(hr,Nr),Fr}function Ht(hr,Qt,mr,br){var Fr=Ka(mr);if(typeof Fr!="function")throw Error(p$1(150));if(mr=Fr.call(mr),mr==null)throw Error(p$1(151));for(var kr=Fr=null,Br=Qt,Nr=Qt=0,jn=null,Yn=mr.next();Br!==null&&!Yn.done;Nr++,Yn=mr.next()){Br.index>Nr?(jn=Br,Br=null):jn=Br.sibling;var ga=Mt(hr,Br,Yn.value,br);if(ga===null){Br===null&&(Br=jn);break}it&&Br&&ga.alternate===null&&_(hr,Br),Qt=pt(ga,Qt,Nr),kr===null?Fr=ga:kr.sibling=ga,kr=ga,Br=jn}if(Yn.done)return lt(hr,Br),I&&tg(hr,Nr),Fr;if(Br===null){for(;!Yn.done;Nr++,Yn=mr.next())Yn=Rt(hr,Yn.value,br),Yn!==null&&(Qt=pt(Yn,Qt,Nr),kr===null?Fr=Yn:kr.sibling=Yn,kr=Yn);return I&&tg(hr,Nr),Fr}for(Br=ft(hr,Br);!Yn.done;Nr++,Yn=mr.next())Yn=Ot(Br,hr,Nr,Yn.value,br),Yn!==null&&(it&&Yn.alternate!==null&&Br.delete(Yn.key===null?Nr:Yn.key),Qt=pt(Yn,Qt,Nr),kr===null?Fr=Yn:kr.sibling=Yn,kr=Yn);return it&&Br.forEach(function(Kn){return _(hr,Kn)}),I&&tg(hr,Nr),Fr}function Kt(hr,Qt,mr,br){if(typeof mr=="object"&&mr!==null&&mr.type===ya&&mr.key===null&&(mr=mr.props.children),typeof mr=="object"&&mr!==null){switch(mr.$$typeof){case va:e:{for(var Fr=mr.key,kr=Qt;kr!==null;){if(kr.key===Fr){if(Fr=mr.type,Fr===ya){if(kr.tag===7){lt(hr,kr.sibling),Qt=mt(kr,mr.props.children),Qt.return=hr,hr=Qt;break e}}else if(kr.elementType===Fr||typeof Fr=="object"&&Fr!==null&&Fr.$$typeof===Ha&&Ng(Fr)===kr.type){lt(hr,kr.sibling),Qt=mt(kr,mr.props),Qt.ref=Lg(hr,kr,mr),Qt.return=hr,hr=Qt;break e}lt(hr,kr);break}else _(hr,kr);kr=kr.sibling}mr.type===ya?(Qt=Tg(mr.props.children,hr.mode,br,mr.key),Qt.return=hr,hr=Qt):(br=Rg(mr.type,mr.key,mr.props,null,hr.mode,br),br.ref=Lg(hr,Qt,mr),br.return=hr,hr=br)}return gt(hr);case wa:e:{for(kr=mr.key;Qt!==null;){if(Qt.key===kr)if(Qt.tag===4&&Qt.stateNode.containerInfo===mr.containerInfo&&Qt.stateNode.implementation===mr.implementation){lt(hr,Qt.sibling),Qt=mt(Qt,mr.children||[]),Qt.return=hr,hr=Qt;break e}else{lt(hr,Qt);break}else _(hr,Qt);Qt=Qt.sibling}Qt=Sg(mr,hr.mode,br),Qt.return=hr,hr=Qt}return gt(hr);case Ha:return kr=mr._init,Kt(hr,Qt,kr(mr._payload),br)}if(eb(mr))return Nt(hr,Qt,mr,br);if(Ka(mr))return Ht(hr,Qt,mr,br);Mg(hr,mr)}return typeof mr=="string"&&mr!==""||typeof mr=="number"?(mr=""+mr,Qt!==null&&Qt.tag===6?(lt(hr,Qt.sibling),Qt=mt(Qt,mr),Qt.return=hr,hr=Qt):(lt(hr,Qt),Qt=Qg(mr,hr.mode,br),Qt.return=hr,hr=Qt),gt(hr)):lt(hr,Qt)}return Kt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(it){var _=Wg.current;E(Wg),it._currentValue=_}function bh(it,_,lt){for(;it!==null;){var ft=it.alternate;if((it.childLanes&_)!==_?(it.childLanes|=_,ft!==null&&(ft.childLanes|=_)):ft!==null&&(ft.childLanes&_)!==_&&(ft.childLanes|=_),it===lt)break;it=it.return}}function ch(it,_){Xg=it,Zg=Yg=null,it=it.dependencies,it!==null&&it.firstContext!==null&&(it.lanes&_&&(dh=!0),it.firstContext=null)}function eh(it){var _=it._currentValue;if(Zg!==it)if(it={context:it,memoizedValue:_,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=it,Xg.dependencies={lanes:0,firstContext:it}}else Yg=Yg.next=it;return _}var fh=null;function gh(it){fh===null?fh=[it]:fh.push(it)}function hh(it,_,lt,ft){var mt=_.interleaved;return mt===null?(lt.next=lt,gh(_)):(lt.next=mt.next,mt.next=lt),_.interleaved=lt,ih(it,ft)}function ih(it,_){it.lanes|=_;var lt=it.alternate;for(lt!==null&&(lt.lanes|=_),lt=it,it=it.return;it!==null;)it.childLanes|=_,lt=it.alternate,lt!==null&&(lt.childLanes|=_),lt=it,it=it.return;return lt.tag===3?lt.stateNode:null}var jh=!1;function kh(it){it.updateQueue={baseState:it.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(it,_){it=it.updateQueue,_.updateQueue===it&&(_.updateQueue={baseState:it.baseState,firstBaseUpdate:it.firstBaseUpdate,lastBaseUpdate:it.lastBaseUpdate,shared:it.shared,effects:it.effects})}function mh(it,_){return{eventTime:it,lane:_,tag:0,payload:null,callback:null,next:null}}function nh(it,_,lt){var ft=it.updateQueue;if(ft===null)return null;if(ft=ft.shared,K&2){var mt=ft.pending;return mt===null?_.next=_:(_.next=mt.next,mt.next=_),ft.pending=_,ih(it,lt)}return mt=ft.interleaved,mt===null?(_.next=_,gh(ft)):(_.next=mt.next,mt.next=_),ft.interleaved=_,ih(it,lt)}function oh(it,_,lt){if(_=_.updateQueue,_!==null&&(_=_.shared,(lt&4194240)!==0)){var ft=_.lanes;ft&=it.pendingLanes,lt|=ft,_.lanes=lt,Cc(it,lt)}}function ph(it,_){var lt=it.updateQueue,ft=it.alternate;if(ft!==null&&(ft=ft.updateQueue,lt===ft)){var mt=null,pt=null;if(lt=lt.firstBaseUpdate,lt!==null){do{var gt={eventTime:lt.eventTime,lane:lt.lane,tag:lt.tag,payload:lt.payload,callback:lt.callback,next:null};pt===null?mt=pt=gt:pt=pt.next=gt,lt=lt.next}while(lt!==null);pt===null?mt=pt=_:pt=pt.next=_}else mt=pt=_;lt={baseState:ft.baseState,firstBaseUpdate:mt,lastBaseUpdate:pt,shared:ft.shared,effects:ft.effects},it.updateQueue=lt;return}it=lt.lastBaseUpdate,it===null?lt.firstBaseUpdate=_:it.next=_,lt.lastBaseUpdate=_}function qh(it,_,lt,ft){var mt=it.updateQueue;jh=!1;var pt=mt.firstBaseUpdate,gt=mt.lastBaseUpdate,bt=mt.shared.pending;if(bt!==null){mt.shared.pending=null;var wt=bt,vt=wt.next;wt.next=null,gt===null?pt=vt:gt.next=vt,gt=wt;var Ct=it.alternate;Ct!==null&&(Ct=Ct.updateQueue,bt=Ct.lastBaseUpdate,bt!==gt&&(bt===null?Ct.firstBaseUpdate=vt:bt.next=vt,Ct.lastBaseUpdate=wt))}if(pt!==null){var Rt=mt.baseState;gt=0,Ct=vt=wt=null,bt=pt;do{var Mt=bt.lane,Ot=bt.eventTime;if((ft&Mt)===Mt){Ct!==null&&(Ct=Ct.next={eventTime:Ot,lane:0,tag:bt.tag,payload:bt.payload,callback:bt.callback,next:null});e:{var Nt=it,Ht=bt;switch(Mt=_,Ot=lt,Ht.tag){case 1:if(Nt=Ht.payload,typeof Nt=="function"){Rt=Nt.call(Ot,Rt,Mt);break e}Rt=Nt;break e;case 3:Nt.flags=Nt.flags&-65537|128;case 0:if(Nt=Ht.payload,Mt=typeof Nt=="function"?Nt.call(Ot,Rt,Mt):Nt,Mt==null)break e;Rt=A({},Rt,Mt);break e;case 2:jh=!0}}bt.callback!==null&&bt.lane!==0&&(it.flags|=64,Mt=mt.effects,Mt===null?mt.effects=[bt]:Mt.push(bt))}else Ot={eventTime:Ot,lane:Mt,tag:bt.tag,payload:bt.payload,callback:bt.callback,next:null},Ct===null?(vt=Ct=Ot,wt=Rt):Ct=Ct.next=Ot,gt|=Mt;if(bt=bt.next,bt===null){if(bt=mt.shared.pending,bt===null)break;Mt=bt,bt=Mt.next,Mt.next=null,mt.lastBaseUpdate=Mt,mt.shared.pending=null}}while(!0);if(Ct===null&&(wt=Rt),mt.baseState=wt,mt.firstBaseUpdate=vt,mt.lastBaseUpdate=Ct,_=mt.shared.interleaved,_!==null){mt=_;do gt|=mt.lane,mt=mt.next;while(mt!==_)}else pt===null&&(mt.shared.lanes=0);rh|=gt,it.lanes=gt,it.memoizedState=Rt}}function sh(it,_,lt){if(it=_.effects,_.effects=null,it!==null)for(_=0;_<it.length;_++){var ft=it[_],mt=ft.callback;if(mt!==null){if(ft.callback=null,ft=lt,typeof mt!="function")throw Error(p$1(191,mt));mt.call(ft)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(it){if(it===th)throw Error(p$1(174));return it}function yh(it,_){switch(G(wh,_),G(vh$1,it),G(uh,th),it=_.nodeType,it){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:lb(null,"");break;default:it=it===8?_.parentNode:_,_=it.namespaceURI||null,it=it.tagName,_=lb(_,it)}E(uh),G(uh,_)}function zh(){E(uh),E(vh$1),E(wh)}function Ah(it){xh(wh.current);var _=xh(uh.current),lt=lb(_,it.type);_!==lt&&(G(vh$1,it),G(uh,lt))}function Bh(it){vh$1.current===it&&(E(uh),E(vh$1))}var L=Uf(0);function Ch(it){for(var _=it;_!==null;){if(_.tag===13){var lt=_.memoizedState;if(lt!==null&&(lt=lt.dehydrated,lt===null||lt.data==="$?"||lt.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if(_.flags&128)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===it)break;for(;_.sibling===null;){if(_.return===null||_.return===it)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Dh=[];function Eh(){for(var it=0;it<Dh.length;it++)Dh[it]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N$1=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p$1(321))}function Mh(it,_){if(_===null)return!1;for(var lt=0;lt<_.length&&lt<it.length;lt++)if(!He(it[lt],_[lt]))return!1;return!0}function Nh(it,_,lt,ft,mt,pt){if(Hh=pt,M$1=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,Fh.current=it===null||it.memoizedState===null?Oh:Ph,it=lt(ft,mt),Jh){pt=0;do{if(Jh=!1,Kh=0,25<=pt)throw Error(p$1(301));pt+=1,O=N$1=null,_.updateQueue=null,Fh.current=Qh,it=lt(ft,mt)}while(Jh)}if(Fh.current=Rh,_=N$1!==null&&N$1.next!==null,Hh=0,O=N$1=M$1=null,Ih=!1,_)throw Error(p$1(300));return it}function Sh(){var it=Kh!==0;return Kh=0,it}function Th(){var it={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M$1.memoizedState=O=it:O=O.next=it,O}function Uh(){if(N$1===null){var it=M$1.alternate;it=it!==null?it.memoizedState:null}else it=N$1.next;var _=O===null?M$1.memoizedState:O.next;if(_!==null)O=_,N$1=it;else{if(it===null)throw Error(p$1(310));N$1=it,it={memoizedState:N$1.memoizedState,baseState:N$1.baseState,baseQueue:N$1.baseQueue,queue:N$1.queue,next:null},O===null?M$1.memoizedState=O=it:O=O.next=it}return O}function Vh(it,_){return typeof _=="function"?_(it):_}function Wh(it){var _=Uh(),lt=_.queue;if(lt===null)throw Error(p$1(311));lt.lastRenderedReducer=it;var ft=N$1,mt=ft.baseQueue,pt=lt.pending;if(pt!==null){if(mt!==null){var gt=mt.next;mt.next=pt.next,pt.next=gt}ft.baseQueue=mt=pt,lt.pending=null}if(mt!==null){pt=mt.next,ft=ft.baseState;var bt=gt=null,wt=null,vt=pt;do{var Ct=vt.lane;if((Hh&Ct)===Ct)wt!==null&&(wt=wt.next={lane:0,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null}),ft=vt.hasEagerState?vt.eagerState:it(ft,vt.action);else{var Rt={lane:Ct,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null};wt===null?(bt=wt=Rt,gt=ft):wt=wt.next=Rt,M$1.lanes|=Ct,rh|=Ct}vt=vt.next}while(vt!==null&&vt!==pt);wt===null?gt=ft:wt.next=bt,He(ft,_.memoizedState)||(dh=!0),_.memoizedState=ft,_.baseState=gt,_.baseQueue=wt,lt.lastRenderedState=ft}if(it=lt.interleaved,it!==null){mt=it;do pt=mt.lane,M$1.lanes|=pt,rh|=pt,mt=mt.next;while(mt!==it)}else mt===null&&(lt.lanes=0);return[_.memoizedState,lt.dispatch]}function Xh(it){var _=Uh(),lt=_.queue;if(lt===null)throw Error(p$1(311));lt.lastRenderedReducer=it;var ft=lt.dispatch,mt=lt.pending,pt=_.memoizedState;if(mt!==null){lt.pending=null;var gt=mt=mt.next;do pt=it(pt,gt.action),gt=gt.next;while(gt!==mt);He(pt,_.memoizedState)||(dh=!0),_.memoizedState=pt,_.baseQueue===null&&(_.baseState=pt),lt.lastRenderedState=pt}return[pt,ft]}function Yh(){}function Zh(it,_){var lt=M$1,ft=Uh(),mt=_(),pt=!He(ft.memoizedState,mt);if(pt&&(ft.memoizedState=mt,dh=!0),ft=ft.queue,$h(ai.bind(null,lt,ft,it),[it]),ft.getSnapshot!==_||pt||O!==null&&O.memoizedState.tag&1){if(lt.flags|=2048,bi(9,ci.bind(null,lt,ft,mt,_),void 0,null),Q===null)throw Error(p$1(349));Hh&30||di(lt,_,mt)}return mt}function di(it,_,lt){it.flags|=16384,it={getSnapshot:_,value:lt},_=M$1.updateQueue,_===null?(_={lastEffect:null,stores:null},M$1.updateQueue=_,_.stores=[it]):(lt=_.stores,lt===null?_.stores=[it]:lt.push(it))}function ci(it,_,lt,ft){_.value=lt,_.getSnapshot=ft,ei(_)&&fi(it)}function ai(it,_,lt){return lt(function(){ei(_)&&fi(it)})}function ei(it){var _=it.getSnapshot;it=it.value;try{var lt=_();return!He(it,lt)}catch{return!0}}function fi(it){var _=ih(it,1);_!==null&&gi(_,it,1,-1)}function hi(it){var _=Th();return typeof it=="function"&&(it=it()),_.memoizedState=_.baseState=it,it={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:it},_.queue=it,it=it.dispatch=ii.bind(null,M$1,it),[_.memoizedState,it]}function bi(it,_,lt,ft){return it={tag:it,create:_,destroy:lt,deps:ft,next:null},_=M$1.updateQueue,_===null?(_={lastEffect:null,stores:null},M$1.updateQueue=_,_.lastEffect=it.next=it):(lt=_.lastEffect,lt===null?_.lastEffect=it.next=it:(ft=lt.next,lt.next=it,it.next=ft,_.lastEffect=it)),it}function ji(){return Uh().memoizedState}function ki(it,_,lt,ft){var mt=Th();M$1.flags|=it,mt.memoizedState=bi(1|_,lt,void 0,ft===void 0?null:ft)}function li(it,_,lt,ft){var mt=Uh();ft=ft===void 0?null:ft;var pt=void 0;if(N$1!==null){var gt=N$1.memoizedState;if(pt=gt.destroy,ft!==null&&Mh(ft,gt.deps)){mt.memoizedState=bi(_,lt,pt,ft);return}}M$1.flags|=it,mt.memoizedState=bi(1|_,lt,pt,ft)}function mi(it,_){return ki(8390656,8,it,_)}function $h(it,_){return li(2048,8,it,_)}function ni(it,_){return li(4,2,it,_)}function oi(it,_){return li(4,4,it,_)}function pi(it,_){if(typeof _=="function")return it=it(),_(it),function(){_(null)};if(_!=null)return it=it(),_.current=it,function(){_.current=null}}function qi(it,_,lt){return lt=lt!=null?lt.concat([it]):null,li(4,4,pi.bind(null,_,it),lt)}function ri(){}function si(it,_){var lt=Uh();_=_===void 0?null:_;var ft=lt.memoizedState;return ft!==null&&_!==null&&Mh(_,ft[1])?ft[0]:(lt.memoizedState=[it,_],it)}function ti(it,_){var lt=Uh();_=_===void 0?null:_;var ft=lt.memoizedState;return ft!==null&&_!==null&&Mh(_,ft[1])?ft[0]:(it=it(),lt.memoizedState=[it,_],it)}function ui(it,_,lt){return Hh&21?(He(lt,_)||(lt=yc(),M$1.lanes|=lt,rh|=lt,it.baseState=!0),_):(it.baseState&&(it.baseState=!1,dh=!0),it.memoizedState=lt)}function vi(it,_){var lt=C;C=lt!==0&&4>lt?lt:4,it(!0);var ft=Gh.transition;Gh.transition={};try{it(!1),_()}finally{C=lt,Gh.transition=ft}}function wi(){return Uh().memoizedState}function xi(it,_,lt){var ft=yi(it);if(lt={lane:ft,action:lt,hasEagerState:!1,eagerState:null,next:null},zi(it))Ai(_,lt);else if(lt=hh(it,_,lt,ft),lt!==null){var mt=R();gi(lt,it,ft,mt),Bi(lt,_,ft)}}function ii(it,_,lt){var ft=yi(it),mt={lane:ft,action:lt,hasEagerState:!1,eagerState:null,next:null};if(zi(it))Ai(_,mt);else{var pt=it.alternate;if(it.lanes===0&&(pt===null||pt.lanes===0)&&(pt=_.lastRenderedReducer,pt!==null))try{var gt=_.lastRenderedState,bt=pt(gt,lt);if(mt.hasEagerState=!0,mt.eagerState=bt,He(bt,gt)){var wt=_.interleaved;wt===null?(mt.next=mt,gh(_)):(mt.next=wt.next,wt.next=mt),_.interleaved=mt;return}}catch{}finally{}lt=hh(it,_,mt,ft),lt!==null&&(mt=R(),gi(lt,it,ft,mt),Bi(lt,_,ft))}}function zi(it){var _=it.alternate;return it===M$1||_!==null&&_===M$1}function Ai(it,_){Jh=Ih=!0;var lt=it.pending;lt===null?_.next=_:(_.next=lt.next,lt.next=_),it.pending=_}function Bi(it,_,lt){if(lt&4194240){var ft=_.lanes;ft&=it.pendingLanes,lt|=ft,_.lanes=lt,Cc(it,lt)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(it,_){return Th().memoizedState=[it,_===void 0?null:_],it},useContext:eh,useEffect:mi,useImperativeHandle:function(it,_,lt){return lt=lt!=null?lt.concat([it]):null,ki(4194308,4,pi.bind(null,_,it),lt)},useLayoutEffect:function(it,_){return ki(4194308,4,it,_)},useInsertionEffect:function(it,_){return ki(4,2,it,_)},useMemo:function(it,_){var lt=Th();return _=_===void 0?null:_,it=it(),lt.memoizedState=[it,_],it},useReducer:function(it,_,lt){var ft=Th();return _=lt!==void 0?lt(_):_,ft.memoizedState=ft.baseState=_,it={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:it,lastRenderedState:_},ft.queue=it,it=it.dispatch=xi.bind(null,M$1,it),[ft.memoizedState,it]},useRef:function(it){var _=Th();return it={current:it},_.memoizedState=it},useState:hi,useDebugValue:ri,useDeferredValue:function(it){return Th().memoizedState=it},useTransition:function(){var it=hi(!1),_=it[0];return it=vi.bind(null,it[1]),Th().memoizedState=it,[_,it]},useMutableSource:function(){},useSyncExternalStore:function(it,_,lt){var ft=M$1,mt=Th();if(I){if(lt===void 0)throw Error(p$1(407));lt=lt()}else{if(lt=_(),Q===null)throw Error(p$1(349));Hh&30||di(ft,_,lt)}mt.memoizedState=lt;var pt={value:lt,getSnapshot:_};return mt.queue=pt,mi(ai.bind(null,ft,pt,it),[it]),ft.flags|=2048,bi(9,ci.bind(null,ft,pt,lt,_),void 0,null),lt},useId:function(){var it=Th(),_=Q.identifierPrefix;if(I){var lt=sg,ft=rg;lt=(ft&~(1<<32-oc(ft)-1)).toString(32)+lt,_=":"+_+"R"+lt,lt=Kh++,0<lt&&(_+="H"+lt.toString(32)),_+=":"}else lt=Lh++,_=":"+_+"r"+lt.toString(32)+":";return it.memoizedState=_},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(it){var _=Uh();return ui(_,N$1.memoizedState,it)},useTransition:function(){var it=Wh(Vh)[0],_=Uh().memoizedState;return[it,_]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(it){var _=Uh();return N$1===null?_.memoizedState=it:ui(_,N$1.memoizedState,it)},useTransition:function(){var it=Xh(Vh)[0],_=Uh().memoizedState;return[it,_]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(it,_){if(it&&it.defaultProps){_=A({},_),it=it.defaultProps;for(var lt in it)_[lt]===void 0&&(_[lt]=it[lt]);return _}return _}function Di(it,_,lt,ft){_=it.memoizedState,lt=lt(ft,_),lt=lt==null?_:A({},_,lt),it.memoizedState=lt,it.lanes===0&&(it.updateQueue.baseState=lt)}var Ei={isMounted:function(it){return(it=it._reactInternals)?Vb(it)===it:!1},enqueueSetState:function(it,_,lt){it=it._reactInternals;var ft=R(),mt=yi(it),pt=mh(ft,mt);pt.payload=_,lt!=null&&(pt.callback=lt),_=nh(it,pt,mt),_!==null&&(gi(_,it,mt,ft),oh(_,it,mt))},enqueueReplaceState:function(it,_,lt){it=it._reactInternals;var ft=R(),mt=yi(it),pt=mh(ft,mt);pt.tag=1,pt.payload=_,lt!=null&&(pt.callback=lt),_=nh(it,pt,mt),_!==null&&(gi(_,it,mt,ft),oh(_,it,mt))},enqueueForceUpdate:function(it,_){it=it._reactInternals;var lt=R(),ft=yi(it),mt=mh(lt,ft);mt.tag=2,_!=null&&(mt.callback=_),_=nh(it,mt,ft),_!==null&&(gi(_,it,ft,lt),oh(_,it,ft))}};function Fi(it,_,lt,ft,mt,pt,gt){return it=it.stateNode,typeof it.shouldComponentUpdate=="function"?it.shouldComponentUpdate(ft,pt,gt):_.prototype&&_.prototype.isPureReactComponent?!Ie(lt,ft)||!Ie(mt,pt):!0}function Gi(it,_,lt){var ft=!1,mt=Vf,pt=_.contextType;return typeof pt=="object"&&pt!==null?pt=eh(pt):(mt=Zf(_)?Xf:H$1.current,ft=_.contextTypes,pt=(ft=ft!=null)?Yf(it,mt):Vf),_=new _(lt,pt),it.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=Ei,it.stateNode=_,_._reactInternals=it,ft&&(it=it.stateNode,it.__reactInternalMemoizedUnmaskedChildContext=mt,it.__reactInternalMemoizedMaskedChildContext=pt),_}function Hi(it,_,lt,ft){it=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(lt,ft),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(lt,ft),_.state!==it&&Ei.enqueueReplaceState(_,_.state,null)}function Ii(it,_,lt,ft){var mt=it.stateNode;mt.props=lt,mt.state=it.memoizedState,mt.refs={},kh(it);var pt=_.contextType;typeof pt=="object"&&pt!==null?mt.context=eh(pt):(pt=Zf(_)?Xf:H$1.current,mt.context=Yf(it,pt)),mt.state=it.memoizedState,pt=_.getDerivedStateFromProps,typeof pt=="function"&&(Di(it,_,pt,lt),mt.state=it.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof mt.getSnapshotBeforeUpdate=="function"||typeof mt.UNSAFE_componentWillMount!="function"&&typeof mt.componentWillMount!="function"||(_=mt.state,typeof mt.componentWillMount=="function"&&mt.componentWillMount(),typeof mt.UNSAFE_componentWillMount=="function"&&mt.UNSAFE_componentWillMount(),_!==mt.state&&Ei.enqueueReplaceState(mt,mt.state,null),qh(it,lt,mt,ft),mt.state=it.memoizedState),typeof mt.componentDidMount=="function"&&(it.flags|=4194308)}function Ji(it,_){try{var lt="",ft=_;do lt+=Pa(ft),ft=ft.return;while(ft);var mt=lt}catch(pt){mt=`
Error generating stack: `+pt.message+`
`+pt.stack}return{value:it,source:_,stack:mt,digest:null}}function Ki(it,_,lt){return{value:it,source:null,stack:lt??null,digest:_??null}}function Li(it,_){try{console.error(_.value)}catch(lt){setTimeout(function(){throw lt})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(it,_,lt){lt=mh(-1,lt),lt.tag=3,lt.payload={element:null};var ft=_.value;return lt.callback=function(){Oi||(Oi=!0,Pi=ft),Li(it,_)},lt}function Qi(it,_,lt){lt=mh(-1,lt),lt.tag=3;var ft=it.type.getDerivedStateFromError;if(typeof ft=="function"){var mt=_.value;lt.payload=function(){return ft(mt)},lt.callback=function(){Li(it,_)}}var pt=it.stateNode;return pt!==null&&typeof pt.componentDidCatch=="function"&&(lt.callback=function(){Li(it,_),typeof ft!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var gt=_.stack;this.componentDidCatch(_.value,{componentStack:gt!==null?gt:""})}),lt}function Si(it,_,lt){var ft=it.pingCache;if(ft===null){ft=it.pingCache=new Mi;var mt=new Set;ft.set(_,mt)}else mt=ft.get(_),mt===void 0&&(mt=new Set,ft.set(_,mt));mt.has(lt)||(mt.add(lt),it=Ti.bind(null,it,_,lt),_.then(it,it))}function Ui(it){do{var _;if((_=it.tag===13)&&(_=it.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return it;it=it.return}while(it!==null);return null}function Vi(it,_,lt,ft,mt){return it.mode&1?(it.flags|=65536,it.lanes=mt,it):(it===_?it.flags|=65536:(it.flags|=128,lt.flags|=131072,lt.flags&=-52805,lt.tag===1&&(lt.alternate===null?lt.tag=17:(_=mh(-1,1),_.tag=2,nh(lt,_,1))),lt.lanes|=1),it)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(it,_,lt,ft){_.child=it===null?Vg(_,null,lt,ft):Ug(_,it.child,lt,ft)}function Yi(it,_,lt,ft,mt){lt=lt.render;var pt=_.ref;return ch(_,mt),ft=Nh(it,_,lt,ft,pt,mt),lt=Sh(),it!==null&&!dh?(_.updateQueue=it.updateQueue,_.flags&=-2053,it.lanes&=~mt,Zi(it,_,mt)):(I&&lt&&vg(_),_.flags|=1,Xi(it,_,ft,mt),_.child)}function $i(it,_,lt,ft,mt){if(it===null){var pt=lt.type;return typeof pt=="function"&&!aj(pt)&&pt.defaultProps===void 0&&lt.compare===null&&lt.defaultProps===void 0?(_.tag=15,_.type=pt,bj(it,_,pt,ft,mt)):(it=Rg(lt.type,null,ft,_,_.mode,mt),it.ref=_.ref,it.return=_,_.child=it)}if(pt=it.child,!(it.lanes&mt)){var gt=pt.memoizedProps;if(lt=lt.compare,lt=lt!==null?lt:Ie,lt(gt,ft)&&it.ref===_.ref)return Zi(it,_,mt)}return _.flags|=1,it=Pg(pt,ft),it.ref=_.ref,it.return=_,_.child=it}function bj(it,_,lt,ft,mt){if(it!==null){var pt=it.memoizedProps;if(Ie(pt,ft)&&it.ref===_.ref)if(dh=!1,_.pendingProps=ft=pt,(it.lanes&mt)!==0)it.flags&131072&&(dh=!0);else return _.lanes=it.lanes,Zi(it,_,mt)}return cj(it,_,lt,ft,mt)}function dj(it,_,lt){var ft=_.pendingProps,mt=ft.children,pt=it!==null?it.memoizedState:null;if(ft.mode==="hidden")if(!(_.mode&1))_.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=lt;else{if(!(lt&1073741824))return it=pt!==null?pt.baseLanes|lt:lt,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:it,cachePool:null,transitions:null},_.updateQueue=null,G(ej,fj),fj|=it,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},ft=pt!==null?pt.baseLanes:lt,G(ej,fj),fj|=ft}else pt!==null?(ft=pt.baseLanes|lt,_.memoizedState=null):ft=lt,G(ej,fj),fj|=ft;return Xi(it,_,mt,lt),_.child}function gj(it,_){var lt=_.ref;(it===null&&lt!==null||it!==null&&it.ref!==lt)&&(_.flags|=512,_.flags|=2097152)}function cj(it,_,lt,ft,mt){var pt=Zf(lt)?Xf:H$1.current;return pt=Yf(_,pt),ch(_,mt),lt=Nh(it,_,lt,ft,pt,mt),ft=Sh(),it!==null&&!dh?(_.updateQueue=it.updateQueue,_.flags&=-2053,it.lanes&=~mt,Zi(it,_,mt)):(I&&ft&&vg(_),_.flags|=1,Xi(it,_,lt,mt),_.child)}function hj(it,_,lt,ft,mt){if(Zf(lt)){var pt=!0;cg(_)}else pt=!1;if(ch(_,mt),_.stateNode===null)ij(it,_),Gi(_,lt,ft),Ii(_,lt,ft,mt),ft=!0;else if(it===null){var gt=_.stateNode,bt=_.memoizedProps;gt.props=bt;var wt=gt.context,vt=lt.contextType;typeof vt=="object"&&vt!==null?vt=eh(vt):(vt=Zf(lt)?Xf:H$1.current,vt=Yf(_,vt));var Ct=lt.getDerivedStateFromProps,Rt=typeof Ct=="function"||typeof gt.getSnapshotBeforeUpdate=="function";Rt||typeof gt.UNSAFE_componentWillReceiveProps!="function"&&typeof gt.componentWillReceiveProps!="function"||(bt!==ft||wt!==vt)&&Hi(_,gt,ft,vt),jh=!1;var Mt=_.memoizedState;gt.state=Mt,qh(_,ft,gt,mt),wt=_.memoizedState,bt!==ft||Mt!==wt||Wf.current||jh?(typeof Ct=="function"&&(Di(_,lt,Ct,ft),wt=_.memoizedState),(bt=jh||Fi(_,lt,bt,ft,Mt,wt,vt))?(Rt||typeof gt.UNSAFE_componentWillMount!="function"&&typeof gt.componentWillMount!="function"||(typeof gt.componentWillMount=="function"&&gt.componentWillMount(),typeof gt.UNSAFE_componentWillMount=="function"&&gt.UNSAFE_componentWillMount()),typeof gt.componentDidMount=="function"&&(_.flags|=4194308)):(typeof gt.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=ft,_.memoizedState=wt),gt.props=ft,gt.state=wt,gt.context=vt,ft=bt):(typeof gt.componentDidMount=="function"&&(_.flags|=4194308),ft=!1)}else{gt=_.stateNode,lh(it,_),bt=_.memoizedProps,vt=_.type===_.elementType?bt:Ci(_.type,bt),gt.props=vt,Rt=_.pendingProps,Mt=gt.context,wt=lt.contextType,typeof wt=="object"&&wt!==null?wt=eh(wt):(wt=Zf(lt)?Xf:H$1.current,wt=Yf(_,wt));var Ot=lt.getDerivedStateFromProps;(Ct=typeof Ot=="function"||typeof gt.getSnapshotBeforeUpdate=="function")||typeof gt.UNSAFE_componentWillReceiveProps!="function"&&typeof gt.componentWillReceiveProps!="function"||(bt!==Rt||Mt!==wt)&&Hi(_,gt,ft,wt),jh=!1,Mt=_.memoizedState,gt.state=Mt,qh(_,ft,gt,mt);var Nt=_.memoizedState;bt!==Rt||Mt!==Nt||Wf.current||jh?(typeof Ot=="function"&&(Di(_,lt,Ot,ft),Nt=_.memoizedState),(vt=jh||Fi(_,lt,vt,ft,Mt,Nt,wt)||!1)?(Ct||typeof gt.UNSAFE_componentWillUpdate!="function"&&typeof gt.componentWillUpdate!="function"||(typeof gt.componentWillUpdate=="function"&&gt.componentWillUpdate(ft,Nt,wt),typeof gt.UNSAFE_componentWillUpdate=="function"&&gt.UNSAFE_componentWillUpdate(ft,Nt,wt)),typeof gt.componentDidUpdate=="function"&&(_.flags|=4),typeof gt.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof gt.componentDidUpdate!="function"||bt===it.memoizedProps&&Mt===it.memoizedState||(_.flags|=4),typeof gt.getSnapshotBeforeUpdate!="function"||bt===it.memoizedProps&&Mt===it.memoizedState||(_.flags|=1024),_.memoizedProps=ft,_.memoizedState=Nt),gt.props=ft,gt.state=Nt,gt.context=wt,ft=vt):(typeof gt.componentDidUpdate!="function"||bt===it.memoizedProps&&Mt===it.memoizedState||(_.flags|=4),typeof gt.getSnapshotBeforeUpdate!="function"||bt===it.memoizedProps&&Mt===it.memoizedState||(_.flags|=1024),ft=!1)}return jj(it,_,lt,ft,pt,mt)}function jj(it,_,lt,ft,mt,pt){gj(it,_);var gt=(_.flags&128)!==0;if(!ft&&!gt)return mt&&dg(_,lt,!1),Zi(it,_,pt);ft=_.stateNode,Wi.current=_;var bt=gt&&typeof lt.getDerivedStateFromError!="function"?null:ft.render();return _.flags|=1,it!==null&&gt?(_.child=Ug(_,it.child,null,pt),_.child=Ug(_,null,bt,pt)):Xi(it,_,bt,pt),_.memoizedState=ft.state,mt&&dg(_,lt,!0),_.child}function kj(it){var _=it.stateNode;_.pendingContext?ag(it,_.pendingContext,_.pendingContext!==_.context):_.context&&ag(it,_.context,!1),yh(it,_.containerInfo)}function lj(it,_,lt,ft,mt){return Ig(),Jg(mt),_.flags|=256,Xi(it,_,lt,ft),_.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(it){return{baseLanes:it,cachePool:null,transitions:null}}function oj(it,_,lt){var ft=_.pendingProps,mt=L.current,pt=!1,gt=(_.flags&128)!==0,bt;if((bt=gt)||(bt=it!==null&&it.memoizedState===null?!1:(mt&2)!==0),bt?(pt=!0,_.flags&=-129):(it===null||it.memoizedState!==null)&&(mt|=1),G(L,mt&1),it===null)return Eg(_),it=_.memoizedState,it!==null&&(it=it.dehydrated,it!==null)?(_.mode&1?it.data==="$!"?_.lanes=8:_.lanes=1073741824:_.lanes=1,null):(gt=ft.children,it=ft.fallback,pt?(ft=_.mode,pt=_.child,gt={mode:"hidden",children:gt},!(ft&1)&&pt!==null?(pt.childLanes=0,pt.pendingProps=gt):pt=pj(gt,ft,0,null),it=Tg(it,ft,lt,null),pt.return=_,it.return=_,pt.sibling=it,_.child=pt,_.child.memoizedState=nj(lt),_.memoizedState=mj,it):qj(_,gt));if(mt=it.memoizedState,mt!==null&&(bt=mt.dehydrated,bt!==null))return rj(it,_,gt,ft,bt,mt,lt);if(pt){pt=ft.fallback,gt=_.mode,mt=it.child,bt=mt.sibling;var wt={mode:"hidden",children:ft.children};return!(gt&1)&&_.child!==mt?(ft=_.child,ft.childLanes=0,ft.pendingProps=wt,_.deletions=null):(ft=Pg(mt,wt),ft.subtreeFlags=mt.subtreeFlags&14680064),bt!==null?pt=Pg(bt,pt):(pt=Tg(pt,gt,lt,null),pt.flags|=2),pt.return=_,ft.return=_,ft.sibling=pt,_.child=ft,ft=pt,pt=_.child,gt=it.child.memoizedState,gt=gt===null?nj(lt):{baseLanes:gt.baseLanes|lt,cachePool:null,transitions:gt.transitions},pt.memoizedState=gt,pt.childLanes=it.childLanes&~lt,_.memoizedState=mj,ft}return pt=it.child,it=pt.sibling,ft=Pg(pt,{mode:"visible",children:ft.children}),!(_.mode&1)&&(ft.lanes=lt),ft.return=_,ft.sibling=null,it!==null&&(lt=_.deletions,lt===null?(_.deletions=[it],_.flags|=16):lt.push(it)),_.child=ft,_.memoizedState=null,ft}function qj(it,_){return _=pj({mode:"visible",children:_},it.mode,0,null),_.return=it,it.child=_}function sj(it,_,lt,ft){return ft!==null&&Jg(ft),Ug(_,it.child,null,lt),it=qj(_,_.pendingProps.children),it.flags|=2,_.memoizedState=null,it}function rj(it,_,lt,ft,mt,pt,gt){if(lt)return _.flags&256?(_.flags&=-257,ft=Ki(Error(p$1(422))),sj(it,_,gt,ft)):_.memoizedState!==null?(_.child=it.child,_.flags|=128,null):(pt=ft.fallback,mt=_.mode,ft=pj({mode:"visible",children:ft.children},mt,0,null),pt=Tg(pt,mt,gt,null),pt.flags|=2,ft.return=_,pt.return=_,ft.sibling=pt,_.child=ft,_.mode&1&&Ug(_,it.child,null,gt),_.child.memoizedState=nj(gt),_.memoizedState=mj,pt);if(!(_.mode&1))return sj(it,_,gt,null);if(mt.data==="$!"){if(ft=mt.nextSibling&&mt.nextSibling.dataset,ft)var bt=ft.dgst;return ft=bt,pt=Error(p$1(419)),ft=Ki(pt,ft,void 0),sj(it,_,gt,ft)}if(bt=(gt&it.childLanes)!==0,dh||bt){if(ft=Q,ft!==null){switch(gt&-gt){case 4:mt=2;break;case 16:mt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:mt=32;break;case 536870912:mt=268435456;break;default:mt=0}mt=mt&(ft.suspendedLanes|gt)?0:mt,mt!==0&&mt!==pt.retryLane&&(pt.retryLane=mt,ih(it,mt),gi(ft,it,mt,-1))}return tj(),ft=Ki(Error(p$1(421))),sj(it,_,gt,ft)}return mt.data==="$?"?(_.flags|=128,_.child=it.child,_=uj.bind(null,it),mt._reactRetry=_,null):(it=pt.treeContext,yg=Lf(mt.nextSibling),xg=_,I=!0,zg=null,it!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=it.id,sg=it.overflow,qg=_),_=qj(_,ft.children),_.flags|=4096,_)}function vj(it,_,lt){it.lanes|=_;var ft=it.alternate;ft!==null&&(ft.lanes|=_),bh(it.return,_,lt)}function wj(it,_,lt,ft,mt){var pt=it.memoizedState;pt===null?it.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:ft,tail:lt,tailMode:mt}:(pt.isBackwards=_,pt.rendering=null,pt.renderingStartTime=0,pt.last=ft,pt.tail=lt,pt.tailMode=mt)}function xj(it,_,lt){var ft=_.pendingProps,mt=ft.revealOrder,pt=ft.tail;if(Xi(it,_,ft.children,lt),ft=L.current,ft&2)ft=ft&1|2,_.flags|=128;else{if(it!==null&&it.flags&128)e:for(it=_.child;it!==null;){if(it.tag===13)it.memoizedState!==null&&vj(it,lt,_);else if(it.tag===19)vj(it,lt,_);else if(it.child!==null){it.child.return=it,it=it.child;continue}if(it===_)break e;for(;it.sibling===null;){if(it.return===null||it.return===_)break e;it=it.return}it.sibling.return=it.return,it=it.sibling}ft&=1}if(G(L,ft),!(_.mode&1))_.memoizedState=null;else switch(mt){case"forwards":for(lt=_.child,mt=null;lt!==null;)it=lt.alternate,it!==null&&Ch(it)===null&&(mt=lt),lt=lt.sibling;lt=mt,lt===null?(mt=_.child,_.child=null):(mt=lt.sibling,lt.sibling=null),wj(_,!1,mt,lt,pt);break;case"backwards":for(lt=null,mt=_.child,_.child=null;mt!==null;){if(it=mt.alternate,it!==null&&Ch(it)===null){_.child=mt;break}it=mt.sibling,mt.sibling=lt,lt=mt,mt=it}wj(_,!0,lt,null,pt);break;case"together":wj(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function ij(it,_){!(_.mode&1)&&it!==null&&(it.alternate=null,_.alternate=null,_.flags|=2)}function Zi(it,_,lt){if(it!==null&&(_.dependencies=it.dependencies),rh|=_.lanes,!(lt&_.childLanes))return null;if(it!==null&&_.child!==it.child)throw Error(p$1(153));if(_.child!==null){for(it=_.child,lt=Pg(it,it.pendingProps),_.child=lt,lt.return=_;it.sibling!==null;)it=it.sibling,lt=lt.sibling=Pg(it,it.pendingProps),lt.return=_;lt.sibling=null}return _.child}function yj(it,_,lt){switch(_.tag){case 3:kj(_),Ig();break;case 5:Ah(_);break;case 1:Zf(_.type)&&cg(_);break;case 4:yh(_,_.stateNode.containerInfo);break;case 10:var ft=_.type._context,mt=_.memoizedProps.value;G(Wg,ft._currentValue),ft._currentValue=mt;break;case 13:if(ft=_.memoizedState,ft!==null)return ft.dehydrated!==null?(G(L,L.current&1),_.flags|=128,null):lt&_.child.childLanes?oj(it,_,lt):(G(L,L.current&1),it=Zi(it,_,lt),it!==null?it.sibling:null);G(L,L.current&1);break;case 19:if(ft=(lt&_.childLanes)!==0,it.flags&128){if(ft)return xj(it,_,lt);_.flags|=128}if(mt=_.memoizedState,mt!==null&&(mt.rendering=null,mt.tail=null,mt.lastEffect=null),G(L,L.current),ft)break;return null;case 22:case 23:return _.lanes=0,dj(it,_,lt)}return Zi(it,_,lt)}var zj,Aj,Bj,Cj;zj=function(it,_){for(var lt=_.child;lt!==null;){if(lt.tag===5||lt.tag===6)it.appendChild(lt.stateNode);else if(lt.tag!==4&&lt.child!==null){lt.child.return=lt,lt=lt.child;continue}if(lt===_)break;for(;lt.sibling===null;){if(lt.return===null||lt.return===_)return;lt=lt.return}lt.sibling.return=lt.return,lt=lt.sibling}};Aj=function(){};Bj=function(it,_,lt,ft){var mt=it.memoizedProps;if(mt!==ft){it=_.stateNode,xh(uh.current);var pt=null;switch(lt){case"input":mt=Ya(it,mt),ft=Ya(it,ft),pt=[];break;case"select":mt=A({},mt,{value:void 0}),ft=A({},ft,{value:void 0}),pt=[];break;case"textarea":mt=gb(it,mt),ft=gb(it,ft),pt=[];break;default:typeof mt.onClick!="function"&&typeof ft.onClick=="function"&&(it.onclick=Bf)}ub(lt,ft);var gt;lt=null;for(vt in mt)if(!ft.hasOwnProperty(vt)&&mt.hasOwnProperty(vt)&&mt[vt]!=null)if(vt==="style"){var bt=mt[vt];for(gt in bt)bt.hasOwnProperty(gt)&&(lt||(lt={}),lt[gt]="")}else vt!=="dangerouslySetInnerHTML"&&vt!=="children"&&vt!=="suppressContentEditableWarning"&&vt!=="suppressHydrationWarning"&&vt!=="autoFocus"&&(ea.hasOwnProperty(vt)?pt||(pt=[]):(pt=pt||[]).push(vt,null));for(vt in ft){var wt=ft[vt];if(bt=mt!=null?mt[vt]:void 0,ft.hasOwnProperty(vt)&&wt!==bt&&(wt!=null||bt!=null))if(vt==="style")if(bt){for(gt in bt)!bt.hasOwnProperty(gt)||wt&&wt.hasOwnProperty(gt)||(lt||(lt={}),lt[gt]="");for(gt in wt)wt.hasOwnProperty(gt)&&bt[gt]!==wt[gt]&&(lt||(lt={}),lt[gt]=wt[gt])}else lt||(pt||(pt=[]),pt.push(vt,lt)),lt=wt;else vt==="dangerouslySetInnerHTML"?(wt=wt?wt.__html:void 0,bt=bt?bt.__html:void 0,wt!=null&&bt!==wt&&(pt=pt||[]).push(vt,wt)):vt==="children"?typeof wt!="string"&&typeof wt!="number"||(pt=pt||[]).push(vt,""+wt):vt!=="suppressContentEditableWarning"&&vt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(vt)?(wt!=null&&vt==="onScroll"&&D("scroll",it),pt||bt===wt||(pt=[])):(pt=pt||[]).push(vt,wt))}lt&&(pt=pt||[]).push("style",lt);var vt=pt;(_.updateQueue=vt)&&(_.flags|=4)}};Cj=function(it,_,lt,ft){lt!==ft&&(_.flags|=4)};function Dj(it,_){if(!I)switch(it.tailMode){case"hidden":_=it.tail;for(var lt=null;_!==null;)_.alternate!==null&&(lt=_),_=_.sibling;lt===null?it.tail=null:lt.sibling=null;break;case"collapsed":lt=it.tail;for(var ft=null;lt!==null;)lt.alternate!==null&&(ft=lt),lt=lt.sibling;ft===null?_||it.tail===null?it.tail=null:it.tail.sibling=null:ft.sibling=null}}function S$1(it){var _=it.alternate!==null&&it.alternate.child===it.child,lt=0,ft=0;if(_)for(var mt=it.child;mt!==null;)lt|=mt.lanes|mt.childLanes,ft|=mt.subtreeFlags&14680064,ft|=mt.flags&14680064,mt.return=it,mt=mt.sibling;else for(mt=it.child;mt!==null;)lt|=mt.lanes|mt.childLanes,ft|=mt.subtreeFlags,ft|=mt.flags,mt.return=it,mt=mt.sibling;return it.subtreeFlags|=ft,it.childLanes=lt,_}function Ej(it,_,lt){var ft=_.pendingProps;switch(wg(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(_),null;case 1:return Zf(_.type)&&$f(),S$1(_),null;case 3:return ft=_.stateNode,zh(),E(Wf),E(H$1),Eh(),ft.pendingContext&&(ft.context=ft.pendingContext,ft.pendingContext=null),(it===null||it.child===null)&&(Gg(_)?_.flags|=4:it===null||it.memoizedState.isDehydrated&&!(_.flags&256)||(_.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(it,_),S$1(_),null;case 5:Bh(_);var mt=xh(wh.current);if(lt=_.type,it!==null&&_.stateNode!=null)Bj(it,_,lt,ft,mt),it.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!ft){if(_.stateNode===null)throw Error(p$1(166));return S$1(_),null}if(it=xh(uh.current),Gg(_)){ft=_.stateNode,lt=_.type;var pt=_.memoizedProps;switch(ft[Of]=_,ft[Pf]=pt,it=(_.mode&1)!==0,lt){case"dialog":D("cancel",ft),D("close",ft);break;case"iframe":case"object":case"embed":D("load",ft);break;case"video":case"audio":for(mt=0;mt<lf.length;mt++)D(lf[mt],ft);break;case"source":D("error",ft);break;case"img":case"image":case"link":D("error",ft),D("load",ft);break;case"details":D("toggle",ft);break;case"input":Za(ft,pt),D("invalid",ft);break;case"select":ft._wrapperState={wasMultiple:!!pt.multiple},D("invalid",ft);break;case"textarea":hb(ft,pt),D("invalid",ft)}ub(lt,pt),mt=null;for(var gt in pt)if(pt.hasOwnProperty(gt)){var bt=pt[gt];gt==="children"?typeof bt=="string"?ft.textContent!==bt&&(pt.suppressHydrationWarning!==!0&&Af(ft.textContent,bt,it),mt=["children",bt]):typeof bt=="number"&&ft.textContent!==""+bt&&(pt.suppressHydrationWarning!==!0&&Af(ft.textContent,bt,it),mt=["children",""+bt]):ea.hasOwnProperty(gt)&&bt!=null&&gt==="onScroll"&&D("scroll",ft)}switch(lt){case"input":Va(ft),db(ft,pt,!0);break;case"textarea":Va(ft),jb(ft);break;case"select":case"option":break;default:typeof pt.onClick=="function"&&(ft.onclick=Bf)}ft=mt,_.updateQueue=ft,ft!==null&&(_.flags|=4)}else{gt=mt.nodeType===9?mt:mt.ownerDocument,it==="http://www.w3.org/1999/xhtml"&&(it=kb(lt)),it==="http://www.w3.org/1999/xhtml"?lt==="script"?(it=gt.createElement("div"),it.innerHTML="<script><\/script>",it=it.removeChild(it.firstChild)):typeof ft.is=="string"?it=gt.createElement(lt,{is:ft.is}):(it=gt.createElement(lt),lt==="select"&&(gt=it,ft.multiple?gt.multiple=!0:ft.size&&(gt.size=ft.size))):it=gt.createElementNS(it,lt),it[Of]=_,it[Pf]=ft,zj(it,_,!1,!1),_.stateNode=it;e:{switch(gt=vb(lt,ft),lt){case"dialog":D("cancel",it),D("close",it),mt=ft;break;case"iframe":case"object":case"embed":D("load",it),mt=ft;break;case"video":case"audio":for(mt=0;mt<lf.length;mt++)D(lf[mt],it);mt=ft;break;case"source":D("error",it),mt=ft;break;case"img":case"image":case"link":D("error",it),D("load",it),mt=ft;break;case"details":D("toggle",it),mt=ft;break;case"input":Za(it,ft),mt=Ya(it,ft),D("invalid",it);break;case"option":mt=ft;break;case"select":it._wrapperState={wasMultiple:!!ft.multiple},mt=A({},ft,{value:void 0}),D("invalid",it);break;case"textarea":hb(it,ft),mt=gb(it,ft),D("invalid",it);break;default:mt=ft}ub(lt,mt),bt=mt;for(pt in bt)if(bt.hasOwnProperty(pt)){var wt=bt[pt];pt==="style"?sb(it,wt):pt==="dangerouslySetInnerHTML"?(wt=wt?wt.__html:void 0,wt!=null&&nb(it,wt)):pt==="children"?typeof wt=="string"?(lt!=="textarea"||wt!=="")&&ob(it,wt):typeof wt=="number"&&ob(it,""+wt):pt!=="suppressContentEditableWarning"&&pt!=="suppressHydrationWarning"&&pt!=="autoFocus"&&(ea.hasOwnProperty(pt)?wt!=null&&pt==="onScroll"&&D("scroll",it):wt!=null&&ta(it,pt,wt,gt))}switch(lt){case"input":Va(it),db(it,ft,!1);break;case"textarea":Va(it),jb(it);break;case"option":ft.value!=null&&it.setAttribute("value",""+Sa(ft.value));break;case"select":it.multiple=!!ft.multiple,pt=ft.value,pt!=null?fb(it,!!ft.multiple,pt,!1):ft.defaultValue!=null&&fb(it,!!ft.multiple,ft.defaultValue,!0);break;default:typeof mt.onClick=="function"&&(it.onclick=Bf)}switch(lt){case"button":case"input":case"select":case"textarea":ft=!!ft.autoFocus;break e;case"img":ft=!0;break e;default:ft=!1}}ft&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return S$1(_),null;case 6:if(it&&_.stateNode!=null)Cj(it,_,it.memoizedProps,ft);else{if(typeof ft!="string"&&_.stateNode===null)throw Error(p$1(166));if(lt=xh(wh.current),xh(uh.current),Gg(_)){if(ft=_.stateNode,lt=_.memoizedProps,ft[Of]=_,(pt=ft.nodeValue!==lt)&&(it=xg,it!==null))switch(it.tag){case 3:Af(ft.nodeValue,lt,(it.mode&1)!==0);break;case 5:it.memoizedProps.suppressHydrationWarning!==!0&&Af(ft.nodeValue,lt,(it.mode&1)!==0)}pt&&(_.flags|=4)}else ft=(lt.nodeType===9?lt:lt.ownerDocument).createTextNode(ft),ft[Of]=_,_.stateNode=ft}return S$1(_),null;case 13:if(E(L),ft=_.memoizedState,it===null||it.memoizedState!==null&&it.memoizedState.dehydrated!==null){if(I&&yg!==null&&_.mode&1&&!(_.flags&128))Hg(),Ig(),_.flags|=98560,pt=!1;else if(pt=Gg(_),ft!==null&&ft.dehydrated!==null){if(it===null){if(!pt)throw Error(p$1(318));if(pt=_.memoizedState,pt=pt!==null?pt.dehydrated:null,!pt)throw Error(p$1(317));pt[Of]=_}else Ig(),!(_.flags&128)&&(_.memoizedState=null),_.flags|=4;S$1(_),pt=!1}else zg!==null&&(Fj(zg),zg=null),pt=!0;if(!pt)return _.flags&65536?_:null}return _.flags&128?(_.lanes=lt,_):(ft=ft!==null,ft!==(it!==null&&it.memoizedState!==null)&&ft&&(_.child.flags|=8192,_.mode&1&&(it===null||L.current&1?T===0&&(T=3):tj())),_.updateQueue!==null&&(_.flags|=4),S$1(_),null);case 4:return zh(),Aj(it,_),it===null&&sf(_.stateNode.containerInfo),S$1(_),null;case 10:return ah(_.type._context),S$1(_),null;case 17:return Zf(_.type)&&$f(),S$1(_),null;case 19:if(E(L),pt=_.memoizedState,pt===null)return S$1(_),null;if(ft=(_.flags&128)!==0,gt=pt.rendering,gt===null)if(ft)Dj(pt,!1);else{if(T!==0||it!==null&&it.flags&128)for(it=_.child;it!==null;){if(gt=Ch(it),gt!==null){for(_.flags|=128,Dj(pt,!1),ft=gt.updateQueue,ft!==null&&(_.updateQueue=ft,_.flags|=4),_.subtreeFlags=0,ft=lt,lt=_.child;lt!==null;)pt=lt,it=ft,pt.flags&=14680066,gt=pt.alternate,gt===null?(pt.childLanes=0,pt.lanes=it,pt.child=null,pt.subtreeFlags=0,pt.memoizedProps=null,pt.memoizedState=null,pt.updateQueue=null,pt.dependencies=null,pt.stateNode=null):(pt.childLanes=gt.childLanes,pt.lanes=gt.lanes,pt.child=gt.child,pt.subtreeFlags=0,pt.deletions=null,pt.memoizedProps=gt.memoizedProps,pt.memoizedState=gt.memoizedState,pt.updateQueue=gt.updateQueue,pt.type=gt.type,it=gt.dependencies,pt.dependencies=it===null?null:{lanes:it.lanes,firstContext:it.firstContext}),lt=lt.sibling;return G(L,L.current&1|2),_.child}it=it.sibling}pt.tail!==null&&B()>Gj&&(_.flags|=128,ft=!0,Dj(pt,!1),_.lanes=4194304)}else{if(!ft)if(it=Ch(gt),it!==null){if(_.flags|=128,ft=!0,lt=it.updateQueue,lt!==null&&(_.updateQueue=lt,_.flags|=4),Dj(pt,!0),pt.tail===null&&pt.tailMode==="hidden"&&!gt.alternate&&!I)return S$1(_),null}else 2*B()-pt.renderingStartTime>Gj&&lt!==1073741824&&(_.flags|=128,ft=!0,Dj(pt,!1),_.lanes=4194304);pt.isBackwards?(gt.sibling=_.child,_.child=gt):(lt=pt.last,lt!==null?lt.sibling=gt:_.child=gt,pt.last=gt)}return pt.tail!==null?(_=pt.tail,pt.rendering=_,pt.tail=_.sibling,pt.renderingStartTime=B(),_.sibling=null,lt=L.current,G(L,ft?lt&1|2:lt&1),_):(S$1(_),null);case 22:case 23:return Hj(),ft=_.memoizedState!==null,it!==null&&it.memoizedState!==null!==ft&&(_.flags|=8192),ft&&_.mode&1?fj&1073741824&&(S$1(_),_.subtreeFlags&6&&(_.flags|=8192)):S$1(_),null;case 24:return null;case 25:return null}throw Error(p$1(156,_.tag))}function Ij(it,_){switch(wg(_),_.tag){case 1:return Zf(_.type)&&$f(),it=_.flags,it&65536?(_.flags=it&-65537|128,_):null;case 3:return zh(),E(Wf),E(H$1),Eh(),it=_.flags,it&65536&&!(it&128)?(_.flags=it&-65537|128,_):null;case 5:return Bh(_),null;case 13:if(E(L),it=_.memoizedState,it!==null&&it.dehydrated!==null){if(_.alternate===null)throw Error(p$1(340));Ig()}return it=_.flags,it&65536?(_.flags=it&-65537|128,_):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(_.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(it,_){var lt=it.ref;if(lt!==null)if(typeof lt=="function")try{lt(null)}catch(ft){W(it,_,ft)}else lt.current=null}function Mj(it,_,lt){try{lt()}catch(ft){W(it,_,ft)}}var Nj=!1;function Oj(it,_){if(Cf=dd,it=Me(),Ne(it)){if("selectionStart"in it)var lt={start:it.selectionStart,end:it.selectionEnd};else e:{lt=(lt=it.ownerDocument)&&lt.defaultView||window;var ft=lt.getSelection&&lt.getSelection();if(ft&&ft.rangeCount!==0){lt=ft.anchorNode;var mt=ft.anchorOffset,pt=ft.focusNode;ft=ft.focusOffset;try{lt.nodeType,pt.nodeType}catch{lt=null;break e}var gt=0,bt=-1,wt=-1,vt=0,Ct=0,Rt=it,Mt=null;t:for(;;){for(var Ot;Rt!==lt||mt!==0&&Rt.nodeType!==3||(bt=gt+mt),Rt!==pt||ft!==0&&Rt.nodeType!==3||(wt=gt+ft),Rt.nodeType===3&&(gt+=Rt.nodeValue.length),(Ot=Rt.firstChild)!==null;)Mt=Rt,Rt=Ot;for(;;){if(Rt===it)break t;if(Mt===lt&&++vt===mt&&(bt=gt),Mt===pt&&++Ct===ft&&(wt=gt),(Ot=Rt.nextSibling)!==null)break;Rt=Mt,Mt=Rt.parentNode}Rt=Ot}lt=bt===-1||wt===-1?null:{start:bt,end:wt}}else lt=null}lt=lt||{start:0,end:0}}else lt=null;for(Df={focusedElem:it,selectionRange:lt},dd=!1,V=_;V!==null;)if(_=V,it=_.child,(_.subtreeFlags&1028)!==0&&it!==null)it.return=_,V=it;else for(;V!==null;){_=V;try{var Nt=_.alternate;if(_.flags&1024)switch(_.tag){case 0:case 11:case 15:break;case 1:if(Nt!==null){var Ht=Nt.memoizedProps,Kt=Nt.memoizedState,hr=_.stateNode,Qt=hr.getSnapshotBeforeUpdate(_.elementType===_.type?Ht:Ci(_.type,Ht),Kt);hr.__reactInternalSnapshotBeforeUpdate=Qt}break;case 3:var mr=_.stateNode.containerInfo;mr.nodeType===1?mr.textContent="":mr.nodeType===9&&mr.documentElement&&mr.removeChild(mr.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(br){W(_,_.return,br)}if(it=_.sibling,it!==null){it.return=_.return,V=it;break}V=_.return}return Nt=Nj,Nj=!1,Nt}function Pj(it,_,lt){var ft=_.updateQueue;if(ft=ft!==null?ft.lastEffect:null,ft!==null){var mt=ft=ft.next;do{if((mt.tag&it)===it){var pt=mt.destroy;mt.destroy=void 0,pt!==void 0&&Mj(_,lt,pt)}mt=mt.next}while(mt!==ft)}}function Qj(it,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var lt=_=_.next;do{if((lt.tag&it)===it){var ft=lt.create;lt.destroy=ft()}lt=lt.next}while(lt!==_)}}function Rj(it){var _=it.ref;if(_!==null){var lt=it.stateNode;switch(it.tag){case 5:it=lt;break;default:it=lt}typeof _=="function"?_(it):_.current=it}}function Sj(it){var _=it.alternate;_!==null&&(it.alternate=null,Sj(_)),it.child=null,it.deletions=null,it.sibling=null,it.tag===5&&(_=it.stateNode,_!==null&&(delete _[Of],delete _[Pf],delete _[of],delete _[Qf],delete _[Rf])),it.stateNode=null,it.return=null,it.dependencies=null,it.memoizedProps=null,it.memoizedState=null,it.pendingProps=null,it.stateNode=null,it.updateQueue=null}function Tj(it){return it.tag===5||it.tag===3||it.tag===4}function Uj(it){e:for(;;){for(;it.sibling===null;){if(it.return===null||Tj(it.return))return null;it=it.return}for(it.sibling.return=it.return,it=it.sibling;it.tag!==5&&it.tag!==6&&it.tag!==18;){if(it.flags&2||it.child===null||it.tag===4)continue e;it.child.return=it,it=it.child}if(!(it.flags&2))return it.stateNode}}function Vj(it,_,lt){var ft=it.tag;if(ft===5||ft===6)it=it.stateNode,_?lt.nodeType===8?lt.parentNode.insertBefore(it,_):lt.insertBefore(it,_):(lt.nodeType===8?(_=lt.parentNode,_.insertBefore(it,lt)):(_=lt,_.appendChild(it)),lt=lt._reactRootContainer,lt!=null||_.onclick!==null||(_.onclick=Bf));else if(ft!==4&&(it=it.child,it!==null))for(Vj(it,_,lt),it=it.sibling;it!==null;)Vj(it,_,lt),it=it.sibling}function Wj(it,_,lt){var ft=it.tag;if(ft===5||ft===6)it=it.stateNode,_?lt.insertBefore(it,_):lt.appendChild(it);else if(ft!==4&&(it=it.child,it!==null))for(Wj(it,_,lt),it=it.sibling;it!==null;)Wj(it,_,lt),it=it.sibling}var X=null,Xj=!1;function Yj(it,_,lt){for(lt=lt.child;lt!==null;)Zj(it,_,lt),lt=lt.sibling}function Zj(it,_,lt){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,lt)}catch{}switch(lt.tag){case 5:U||Lj(lt,_);case 6:var ft=X,mt=Xj;X=null,Yj(it,_,lt),X=ft,Xj=mt,X!==null&&(Xj?(it=X,lt=lt.stateNode,it.nodeType===8?it.parentNode.removeChild(lt):it.removeChild(lt)):X.removeChild(lt.stateNode));break;case 18:X!==null&&(Xj?(it=X,lt=lt.stateNode,it.nodeType===8?Kf(it.parentNode,lt):it.nodeType===1&&Kf(it,lt),bd(it)):Kf(X,lt.stateNode));break;case 4:ft=X,mt=Xj,X=lt.stateNode.containerInfo,Xj=!0,Yj(it,_,lt),X=ft,Xj=mt;break;case 0:case 11:case 14:case 15:if(!U&&(ft=lt.updateQueue,ft!==null&&(ft=ft.lastEffect,ft!==null))){mt=ft=ft.next;do{var pt=mt,gt=pt.destroy;pt=pt.tag,gt!==void 0&&(pt&2||pt&4)&&Mj(lt,_,gt),mt=mt.next}while(mt!==ft)}Yj(it,_,lt);break;case 1:if(!U&&(Lj(lt,_),ft=lt.stateNode,typeof ft.componentWillUnmount=="function"))try{ft.props=lt.memoizedProps,ft.state=lt.memoizedState,ft.componentWillUnmount()}catch(bt){W(lt,_,bt)}Yj(it,_,lt);break;case 21:Yj(it,_,lt);break;case 22:lt.mode&1?(U=(ft=U)||lt.memoizedState!==null,Yj(it,_,lt),U=ft):Yj(it,_,lt);break;default:Yj(it,_,lt)}}function ak(it){var _=it.updateQueue;if(_!==null){it.updateQueue=null;var lt=it.stateNode;lt===null&&(lt=it.stateNode=new Kj),_.forEach(function(ft){var mt=bk.bind(null,it,ft);lt.has(ft)||(lt.add(ft),ft.then(mt,mt))})}}function ck(it,_){var lt=_.deletions;if(lt!==null)for(var ft=0;ft<lt.length;ft++){var mt=lt[ft];try{var pt=it,gt=_,bt=gt;e:for(;bt!==null;){switch(bt.tag){case 5:X=bt.stateNode,Xj=!1;break e;case 3:X=bt.stateNode.containerInfo,Xj=!0;break e;case 4:X=bt.stateNode.containerInfo,Xj=!0;break e}bt=bt.return}if(X===null)throw Error(p$1(160));Zj(pt,gt,mt),X=null,Xj=!1;var wt=mt.alternate;wt!==null&&(wt.return=null),mt.return=null}catch(vt){W(mt,_,vt)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)dk(_,it),_=_.sibling}function dk(it,_){var lt=it.alternate,ft=it.flags;switch(it.tag){case 0:case 11:case 14:case 15:if(ck(_,it),ek(it),ft&4){try{Pj(3,it,it.return),Qj(3,it)}catch(Ht){W(it,it.return,Ht)}try{Pj(5,it,it.return)}catch(Ht){W(it,it.return,Ht)}}break;case 1:ck(_,it),ek(it),ft&512&&lt!==null&&Lj(lt,lt.return);break;case 5:if(ck(_,it),ek(it),ft&512&&lt!==null&&Lj(lt,lt.return),it.flags&32){var mt=it.stateNode;try{ob(mt,"")}catch(Ht){W(it,it.return,Ht)}}if(ft&4&&(mt=it.stateNode,mt!=null)){var pt=it.memoizedProps,gt=lt!==null?lt.memoizedProps:pt,bt=it.type,wt=it.updateQueue;if(it.updateQueue=null,wt!==null)try{bt==="input"&&pt.type==="radio"&&pt.name!=null&&ab(mt,pt),vb(bt,gt);var vt=vb(bt,pt);for(gt=0;gt<wt.length;gt+=2){var Ct=wt[gt],Rt=wt[gt+1];Ct==="style"?sb(mt,Rt):Ct==="dangerouslySetInnerHTML"?nb(mt,Rt):Ct==="children"?ob(mt,Rt):ta(mt,Ct,Rt,vt)}switch(bt){case"input":bb(mt,pt);break;case"textarea":ib(mt,pt);break;case"select":var Mt=mt._wrapperState.wasMultiple;mt._wrapperState.wasMultiple=!!pt.multiple;var Ot=pt.value;Ot!=null?fb(mt,!!pt.multiple,Ot,!1):Mt!==!!pt.multiple&&(pt.defaultValue!=null?fb(mt,!!pt.multiple,pt.defaultValue,!0):fb(mt,!!pt.multiple,pt.multiple?[]:"",!1))}mt[Pf]=pt}catch(Ht){W(it,it.return,Ht)}}break;case 6:if(ck(_,it),ek(it),ft&4){if(it.stateNode===null)throw Error(p$1(162));mt=it.stateNode,pt=it.memoizedProps;try{mt.nodeValue=pt}catch(Ht){W(it,it.return,Ht)}}break;case 3:if(ck(_,it),ek(it),ft&4&&lt!==null&&lt.memoizedState.isDehydrated)try{bd(_.containerInfo)}catch(Ht){W(it,it.return,Ht)}break;case 4:ck(_,it),ek(it);break;case 13:ck(_,it),ek(it),mt=it.child,mt.flags&8192&&(pt=mt.memoizedState!==null,mt.stateNode.isHidden=pt,!pt||mt.alternate!==null&&mt.alternate.memoizedState!==null||(fk=B())),ft&4&&ak(it);break;case 22:if(Ct=lt!==null&&lt.memoizedState!==null,it.mode&1?(U=(vt=U)||Ct,ck(_,it),U=vt):ck(_,it),ek(it),ft&8192){if(vt=it.memoizedState!==null,(it.stateNode.isHidden=vt)&&!Ct&&it.mode&1)for(V=it,Ct=it.child;Ct!==null;){for(Rt=V=Ct;V!==null;){switch(Mt=V,Ot=Mt.child,Mt.tag){case 0:case 11:case 14:case 15:Pj(4,Mt,Mt.return);break;case 1:Lj(Mt,Mt.return);var Nt=Mt.stateNode;if(typeof Nt.componentWillUnmount=="function"){ft=Mt,lt=Mt.return;try{_=ft,Nt.props=_.memoizedProps,Nt.state=_.memoizedState,Nt.componentWillUnmount()}catch(Ht){W(ft,lt,Ht)}}break;case 5:Lj(Mt,Mt.return);break;case 22:if(Mt.memoizedState!==null){gk(Rt);continue}}Ot!==null?(Ot.return=Mt,V=Ot):gk(Rt)}Ct=Ct.sibling}e:for(Ct=null,Rt=it;;){if(Rt.tag===5){if(Ct===null){Ct=Rt;try{mt=Rt.stateNode,vt?(pt=mt.style,typeof pt.setProperty=="function"?pt.setProperty("display","none","important"):pt.display="none"):(bt=Rt.stateNode,wt=Rt.memoizedProps.style,gt=wt!=null&&wt.hasOwnProperty("display")?wt.display:null,bt.style.display=rb("display",gt))}catch(Ht){W(it,it.return,Ht)}}}else if(Rt.tag===6){if(Ct===null)try{Rt.stateNode.nodeValue=vt?"":Rt.memoizedProps}catch(Ht){W(it,it.return,Ht)}}else if((Rt.tag!==22&&Rt.tag!==23||Rt.memoizedState===null||Rt===it)&&Rt.child!==null){Rt.child.return=Rt,Rt=Rt.child;continue}if(Rt===it)break e;for(;Rt.sibling===null;){if(Rt.return===null||Rt.return===it)break e;Ct===Rt&&(Ct=null),Rt=Rt.return}Ct===Rt&&(Ct=null),Rt.sibling.return=Rt.return,Rt=Rt.sibling}}break;case 19:ck(_,it),ek(it),ft&4&&ak(it);break;case 21:break;default:ck(_,it),ek(it)}}function ek(it){var _=it.flags;if(_&2){try{e:{for(var lt=it.return;lt!==null;){if(Tj(lt)){var ft=lt;break e}lt=lt.return}throw Error(p$1(160))}switch(ft.tag){case 5:var mt=ft.stateNode;ft.flags&32&&(ob(mt,""),ft.flags&=-33);var pt=Uj(it);Wj(it,pt,mt);break;case 3:case 4:var gt=ft.stateNode.containerInfo,bt=Uj(it);Vj(it,bt,gt);break;default:throw Error(p$1(161))}}catch(wt){W(it,it.return,wt)}it.flags&=-3}_&4096&&(it.flags&=-4097)}function hk(it,_,lt){V=it,ik(it)}function ik(it,_,lt){for(var ft=(it.mode&1)!==0;V!==null;){var mt=V,pt=mt.child;if(mt.tag===22&&ft){var gt=mt.memoizedState!==null||Jj;if(!gt){var bt=mt.alternate,wt=bt!==null&&bt.memoizedState!==null||U;bt=Jj;var vt=U;if(Jj=gt,(U=wt)&&!vt)for(V=mt;V!==null;)gt=V,wt=gt.child,gt.tag===22&&gt.memoizedState!==null?jk(mt):wt!==null?(wt.return=gt,V=wt):jk(mt);for(;pt!==null;)V=pt,ik(pt),pt=pt.sibling;V=mt,Jj=bt,U=vt}kk(it)}else mt.subtreeFlags&8772&&pt!==null?(pt.return=mt,V=pt):kk(it)}}function kk(it){for(;V!==null;){var _=V;if(_.flags&8772){var lt=_.alternate;try{if(_.flags&8772)switch(_.tag){case 0:case 11:case 15:U||Qj(5,_);break;case 1:var ft=_.stateNode;if(_.flags&4&&!U)if(lt===null)ft.componentDidMount();else{var mt=_.elementType===_.type?lt.memoizedProps:Ci(_.type,lt.memoizedProps);ft.componentDidUpdate(mt,lt.memoizedState,ft.__reactInternalSnapshotBeforeUpdate)}var pt=_.updateQueue;pt!==null&&sh(_,pt,ft);break;case 3:var gt=_.updateQueue;if(gt!==null){if(lt=null,_.child!==null)switch(_.child.tag){case 5:lt=_.child.stateNode;break;case 1:lt=_.child.stateNode}sh(_,gt,lt)}break;case 5:var bt=_.stateNode;if(lt===null&&_.flags&4){lt=bt;var wt=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":wt.autoFocus&&lt.focus();break;case"img":wt.src&&(lt.src=wt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var vt=_.alternate;if(vt!==null){var Ct=vt.memoizedState;if(Ct!==null){var Rt=Ct.dehydrated;Rt!==null&&bd(Rt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U||_.flags&512&&Rj(_)}catch(Mt){W(_,_.return,Mt)}}if(_===it){V=null;break}if(lt=_.sibling,lt!==null){lt.return=_.return,V=lt;break}V=_.return}}function gk(it){for(;V!==null;){var _=V;if(_===it){V=null;break}var lt=_.sibling;if(lt!==null){lt.return=_.return,V=lt;break}V=_.return}}function jk(it){for(;V!==null;){var _=V;try{switch(_.tag){case 0:case 11:case 15:var lt=_.return;try{Qj(4,_)}catch(wt){W(_,lt,wt)}break;case 1:var ft=_.stateNode;if(typeof ft.componentDidMount=="function"){var mt=_.return;try{ft.componentDidMount()}catch(wt){W(_,mt,wt)}}var pt=_.return;try{Rj(_)}catch(wt){W(_,pt,wt)}break;case 5:var gt=_.return;try{Rj(_)}catch(wt){W(_,gt,wt)}}}catch(wt){W(_,_.return,wt)}if(_===it){V=null;break}var bt=_.sibling;if(bt!==null){bt.return=_.return,V=bt;break}V=_.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(it){return it.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(it=C,it!==0||(it=window.event,it=it===void 0?16:jd(it.type)),it):1}function gi(it,_,lt,ft){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(it,lt,ft),(!(K&2)||it!==Q)&&(it===Q&&(!(K&2)&&(qk|=lt),T===4&&Ck(it,Z)),Dk(it,ft),lt===1&&K===0&&!(_.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(it,_){var lt=it.callbackNode;wc(it,_);var ft=uc(it,it===Q?Z:0);if(ft===0)lt!==null&&bc(lt),it.callbackNode=null,it.callbackPriority=0;else if(_=ft&-ft,it.callbackPriority!==_){if(lt!=null&&bc(lt),_===1)it.tag===0?ig(Ek.bind(null,it)):hg(Ek.bind(null,it)),Jf(function(){!(K&6)&&jg()}),lt=null;else{switch(Dc(ft)){case 1:lt=fc;break;case 4:lt=gc;break;case 16:lt=hc;break;case 536870912:lt=jc;break;default:lt=hc}lt=Fk(lt,Gk.bind(null,it))}it.callbackPriority=_,it.callbackNode=lt}}function Gk(it,_){if(Ak=-1,Bk=0,K&6)throw Error(p$1(327));var lt=it.callbackNode;if(Hk()&&it.callbackNode!==lt)return null;var ft=uc(it,it===Q?Z:0);if(ft===0)return null;if(ft&30||ft&it.expiredLanes||_)_=Ik(it,ft);else{_=ft;var mt=K;K|=2;var pt=Jk();(Q!==it||Z!==_)&&(uk=null,Gj=B()+500,Kk(it,_));do try{Lk();break}catch(bt){Mk(it,bt)}while(!0);$g(),mk.current=pt,K=mt,Y!==null?_=0:(Q=null,Z=0,_=T)}if(_!==0){if(_===2&&(mt=xc(it),mt!==0&&(ft=mt,_=Nk(it,mt))),_===1)throw lt=pk,Kk(it,0),Ck(it,ft),Dk(it,B()),lt;if(_===6)Ck(it,ft);else{if(mt=it.current.alternate,!(ft&30)&&!Ok(mt)&&(_=Ik(it,ft),_===2&&(pt=xc(it),pt!==0&&(ft=pt,_=Nk(it,pt))),_===1))throw lt=pk,Kk(it,0),Ck(it,ft),Dk(it,B()),lt;switch(it.finishedWork=mt,it.finishedLanes=ft,_){case 0:case 1:throw Error(p$1(345));case 2:Pk(it,tk,uk);break;case 3:if(Ck(it,ft),(ft&130023424)===ft&&(_=fk+500-B(),10<_)){if(uc(it,0)!==0)break;if(mt=it.suspendedLanes,(mt&ft)!==ft){R(),it.pingedLanes|=it.suspendedLanes&mt;break}it.timeoutHandle=Ff(Pk.bind(null,it,tk,uk),_);break}Pk(it,tk,uk);break;case 4:if(Ck(it,ft),(ft&4194240)===ft)break;for(_=it.eventTimes,mt=-1;0<ft;){var gt=31-oc(ft);pt=1<<gt,gt=_[gt],gt>mt&&(mt=gt),ft&=~pt}if(ft=mt,ft=B()-ft,ft=(120>ft?120:480>ft?480:1080>ft?1080:1920>ft?1920:3e3>ft?3e3:4320>ft?4320:1960*lk(ft/1960))-ft,10<ft){it.timeoutHandle=Ff(Pk.bind(null,it,tk,uk),ft);break}Pk(it,tk,uk);break;case 5:Pk(it,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(it,B()),it.callbackNode===lt?Gk.bind(null,it):null}function Nk(it,_){var lt=sk;return it.current.memoizedState.isDehydrated&&(Kk(it,_).flags|=256),it=Ik(it,_),it!==2&&(_=tk,tk=lt,_!==null&&Fj(_)),it}function Fj(it){tk===null?tk=it:tk.push.apply(tk,it)}function Ok(it){for(var _=it;;){if(_.flags&16384){var lt=_.updateQueue;if(lt!==null&&(lt=lt.stores,lt!==null))for(var ft=0;ft<lt.length;ft++){var mt=lt[ft],pt=mt.getSnapshot;mt=mt.value;try{if(!He(pt(),mt))return!1}catch{return!1}}}if(lt=_.child,_.subtreeFlags&16384&&lt!==null)lt.return=_,_=lt;else{if(_===it)break;for(;_.sibling===null;){if(_.return===null||_.return===it)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Ck(it,_){for(_&=~rk,_&=~qk,it.suspendedLanes|=_,it.pingedLanes&=~_,it=it.expirationTimes;0<_;){var lt=31-oc(_),ft=1<<lt;it[lt]=-1,_&=~ft}}function Ek(it){if(K&6)throw Error(p$1(327));Hk();var _=uc(it,0);if(!(_&1))return Dk(it,B()),null;var lt=Ik(it,_);if(it.tag!==0&&lt===2){var ft=xc(it);ft!==0&&(_=ft,lt=Nk(it,ft))}if(lt===1)throw lt=pk,Kk(it,0),Ck(it,_),Dk(it,B()),lt;if(lt===6)throw Error(p$1(345));return it.finishedWork=it.current.alternate,it.finishedLanes=_,Pk(it,tk,uk),Dk(it,B()),null}function Qk(it,_){var lt=K;K|=1;try{return it(_)}finally{K=lt,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(it){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var _=K;K|=1;var lt=ok.transition,ft=C;try{if(ok.transition=null,C=1,it)return it()}finally{C=ft,ok.transition=lt,K=_,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(it,_){it.finishedWork=null,it.finishedLanes=0;var lt=it.timeoutHandle;if(lt!==-1&&(it.timeoutHandle=-1,Gf(lt)),Y!==null)for(lt=Y.return;lt!==null;){var ft=lt;switch(wg(ft),ft.tag){case 1:ft=ft.type.childContextTypes,ft!=null&&$f();break;case 3:zh(),E(Wf),E(H$1),Eh();break;case 5:Bh(ft);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(ft.type._context);break;case 22:case 23:Hj()}lt=lt.return}if(Q=it,Y=it=Pg(it.current,null),Z=fj=_,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(_=0;_<fh.length;_++)if(lt=fh[_],ft=lt.interleaved,ft!==null){lt.interleaved=null;var mt=ft.next,pt=lt.pending;if(pt!==null){var gt=pt.next;pt.next=mt,ft.next=gt}lt.pending=ft}fh=null}return it}function Mk(it,_){do{var lt=Y;try{if($g(),Fh.current=Rh,Ih){for(var ft=M$1.memoizedState;ft!==null;){var mt=ft.queue;mt!==null&&(mt.pending=null),ft=ft.next}Ih=!1}if(Hh=0,O=N$1=M$1=null,Jh=!1,Kh=0,nk.current=null,lt===null||lt.return===null){T=1,pk=_,Y=null;break}e:{var pt=it,gt=lt.return,bt=lt,wt=_;if(_=Z,bt.flags|=32768,wt!==null&&typeof wt=="object"&&typeof wt.then=="function"){var vt=wt,Ct=bt,Rt=Ct.tag;if(!(Ct.mode&1)&&(Rt===0||Rt===11||Rt===15)){var Mt=Ct.alternate;Mt?(Ct.updateQueue=Mt.updateQueue,Ct.memoizedState=Mt.memoizedState,Ct.lanes=Mt.lanes):(Ct.updateQueue=null,Ct.memoizedState=null)}var Ot=Ui(gt);if(Ot!==null){Ot.flags&=-257,Vi(Ot,gt,bt,pt,_),Ot.mode&1&&Si(pt,vt,_),_=Ot,wt=vt;var Nt=_.updateQueue;if(Nt===null){var Ht=new Set;Ht.add(wt),_.updateQueue=Ht}else Nt.add(wt);break e}else{if(!(_&1)){Si(pt,vt,_),tj();break e}wt=Error(p$1(426))}}else if(I&&bt.mode&1){var Kt=Ui(gt);if(Kt!==null){!(Kt.flags&65536)&&(Kt.flags|=256),Vi(Kt,gt,bt,pt,_),Jg(Ji(wt,bt));break e}}pt=wt=Ji(wt,bt),T!==4&&(T=2),sk===null?sk=[pt]:sk.push(pt),pt=gt;do{switch(pt.tag){case 3:pt.flags|=65536,_&=-_,pt.lanes|=_;var hr=Ni(pt,wt,_);ph(pt,hr);break e;case 1:bt=wt;var Qt=pt.type,mr=pt.stateNode;if(!(pt.flags&128)&&(typeof Qt.getDerivedStateFromError=="function"||mr!==null&&typeof mr.componentDidCatch=="function"&&(Ri===null||!Ri.has(mr)))){pt.flags|=65536,_&=-_,pt.lanes|=_;var br=Qi(pt,bt,_);ph(pt,br);break e}}pt=pt.return}while(pt!==null)}Sk(lt)}catch(Fr){_=Fr,Y===lt&&lt!==null&&(Y=lt=lt.return);continue}break}while(!0)}function Jk(){var it=mk.current;return mk.current=Rh,it===null?Rh:it}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(it,_){var lt=K;K|=2;var ft=Jk();(Q!==it||Z!==_)&&(uk=null,Kk(it,_));do try{Tk();break}catch(mt){Mk(it,mt)}while(!0);if($g(),K=lt,mk.current=ft,Y!==null)throw Error(p$1(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(it){var _=Vk(it.alternate,it,fj);it.memoizedProps=it.pendingProps,_===null?Sk(it):Y=_,nk.current=null}function Sk(it){var _=it;do{var lt=_.alternate;if(it=_.return,_.flags&32768){if(lt=Ij(lt,_),lt!==null){lt.flags&=32767,Y=lt;return}if(it!==null)it.flags|=32768,it.subtreeFlags=0,it.deletions=null;else{T=6,Y=null;return}}else if(lt=Ej(lt,_,fj),lt!==null){Y=lt;return}if(_=_.sibling,_!==null){Y=_;return}Y=_=it}while(_!==null);T===0&&(T=5)}function Pk(it,_,lt){var ft=C,mt=ok.transition;try{ok.transition=null,C=1,Wk(it,_,lt,ft)}finally{ok.transition=mt,C=ft}return null}function Wk(it,_,lt,ft){do Hk();while(wk!==null);if(K&6)throw Error(p$1(327));lt=it.finishedWork;var mt=it.finishedLanes;if(lt===null)return null;if(it.finishedWork=null,it.finishedLanes=0,lt===it.current)throw Error(p$1(177));it.callbackNode=null,it.callbackPriority=0;var pt=lt.lanes|lt.childLanes;if(Bc(it,pt),it===Q&&(Y=Q=null,Z=0),!(lt.subtreeFlags&2064)&&!(lt.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),pt=(lt.flags&15990)!==0,lt.subtreeFlags&15990||pt){pt=ok.transition,ok.transition=null;var gt=C;C=1;var bt=K;K|=4,nk.current=null,Oj(it,lt),dk(lt,it),Oe(Df),dd=!!Cf,Df=Cf=null,it.current=lt,hk(lt),dc(),K=bt,C=gt,ok.transition=pt}else it.current=lt;if(vk&&(vk=!1,wk=it,xk=mt),pt=it.pendingLanes,pt===0&&(Ri=null),mc(lt.stateNode),Dk(it,B()),_!==null)for(ft=it.onRecoverableError,lt=0;lt<_.length;lt++)mt=_[lt],ft(mt.value,{componentStack:mt.stack,digest:mt.digest});if(Oi)throw Oi=!1,it=Pi,Pi=null,it;return xk&1&&it.tag!==0&&Hk(),pt=it.pendingLanes,pt&1?it===zk?yk++:(yk=0,zk=it):yk=0,jg(),null}function Hk(){if(wk!==null){var it=Dc(xk),_=ok.transition,lt=C;try{if(ok.transition=null,C=16>it?16:it,wk===null)var ft=!1;else{if(it=wk,wk=null,xk=0,K&6)throw Error(p$1(331));var mt=K;for(K|=4,V=it.current;V!==null;){var pt=V,gt=pt.child;if(V.flags&16){var bt=pt.deletions;if(bt!==null){for(var wt=0;wt<bt.length;wt++){var vt=bt[wt];for(V=vt;V!==null;){var Ct=V;switch(Ct.tag){case 0:case 11:case 15:Pj(8,Ct,pt)}var Rt=Ct.child;if(Rt!==null)Rt.return=Ct,V=Rt;else for(;V!==null;){Ct=V;var Mt=Ct.sibling,Ot=Ct.return;if(Sj(Ct),Ct===vt){V=null;break}if(Mt!==null){Mt.return=Ot,V=Mt;break}V=Ot}}}var Nt=pt.alternate;if(Nt!==null){var Ht=Nt.child;if(Ht!==null){Nt.child=null;do{var Kt=Ht.sibling;Ht.sibling=null,Ht=Kt}while(Ht!==null)}}V=pt}}if(pt.subtreeFlags&2064&&gt!==null)gt.return=pt,V=gt;else e:for(;V!==null;){if(pt=V,pt.flags&2048)switch(pt.tag){case 0:case 11:case 15:Pj(9,pt,pt.return)}var hr=pt.sibling;if(hr!==null){hr.return=pt.return,V=hr;break e}V=pt.return}}var Qt=it.current;for(V=Qt;V!==null;){gt=V;var mr=gt.child;if(gt.subtreeFlags&2064&&mr!==null)mr.return=gt,V=mr;else e:for(gt=Qt;V!==null;){if(bt=V,bt.flags&2048)try{switch(bt.tag){case 0:case 11:case 15:Qj(9,bt)}}catch(Fr){W(bt,bt.return,Fr)}if(bt===gt){V=null;break e}var br=bt.sibling;if(br!==null){br.return=bt.return,V=br;break e}V=bt.return}}if(K=mt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,it)}catch{}ft=!0}return ft}finally{C=lt,ok.transition=_}}return!1}function Xk(it,_,lt){_=Ji(lt,_),_=Ni(it,_,1),it=nh(it,_,1),_=R(),it!==null&&(Ac(it,1,_),Dk(it,_))}function W(it,_,lt){if(it.tag===3)Xk(it,it,lt);else for(;_!==null;){if(_.tag===3){Xk(_,it,lt);break}else if(_.tag===1){var ft=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof ft.componentDidCatch=="function"&&(Ri===null||!Ri.has(ft))){it=Ji(lt,it),it=Qi(_,it,1),_=nh(_,it,1),it=R(),_!==null&&(Ac(_,1,it),Dk(_,it));break}}_=_.return}}function Ti(it,_,lt){var ft=it.pingCache;ft!==null&&ft.delete(_),_=R(),it.pingedLanes|=it.suspendedLanes&lt,Q===it&&(Z&lt)===lt&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(it,0):rk|=lt),Dk(it,_)}function Yk(it,_){_===0&&(it.mode&1?(_=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):_=1);var lt=R();it=ih(it,_),it!==null&&(Ac(it,_,lt),Dk(it,lt))}function uj(it){var _=it.memoizedState,lt=0;_!==null&&(lt=_.retryLane),Yk(it,lt)}function bk(it,_){var lt=0;switch(it.tag){case 13:var ft=it.stateNode,mt=it.memoizedState;mt!==null&&(lt=mt.retryLane);break;case 19:ft=it.stateNode;break;default:throw Error(p$1(314))}ft!==null&&ft.delete(_),Yk(it,lt)}var Vk;Vk=function(it,_,lt){if(it!==null)if(it.memoizedProps!==_.pendingProps||Wf.current)dh=!0;else{if(!(it.lanes&lt)&&!(_.flags&128))return dh=!1,yj(it,_,lt);dh=!!(it.flags&131072)}else dh=!1,I&&_.flags&1048576&&ug(_,ng,_.index);switch(_.lanes=0,_.tag){case 2:var ft=_.type;ij(it,_),it=_.pendingProps;var mt=Yf(_,H$1.current);ch(_,lt),mt=Nh(null,_,ft,it,mt,lt);var pt=Sh();return _.flags|=1,typeof mt=="object"&&mt!==null&&typeof mt.render=="function"&&mt.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Zf(ft)?(pt=!0,cg(_)):pt=!1,_.memoizedState=mt.state!==null&&mt.state!==void 0?mt.state:null,kh(_),mt.updater=Ei,_.stateNode=mt,mt._reactInternals=_,Ii(_,ft,it,lt),_=jj(null,_,ft,!0,pt,lt)):(_.tag=0,I&&pt&&vg(_),Xi(null,_,mt,lt),_=_.child),_;case 16:ft=_.elementType;e:{switch(ij(it,_),it=_.pendingProps,mt=ft._init,ft=mt(ft._payload),_.type=ft,mt=_.tag=Zk(ft),it=Ci(ft,it),mt){case 0:_=cj(null,_,ft,it,lt);break e;case 1:_=hj(null,_,ft,it,lt);break e;case 11:_=Yi(null,_,ft,it,lt);break e;case 14:_=$i(null,_,ft,Ci(ft.type,it),lt);break e}throw Error(p$1(306,ft,""))}return _;case 0:return ft=_.type,mt=_.pendingProps,mt=_.elementType===ft?mt:Ci(ft,mt),cj(it,_,ft,mt,lt);case 1:return ft=_.type,mt=_.pendingProps,mt=_.elementType===ft?mt:Ci(ft,mt),hj(it,_,ft,mt,lt);case 3:e:{if(kj(_),it===null)throw Error(p$1(387));ft=_.pendingProps,pt=_.memoizedState,mt=pt.element,lh(it,_),qh(_,ft,null,lt);var gt=_.memoizedState;if(ft=gt.element,pt.isDehydrated)if(pt={element:ft,isDehydrated:!1,cache:gt.cache,pendingSuspenseBoundaries:gt.pendingSuspenseBoundaries,transitions:gt.transitions},_.updateQueue.baseState=pt,_.memoizedState=pt,_.flags&256){mt=Ji(Error(p$1(423)),_),_=lj(it,_,ft,lt,mt);break e}else if(ft!==mt){mt=Ji(Error(p$1(424)),_),_=lj(it,_,ft,lt,mt);break e}else for(yg=Lf(_.stateNode.containerInfo.firstChild),xg=_,I=!0,zg=null,lt=Vg(_,null,ft,lt),_.child=lt;lt;)lt.flags=lt.flags&-3|4096,lt=lt.sibling;else{if(Ig(),ft===mt){_=Zi(it,_,lt);break e}Xi(it,_,ft,lt)}_=_.child}return _;case 5:return Ah(_),it===null&&Eg(_),ft=_.type,mt=_.pendingProps,pt=it!==null?it.memoizedProps:null,gt=mt.children,Ef(ft,mt)?gt=null:pt!==null&&Ef(ft,pt)&&(_.flags|=32),gj(it,_),Xi(it,_,gt,lt),_.child;case 6:return it===null&&Eg(_),null;case 13:return oj(it,_,lt);case 4:return yh(_,_.stateNode.containerInfo),ft=_.pendingProps,it===null?_.child=Ug(_,null,ft,lt):Xi(it,_,ft,lt),_.child;case 11:return ft=_.type,mt=_.pendingProps,mt=_.elementType===ft?mt:Ci(ft,mt),Yi(it,_,ft,mt,lt);case 7:return Xi(it,_,_.pendingProps,lt),_.child;case 8:return Xi(it,_,_.pendingProps.children,lt),_.child;case 12:return Xi(it,_,_.pendingProps.children,lt),_.child;case 10:e:{if(ft=_.type._context,mt=_.pendingProps,pt=_.memoizedProps,gt=mt.value,G(Wg,ft._currentValue),ft._currentValue=gt,pt!==null)if(He(pt.value,gt)){if(pt.children===mt.children&&!Wf.current){_=Zi(it,_,lt);break e}}else for(pt=_.child,pt!==null&&(pt.return=_);pt!==null;){var bt=pt.dependencies;if(bt!==null){gt=pt.child;for(var wt=bt.firstContext;wt!==null;){if(wt.context===ft){if(pt.tag===1){wt=mh(-1,lt&-lt),wt.tag=2;var vt=pt.updateQueue;if(vt!==null){vt=vt.shared;var Ct=vt.pending;Ct===null?wt.next=wt:(wt.next=Ct.next,Ct.next=wt),vt.pending=wt}}pt.lanes|=lt,wt=pt.alternate,wt!==null&&(wt.lanes|=lt),bh(pt.return,lt,_),bt.lanes|=lt;break}wt=wt.next}}else if(pt.tag===10)gt=pt.type===_.type?null:pt.child;else if(pt.tag===18){if(gt=pt.return,gt===null)throw Error(p$1(341));gt.lanes|=lt,bt=gt.alternate,bt!==null&&(bt.lanes|=lt),bh(gt,lt,_),gt=pt.sibling}else gt=pt.child;if(gt!==null)gt.return=pt;else for(gt=pt;gt!==null;){if(gt===_){gt=null;break}if(pt=gt.sibling,pt!==null){pt.return=gt.return,gt=pt;break}gt=gt.return}pt=gt}Xi(it,_,mt.children,lt),_=_.child}return _;case 9:return mt=_.type,ft=_.pendingProps.children,ch(_,lt),mt=eh(mt),ft=ft(mt),_.flags|=1,Xi(it,_,ft,lt),_.child;case 14:return ft=_.type,mt=Ci(ft,_.pendingProps),mt=Ci(ft.type,mt),$i(it,_,ft,mt,lt);case 15:return bj(it,_,_.type,_.pendingProps,lt);case 17:return ft=_.type,mt=_.pendingProps,mt=_.elementType===ft?mt:Ci(ft,mt),ij(it,_),_.tag=1,Zf(ft)?(it=!0,cg(_)):it=!1,ch(_,lt),Gi(_,ft,mt),Ii(_,ft,mt,lt),jj(null,_,ft,!0,it,lt);case 19:return xj(it,_,lt);case 22:return dj(it,_,lt)}throw Error(p$1(156,_.tag))};function Fk(it,_){return ac(it,_)}function $k(it,_,lt,ft){this.tag=it,this.key=lt,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=ft,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(it,_,lt,ft){return new $k(it,_,lt,ft)}function aj(it){return it=it.prototype,!(!it||!it.isReactComponent)}function Zk(it){if(typeof it=="function")return aj(it)?1:0;if(it!=null){if(it=it.$$typeof,it===Da)return 11;if(it===Ga)return 14}return 2}function Pg(it,_){var lt=it.alternate;return lt===null?(lt=Bg(it.tag,_,it.key,it.mode),lt.elementType=it.elementType,lt.type=it.type,lt.stateNode=it.stateNode,lt.alternate=it,it.alternate=lt):(lt.pendingProps=_,lt.type=it.type,lt.flags=0,lt.subtreeFlags=0,lt.deletions=null),lt.flags=it.flags&14680064,lt.childLanes=it.childLanes,lt.lanes=it.lanes,lt.child=it.child,lt.memoizedProps=it.memoizedProps,lt.memoizedState=it.memoizedState,lt.updateQueue=it.updateQueue,_=it.dependencies,lt.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},lt.sibling=it.sibling,lt.index=it.index,lt.ref=it.ref,lt}function Rg(it,_,lt,ft,mt,pt){var gt=2;if(ft=it,typeof it=="function")aj(it)&&(gt=1);else if(typeof it=="string")gt=5;else e:switch(it){case ya:return Tg(lt.children,mt,pt,_);case za:gt=8,mt|=8;break;case Aa:return it=Bg(12,lt,_,mt|2),it.elementType=Aa,it.lanes=pt,it;case Ea:return it=Bg(13,lt,_,mt),it.elementType=Ea,it.lanes=pt,it;case Fa:return it=Bg(19,lt,_,mt),it.elementType=Fa,it.lanes=pt,it;case Ia:return pj(lt,mt,pt,_);default:if(typeof it=="object"&&it!==null)switch(it.$$typeof){case Ba:gt=10;break e;case Ca:gt=9;break e;case Da:gt=11;break e;case Ga:gt=14;break e;case Ha:gt=16,ft=null;break e}throw Error(p$1(130,it==null?it:typeof it,""))}return _=Bg(gt,lt,_,mt),_.elementType=it,_.type=ft,_.lanes=pt,_}function Tg(it,_,lt,ft){return it=Bg(7,it,ft,_),it.lanes=lt,it}function pj(it,_,lt,ft){return it=Bg(22,it,ft,_),it.elementType=Ia,it.lanes=lt,it.stateNode={isHidden:!1},it}function Qg(it,_,lt){return it=Bg(6,it,null,_),it.lanes=lt,it}function Sg(it,_,lt){return _=Bg(4,it.children!==null?it.children:[],it.key,_),_.lanes=lt,_.stateNode={containerInfo:it.containerInfo,pendingChildren:null,implementation:it.implementation},_}function al(it,_,lt,ft,mt){this.tag=_,this.containerInfo=it,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=ft,this.onRecoverableError=mt,this.mutableSourceEagerHydrationData=null}function bl(it,_,lt,ft,mt,pt,gt,bt,wt){return it=new al(it,_,lt,bt,wt),_===1?(_=1,pt===!0&&(_|=8)):_=0,pt=Bg(3,null,null,_),it.current=pt,pt.stateNode=it,pt.memoizedState={element:ft,isDehydrated:lt,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(pt),it}function cl(it,_,lt){var ft=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:ft==null?null:""+ft,children:it,containerInfo:_,implementation:lt}}function dl(it){if(!it)return Vf;it=it._reactInternals;e:{if(Vb(it)!==it||it.tag!==1)throw Error(p$1(170));var _=it;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Zf(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(p$1(171))}if(it.tag===1){var lt=it.type;if(Zf(lt))return bg(it,lt,_)}return _}function el(it,_,lt,ft,mt,pt,gt,bt,wt){return it=bl(lt,ft,!0,it,mt,pt,gt,bt,wt),it.context=dl(null),lt=it.current,ft=R(),mt=yi(lt),pt=mh(ft,mt),pt.callback=_??null,nh(lt,pt,mt),it.current.lanes=mt,Ac(it,mt,ft),Dk(it,ft),it}function fl(it,_,lt,ft){var mt=_.current,pt=R(),gt=yi(mt);return lt=dl(lt),_.context===null?_.context=lt:_.pendingContext=lt,_=mh(pt,gt),_.payload={element:it},ft=ft===void 0?null:ft,ft!==null&&(_.callback=ft),it=nh(mt,_,gt),it!==null&&(gi(it,mt,gt,pt),oh(it,mt,gt)),gt}function gl(it){if(it=it.current,!it.child)return null;switch(it.child.tag){case 5:return it.child.stateNode;default:return it.child.stateNode}}function hl(it,_){if(it=it.memoizedState,it!==null&&it.dehydrated!==null){var lt=it.retryLane;it.retryLane=lt!==0&&lt<_?lt:_}}function il(it,_){hl(it,_),(it=it.alternate)&&hl(it,_)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(it){console.error(it)};function ll(it){this._internalRoot=it}ml.prototype.render=ll.prototype.render=function(it){var _=this._internalRoot;if(_===null)throw Error(p$1(409));fl(it,_,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var it=this._internalRoot;if(it!==null){this._internalRoot=null;var _=it.containerInfo;Rk(function(){fl(null,it,null,null)}),_[uf]=null}};function ml(it){this._internalRoot=it}ml.prototype.unstable_scheduleHydration=function(it){if(it){var _=Hc();it={blockedOn:null,target:it,priority:_};for(var lt=0;lt<Qc.length&&_!==0&&_<Qc[lt].priority;lt++);Qc.splice(lt,0,it),lt===0&&Vc(it)}};function nl(it){return!(!it||it.nodeType!==1&&it.nodeType!==9&&it.nodeType!==11)}function ol(it){return!(!it||it.nodeType!==1&&it.nodeType!==9&&it.nodeType!==11&&(it.nodeType!==8||it.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(it,_,lt,ft,mt){if(mt){if(typeof ft=="function"){var pt=ft;ft=function(){var vt=gl(gt);pt.call(vt)}}var gt=el(_,ft,it,0,null,!1,!1,"",pl);return it._reactRootContainer=gt,it[uf]=gt.current,sf(it.nodeType===8?it.parentNode:it),Rk(),gt}for(;mt=it.lastChild;)it.removeChild(mt);if(typeof ft=="function"){var bt=ft;ft=function(){var vt=gl(wt);bt.call(vt)}}var wt=bl(it,0,!1,null,null,!1,!1,"",pl);return it._reactRootContainer=wt,it[uf]=wt.current,sf(it.nodeType===8?it.parentNode:it),Rk(function(){fl(_,wt,lt,ft)}),wt}function rl(it,_,lt,ft,mt){var pt=lt._reactRootContainer;if(pt){var gt=pt;if(typeof mt=="function"){var bt=mt;mt=function(){var wt=gl(gt);bt.call(wt)}}fl(_,gt,it,mt)}else gt=ql(lt,_,it,mt,ft);return gl(gt)}Ec=function(it){switch(it.tag){case 3:var _=it.stateNode;if(_.current.memoizedState.isDehydrated){var lt=tc(_.pendingLanes);lt!==0&&(Cc(_,lt|1),Dk(_,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var ft=ih(it,1);if(ft!==null){var mt=R();gi(ft,it,1,mt)}}),il(it,1)}};Fc=function(it){if(it.tag===13){var _=ih(it,134217728);if(_!==null){var lt=R();gi(_,it,134217728,lt)}il(it,134217728)}};Gc=function(it){if(it.tag===13){var _=yi(it),lt=ih(it,_);if(lt!==null){var ft=R();gi(lt,it,_,ft)}il(it,_)}};Hc=function(){return C};Ic=function(it,_){var lt=C;try{return C=it,_()}finally{C=lt}};yb=function(it,_,lt){switch(_){case"input":if(bb(it,lt),_=lt.name,lt.type==="radio"&&_!=null){for(lt=it;lt.parentNode;)lt=lt.parentNode;for(lt=lt.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<lt.length;_++){var ft=lt[_];if(ft!==it&&ft.form===it.form){var mt=Db(ft);if(!mt)throw Error(p$1(90));Wa(ft),bb(ft,mt)}}}break;case"textarea":ib(it,lt);break;case"select":_=lt.value,_!=null&&fb(it,!!lt.multiple,_,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(it){return it=Zb(it),it===null?null:it.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(it,_){var lt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(_))throw Error(p$1(200));return cl(it,_,null,lt)};reactDom_production_min.createRoot=function(it,_){if(!nl(it))throw Error(p$1(299));var lt=!1,ft="",mt=kl;return _!=null&&(_.unstable_strictMode===!0&&(lt=!0),_.identifierPrefix!==void 0&&(ft=_.identifierPrefix),_.onRecoverableError!==void 0&&(mt=_.onRecoverableError)),_=bl(it,1,!1,null,null,lt,!1,ft,mt),it[uf]=_.current,sf(it.nodeType===8?it.parentNode:it),new ll(_)};reactDom_production_min.findDOMNode=function(it){if(it==null)return null;if(it.nodeType===1)return it;var _=it._reactInternals;if(_===void 0)throw typeof it.render=="function"?Error(p$1(188)):(it=Object.keys(it).join(","),Error(p$1(268,it)));return it=Zb(_),it=it===null?null:it.stateNode,it};reactDom_production_min.flushSync=function(it){return Rk(it)};reactDom_production_min.hydrate=function(it,_,lt){if(!ol(_))throw Error(p$1(200));return rl(null,it,_,!0,lt)};reactDom_production_min.hydrateRoot=function(it,_,lt){if(!nl(it))throw Error(p$1(405));var ft=lt!=null&&lt.hydratedSources||null,mt=!1,pt="",gt=kl;if(lt!=null&&(lt.unstable_strictMode===!0&&(mt=!0),lt.identifierPrefix!==void 0&&(pt=lt.identifierPrefix),lt.onRecoverableError!==void 0&&(gt=lt.onRecoverableError)),_=el(_,null,it,1,lt??null,mt,!1,pt,gt),it[uf]=_.current,sf(it),ft)for(it=0;it<ft.length;it++)lt=ft[it],mt=lt._getVersion,mt=mt(lt._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[lt,mt]:_.mutableSourceEagerHydrationData.push(lt,mt);return new ml(_)};reactDom_production_min.render=function(it,_,lt){if(!ol(_))throw Error(p$1(200));return rl(null,it,_,!1,lt)};reactDom_production_min.unmountComponentAtNode=function(it){if(!ol(it))throw Error(p$1(40));return it._reactRootContainer?(Rk(function(){rl(null,null,it,!1,function(){it._reactRootContainer=null,it[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(it,_,lt,ft){if(!ol(lt))throw Error(p$1(200));if(it==null||it._reactInternals===void 0)throw Error(p$1(38));return rl(it,_,lt,!1,ft)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(it){console.error(it)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const index=getDefaultExportFromCjs(reactDomExports),ReactDOM=_mergeNamespaces({__proto__:null,default:index},[reactDomExports]);var createRoot,m$1=reactDomExports;createRoot=m$1.createRoot,m$1.hydrateRoot;/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(it){for(var _=1;_<arguments.length;_++){var lt=arguments[_];for(var ft in lt)Object.prototype.hasOwnProperty.call(lt,ft)&&(it[ft]=lt[ft])}return it},_extends$2.apply(this,arguments)}var Action;(function(it){it.Pop="POP",it.Push="PUSH",it.Replace="REPLACE"})(Action||(Action={}));const PopStateEventType="popstate";function createBrowserHistory(it){it===void 0&&(it={});function _(ft,mt){let{pathname:pt,search:gt,hash:bt}=ft.location;return createLocation("",{pathname:pt,search:gt,hash:bt},mt.state&&mt.state.usr||null,mt.state&&mt.state.key||"default")}function lt(ft,mt){return typeof mt=="string"?mt:createPath(mt)}return getUrlBasedHistory(_,lt,null,it)}function invariant$1(it,_){if(it===!1||it===null||typeof it>"u")throw new Error(_)}function warning(it,_){if(!it){typeof console<"u"&&console.warn(_);try{throw new Error(_)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(it,_){return{usr:it.state,key:it.key,idx:_}}function createLocation(it,_,lt,ft){return lt===void 0&&(lt=null),_extends$2({pathname:typeof it=="string"?it:it.pathname,search:"",hash:""},typeof _=="string"?parsePath(_):_,{state:lt,key:_&&_.key||ft||createKey()})}function createPath(it){let{pathname:_="/",search:lt="",hash:ft=""}=it;return lt&&lt!=="?"&&(_+=lt.charAt(0)==="?"?lt:"?"+lt),ft&&ft!=="#"&&(_+=ft.charAt(0)==="#"?ft:"#"+ft),_}function parsePath(it){let _={};if(it){let lt=it.indexOf("#");lt>=0&&(_.hash=it.substr(lt),it=it.substr(0,lt));let ft=it.indexOf("?");ft>=0&&(_.search=it.substr(ft),it=it.substr(0,ft)),it&&(_.pathname=it)}return _}function getUrlBasedHistory(it,_,lt,ft){ft===void 0&&(ft={});let{window:mt=document.defaultView,v5Compat:pt=!1}=ft,gt=mt.history,bt=Action.Pop,wt=null,vt=Ct();vt==null&&(vt=0,gt.replaceState(_extends$2({},gt.state,{idx:vt}),""));function Ct(){return(gt.state||{idx:null}).idx}function Rt(){bt=Action.Pop;let Kt=Ct(),hr=Kt==null?null:Kt-vt;vt=Kt,wt&&wt({action:bt,location:Ht.location,delta:hr})}function Mt(Kt,hr){bt=Action.Push;let Qt=createLocation(Ht.location,Kt,hr);vt=Ct()+1;let mr=getHistoryState(Qt,vt),br=Ht.createHref(Qt);try{gt.pushState(mr,"",br)}catch(Fr){if(Fr instanceof DOMException&&Fr.name==="DataCloneError")throw Fr;mt.location.assign(br)}pt&&wt&&wt({action:bt,location:Ht.location,delta:1})}function Ot(Kt,hr){bt=Action.Replace;let Qt=createLocation(Ht.location,Kt,hr);vt=Ct();let mr=getHistoryState(Qt,vt),br=Ht.createHref(Qt);gt.replaceState(mr,"",br),pt&&wt&&wt({action:bt,location:Ht.location,delta:0})}function Nt(Kt){let hr=mt.location.origin!=="null"?mt.location.origin:mt.location.href,Qt=typeof Kt=="string"?Kt:createPath(Kt);return Qt=Qt.replace(/ $/,"%20"),invariant$1(hr,"No window.location.(origin|href) available to create URL for href: "+Qt),new URL(Qt,hr)}let Ht={get action(){return bt},get location(){return it(mt,gt)},listen(Kt){if(wt)throw new Error("A history only accepts one active listener");return mt.addEventListener(PopStateEventType,Rt),wt=Kt,()=>{mt.removeEventListener(PopStateEventType,Rt),wt=null}},createHref(Kt){return _(mt,Kt)},createURL:Nt,encodeLocation(Kt){let hr=Nt(Kt);return{pathname:hr.pathname,search:hr.search,hash:hr.hash}},push:Mt,replace:Ot,go(Kt){return gt.go(Kt)}};return Ht}var ResultType;(function(it){it.data="data",it.deferred="deferred",it.redirect="redirect",it.error="error"})(ResultType||(ResultType={}));const immutableRouteKeys=new Set(["lazy","caseSensitive","path","id","index","children"]);function isIndexRoute(it){return it.index===!0}function convertRoutesToDataRoutes(it,_,lt,ft){return lt===void 0&&(lt=[]),ft===void 0&&(ft={}),it.map((mt,pt)=>{let gt=[...lt,String(pt)],bt=typeof mt.id=="string"?mt.id:gt.join("-");if(invariant$1(mt.index!==!0||!mt.children,"Cannot specify children on an index route"),invariant$1(!ft[bt],'Found a route id collision on id "'+bt+`".  Route id's must be globally unique within Data Router usages`),isIndexRoute(mt)){let wt=_extends$2({},mt,_(mt),{id:bt});return ft[bt]=wt,wt}else{let wt=_extends$2({},mt,_(mt),{id:bt,children:void 0});return ft[bt]=wt,mt.children&&(wt.children=convertRoutesToDataRoutes(mt.children,_,gt,ft)),wt}})}function matchRoutes(it,_,lt){return lt===void 0&&(lt="/"),matchRoutesImpl(it,_,lt,!1)}function matchRoutesImpl(it,_,lt,ft){let mt=typeof _=="string"?parsePath(_):_,pt=stripBasename(mt.pathname||"/",lt);if(pt==null)return null;let gt=flattenRoutes(it);rankRouteBranches(gt);let bt=null;for(let wt=0;bt==null&&wt<gt.length;++wt){let vt=decodePath(pt);bt=matchRouteBranch(gt[wt],vt,ft)}return bt}function convertRouteMatchToUiMatch(it,_){let{route:lt,pathname:ft,params:mt}=it;return{id:lt.id,pathname:ft,params:mt,data:_[lt.id],handle:lt.handle}}function flattenRoutes(it,_,lt,ft){_===void 0&&(_=[]),lt===void 0&&(lt=[]),ft===void 0&&(ft="");let mt=(pt,gt,bt)=>{let wt={relativePath:bt===void 0?pt.path||"":bt,caseSensitive:pt.caseSensitive===!0,childrenIndex:gt,route:pt};wt.relativePath.startsWith("/")&&(invariant$1(wt.relativePath.startsWith(ft),'Absolute route path "'+wt.relativePath+'" nested under path '+('"'+ft+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),wt.relativePath=wt.relativePath.slice(ft.length));let vt=joinPaths([ft,wt.relativePath]),Ct=lt.concat(wt);pt.children&&pt.children.length>0&&(invariant$1(pt.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+vt+'".')),flattenRoutes(pt.children,_,Ct,vt)),!(pt.path==null&&!pt.index)&&_.push({path:vt,score:computeScore(vt,pt.index),routesMeta:Ct})};return it.forEach((pt,gt)=>{var bt;if(pt.path===""||!((bt=pt.path)!=null&&bt.includes("?")))mt(pt,gt);else for(let wt of explodeOptionalSegments(pt.path))mt(pt,gt,wt)}),_}function explodeOptionalSegments(it){let _=it.split("/");if(_.length===0)return[];let[lt,...ft]=_,mt=lt.endsWith("?"),pt=lt.replace(/\?$/,"");if(ft.length===0)return mt?[pt,""]:[pt];let gt=explodeOptionalSegments(ft.join("/")),bt=[];return bt.push(...gt.map(wt=>wt===""?pt:[pt,wt].join("/"))),mt&&bt.push(...gt),bt.map(wt=>it.startsWith("/")&&wt===""?"/":wt)}function rankRouteBranches(it){it.sort((_,lt)=>_.score!==lt.score?lt.score-_.score:compareIndexes(_.routesMeta.map(ft=>ft.childrenIndex),lt.routesMeta.map(ft=>ft.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=it=>it==="*";function computeScore(it,_){let lt=it.split("/"),ft=lt.length;return lt.some(isSplat)&&(ft+=splatPenalty),_&&(ft+=indexRouteValue),lt.filter(mt=>!isSplat(mt)).reduce((mt,pt)=>mt+(paramRe.test(pt)?dynamicSegmentValue:pt===""?emptySegmentValue:staticSegmentValue),ft)}function compareIndexes(it,_){return it.length===_.length&&it.slice(0,-1).every((ft,mt)=>ft===_[mt])?it[it.length-1]-_[_.length-1]:0}function matchRouteBranch(it,_,lt){lt===void 0&&(lt=!1);let{routesMeta:ft}=it,mt={},pt="/",gt=[];for(let bt=0;bt<ft.length;++bt){let wt=ft[bt],vt=bt===ft.length-1,Ct=pt==="/"?_:_.slice(pt.length)||"/",Rt=matchPath({path:wt.relativePath,caseSensitive:wt.caseSensitive,end:vt},Ct),Mt=wt.route;if(!Rt&&vt&&lt&&!ft[ft.length-1].route.index&&(Rt=matchPath({path:wt.relativePath,caseSensitive:wt.caseSensitive,end:!1},Ct)),!Rt)return null;Object.assign(mt,Rt.params),gt.push({params:mt,pathname:joinPaths([pt,Rt.pathname]),pathnameBase:normalizePathname(joinPaths([pt,Rt.pathnameBase])),route:Mt}),Rt.pathnameBase!=="/"&&(pt=joinPaths([pt,Rt.pathnameBase]))}return gt}function matchPath(it,_){typeof it=="string"&&(it={path:it,caseSensitive:!1,end:!0});let[lt,ft]=compilePath(it.path,it.caseSensitive,it.end),mt=_.match(lt);if(!mt)return null;let pt=mt[0],gt=pt.replace(/(.)\/+$/,"$1"),bt=mt.slice(1);return{params:ft.reduce((vt,Ct,Rt)=>{let{paramName:Mt,isOptional:Ot}=Ct;if(Mt==="*"){let Ht=bt[Rt]||"";gt=pt.slice(0,pt.length-Ht.length).replace(/(.)\/+$/,"$1")}const Nt=bt[Rt];return Ot&&!Nt?vt[Mt]=void 0:vt[Mt]=(Nt||"").replace(/%2F/g,"/"),vt},{}),pathname:pt,pathnameBase:gt,pattern:it}}function compilePath(it,_,lt){_===void 0&&(_=!1),lt===void 0&&(lt=!0),warning(it==="*"||!it.endsWith("*")||it.endsWith("/*"),'Route path "'+it+'" will be treated as if it were '+('"'+it.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+it.replace(/\*$/,"/*")+'".'));let ft=[],mt="^"+it.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(gt,bt,wt)=>(ft.push({paramName:bt,isOptional:wt!=null}),wt?"/?([^\\/]+)?":"/([^\\/]+)"));return it.endsWith("*")?(ft.push({paramName:"*"}),mt+=it==="*"||it==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):lt?mt+="\\/*$":it!==""&&it!=="/"&&(mt+="(?:(?=\\/|$))"),[new RegExp(mt,_?void 0:"i"),ft]}function decodePath(it){try{return it.split("/").map(_=>decodeURIComponent(_).replace(/\//g,"%2F")).join("/")}catch(_){return warning(!1,'The URL path "'+it+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+_+").")),it}}function stripBasename(it,_){if(_==="/")return it;if(!it.toLowerCase().startsWith(_.toLowerCase()))return null;let lt=_.endsWith("/")?_.length-1:_.length,ft=it.charAt(lt);return ft&&ft!=="/"?null:it.slice(lt)||"/"}function resolvePath(it,_){_===void 0&&(_="/");let{pathname:lt,search:ft="",hash:mt=""}=typeof it=="string"?parsePath(it):it;return{pathname:lt?lt.startsWith("/")?lt:resolvePathname(lt,_):_,search:normalizeSearch(ft),hash:normalizeHash(mt)}}function resolvePathname(it,_){let lt=_.replace(/\/+$/,"").split("/");return it.split("/").forEach(mt=>{mt===".."?lt.length>1&&lt.pop():mt!=="."&&lt.push(mt)}),lt.length>1?lt.join("/"):"/"}function getInvalidPathError(it,_,lt,ft){return"Cannot include a '"+it+"' character in a manually specified "+("`to."+_+"` field ["+JSON.stringify(ft)+"].  Please separate it out to the ")+("`to."+lt+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(it){return it.filter((_,lt)=>lt===0||_.route.path&&_.route.path.length>0)}function getResolveToMatches(it,_){let lt=getPathContributingMatches(it);return _?lt.map((ft,mt)=>mt===lt.length-1?ft.pathname:ft.pathnameBase):lt.map(ft=>ft.pathnameBase)}function resolveTo(it,_,lt,ft){ft===void 0&&(ft=!1);let mt;typeof it=="string"?mt=parsePath(it):(mt=_extends$2({},it),invariant$1(!mt.pathname||!mt.pathname.includes("?"),getInvalidPathError("?","pathname","search",mt)),invariant$1(!mt.pathname||!mt.pathname.includes("#"),getInvalidPathError("#","pathname","hash",mt)),invariant$1(!mt.search||!mt.search.includes("#"),getInvalidPathError("#","search","hash",mt)));let pt=it===""||mt.pathname==="",gt=pt?"/":mt.pathname,bt;if(gt==null)bt=lt;else{let Rt=_.length-1;if(!ft&&gt.startsWith("..")){let Mt=gt.split("/");for(;Mt[0]==="..";)Mt.shift(),Rt-=1;mt.pathname=Mt.join("/")}bt=Rt>=0?_[Rt]:"/"}let wt=resolvePath(mt,bt),vt=gt&&gt!=="/"&&gt.endsWith("/"),Ct=(pt||gt===".")&&lt.endsWith("/");return!wt.pathname.endsWith("/")&&(vt||Ct)&&(wt.pathname+="/"),wt}const joinPaths=it=>it.join("/").replace(/\/\/+/g,"/"),normalizePathname=it=>it.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=it=>!it||it==="?"?"":it.startsWith("?")?it:"?"+it,normalizeHash=it=>!it||it==="#"?"":it.startsWith("#")?it:"#"+it;class ErrorResponseImpl{constructor(_,lt,ft,mt){mt===void 0&&(mt=!1),this.status=_,this.statusText=lt||"",this.internal=mt,ft instanceof Error?(this.data=ft.toString(),this.error=ft):this.data=ft}}function isRouteErrorResponse(it){return it!=null&&typeof it.status=="number"&&typeof it.statusText=="string"&&typeof it.internal=="boolean"&&"data"in it}const validMutationMethodsArr=["post","put","patch","delete"],validMutationMethods=new Set(validMutationMethodsArr),validRequestMethodsArr=["get",...validMutationMethodsArr],validRequestMethods=new Set(validRequestMethodsArr),redirectStatusCodes=new Set([301,302,303,307,308]),redirectPreserveMethodStatusCodes=new Set([307,308]),IDLE_NAVIGATION={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},IDLE_FETCHER={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},IDLE_BLOCKER={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},ABSOLUTE_URL_REGEX$1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,defaultMapRouteProperties=it=>({hasErrorBoundary:!!it.hasErrorBoundary}),TRANSITIONS_STORAGE_KEY="remix-router-transitions";function createRouter(it){const _=it.window?it.window:typeof window<"u"?window:void 0,lt=typeof _<"u"&&typeof _.document<"u"&&typeof _.document.createElement<"u",ft=!lt;invariant$1(it.routes.length>0,"You must provide a non-empty routes array to createRouter");let mt;if(it.mapRouteProperties)mt=it.mapRouteProperties;else if(it.detectErrorBoundary){let Un=it.detectErrorBoundary;mt=qn=>({hasErrorBoundary:Un(qn)})}else mt=defaultMapRouteProperties;let pt={},gt=convertRoutesToDataRoutes(it.routes,mt,void 0,pt),bt,wt=it.basename||"/",vt=it.dataStrategy||defaultDataStrategy,Ct=it.patchRoutesOnNavigation,Rt=_extends$2({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},it.future),Mt=null,Ot=new Set,Nt=null,Ht=null,Kt=null,hr=it.hydrationData!=null,Qt=matchRoutes(gt,it.history.location,wt),mr=null;if(Qt==null&&!Ct){let Un=getInternalRouterError(404,{pathname:it.history.location.pathname}),{matches:qn,route:Jn}=getShortCircuitMatches(gt);Qt=qn,mr={[Jn.id]:Un}}Qt&&!it.hydrationData&&Dy(Qt,gt,it.history.location.pathname).active&&(Qt=null);let br;if(Qt)if(Qt.some(Un=>Un.route.lazy))br=!1;else if(!Qt.some(Un=>Un.route.loader))br=!0;else if(Rt.v7_partialHydration){let Un=it.hydrationData?it.hydrationData.loaderData:null,qn=it.hydrationData?it.hydrationData.errors:null;if(qn){let Jn=Qt.findIndex(oo=>qn[oo.route.id]!==void 0);br=Qt.slice(0,Jn+1).every(oo=>!shouldLoadRouteOnHydration(oo.route,Un,qn))}else br=Qt.every(Jn=>!shouldLoadRouteOnHydration(Jn.route,Un,qn))}else br=it.hydrationData!=null;else if(br=!1,Qt=[],Rt.v7_partialHydration){let Un=Dy(null,gt,it.history.location.pathname);Un.active&&Un.matches&&(Qt=Un.matches)}let Fr,kr={historyAction:it.history.action,location:it.history.location,matches:Qt,initialized:br,navigation:IDLE_NAVIGATION,restoreScrollPosition:it.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:it.hydrationData&&it.hydrationData.loaderData||{},actionData:it.hydrationData&&it.hydrationData.actionData||null,errors:it.hydrationData&&it.hydrationData.errors||mr,fetchers:new Map,blockers:new Map},Br=Action.Pop,Nr=!1,jn,Yn=!1,ga=new Map,Kn=null,Xn=!1,eo=!1,lp=[],$a=new Set,ro=new Map,bs=0,ba=-1,Zn=new Map,Qn=new Set,ip=new Map,Sm=new Map,Pm=new Set,Cm=new Map,Im=new Map,Rm;function Nm(){if(Mt=it.history.listen(Un=>{let{action:qn,location:Jn,delta:oo}=Un;if(Rm){Rm(),Rm=void 0;return}warning(Im.size===0||oo!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let _p=dv({currentLocation:kr.location,nextLocation:Jn,historyAction:qn});if(_p&&oo!=null){let wm=new Promise(Am=>{Rm=Am});it.history.go(oo*-1),My(_p,{state:"blocked",location:Jn,proceed(){My(_p,{state:"proceeding",proceed:void 0,reset:void 0,location:Jn}),wm.then(()=>it.history.go(oo))},reset(){let Am=new Map(kr.blockers);Am.set(_p,IDLE_BLOCKER),Tm({blockers:Am})}});return}return zm(qn,Jn)}),lt){restoreAppliedTransitions(_,ga);let Un=()=>persistAppliedTransitions(_,ga);_.addEventListener("pagehide",Un),Kn=()=>_.removeEventListener("pagehide",Un)}return kr.initialized||zm(Action.Pop,kr.location,{initialHydration:!0}),Fr}function Vm(){Mt&&Mt(),Kn&&Kn(),Ot.clear(),jn&&jn.abort(),kr.fetchers.forEach((Un,qn)=>Ry(qn)),kr.blockers.forEach((Un,qn)=>hv(qn))}function Mm(Un){return Ot.add(Un),()=>Ot.delete(Un)}function Tm(Un,qn){qn===void 0&&(qn={}),kr=_extends$2({},kr,Un);let Jn=[],oo=[];Rt.v7_fetcherPersist&&kr.fetchers.forEach((_p,wm)=>{_p.state==="idle"&&(Pm.has(wm)?oo.push(wm):Jn.push(wm))}),[...Ot].forEach(_p=>_p(kr,{deletedFetchers:oo,viewTransitionOpts:qn.viewTransitionOpts,flushSync:qn.flushSync===!0})),Rt.v7_fetcherPersist&&(Jn.forEach(_p=>kr.fetchers.delete(_p)),oo.forEach(_p=>Ry(_p)))}function Om(Un,qn,Jn){var oo,_p;let{flushSync:wm}=Jn===void 0?{}:Jn,Am=kr.actionData!=null&&kr.navigation.formMethod!=null&&isMutationMethod(kr.navigation.formMethod)&&kr.navigation.state==="loading"&&((oo=Un.state)==null?void 0:oo._isRedirect)!==!0,vm;qn.actionData?Object.keys(qn.actionData).length>0?vm=qn.actionData:vm=null:Am?vm=kr.actionData:vm=null;let _m=qn.loaderData?mergeLoaderData(kr.loaderData,qn.loaderData,qn.matches||[],qn.errors):kr.loaderData,dm=kr.blockers;dm.size>0&&(dm=new Map(dm),dm.forEach((Lm,Hm)=>dm.set(Hm,IDLE_BLOCKER)));let Em=Nr===!0||kr.navigation.formMethod!=null&&isMutationMethod(kr.navigation.formMethod)&&((_p=Un.state)==null?void 0:_p._isRedirect)!==!0;bt&&(gt=bt,bt=void 0),Xn||Br===Action.Pop||(Br===Action.Push?it.history.push(Un,Un.state):Br===Action.Replace&&it.history.replace(Un,Un.state));let Dm;if(Br===Action.Pop){let Lm=ga.get(kr.location.pathname);Lm&&Lm.has(Un.pathname)?Dm={currentLocation:kr.location,nextLocation:Un}:ga.has(Un.pathname)&&(Dm={currentLocation:Un,nextLocation:kr.location})}else if(Yn){let Lm=ga.get(kr.location.pathname);Lm?Lm.add(Un.pathname):(Lm=new Set([Un.pathname]),ga.set(kr.location.pathname,Lm)),Dm={currentLocation:kr.location,nextLocation:Un}}Tm(_extends$2({},qn,{actionData:vm,loaderData:_m,historyAction:Br,location:Un,initialized:!0,navigation:IDLE_NAVIGATION,revalidation:"idle",restoreScrollPosition:pv(Un,qn.matches||kr.matches),preventScrollReset:Em,blockers:dm}),{viewTransitionOpts:Dm,flushSync:wm===!0}),Br=Action.Pop,Nr=!1,Yn=!1,Xn=!1,eo=!1,lp=[]}async function $m(Un,qn){if(typeof Un=="number"){it.history.go(Un);return}let Jn=normalizeTo(kr.location,kr.matches,wt,Rt.v7_prependBasename,Un,Rt.v7_relativeSplatPath,qn==null?void 0:qn.fromRouteId,qn==null?void 0:qn.relative),{path:oo,submission:_p,error:wm}=normalizeNavigateOptions(Rt.v7_normalizeFormMethod,!1,Jn,qn),Am=kr.location,vm=createLocation(kr.location,oo,qn&&qn.state);vm=_extends$2({},vm,it.history.encodeLocation(vm));let _m=qn&&qn.replace!=null?qn.replace:void 0,dm=Action.Push;_m===!0?dm=Action.Replace:_m===!1||_p!=null&&isMutationMethod(_p.formMethod)&&_p.formAction===kr.location.pathname+kr.location.search&&(dm=Action.Replace);let Em=qn&&"preventScrollReset"in qn?qn.preventScrollReset===!0:void 0,Dm=(qn&&qn.flushSync)===!0,Lm=dv({currentLocation:Am,nextLocation:vm,historyAction:dm});if(Lm){My(Lm,{state:"blocked",location:vm,proceed(){My(Lm,{state:"proceeding",proceed:void 0,reset:void 0,location:vm}),$m(Un,qn)},reset(){let Hm=new Map(kr.blockers);Hm.set(Lm,IDLE_BLOCKER),Tm({blockers:Hm})}});return}return await zm(dm,vm,{submission:_p,pendingError:wm,preventScrollReset:Em,replace:qn&&qn.replace,enableViewTransition:qn&&qn.viewTransition,flushSync:Dm})}function Xm(){if(Hy(),Tm({revalidation:"loading"}),kr.navigation.state!=="submitting"){if(kr.navigation.state==="idle"){zm(kr.historyAction,kr.location,{startUninterruptedRevalidation:!0});return}zm(Br||kr.historyAction,kr.navigation.location,{overrideNavigation:kr.navigation,enableViewTransition:Yn===!0})}}async function zm(Un,qn,Jn){jn&&jn.abort(),jn=null,Br=Un,Xn=(Jn&&Jn.startUninterruptedRevalidation)===!0,Dv(kr.location,kr.matches),Nr=(Jn&&Jn.preventScrollReset)===!0,Yn=(Jn&&Jn.enableViewTransition)===!0;let oo=bt||gt,_p=Jn&&Jn.overrideNavigation,wm=matchRoutes(oo,qn,wt),Am=(Jn&&Jn.flushSync)===!0,vm=Dy(wm,oo,qn.pathname);if(vm.active&&vm.matches&&(wm=vm.matches),!wm){let{error:Bm,notFoundMatches:km,route:Um}=Wy(qn.pathname);Om(qn,{matches:km,loaderData:{},errors:{[Um.id]:Bm}},{flushSync:Am});return}if(kr.initialized&&!eo&&isHashChangeOnly(kr.location,qn)&&!(Jn&&Jn.submission&&isMutationMethod(Jn.submission.formMethod))){Om(qn,{matches:wm},{flushSync:Am});return}jn=new AbortController;let _m=createClientSideRequest(it.history,qn,jn.signal,Jn&&Jn.submission),dm;if(Jn&&Jn.pendingError)dm=[findNearestBoundary(wm).route.id,{type:ResultType.error,error:Jn.pendingError}];else if(Jn&&Jn.submission&&isMutationMethod(Jn.submission.formMethod)){let Bm=await ny(_m,qn,Jn.submission,wm,vm.active,{replace:Jn.replace,flushSync:Am});if(Bm.shortCircuited)return;if(Bm.pendingActionResult){let[km,Um]=Bm.pendingActionResult;if(isErrorResult(Um)&&isRouteErrorResponse(Um.error)&&Um.error.status===404){jn=null,Om(qn,{matches:Bm.matches,loaderData:{},errors:{[km]:Um.error}});return}}wm=Bm.matches||wm,dm=Bm.pendingActionResult,_p=getLoadingNavigation(qn,Jn.submission),Am=!1,vm.active=!1,_m=createClientSideRequest(it.history,_m.url,_m.signal)}let{shortCircuited:Em,matches:Dm,loaderData:Lm,errors:Hm}=await zy(_m,qn,wm,vm.active,_p,Jn&&Jn.submission,Jn&&Jn.fetcherSubmission,Jn&&Jn.replace,Jn&&Jn.initialHydration===!0,Am,dm);Em||(jn=null,Om(qn,_extends$2({matches:Dm||wm},getActionDataForCommit(dm),{loaderData:Lm,errors:Hm})))}async function ny(Un,qn,Jn,oo,_p,wm){wm===void 0&&(wm={}),Hy();let Am=getSubmittingNavigation(qn,Jn);if(Tm({navigation:Am},{flushSync:wm.flushSync===!0}),_p){let dm=await Oy(oo,qn.pathname,Un.signal);if(dm.type==="aborted")return{shortCircuited:!0};if(dm.type==="error"){let Em=findNearestBoundary(dm.partialMatches).route.id;return{matches:dm.partialMatches,pendingActionResult:[Em,{type:ResultType.error,error:dm.error}]}}else if(dm.matches)oo=dm.matches;else{let{notFoundMatches:Em,error:Dm,route:Lm}=Wy(qn.pathname);return{matches:Em,pendingActionResult:[Lm.id,{type:ResultType.error,error:Dm}]}}}let vm,_m=getTargetMatch(oo,qn);if(!_m.route.action&&!_m.route.lazy)vm={type:ResultType.error,error:getInternalRouterError(405,{method:Un.method,pathname:qn.pathname,routeId:_m.route.id})};else if(vm=(await gy("action",kr,Un,[_m],oo,null))[_m.route.id],Un.signal.aborted)return{shortCircuited:!0};if(isRedirectResult(vm)){let dm;return wm&&wm.replace!=null?dm=wm.replace:dm=normalizeRedirectLocation(vm.response.headers.get("Location"),new URL(Un.url),wt)===kr.location.pathname+kr.location.search,await sy(Un,vm,!0,{submission:Jn,replace:dm}),{shortCircuited:!0}}if(isDeferredResult(vm))throw getInternalRouterError(400,{type:"defer-action"});if(isErrorResult(vm)){let dm=findNearestBoundary(oo,_m.route.id);return(wm&&wm.replace)!==!0&&(Br=Action.Push),{matches:oo,pendingActionResult:[dm.route.id,vm]}}return{matches:oo,pendingActionResult:[_m.route.id,vm]}}async function zy(Un,qn,Jn,oo,_p,wm,Am,vm,_m,dm,Em){let Dm=_p||getLoadingNavigation(qn,wm),Lm=wm||Am||getSubmissionFromNavigation(Dm),Hm=!Xn&&(!Rt.v7_partialHydration||!_m);if(oo){if(Hm){let jm=iy(Em);Tm(_extends$2({navigation:Dm},jm!==void 0?{actionData:jm}:{}),{flushSync:dm})}let Fm=await Oy(Jn,qn.pathname,Un.signal);if(Fm.type==="aborted")return{shortCircuited:!0};if(Fm.type==="error"){let jm=findNearestBoundary(Fm.partialMatches).route.id;return{matches:Fm.partialMatches,loaderData:{},errors:{[jm]:Fm.error}}}else if(Fm.matches)Jn=Fm.matches;else{let{error:jm,notFoundMatches:ly,route:xy}=Wy(qn.pathname);return{matches:ly,loaderData:{},errors:{[xy.id]:jm}}}}let Bm=bt||gt,[km,Um]=getMatchesToLoad(it.history,kr,Jn,Lm,qn,Rt.v7_partialHydration&&_m===!0,Rt.v7_skipActionErrorRevalidation,eo,lp,$a,Pm,ip,Qn,Bm,wt,Em);if(Xy(Fm=>!(Jn&&Jn.some(jm=>jm.route.id===Fm))||km&&km.some(jm=>jm.route.id===Fm)),ba=++bs,km.length===0&&Um.length===0){let Fm=uv();return Om(qn,_extends$2({matches:Jn,loaderData:{},errors:Em&&isErrorResult(Em[1])?{[Em[0]]:Em[1].error}:null},getActionDataForCommit(Em),Fm?{fetchers:new Map(kr.fetchers)}:{}),{flushSync:dm}),{shortCircuited:!0}}if(Hm){let Fm={};if(!oo){Fm.navigation=Dm;let jm=iy(Em);jm!==void 0&&(Fm.actionData=jm)}Um.length>0&&(Fm.fetchers=Sv(Um)),Tm(Fm,{flushSync:dm})}Um.forEach(Fm=>{ty(Fm.key),Fm.controller&&ro.set(Fm.key,Fm.controller)});let ay=()=>Um.forEach(Fm=>ty(Fm.key));jn&&jn.signal.addEventListener("abort",ay);let{loaderResults:yy,fetcherResults:_g}=await ov(kr,Jn,km,Um,Un);if(Un.signal.aborted)return{shortCircuited:!0};jn&&jn.signal.removeEventListener("abort",ay),Um.forEach(Fm=>ro.delete(Fm.key));let Zm=findRedirect(yy);if(Zm)return await sy(Un,Zm.result,!0,{replace:vm}),{shortCircuited:!0};if(Zm=findRedirect(_g),Zm)return Qn.add(Zm.key),await sy(Un,Zm.result,!0,{replace:vm}),{shortCircuited:!0};let{loaderData:Yy,errors:_y}=processLoaderData(kr,Jn,yy,Em,Um,_g,Cm);Cm.forEach((Fm,jm)=>{Fm.subscribe(ly=>{(ly||Fm.done)&&Cm.delete(jm)})}),Rt.v7_partialHydration&&_m&&kr.errors&&(_y=_extends$2({},kr.errors,_y));let oy=uv(),Ly=cv(ba),Fy=oy||Ly||Um.length>0;return _extends$2({matches:Jn,loaderData:Yy,errors:_y},Fy?{fetchers:new Map(kr.fetchers)}:{})}function iy(Un){if(Un&&!isErrorResult(Un[1]))return{[Un[0]]:Un[1].data};if(kr.actionData)return Object.keys(kr.actionData).length===0?null:kr.actionData}function Sv(Un){return Un.forEach(qn=>{let Jn=kr.fetchers.get(qn.key),oo=getLoadingFetcher(void 0,Jn?Jn.data:void 0);kr.fetchers.set(qn.key,oo)}),new Map(kr.fetchers)}function Pv(Un,qn,Jn,oo){if(ft)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");ty(Un);let _p=(oo&&oo.flushSync)===!0,wm=bt||gt,Am=normalizeTo(kr.location,kr.matches,wt,Rt.v7_prependBasename,Jn,Rt.v7_relativeSplatPath,qn,oo==null?void 0:oo.relative),vm=matchRoutes(wm,Am,wt),_m=Dy(vm,wm,Am);if(_m.active&&_m.matches&&(vm=_m.matches),!vm){Qm(Un,qn,getInternalRouterError(404,{pathname:Am}),{flushSync:_p});return}let{path:dm,submission:Em,error:Dm}=normalizeNavigateOptions(Rt.v7_normalizeFormMethod,!0,Am,oo);if(Dm){Qm(Un,qn,Dm,{flushSync:_p});return}let Lm=getTargetMatch(vm,dm),Hm=(oo&&oo.preventScrollReset)===!0;if(Em&&isMutationMethod(Em.formMethod)){Av(Un,qn,dm,Lm,vm,_m.active,_p,Hm,Em);return}ip.set(Un,{routeId:qn,path:dm}),Cv(Un,qn,dm,Lm,vm,_m.active,_p,Hm,Em)}async function Av(Un,qn,Jn,oo,_p,wm,Am,vm,_m){Hy(),ip.delete(Un);function dm(Gm){if(!Gm.route.action&&!Gm.route.lazy){let cy=getInternalRouterError(405,{method:_m.formMethod,pathname:Jn,routeId:qn});return Qm(Un,qn,cy,{flushSync:Am}),!0}return!1}if(!wm&&dm(oo))return;let Em=kr.fetchers.get(Un);ey(Un,getSubmittingFetcher(_m,Em),{flushSync:Am});let Dm=new AbortController,Lm=createClientSideRequest(it.history,Jn,Dm.signal,_m);if(wm){let Gm=await Oy(_p,Jn,Lm.signal);if(Gm.type==="aborted")return;if(Gm.type==="error"){Qm(Un,qn,Gm.error,{flushSync:Am});return}else if(Gm.matches){if(_p=Gm.matches,oo=getTargetMatch(_p,Jn),dm(oo))return}else{Qm(Un,qn,getInternalRouterError(404,{pathname:Jn}),{flushSync:Am});return}}ro.set(Un,Dm);let Hm=bs,km=(await gy("action",kr,Lm,[oo],_p,Un))[oo.route.id];if(Lm.signal.aborted){ro.get(Un)===Dm&&ro.delete(Un);return}if(Rt.v7_fetcherPersist&&Pm.has(Un)){if(isRedirectResult(km)||isErrorResult(km)){ey(Un,getDoneFetcher(void 0));return}}else{if(isRedirectResult(km))if(ro.delete(Un),ba>Hm){ey(Un,getDoneFetcher(void 0));return}else return Qn.add(Un),ey(Un,getLoadingFetcher(_m)),sy(Lm,km,!1,{fetcherSubmission:_m,preventScrollReset:vm});if(isErrorResult(km)){Qm(Un,qn,km.error);return}}if(isDeferredResult(km))throw getInternalRouterError(400,{type:"defer-action"});let Um=kr.navigation.location||kr.location,ay=createClientSideRequest(it.history,Um,Dm.signal),yy=bt||gt,_g=kr.navigation.state!=="idle"?matchRoutes(yy,kr.navigation.location,wt):kr.matches;invariant$1(_g,"Didn't find any matches after fetcher action");let Zm=++bs;Zn.set(Un,Zm);let Yy=getLoadingFetcher(_m,km.data);kr.fetchers.set(Un,Yy);let[_y,oy]=getMatchesToLoad(it.history,kr,_g,_m,Um,!1,Rt.v7_skipActionErrorRevalidation,eo,lp,$a,Pm,ip,Qn,yy,wt,[oo.route.id,km]);oy.filter(Gm=>Gm.key!==Un).forEach(Gm=>{let cy=Gm.key,mv=kr.fetchers.get(cy),Fv=getLoadingFetcher(void 0,mv?mv.data:void 0);kr.fetchers.set(cy,Fv),ty(cy),Gm.controller&&ro.set(cy,Gm.controller)}),Tm({fetchers:new Map(kr.fetchers)});let Ly=()=>oy.forEach(Gm=>ty(Gm.key));Dm.signal.addEventListener("abort",Ly);let{loaderResults:Fy,fetcherResults:Fm}=await ov(kr,_g,_y,oy,ay);if(Dm.signal.aborted)return;Dm.signal.removeEventListener("abort",Ly),Zn.delete(Un),ro.delete(Un),oy.forEach(Gm=>ro.delete(Gm.key));let jm=findRedirect(Fy);if(jm)return sy(ay,jm.result,!1,{preventScrollReset:vm});if(jm=findRedirect(Fm),jm)return Qn.add(jm.key),sy(ay,jm.result,!1,{preventScrollReset:vm});let{loaderData:ly,errors:xy}=processLoaderData(kr,_g,Fy,void 0,oy,Fm,Cm);if(kr.fetchers.has(Un)){let Gm=getDoneFetcher(km.data);kr.fetchers.set(Un,Gm)}cv(Zm),kr.navigation.state==="loading"&&Zm>ba?(invariant$1(Br,"Expected pending action"),jn&&jn.abort(),Om(kr.navigation.location,{matches:_g,loaderData:ly,errors:xy,fetchers:new Map(kr.fetchers)})):(Tm({errors:xy,loaderData:mergeLoaderData(kr.loaderData,ly,_g,xy),fetchers:new Map(kr.fetchers)}),eo=!1)}async function Cv(Un,qn,Jn,oo,_p,wm,Am,vm,_m){let dm=kr.fetchers.get(Un);ey(Un,getLoadingFetcher(_m,dm?dm.data:void 0),{flushSync:Am});let Em=new AbortController,Dm=createClientSideRequest(it.history,Jn,Em.signal);if(wm){let km=await Oy(_p,Jn,Dm.signal);if(km.type==="aborted")return;if(km.type==="error"){Qm(Un,qn,km.error,{flushSync:Am});return}else if(km.matches)_p=km.matches,oo=getTargetMatch(_p,Jn);else{Qm(Un,qn,getInternalRouterError(404,{pathname:Jn}),{flushSync:Am});return}}ro.set(Un,Em);let Lm=bs,Bm=(await gy("loader",kr,Dm,[oo],_p,Un))[oo.route.id];if(isDeferredResult(Bm)&&(Bm=await resolveDeferredData(Bm,Dm.signal,!0)||Bm),ro.get(Un)===Em&&ro.delete(Un),!Dm.signal.aborted){if(Pm.has(Un)){ey(Un,getDoneFetcher(void 0));return}if(isRedirectResult(Bm))if(ba>Lm){ey(Un,getDoneFetcher(void 0));return}else{Qn.add(Un),await sy(Dm,Bm,!1,{preventScrollReset:vm});return}if(isErrorResult(Bm)){Qm(Un,qn,Bm.error);return}invariant$1(!isDeferredResult(Bm),"Unhandled fetcher deferred data"),ey(Un,getDoneFetcher(Bm.data))}}async function sy(Un,qn,Jn,oo){let{submission:_p,fetcherSubmission:wm,preventScrollReset:Am,replace:vm}=oo===void 0?{}:oo;qn.response.headers.has("X-Remix-Revalidate")&&(eo=!0);let _m=qn.response.headers.get("Location");invariant$1(_m,"Expected a Location header on the redirect Response"),_m=normalizeRedirectLocation(_m,new URL(Un.url),wt);let dm=createLocation(kr.location,_m,{_isRedirect:!0});if(lt){let km=!1;if(qn.response.headers.has("X-Remix-Reload-Document"))km=!0;else if(ABSOLUTE_URL_REGEX$1.test(_m)){const Um=it.history.createURL(_m);km=Um.origin!==_.location.origin||stripBasename(Um.pathname,wt)==null}if(km){vm?_.location.replace(_m):_.location.assign(_m);return}}jn=null;let Em=vm===!0||qn.response.headers.has("X-Remix-Replace")?Action.Replace:Action.Push,{formMethod:Dm,formAction:Lm,formEncType:Hm}=kr.navigation;!_p&&!wm&&Dm&&Lm&&Hm&&(_p=getSubmissionFromNavigation(kr.navigation));let Bm=_p||wm;if(redirectPreserveMethodStatusCodes.has(qn.response.status)&&Bm&&isMutationMethod(Bm.formMethod))await zm(Em,dm,{submission:_extends$2({},Bm,{formAction:_m}),preventScrollReset:Am||Nr,enableViewTransition:Jn?Yn:void 0});else{let km=getLoadingNavigation(dm,_p);await zm(Em,dm,{overrideNavigation:km,fetcherSubmission:wm,preventScrollReset:Am||Nr,enableViewTransition:Jn?Yn:void 0})}}async function gy(Un,qn,Jn,oo,_p,wm){let Am,vm={};try{Am=await callDataStrategyImpl(vt,Un,qn,Jn,oo,_p,wm,pt,mt)}catch(_m){return oo.forEach(dm=>{vm[dm.route.id]={type:ResultType.error,error:_m}}),vm}for(let[_m,dm]of Object.entries(Am))if(isRedirectDataStrategyResultResult(dm)){let Em=dm.result;vm[_m]={type:ResultType.redirect,response:normalizeRelativeRoutingRedirectResponse(Em,Jn,_m,_p,wt,Rt.v7_relativeSplatPath)}}else vm[_m]=await convertDataStrategyResultToDataResult(dm);return vm}async function ov(Un,qn,Jn,oo,_p){let wm=Un.matches,Am=gy("loader",Un,_p,Jn,qn,null),vm=Promise.all(oo.map(async Em=>{if(Em.matches&&Em.match&&Em.controller){let Lm=(await gy("loader",Un,createClientSideRequest(it.history,Em.path,Em.controller.signal),[Em.match],Em.matches,Em.key))[Em.match.route.id];return{[Em.key]:Lm}}else return Promise.resolve({[Em.key]:{type:ResultType.error,error:getInternalRouterError(404,{pathname:Em.path})}})})),_m=await Am,dm=(await vm).reduce((Em,Dm)=>Object.assign(Em,Dm),{});return await Promise.all([resolveNavigationDeferredResults(qn,_m,_p.signal,wm,Un.loaderData),resolveFetcherDeferredResults(qn,dm,oo)]),{loaderResults:_m,fetcherResults:dm}}function Hy(){eo=!0,lp.push(...Xy()),ip.forEach((Un,qn)=>{ro.has(qn)&&$a.add(qn),ty(qn)})}function ey(Un,qn,Jn){Jn===void 0&&(Jn={}),kr.fetchers.set(Un,qn),Tm({fetchers:new Map(kr.fetchers)},{flushSync:(Jn&&Jn.flushSync)===!0})}function Qm(Un,qn,Jn,oo){oo===void 0&&(oo={});let _p=findNearestBoundary(kr.matches,qn);Ry(Un),Tm({errors:{[_p.route.id]:Jn},fetchers:new Map(kr.fetchers)},{flushSync:(oo&&oo.flushSync)===!0})}function av(Un){return Rt.v7_fetcherPersist&&(Sm.set(Un,(Sm.get(Un)||0)+1),Pm.has(Un)&&Pm.delete(Un)),kr.fetchers.get(Un)||IDLE_FETCHER}function Ry(Un){let qn=kr.fetchers.get(Un);ro.has(Un)&&!(qn&&qn.state==="loading"&&Zn.has(Un))&&ty(Un),ip.delete(Un),Zn.delete(Un),Qn.delete(Un),Pm.delete(Un),$a.delete(Un),kr.fetchers.delete(Un)}function Iv(Un){if(Rt.v7_fetcherPersist){let qn=(Sm.get(Un)||0)-1;qn<=0?(Sm.delete(Un),Pm.add(Un)):Sm.set(Un,qn)}else Ry(Un);Tm({fetchers:new Map(kr.fetchers)})}function ty(Un){let qn=ro.get(Un);qn&&(qn.abort(),ro.delete(Un))}function lv(Un){for(let qn of Un){let Jn=av(qn),oo=getDoneFetcher(Jn.data);kr.fetchers.set(qn,oo)}}function uv(){let Un=[],qn=!1;for(let Jn of Qn){let oo=kr.fetchers.get(Jn);invariant$1(oo,"Expected fetcher: "+Jn),oo.state==="loading"&&(Qn.delete(Jn),Un.push(Jn),qn=!0)}return lv(Un),qn}function cv(Un){let qn=[];for(let[Jn,oo]of Zn)if(oo<Un){let _p=kr.fetchers.get(Jn);invariant$1(_p,"Expected fetcher: "+Jn),_p.state==="loading"&&(ty(Jn),Zn.delete(Jn),qn.push(Jn))}return lv(qn),qn.length>0}function Rv(Un,qn){let Jn=kr.blockers.get(Un)||IDLE_BLOCKER;return Im.get(Un)!==qn&&Im.set(Un,qn),Jn}function hv(Un){kr.blockers.delete(Un),Im.delete(Un)}function My(Un,qn){let Jn=kr.blockers.get(Un)||IDLE_BLOCKER;invariant$1(Jn.state==="unblocked"&&qn.state==="blocked"||Jn.state==="blocked"&&qn.state==="blocked"||Jn.state==="blocked"&&qn.state==="proceeding"||Jn.state==="blocked"&&qn.state==="unblocked"||Jn.state==="proceeding"&&qn.state==="unblocked","Invalid blocker state transition: "+Jn.state+" -> "+qn.state);let oo=new Map(kr.blockers);oo.set(Un,qn),Tm({blockers:oo})}function dv(Un){let{currentLocation:qn,nextLocation:Jn,historyAction:oo}=Un;if(Im.size===0)return;Im.size>1&&warning(!1,"A router only supports one blocker at a time");let _p=Array.from(Im.entries()),[wm,Am]=_p[_p.length-1],vm=kr.blockers.get(wm);if(!(vm&&vm.state==="proceeding")&&Am({currentLocation:qn,nextLocation:Jn,historyAction:oo}))return wm}function Wy(Un){let qn=getInternalRouterError(404,{pathname:Un}),Jn=bt||gt,{matches:oo,route:_p}=getShortCircuitMatches(Jn);return Xy(),{notFoundMatches:oo,route:_p,error:qn}}function Xy(Un){let qn=[];return Cm.forEach((Jn,oo)=>{(!Un||Un(oo))&&(Jn.cancel(),qn.push(oo),Cm.delete(oo))}),qn}function Mv(Un,qn,Jn){if(Nt=Un,Kt=qn,Ht=Jn||null,!hr&&kr.navigation===IDLE_NAVIGATION){hr=!0;let oo=pv(kr.location,kr.matches);oo!=null&&Tm({restoreScrollPosition:oo})}return()=>{Nt=null,Kt=null,Ht=null}}function fv(Un,qn){return Ht&&Ht(Un,qn.map(oo=>convertRouteMatchToUiMatch(oo,kr.loaderData)))||Un.key}function Dv(Un,qn){if(Nt&&Kt){let Jn=fv(Un,qn);Nt[Jn]=Kt()}}function pv(Un,qn){if(Nt){let Jn=fv(Un,qn),oo=Nt[Jn];if(typeof oo=="number")return oo}return null}function Dy(Un,qn,Jn){if(Ct)if(Un){if(Object.keys(Un[0].params).length>0)return{active:!0,matches:matchRoutesImpl(qn,Jn,wt,!0)}}else return{active:!0,matches:matchRoutesImpl(qn,Jn,wt,!0)||[]};return{active:!1,matches:null}}async function Oy(Un,qn,Jn){if(!Ct)return{type:"success",matches:Un};let oo=Un;for(;;){let _p=bt==null,wm=bt||gt,Am=pt;try{await Ct({path:qn,matches:oo,patch:(dm,Em)=>{Jn.aborted||patchRoutesImpl(dm,Em,wm,Am,mt)}})}catch(dm){return{type:"error",error:dm,partialMatches:oo}}finally{_p&&!Jn.aborted&&(gt=[...gt])}if(Jn.aborted)return{type:"aborted"};let vm=matchRoutes(wm,qn,wt);if(vm)return{type:"success",matches:vm};let _m=matchRoutesImpl(wm,qn,wt,!0);if(!_m||oo.length===_m.length&&oo.every((dm,Em)=>dm.route.id===_m[Em].route.id))return{type:"success",matches:null};oo=_m}}function Ov(Un){pt={},bt=convertRoutesToDataRoutes(Un,mt,void 0,pt)}function Lv(Un,qn){let Jn=bt==null;patchRoutesImpl(Un,qn,bt||gt,pt,mt),Jn&&(gt=[...gt],Tm({}))}return Fr={get basename(){return wt},get future(){return Rt},get state(){return kr},get routes(){return gt},get window(){return _},initialize:Nm,subscribe:Mm,enableScrollRestoration:Mv,navigate:$m,fetch:Pv,revalidate:Xm,createHref:Un=>it.history.createHref(Un),encodeLocation:Un=>it.history.encodeLocation(Un),getFetcher:av,deleteFetcher:Iv,dispose:Vm,getBlocker:Rv,deleteBlocker:hv,patchRoutes:Lv,_internalFetchControllers:ro,_internalActiveDeferreds:Cm,_internalSetRoutes:Ov},Fr}function isSubmissionNavigation(it){return it!=null&&("formData"in it&&it.formData!=null||"body"in it&&it.body!==void 0)}function normalizeTo(it,_,lt,ft,mt,pt,gt,bt){let wt,vt;if(gt){wt=[];for(let Rt of _)if(wt.push(Rt),Rt.route.id===gt){vt=Rt;break}}else wt=_,vt=_[_.length-1];let Ct=resolveTo(mt||".",getResolveToMatches(wt,pt),stripBasename(it.pathname,lt)||it.pathname,bt==="path");if(mt==null&&(Ct.search=it.search,Ct.hash=it.hash),(mt==null||mt===""||mt===".")&&vt){let Rt=hasNakedIndexQuery(Ct.search);if(vt.route.index&&!Rt)Ct.search=Ct.search?Ct.search.replace(/^\?/,"?index&"):"?index";else if(!vt.route.index&&Rt){let Mt=new URLSearchParams(Ct.search),Ot=Mt.getAll("index");Mt.delete("index"),Ot.filter(Ht=>Ht).forEach(Ht=>Mt.append("index",Ht));let Nt=Mt.toString();Ct.search=Nt?"?"+Nt:""}}return ft&&lt!=="/"&&(Ct.pathname=Ct.pathname==="/"?lt:joinPaths([lt,Ct.pathname])),createPath(Ct)}function normalizeNavigateOptions(it,_,lt,ft){if(!ft||!isSubmissionNavigation(ft))return{path:lt};if(ft.formMethod&&!isValidMethod(ft.formMethod))return{path:lt,error:getInternalRouterError(405,{method:ft.formMethod})};let mt=()=>({path:lt,error:getInternalRouterError(400,{type:"invalid-body"})}),pt=ft.formMethod||"get",gt=it?pt.toUpperCase():pt.toLowerCase(),bt=stripHashFromPath(lt);if(ft.body!==void 0){if(ft.formEncType==="text/plain"){if(!isMutationMethod(gt))return mt();let Mt=typeof ft.body=="string"?ft.body:ft.body instanceof FormData||ft.body instanceof URLSearchParams?Array.from(ft.body.entries()).reduce((Ot,Nt)=>{let[Ht,Kt]=Nt;return""+Ot+Ht+"="+Kt+`
`},""):String(ft.body);return{path:lt,submission:{formMethod:gt,formAction:bt,formEncType:ft.formEncType,formData:void 0,json:void 0,text:Mt}}}else if(ft.formEncType==="application/json"){if(!isMutationMethod(gt))return mt();try{let Mt=typeof ft.body=="string"?JSON.parse(ft.body):ft.body;return{path:lt,submission:{formMethod:gt,formAction:bt,formEncType:ft.formEncType,formData:void 0,json:Mt,text:void 0}}}catch{return mt()}}}invariant$1(typeof FormData=="function","FormData is not available in this environment");let wt,vt;if(ft.formData)wt=convertFormDataToSearchParams(ft.formData),vt=ft.formData;else if(ft.body instanceof FormData)wt=convertFormDataToSearchParams(ft.body),vt=ft.body;else if(ft.body instanceof URLSearchParams)wt=ft.body,vt=convertSearchParamsToFormData(wt);else if(ft.body==null)wt=new URLSearchParams,vt=new FormData;else try{wt=new URLSearchParams(ft.body),vt=convertSearchParamsToFormData(wt)}catch{return mt()}let Ct={formMethod:gt,formAction:bt,formEncType:ft&&ft.formEncType||"application/x-www-form-urlencoded",formData:vt,json:void 0,text:void 0};if(isMutationMethod(Ct.formMethod))return{path:lt,submission:Ct};let Rt=parsePath(lt);return _&&Rt.search&&hasNakedIndexQuery(Rt.search)&&wt.append("index",""),Rt.search="?"+wt,{path:createPath(Rt),submission:Ct}}function getLoaderMatchesUntilBoundary(it,_,lt){lt===void 0&&(lt=!1);let ft=it.findIndex(mt=>mt.route.id===_);return ft>=0?it.slice(0,lt?ft+1:ft):it}function getMatchesToLoad(it,_,lt,ft,mt,pt,gt,bt,wt,vt,Ct,Rt,Mt,Ot,Nt,Ht){let Kt=Ht?isErrorResult(Ht[1])?Ht[1].error:Ht[1].data:void 0,hr=it.createURL(_.location),Qt=it.createURL(mt),mr=lt;pt&&_.errors?mr=getLoaderMatchesUntilBoundary(lt,Object.keys(_.errors)[0],!0):Ht&&isErrorResult(Ht[1])&&(mr=getLoaderMatchesUntilBoundary(lt,Ht[0]));let br=Ht?Ht[1].statusCode:void 0,Fr=gt&&br&&br>=400,kr=mr.filter((Nr,jn)=>{let{route:Yn}=Nr;if(Yn.lazy)return!0;if(Yn.loader==null)return!1;if(pt)return shouldLoadRouteOnHydration(Yn,_.loaderData,_.errors);if(isNewLoader(_.loaderData,_.matches[jn],Nr)||wt.some(Xn=>Xn===Nr.route.id))return!0;let ga=_.matches[jn],Kn=Nr;return shouldRevalidateLoader(Nr,_extends$2({currentUrl:hr,currentParams:ga.params,nextUrl:Qt,nextParams:Kn.params},ft,{actionResult:Kt,actionStatus:br,defaultShouldRevalidate:Fr?!1:bt||hr.pathname+hr.search===Qt.pathname+Qt.search||hr.search!==Qt.search||isNewRouteInstance(ga,Kn)}))}),Br=[];return Rt.forEach((Nr,jn)=>{if(pt||!lt.some(eo=>eo.route.id===Nr.routeId)||Ct.has(jn))return;let Yn=matchRoutes(Ot,Nr.path,Nt);if(!Yn){Br.push({key:jn,routeId:Nr.routeId,path:Nr.path,matches:null,match:null,controller:null});return}let ga=_.fetchers.get(jn),Kn=getTargetMatch(Yn,Nr.path),Xn=!1;Mt.has(jn)?Xn=!1:vt.has(jn)?(vt.delete(jn),Xn=!0):ga&&ga.state!=="idle"&&ga.data===void 0?Xn=bt:Xn=shouldRevalidateLoader(Kn,_extends$2({currentUrl:hr,currentParams:_.matches[_.matches.length-1].params,nextUrl:Qt,nextParams:lt[lt.length-1].params},ft,{actionResult:Kt,actionStatus:br,defaultShouldRevalidate:Fr?!1:bt})),Xn&&Br.push({key:jn,routeId:Nr.routeId,path:Nr.path,matches:Yn,match:Kn,controller:new AbortController})}),[kr,Br]}function shouldLoadRouteOnHydration(it,_,lt){if(it.lazy)return!0;if(!it.loader)return!1;let ft=_!=null&&_[it.id]!==void 0,mt=lt!=null&&lt[it.id]!==void 0;return!ft&&mt?!1:typeof it.loader=="function"&&it.loader.hydrate===!0?!0:!ft&&!mt}function isNewLoader(it,_,lt){let ft=!_||lt.route.id!==_.route.id,mt=it[lt.route.id]===void 0;return ft||mt}function isNewRouteInstance(it,_){let lt=it.route.path;return it.pathname!==_.pathname||lt!=null&&lt.endsWith("*")&&it.params["*"]!==_.params["*"]}function shouldRevalidateLoader(it,_){if(it.route.shouldRevalidate){let lt=it.route.shouldRevalidate(_);if(typeof lt=="boolean")return lt}return _.defaultShouldRevalidate}function patchRoutesImpl(it,_,lt,ft,mt){var pt;let gt;if(it){let vt=ft[it];invariant$1(vt,"No route found to patch children into: routeId = "+it),vt.children||(vt.children=[]),gt=vt.children}else gt=lt;let bt=_.filter(vt=>!gt.some(Ct=>isSameRoute(vt,Ct))),wt=convertRoutesToDataRoutes(bt,mt,[it||"_","patch",String(((pt=gt)==null?void 0:pt.length)||"0")],ft);gt.push(...wt)}function isSameRoute(it,_){return"id"in it&&"id"in _&&it.id===_.id?!0:it.index===_.index&&it.path===_.path&&it.caseSensitive===_.caseSensitive?(!it.children||it.children.length===0)&&(!_.children||_.children.length===0)?!0:it.children.every((lt,ft)=>{var mt;return(mt=_.children)==null?void 0:mt.some(pt=>isSameRoute(lt,pt))}):!1}async function loadLazyRouteModule(it,_,lt){if(!it.lazy)return;let ft=await it.lazy();if(!it.lazy)return;let mt=lt[it.id];invariant$1(mt,"No route found in manifest");let pt={};for(let gt in ft){let wt=mt[gt]!==void 0&&gt!=="hasErrorBoundary";warning(!wt,'Route "'+mt.id+'" has a static property "'+gt+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+gt+'" will be ignored.')),!wt&&!immutableRouteKeys.has(gt)&&(pt[gt]=ft[gt])}Object.assign(mt,pt),Object.assign(mt,_extends$2({},_(mt),{lazy:void 0}))}async function defaultDataStrategy(it){let{matches:_}=it,lt=_.filter(mt=>mt.shouldLoad);return(await Promise.all(lt.map(mt=>mt.resolve()))).reduce((mt,pt,gt)=>Object.assign(mt,{[lt[gt].route.id]:pt}),{})}async function callDataStrategyImpl(it,_,lt,ft,mt,pt,gt,bt,wt,vt){let Ct=pt.map(Ot=>Ot.route.lazy?loadLazyRouteModule(Ot.route,wt,bt):void 0),Rt=pt.map((Ot,Nt)=>{let Ht=Ct[Nt],Kt=mt.some(Qt=>Qt.route.id===Ot.route.id);return _extends$2({},Ot,{shouldLoad:Kt,resolve:async Qt=>(Qt&&ft.method==="GET"&&(Ot.route.lazy||Ot.route.loader)&&(Kt=!0),Kt?callLoaderOrAction(_,ft,Ot,Ht,Qt,vt):Promise.resolve({type:ResultType.data,result:void 0}))})}),Mt=await it({matches:Rt,request:ft,params:pt[0].params,fetcherKey:gt,context:vt});try{await Promise.all(Ct)}catch{}return Mt}async function callLoaderOrAction(it,_,lt,ft,mt,pt){let gt,bt,wt=vt=>{let Ct,Rt=new Promise((Nt,Ht)=>Ct=Ht);bt=()=>Ct(),_.signal.addEventListener("abort",bt);let Mt=Nt=>typeof vt!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+it+'" [routeId: '+lt.route.id+"]"))):vt({request:_,params:lt.params,context:pt},...Nt!==void 0?[Nt]:[]),Ot=(async()=>{try{return{type:"data",result:await(mt?mt(Ht=>Mt(Ht)):Mt())}}catch(Nt){return{type:"error",result:Nt}}})();return Promise.race([Ot,Rt])};try{let vt=lt.route[it];if(ft)if(vt){let Ct,[Rt]=await Promise.all([wt(vt).catch(Mt=>{Ct=Mt}),ft]);if(Ct!==void 0)throw Ct;gt=Rt}else if(await ft,vt=lt.route[it],vt)gt=await wt(vt);else if(it==="action"){let Ct=new URL(_.url),Rt=Ct.pathname+Ct.search;throw getInternalRouterError(405,{method:_.method,pathname:Rt,routeId:lt.route.id})}else return{type:ResultType.data,result:void 0};else if(vt)gt=await wt(vt);else{let Ct=new URL(_.url),Rt=Ct.pathname+Ct.search;throw getInternalRouterError(404,{pathname:Rt})}invariant$1(gt.result!==void 0,"You defined "+(it==="action"?"an action":"a loader")+" for route "+('"'+lt.route.id+"\" but didn't return anything from your `"+it+"` ")+"function. Please return a value or `null`.")}catch(vt){return{type:ResultType.error,result:vt}}finally{bt&&_.signal.removeEventListener("abort",bt)}return gt}async function convertDataStrategyResultToDataResult(it){let{result:_,type:lt}=it;if(isResponse(_)){let vt;try{let Ct=_.headers.get("Content-Type");Ct&&/\bapplication\/json\b/.test(Ct)?_.body==null?vt=null:vt=await _.json():vt=await _.text()}catch(Ct){return{type:ResultType.error,error:Ct}}return lt===ResultType.error?{type:ResultType.error,error:new ErrorResponseImpl(_.status,_.statusText,vt),statusCode:_.status,headers:_.headers}:{type:ResultType.data,data:vt,statusCode:_.status,headers:_.headers}}if(lt===ResultType.error){if(isDataWithResponseInit(_)){var ft;if(_.data instanceof Error){var mt;return{type:ResultType.error,error:_.data,statusCode:(mt=_.init)==null?void 0:mt.status}}_=new ErrorResponseImpl(((ft=_.init)==null?void 0:ft.status)||500,void 0,_.data)}return{type:ResultType.error,error:_,statusCode:isRouteErrorResponse(_)?_.status:void 0}}if(isDeferredData(_)){var pt,gt;return{type:ResultType.deferred,deferredData:_,statusCode:(pt=_.init)==null?void 0:pt.status,headers:((gt=_.init)==null?void 0:gt.headers)&&new Headers(_.init.headers)}}if(isDataWithResponseInit(_)){var bt,wt;return{type:ResultType.data,data:_.data,statusCode:(bt=_.init)==null?void 0:bt.status,headers:(wt=_.init)!=null&&wt.headers?new Headers(_.init.headers):void 0}}return{type:ResultType.data,data:_}}function normalizeRelativeRoutingRedirectResponse(it,_,lt,ft,mt,pt){let gt=it.headers.get("Location");if(invariant$1(gt,"Redirects returned/thrown from loaders/actions must have a Location header"),!ABSOLUTE_URL_REGEX$1.test(gt)){let bt=ft.slice(0,ft.findIndex(wt=>wt.route.id===lt)+1);gt=normalizeTo(new URL(_.url),bt,mt,!0,gt,pt),it.headers.set("Location",gt)}return it}function normalizeRedirectLocation(it,_,lt){if(ABSOLUTE_URL_REGEX$1.test(it)){let ft=it,mt=ft.startsWith("//")?new URL(_.protocol+ft):new URL(ft),pt=stripBasename(mt.pathname,lt)!=null;if(mt.origin===_.origin&&pt)return mt.pathname+mt.search+mt.hash}return it}function createClientSideRequest(it,_,lt,ft){let mt=it.createURL(stripHashFromPath(_)).toString(),pt={signal:lt};if(ft&&isMutationMethod(ft.formMethod)){let{formMethod:gt,formEncType:bt}=ft;pt.method=gt.toUpperCase(),bt==="application/json"?(pt.headers=new Headers({"Content-Type":bt}),pt.body=JSON.stringify(ft.json)):bt==="text/plain"?pt.body=ft.text:bt==="application/x-www-form-urlencoded"&&ft.formData?pt.body=convertFormDataToSearchParams(ft.formData):pt.body=ft.formData}return new Request(mt,pt)}function convertFormDataToSearchParams(it){let _=new URLSearchParams;for(let[lt,ft]of it.entries())_.append(lt,typeof ft=="string"?ft:ft.name);return _}function convertSearchParamsToFormData(it){let _=new FormData;for(let[lt,ft]of it.entries())_.append(lt,ft);return _}function processRouteLoaderData(it,_,lt,ft,mt){let pt={},gt=null,bt,wt=!1,vt={},Ct=lt&&isErrorResult(lt[1])?lt[1].error:void 0;return it.forEach(Rt=>{if(!(Rt.route.id in _))return;let Mt=Rt.route.id,Ot=_[Mt];if(invariant$1(!isRedirectResult(Ot),"Cannot handle redirect results in processLoaderData"),isErrorResult(Ot)){let Nt=Ot.error;Ct!==void 0&&(Nt=Ct,Ct=void 0),gt=gt||{};{let Ht=findNearestBoundary(it,Mt);gt[Ht.route.id]==null&&(gt[Ht.route.id]=Nt)}pt[Mt]=void 0,wt||(wt=!0,bt=isRouteErrorResponse(Ot.error)?Ot.error.status:500),Ot.headers&&(vt[Mt]=Ot.headers)}else isDeferredResult(Ot)?(ft.set(Mt,Ot.deferredData),pt[Mt]=Ot.deferredData.data,Ot.statusCode!=null&&Ot.statusCode!==200&&!wt&&(bt=Ot.statusCode),Ot.headers&&(vt[Mt]=Ot.headers)):(pt[Mt]=Ot.data,Ot.statusCode&&Ot.statusCode!==200&&!wt&&(bt=Ot.statusCode),Ot.headers&&(vt[Mt]=Ot.headers))}),Ct!==void 0&&lt&&(gt={[lt[0]]:Ct},pt[lt[0]]=void 0),{loaderData:pt,errors:gt,statusCode:bt||200,loaderHeaders:vt}}function processLoaderData(it,_,lt,ft,mt,pt,gt){let{loaderData:bt,errors:wt}=processRouteLoaderData(_,lt,ft,gt);return mt.forEach(vt=>{let{key:Ct,match:Rt,controller:Mt}=vt,Ot=pt[Ct];if(invariant$1(Ot,"Did not find corresponding fetcher result"),!(Mt&&Mt.signal.aborted))if(isErrorResult(Ot)){let Nt=findNearestBoundary(it.matches,Rt==null?void 0:Rt.route.id);wt&&wt[Nt.route.id]||(wt=_extends$2({},wt,{[Nt.route.id]:Ot.error})),it.fetchers.delete(Ct)}else if(isRedirectResult(Ot))invariant$1(!1,"Unhandled fetcher revalidation redirect");else if(isDeferredResult(Ot))invariant$1(!1,"Unhandled fetcher deferred data");else{let Nt=getDoneFetcher(Ot.data);it.fetchers.set(Ct,Nt)}}),{loaderData:bt,errors:wt}}function mergeLoaderData(it,_,lt,ft){let mt=_extends$2({},_);for(let pt of lt){let gt=pt.route.id;if(_.hasOwnProperty(gt)?_[gt]!==void 0&&(mt[gt]=_[gt]):it[gt]!==void 0&&pt.route.loader&&(mt[gt]=it[gt]),ft&&ft.hasOwnProperty(gt))break}return mt}function getActionDataForCommit(it){return it?isErrorResult(it[1])?{actionData:{}}:{actionData:{[it[0]]:it[1].data}}:{}}function findNearestBoundary(it,_){return(_?it.slice(0,it.findIndex(ft=>ft.route.id===_)+1):[...it]).reverse().find(ft=>ft.route.hasErrorBoundary===!0)||it[0]}function getShortCircuitMatches(it){let _=it.length===1?it[0]:it.find(lt=>lt.index||!lt.path||lt.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:_}],route:_}}function getInternalRouterError(it,_){let{pathname:lt,routeId:ft,method:mt,type:pt,message:gt}=_===void 0?{}:_,bt="Unknown Server Error",wt="Unknown @remix-run/router error";return it===400?(bt="Bad Request",mt&&lt&&ft?wt="You made a "+mt+' request to "'+lt+'" but '+('did not provide a `loader` for route "'+ft+'", ')+"so there is no way to handle the request.":pt==="defer-action"?wt="defer() is not supported in actions":pt==="invalid-body"&&(wt="Unable to encode submission body")):it===403?(bt="Forbidden",wt='Route "'+ft+'" does not match URL "'+lt+'"'):it===404?(bt="Not Found",wt='No route matches URL "'+lt+'"'):it===405&&(bt="Method Not Allowed",mt&&lt&&ft?wt="You made a "+mt.toUpperCase()+' request to "'+lt+'" but '+('did not provide an `action` for route "'+ft+'", ')+"so there is no way to handle the request.":mt&&(wt='Invalid request method "'+mt.toUpperCase()+'"')),new ErrorResponseImpl(it||500,bt,new Error(wt),!0)}function findRedirect(it){let _=Object.entries(it);for(let lt=_.length-1;lt>=0;lt--){let[ft,mt]=_[lt];if(isRedirectResult(mt))return{key:ft,result:mt}}}function stripHashFromPath(it){let _=typeof it=="string"?parsePath(it):it;return createPath(_extends$2({},_,{hash:""}))}function isHashChangeOnly(it,_){return it.pathname!==_.pathname||it.search!==_.search?!1:it.hash===""?_.hash!=="":it.hash===_.hash?!0:_.hash!==""}function isRedirectDataStrategyResultResult(it){return isResponse(it.result)&&redirectStatusCodes.has(it.result.status)}function isDeferredResult(it){return it.type===ResultType.deferred}function isErrorResult(it){return it.type===ResultType.error}function isRedirectResult(it){return(it&&it.type)===ResultType.redirect}function isDataWithResponseInit(it){return typeof it=="object"&&it!=null&&"type"in it&&"data"in it&&"init"in it&&it.type==="DataWithResponseInit"}function isDeferredData(it){let _=it;return _&&typeof _=="object"&&typeof _.data=="object"&&typeof _.subscribe=="function"&&typeof _.cancel=="function"&&typeof _.resolveData=="function"}function isResponse(it){return it!=null&&typeof it.status=="number"&&typeof it.statusText=="string"&&typeof it.headers=="object"&&typeof it.body<"u"}function isValidMethod(it){return validRequestMethods.has(it.toLowerCase())}function isMutationMethod(it){return validMutationMethods.has(it.toLowerCase())}async function resolveNavigationDeferredResults(it,_,lt,ft,mt){let pt=Object.entries(_);for(let gt=0;gt<pt.length;gt++){let[bt,wt]=pt[gt],vt=it.find(Mt=>(Mt==null?void 0:Mt.route.id)===bt);if(!vt)continue;let Ct=ft.find(Mt=>Mt.route.id===vt.route.id),Rt=Ct!=null&&!isNewRouteInstance(Ct,vt)&&(mt&&mt[vt.route.id])!==void 0;isDeferredResult(wt)&&Rt&&await resolveDeferredData(wt,lt,!1).then(Mt=>{Mt&&(_[bt]=Mt)})}}async function resolveFetcherDeferredResults(it,_,lt){for(let ft=0;ft<lt.length;ft++){let{key:mt,routeId:pt,controller:gt}=lt[ft],bt=_[mt];it.find(vt=>(vt==null?void 0:vt.route.id)===pt)&&isDeferredResult(bt)&&(invariant$1(gt,"Expected an AbortController for revalidating fetcher deferred result"),await resolveDeferredData(bt,gt.signal,!0).then(vt=>{vt&&(_[mt]=vt)}))}}async function resolveDeferredData(it,_,lt){if(lt===void 0&&(lt=!1),!await it.deferredData.resolveData(_)){if(lt)try{return{type:ResultType.data,data:it.deferredData.unwrappedData}}catch(mt){return{type:ResultType.error,error:mt}}return{type:ResultType.data,data:it.deferredData.data}}}function hasNakedIndexQuery(it){return new URLSearchParams(it).getAll("index").some(_=>_==="")}function getTargetMatch(it,_){let lt=typeof _=="string"?parsePath(_).search:_.search;if(it[it.length-1].route.index&&hasNakedIndexQuery(lt||""))return it[it.length-1];let ft=getPathContributingMatches(it);return ft[ft.length-1]}function getSubmissionFromNavigation(it){let{formMethod:_,formAction:lt,formEncType:ft,text:mt,formData:pt,json:gt}=it;if(!(!_||!lt||!ft)){if(mt!=null)return{formMethod:_,formAction:lt,formEncType:ft,formData:void 0,json:void 0,text:mt};if(pt!=null)return{formMethod:_,formAction:lt,formEncType:ft,formData:pt,json:void 0,text:void 0};if(gt!==void 0)return{formMethod:_,formAction:lt,formEncType:ft,formData:void 0,json:gt,text:void 0}}}function getLoadingNavigation(it,_){return _?{state:"loading",location:it,formMethod:_.formMethod,formAction:_.formAction,formEncType:_.formEncType,formData:_.formData,json:_.json,text:_.text}:{state:"loading",location:it,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function getSubmittingNavigation(it,_){return{state:"submitting",location:it,formMethod:_.formMethod,formAction:_.formAction,formEncType:_.formEncType,formData:_.formData,json:_.json,text:_.text}}function getLoadingFetcher(it,_){return it?{state:"loading",formMethod:it.formMethod,formAction:it.formAction,formEncType:it.formEncType,formData:it.formData,json:it.json,text:it.text,data:_}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:_}}function getSubmittingFetcher(it,_){return{state:"submitting",formMethod:it.formMethod,formAction:it.formAction,formEncType:it.formEncType,formData:it.formData,json:it.json,text:it.text,data:_?_.data:void 0}}function getDoneFetcher(it){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:it}}function restoreAppliedTransitions(it,_){try{let lt=it.sessionStorage.getItem(TRANSITIONS_STORAGE_KEY);if(lt){let ft=JSON.parse(lt);for(let[mt,pt]of Object.entries(ft||{}))pt&&Array.isArray(pt)&&_.set(mt,new Set(pt||[]))}}catch{}}function persistAppliedTransitions(it,_){if(_.size>0){let lt={};for(let[ft,mt]of _)lt[ft]=[...mt];try{it.sessionStorage.setItem(TRANSITIONS_STORAGE_KEY,JSON.stringify(lt))}catch(ft){warning(!1,"Failed to save applied view transitions in sessionStorage ("+ft+").")}}}/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(it){for(var _=1;_<arguments.length;_++){var lt=arguments[_];for(var ft in lt)Object.prototype.hasOwnProperty.call(lt,ft)&&(it[ft]=lt[ft])}return it},_extends$1.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useHref(it,_){let{relative:lt}=_===void 0?{}:_;useInRouterContext()||invariant$1(!1);let{basename:ft,navigator:mt}=reactExports.useContext(NavigationContext),{hash:pt,pathname:gt,search:bt}=useResolvedPath(it,{relative:lt}),wt=gt;return ft!=="/"&&(wt=gt==="/"?ft:joinPaths([ft,gt])),mt.createHref({pathname:wt,search:bt,hash:pt})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return useInRouterContext()||invariant$1(!1),reactExports.useContext(LocationContext).location}function useIsomorphicLayoutEffect$1(it){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(it)}function useNavigate(){let{isDataRoute:it}=reactExports.useContext(RouteContext);return it?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant$1(!1);let it=reactExports.useContext(DataRouterContext),{basename:_,future:lt,navigator:ft}=reactExports.useContext(NavigationContext),{matches:mt}=reactExports.useContext(RouteContext),{pathname:pt}=useLocation(),gt=JSON.stringify(getResolveToMatches(mt,lt.v7_relativeSplatPath)),bt=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{bt.current=!0}),reactExports.useCallback(function(vt,Ct){if(Ct===void 0&&(Ct={}),!bt.current)return;if(typeof vt=="number"){ft.go(vt);return}let Rt=resolveTo(vt,JSON.parse(gt),pt,Ct.relative==="path");it==null&&_!=="/"&&(Rt.pathname=Rt.pathname==="/"?_:joinPaths([_,Rt.pathname])),(Ct.replace?ft.replace:ft.push)(Rt,Ct.state,Ct)},[_,ft,gt,pt,it])}function useResolvedPath(it,_){let{relative:lt}=_===void 0?{}:_,{future:ft}=reactExports.useContext(NavigationContext),{matches:mt}=reactExports.useContext(RouteContext),{pathname:pt}=useLocation(),gt=JSON.stringify(getResolveToMatches(mt,ft.v7_relativeSplatPath));return reactExports.useMemo(()=>resolveTo(it,JSON.parse(gt),pt,lt==="path"),[it,gt,pt,lt])}function useRoutesImpl(it,_,lt,ft){useInRouterContext()||invariant$1(!1);let{navigator:mt}=reactExports.useContext(NavigationContext),{matches:pt}=reactExports.useContext(RouteContext),gt=pt[pt.length-1],bt=gt?gt.params:{};gt&&gt.pathname;let wt=gt?gt.pathnameBase:"/";gt&&gt.route;let vt=useLocation(),Ct;Ct=vt;let Rt=Ct.pathname||"/",Mt=Rt;if(wt!=="/"){let Ht=wt.replace(/^\//,"").split("/");Mt="/"+Rt.replace(/^\//,"").split("/").slice(Ht.length).join("/")}let Ot=matchRoutes(it,{pathname:Mt});return _renderMatches(Ot&&Ot.map(Ht=>Object.assign({},Ht,{params:Object.assign({},bt,Ht.params),pathname:joinPaths([wt,mt.encodeLocation?mt.encodeLocation(Ht.pathname).pathname:Ht.pathname]),pathnameBase:Ht.pathnameBase==="/"?wt:joinPaths([wt,mt.encodeLocation?mt.encodeLocation(Ht.pathnameBase).pathname:Ht.pathnameBase])})),pt,lt,ft)}function DefaultErrorComponent(){let it=useRouteError(),_=isRouteErrorResponse(it)?it.status+" "+it.statusText:it instanceof Error?it.message:JSON.stringify(it),lt=it instanceof Error?it.stack:null,mt={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},_),lt?reactExports.createElement("pre",{style:mt},lt):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(_){super(_),this.state={location:_.location,revalidation:_.revalidation,error:_.error}}static getDerivedStateFromError(_){return{error:_}}static getDerivedStateFromProps(_,lt){return lt.location!==_.location||lt.revalidation!=="idle"&&_.revalidation==="idle"?{error:_.error,location:_.location,revalidation:_.revalidation}:{error:_.error!==void 0?_.error:lt.error,location:lt.location,revalidation:_.revalidation||lt.revalidation}}componentDidCatch(_,lt){console.error("React Router caught the following error during render",_,lt)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(it){let{routeContext:_,match:lt,children:ft}=it,mt=reactExports.useContext(DataRouterContext);return mt&&mt.static&&mt.staticContext&&(lt.route.errorElement||lt.route.ErrorBoundary)&&(mt.staticContext._deepestRenderedBoundaryId=lt.route.id),reactExports.createElement(RouteContext.Provider,{value:_},ft)}function _renderMatches(it,_,lt,ft){var mt;if(_===void 0&&(_=[]),lt===void 0&&(lt=null),ft===void 0&&(ft=null),it==null){var pt;if(!lt)return null;if(lt.errors)it=lt.matches;else if((pt=ft)!=null&&pt.v7_partialHydration&&_.length===0&&!lt.initialized&&lt.matches.length>0)it=lt.matches;else return null}let gt=it,bt=(mt=lt)==null?void 0:mt.errors;if(bt!=null){let Ct=gt.findIndex(Rt=>Rt.route.id&&(bt==null?void 0:bt[Rt.route.id])!==void 0);Ct>=0||invariant$1(!1),gt=gt.slice(0,Math.min(gt.length,Ct+1))}let wt=!1,vt=-1;if(lt&&ft&&ft.v7_partialHydration)for(let Ct=0;Ct<gt.length;Ct++){let Rt=gt[Ct];if((Rt.route.HydrateFallback||Rt.route.hydrateFallbackElement)&&(vt=Ct),Rt.route.id){let{loaderData:Mt,errors:Ot}=lt,Nt=Rt.route.loader&&Mt[Rt.route.id]===void 0&&(!Ot||Ot[Rt.route.id]===void 0);if(Rt.route.lazy||Nt){wt=!0,vt>=0?gt=gt.slice(0,vt+1):gt=[gt[0]];break}}}return gt.reduceRight((Ct,Rt,Mt)=>{let Ot,Nt=!1,Ht=null,Kt=null;lt&&(Ot=bt&&Rt.route.id?bt[Rt.route.id]:void 0,Ht=Rt.route.errorElement||defaultErrorElement,wt&&(vt<0&&Mt===0?(warningOnce("route-fallback"),Nt=!0,Kt=null):vt===Mt&&(Nt=!0,Kt=Rt.route.hydrateFallbackElement||null)));let hr=_.concat(gt.slice(0,Mt+1)),Qt=()=>{let mr;return Ot?mr=Ht:Nt?mr=Kt:Rt.route.Component?mr=reactExports.createElement(Rt.route.Component,null):Rt.route.element?mr=Rt.route.element:mr=Ct,reactExports.createElement(RenderedRoute,{match:Rt,routeContext:{outlet:Ct,matches:hr,isDataRoute:lt!=null},children:mr})};return lt&&(Rt.route.ErrorBoundary||Rt.route.errorElement||Mt===0)?reactExports.createElement(RenderErrorBoundary,{location:lt.location,revalidation:lt.revalidation,component:Ht,error:Ot,children:Qt(),routeContext:{outlet:null,matches:hr,isDataRoute:!0}}):Qt()},null)}var DataRouterHook$1=function(it){return it.UseBlocker="useBlocker",it.UseRevalidator="useRevalidator",it.UseNavigateStable="useNavigate",it}(DataRouterHook$1||{}),DataRouterStateHook$1=function(it){return it.UseBlocker="useBlocker",it.UseLoaderData="useLoaderData",it.UseActionData="useActionData",it.UseRouteError="useRouteError",it.UseNavigation="useNavigation",it.UseRouteLoaderData="useRouteLoaderData",it.UseMatches="useMatches",it.UseRevalidator="useRevalidator",it.UseNavigateStable="useNavigate",it.UseRouteId="useRouteId",it}(DataRouterStateHook$1||{});function useDataRouterContext(it){let _=reactExports.useContext(DataRouterContext);return _||invariant$1(!1),_}function useDataRouterState(it){let _=reactExports.useContext(DataRouterStateContext);return _||invariant$1(!1),_}function useRouteContext(it){let _=reactExports.useContext(RouteContext);return _||invariant$1(!1),_}function useCurrentRouteId(it){let _=useRouteContext(),lt=_.matches[_.matches.length-1];return lt.route.id||invariant$1(!1),lt.route.id}function useRouteError(){var it;let _=reactExports.useContext(RouteErrorContext),lt=useDataRouterState(DataRouterStateHook$1.UseRouteError),ft=useCurrentRouteId(DataRouterStateHook$1.UseRouteError);return _!==void 0?_:(it=lt.errors)==null?void 0:it[ft]}function useNavigateStable(){let{router:it}=useDataRouterContext(DataRouterHook$1.UseNavigateStable),_=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),lt=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{lt.current=!0}),reactExports.useCallback(function(mt,pt){pt===void 0&&(pt={}),lt.current&&(typeof mt=="number"?it.navigate(mt):it.navigate(mt,_extends$1({fromRouteId:_},pt)))},[it,_])}const alreadyWarned={};function warningOnce(it,_,lt){alreadyWarned[it]||(alreadyWarned[it]=!0)}function Router(it){let{basename:_="/",children:lt=null,location:ft,navigationType:mt=Action.Pop,navigator:pt,static:gt=!1,future:bt}=it;useInRouterContext()&&invariant$1(!1);let wt=_.replace(/^\/*/,"/"),vt=reactExports.useMemo(()=>({basename:wt,navigator:pt,static:gt,future:_extends$1({v7_relativeSplatPath:!1},bt)}),[wt,bt,pt,gt]);typeof ft=="string"&&(ft=parsePath(ft));let{pathname:Ct="/",search:Rt="",hash:Mt="",state:Ot=null,key:Nt="default"}=ft,Ht=reactExports.useMemo(()=>{let Kt=stripBasename(Ct,wt);return Kt==null?null:{location:{pathname:Kt,search:Rt,hash:Mt,state:Ot,key:Nt},navigationType:mt}},[wt,Ct,Rt,Mt,Ot,Nt,mt]);return Ht==null?null:reactExports.createElement(NavigationContext.Provider,{value:vt},reactExports.createElement(LocationContext.Provider,{children:lt,value:Ht}))}new Promise(()=>{});function mapRouteProperties(it){let _={hasErrorBoundary:it.ErrorBoundary!=null||it.errorElement!=null};return it.Component&&Object.assign(_,{element:reactExports.createElement(it.Component),Component:void 0}),it.HydrateFallback&&Object.assign(_,{hydrateFallbackElement:reactExports.createElement(it.HydrateFallback),HydrateFallback:void 0}),it.ErrorBoundary&&Object.assign(_,{errorElement:reactExports.createElement(it.ErrorBoundary),ErrorBoundary:void 0}),_}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends(){return _extends=Object.assign?Object.assign.bind():function(it){for(var _=1;_<arguments.length;_++){var lt=arguments[_];for(var ft in lt)Object.prototype.hasOwnProperty.call(lt,ft)&&(it[ft]=lt[ft])}return it},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(it,_){if(it==null)return{};var lt={},ft=Object.keys(it),mt,pt;for(pt=0;pt<ft.length;pt++)mt=ft[pt],!(_.indexOf(mt)>=0)&&(lt[mt]=it[mt]);return lt}function isModifiedEvent(it){return!!(it.metaKey||it.altKey||it.ctrlKey||it.shiftKey)}function shouldProcessLinkClick(it,_){return it.button===0&&(!_||_==="_self")&&!isModifiedEvent(it)}const _excluded=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],REACT_ROUTER_VERSION="6";try{window.__reactRouterVersion=REACT_ROUTER_VERSION}catch{}function createBrowserRouter(it,_){return createRouter({basename:void 0,future:_extends({},void 0,{v7_prependBasename:!0}),history:createBrowserHistory({window:void 0}),hydrationData:parseHydrationData(),routes:it,mapRouteProperties,dataStrategy:void 0,patchRoutesOnNavigation:void 0,window:void 0}).initialize()}function parseHydrationData(){var it;let _=(it=window)==null?void 0:it.__staticRouterHydrationData;return _&&_.errors&&(_=_extends({},_,{errors:deserializeErrors(_.errors)})),_}function deserializeErrors(it){if(!it)return null;let _=Object.entries(it),lt={};for(let[ft,mt]of _)if(mt&&mt.__type==="RouteErrorResponse")lt[ft]=new ErrorResponseImpl(mt.status,mt.statusText,mt.data,mt.internal===!0);else if(mt&&mt.__type==="Error"){if(mt.__subType){let pt=window[mt.__subType];if(typeof pt=="function")try{let gt=new pt(mt.message);gt.stack="",lt[ft]=gt}catch{}}if(lt[ft]==null){let pt=new Error(mt.message);pt.stack="",lt[ft]=pt}}else lt[ft]=mt;return lt}const ViewTransitionContext=reactExports.createContext({isTransitioning:!1}),FetchersContext=reactExports.createContext(new Map),START_TRANSITION="startTransition",startTransitionImpl=React[START_TRANSITION],FLUSH_SYNC="flushSync",flushSyncImpl=ReactDOM[FLUSH_SYNC];function startTransitionSafe(it){startTransitionImpl?startTransitionImpl(it):it()}function flushSyncSafe(it){flushSyncImpl?flushSyncImpl(it):it()}let Deferred$1=class{constructor(){this.status="pending",this.promise=new Promise((_,lt)=>{this.resolve=ft=>{this.status==="pending"&&(this.status="resolved",_(ft))},this.reject=ft=>{this.status==="pending"&&(this.status="rejected",lt(ft))}})}};function RouterProvider(it){let{fallbackElement:_,router:lt,future:ft}=it,[mt,pt]=reactExports.useState(lt.state),[gt,bt]=reactExports.useState(),[wt,vt]=reactExports.useState({isTransitioning:!1}),[Ct,Rt]=reactExports.useState(),[Mt,Ot]=reactExports.useState(),[Nt,Ht]=reactExports.useState(),Kt=reactExports.useRef(new Map),{v7_startTransition:hr}=ft||{},Qt=reactExports.useCallback(Nr=>{hr?startTransitionSafe(Nr):Nr()},[hr]),mr=reactExports.useCallback((Nr,jn)=>{let{deletedFetchers:Yn,flushSync:ga,viewTransitionOpts:Kn}=jn;Yn.forEach(eo=>Kt.current.delete(eo)),Nr.fetchers.forEach((eo,lp)=>{eo.data!==void 0&&Kt.current.set(lp,eo.data)});let Xn=lt.window==null||lt.window.document==null||typeof lt.window.document.startViewTransition!="function";if(!Kn||Xn){ga?flushSyncSafe(()=>pt(Nr)):Qt(()=>pt(Nr));return}if(ga){flushSyncSafe(()=>{Mt&&(Ct&&Ct.resolve(),Mt.skipTransition()),vt({isTransitioning:!0,flushSync:!0,currentLocation:Kn.currentLocation,nextLocation:Kn.nextLocation})});let eo=lt.window.document.startViewTransition(()=>{flushSyncSafe(()=>pt(Nr))});eo.finished.finally(()=>{flushSyncSafe(()=>{Rt(void 0),Ot(void 0),bt(void 0),vt({isTransitioning:!1})})}),flushSyncSafe(()=>Ot(eo));return}Mt?(Ct&&Ct.resolve(),Mt.skipTransition(),Ht({state:Nr,currentLocation:Kn.currentLocation,nextLocation:Kn.nextLocation})):(bt(Nr),vt({isTransitioning:!0,flushSync:!1,currentLocation:Kn.currentLocation,nextLocation:Kn.nextLocation}))},[lt.window,Mt,Ct,Kt,Qt]);reactExports.useLayoutEffect(()=>lt.subscribe(mr),[lt,mr]),reactExports.useEffect(()=>{wt.isTransitioning&&!wt.flushSync&&Rt(new Deferred$1)},[wt]),reactExports.useEffect(()=>{if(Ct&&gt&&lt.window){let Nr=gt,jn=Ct.promise,Yn=lt.window.document.startViewTransition(async()=>{Qt(()=>pt(Nr)),await jn});Yn.finished.finally(()=>{Rt(void 0),Ot(void 0),bt(void 0),vt({isTransitioning:!1})}),Ot(Yn)}},[Qt,gt,Ct,lt.window]),reactExports.useEffect(()=>{Ct&&gt&&mt.location.key===gt.location.key&&Ct.resolve()},[Ct,Mt,mt.location,gt]),reactExports.useEffect(()=>{!wt.isTransitioning&&Nt&&(bt(Nt.state),vt({isTransitioning:!0,flushSync:!1,currentLocation:Nt.currentLocation,nextLocation:Nt.nextLocation}),Ht(void 0))},[wt.isTransitioning,Nt]),reactExports.useEffect(()=>{},[]);let br=reactExports.useMemo(()=>({createHref:lt.createHref,encodeLocation:lt.encodeLocation,go:Nr=>lt.navigate(Nr),push:(Nr,jn,Yn)=>lt.navigate(Nr,{state:jn,preventScrollReset:Yn==null?void 0:Yn.preventScrollReset}),replace:(Nr,jn,Yn)=>lt.navigate(Nr,{replace:!0,state:jn,preventScrollReset:Yn==null?void 0:Yn.preventScrollReset})}),[lt]),Fr=lt.basename||"/",kr=reactExports.useMemo(()=>({router:lt,navigator:br,static:!1,basename:Fr}),[lt,br,Fr]),Br=reactExports.useMemo(()=>({v7_relativeSplatPath:lt.future.v7_relativeSplatPath}),[lt.future.v7_relativeSplatPath]);return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement(DataRouterContext.Provider,{value:kr},reactExports.createElement(DataRouterStateContext.Provider,{value:mt},reactExports.createElement(FetchersContext.Provider,{value:Kt.current},reactExports.createElement(ViewTransitionContext.Provider,{value:wt},reactExports.createElement(Router,{basename:Fr,location:mt.location,navigationType:mt.historyAction,navigator:br,future:Br},mt.initialized||lt.future.v7_partialHydration?reactExports.createElement(MemoizedDataRoutes,{routes:lt.routes,future:lt.future,state:mt}):_))))),null)}const MemoizedDataRoutes=reactExports.memo(DataRoutes);function DataRoutes(it){let{routes:_,future:lt,state:ft}=it;return useRoutesImpl(_,void 0,ft,lt)}const isBrowser$2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function(_,lt){let{onClick:ft,relative:mt,reloadDocument:pt,replace:gt,state:bt,target:wt,to:vt,preventScrollReset:Ct,viewTransition:Rt}=_,Mt=_objectWithoutPropertiesLoose(_,_excluded),{basename:Ot}=reactExports.useContext(NavigationContext),Nt,Ht=!1;if(typeof vt=="string"&&ABSOLUTE_URL_REGEX.test(vt)&&(Nt=vt,isBrowser$2))try{let mr=new URL(window.location.href),br=vt.startsWith("//")?new URL(mr.protocol+vt):new URL(vt),Fr=stripBasename(br.pathname,Ot);br.origin===mr.origin&&Fr!=null?vt=Fr+br.search+br.hash:Ht=!0}catch{}let Kt=useHref(vt,{relative:mt}),hr=useLinkClickHandler(vt,{replace:gt,state:bt,target:wt,preventScrollReset:Ct,relative:mt,viewTransition:Rt});function Qt(mr){ft&&ft(mr),mr.defaultPrevented||hr(mr)}return reactExports.createElement("a",_extends({},Mt,{href:Nt||Kt,onClick:Ht||pt?ft:Qt,ref:lt,target:wt}))});var DataRouterHook;(function(it){it.UseScrollRestoration="useScrollRestoration",it.UseSubmit="useSubmit",it.UseSubmitFetcher="useSubmitFetcher",it.UseFetcher="useFetcher",it.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(it){it.UseFetcher="useFetcher",it.UseFetchers="useFetchers",it.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));function useLinkClickHandler(it,_){let{target:lt,replace:ft,state:mt,preventScrollReset:pt,relative:gt,viewTransition:bt}=_===void 0?{}:_,wt=useNavigate(),vt=useLocation(),Ct=useResolvedPath(it,{relative:gt});return reactExports.useCallback(Rt=>{if(shouldProcessLinkClick(Rt,lt)){Rt.preventDefault();let Mt=ft!==void 0?ft:createPath(vt)===createPath(Ct);wt(it,{replace:Mt,state:mt,preventScrollReset:pt,relative:gt,viewTransition:bt})}},[vt,wt,Ct,ft,mt,lt,it,pt,gt,bt])}const SubdomainContext=reactExports.createContext({subdomain:null,isLocal:!1}),SubdomainProvider=({children:it})=>{const[_,lt]=reactExports.useState(null),[ft,mt]=reactExports.useState(!1);return reactExports.useEffect(()=>{const pt=()=>{const gt=window.location.hostname.split(".")[0];lt(gt==="www"||gt==="whispershirt"||gt==="127"||gt==="localhost"?"":gt);const bt=window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1");mt(bt)};return pt(),window.addEventListener("hashchange",pt),()=>{window.removeEventListener("hashchange",pt)}},[]),jsxRuntimeExports.jsx(SubdomainContext.Provider,{value:{subdomain:_,isLocal:ft},children:it})};function r$2(it){var _,lt,ft="";if(typeof it=="string"||typeof it=="number")ft+=it;else if(typeof it=="object")if(Array.isArray(it)){var mt=it.length;for(_=0;_<mt;_++)it[_]&&(lt=r$2(it[_]))&&(ft&&(ft+=" "),ft+=lt)}else for(lt in it)it[lt]&&(ft&&(ft+=" "),ft+=lt);return ft}function clsx$1(){for(var it,_,lt=0,ft="",mt=arguments.length;lt<mt;lt++)(it=arguments[lt])&&(_=r$2(it))&&(ft&&(ft+=" "),ft+=_);return ft}const CLASS_PART_SEPARATOR="-",createClassGroupUtils=it=>{const _=createClassMap(it),{conflictingClassGroups:lt,conflictingClassGroupModifiers:ft}=it;return{getClassGroupId:gt=>{const bt=gt.split(CLASS_PART_SEPARATOR);return bt[0]===""&&bt.length!==1&&bt.shift(),getGroupRecursive(bt,_)||getGroupIdForArbitraryProperty(gt)},getConflictingClassGroupIds:(gt,bt)=>{const wt=lt[gt]||[];return bt&&ft[gt]?[...wt,...ft[gt]]:wt}}},getGroupRecursive=(it,_)=>{var gt;if(it.length===0)return _.classGroupId;const lt=it[0],ft=_.nextPart.get(lt),mt=ft?getGroupRecursive(it.slice(1),ft):void 0;if(mt)return mt;if(_.validators.length===0)return;const pt=it.join(CLASS_PART_SEPARATOR);return(gt=_.validators.find(({validator:bt})=>bt(pt)))==null?void 0:gt.classGroupId},arbitraryPropertyRegex=/^\[(.+)\]$/,getGroupIdForArbitraryProperty=it=>{if(arbitraryPropertyRegex.test(it)){const _=arbitraryPropertyRegex.exec(it)[1],lt=_==null?void 0:_.substring(0,_.indexOf(":"));if(lt)return"arbitrary.."+lt}},createClassMap=it=>{const{theme:_,prefix:lt}=it,ft={nextPart:new Map,validators:[]};return getPrefixedClassGroupEntries(Object.entries(it.classGroups),lt).forEach(([pt,gt])=>{processClassesRecursively(gt,ft,pt,_)}),ft},processClassesRecursively=(it,_,lt,ft)=>{it.forEach(mt=>{if(typeof mt=="string"){const pt=mt===""?_:getPart(_,mt);pt.classGroupId=lt;return}if(typeof mt=="function"){if(isThemeGetter(mt)){processClassesRecursively(mt(ft),_,lt,ft);return}_.validators.push({validator:mt,classGroupId:lt});return}Object.entries(mt).forEach(([pt,gt])=>{processClassesRecursively(gt,getPart(_,pt),lt,ft)})})},getPart=(it,_)=>{let lt=it;return _.split(CLASS_PART_SEPARATOR).forEach(ft=>{lt.nextPart.has(ft)||lt.nextPart.set(ft,{nextPart:new Map,validators:[]}),lt=lt.nextPart.get(ft)}),lt},isThemeGetter=it=>it.isThemeGetter,getPrefixedClassGroupEntries=(it,_)=>_?it.map(([lt,ft])=>{const mt=ft.map(pt=>typeof pt=="string"?_+pt:typeof pt=="object"?Object.fromEntries(Object.entries(pt).map(([gt,bt])=>[_+gt,bt])):pt);return[lt,mt]}):it,createLruCache=it=>{if(it<1)return{get:()=>{},set:()=>{}};let _=0,lt=new Map,ft=new Map;const mt=(pt,gt)=>{lt.set(pt,gt),_++,_>it&&(_=0,ft=lt,lt=new Map)};return{get(pt){let gt=lt.get(pt);if(gt!==void 0)return gt;if((gt=ft.get(pt))!==void 0)return mt(pt,gt),gt},set(pt,gt){lt.has(pt)?lt.set(pt,gt):mt(pt,gt)}}},IMPORTANT_MODIFIER="!",createParseClassName=it=>{const{separator:_,experimentalParseClassName:lt}=it,ft=_.length===1,mt=_[0],pt=_.length,gt=bt=>{const wt=[];let vt=0,Ct=0,Rt;for(let Kt=0;Kt<bt.length;Kt++){let hr=bt[Kt];if(vt===0){if(hr===mt&&(ft||bt.slice(Kt,Kt+pt)===_)){wt.push(bt.slice(Ct,Kt)),Ct=Kt+pt;continue}if(hr==="/"){Rt=Kt;continue}}hr==="["?vt++:hr==="]"&&vt--}const Mt=wt.length===0?bt:bt.substring(Ct),Ot=Mt.startsWith(IMPORTANT_MODIFIER),Nt=Ot?Mt.substring(1):Mt,Ht=Rt&&Rt>Ct?Rt-Ct:void 0;return{modifiers:wt,hasImportantModifier:Ot,baseClassName:Nt,maybePostfixModifierPosition:Ht}};return lt?bt=>lt({className:bt,parseClassName:gt}):gt},sortModifiers=it=>{if(it.length<=1)return it;const _=[];let lt=[];return it.forEach(ft=>{ft[0]==="["?(_.push(...lt.sort(),ft),lt=[]):lt.push(ft)}),_.push(...lt.sort()),_},createConfigUtils=it=>({cache:createLruCache(it.cacheSize),parseClassName:createParseClassName(it),...createClassGroupUtils(it)}),SPLIT_CLASSES_REGEX=/\s+/,mergeClassList=(it,_)=>{const{parseClassName:lt,getClassGroupId:ft,getConflictingClassGroupIds:mt}=_,pt=[],gt=it.trim().split(SPLIT_CLASSES_REGEX);let bt="";for(let wt=gt.length-1;wt>=0;wt-=1){const vt=gt[wt],{modifiers:Ct,hasImportantModifier:Rt,baseClassName:Mt,maybePostfixModifierPosition:Ot}=lt(vt);let Nt=!!Ot,Ht=ft(Nt?Mt.substring(0,Ot):Mt);if(!Ht){if(!Nt){bt=vt+(bt.length>0?" "+bt:bt);continue}if(Ht=ft(Mt),!Ht){bt=vt+(bt.length>0?" "+bt:bt);continue}Nt=!1}const Kt=sortModifiers(Ct).join(":"),hr=Rt?Kt+IMPORTANT_MODIFIER:Kt,Qt=hr+Ht;if(pt.includes(Qt))continue;pt.push(Qt);const mr=mt(Ht,Nt);for(let br=0;br<mr.length;++br){const Fr=mr[br];pt.push(hr+Fr)}bt=vt+(bt.length>0?" "+bt:bt)}return bt};function twJoin(){let it=0,_,lt,ft="";for(;it<arguments.length;)(_=arguments[it++])&&(lt=toValue(_))&&(ft&&(ft+=" "),ft+=lt);return ft}const toValue=it=>{if(typeof it=="string")return it;let _,lt="";for(let ft=0;ft<it.length;ft++)it[ft]&&(_=toValue(it[ft]))&&(lt&&(lt+=" "),lt+=_);return lt};function createTailwindMerge(it,..._){let lt,ft,mt,pt=gt;function gt(wt){const vt=_.reduce((Ct,Rt)=>Rt(Ct),it());return lt=createConfigUtils(vt),ft=lt.cache.get,mt=lt.cache.set,pt=bt,bt(wt)}function bt(wt){const vt=ft(wt);if(vt)return vt;const Ct=mergeClassList(wt,lt);return mt(wt,Ct),Ct}return function(){return pt(twJoin.apply(null,arguments))}}const fromTheme=it=>{const _=lt=>lt[it]||[];return _.isThemeGetter=!0,_},arbitraryValueRegex=/^\[(?:([a-z-]+):)?(.+)\]$/i,fractionRegex=/^\d+\/\d+$/,stringLengths=new Set(["px","full","screen"]),tshirtUnitRegex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lengthUnitRegex=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,colorFunctionRegex=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,shadowRegex=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,imageRegex=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,isLength=it=>isNumber$1(it)||stringLengths.has(it)||fractionRegex.test(it),isArbitraryLength=it=>getIsArbitraryValue(it,"length",isLengthOnly),isNumber$1=it=>!!it&&!Number.isNaN(Number(it)),isArbitraryNumber=it=>getIsArbitraryValue(it,"number",isNumber$1),isInteger=it=>!!it&&Number.isInteger(Number(it)),isPercent=it=>it.endsWith("%")&&isNumber$1(it.slice(0,-1)),isArbitraryValue=it=>arbitraryValueRegex.test(it),isTshirtSize=it=>tshirtUnitRegex.test(it),sizeLabels=new Set(["length","size","percentage"]),isArbitrarySize=it=>getIsArbitraryValue(it,sizeLabels,isNever),isArbitraryPosition=it=>getIsArbitraryValue(it,"position",isNever),imageLabels=new Set(["image","url"]),isArbitraryImage=it=>getIsArbitraryValue(it,imageLabels,isImage),isArbitraryShadow=it=>getIsArbitraryValue(it,"",isShadow),isAny=()=>!0,getIsArbitraryValue=(it,_,lt)=>{const ft=arbitraryValueRegex.exec(it);return ft?ft[1]?typeof _=="string"?ft[1]===_:_.has(ft[1]):lt(ft[2]):!1},isLengthOnly=it=>lengthUnitRegex.test(it)&&!colorFunctionRegex.test(it),isNever=()=>!1,isShadow=it=>shadowRegex.test(it),isImage=it=>imageRegex.test(it),getDefaultConfig=()=>{const it=fromTheme("colors"),_=fromTheme("spacing"),lt=fromTheme("blur"),ft=fromTheme("brightness"),mt=fromTheme("borderColor"),pt=fromTheme("borderRadius"),gt=fromTheme("borderSpacing"),bt=fromTheme("borderWidth"),wt=fromTheme("contrast"),vt=fromTheme("grayscale"),Ct=fromTheme("hueRotate"),Rt=fromTheme("invert"),Mt=fromTheme("gap"),Ot=fromTheme("gradientColorStops"),Nt=fromTheme("gradientColorStopPositions"),Ht=fromTheme("inset"),Kt=fromTheme("margin"),hr=fromTheme("opacity"),Qt=fromTheme("padding"),mr=fromTheme("saturate"),br=fromTheme("scale"),Fr=fromTheme("sepia"),kr=fromTheme("skew"),Br=fromTheme("space"),Nr=fromTheme("translate"),jn=()=>["auto","contain","none"],Yn=()=>["auto","hidden","clip","visible","scroll"],ga=()=>["auto",isArbitraryValue,_],Kn=()=>[isArbitraryValue,_],Xn=()=>["",isLength,isArbitraryLength],eo=()=>["auto",isNumber$1,isArbitraryValue],lp=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],$a=()=>["solid","dashed","dotted","double","none"],ro=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],bs=()=>["start","end","center","between","around","evenly","stretch"],ba=()=>["","0",isArbitraryValue],Zn=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Qn=()=>[isNumber$1,isArbitraryValue];return{cacheSize:500,separator:":",theme:{colors:[isAny],spacing:[isLength,isArbitraryLength],blur:["none","",isTshirtSize,isArbitraryValue],brightness:Qn(),borderColor:[it],borderRadius:["none","","full",isTshirtSize,isArbitraryValue],borderSpacing:Kn(),borderWidth:Xn(),contrast:Qn(),grayscale:ba(),hueRotate:Qn(),invert:ba(),gap:Kn(),gradientColorStops:[it],gradientColorStopPositions:[isPercent,isArbitraryLength],inset:ga(),margin:ga(),opacity:Qn(),padding:Kn(),saturate:Qn(),scale:Qn(),sepia:ba(),skew:Qn(),space:Kn(),translate:Kn()},classGroups:{aspect:[{aspect:["auto","square","video",isArbitraryValue]}],container:["container"],columns:[{columns:[isTshirtSize]}],"break-after":[{"break-after":Zn()}],"break-before":[{"break-before":Zn()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...lp(),isArbitraryValue]}],overflow:[{overflow:Yn()}],"overflow-x":[{"overflow-x":Yn()}],"overflow-y":[{"overflow-y":Yn()}],overscroll:[{overscroll:jn()}],"overscroll-x":[{"overscroll-x":jn()}],"overscroll-y":[{"overscroll-y":jn()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[Ht]}],"inset-x":[{"inset-x":[Ht]}],"inset-y":[{"inset-y":[Ht]}],start:[{start:[Ht]}],end:[{end:[Ht]}],top:[{top:[Ht]}],right:[{right:[Ht]}],bottom:[{bottom:[Ht]}],left:[{left:[Ht]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",isInteger,isArbitraryValue]}],basis:[{basis:ga()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",isArbitraryValue]}],grow:[{grow:ba()}],shrink:[{shrink:ba()}],order:[{order:["first","last","none",isInteger,isArbitraryValue]}],"grid-cols":[{"grid-cols":[isAny]}],"col-start-end":[{col:["auto",{span:["full",isInteger,isArbitraryValue]},isArbitraryValue]}],"col-start":[{"col-start":eo()}],"col-end":[{"col-end":eo()}],"grid-rows":[{"grid-rows":[isAny]}],"row-start-end":[{row:["auto",{span:[isInteger,isArbitraryValue]},isArbitraryValue]}],"row-start":[{"row-start":eo()}],"row-end":[{"row-end":eo()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",isArbitraryValue]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",isArbitraryValue]}],gap:[{gap:[Mt]}],"gap-x":[{"gap-x":[Mt]}],"gap-y":[{"gap-y":[Mt]}],"justify-content":[{justify:["normal",...bs()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...bs(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...bs(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Qt]}],px:[{px:[Qt]}],py:[{py:[Qt]}],ps:[{ps:[Qt]}],pe:[{pe:[Qt]}],pt:[{pt:[Qt]}],pr:[{pr:[Qt]}],pb:[{pb:[Qt]}],pl:[{pl:[Qt]}],m:[{m:[Kt]}],mx:[{mx:[Kt]}],my:[{my:[Kt]}],ms:[{ms:[Kt]}],me:[{me:[Kt]}],mt:[{mt:[Kt]}],mr:[{mr:[Kt]}],mb:[{mb:[Kt]}],ml:[{ml:[Kt]}],"space-x":[{"space-x":[Br]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Br]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",isArbitraryValue,_]}],"min-w":[{"min-w":[isArbitraryValue,_,"min","max","fit"]}],"max-w":[{"max-w":[isArbitraryValue,_,"none","full","min","max","fit","prose",{screen:[isTshirtSize]},isTshirtSize]}],h:[{h:[isArbitraryValue,_,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[isArbitraryValue,_,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[isArbitraryValue,_,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[isArbitraryValue,_,"auto","min","max","fit"]}],"font-size":[{text:["base",isTshirtSize,isArbitraryLength]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",isArbitraryNumber]}],"font-family":[{font:[isAny]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",isArbitraryValue]}],"line-clamp":[{"line-clamp":["none",isNumber$1,isArbitraryNumber]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",isLength,isArbitraryValue]}],"list-image":[{"list-image":["none",isArbitraryValue]}],"list-style-type":[{list:["none","disc","decimal",isArbitraryValue]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[it]}],"placeholder-opacity":[{"placeholder-opacity":[hr]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[it]}],"text-opacity":[{"text-opacity":[hr]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...$a(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",isLength,isArbitraryLength]}],"underline-offset":[{"underline-offset":["auto",isLength,isArbitraryValue]}],"text-decoration-color":[{decoration:[it]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Kn()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",isArbitraryValue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",isArbitraryValue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[hr]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...lp(),isArbitraryPosition]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",isArbitrarySize]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},isArbitraryImage]}],"bg-color":[{bg:[it]}],"gradient-from-pos":[{from:[Nt]}],"gradient-via-pos":[{via:[Nt]}],"gradient-to-pos":[{to:[Nt]}],"gradient-from":[{from:[Ot]}],"gradient-via":[{via:[Ot]}],"gradient-to":[{to:[Ot]}],rounded:[{rounded:[pt]}],"rounded-s":[{"rounded-s":[pt]}],"rounded-e":[{"rounded-e":[pt]}],"rounded-t":[{"rounded-t":[pt]}],"rounded-r":[{"rounded-r":[pt]}],"rounded-b":[{"rounded-b":[pt]}],"rounded-l":[{"rounded-l":[pt]}],"rounded-ss":[{"rounded-ss":[pt]}],"rounded-se":[{"rounded-se":[pt]}],"rounded-ee":[{"rounded-ee":[pt]}],"rounded-es":[{"rounded-es":[pt]}],"rounded-tl":[{"rounded-tl":[pt]}],"rounded-tr":[{"rounded-tr":[pt]}],"rounded-br":[{"rounded-br":[pt]}],"rounded-bl":[{"rounded-bl":[pt]}],"border-w":[{border:[bt]}],"border-w-x":[{"border-x":[bt]}],"border-w-y":[{"border-y":[bt]}],"border-w-s":[{"border-s":[bt]}],"border-w-e":[{"border-e":[bt]}],"border-w-t":[{"border-t":[bt]}],"border-w-r":[{"border-r":[bt]}],"border-w-b":[{"border-b":[bt]}],"border-w-l":[{"border-l":[bt]}],"border-opacity":[{"border-opacity":[hr]}],"border-style":[{border:[...$a(),"hidden"]}],"divide-x":[{"divide-x":[bt]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[bt]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[hr]}],"divide-style":[{divide:$a()}],"border-color":[{border:[mt]}],"border-color-x":[{"border-x":[mt]}],"border-color-y":[{"border-y":[mt]}],"border-color-s":[{"border-s":[mt]}],"border-color-e":[{"border-e":[mt]}],"border-color-t":[{"border-t":[mt]}],"border-color-r":[{"border-r":[mt]}],"border-color-b":[{"border-b":[mt]}],"border-color-l":[{"border-l":[mt]}],"divide-color":[{divide:[mt]}],"outline-style":[{outline:["",...$a()]}],"outline-offset":[{"outline-offset":[isLength,isArbitraryValue]}],"outline-w":[{outline:[isLength,isArbitraryLength]}],"outline-color":[{outline:[it]}],"ring-w":[{ring:Xn()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[it]}],"ring-opacity":[{"ring-opacity":[hr]}],"ring-offset-w":[{"ring-offset":[isLength,isArbitraryLength]}],"ring-offset-color":[{"ring-offset":[it]}],shadow:[{shadow:["","inner","none",isTshirtSize,isArbitraryShadow]}],"shadow-color":[{shadow:[isAny]}],opacity:[{opacity:[hr]}],"mix-blend":[{"mix-blend":[...ro(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ro()}],filter:[{filter:["","none"]}],blur:[{blur:[lt]}],brightness:[{brightness:[ft]}],contrast:[{contrast:[wt]}],"drop-shadow":[{"drop-shadow":["","none",isTshirtSize,isArbitraryValue]}],grayscale:[{grayscale:[vt]}],"hue-rotate":[{"hue-rotate":[Ct]}],invert:[{invert:[Rt]}],saturate:[{saturate:[mr]}],sepia:[{sepia:[Fr]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[lt]}],"backdrop-brightness":[{"backdrop-brightness":[ft]}],"backdrop-contrast":[{"backdrop-contrast":[wt]}],"backdrop-grayscale":[{"backdrop-grayscale":[vt]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Ct]}],"backdrop-invert":[{"backdrop-invert":[Rt]}],"backdrop-opacity":[{"backdrop-opacity":[hr]}],"backdrop-saturate":[{"backdrop-saturate":[mr]}],"backdrop-sepia":[{"backdrop-sepia":[Fr]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[gt]}],"border-spacing-x":[{"border-spacing-x":[gt]}],"border-spacing-y":[{"border-spacing-y":[gt]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",isArbitraryValue]}],duration:[{duration:Qn()}],ease:[{ease:["linear","in","out","in-out",isArbitraryValue]}],delay:[{delay:Qn()}],animate:[{animate:["none","spin","ping","pulse","bounce",isArbitraryValue]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[br]}],"scale-x":[{"scale-x":[br]}],"scale-y":[{"scale-y":[br]}],rotate:[{rotate:[isInteger,isArbitraryValue]}],"translate-x":[{"translate-x":[Nr]}],"translate-y":[{"translate-y":[Nr]}],"skew-x":[{"skew-x":[kr]}],"skew-y":[{"skew-y":[kr]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",isArbitraryValue]}],accent:[{accent:["auto",it]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",isArbitraryValue]}],"caret-color":[{caret:[it]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Kn()}],"scroll-mx":[{"scroll-mx":Kn()}],"scroll-my":[{"scroll-my":Kn()}],"scroll-ms":[{"scroll-ms":Kn()}],"scroll-me":[{"scroll-me":Kn()}],"scroll-mt":[{"scroll-mt":Kn()}],"scroll-mr":[{"scroll-mr":Kn()}],"scroll-mb":[{"scroll-mb":Kn()}],"scroll-ml":[{"scroll-ml":Kn()}],"scroll-p":[{"scroll-p":Kn()}],"scroll-px":[{"scroll-px":Kn()}],"scroll-py":[{"scroll-py":Kn()}],"scroll-ps":[{"scroll-ps":Kn()}],"scroll-pe":[{"scroll-pe":Kn()}],"scroll-pt":[{"scroll-pt":Kn()}],"scroll-pr":[{"scroll-pr":Kn()}],"scroll-pb":[{"scroll-pb":Kn()}],"scroll-pl":[{"scroll-pl":Kn()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",isArbitraryValue]}],fill:[{fill:[it,"none"]}],"stroke-w":[{stroke:[isLength,isArbitraryLength,isArbitraryNumber]}],stroke:[{stroke:[it,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},twMerge=createTailwindMerge(getDefaultConfig),scriptRel="modulepreload",assetsURL=function(it){return"/"+it},seen={},__vitePreload=function(_,lt,ft){let mt=Promise.resolve();if(lt&&lt.length>0){document.getElementsByTagName("link");const gt=document.querySelector("meta[property=csp-nonce]"),bt=(gt==null?void 0:gt.nonce)||(gt==null?void 0:gt.getAttribute("nonce"));mt=Promise.allSettled(lt.map(wt=>{if(wt=assetsURL(wt),wt in seen)return;seen[wt]=!0;const vt=wt.endsWith(".css"),Ct=vt?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${wt}"]${Ct}`))return;const Rt=document.createElement("link");if(Rt.rel=vt?"stylesheet":scriptRel,vt||(Rt.as="script"),Rt.crossOrigin="",Rt.href=wt,bt&&Rt.setAttribute("nonce",bt),document.head.appendChild(Rt),vt)return new Promise((Mt,Ot)=>{Rt.addEventListener("load",Mt),Rt.addEventListener("error",()=>Ot(new Error(`Unable to preload CSS for ${wt}`)))})}))}function pt(gt){const bt=new Event("vite:preloadError",{cancelable:!0});if(bt.payload=gt,window.dispatchEvent(bt),!bt.defaultPrevented)throw gt}return mt.then(gt=>{for(const bt of gt||[])bt.status==="rejected"&&pt(bt.reason);return _().catch(pt)})},resolveFetch$3=it=>{let _;return it?_=it:typeof fetch>"u"?_=(...lt)=>__vitePreload(async()=>{const{default:ft}=await Promise.resolve().then(()=>browser);return{default:ft}},void 0).then(({default:ft})=>ft(...lt)):_=fetch,(...lt)=>_(...lt)};class FunctionsError extends Error{constructor(_,lt="FunctionsError",ft){super(_),this.name=lt,this.context=ft}}class FunctionsFetchError extends FunctionsError{constructor(_){super("Failed to send a request to the Edge Function","FunctionsFetchError",_)}}class FunctionsRelayError extends FunctionsError{constructor(_){super("Relay Error invoking the Edge Function","FunctionsRelayError",_)}}class FunctionsHttpError extends FunctionsError{constructor(_){super("Edge Function returned a non-2xx status code","FunctionsHttpError",_)}}var FunctionRegion;(function(it){it.Any="any",it.ApNortheast1="ap-northeast-1",it.ApNortheast2="ap-northeast-2",it.ApSouth1="ap-south-1",it.ApSoutheast1="ap-southeast-1",it.ApSoutheast2="ap-southeast-2",it.CaCentral1="ca-central-1",it.EuCentral1="eu-central-1",it.EuWest1="eu-west-1",it.EuWest2="eu-west-2",it.EuWest3="eu-west-3",it.SaEast1="sa-east-1",it.UsEast1="us-east-1",it.UsWest1="us-west-1",it.UsWest2="us-west-2"})(FunctionRegion||(FunctionRegion={}));var __awaiter$7=function(it,_,lt,ft){function mt(pt){return pt instanceof lt?pt:new lt(function(gt){gt(pt)})}return new(lt||(lt=Promise))(function(pt,gt){function bt(Ct){try{vt(ft.next(Ct))}catch(Rt){gt(Rt)}}function wt(Ct){try{vt(ft.throw(Ct))}catch(Rt){gt(Rt)}}function vt(Ct){Ct.done?pt(Ct.value):mt(Ct.value).then(bt,wt)}vt((ft=ft.apply(it,_||[])).next())})};class FunctionsClient{constructor(_,{headers:lt={},customFetch:ft,region:mt=FunctionRegion.Any}={}){this.url=_,this.headers=lt,this.region=mt,this.fetch=resolveFetch$3(ft)}setAuth(_){this.headers.Authorization=`Bearer ${_}`}invoke(_,lt={}){var ft;return __awaiter$7(this,void 0,void 0,function*(){try{const{headers:mt,method:pt,body:gt}=lt;let bt={},{region:wt}=lt;wt||(wt=this.region),wt&&wt!=="any"&&(bt["x-region"]=wt);let vt;gt&&(mt&&!Object.prototype.hasOwnProperty.call(mt,"Content-Type")||!mt)&&(typeof Blob<"u"&&gt instanceof Blob||gt instanceof ArrayBuffer?(bt["Content-Type"]="application/octet-stream",vt=gt):typeof gt=="string"?(bt["Content-Type"]="text/plain",vt=gt):typeof FormData<"u"&&gt instanceof FormData?vt=gt:(bt["Content-Type"]="application/json",vt=JSON.stringify(gt)));const Ct=yield this.fetch(`${this.url}/${_}`,{method:pt||"POST",headers:Object.assign(Object.assign(Object.assign({},bt),this.headers),mt),body:vt}).catch(Nt=>{throw new FunctionsFetchError(Nt)}),Rt=Ct.headers.get("x-relay-error");if(Rt&&Rt==="true")throw new FunctionsRelayError(Ct);if(!Ct.ok)throw new FunctionsHttpError(Ct);let Mt=((ft=Ct.headers.get("Content-Type"))!==null&&ft!==void 0?ft:"text/plain").split(";")[0].trim(),Ot;return Mt==="application/json"?Ot=yield Ct.json():Mt==="application/octet-stream"?Ot=yield Ct.blob():Mt==="text/event-stream"?Ot=Ct:Mt==="multipart/form-data"?Ot=yield Ct.formData():Ot=yield Ct.text(),{data:Ot,error:null}}catch(mt){return{data:null,error:mt}}})}}var cjs={},PostgrestClient$2={},PostgrestQueryBuilder$2={},PostgrestFilterBuilder$2={},PostgrestTransformBuilder$2={},PostgrestBuilder$2={},getGlobal=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},globalObject=getGlobal();const fetch$1=globalObject.fetch,nodeFetch=globalObject.fetch.bind(globalObject),Headers$1=globalObject.Headers,Request$1=globalObject.Request,Response$1=globalObject.Response,browser=Object.freeze(Object.defineProperty({__proto__:null,Headers:Headers$1,Request:Request$1,Response:Response$1,default:nodeFetch,fetch:fetch$1},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(browser);var PostgrestError$1={};Object.defineProperty(PostgrestError$1,"__esModule",{value:!0});class PostgrestError extends Error{constructor(_){super(_.message),this.name="PostgrestError",this.details=_.details,this.hint=_.hint,this.code=_.code}}PostgrestError$1.default=PostgrestError;var __importDefault$5=commonjsGlobal&&commonjsGlobal.__importDefault||function(it){return it&&it.__esModule?it:{default:it}};Object.defineProperty(PostgrestBuilder$2,"__esModule",{value:!0});const node_fetch_1=__importDefault$5(require$$0$1),PostgrestError_1$1=__importDefault$5(PostgrestError$1);let PostgrestBuilder$1=class{constructor(_){this.shouldThrowOnError=!1,this.method=_.method,this.url=_.url,this.headers=_.headers,this.schema=_.schema,this.body=_.body,this.shouldThrowOnError=_.shouldThrowOnError,this.signal=_.signal,this.isMaybeSingle=_.isMaybeSingle,_.fetch?this.fetch=_.fetch:typeof fetch>"u"?this.fetch=node_fetch_1.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(_,lt){return this.headers=Object.assign({},this.headers),this.headers[_]=lt,this}then(_,lt){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const ft=this.fetch;let mt=ft(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async pt=>{var gt,bt,wt;let vt=null,Ct=null,Rt=null,Mt=pt.status,Ot=pt.statusText;if(pt.ok){if(this.method!=="HEAD"){const hr=await pt.text();hr===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?Ct=hr:Ct=JSON.parse(hr))}const Ht=(gt=this.headers.Prefer)===null||gt===void 0?void 0:gt.match(/count=(exact|planned|estimated)/),Kt=(bt=pt.headers.get("content-range"))===null||bt===void 0?void 0:bt.split("/");Ht&&Kt&&Kt.length>1&&(Rt=parseInt(Kt[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(Ct)&&(Ct.length>1?(vt={code:"PGRST116",details:`Results contain ${Ct.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},Ct=null,Rt=null,Mt=406,Ot="Not Acceptable"):Ct.length===1?Ct=Ct[0]:Ct=null)}else{const Ht=await pt.text();try{vt=JSON.parse(Ht),Array.isArray(vt)&&pt.status===404&&(Ct=[],vt=null,Mt=200,Ot="OK")}catch{pt.status===404&&Ht===""?(Mt=204,Ot="No Content"):vt={message:Ht}}if(vt&&this.isMaybeSingle&&(!((wt=vt==null?void 0:vt.details)===null||wt===void 0)&&wt.includes("0 rows"))&&(vt=null,Mt=200,Ot="OK"),vt&&this.shouldThrowOnError)throw new PostgrestError_1$1.default(vt)}return{error:vt,data:Ct,count:Rt,status:Mt,statusText:Ot}});return this.shouldThrowOnError||(mt=mt.catch(pt=>{var gt,bt,wt;return{error:{message:`${(gt=pt==null?void 0:pt.name)!==null&&gt!==void 0?gt:"FetchError"}: ${pt==null?void 0:pt.message}`,details:`${(bt=pt==null?void 0:pt.stack)!==null&&bt!==void 0?bt:""}`,hint:"",code:`${(wt=pt==null?void 0:pt.code)!==null&&wt!==void 0?wt:""}`},data:null,count:null,status:0,statusText:""}})),mt.then(_,lt)}};PostgrestBuilder$2.default=PostgrestBuilder$1;var __importDefault$4=commonjsGlobal&&commonjsGlobal.__importDefault||function(it){return it&&it.__esModule?it:{default:it}};Object.defineProperty(PostgrestTransformBuilder$2,"__esModule",{value:!0});const PostgrestBuilder_1$1=__importDefault$4(PostgrestBuilder$2);let PostgrestTransformBuilder$1=class extends PostgrestBuilder_1$1.default{select(_){let lt=!1;const ft=(_??"*").split("").map(mt=>/\s/.test(mt)&&!lt?"":(mt==='"'&&(lt=!lt),mt)).join("");return this.url.searchParams.set("select",ft),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(_,{ascending:lt=!0,nullsFirst:ft,foreignTable:mt,referencedTable:pt=mt}={}){const gt=pt?`${pt}.order`:"order",bt=this.url.searchParams.get(gt);return this.url.searchParams.set(gt,`${bt?`${bt},`:""}${_}.${lt?"asc":"desc"}${ft===void 0?"":ft?".nullsfirst":".nullslast"}`),this}limit(_,{foreignTable:lt,referencedTable:ft=lt}={}){const mt=typeof ft>"u"?"limit":`${ft}.limit`;return this.url.searchParams.set(mt,`${_}`),this}range(_,lt,{foreignTable:ft,referencedTable:mt=ft}={}){const pt=typeof mt>"u"?"offset":`${mt}.offset`,gt=typeof mt>"u"?"limit":`${mt}.limit`;return this.url.searchParams.set(pt,`${_}`),this.url.searchParams.set(gt,`${lt-_+1}`),this}abortSignal(_){return this.signal=_,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:_=!1,verbose:lt=!1,settings:ft=!1,buffers:mt=!1,wal:pt=!1,format:gt="text"}={}){var bt;const wt=[_?"analyze":null,lt?"verbose":null,ft?"settings":null,mt?"buffers":null,pt?"wal":null].filter(Boolean).join("|"),vt=(bt=this.headers.Accept)!==null&&bt!==void 0?bt:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${gt}; for="${vt}"; options=${wt};`,gt==="json"?this:this}rollback(){var _;return((_=this.headers.Prefer)!==null&&_!==void 0?_:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};PostgrestTransformBuilder$2.default=PostgrestTransformBuilder$1;var __importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(it){return it&&it.__esModule?it:{default:it}};Object.defineProperty(PostgrestFilterBuilder$2,"__esModule",{value:!0});const PostgrestTransformBuilder_1$1=__importDefault$3(PostgrestTransformBuilder$2);let PostgrestFilterBuilder$1=class extends PostgrestTransformBuilder_1$1.default{eq(_,lt){return this.url.searchParams.append(_,`eq.${lt}`),this}neq(_,lt){return this.url.searchParams.append(_,`neq.${lt}`),this}gt(_,lt){return this.url.searchParams.append(_,`gt.${lt}`),this}gte(_,lt){return this.url.searchParams.append(_,`gte.${lt}`),this}lt(_,lt){return this.url.searchParams.append(_,`lt.${lt}`),this}lte(_,lt){return this.url.searchParams.append(_,`lte.${lt}`),this}like(_,lt){return this.url.searchParams.append(_,`like.${lt}`),this}likeAllOf(_,lt){return this.url.searchParams.append(_,`like(all).{${lt.join(",")}}`),this}likeAnyOf(_,lt){return this.url.searchParams.append(_,`like(any).{${lt.join(",")}}`),this}ilike(_,lt){return this.url.searchParams.append(_,`ilike.${lt}`),this}ilikeAllOf(_,lt){return this.url.searchParams.append(_,`ilike(all).{${lt.join(",")}}`),this}ilikeAnyOf(_,lt){return this.url.searchParams.append(_,`ilike(any).{${lt.join(",")}}`),this}is(_,lt){return this.url.searchParams.append(_,`is.${lt}`),this}in(_,lt){const ft=Array.from(new Set(lt)).map(mt=>typeof mt=="string"&&new RegExp("[,()]").test(mt)?`"${mt}"`:`${mt}`).join(",");return this.url.searchParams.append(_,`in.(${ft})`),this}contains(_,lt){return typeof lt=="string"?this.url.searchParams.append(_,`cs.${lt}`):Array.isArray(lt)?this.url.searchParams.append(_,`cs.{${lt.join(",")}}`):this.url.searchParams.append(_,`cs.${JSON.stringify(lt)}`),this}containedBy(_,lt){return typeof lt=="string"?this.url.searchParams.append(_,`cd.${lt}`):Array.isArray(lt)?this.url.searchParams.append(_,`cd.{${lt.join(",")}}`):this.url.searchParams.append(_,`cd.${JSON.stringify(lt)}`),this}rangeGt(_,lt){return this.url.searchParams.append(_,`sr.${lt}`),this}rangeGte(_,lt){return this.url.searchParams.append(_,`nxl.${lt}`),this}rangeLt(_,lt){return this.url.searchParams.append(_,`sl.${lt}`),this}rangeLte(_,lt){return this.url.searchParams.append(_,`nxr.${lt}`),this}rangeAdjacent(_,lt){return this.url.searchParams.append(_,`adj.${lt}`),this}overlaps(_,lt){return typeof lt=="string"?this.url.searchParams.append(_,`ov.${lt}`):this.url.searchParams.append(_,`ov.{${lt.join(",")}}`),this}textSearch(_,lt,{config:ft,type:mt}={}){let pt="";mt==="plain"?pt="pl":mt==="phrase"?pt="ph":mt==="websearch"&&(pt="w");const gt=ft===void 0?"":`(${ft})`;return this.url.searchParams.append(_,`${pt}fts${gt}.${lt}`),this}match(_){return Object.entries(_).forEach(([lt,ft])=>{this.url.searchParams.append(lt,`eq.${ft}`)}),this}not(_,lt,ft){return this.url.searchParams.append(_,`not.${lt}.${ft}`),this}or(_,{foreignTable:lt,referencedTable:ft=lt}={}){const mt=ft?`${ft}.or`:"or";return this.url.searchParams.append(mt,`(${_})`),this}filter(_,lt,ft){return this.url.searchParams.append(_,`${lt}.${ft}`),this}};PostgrestFilterBuilder$2.default=PostgrestFilterBuilder$1;var __importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(it){return it&&it.__esModule?it:{default:it}};Object.defineProperty(PostgrestQueryBuilder$2,"__esModule",{value:!0});const PostgrestFilterBuilder_1$2=__importDefault$2(PostgrestFilterBuilder$2);let PostgrestQueryBuilder$1=class{constructor(_,{headers:lt={},schema:ft,fetch:mt}){this.url=_,this.headers=lt,this.schema=ft,this.fetch=mt}select(_,{head:lt=!1,count:ft}={}){const mt=lt?"HEAD":"GET";let pt=!1;const gt=(_??"*").split("").map(bt=>/\s/.test(bt)&&!pt?"":(bt==='"'&&(pt=!pt),bt)).join("");return this.url.searchParams.set("select",gt),ft&&(this.headers.Prefer=`count=${ft}`),new PostgrestFilterBuilder_1$2.default({method:mt,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(_,{count:lt,defaultToNull:ft=!0}={}){const mt="POST",pt=[];if(this.headers.Prefer&&pt.push(this.headers.Prefer),lt&&pt.push(`count=${lt}`),ft||pt.push("missing=default"),this.headers.Prefer=pt.join(","),Array.isArray(_)){const gt=_.reduce((bt,wt)=>bt.concat(Object.keys(wt)),[]);if(gt.length>0){const bt=[...new Set(gt)].map(wt=>`"${wt}"`);this.url.searchParams.set("columns",bt.join(","))}}return new PostgrestFilterBuilder_1$2.default({method:mt,url:this.url,headers:this.headers,schema:this.schema,body:_,fetch:this.fetch,allowEmpty:!1})}upsert(_,{onConflict:lt,ignoreDuplicates:ft=!1,count:mt,defaultToNull:pt=!0}={}){const gt="POST",bt=[`resolution=${ft?"ignore":"merge"}-duplicates`];if(lt!==void 0&&this.url.searchParams.set("on_conflict",lt),this.headers.Prefer&&bt.push(this.headers.Prefer),mt&&bt.push(`count=${mt}`),pt||bt.push("missing=default"),this.headers.Prefer=bt.join(","),Array.isArray(_)){const wt=_.reduce((vt,Ct)=>vt.concat(Object.keys(Ct)),[]);if(wt.length>0){const vt=[...new Set(wt)].map(Ct=>`"${Ct}"`);this.url.searchParams.set("columns",vt.join(","))}}return new PostgrestFilterBuilder_1$2.default({method:gt,url:this.url,headers:this.headers,schema:this.schema,body:_,fetch:this.fetch,allowEmpty:!1})}update(_,{count:lt}={}){const ft="PATCH",mt=[];return this.headers.Prefer&&mt.push(this.headers.Prefer),lt&&mt.push(`count=${lt}`),this.headers.Prefer=mt.join(","),new PostgrestFilterBuilder_1$2.default({method:ft,url:this.url,headers:this.headers,schema:this.schema,body:_,fetch:this.fetch,allowEmpty:!1})}delete({count:_}={}){const lt="DELETE",ft=[];return _&&ft.push(`count=${_}`),this.headers.Prefer&&ft.unshift(this.headers.Prefer),this.headers.Prefer=ft.join(","),new PostgrestFilterBuilder_1$2.default({method:lt,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};PostgrestQueryBuilder$2.default=PostgrestQueryBuilder$1;var constants={},version$4={};Object.defineProperty(version$4,"__esModule",{value:!0});version$4.version=void 0;version$4.version="0.0.0-automated";Object.defineProperty(constants,"__esModule",{value:!0});constants.DEFAULT_HEADERS=void 0;const version_1=version$4;constants.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${version_1.version}`};var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(it){return it&&it.__esModule?it:{default:it}};Object.defineProperty(PostgrestClient$2,"__esModule",{value:!0});const PostgrestQueryBuilder_1$1=__importDefault$1(PostgrestQueryBuilder$2),PostgrestFilterBuilder_1$1=__importDefault$1(PostgrestFilterBuilder$2),constants_1=constants;let PostgrestClient$1=class gv{constructor(_,{headers:lt={},schema:ft,fetch:mt}={}){this.url=_,this.headers=Object.assign(Object.assign({},constants_1.DEFAULT_HEADERS),lt),this.schemaName=ft,this.fetch=mt}from(_){const lt=new URL(`${this.url}/${_}`);return new PostgrestQueryBuilder_1$1.default(lt,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(_){return new gv(this.url,{headers:this.headers,schema:_,fetch:this.fetch})}rpc(_,lt={},{head:ft=!1,get:mt=!1,count:pt}={}){let gt;const bt=new URL(`${this.url}/rpc/${_}`);let wt;ft||mt?(gt=ft?"HEAD":"GET",Object.entries(lt).filter(([Ct,Rt])=>Rt!==void 0).map(([Ct,Rt])=>[Ct,Array.isArray(Rt)?`{${Rt.join(",")}}`:`${Rt}`]).forEach(([Ct,Rt])=>{bt.searchParams.append(Ct,Rt)})):(gt="POST",wt=lt);const vt=Object.assign({},this.headers);return pt&&(vt.Prefer=`count=${pt}`),new PostgrestFilterBuilder_1$1.default({method:gt,url:bt,headers:vt,schema:this.schemaName,body:wt,fetch:this.fetch,allowEmpty:!1})}};PostgrestClient$2.default=PostgrestClient$1;var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(it){return it&&it.__esModule?it:{default:it}};Object.defineProperty(cjs,"__esModule",{value:!0});cjs.PostgrestError=cjs.PostgrestBuilder=cjs.PostgrestTransformBuilder=cjs.PostgrestFilterBuilder=cjs.PostgrestQueryBuilder=cjs.PostgrestClient=void 0;const PostgrestClient_1=__importDefault(PostgrestClient$2);cjs.PostgrestClient=PostgrestClient_1.default;const PostgrestQueryBuilder_1=__importDefault(PostgrestQueryBuilder$2);cjs.PostgrestQueryBuilder=PostgrestQueryBuilder_1.default;const PostgrestFilterBuilder_1=__importDefault(PostgrestFilterBuilder$2);cjs.PostgrestFilterBuilder=PostgrestFilterBuilder_1.default;const PostgrestTransformBuilder_1=__importDefault(PostgrestTransformBuilder$2);cjs.PostgrestTransformBuilder=PostgrestTransformBuilder_1.default;const PostgrestBuilder_1=__importDefault(PostgrestBuilder$2);cjs.PostgrestBuilder=PostgrestBuilder_1.default;const PostgrestError_1=__importDefault(PostgrestError$1);cjs.PostgrestError=PostgrestError_1.default;var _default=cjs.default={PostgrestClient:PostgrestClient_1.default,PostgrestQueryBuilder:PostgrestQueryBuilder_1.default,PostgrestFilterBuilder:PostgrestFilterBuilder_1.default,PostgrestTransformBuilder:PostgrestTransformBuilder_1.default,PostgrestBuilder:PostgrestBuilder_1.default,PostgrestError:PostgrestError_1.default};const{PostgrestClient,PostgrestQueryBuilder,PostgrestFilterBuilder,PostgrestTransformBuilder,PostgrestBuilder}=_default,version$3="2.10.7",DEFAULT_HEADERS$3={"X-Client-Info":`realtime-js/${version$3}`},VSN="1.0.0",DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3;var SOCKET_STATES;(function(it){it[it.connecting=0]="connecting",it[it.open=1]="open",it[it.closing=2]="closing",it[it.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(it){it.closed="closed",it.errored="errored",it.joined="joined",it.joining="joining",it.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(it){it.close="phx_close",it.error="phx_error",it.join="phx_join",it.reply="phx_reply",it.leave="phx_leave",it.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(it){it.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(it){it.Connecting="connecting",it.Open="open",it.Closing="closing",it.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Serializer{constructor(){this.HEADER_LENGTH=1}decode(_,lt){return _.constructor===ArrayBuffer?lt(this._binaryDecode(_)):lt(typeof _=="string"?JSON.parse(_):{})}_binaryDecode(_){const lt=new DataView(_),ft=new TextDecoder;return this._decodeBroadcast(_,lt,ft)}_decodeBroadcast(_,lt,ft){const mt=lt.getUint8(1),pt=lt.getUint8(2);let gt=this.HEADER_LENGTH+2;const bt=ft.decode(_.slice(gt,gt+mt));gt=gt+mt;const wt=ft.decode(_.slice(gt,gt+pt));gt=gt+pt;const vt=JSON.parse(ft.decode(_.slice(gt,_.byteLength)));return{ref:null,topic:bt,event:wt,payload:vt}}}class Timer{constructor(_,lt){this.callback=_,this.timerCalc=lt,this.timer=void 0,this.tries=0,this.callback=_,this.timerCalc=lt}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var PostgresTypes;(function(it){it.abstime="abstime",it.bool="bool",it.date="date",it.daterange="daterange",it.float4="float4",it.float8="float8",it.int2="int2",it.int4="int4",it.int4range="int4range",it.int8="int8",it.int8range="int8range",it.json="json",it.jsonb="jsonb",it.money="money",it.numeric="numeric",it.oid="oid",it.reltime="reltime",it.text="text",it.time="time",it.timestamp="timestamp",it.timestamptz="timestamptz",it.timetz="timetz",it.tsrange="tsrange",it.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(it,_,lt={})=>{var ft;const mt=(ft=lt.skipTypes)!==null&&ft!==void 0?ft:[];return Object.keys(_).reduce((pt,gt)=>(pt[gt]=convertColumn(gt,it,_,mt),pt),{})},convertColumn=(it,_,lt,ft)=>{const mt=_.find(bt=>bt.name===it),pt=mt==null?void 0:mt.type,gt=lt[it];return pt&&!ft.includes(pt)?convertCell(pt,gt):noop$3(gt)},convertCell=(it,_)=>{if(it.charAt(0)==="_"){const lt=it.slice(1,it.length);return toArray(_,lt)}switch(it){case PostgresTypes.bool:return toBoolean(_);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(_);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(_);case PostgresTypes.timestamp:return toTimestampString(_);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$3(_);default:return noop$3(_)}},noop$3=it=>it,toBoolean=it=>{switch(it){case"t":return!0;case"f":return!1;default:return it}},toNumber=it=>{if(typeof it=="string"){const _=parseFloat(it);if(!Number.isNaN(_))return _}return it},toJson=it=>{if(typeof it=="string")try{return JSON.parse(it)}catch(_){return console.log(`JSON parse error: ${_}`),it}return it},toArray=(it,_)=>{if(typeof it!="string")return it;const lt=it.length-1,ft=it[lt];if(it[0]==="{"&&ft==="}"){let pt;const gt=it.slice(1,lt);try{pt=JSON.parse("["+gt+"]")}catch{pt=gt?gt.split(","):[]}return pt.map(bt=>convertCell(_,bt))}return it},toTimestampString=it=>typeof it=="string"?it.replace(" ","T"):it,httpEndpointURL=it=>{let _=it;return _=_.replace(/^ws/i,"http"),_=_.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),_.replace(/\/+$/,"")};class Push{constructor(_,lt,ft={},mt=DEFAULT_TIMEOUT){this.channel=_,this.event=lt,this.payload=ft,this.timeout=mt,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(_){this.timeout=_,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(_){this.payload=Object.assign(Object.assign({},this.payload),_)}receive(_,lt){var ft;return this._hasReceived(_)&&lt((ft=this.receivedResp)===null||ft===void 0?void 0:ft.response),this.recHooks.push({status:_,callback:lt}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const _=lt=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=lt,this._matchReceive(lt)};this.channel._on(this.refEvent,{},_),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(_,lt){this.refEvent&&this.channel._trigger(this.refEvent,{status:_,response:lt})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:_,response:lt}){this.recHooks.filter(ft=>ft.status===_).forEach(ft=>ft.callback(lt))}_hasReceived(_){return this.receivedResp&&this.receivedResp.status===_}}var REALTIME_PRESENCE_LISTEN_EVENTS;(function(it){it.SYNC="sync",it.JOIN="join",it.LEAVE="leave"})(REALTIME_PRESENCE_LISTEN_EVENTS||(REALTIME_PRESENCE_LISTEN_EVENTS={}));class RealtimePresence{constructor(_,lt){this.channel=_,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const ft=(lt==null?void 0:lt.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(ft.state,{},mt=>{const{onJoin:pt,onLeave:gt,onSync:bt}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,mt,pt,gt),this.pendingDiffs.forEach(wt=>{this.state=RealtimePresence.syncDiff(this.state,wt,pt,gt)}),this.pendingDiffs=[],bt()}),this.channel._on(ft.diff,{},mt=>{const{onJoin:pt,onLeave:gt,onSync:bt}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(mt):(this.state=RealtimePresence.syncDiff(this.state,mt,pt,gt),bt())}),this.onJoin((mt,pt,gt)=>{this.channel._trigger("presence",{event:"join",key:mt,currentPresences:pt,newPresences:gt})}),this.onLeave((mt,pt,gt)=>{this.channel._trigger("presence",{event:"leave",key:mt,currentPresences:pt,leftPresences:gt})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(_,lt,ft,mt){const pt=this.cloneDeep(_),gt=this.transformState(lt),bt={},wt={};return this.map(pt,(vt,Ct)=>{gt[vt]||(wt[vt]=Ct)}),this.map(gt,(vt,Ct)=>{const Rt=pt[vt];if(Rt){const Mt=Ct.map(Kt=>Kt.presence_ref),Ot=Rt.map(Kt=>Kt.presence_ref),Nt=Ct.filter(Kt=>Ot.indexOf(Kt.presence_ref)<0),Ht=Rt.filter(Kt=>Mt.indexOf(Kt.presence_ref)<0);Nt.length>0&&(bt[vt]=Nt),Ht.length>0&&(wt[vt]=Ht)}else bt[vt]=Ct}),this.syncDiff(pt,{joins:bt,leaves:wt},ft,mt)}static syncDiff(_,lt,ft,mt){const{joins:pt,leaves:gt}={joins:this.transformState(lt.joins),leaves:this.transformState(lt.leaves)};return ft||(ft=()=>{}),mt||(mt=()=>{}),this.map(pt,(bt,wt)=>{var vt;const Ct=(vt=_[bt])!==null&&vt!==void 0?vt:[];if(_[bt]=this.cloneDeep(wt),Ct.length>0){const Rt=_[bt].map(Ot=>Ot.presence_ref),Mt=Ct.filter(Ot=>Rt.indexOf(Ot.presence_ref)<0);_[bt].unshift(...Mt)}ft(bt,Ct,wt)}),this.map(gt,(bt,wt)=>{let vt=_[bt];if(!vt)return;const Ct=wt.map(Rt=>Rt.presence_ref);vt=vt.filter(Rt=>Ct.indexOf(Rt.presence_ref)<0),_[bt]=vt,mt(bt,vt,wt),vt.length===0&&delete _[bt]}),_}static map(_,lt){return Object.getOwnPropertyNames(_).map(ft=>lt(ft,_[ft]))}static transformState(_){return _=this.cloneDeep(_),Object.getOwnPropertyNames(_).reduce((lt,ft)=>{const mt=_[ft];return"metas"in mt?lt[ft]=mt.metas.map(pt=>(pt.presence_ref=pt.phx_ref,delete pt.phx_ref,delete pt.phx_ref_prev,pt)):lt[ft]=mt,lt},{})}static cloneDeep(_){return JSON.parse(JSON.stringify(_))}onJoin(_){this.caller.onJoin=_}onLeave(_){this.caller.onLeave=_}onSync(_){this.caller.onSync=_}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;(function(it){it.ALL="*",it.INSERT="INSERT",it.UPDATE="UPDATE",it.DELETE="DELETE"})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT||(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT={}));var REALTIME_LISTEN_TYPES;(function(it){it.BROADCAST="broadcast",it.PRESENCE="presence",it.POSTGRES_CHANGES="postgres_changes",it.SYSTEM="system"})(REALTIME_LISTEN_TYPES||(REALTIME_LISTEN_TYPES={}));var REALTIME_SUBSCRIBE_STATES;(function(it){it.SUBSCRIBED="SUBSCRIBED",it.TIMED_OUT="TIMED_OUT",it.CLOSED="CLOSED",it.CHANNEL_ERROR="CHANNEL_ERROR"})(REALTIME_SUBSCRIBE_STATES||(REALTIME_SUBSCRIBE_STATES={}));class RealtimeChannel{constructor(_,lt={config:{}},ft){this.topic=_,this.params=lt,this.socket=ft,this.bindings={},this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=_.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},lt.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(mt=>mt.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(mt=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,mt),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(CHANNEL_EVENTS.reply,{},(mt,pt)=>{this._trigger(this._replyEventName(pt),mt)}),this.presence=new RealtimePresence(this),this.broadcastEndpointURL=httpEndpointURL(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(_,lt=this.timeout){var ft,mt;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:pt,presence:gt,private:bt}}=this.params;this._onError(Ct=>_&&_("CHANNEL_ERROR",Ct)),this._onClose(()=>_&&_("CLOSED"));const wt={},vt={broadcast:pt,presence:gt,postgres_changes:(mt=(ft=this.bindings.postgres_changes)===null||ft===void 0?void 0:ft.map(Ct=>Ct.filter))!==null&&mt!==void 0?mt:[],private:bt};this.socket.accessToken&&(wt.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:vt},wt)),this.joinedOnce=!0,this._rejoin(lt),this.joinPush.receive("ok",({postgres_changes:Ct})=>{var Rt;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),Ct===void 0){_&&_("SUBSCRIBED");return}else{const Mt=this.bindings.postgres_changes,Ot=(Rt=Mt==null?void 0:Mt.length)!==null&&Rt!==void 0?Rt:0,Nt=[];for(let Ht=0;Ht<Ot;Ht++){const Kt=Mt[Ht],{filter:{event:hr,schema:Qt,table:mr,filter:br}}=Kt,Fr=Ct&&Ct[Ht];if(Fr&&Fr.event===hr&&Fr.schema===Qt&&Fr.table===mr&&Fr.filter===br)Nt.push(Object.assign(Object.assign({},Kt),{id:Fr.id}));else{this.unsubscribe(),_&&_("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Nt,_&&_("SUBSCRIBED");return}}).receive("error",Ct=>{_&&_("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(Ct).join(", ")||"error")))}).receive("timeout",()=>{_&&_("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(_,lt={}){return await this.send({type:"presence",event:"track",payload:_},lt.timeout||this.timeout)}async untrack(_={}){return await this.send({type:"presence",event:"untrack"},_)}on(_,lt,ft){return this._on(_,lt,ft)}async send(_,lt={}){var ft,mt;if(!this._canPush()&&_.type==="broadcast"){const{event:pt,payload:gt}=_,bt={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:pt,payload:gt,private:this.private}]})};try{const wt=await this._fetchWithTimeout(this.broadcastEndpointURL,bt,(ft=lt.timeout)!==null&&ft!==void 0?ft:this.timeout);return await((mt=wt.body)===null||mt===void 0?void 0:mt.cancel()),wt.ok?"ok":"error"}catch(wt){return wt.name==="AbortError"?"timed out":"error"}}else return new Promise(pt=>{var gt,bt,wt;const vt=this._push(_.type,_,lt.timeout||this.timeout);_.type==="broadcast"&&!(!((wt=(bt=(gt=this.params)===null||gt===void 0?void 0:gt.config)===null||bt===void 0?void 0:bt.broadcast)===null||wt===void 0)&&wt.ack)&&pt("ok"),vt.receive("ok",()=>pt("ok")),vt.receive("error",()=>pt("error")),vt.receive("timeout",()=>pt("timed out"))})}updateJoinPayload(_){this.joinPush.updatePayload(_)}unsubscribe(_=this.timeout){this.state=CHANNEL_STATES.leaving;const lt=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(CHANNEL_EVENTS.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(ft=>{const mt=new Push(this,CHANNEL_EVENTS.leave,{},_);mt.receive("ok",()=>{lt(),ft("ok")}).receive("timeout",()=>{lt(),ft("timed out")}).receive("error",()=>{ft("error")}),mt.send(),this._canPush()||mt.trigger("ok",{})})}async _fetchWithTimeout(_,lt,ft){const mt=new AbortController,pt=setTimeout(()=>mt.abort(),ft),gt=await this.socket.fetch(_,Object.assign(Object.assign({},lt),{signal:mt.signal}));return clearTimeout(pt),gt}_push(_,lt,ft=this.timeout){if(!this.joinedOnce)throw`tried to push '${_}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let mt=new Push(this,_,lt,ft);return this._canPush()?mt.send():(mt.startTimeout(),this.pushBuffer.push(mt)),mt}_onMessage(_,lt,ft){return lt}_isMember(_){return this.topic===_}_joinRef(){return this.joinPush.ref}_trigger(_,lt,ft){var mt,pt;const gt=_.toLocaleLowerCase(),{close:bt,error:wt,leave:vt,join:Ct}=CHANNEL_EVENTS;if(ft&&[bt,wt,vt,Ct].indexOf(gt)>=0&&ft!==this._joinRef())return;let Mt=this._onMessage(gt,lt,ft);if(lt&&!Mt)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(gt)?(mt=this.bindings.postgres_changes)===null||mt===void 0||mt.filter(Ot=>{var Nt,Ht,Kt;return((Nt=Ot.filter)===null||Nt===void 0?void 0:Nt.event)==="*"||((Kt=(Ht=Ot.filter)===null||Ht===void 0?void 0:Ht.event)===null||Kt===void 0?void 0:Kt.toLocaleLowerCase())===gt}).map(Ot=>Ot.callback(Mt,ft)):(pt=this.bindings[gt])===null||pt===void 0||pt.filter(Ot=>{var Nt,Ht,Kt,hr,Qt,mr;if(["broadcast","presence","postgres_changes"].includes(gt))if("id"in Ot){const br=Ot.id,Fr=(Nt=Ot.filter)===null||Nt===void 0?void 0:Nt.event;return br&&((Ht=lt.ids)===null||Ht===void 0?void 0:Ht.includes(br))&&(Fr==="*"||(Fr==null?void 0:Fr.toLocaleLowerCase())===((Kt=lt.data)===null||Kt===void 0?void 0:Kt.type.toLocaleLowerCase()))}else{const br=(Qt=(hr=Ot==null?void 0:Ot.filter)===null||hr===void 0?void 0:hr.event)===null||Qt===void 0?void 0:Qt.toLocaleLowerCase();return br==="*"||br===((mr=lt==null?void 0:lt.event)===null||mr===void 0?void 0:mr.toLocaleLowerCase())}else return Ot.type.toLocaleLowerCase()===gt}).map(Ot=>{if(typeof Mt=="object"&&"ids"in Mt){const Nt=Mt.data,{schema:Ht,table:Kt,commit_timestamp:hr,type:Qt,errors:mr}=Nt;Mt=Object.assign(Object.assign({},{schema:Ht,table:Kt,commit_timestamp:hr,eventType:Qt,new:{},old:{},errors:mr}),this._getPayloadRecords(Nt))}Ot.callback(Mt,ft)})}_isClosed(){return this.state===CHANNEL_STATES.closed}_isJoined(){return this.state===CHANNEL_STATES.joined}_isJoining(){return this.state===CHANNEL_STATES.joining}_isLeaving(){return this.state===CHANNEL_STATES.leaving}_replyEventName(_){return`chan_reply_${_}`}_on(_,lt,ft){const mt=_.toLocaleLowerCase(),pt={type:mt,filter:lt,callback:ft};return this.bindings[mt]?this.bindings[mt].push(pt):this.bindings[mt]=[pt],this}_off(_,lt){const ft=_.toLocaleLowerCase();return this.bindings[ft]=this.bindings[ft].filter(mt=>{var pt;return!(((pt=mt.type)===null||pt===void 0?void 0:pt.toLocaleLowerCase())===ft&&RealtimeChannel.isEqual(mt.filter,lt))}),this}static isEqual(_,lt){if(Object.keys(_).length!==Object.keys(lt).length)return!1;for(const ft in _)if(_[ft]!==lt[ft])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(_){this._on(CHANNEL_EVENTS.close,{},_)}_onError(_){this._on(CHANNEL_EVENTS.error,{},lt=>_(lt))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(_=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(_))}_getPayloadRecords(_){const lt={new:{},old:{}};return(_.type==="INSERT"||_.type==="UPDATE")&&(lt.new=convertChangeData(_.columns,_.record)),(_.type==="UPDATE"||_.type==="DELETE")&&(lt.old=convertChangeData(_.columns,_.old_record)),lt}}const noop$2=()=>{},NATIVE_WEBSOCKET_AVAILABLE=typeof WebSocket<"u",WORKER_SCRIPT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class RealtimeClient{constructor(_,lt){var ft;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=DEFAULT_HEADERS$3,this.params={},this.timeout=DEFAULT_TIMEOUT,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=noop$2,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=pt=>{let gt;return pt?gt=pt:typeof fetch>"u"?gt=(...bt)=>__vitePreload(async()=>{const{default:wt}=await Promise.resolve().then(()=>browser);return{default:wt}},void 0).then(({default:wt})=>wt(...bt)):gt=fetch,(...bt)=>gt(...bt)},this.endPoint=`${_}/${TRANSPORTS.websocket}`,this.httpEndpoint=httpEndpointURL(_),lt!=null&&lt.transport?this.transport=lt.transport:this.transport=null,lt!=null&&lt.params&&(this.params=lt.params),lt!=null&&lt.headers&&(this.headers=Object.assign(Object.assign({},this.headers),lt.headers)),lt!=null&&lt.timeout&&(this.timeout=lt.timeout),lt!=null&&lt.logger&&(this.logger=lt.logger),lt!=null&&lt.heartbeatIntervalMs&&(this.heartbeatIntervalMs=lt.heartbeatIntervalMs);const mt=(ft=lt==null?void 0:lt.params)===null||ft===void 0?void 0:ft.apikey;if(mt&&(this.accessToken=mt,this.apiKey=mt),this.reconnectAfterMs=lt!=null&&lt.reconnectAfterMs?lt.reconnectAfterMs:pt=>[1e3,2e3,5e3,1e4][pt-1]||1e4,this.encode=lt!=null&&lt.encode?lt.encode:(pt,gt)=>gt(JSON.stringify(pt)),this.decode=lt!=null&&lt.decode?lt.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Timer(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(lt==null?void 0:lt.fetch),lt!=null&&lt.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(lt==null?void 0:lt.worker)||!1,this.workerUrl=lt==null?void 0:lt.workerUrl}}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(NATIVE_WEBSOCKET_AVAILABLE){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new WSWebSocketDummy(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),__vitePreload(async()=>{const{default:_}=await import("./browser-DSZtaPJ5.js").then(lt=>lt.b);return{default:_}},[]).then(({default:_})=>{this.conn=new _(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(_,lt){this.conn&&(this.conn.onclose=function(){},_?this.conn.close(_,lt??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(_){const lt=await _.unsubscribe();return this.channels.length===0&&this.disconnect(),lt}async removeAllChannels(){const _=await Promise.all(this.channels.map(lt=>lt.unsubscribe()));return this.disconnect(),_}log(_,lt,ft){this.logger(_,lt,ft)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}channel(_,lt={config:{}}){const ft=new RealtimeChannel(`realtime:${_}`,lt,this);return this.channels.push(ft),ft}push(_){const{topic:lt,event:ft,payload:mt,ref:pt}=_,gt=()=>{this.encode(_,bt=>{var wt;(wt=this.conn)===null||wt===void 0||wt.send(bt)})};this.log("push",`${lt} ${ft} (${pt})`,mt),this.isConnected()?gt():this.sendBuffer.push(gt)}setAuth(_){this.accessToken=_,this.channels.forEach(lt=>{_&&lt.updateJoinPayload({access_token:_}),lt.joinedOnce&&lt._isJoined()&&lt._push(CHANNEL_EVENTS.access_token,{access_token:_})})}_makeRef(){let _=this.ref+1;return _===this.ref?this.ref=0:this.ref=_,this.ref.toString()}_leaveOpenTopic(_){let lt=this.channels.find(ft=>ft.topic===_&&(ft._isJoined()||ft._isJoining()));lt&&(this.log("transport",`leaving duplicate topic "${_}"`),lt.unsubscribe())}_remove(_){this.channels=this.channels.filter(lt=>lt._joinRef()!==_._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=_=>this._onConnError(_),this.conn.onmessage=_=>this._onConnMessage(_),this.conn.onclose=_=>this._onConnClose(_))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:VSN}))}_onConnMessage(_){this.decode(_.data,lt=>{let{topic:ft,event:mt,payload:pt,ref:gt}=lt;(gt&&gt===this.pendingHeartbeatRef||mt===(pt==null?void 0:pt.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${pt.status||""} ${ft} ${mt} ${gt&&"("+gt+")"||""}`,pt),this.channels.filter(bt=>bt._isMember(ft)).forEach(bt=>bt._trigger(mt,pt,gt)),this.stateChangeCallbacks.message.forEach(bt=>bt(lt))})}async _onConnOpen(){if(this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const _=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(_),this.workerRef.onerror=lt=>{this.log("worker","worker error",lt.message),this.workerRef.terminate()},this.workerRef.onmessage=lt=>{lt.data.event==="keepAlive"&&this._sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(_=>_())}_onConnClose(_){this.log("transport","close",_),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(lt=>lt(_))}_onConnError(_){this.log("transport",_.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(lt=>lt(_))}_triggerChanError(){this.channels.forEach(_=>_._trigger(CHANNEL_EVENTS.error))}_appendParams(_,lt){if(Object.keys(lt).length===0)return _;const ft=_.match(/\?/)?"&":"?",mt=new URLSearchParams(lt);return`${_}${ft}${mt}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(_=>_()),this.sendBuffer=[])}_sendHeartbeat(){var _;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(_=this.conn)===null||_===void 0||_.close(WS_CLOSE_NORMAL,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(_){let lt;if(_)lt=_;else{const ft=new Blob([WORKER_SCRIPT],{type:"application/javascript"});lt=URL.createObjectURL(ft)}return lt}}class WSWebSocketDummy{constructor(_,lt,ft){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=SOCKET_STATES.connecting,this.send=()=>{},this.url=null,this.url=_,this.close=ft.close}}class StorageError extends Error{constructor(_){super(_),this.__isStorageError=!0,this.name="StorageError"}}function isStorageError(it){return typeof it=="object"&&it!==null&&"__isStorageError"in it}class StorageApiError extends StorageError{constructor(_,lt){super(_),this.name="StorageApiError",this.status=lt}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class StorageUnknownError extends StorageError{constructor(_,lt){super(_),this.name="StorageUnknownError",this.originalError=lt}}var __awaiter$6=function(it,_,lt,ft){function mt(pt){return pt instanceof lt?pt:new lt(function(gt){gt(pt)})}return new(lt||(lt=Promise))(function(pt,gt){function bt(Ct){try{vt(ft.next(Ct))}catch(Rt){gt(Rt)}}function wt(Ct){try{vt(ft.throw(Ct))}catch(Rt){gt(Rt)}}function vt(Ct){Ct.done?pt(Ct.value):mt(Ct.value).then(bt,wt)}vt((ft=ft.apply(it,_||[])).next())})};const resolveFetch$2=it=>{let _;return it?_=it:typeof fetch>"u"?_=(...lt)=>__vitePreload(async()=>{const{default:ft}=await Promise.resolve().then(()=>browser);return{default:ft}},void 0).then(({default:ft})=>ft(...lt)):_=fetch,(...lt)=>_(...lt)},resolveResponse=()=>__awaiter$6(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield __vitePreload(()=>Promise.resolve().then(()=>browser),void 0)).Response:Response}),recursiveToCamel=it=>{if(Array.isArray(it))return it.map(lt=>recursiveToCamel(lt));if(typeof it=="function"||it!==Object(it))return it;const _={};return Object.entries(it).forEach(([lt,ft])=>{const mt=lt.replace(/([-_][a-z])/gi,pt=>pt.toUpperCase().replace(/[-_]/g,""));_[mt]=recursiveToCamel(ft)}),_};var __awaiter$5=function(it,_,lt,ft){function mt(pt){return pt instanceof lt?pt:new lt(function(gt){gt(pt)})}return new(lt||(lt=Promise))(function(pt,gt){function bt(Ct){try{vt(ft.next(Ct))}catch(Rt){gt(Rt)}}function wt(Ct){try{vt(ft.throw(Ct))}catch(Rt){gt(Rt)}}function vt(Ct){Ct.done?pt(Ct.value):mt(Ct.value).then(bt,wt)}vt((ft=ft.apply(it,_||[])).next())})};const _getErrorMessage$1=it=>it.msg||it.message||it.error_description||it.error||JSON.stringify(it),handleError$1=(it,_,lt)=>__awaiter$5(void 0,void 0,void 0,function*(){const ft=yield resolveResponse();it instanceof ft&&!(lt!=null&&lt.noResolveJson)?it.json().then(mt=>{_(new StorageApiError(_getErrorMessage$1(mt),it.status||500))}).catch(mt=>{_(new StorageUnknownError(_getErrorMessage$1(mt),mt))}):_(new StorageUnknownError(_getErrorMessage$1(it),it))}),_getRequestParams$1=(it,_,lt,ft)=>{const mt={method:it,headers:(_==null?void 0:_.headers)||{}};return it==="GET"?mt:(mt.headers=Object.assign({"Content-Type":"application/json"},_==null?void 0:_.headers),ft&&(mt.body=JSON.stringify(ft)),Object.assign(Object.assign({},mt),lt))};function _handleRequest$1(it,_,lt,ft,mt,pt){return __awaiter$5(this,void 0,void 0,function*(){return new Promise((gt,bt)=>{it(lt,_getRequestParams$1(_,ft,mt,pt)).then(wt=>{if(!wt.ok)throw wt;return ft!=null&&ft.noResolveJson?wt:wt.json()}).then(wt=>gt(wt)).catch(wt=>handleError$1(wt,bt,ft))})})}function get(it,_,lt,ft){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(it,"GET",_,lt,ft)})}function post(it,_,lt,ft,mt){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(it,"POST",_,ft,mt,lt)})}function put(it,_,lt,ft,mt){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(it,"PUT",_,ft,mt,lt)})}function head(it,_,lt,ft){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(it,"HEAD",_,Object.assign(Object.assign({},lt),{noResolveJson:!0}),ft)})}function remove$1(it,_,lt,ft,mt){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(it,"DELETE",_,ft,mt,lt)})}var __awaiter$4=function(it,_,lt,ft){function mt(pt){return pt instanceof lt?pt:new lt(function(gt){gt(pt)})}return new(lt||(lt=Promise))(function(pt,gt){function bt(Ct){try{vt(ft.next(Ct))}catch(Rt){gt(Rt)}}function wt(Ct){try{vt(ft.throw(Ct))}catch(Rt){gt(Rt)}}function vt(Ct){Ct.done?pt(Ct.value):mt(Ct.value).then(bt,wt)}vt((ft=ft.apply(it,_||[])).next())})};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class StorageFileApi{constructor(_,lt={},ft,mt){this.url=_,this.headers=lt,this.bucketId=ft,this.fetch=resolveFetch$2(mt)}uploadOrUpdate(_,lt,ft,mt){return __awaiter$4(this,void 0,void 0,function*(){try{let pt;const gt=Object.assign(Object.assign({},DEFAULT_FILE_OPTIONS),mt);let bt=Object.assign(Object.assign({},this.headers),_==="POST"&&{"x-upsert":String(gt.upsert)});const wt=gt.metadata;typeof Blob<"u"&&ft instanceof Blob?(pt=new FormData,pt.append("cacheControl",gt.cacheControl),wt&&pt.append("metadata",this.encodeMetadata(wt)),pt.append("",ft)):typeof FormData<"u"&&ft instanceof FormData?(pt=ft,pt.append("cacheControl",gt.cacheControl),wt&&pt.append("metadata",this.encodeMetadata(wt))):(pt=ft,bt["cache-control"]=`max-age=${gt.cacheControl}`,bt["content-type"]=gt.contentType,wt&&(bt["x-metadata"]=this.toBase64(this.encodeMetadata(wt)))),mt!=null&&mt.headers&&(bt=Object.assign(Object.assign({},bt),mt.headers));const vt=this._removeEmptyFolders(lt),Ct=this._getFinalPath(vt),Rt=yield this.fetch(`${this.url}/object/${Ct}`,Object.assign({method:_,body:pt,headers:bt},gt!=null&&gt.duplex?{duplex:gt.duplex}:{})),Mt=yield Rt.json();return Rt.ok?{data:{path:vt,id:Mt.Id,fullPath:Mt.Key},error:null}:{data:null,error:Mt}}catch(pt){if(isStorageError(pt))return{data:null,error:pt};throw pt}})}upload(_,lt,ft){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",_,lt,ft)})}uploadToSignedUrl(_,lt,ft,mt){return __awaiter$4(this,void 0,void 0,function*(){const pt=this._removeEmptyFolders(_),gt=this._getFinalPath(pt),bt=new URL(this.url+`/object/upload/sign/${gt}`);bt.searchParams.set("token",lt);try{let wt;const vt=Object.assign({upsert:DEFAULT_FILE_OPTIONS.upsert},mt),Ct=Object.assign(Object.assign({},this.headers),{"x-upsert":String(vt.upsert)});typeof Blob<"u"&&ft instanceof Blob?(wt=new FormData,wt.append("cacheControl",vt.cacheControl),wt.append("",ft)):typeof FormData<"u"&&ft instanceof FormData?(wt=ft,wt.append("cacheControl",vt.cacheControl)):(wt=ft,Ct["cache-control"]=`max-age=${vt.cacheControl}`,Ct["content-type"]=vt.contentType);const Rt=yield this.fetch(bt.toString(),{method:"PUT",body:wt,headers:Ct}),Mt=yield Rt.json();return Rt.ok?{data:{path:pt,fullPath:Mt.Key},error:null}:{data:null,error:Mt}}catch(wt){if(isStorageError(wt))return{data:null,error:wt};throw wt}})}createSignedUploadUrl(_,lt){return __awaiter$4(this,void 0,void 0,function*(){try{let ft=this._getFinalPath(_);const mt=Object.assign({},this.headers);lt!=null&&lt.upsert&&(mt["x-upsert"]="true");const pt=yield post(this.fetch,`${this.url}/object/upload/sign/${ft}`,{},{headers:mt}),gt=new URL(this.url+pt.url),bt=gt.searchParams.get("token");if(!bt)throw new StorageError("No token returned by API");return{data:{signedUrl:gt.toString(),path:_,token:bt},error:null}}catch(ft){if(isStorageError(ft))return{data:null,error:ft};throw ft}})}update(_,lt,ft){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",_,lt,ft)})}move(_,lt,ft){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:_,destinationKey:lt,destinationBucket:ft==null?void 0:ft.destinationBucket},{headers:this.headers}),error:null}}catch(mt){if(isStorageError(mt))return{data:null,error:mt};throw mt}})}copy(_,lt,ft){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:{path:(yield post(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:_,destinationKey:lt,destinationBucket:ft==null?void 0:ft.destinationBucket},{headers:this.headers})).Key},error:null}}catch(mt){if(isStorageError(mt))return{data:null,error:mt};throw mt}})}createSignedUrl(_,lt,ft){return __awaiter$4(this,void 0,void 0,function*(){try{let mt=this._getFinalPath(_),pt=yield post(this.fetch,`${this.url}/object/sign/${mt}`,Object.assign({expiresIn:lt},ft!=null&&ft.transform?{transform:ft.transform}:{}),{headers:this.headers});const gt=ft!=null&&ft.download?`&download=${ft.download===!0?"":ft.download}`:"";return pt={signedUrl:encodeURI(`${this.url}${pt.signedURL}${gt}`)},{data:pt,error:null}}catch(mt){if(isStorageError(mt))return{data:null,error:mt};throw mt}})}createSignedUrls(_,lt,ft){return __awaiter$4(this,void 0,void 0,function*(){try{const mt=yield post(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:lt,paths:_},{headers:this.headers}),pt=ft!=null&&ft.download?`&download=${ft.download===!0?"":ft.download}`:"";return{data:mt.map(gt=>Object.assign(Object.assign({},gt),{signedUrl:gt.signedURL?encodeURI(`${this.url}${gt.signedURL}${pt}`):null})),error:null}}catch(mt){if(isStorageError(mt))return{data:null,error:mt};throw mt}})}download(_,lt){return __awaiter$4(this,void 0,void 0,function*(){const mt=typeof(lt==null?void 0:lt.transform)<"u"?"render/image/authenticated":"object",pt=this.transformOptsToQueryString((lt==null?void 0:lt.transform)||{}),gt=pt?`?${pt}`:"";try{const bt=this._getFinalPath(_);return{data:yield(yield get(this.fetch,`${this.url}/${mt}/${bt}${gt}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(bt){if(isStorageError(bt))return{data:null,error:bt};throw bt}})}info(_){return __awaiter$4(this,void 0,void 0,function*(){const lt=this._getFinalPath(_);try{const ft=yield get(this.fetch,`${this.url}/object/info/${lt}`,{headers:this.headers});return{data:recursiveToCamel(ft),error:null}}catch(ft){if(isStorageError(ft))return{data:null,error:ft};throw ft}})}exists(_){return __awaiter$4(this,void 0,void 0,function*(){const lt=this._getFinalPath(_);try{return yield head(this.fetch,`${this.url}/object/${lt}`,{headers:this.headers}),{data:!0,error:null}}catch(ft){if(isStorageError(ft)&&ft instanceof StorageUnknownError){const mt=ft.originalError;if([400,404].includes(mt==null?void 0:mt.status))return{data:!1,error:ft}}throw ft}})}getPublicUrl(_,lt){const ft=this._getFinalPath(_),mt=[],pt=lt!=null&&lt.download?`download=${lt.download===!0?"":lt.download}`:"";pt!==""&&mt.push(pt);const bt=typeof(lt==null?void 0:lt.transform)<"u"?"render/image":"object",wt=this.transformOptsToQueryString((lt==null?void 0:lt.transform)||{});wt!==""&&mt.push(wt);let vt=mt.join("&");return vt!==""&&(vt=`?${vt}`),{data:{publicUrl:encodeURI(`${this.url}/${bt}/public/${ft}${vt}`)}}}remove(_){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield remove$1(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:_},{headers:this.headers}),error:null}}catch(lt){if(isStorageError(lt))return{data:null,error:lt};throw lt}})}list(_,lt,ft){return __awaiter$4(this,void 0,void 0,function*(){try{const mt=Object.assign(Object.assign(Object.assign({},DEFAULT_SEARCH_OPTIONS),lt),{prefix:_||""});return{data:yield post(this.fetch,`${this.url}/object/list/${this.bucketId}`,mt,{headers:this.headers},ft),error:null}}catch(mt){if(isStorageError(mt))return{data:null,error:mt};throw mt}})}encodeMetadata(_){return JSON.stringify(_)}toBase64(_){return typeof Buffer<"u"?Buffer.from(_).toString("base64"):btoa(_)}_getFinalPath(_){return`${this.bucketId}/${_}`}_removeEmptyFolders(_){return _.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(_){const lt=[];return _.width&&lt.push(`width=${_.width}`),_.height&&lt.push(`height=${_.height}`),_.resize&&lt.push(`resize=${_.resize}`),_.format&&lt.push(`format=${_.format}`),_.quality&&lt.push(`quality=${_.quality}`),lt.join("&")}}const version$2="2.7.1",DEFAULT_HEADERS$2={"X-Client-Info":`storage-js/${version$2}`};var __awaiter$3=function(it,_,lt,ft){function mt(pt){return pt instanceof lt?pt:new lt(function(gt){gt(pt)})}return new(lt||(lt=Promise))(function(pt,gt){function bt(Ct){try{vt(ft.next(Ct))}catch(Rt){gt(Rt)}}function wt(Ct){try{vt(ft.throw(Ct))}catch(Rt){gt(Rt)}}function vt(Ct){Ct.done?pt(Ct.value):mt(Ct.value).then(bt,wt)}vt((ft=ft.apply(it,_||[])).next())})};class StorageBucketApi{constructor(_,lt={},ft){this.url=_,this.headers=Object.assign(Object.assign({},DEFAULT_HEADERS$2),lt),this.fetch=resolveFetch$2(ft)}listBuckets(){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(_){if(isStorageError(_))return{data:null,error:_};throw _}})}getBucket(_){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket/${_}`,{headers:this.headers}),error:null}}catch(lt){if(isStorageError(lt))return{data:null,error:lt};throw lt}})}createBucket(_,lt={public:!1}){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket`,{id:_,name:_,public:lt.public,file_size_limit:lt.fileSizeLimit,allowed_mime_types:lt.allowedMimeTypes},{headers:this.headers}),error:null}}catch(ft){if(isStorageError(ft))return{data:null,error:ft};throw ft}})}updateBucket(_,lt){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield put(this.fetch,`${this.url}/bucket/${_}`,{id:_,name:_,public:lt.public,file_size_limit:lt.fileSizeLimit,allowed_mime_types:lt.allowedMimeTypes},{headers:this.headers}),error:null}}catch(ft){if(isStorageError(ft))return{data:null,error:ft};throw ft}})}emptyBucket(_){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket/${_}/empty`,{},{headers:this.headers}),error:null}}catch(lt){if(isStorageError(lt))return{data:null,error:lt};throw lt}})}deleteBucket(_){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield remove$1(this.fetch,`${this.url}/bucket/${_}`,{},{headers:this.headers}),error:null}}catch(lt){if(isStorageError(lt))return{data:null,error:lt};throw lt}})}}class StorageClient extends StorageBucketApi{constructor(_,lt={},ft){super(_,lt,ft)}from(_){return new StorageFileApi(this.url,this.headers,_,this.fetch)}}const version$1="2.46.1";let JS_ENV="";typeof Deno<"u"?JS_ENV="deno":typeof document<"u"?JS_ENV="web":typeof navigator<"u"&&navigator.product==="ReactNative"?JS_ENV="react-native":JS_ENV="node";const DEFAULT_HEADERS$1={"X-Client-Info":`supabase-js-${JS_ENV}/${version$1}`},DEFAULT_GLOBAL_OPTIONS={headers:DEFAULT_HEADERS$1},DEFAULT_DB_OPTIONS={schema:"public"},DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},DEFAULT_REALTIME_OPTIONS={};var __awaiter$2=function(it,_,lt,ft){function mt(pt){return pt instanceof lt?pt:new lt(function(gt){gt(pt)})}return new(lt||(lt=Promise))(function(pt,gt){function bt(Ct){try{vt(ft.next(Ct))}catch(Rt){gt(Rt)}}function wt(Ct){try{vt(ft.throw(Ct))}catch(Rt){gt(Rt)}}function vt(Ct){Ct.done?pt(Ct.value):mt(Ct.value).then(bt,wt)}vt((ft=ft.apply(it,_||[])).next())})};const resolveFetch$1=it=>{let _;return it?_=it:typeof fetch>"u"?_=nodeFetch:_=fetch,(...lt)=>_(...lt)},resolveHeadersConstructor=()=>typeof Headers>"u"?Headers$1:Headers,fetchWithAuth=(it,_,lt)=>{const ft=resolveFetch$1(lt),mt=resolveHeadersConstructor();return(pt,gt)=>__awaiter$2(void 0,void 0,void 0,function*(){var bt;const wt=(bt=yield _())!==null&&bt!==void 0?bt:it;let vt=new mt(gt==null?void 0:gt.headers);return vt.has("apikey")||vt.set("apikey",it),vt.has("Authorization")||vt.set("Authorization",`Bearer ${wt}`),ft(pt,Object.assign(Object.assign({},gt),{headers:vt}))})};var __awaiter$1=function(it,_,lt,ft){function mt(pt){return pt instanceof lt?pt:new lt(function(gt){gt(pt)})}return new(lt||(lt=Promise))(function(pt,gt){function bt(Ct){try{vt(ft.next(Ct))}catch(Rt){gt(Rt)}}function wt(Ct){try{vt(ft.throw(Ct))}catch(Rt){gt(Rt)}}function vt(Ct){Ct.done?pt(Ct.value):mt(Ct.value).then(bt,wt)}vt((ft=ft.apply(it,_||[])).next())})};function stripTrailingSlash(it){return it.replace(/\/$/,"")}function applySettingDefaults(it,_){const{db:lt,auth:ft,realtime:mt,global:pt}=it,{db:gt,auth:bt,realtime:wt,global:vt}=_,Ct={db:Object.assign(Object.assign({},gt),lt),auth:Object.assign(Object.assign({},bt),ft),realtime:Object.assign(Object.assign({},wt),mt),global:Object.assign(Object.assign({},vt),pt),accessToken:()=>__awaiter$1(this,void 0,void 0,function*(){return""})};return it.accessToken?Ct.accessToken=it.accessToken:delete Ct.accessToken,Ct}const version="2.65.1",GOTRUE_URL="http://localhost:9999",STORAGE_KEY="supabase.auth.token",DEFAULT_HEADERS={"X-Client-Info":`gotrue-js/${version}`},EXPIRY_MARGIN=10,API_VERSION_HEADER_NAME="X-Supabase-Api-Version",API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function expiresAt(it){return Math.round(Date.now()/1e3)+it}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(it){const _=Math.random()*16|0;return(it=="x"?_:_&3|8).toString(16)})}const isBrowser$1=()=>typeof document<"u",localStorageWriteTests={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!isBrowser$1())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(localStorageWriteTests.tested)return localStorageWriteTests.writable;const it=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(it,it),globalThis.localStorage.removeItem(it),localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!0}catch{localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!1}return localStorageWriteTests.writable};function parseParametersFromURL(it){const _={},lt=new URL(it);if(lt.hash&&lt.hash[0]==="#")try{new URLSearchParams(lt.hash.substring(1)).forEach((mt,pt)=>{_[pt]=mt})}catch{}return lt.searchParams.forEach((ft,mt)=>{_[mt]=ft}),_}const resolveFetch=it=>{let _;return it?_=it:typeof fetch>"u"?_=(...lt)=>__vitePreload(async()=>{const{default:ft}=await Promise.resolve().then(()=>browser);return{default:ft}},void 0).then(({default:ft})=>ft(...lt)):_=fetch,(...lt)=>_(...lt)},looksLikeFetchResponse=it=>typeof it=="object"&&it!==null&&"status"in it&&"ok"in it&&"json"in it&&typeof it.json=="function",setItemAsync=async(it,_,lt)=>{await it.setItem(_,JSON.stringify(lt))},getItemAsync=async(it,_)=>{const lt=await it.getItem(_);if(!lt)return null;try{return JSON.parse(lt)}catch{return lt}},removeItemAsync=async(it,_)=>{await it.removeItem(_)};function decodeBase64URL(it){const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let lt="",ft,mt,pt,gt,bt,wt,vt,Ct=0;for(it=it.replace("-","+").replace("_","/");Ct<it.length;)gt=_.indexOf(it.charAt(Ct++)),bt=_.indexOf(it.charAt(Ct++)),wt=_.indexOf(it.charAt(Ct++)),vt=_.indexOf(it.charAt(Ct++)),ft=gt<<2|bt>>4,mt=(bt&15)<<4|wt>>2,pt=(wt&3)<<6|vt,lt=lt+String.fromCharCode(ft),wt!=64&&mt!=0&&(lt=lt+String.fromCharCode(mt)),vt!=64&&pt!=0&&(lt=lt+String.fromCharCode(pt));return lt}class Deferred{constructor(){this.promise=new Deferred.promiseConstructor((_,lt)=>{this.resolve=_,this.reject=lt})}}Deferred.promiseConstructor=Promise;function decodeJWTPayload(it){const _=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,lt=it.split(".");if(lt.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!_.test(lt[1]))throw new Error("JWT is not valid: payload is not in base64url format");const ft=lt[1];return JSON.parse(decodeBase64URL(ft))}async function sleep(it){return await new Promise(_=>{setTimeout(()=>_(null),it)})}function retryable(it,_){return new Promise((ft,mt)=>{(async()=>{for(let pt=0;pt<1/0;pt++)try{const gt=await it(pt);if(!_(pt,null,gt)){ft(gt);return}}catch(gt){if(!_(pt,gt)){mt(gt);return}}})()})}function dec2hex(it){return("0"+it.toString(16)).substr(-2)}function generatePKCEVerifier(){const _=new Uint32Array(56);if(typeof crypto>"u"){const lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",ft=lt.length;let mt="";for(let pt=0;pt<56;pt++)mt+=lt.charAt(Math.floor(Math.random()*ft));return mt}return crypto.getRandomValues(_),Array.from(_,dec2hex).join("")}async function sha256(it){const lt=new TextEncoder().encode(it),ft=await crypto.subtle.digest("SHA-256",lt),mt=new Uint8Array(ft);return Array.from(mt).map(pt=>String.fromCharCode(pt)).join("")}function base64urlencode(it){return btoa(it).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function generatePKCEChallenge(it){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),it;const lt=await sha256(it);return base64urlencode(lt)}async function getCodeChallengeAndMethod(it,_,lt=!1){const ft=generatePKCEVerifier();let mt=ft;lt&&(mt+="/PASSWORD_RECOVERY"),await setItemAsync(it,`${_}-code-verifier`,mt);const pt=await generatePKCEChallenge(ft);return[pt,ft===pt?"plain":"s256"]}const API_VERSION_REGEX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function parseResponseAPIVersion(it){const _=it.headers.get(API_VERSION_HEADER_NAME);if(!_||!_.match(API_VERSION_REGEX))return null;try{return new Date(`${_}T00:00:00.0Z`)}catch{return null}}class AuthError extends Error{constructor(_,lt,ft){super(_),this.__isAuthError=!0,this.name="AuthError",this.status=lt,this.code=ft}}function isAuthError(it){return typeof it=="object"&&it!==null&&"__isAuthError"in it}class AuthApiError extends AuthError{constructor(_,lt,ft){super(_,lt,ft),this.name="AuthApiError",this.status=lt,this.code=ft}}function isAuthApiError(it){return isAuthError(it)&&it.name==="AuthApiError"}class AuthUnknownError extends AuthError{constructor(_,lt){super(_),this.name="AuthUnknownError",this.originalError=lt}}class CustomAuthError extends AuthError{constructor(_,lt,ft,mt){super(_,ft,mt),this.name=lt,this.status=ft}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function isAuthSessionMissingError(it){return isAuthError(it)&&it.name==="AuthSessionMissingError"}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(_){super(_,"AuthInvalidCredentialsError",400,void 0)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(_,lt=null){super(_,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=lt}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(_,lt=null){super(_,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=lt}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthRetryableFetchError extends CustomAuthError{constructor(_,lt){super(_,"AuthRetryableFetchError",lt,void 0)}}function isAuthRetryableFetchError(it){return isAuthError(it)&&it.name==="AuthRetryableFetchError"}class AuthWeakPasswordError extends CustomAuthError{constructor(_,lt,ft){super(_,"AuthWeakPasswordError",lt,"weak_password"),this.reasons=ft}}var __rest$1=function(it,_){var lt={};for(var ft in it)Object.prototype.hasOwnProperty.call(it,ft)&&_.indexOf(ft)<0&&(lt[ft]=it[ft]);if(it!=null&&typeof Object.getOwnPropertySymbols=="function")for(var mt=0,ft=Object.getOwnPropertySymbols(it);mt<ft.length;mt++)_.indexOf(ft[mt])<0&&Object.prototype.propertyIsEnumerable.call(it,ft[mt])&&(lt[ft[mt]]=it[ft[mt]]);return lt};const _getErrorMessage=it=>it.msg||it.message||it.error_description||it.error||JSON.stringify(it),NETWORK_ERROR_CODES=[502,503,504];async function handleError(it){var _;if(!looksLikeFetchResponse(it))throw new AuthRetryableFetchError(_getErrorMessage(it),0);if(NETWORK_ERROR_CODES.includes(it.status))throw new AuthRetryableFetchError(_getErrorMessage(it),it.status);let lt;try{lt=await it.json()}catch(pt){throw new AuthUnknownError(_getErrorMessage(pt),pt)}let ft;const mt=parseResponseAPIVersion(it);if(mt&&mt.getTime()>=API_VERSIONS["2024-01-01"].timestamp&&typeof lt=="object"&&lt&&typeof lt.code=="string"?ft=lt.code:typeof lt=="object"&&lt&&typeof lt.error_code=="string"&&(ft=lt.error_code),ft){if(ft==="weak_password")throw new AuthWeakPasswordError(_getErrorMessage(lt),it.status,((_=lt.weak_password)===null||_===void 0?void 0:_.reasons)||[]);if(ft==="session_not_found")throw new AuthSessionMissingError}else if(typeof lt=="object"&&lt&&typeof lt.weak_password=="object"&&lt.weak_password&&Array.isArray(lt.weak_password.reasons)&&lt.weak_password.reasons.length&&lt.weak_password.reasons.reduce((pt,gt)=>pt&&typeof gt=="string",!0))throw new AuthWeakPasswordError(_getErrorMessage(lt),it.status,lt.weak_password.reasons);throw new AuthApiError(_getErrorMessage(lt),it.status||500,ft)}const _getRequestParams=(it,_,lt,ft)=>{const mt={method:it,headers:(_==null?void 0:_.headers)||{}};return it==="GET"?mt:(mt.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},_==null?void 0:_.headers),mt.body=JSON.stringify(ft),Object.assign(Object.assign({},mt),lt))};async function _request(it,_,lt,ft){var mt;const pt=Object.assign({},ft==null?void 0:ft.headers);pt[API_VERSION_HEADER_NAME]||(pt[API_VERSION_HEADER_NAME]=API_VERSIONS["2024-01-01"].name),ft!=null&&ft.jwt&&(pt.Authorization=`Bearer ${ft.jwt}`);const gt=(mt=ft==null?void 0:ft.query)!==null&&mt!==void 0?mt:{};ft!=null&&ft.redirectTo&&(gt.redirect_to=ft.redirectTo);const bt=Object.keys(gt).length?"?"+new URLSearchParams(gt).toString():"",wt=await _handleRequest(it,_,lt+bt,{headers:pt,noResolveJson:ft==null?void 0:ft.noResolveJson},{},ft==null?void 0:ft.body);return ft!=null&&ft.xform?ft==null?void 0:ft.xform(wt):{data:Object.assign({},wt),error:null}}async function _handleRequest(it,_,lt,ft,mt,pt){const gt=_getRequestParams(_,ft,mt,pt);let bt;try{bt=await it(lt,Object.assign({},gt))}catch(wt){throw console.error(wt),new AuthRetryableFetchError(_getErrorMessage(wt),0)}if(bt.ok||await handleError(bt),ft!=null&&ft.noResolveJson)return bt;try{return await bt.json()}catch(wt){await handleError(wt)}}function _sessionResponse(it){var _;let lt=null;hasSession(it)&&(lt=Object.assign({},it),it.expires_at||(lt.expires_at=expiresAt(it.expires_in)));const ft=(_=it.user)!==null&&_!==void 0?_:it;return{data:{session:lt,user:ft},error:null}}function _sessionResponsePassword(it){const _=_sessionResponse(it);return!_.error&&it.weak_password&&typeof it.weak_password=="object"&&Array.isArray(it.weak_password.reasons)&&it.weak_password.reasons.length&&it.weak_password.message&&typeof it.weak_password.message=="string"&&it.weak_password.reasons.reduce((lt,ft)=>lt&&typeof ft=="string",!0)&&(_.data.weak_password=it.weak_password),_}function _userResponse(it){var _;return{data:{user:(_=it.user)!==null&&_!==void 0?_:it},error:null}}function _ssoResponse(it){return{data:it,error:null}}function _generateLinkResponse(it){const{action_link:_,email_otp:lt,hashed_token:ft,redirect_to:mt,verification_type:pt}=it,gt=__rest$1(it,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),bt={action_link:_,email_otp:lt,hashed_token:ft,redirect_to:mt,verification_type:pt},wt=Object.assign({},gt);return{data:{properties:bt,user:wt},error:null}}function _noResolveJsonResponse(it){return it}function hasSession(it){return it.access_token&&it.refresh_token&&it.expires_in}var __rest=function(it,_){var lt={};for(var ft in it)Object.prototype.hasOwnProperty.call(it,ft)&&_.indexOf(ft)<0&&(lt[ft]=it[ft]);if(it!=null&&typeof Object.getOwnPropertySymbols=="function")for(var mt=0,ft=Object.getOwnPropertySymbols(it);mt<ft.length;mt++)_.indexOf(ft[mt])<0&&Object.prototype.propertyIsEnumerable.call(it,ft[mt])&&(lt[ft[mt]]=it[ft[mt]]);return lt};class GoTrueAdminApi{constructor({url:_="",headers:lt={},fetch:ft}){this.url=_,this.headers=lt,this.fetch=resolveFetch(ft),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(_,lt="global"){try{return await _request(this.fetch,"POST",`${this.url}/logout?scope=${lt}`,{headers:this.headers,jwt:_,noResolveJson:!0}),{data:null,error:null}}catch(ft){if(isAuthError(ft))return{data:null,error:ft};throw ft}}async inviteUserByEmail(_,lt={}){try{return await _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:_,data:lt.data},headers:this.headers,redirectTo:lt.redirectTo,xform:_userResponse})}catch(ft){if(isAuthError(ft))return{data:{user:null},error:ft};throw ft}}async generateLink(_){try{const{options:lt}=_,ft=__rest(_,["options"]),mt=Object.assign(Object.assign({},ft),lt);return"newEmail"in ft&&(mt.new_email=ft==null?void 0:ft.newEmail,delete mt.newEmail),await _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:mt,headers:this.headers,xform:_generateLinkResponse,redirectTo:lt==null?void 0:lt.redirectTo})}catch(lt){if(isAuthError(lt))return{data:{properties:null,user:null},error:lt};throw lt}}async createUser(_){try{return await _request(this.fetch,"POST",`${this.url}/admin/users`,{body:_,headers:this.headers,xform:_userResponse})}catch(lt){if(isAuthError(lt))return{data:{user:null},error:lt};throw lt}}async listUsers(_){var lt,ft,mt,pt,gt,bt,wt;try{const vt={nextPage:null,lastPage:0,total:0},Ct=await _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(ft=(lt=_==null?void 0:_.page)===null||lt===void 0?void 0:lt.toString())!==null&&ft!==void 0?ft:"",per_page:(pt=(mt=_==null?void 0:_.perPage)===null||mt===void 0?void 0:mt.toString())!==null&&pt!==void 0?pt:""},xform:_noResolveJsonResponse});if(Ct.error)throw Ct.error;const Rt=await Ct.json(),Mt=(gt=Ct.headers.get("x-total-count"))!==null&&gt!==void 0?gt:0,Ot=(wt=(bt=Ct.headers.get("link"))===null||bt===void 0?void 0:bt.split(","))!==null&&wt!==void 0?wt:[];return Ot.length>0&&(Ot.forEach(Nt=>{const Ht=parseInt(Nt.split(";")[0].split("=")[1].substring(0,1)),Kt=JSON.parse(Nt.split(";")[1].split("=")[1]);vt[`${Kt}Page`]=Ht}),vt.total=parseInt(Mt)),{data:Object.assign(Object.assign({},Rt),vt),error:null}}catch(vt){if(isAuthError(vt))return{data:{users:[]},error:vt};throw vt}}async getUserById(_){try{return await _request(this.fetch,"GET",`${this.url}/admin/users/${_}`,{headers:this.headers,xform:_userResponse})}catch(lt){if(isAuthError(lt))return{data:{user:null},error:lt};throw lt}}async updateUserById(_,lt){try{return await _request(this.fetch,"PUT",`${this.url}/admin/users/${_}`,{body:lt,headers:this.headers,xform:_userResponse})}catch(ft){if(isAuthError(ft))return{data:{user:null},error:ft};throw ft}}async deleteUser(_,lt=!1){try{return await _request(this.fetch,"DELETE",`${this.url}/admin/users/${_}`,{headers:this.headers,body:{should_soft_delete:lt},xform:_userResponse})}catch(ft){if(isAuthError(ft))return{data:{user:null},error:ft};throw ft}}async _listFactors(_){try{const{data:lt,error:ft}=await _request(this.fetch,"GET",`${this.url}/admin/users/${_.userId}/factors`,{headers:this.headers,xform:mt=>({data:{factors:mt},error:null})});return{data:lt,error:ft}}catch(lt){if(isAuthError(lt))return{data:null,error:lt};throw lt}}async _deleteFactor(_){try{return{data:await _request(this.fetch,"DELETE",`${this.url}/admin/users/${_.userId}/factors/${_.id}`,{headers:this.headers}),error:null}}catch(lt){if(isAuthError(lt))return{data:null,error:lt};throw lt}}}const localStorageAdapter={getItem:it=>supportsLocalStorage()?globalThis.localStorage.getItem(it):null,setItem:(it,_)=>{supportsLocalStorage()&&globalThis.localStorage.setItem(it,_)},removeItem:it=>{supportsLocalStorage()&&globalThis.localStorage.removeItem(it)}};function memoryLocalStorageAdapter(it={}){return{getItem:_=>it[_]||null,setItem:(_,lt)=>{it[_]=lt},removeItem:_=>{delete it[_]}}}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const internals={debug:!!(globalThis&&supportsLocalStorage()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LockAcquireTimeoutError extends Error{constructor(_){super(_),this.isAcquireTimeout=!0}}class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError{}async function navigatorLock(it,_,lt){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",it,_);const ft=new globalThis.AbortController;return _>0&&setTimeout(()=>{ft.abort(),internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",it)},_),await globalThis.navigator.locks.request(it,_===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:ft.signal},async mt=>{if(mt){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",it,mt.name);try{return await lt()}finally{internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",it,mt.name)}}else{if(_===0)throw internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",it),new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock "${it}" immediately failed`);if(internals.debug)try{const pt=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(pt,null,"  "))}catch(pt){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",pt)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await lt()}})}polyfillGlobalThis();const DEFAULT_OPTIONS={url:GOTRUE_URL,storageKey:STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:DEFAULT_HEADERS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},AUTO_REFRESH_TICK_DURATION=30*1e3,AUTO_REFRESH_TICK_THRESHOLD=3;async function lockNoOp(it,_,lt){return await lt()}class GoTrueClient{constructor(_){var lt,ft;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=GoTrueClient.nextInstanceID,GoTrueClient.nextInstanceID+=1,this.instanceID>0&&isBrowser$1()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const mt=Object.assign(Object.assign({},DEFAULT_OPTIONS),_);if(this.logDebugMessages=!!mt.debug,typeof mt.debug=="function"&&(this.logger=mt.debug),this.persistSession=mt.persistSession,this.storageKey=mt.storageKey,this.autoRefreshToken=mt.autoRefreshToken,this.admin=new GoTrueAdminApi({url:mt.url,headers:mt.headers,fetch:mt.fetch}),this.url=mt.url,this.headers=mt.headers,this.fetch=resolveFetch(mt.fetch),this.lock=mt.lock||lockNoOp,this.detectSessionInUrl=mt.detectSessionInUrl,this.flowType=mt.flowType,this.hasCustomAuthorizationHeader=mt.hasCustomAuthorizationHeader,mt.lock?this.lock=mt.lock:isBrowser$1()&&(!((lt=globalThis==null?void 0:globalThis.navigator)===null||lt===void 0)&&lt.locks)?this.lock=navigatorLock:this.lock=lockNoOp,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?mt.storage?this.storage=mt.storage:supportsLocalStorage()?this.storage=localStorageAdapter:(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)):(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),isBrowser$1()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(pt){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",pt)}(ft=this.broadcastChannel)===null||ft===void 0||ft.addEventListener("message",async pt=>{this._debug("received broadcast notification from other tab or client",pt),await this._notifyAllSubscribers(pt.data.event,pt.data.session,!1)})}this.initialize()}_debug(..._){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${version}) ${new Date().toISOString()}`,..._),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const _=isBrowser$1()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",_),_||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:lt,error:ft}=await this._getSessionFromURL(_);if(ft)return this._debug("#_initialize()","error detecting session from URL",ft),(ft==null?void 0:ft.code)==="identity_already_exists"?{error:ft}:(await this._removeSession(),{error:ft});const{session:mt,redirectType:pt}=lt;return this._debug("#_initialize()","detected session in URL",mt,"redirect type",pt),await this._saveSession(mt),setTimeout(async()=>{pt==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",mt):await this._notifyAllSubscribers("SIGNED_IN",mt)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(_){return isAuthError(_)?{error:_}:{error:new AuthUnknownError("Unexpected error during initialization",_)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(_){var lt,ft,mt;try{const pt=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(ft=(lt=_==null?void 0:_.options)===null||lt===void 0?void 0:lt.data)!==null&&ft!==void 0?ft:{},gotrue_meta_security:{captcha_token:(mt=_==null?void 0:_.options)===null||mt===void 0?void 0:mt.captchaToken}},xform:_sessionResponse}),{data:gt,error:bt}=pt;if(bt||!gt)return{data:{user:null,session:null},error:bt};const wt=gt.session,vt=gt.user;return gt.session&&(await this._saveSession(gt.session),await this._notifyAllSubscribers("SIGNED_IN",wt)),{data:{user:vt,session:wt},error:null}}catch(pt){if(isAuthError(pt))return{data:{user:null,session:null},error:pt};throw pt}}async signUp(_){var lt,ft,mt;try{let pt;if("email"in _){const{email:Ct,password:Rt,options:Mt}=_;let Ot=null,Nt=null;this.flowType==="pkce"&&([Ot,Nt]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),pt=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:Mt==null?void 0:Mt.emailRedirectTo,body:{email:Ct,password:Rt,data:(lt=Mt==null?void 0:Mt.data)!==null&&lt!==void 0?lt:{},gotrue_meta_security:{captcha_token:Mt==null?void 0:Mt.captchaToken},code_challenge:Ot,code_challenge_method:Nt},xform:_sessionResponse})}else if("phone"in _){const{phone:Ct,password:Rt,options:Mt}=_;pt=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:Ct,password:Rt,data:(ft=Mt==null?void 0:Mt.data)!==null&&ft!==void 0?ft:{},channel:(mt=Mt==null?void 0:Mt.channel)!==null&&mt!==void 0?mt:"sms",gotrue_meta_security:{captcha_token:Mt==null?void 0:Mt.captchaToken}},xform:_sessionResponse})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:gt,error:bt}=pt;if(bt||!gt)return{data:{user:null,session:null},error:bt};const wt=gt.session,vt=gt.user;return gt.session&&(await this._saveSession(gt.session),await this._notifyAllSubscribers("SIGNED_IN",wt)),{data:{user:vt,session:wt},error:null}}catch(pt){if(isAuthError(pt))return{data:{user:null,session:null},error:pt};throw pt}}async signInWithPassword(_){try{let lt;if("email"in _){const{email:pt,password:gt,options:bt}=_;lt=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:pt,password:gt,gotrue_meta_security:{captcha_token:bt==null?void 0:bt.captchaToken}},xform:_sessionResponsePassword})}else if("phone"in _){const{phone:pt,password:gt,options:bt}=_;lt=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:pt,password:gt,gotrue_meta_security:{captcha_token:bt==null?void 0:bt.captchaToken}},xform:_sessionResponsePassword})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:ft,error:mt}=lt;return mt?{data:{user:null,session:null},error:mt}:!ft||!ft.session||!ft.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(ft.session&&(await this._saveSession(ft.session),await this._notifyAllSubscribers("SIGNED_IN",ft.session)),{data:Object.assign({user:ft.user,session:ft.session},ft.weak_password?{weakPassword:ft.weak_password}:null),error:mt})}catch(lt){if(isAuthError(lt))return{data:{user:null,session:null},error:lt};throw lt}}async signInWithOAuth(_){var lt,ft,mt,pt;return await this._handleProviderSignIn(_.provider,{redirectTo:(lt=_.options)===null||lt===void 0?void 0:lt.redirectTo,scopes:(ft=_.options)===null||ft===void 0?void 0:ft.scopes,queryParams:(mt=_.options)===null||mt===void 0?void 0:mt.queryParams,skipBrowserRedirect:(pt=_.options)===null||pt===void 0?void 0:pt.skipBrowserRedirect})}async exchangeCodeForSession(_){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(_))}async _exchangeCodeForSession(_){const lt=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`),[ft,mt]=(lt??"").split("/");try{const{data:pt,error:gt}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:_,code_verifier:ft},xform:_sessionResponse});if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),gt)throw gt;return!pt||!pt.session||!pt.user?{data:{user:null,session:null,redirectType:null},error:new AuthInvalidTokenResponseError}:(pt.session&&(await this._saveSession(pt.session),await this._notifyAllSubscribers("SIGNED_IN",pt.session)),{data:Object.assign(Object.assign({},pt),{redirectType:mt??null}),error:gt})}catch(pt){if(isAuthError(pt))return{data:{user:null,session:null,redirectType:null},error:pt};throw pt}}async signInWithIdToken(_){try{const{options:lt,provider:ft,token:mt,access_token:pt,nonce:gt}=_,bt=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:ft,id_token:mt,access_token:pt,nonce:gt,gotrue_meta_security:{captcha_token:lt==null?void 0:lt.captchaToken}},xform:_sessionResponse}),{data:wt,error:vt}=bt;return vt?{data:{user:null,session:null},error:vt}:!wt||!wt.session||!wt.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(wt.session&&(await this._saveSession(wt.session),await this._notifyAllSubscribers("SIGNED_IN",wt.session)),{data:wt,error:vt})}catch(lt){if(isAuthError(lt))return{data:{user:null,session:null},error:lt};throw lt}}async signInWithOtp(_){var lt,ft,mt,pt,gt;try{if("email"in _){const{email:bt,options:wt}=_;let vt=null,Ct=null;this.flowType==="pkce"&&([vt,Ct]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{error:Rt}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:bt,data:(lt=wt==null?void 0:wt.data)!==null&&lt!==void 0?lt:{},create_user:(ft=wt==null?void 0:wt.shouldCreateUser)!==null&&ft!==void 0?ft:!0,gotrue_meta_security:{captcha_token:wt==null?void 0:wt.captchaToken},code_challenge:vt,code_challenge_method:Ct},redirectTo:wt==null?void 0:wt.emailRedirectTo});return{data:{user:null,session:null},error:Rt}}if("phone"in _){const{phone:bt,options:wt}=_,{data:vt,error:Ct}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:bt,data:(mt=wt==null?void 0:wt.data)!==null&&mt!==void 0?mt:{},create_user:(pt=wt==null?void 0:wt.shouldCreateUser)!==null&&pt!==void 0?pt:!0,gotrue_meta_security:{captcha_token:wt==null?void 0:wt.captchaToken},channel:(gt=wt==null?void 0:wt.channel)!==null&&gt!==void 0?gt:"sms"}});return{data:{user:null,session:null,messageId:vt==null?void 0:vt.message_id},error:Ct}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(bt){if(isAuthError(bt))return{data:{user:null,session:null},error:bt};throw bt}}async verifyOtp(_){var lt,ft;try{let mt,pt;"options"in _&&(mt=(lt=_.options)===null||lt===void 0?void 0:lt.redirectTo,pt=(ft=_.options)===null||ft===void 0?void 0:ft.captchaToken);const{data:gt,error:bt}=await _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},_),{gotrue_meta_security:{captcha_token:pt}}),redirectTo:mt,xform:_sessionResponse});if(bt)throw bt;if(!gt)throw new Error("An error occurred on token verification.");const wt=gt.session,vt=gt.user;return wt!=null&&wt.access_token&&(await this._saveSession(wt),await this._notifyAllSubscribers(_.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",wt)),{data:{user:vt,session:wt},error:null}}catch(mt){if(isAuthError(mt))return{data:{user:null,session:null},error:mt};throw mt}}async signInWithSSO(_){var lt,ft,mt;try{let pt=null,gt=null;return this.flowType==="pkce"&&([pt,gt]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),await _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in _?{provider_id:_.providerId}:null),"domain"in _?{domain:_.domain}:null),{redirect_to:(ft=(lt=_.options)===null||lt===void 0?void 0:lt.redirectTo)!==null&&ft!==void 0?ft:void 0}),!((mt=_==null?void 0:_.options)===null||mt===void 0)&&mt.captchaToken?{gotrue_meta_security:{captcha_token:_.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:pt,code_challenge_method:gt}),headers:this.headers,xform:_ssoResponse})}catch(pt){if(isAuthError(pt))return{data:null,error:pt};throw pt}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async _=>{const{data:{session:lt},error:ft}=_;if(ft)throw ft;if(!lt)throw new AuthSessionMissingError;const{error:mt}=await _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:lt.access_token});return{data:{user:null,session:null},error:mt}})}catch(_){if(isAuthError(_))return{data:{user:null,session:null},error:_};throw _}}async resend(_){try{const lt=`${this.url}/resend`;if("email"in _){const{email:ft,type:mt,options:pt}=_,{error:gt}=await _request(this.fetch,"POST",lt,{headers:this.headers,body:{email:ft,type:mt,gotrue_meta_security:{captcha_token:pt==null?void 0:pt.captchaToken}},redirectTo:pt==null?void 0:pt.emailRedirectTo});return{data:{user:null,session:null},error:gt}}else if("phone"in _){const{phone:ft,type:mt,options:pt}=_,{data:gt,error:bt}=await _request(this.fetch,"POST",lt,{headers:this.headers,body:{phone:ft,type:mt,gotrue_meta_security:{captcha_token:pt==null?void 0:pt.captchaToken}}});return{data:{user:null,session:null,messageId:gt==null?void 0:gt.message_id},error:bt}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(lt){if(isAuthError(lt))return{data:{user:null,session:null},error:lt};throw lt}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async lt=>lt))}async _acquireLock(_,lt){this._debug("#_acquireLock","begin",_);try{if(this.lockAcquired){const ft=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),mt=(async()=>(await ft,await lt()))();return this.pendingInLock.push((async()=>{try{await mt}catch{}})()),mt}return await this.lock(`lock:${this.storageKey}`,_,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const ft=lt();for(this.pendingInLock.push((async()=>{try{await ft}catch{}})()),await ft;this.pendingInLock.length;){const mt=[...this.pendingInLock];await Promise.all(mt),this.pendingInLock.splice(0,mt.length)}return await ft}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(_){this._debug("#_useSession","begin");try{const lt=await this.__loadSession();return await _(lt)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let _=null;const lt=await getItemAsync(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",lt),lt!==null&&(this._isValidSession(lt)?_=lt:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!_)return{data:{session:null},error:null};const ft=_.expires_at?_.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${ft?"":" not"} expired`,"expires_at",_.expires_at),!ft){if(this.storage.isServer){let gt=this.suppressGetSessionWarning;_=new Proxy(_,{get:(wt,vt,Ct)=>(!gt&&vt==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),gt=!0,this.suppressGetSessionWarning=!0),Reflect.get(wt,vt,Ct))})}return{data:{session:_},error:null}}const{session:mt,error:pt}=await this._callRefreshToken(_.refresh_token);return pt?{data:{session:null},error:pt}:{data:{session:mt},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(_){return _?await this._getUser(_):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(_){try{return _?await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:_,xform:_userResponse}):await this._useSession(async lt=>{var ft,mt,pt;const{data:gt,error:bt}=lt;if(bt)throw bt;return!(!((ft=gt.session)===null||ft===void 0)&&ft.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new AuthSessionMissingError}:await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(pt=(mt=gt.session)===null||mt===void 0?void 0:mt.access_token)!==null&&pt!==void 0?pt:void 0,xform:_userResponse})})}catch(lt){if(isAuthError(lt))return isAuthSessionMissingError(lt)&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:lt};throw lt}}async updateUser(_,lt={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(_,lt))}async _updateUser(_,lt={}){try{return await this._useSession(async ft=>{const{data:mt,error:pt}=ft;if(pt)throw pt;if(!mt.session)throw new AuthSessionMissingError;const gt=mt.session;let bt=null,wt=null;this.flowType==="pkce"&&_.email!=null&&([bt,wt]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{data:vt,error:Ct}=await _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:lt==null?void 0:lt.emailRedirectTo,body:Object.assign(Object.assign({},_),{code_challenge:bt,code_challenge_method:wt}),jwt:gt.access_token,xform:_userResponse});if(Ct)throw Ct;return gt.user=vt.user,await this._saveSession(gt),await this._notifyAllSubscribers("USER_UPDATED",gt),{data:{user:gt.user},error:null}})}catch(ft){if(isAuthError(ft))return{data:{user:null},error:ft};throw ft}}_decodeJWT(_){return decodeJWTPayload(_)}async setSession(_){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(_))}async _setSession(_){try{if(!_.access_token||!_.refresh_token)throw new AuthSessionMissingError;const lt=Date.now()/1e3;let ft=lt,mt=!0,pt=null;const gt=decodeJWTPayload(_.access_token);if(gt.exp&&(ft=gt.exp,mt=ft<=lt),mt){const{session:bt,error:wt}=await this._callRefreshToken(_.refresh_token);if(wt)return{data:{user:null,session:null},error:wt};if(!bt)return{data:{user:null,session:null},error:null};pt=bt}else{const{data:bt,error:wt}=await this._getUser(_.access_token);if(wt)throw wt;pt={access_token:_.access_token,refresh_token:_.refresh_token,user:bt.user,token_type:"bearer",expires_in:ft-lt,expires_at:ft},await this._saveSession(pt),await this._notifyAllSubscribers("SIGNED_IN",pt)}return{data:{user:pt.user,session:pt},error:null}}catch(lt){if(isAuthError(lt))return{data:{session:null,user:null},error:lt};throw lt}}async refreshSession(_){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(_))}async _refreshSession(_){try{return await this._useSession(async lt=>{var ft;if(!_){const{data:gt,error:bt}=lt;if(bt)throw bt;_=(ft=gt.session)!==null&&ft!==void 0?ft:void 0}if(!(_!=null&&_.refresh_token))throw new AuthSessionMissingError;const{session:mt,error:pt}=await this._callRefreshToken(_.refresh_token);return pt?{data:{user:null,session:null},error:pt}:mt?{data:{user:mt.user,session:mt},error:null}:{data:{user:null,session:null},error:null}})}catch(lt){if(isAuthError(lt))return{data:{user:null,session:null},error:lt};throw lt}}async _getSessionFromURL(_){try{if(!isBrowser$1())throw new AuthImplicitGrantRedirectError("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!_)throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");const lt=parseParametersFromURL(window.location.href);if(_){if(!lt.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:Qt,error:mr}=await this._exchangeCodeForSession(lt.code);if(mr)throw mr;const br=new URL(window.location.href);return br.searchParams.delete("code"),window.history.replaceState(window.history.state,"",br.toString()),{data:{session:Qt.session,redirectType:null},error:null}}if(lt.error||lt.error_description||lt.error_code)throw new AuthImplicitGrantRedirectError(lt.error_description||"Error in URL with unspecified error_description",{error:lt.error||"unspecified_error",code:lt.error_code||"unspecified_code"});const{provider_token:ft,provider_refresh_token:mt,access_token:pt,refresh_token:gt,expires_in:bt,expires_at:wt,token_type:vt}=lt;if(!pt||!bt||!gt||!vt)throw new AuthImplicitGrantRedirectError("No session defined in URL");const Ct=Math.round(Date.now()/1e3),Rt=parseInt(bt);let Mt=Ct+Rt;wt&&(Mt=parseInt(wt));const Ot=Mt-Ct;Ot*1e3<=AUTO_REFRESH_TICK_DURATION&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${Ot}s, should have been closer to ${Rt}s`);const Nt=Mt-Rt;Ct-Nt>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Nt,Mt,Ct):Ct-Nt<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",Nt,Mt,Ct);const{data:Ht,error:Kt}=await this._getUser(pt);if(Kt)throw Kt;const hr={provider_token:ft,provider_refresh_token:mt,access_token:pt,expires_in:Rt,expires_at:Mt,refresh_token:gt,token_type:vt,user:Ht.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:hr,redirectType:lt.type},error:null}}catch(lt){if(isAuthError(lt))return{data:{session:null,redirectType:null},error:lt};throw lt}}_isImplicitGrantFlow(){const _=parseParametersFromURL(window.location.href);return!!(isBrowser$1()&&(_.access_token||_.error_description))}async _isPKCEFlow(){const _=parseParametersFromURL(window.location.href),lt=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!!(_.code&&lt)}async signOut(_={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(_))}async _signOut({scope:_}={scope:"global"}){return await this._useSession(async lt=>{var ft;const{data:mt,error:pt}=lt;if(pt)return{error:pt};const gt=(ft=mt.session)===null||ft===void 0?void 0:ft.access_token;if(gt){const{error:bt}=await this.admin.signOut(gt,_);if(bt&&!(isAuthApiError(bt)&&(bt.status===404||bt.status===401||bt.status===403)))return{error:bt}}return _!=="others"&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(_){const lt=uuid(),ft={id:lt,callback:_,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",lt),this.stateChangeEmitters.delete(lt)}};return this._debug("#onAuthStateChange()","registered callback with id",lt),this.stateChangeEmitters.set(lt,ft),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(lt)})))(),{data:{subscription:ft}}}async _emitInitialSession(_){return await this._useSession(async lt=>{var ft,mt;try{const{data:{session:pt},error:gt}=lt;if(gt)throw gt;await((ft=this.stateChangeEmitters.get(_))===null||ft===void 0?void 0:ft.callback("INITIAL_SESSION",pt)),this._debug("INITIAL_SESSION","callback id",_,"session",pt)}catch(pt){await((mt=this.stateChangeEmitters.get(_))===null||mt===void 0?void 0:mt.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",_,"error",pt),console.error(pt)}})}async resetPasswordForEmail(_,lt={}){let ft=null,mt=null;this.flowType==="pkce"&&([ft,mt]=await getCodeChallengeAndMethod(this.storage,this.storageKey,!0));try{return await _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:_,code_challenge:ft,code_challenge_method:mt,gotrue_meta_security:{captcha_token:lt.captchaToken}},headers:this.headers,redirectTo:lt.redirectTo})}catch(pt){if(isAuthError(pt))return{data:null,error:pt};throw pt}}async getUserIdentities(){var _;try{const{data:lt,error:ft}=await this.getUser();if(ft)throw ft;return{data:{identities:(_=lt.user.identities)!==null&&_!==void 0?_:[]},error:null}}catch(lt){if(isAuthError(lt))return{data:null,error:lt};throw lt}}async linkIdentity(_){var lt;try{const{data:ft,error:mt}=await this._useSession(async pt=>{var gt,bt,wt,vt,Ct;const{data:Rt,error:Mt}=pt;if(Mt)throw Mt;const Ot=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,_.provider,{redirectTo:(gt=_.options)===null||gt===void 0?void 0:gt.redirectTo,scopes:(bt=_.options)===null||bt===void 0?void 0:bt.scopes,queryParams:(wt=_.options)===null||wt===void 0?void 0:wt.queryParams,skipBrowserRedirect:!0});return await _request(this.fetch,"GET",Ot,{headers:this.headers,jwt:(Ct=(vt=Rt.session)===null||vt===void 0?void 0:vt.access_token)!==null&&Ct!==void 0?Ct:void 0})});if(mt)throw mt;return isBrowser$1()&&!(!((lt=_.options)===null||lt===void 0)&&lt.skipBrowserRedirect)&&window.location.assign(ft==null?void 0:ft.url),{data:{provider:_.provider,url:ft==null?void 0:ft.url},error:null}}catch(ft){if(isAuthError(ft))return{data:{provider:_.provider,url:null},error:ft};throw ft}}async unlinkIdentity(_){try{return await this._useSession(async lt=>{var ft,mt;const{data:pt,error:gt}=lt;if(gt)throw gt;return await _request(this.fetch,"DELETE",`${this.url}/user/identities/${_.identity_id}`,{headers:this.headers,jwt:(mt=(ft=pt.session)===null||ft===void 0?void 0:ft.access_token)!==null&&mt!==void 0?mt:void 0})})}catch(lt){if(isAuthError(lt))return{data:null,error:lt};throw lt}}async _refreshAccessToken(_){const lt=`#_refreshAccessToken(${_.substring(0,5)}...)`;this._debug(lt,"begin");try{const ft=Date.now();return await retryable(async mt=>(mt>0&&await sleep(200*Math.pow(2,mt-1)),this._debug(lt,"refreshing attempt",mt),await _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:_},headers:this.headers,xform:_sessionResponse})),(mt,pt)=>{const gt=200*Math.pow(2,mt);return pt&&isAuthRetryableFetchError(pt)&&Date.now()+gt-ft<AUTO_REFRESH_TICK_DURATION})}catch(ft){if(this._debug(lt,"error",ft),isAuthError(ft))return{data:{session:null,user:null},error:ft};throw ft}finally{this._debug(lt,"end")}}_isValidSession(_){return typeof _=="object"&&_!==null&&"access_token"in _&&"refresh_token"in _&&"expires_at"in _}async _handleProviderSignIn(_,lt){const ft=await this._getUrlForProvider(`${this.url}/authorize`,_,{redirectTo:lt.redirectTo,scopes:lt.scopes,queryParams:lt.queryParams});return this._debug("#_handleProviderSignIn()","provider",_,"options",lt,"url",ft),isBrowser$1()&&!lt.skipBrowserRedirect&&window.location.assign(ft),{data:{provider:_,url:ft},error:null}}async _recoverAndRefresh(){var _;const lt="#_recoverAndRefresh()";this._debug(lt,"begin");try{const ft=await getItemAsync(this.storage,this.storageKey);if(this._debug(lt,"session from storage",ft),!this._isValidSession(ft)){this._debug(lt,"session is not valid"),ft!==null&&await this._removeSession();return}const mt=Math.round(Date.now()/1e3),pt=((_=ft.expires_at)!==null&&_!==void 0?_:1/0)<mt+EXPIRY_MARGIN;if(this._debug(lt,`session has${pt?"":" not"} expired with margin of ${EXPIRY_MARGIN}s`),pt){if(this.autoRefreshToken&&ft.refresh_token){const{error:gt}=await this._callRefreshToken(ft.refresh_token);gt&&(console.error(gt),isAuthRetryableFetchError(gt)||(this._debug(lt,"refresh failed with a non-retryable error, removing the session",gt),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",ft)}catch(ft){this._debug(lt,"error",ft),console.error(ft);return}finally{this._debug(lt,"end")}}async _callRefreshToken(_){var lt,ft;if(!_)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const mt=`#_callRefreshToken(${_.substring(0,5)}...)`;this._debug(mt,"begin");try{this.refreshingDeferred=new Deferred;const{data:pt,error:gt}=await this._refreshAccessToken(_);if(gt)throw gt;if(!pt.session)throw new AuthSessionMissingError;await this._saveSession(pt.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",pt.session);const bt={session:pt.session,error:null};return this.refreshingDeferred.resolve(bt),bt}catch(pt){if(this._debug(mt,"error",pt),isAuthError(pt)){const gt={session:null,error:pt};return isAuthRetryableFetchError(pt)||await this._removeSession(),(lt=this.refreshingDeferred)===null||lt===void 0||lt.resolve(gt),gt}throw(ft=this.refreshingDeferred)===null||ft===void 0||ft.reject(pt),pt}finally{this.refreshingDeferred=null,this._debug(mt,"end")}}async _notifyAllSubscribers(_,lt,ft=!0){const mt=`#_notifyAllSubscribers(${_})`;this._debug(mt,"begin",lt,`broadcast = ${ft}`);try{this.broadcastChannel&&ft&&this.broadcastChannel.postMessage({event:_,session:lt});const pt=[],gt=Array.from(this.stateChangeEmitters.values()).map(async bt=>{try{await bt.callback(_,lt)}catch(wt){pt.push(wt)}});if(await Promise.all(gt),pt.length>0){for(let bt=0;bt<pt.length;bt+=1)console.error(pt[bt]);throw pt[0]}}finally{this._debug(mt,"end")}}async _saveSession(_){this._debug("#_saveSession()",_),this.suppressGetSessionWarning=!0,await setItemAsync(this.storage,this.storageKey,_)}async _removeSession(){this._debug("#_removeSession()"),await removeItemAsync(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const _=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{_&&isBrowser$1()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",_)}catch(lt){console.error("removing visibilitychange callback failed",lt)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const _=setInterval(()=>this._autoRefreshTokenTick(),AUTO_REFRESH_TICK_DURATION);this.autoRefreshTicker=_,_&&typeof _=="object"&&typeof _.unref=="function"?_.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(_),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const _=this.autoRefreshTicker;this.autoRefreshTicker=null,_&&clearInterval(_)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const _=Date.now();try{return await this._useSession(async lt=>{const{data:{session:ft}}=lt;if(!ft||!ft.refresh_token||!ft.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const mt=Math.floor((ft.expires_at*1e3-_)/AUTO_REFRESH_TICK_DURATION);this._debug("#_autoRefreshTokenTick()",`access token expires in ${mt} ticks, a tick lasts ${AUTO_REFRESH_TICK_DURATION}ms, refresh threshold is ${AUTO_REFRESH_TICK_THRESHOLD} ticks`),mt<=AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(ft.refresh_token)})}catch(lt){console.error("Auto refresh tick failed with error. This is likely a transient error.",lt)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(_){if(_.isAcquireTimeout||_ instanceof LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw _}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!isBrowser$1()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(_){console.error("_handleVisibilityChange",_)}}async _onVisibilityChanged(_){const lt=`#_onVisibilityChanged(${_})`;this._debug(lt,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),_||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(lt,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(_,lt,ft){const mt=[`provider=${encodeURIComponent(lt)}`];if(ft!=null&&ft.redirectTo&&mt.push(`redirect_to=${encodeURIComponent(ft.redirectTo)}`),ft!=null&&ft.scopes&&mt.push(`scopes=${encodeURIComponent(ft.scopes)}`),this.flowType==="pkce"){const[pt,gt]=await getCodeChallengeAndMethod(this.storage,this.storageKey),bt=new URLSearchParams({code_challenge:`${encodeURIComponent(pt)}`,code_challenge_method:`${encodeURIComponent(gt)}`});mt.push(bt.toString())}if(ft!=null&&ft.queryParams){const pt=new URLSearchParams(ft.queryParams);mt.push(pt.toString())}return ft!=null&&ft.skipBrowserRedirect&&mt.push(`skip_http_redirect=${ft.skipBrowserRedirect}`),`${_}?${mt.join("&")}`}async _unenroll(_){try{return await this._useSession(async lt=>{var ft;const{data:mt,error:pt}=lt;return pt?{data:null,error:pt}:await _request(this.fetch,"DELETE",`${this.url}/factors/${_.factorId}`,{headers:this.headers,jwt:(ft=mt==null?void 0:mt.session)===null||ft===void 0?void 0:ft.access_token})})}catch(lt){if(isAuthError(lt))return{data:null,error:lt};throw lt}}async _enroll(_){try{return await this._useSession(async lt=>{var ft,mt;const{data:pt,error:gt}=lt;if(gt)return{data:null,error:gt};const bt=Object.assign({friendly_name:_.friendlyName,factor_type:_.factorType},_.factorType==="phone"?{phone:_.phone}:{issuer:_.issuer}),{data:wt,error:vt}=await _request(this.fetch,"POST",`${this.url}/factors`,{body:bt,headers:this.headers,jwt:(ft=pt==null?void 0:pt.session)===null||ft===void 0?void 0:ft.access_token});return vt?{data:null,error:vt}:(_.factorType==="totp"&&(!((mt=wt==null?void 0:wt.totp)===null||mt===void 0)&&mt.qr_code)&&(wt.totp.qr_code=`data:image/svg+xml;utf-8,${wt.totp.qr_code}`),{data:wt,error:null})})}catch(lt){if(isAuthError(lt))return{data:null,error:lt};throw lt}}async _verify(_){return this._acquireLock(-1,async()=>{try{return await this._useSession(async lt=>{var ft;const{data:mt,error:pt}=lt;if(pt)return{data:null,error:pt};const{data:gt,error:bt}=await _request(this.fetch,"POST",`${this.url}/factors/${_.factorId}/verify`,{body:{code:_.code,challenge_id:_.challengeId},headers:this.headers,jwt:(ft=mt==null?void 0:mt.session)===null||ft===void 0?void 0:ft.access_token});return bt?{data:null,error:bt}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+gt.expires_in},gt)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",gt),{data:gt,error:bt})})}catch(lt){if(isAuthError(lt))return{data:null,error:lt};throw lt}})}async _challenge(_){return this._acquireLock(-1,async()=>{try{return await this._useSession(async lt=>{var ft;const{data:mt,error:pt}=lt;return pt?{data:null,error:pt}:await _request(this.fetch,"POST",`${this.url}/factors/${_.factorId}/challenge`,{body:{channel:_.channel},headers:this.headers,jwt:(ft=mt==null?void 0:mt.session)===null||ft===void 0?void 0:ft.access_token})})}catch(lt){if(isAuthError(lt))return{data:null,error:lt};throw lt}})}async _challengeAndVerify(_){const{data:lt,error:ft}=await this._challenge({factorId:_.factorId});return ft?{data:null,error:ft}:await this._verify({factorId:_.factorId,challengeId:lt.id,code:_.code})}async _listFactors(){const{data:{user:_},error:lt}=await this.getUser();if(lt)return{data:null,error:lt};const ft=(_==null?void 0:_.factors)||[],mt=ft.filter(gt=>gt.factor_type==="totp"&&gt.status==="verified"),pt=ft.filter(gt=>gt.factor_type==="phone"&&gt.status==="verified");return{data:{all:ft,totp:mt,phone:pt},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async _=>{var lt,ft;const{data:{session:mt},error:pt}=_;if(pt)return{data:null,error:pt};if(!mt)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const gt=this._decodeJWT(mt.access_token);let bt=null;gt.aal&&(bt=gt.aal);let wt=bt;((ft=(lt=mt.user.factors)===null||lt===void 0?void 0:lt.filter(Rt=>Rt.status==="verified"))!==null&&ft!==void 0?ft:[]).length>0&&(wt="aal2");const Ct=gt.amr||[];return{data:{currentLevel:bt,nextLevel:wt,currentAuthenticationMethods:Ct},error:null}}))}}GoTrueClient.nextInstanceID=0;const AuthClient=GoTrueClient;class SupabaseAuthClient extends AuthClient{constructor(_){super(_)}}var __awaiter=function(it,_,lt,ft){function mt(pt){return pt instanceof lt?pt:new lt(function(gt){gt(pt)})}return new(lt||(lt=Promise))(function(pt,gt){function bt(Ct){try{vt(ft.next(Ct))}catch(Rt){gt(Rt)}}function wt(Ct){try{vt(ft.throw(Ct))}catch(Rt){gt(Rt)}}function vt(Ct){Ct.done?pt(Ct.value):mt(Ct.value).then(bt,wt)}vt((ft=ft.apply(it,_||[])).next())})};class SupabaseClient{constructor(_,lt,ft){var mt,pt,gt;if(this.supabaseUrl=_,this.supabaseKey=lt,!_)throw new Error("supabaseUrl is required.");if(!lt)throw new Error("supabaseKey is required.");const bt=stripTrailingSlash(_);this.realtimeUrl=`${bt}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${bt}/auth/v1`,this.storageUrl=`${bt}/storage/v1`,this.functionsUrl=`${bt}/functions/v1`;const wt=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,vt={db:DEFAULT_DB_OPTIONS,realtime:DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},DEFAULT_AUTH_OPTIONS),{storageKey:wt}),global:DEFAULT_GLOBAL_OPTIONS},Ct=applySettingDefaults(ft??{},vt);this.storageKey=(mt=Ct.auth.storageKey)!==null&&mt!==void 0?mt:"",this.headers=(pt=Ct.global.headers)!==null&&pt!==void 0?pt:{},Ct.accessToken?(this.accessToken=Ct.accessToken,this.auth=new Proxy({},{get:(Rt,Mt)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(Mt)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((gt=Ct.auth)!==null&&gt!==void 0?gt:{},this.headers,Ct.global.fetch),this.fetch=fetchWithAuth(lt,this._getAccessToken.bind(this),Ct.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},Ct.realtime)),this.rest=new PostgrestClient(`${bt}/rest/v1`,{headers:this.headers,schema:Ct.db.schema,fetch:this.fetch}),Ct.accessToken||this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new StorageClient(this.storageUrl,this.headers,this.fetch)}from(_){return this.rest.from(_)}schema(_){return this.rest.schema(_)}rpc(_,lt={},ft={}){return this.rest.rpc(_,lt,ft)}channel(_,lt={config:{}}){return this.realtime.channel(_,lt)}getChannels(){return this.realtime.getChannels()}removeChannel(_){return this.realtime.removeChannel(_)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var _,lt;return __awaiter(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:ft}=yield this.auth.getSession();return(lt=(_=ft.session)===null||_===void 0?void 0:_.access_token)!==null&&lt!==void 0?lt:null})}_initSupabaseAuthClient({autoRefreshToken:_,persistSession:lt,detectSessionInUrl:ft,storage:mt,storageKey:pt,flowType:gt,lock:bt,debug:wt},vt,Ct){var Rt;const Mt={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl,headers:Object.assign(Object.assign({},Mt),vt),storageKey:pt,autoRefreshToken:_,persistSession:lt,detectSessionInUrl:ft,storage:mt,flowType:gt,lock:bt,debug:wt,fetch:Ct,hasCustomAuthorizationHeader:(Rt="Authorization"in this.headers)!==null&&Rt!==void 0?Rt:!1})}_initRealtimeClient(_){return new RealtimeClient(this.realtimeUrl,Object.assign(Object.assign({},_),{params:Object.assign({apikey:this.supabaseKey},_==null?void 0:_.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((lt,ft)=>{this._handleTokenChanged(lt,"CLIENT",ft==null?void 0:ft.access_token)})}_handleTokenChanged(_,lt,ft){(_==="TOKEN_REFRESHED"||_==="SIGNED_IN")&&this.changedAccessToken!==ft?(this.realtime.setAuth(ft??null),this.changedAccessToken=ft):_==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),lt=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const createClient=(it,_,lt)=>new SupabaseClient(it,_,lt);function cn(...it){return twMerge(clsx$1(it))}const supabase=createClient("https://efvwmgxavpcoyywgmsbg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmdndtZ3hhdnBjb3l5d2dtc2JnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzAxOTc1NDEsImV4cCI6MjA0NTc3MzU0MX0.FIC7iM0IGIgVUKC2vrpA_2eDR5FcH444q6kbRcxwuPc"),SessionContext=reactExports.createContext({session:null,setSession:()=>{}}),SessionProvider=({children:it})=>{const[_,lt]=reactExports.useState(null);return reactExports.useEffect(()=>{supabase.auth.getSession().then(({data:{session:mt}})=>{lt(mt)});const{data:{subscription:ft}}=supabase.auth.onAuthStateChange((mt,pt)=>{lt(pt)});return()=>ft.unsubscribe()},[]),console.log(`
        session=>`,_),jsxRuntimeExports.jsx(SessionContext.Provider,{value:{session:_,setSession:lt},children:it})},WebSocketContext=reactExports.createContext({isReady:!1,val:null,send:()=>{},ws:null,connectToServer:()=>{}}),WebSocketProvider=({children:it})=>{const{session:_}=reactExports.useContext(SessionContext),lt=reactExports.useRef(_),{subdomain:ft,isLocal:mt}=reactExports.useContext(SubdomainContext),[pt,gt]=reactExports.useState(!1),[bt,wt]=reactExports.useState(null),[vt,Ct]=reactExports.useState(null),Rt=vt?vt.send.bind(vt):()=>{},Mt=()=>{let Ot="";mt?ft?Ot=`ws://localhost:8000/ws/${ft}`:Ot="ws://localhost:8000/ws":ft?Ot=`wss://whispershirt.com/ws/${ft}`:Ot="wss://whispershirt.com/ws";const Nt=new WebSocket(Ot);Nt.onopen=()=>gt(!0),Nt.onclose=()=>gt(!1),Nt.onmessage=Ht=>wt(Ht.data),Ct(Nt)};return reactExports.useEffect(()=>{lt.current=_},[_]),reactExports.useEffect(()=>{ft&&(vt&&vt.close(),Mt())},[ft]),reactExports.useEffect(()=>{let Ot;if(pt)if(_){const Nt=_.access_token;Rt(JSON.stringify({type:"access_token",token:Nt}))}else Ot=setTimeout(()=>{const Nt=lt.current;if(Nt){const Ht=Nt.access_token;Rt(JSON.stringify({type:"access_token",token:Ht}))}else Rt(JSON.stringify({type:"anonymous"}))},600);return()=>{Ot&&clearTimeout(Ot)}},[pt]),reactExports.useEffect(()=>()=>{vt&&vt.close()},[]),jsxRuntimeExports.jsx(WebSocketContext.Provider,{value:{isReady:pt,val:bt,send:Rt,ws:vt,connectToServer:Mt},children:it})};function setRef(it,_){typeof it=="function"?it(_):it!=null&&(it.current=_)}function composeRefs(...it){return _=>it.forEach(lt=>setRef(lt,_))}var Slot=reactExports.forwardRef((it,_)=>{const{children:lt,...ft}=it,mt=reactExports.Children.toArray(lt),pt=mt.find(isSlottable);if(pt){const gt=pt.props.children,bt=mt.map(wt=>wt===pt?reactExports.Children.count(gt)>1?reactExports.Children.only(null):reactExports.isValidElement(gt)?gt.props.children:null:wt);return jsxRuntimeExports.jsx(SlotClone,{...ft,ref:_,children:reactExports.isValidElement(gt)?reactExports.cloneElement(gt,void 0,bt):null})}return jsxRuntimeExports.jsx(SlotClone,{...ft,ref:_,children:lt})});Slot.displayName="Slot";var SlotClone=reactExports.forwardRef((it,_)=>{const{children:lt,...ft}=it;if(reactExports.isValidElement(lt)){const mt=getElementRef(lt);return reactExports.cloneElement(lt,{...mergeProps(ft,lt.props),ref:_?composeRefs(_,mt):mt})}return reactExports.Children.count(lt)>1?reactExports.Children.only(null):null});SlotClone.displayName="SlotClone";var Slottable=({children:it})=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:it});function isSlottable(it){return reactExports.isValidElement(it)&&it.type===Slottable}function mergeProps(it,_){const lt={..._};for(const ft in _){const mt=it[ft],pt=_[ft];/^on[A-Z]/.test(ft)?mt&&pt?lt[ft]=(...bt)=>{pt(...bt),mt(...bt)}:mt&&(lt[ft]=mt):ft==="style"?lt[ft]={...mt,...pt}:ft==="className"&&(lt[ft]=[mt,pt].filter(Boolean).join(" "))}return{...it,...lt}}function getElementRef(it){var ft,mt;let _=(ft=Object.getOwnPropertyDescriptor(it.props,"ref"))==null?void 0:ft.get,lt=_&&"isReactWarning"in _&&_.isReactWarning;return lt?it.ref:(_=(mt=Object.getOwnPropertyDescriptor(it,"ref"))==null?void 0:mt.get,lt=_&&"isReactWarning"in _&&_.isReactWarning,lt?it.props.ref:it.props.ref||it.ref)}function r$1(it){var _,lt,ft="";if(typeof it=="string"||typeof it=="number")ft+=it;else if(typeof it=="object")if(Array.isArray(it))for(_=0;_<it.length;_++)it[_]&&(lt=r$1(it[_]))&&(ft&&(ft+=" "),ft+=lt);else for(_ in it)it[_]&&(ft&&(ft+=" "),ft+=_);return ft}function clsx(){for(var it,_,lt=0,ft="";lt<arguments.length;)(it=arguments[lt++])&&(_=r$1(it))&&(ft&&(ft+=" "),ft+=_);return ft}const falsyToString=it=>typeof it=="boolean"?"".concat(it):it===0?"0":it,cx=clsx,cva=(it,_)=>lt=>{var ft;if((_==null?void 0:_.variants)==null)return cx(it,lt==null?void 0:lt.class,lt==null?void 0:lt.className);const{variants:mt,defaultVariants:pt}=_,gt=Object.keys(mt).map(vt=>{const Ct=lt==null?void 0:lt[vt],Rt=pt==null?void 0:pt[vt];if(Ct===null)return null;const Mt=falsyToString(Ct)||falsyToString(Rt);return mt[vt][Mt]}),bt=lt&&Object.entries(lt).reduce((vt,Ct)=>{let[Rt,Mt]=Ct;return Mt===void 0||(vt[Rt]=Mt),vt},{}),wt=_==null||(ft=_.compoundVariants)===null||ft===void 0?void 0:ft.reduce((vt,Ct)=>{let{class:Rt,className:Mt,...Ot}=Ct;return Object.entries(Ot).every(Nt=>{let[Ht,Kt]=Nt;return Array.isArray(Kt)?Kt.includes({...pt,...bt}[Ht]):{...pt,...bt}[Ht]===Kt})?[...vt,Rt,Mt]:vt},[]);return cx(it,gt,wt,lt==null?void 0:lt.class,lt==null?void 0:lt.className)},buttonVariants=cva("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Button=reactExports.forwardRef(({className:it,variant:_,size:lt,asChild:ft=!1,...mt},pt)=>{const gt=ft?Slot:"button";return jsxRuntimeExports.jsx(gt,{className:cn(buttonVariants({variant:_,size:lt,className:it})),ref:pt,...mt})});Button.displayName="Button";const Input=reactExports.forwardRef(({className:it,type:_,isLarge:lt,...ft},mt)=>jsxRuntimeExports.jsx("input",{type:_,className:cn((lt?"text-lg":"text-sm")+"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",it),ref:mt,...ft}));Input.displayName="Input";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=it=>it.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mergeClasses=(...it)=>it.filter((_,lt,ft)=>!!_&&_.trim()!==""&&ft.indexOf(_)===lt).join(" ").trim();/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon=reactExports.forwardRef(({color:it="currentColor",size:_=24,strokeWidth:lt=2,absoluteStrokeWidth:ft,className:mt="",children:pt,iconNode:gt,...bt},wt)=>reactExports.createElement("svg",{ref:wt,...defaultAttributes,width:_,height:_,stroke:it,strokeWidth:ft?Number(lt)*24/Number(_):lt,className:mergeClasses("lucide",mt),...bt},[...gt.map(([vt,Ct])=>reactExports.createElement(vt,Ct)),...Array.isArray(pt)?pt:[pt]]));/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(it,_)=>{const lt=reactExports.forwardRef(({className:ft,...mt},pt)=>reactExports.createElement(Icon,{ref:pt,iconNode:_,className:mergeClasses(`lucide-${toKebabCase(it)}`,ft),...mt}));return lt.displayName=`${it}`,lt};/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowLeft=createLucideIcon("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowRight=createLucideIcon("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Key=createLucideIcon("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lock=createLucideIcon("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MicOff=createLucideIcon("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mic=createLucideIcon("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PersonStanding=createLucideIcon("PersonStanding",[["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["path",{d:"m9 20 3-6 3 6",key:"se2kox"}],["path",{d:"m6 8 6 2 6-2",key:"4o3us4"}],["path",{d:"M12 10v4",key:"1kjpxc"}]]);function createDOMMotionComponentProxy(it){if(typeof Proxy>"u")return it;const _=new Map,lt=(...ft)=>it(...ft);return new Proxy(lt,{get:(ft,mt)=>mt==="create"?it:(_.has(mt)||_.set(mt,it(mt)),_.get(mt))})}function isAnimationControls(it){return it!==null&&typeof it=="object"&&typeof it.start=="function"}const isKeyframesTarget=it=>Array.isArray(it);function shallowCompare(it,_){if(!Array.isArray(_))return!1;const lt=_.length;if(lt!==it.length)return!1;for(let ft=0;ft<lt;ft++)if(_[ft]!==it[ft])return!1;return!0}function isVariantLabel(it){return typeof it=="string"||Array.isArray(it)}function getValueState(it){const _=[{},{}];return it==null||it.values.forEach((lt,ft)=>{_[0][ft]=lt.get(),_[1][ft]=lt.getVelocity()}),_}function resolveVariantFromProps(it,_,lt,ft){if(typeof _=="function"){const[mt,pt]=getValueState(ft);_=_(lt!==void 0?lt:it.custom,mt,pt)}if(typeof _=="string"&&(_=it.variants&&it.variants[_]),typeof _=="function"){const[mt,pt]=getValueState(ft);_=_(lt!==void 0?lt:it.custom,mt,pt)}return _}function resolveVariant(it,_,lt){const ft=it.getProps();return resolveVariantFromProps(ft,_,lt!==void 0?lt:ft.custom,it)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder],transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),secondsToMilliseconds=it=>it*1e3,millisecondsToSeconds=it=>it/1e3,underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=it=>({type:"spring",stiffness:550,damping:it===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(it,{keyframes:_})=>_.length>2?keyframesTransition:transformProps.has(it)?it.startsWith("scale")?criticallyDampedSpring(_[1]):underDampedSpring:ease;function getValueTransition(it,_){return it?it[_]||it.default||it:void 0}const MotionGlobalConfig={skipAnimations:!1,useManualTiming:!1},isNotNull=it=>it!==null;function getFinalKeyframe(it,{repeat:_,repeatType:lt="loop"},ft){const mt=it.filter(isNotNull),pt=_&&lt!=="loop"&&_%2===1?0:mt.length-1;return!pt||ft===void 0?mt[pt]:ft}const noop$1=it=>it;function createRenderStep(it){let _=new Set,lt=new Set,ft=!1,mt=!1;const pt=new WeakSet;let gt={delta:0,timestamp:0,isProcessing:!1};function bt(vt){pt.has(vt)&&(wt.schedule(vt),it()),vt(gt)}const wt={schedule:(vt,Ct=!1,Rt=!1)=>{const Ot=Rt&&ft?_:lt;return Ct&&pt.add(vt),Ot.has(vt)||Ot.add(vt),vt},cancel:vt=>{lt.delete(vt),pt.delete(vt)},process:vt=>{if(gt=vt,ft){mt=!0;return}ft=!0,[_,lt]=[lt,_],lt.clear(),_.forEach(bt),ft=!1,mt&&(mt=!1,wt.process(vt))}};return wt}const stepsOrder=["read","resolveKeyframes","update","preRender","render","postRender"],maxElapsed=40;function createRenderBatcher(it,_){let lt=!1,ft=!0;const mt={delta:0,timestamp:0,isProcessing:!1},pt=()=>lt=!0,gt=stepsOrder.reduce((hr,Qt)=>(hr[Qt]=createRenderStep(pt),hr),{}),{read:bt,resolveKeyframes:wt,update:vt,preRender:Ct,render:Rt,postRender:Mt}=gt,Ot=()=>{const hr=performance.now();lt=!1,mt.delta=ft?1e3/60:Math.max(Math.min(hr-mt.timestamp,maxElapsed),1),mt.timestamp=hr,mt.isProcessing=!0,bt.process(mt),wt.process(mt),vt.process(mt),Ct.process(mt),Rt.process(mt),Mt.process(mt),mt.isProcessing=!1,lt&&_&&(ft=!1,it(Ot))},Nt=()=>{lt=!0,ft=!0,mt.isProcessing||it(Ot)};return{schedule:stepsOrder.reduce((hr,Qt)=>{const mr=gt[Qt];return hr[Qt]=(br,Fr=!1,kr=!1)=>(lt||Nt(),mr.schedule(br,Fr,kr)),hr},{}),cancel:hr=>{for(let Qt=0;Qt<stepsOrder.length;Qt++)gt[stepsOrder[Qt]].cancel(hr)},state:mt,steps:gt}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop$1,!0),calcBezier=(it,_,lt)=>(((1-3*lt+3*_)*it+(3*lt-6*_))*it+3*_)*it,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(it,_,lt,ft,mt){let pt,gt,bt=0;do gt=_+(lt-_)/2,pt=calcBezier(gt,ft,mt)-it,pt>0?lt=gt:_=gt;while(Math.abs(pt)>subdivisionPrecision&&++bt<subdivisionMaxIterations);return gt}function cubicBezier(it,_,lt,ft){if(it===_&&lt===ft)return noop$1;const mt=pt=>binarySubdivide(pt,0,1,it,lt);return pt=>pt===0||pt===1?pt:calcBezier(mt(pt),_,ft)}const mirrorEasing=it=>_=>_<=.5?it(2*_)/2:(2-it(2*(1-_)))/2,reverseEasing=it=>_=>1-it(1-_),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=it=>(it*=2)<1?.5*backIn(it):.5*(2-Math.pow(2,-10*(it-1))),circIn=it=>1-Math.sin(Math.acos(it)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),isZeroValueString=it=>/^0[^.\s]+$/u.test(it);function isNone(it){return typeof it=="number"?it===0:it!==null?it==="none"||it==="0"||isZeroValueString(it):!0}let invariant=noop$1;const isNumericalString=it=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(it),checkStringStartsWith=it=>_=>typeof _=="string"&&_.startsWith(it),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=it=>startsAsVariableToken(it)?singleCssVariableRegex.test(it.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(it){const _=splitCSSVariableRegex.exec(it);if(!_)return[,];const[,lt,ft,mt]=_;return[`--${lt??ft}`,mt]}function getVariableValue(it,_,lt=1){const[ft,mt]=parseCSSVariable(it);if(!ft)return;const pt=window.getComputedStyle(_).getPropertyValue(ft);if(pt){const gt=pt.trim();return isNumericalString(gt)?parseFloat(gt):gt}return isCSSVariableToken(mt)?getVariableValue(mt,_,lt+1):mt}const clamp$1=(it,_,lt)=>lt>_?_:lt<it?it:lt,number={test:it=>typeof it=="number",parse:parseFloat,transform:it=>it},alpha={...number,transform:it=>clamp$1(0,1,it)},scale={...number,default:1},createUnitType=it=>({test:_=>typeof _=="string"&&_.endsWith(it)&&_.split(" ").length===1,parse:parseFloat,transform:_=>`${_}${it}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:it=>percent.parse(it)/100,transform:it=>percent.transform(it*100)},positionalKeys=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),isNumOrPxType=it=>it===number||it===px,getPosFromMatrix=(it,_)=>parseFloat(it.split(", ")[_]),getTranslateFromMatrix=(it,_)=>(lt,{transform:ft})=>{if(ft==="none"||!ft)return 0;const mt=ft.match(/^matrix3d\((.+)\)$/u);if(mt)return getPosFromMatrix(mt[1],_);{const pt=ft.match(/^matrix\((.+)\)$/u);return pt?getPosFromMatrix(pt[1],it):0}},transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(it=>!transformKeys.has(it));function removeNonTranslationalTransform(it){const _=[];return nonTranslationalTransformKeys.forEach(lt=>{const ft=it.getValue(lt);ft!==void 0&&(_.push([lt,ft.get()]),ft.set(lt.startsWith("scale")?1:0))}),_}const positionalValues={width:({x:it},{paddingLeft:_="0",paddingRight:lt="0"})=>it.max-it.min-parseFloat(_)-parseFloat(lt),height:({y:it},{paddingTop:_="0",paddingBottom:lt="0"})=>it.max-it.min-parseFloat(_)-parseFloat(lt),top:(it,{top:_})=>parseFloat(_),left:(it,{left:_})=>parseFloat(_),bottom:({y:it},{top:_})=>parseFloat(_)+(it.max-it.min),right:({x:it},{left:_})=>parseFloat(_)+(it.max-it.min),x:getTranslateFromMatrix(4,13),y:getTranslateFromMatrix(5,14)};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const testValueType=it=>_=>_.test(it),auto={test:it=>it==="auto",parse:it=>it},dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=it=>dimensionValueTypes.find(testValueType(it)),toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const it=Array.from(toResolve).filter(ft=>ft.needsMeasurement),_=new Set(it.map(ft=>ft.element)),lt=new Map;_.forEach(ft=>{const mt=removeNonTranslationalTransform(ft);mt.length&&(lt.set(ft,mt),ft.render())}),it.forEach(ft=>ft.measureInitialState()),_.forEach(ft=>{ft.render();const mt=lt.get(ft);mt&&mt.forEach(([pt,gt])=>{var bt;(bt=ft.getValue(pt))===null||bt===void 0||bt.set(gt)})}),it.forEach(ft=>ft.measureEndState()),it.forEach(ft=>{ft.suspendedScrollY!==void 0&&window.scrollTo(0,ft.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(it=>it.complete()),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(it=>{it.readKeyframes(),it.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){readAllKeyframes(),measureAllKeyframes()}class KeyframeResolver{constructor(_,lt,ft,mt,pt,gt=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[..._],this.onComplete=lt,this.name=ft,this.motionValue=mt,this.element=pt,this.isAsync=gt}scheduleResolve(){this.isScheduled=!0,this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:_,name:lt,element:ft,motionValue:mt}=this;for(let pt=0;pt<_.length;pt++)if(_[pt]===null)if(pt===0){const gt=mt==null?void 0:mt.get(),bt=_[_.length-1];if(gt!==void 0)_[0]=gt;else if(ft&&lt){const wt=ft.readValue(lt,bt);wt!=null&&(_[0]=wt)}_[0]===void 0&&(_[0]=bt),mt&&gt===void 0&&mt.set(_[0])}else _[pt]=_[pt-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),toResolve.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,toResolve.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const sanitize=it=>Math.round(it*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(it){return it==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(it,_)=>lt=>!!(typeof lt=="string"&&singleColorRegex.test(lt)&&lt.startsWith(it)||_&&!isNullish(lt)&&Object.prototype.hasOwnProperty.call(lt,_)),splitColor=(it,_,lt)=>ft=>{if(typeof ft!="string")return ft;const[mt,pt,gt,bt]=ft.match(floatRegex);return{[it]:parseFloat(mt),[_]:parseFloat(pt),[lt]:parseFloat(gt),alpha:bt!==void 0?parseFloat(bt):1}},clampRgbUnit=it=>clamp$1(0,255,it),rgbUnit={...number,transform:it=>Math.round(clampRgbUnit(it))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:it,green:_,blue:lt,alpha:ft=1})=>"rgba("+rgbUnit.transform(it)+", "+rgbUnit.transform(_)+", "+rgbUnit.transform(lt)+", "+sanitize(alpha.transform(ft))+")"};function parseHex(it){let _="",lt="",ft="",mt="";return it.length>5?(_=it.substring(1,3),lt=it.substring(3,5),ft=it.substring(5,7),mt=it.substring(7,9)):(_=it.substring(1,2),lt=it.substring(2,3),ft=it.substring(3,4),mt=it.substring(4,5),_+=_,lt+=lt,ft+=ft,mt+=mt),{red:parseInt(_,16),green:parseInt(lt,16),blue:parseInt(ft,16),alpha:mt?parseInt(mt,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:it,saturation:_,lightness:lt,alpha:ft=1})=>"hsla("+Math.round(it)+", "+percent.transform(sanitize(_))+", "+percent.transform(sanitize(lt))+", "+sanitize(alpha.transform(ft))+")"},color={test:it=>rgba.test(it)||hex.test(it)||hsla.test(it),parse:it=>rgba.test(it)?rgba.parse(it):hsla.test(it)?hsla.parse(it):hex.parse(it),transform:it=>typeof it=="string"?it:it.hasOwnProperty("red")?rgba.transform(it):hsla.transform(it)},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test$1(it){var _,lt;return isNaN(it)&&typeof it=="string"&&(((_=it.match(floatRegex))===null||_===void 0?void 0:_.length)||0)+(((lt=it.match(colorRegex))===null||lt===void 0?void 0:lt.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(it){const _=it.toString(),lt=[],ft={color:[],number:[],var:[]},mt=[];let pt=0;const bt=_.replace(complexRegex,wt=>(color.test(wt)?(ft.color.push(pt),mt.push(COLOR_TOKEN),lt.push(color.parse(wt))):wt.startsWith(VAR_FUNCTION_TOKEN)?(ft.var.push(pt),mt.push(VAR_TOKEN),lt.push(wt)):(ft.number.push(pt),mt.push(NUMBER_TOKEN),lt.push(parseFloat(wt))),++pt,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:lt,split:bt,indexes:ft,types:mt}}function parseComplexValue(it){return analyseComplexValue(it).values}function createTransformer(it){const{split:_,types:lt}=analyseComplexValue(it),ft=_.length;return mt=>{let pt="";for(let gt=0;gt<ft;gt++)if(pt+=_[gt],mt[gt]!==void 0){const bt=lt[gt];bt===NUMBER_TOKEN?pt+=sanitize(mt[gt]):bt===COLOR_TOKEN?pt+=color.transform(mt[gt]):pt+=mt[gt]}return pt}}const convertNumbersToZero=it=>typeof it=="number"?0:it;function getAnimatableNone$1(it){const _=parseComplexValue(it);return createTransformer(it)(_.map(convertNumbersToZero))}const complex={test:test$1,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1},maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(it){const[_,lt]=it.slice(0,-1).split("(");if(_==="drop-shadow")return it;const[ft]=lt.match(floatRegex)||[];if(!ft)return it;const mt=lt.replace(ft,"");let pt=maxDefaults.has(_)?1:0;return ft!==lt&&(pt*=100),_+"("+pt+mt+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:it=>{const _=it.match(functionRegex);return _?_.map(applyDefaultFilter).join(" "):it}},browserNumberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,backgroundPositionX:px,backgroundPositionY:px},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},int={...number,transform:Math.round},numberValueTypes={...browserNumberValueTypes,...transformValueTypes,zIndex:int,size:px,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=it=>defaultValueTypes[it];function getAnimatableNone(it,_){let lt=getDefaultValueType(it);return lt!==filter&&(lt=complex),lt.getAnimatableNone?lt.getAnimatableNone(_):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(it,_,lt){let ft=0,mt;for(;ft<it.length&&!mt;){const pt=it[ft];typeof pt=="string"&&!invalidTemplates.has(pt)&&analyseComplexValue(pt).values.length&&(mt=it[ft]),ft++}if(mt&&lt)for(const pt of _)it[pt]=getAnimatableNone(lt,mt)}class DOMKeyframesResolver extends KeyframeResolver{constructor(_,lt,ft,mt,pt){super(_,lt,ft,mt,pt,!0)}readKeyframes(){const{unresolvedKeyframes:_,element:lt,name:ft}=this;if(!lt||!lt.current)return;super.readKeyframes();for(let wt=0;wt<_.length;wt++){let vt=_[wt];if(typeof vt=="string"&&(vt=vt.trim(),isCSSVariableToken(vt))){const Ct=getVariableValue(vt,lt.current);Ct!==void 0&&(_[wt]=Ct),wt===_.length-1&&(this.finalKeyframe=vt)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(ft)||_.length!==2)return;const[mt,pt]=_,gt=findDimensionValueType(mt),bt=findDimensionValueType(pt);if(gt!==bt)if(isNumOrPxType(gt)&&isNumOrPxType(bt))for(let wt=0;wt<_.length;wt++){const vt=_[wt];typeof vt=="string"&&(_[wt]=parseFloat(vt))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:_,name:lt}=this,ft=[];for(let mt=0;mt<_.length;mt++)isNone(_[mt])&&ft.push(mt);ft.length&&makeNoneKeyframesAnimatable(_,ft,lt)}measureInitialState(){const{element:_,unresolvedKeyframes:lt,name:ft}=this;if(!_||!_.current)return;ft==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[ft](_.measureViewportBox(),window.getComputedStyle(_.current)),lt[0]=this.measuredOrigin;const mt=lt[lt.length-1];mt!==void 0&&_.getValue(ft,mt).jump(mt,!1)}measureEndState(){var _;const{element:lt,name:ft,unresolvedKeyframes:mt}=this;if(!lt||!lt.current)return;const pt=lt.getValue(ft);pt&&pt.jump(this.measuredOrigin,!1);const gt=mt.length-1,bt=mt[gt];mt[gt]=positionalValues[ft](lt.measureViewportBox(),window.getComputedStyle(lt.current)),bt!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=bt),!((_=this.removedTransforms)===null||_===void 0)&&_.length&&this.removedTransforms.forEach(([wt,vt])=>{lt.getValue(wt).set(vt)}),this.resolveNoneKeyframes()}}function isGenerator(it){return typeof it=="function"}let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:it=>{now=it,queueMicrotask(clearTime)}},isAnimatable=(it,_)=>_==="zIndex"?!1:!!(typeof it=="number"||Array.isArray(it)||typeof it=="string"&&(complex.test(it)||it==="0")&&!it.startsWith("url("));function hasKeyframesChanged(it){const _=it[0];if(it.length===1)return!0;for(let lt=0;lt<it.length;lt++)if(it[lt]!==_)return!0}function canAnimate(it,_,lt,ft){const mt=it[0];if(mt===null)return!1;if(_==="display"||_==="visibility")return!0;const pt=it[it.length-1],gt=isAnimatable(mt,_),bt=isAnimatable(pt,_);return!gt||!bt?!1:hasKeyframesChanged(it)||(lt==="spring"||isGenerator(lt))&&ft}const MAX_RESOLVE_DELAY=40;class BaseAnimation{constructor({autoplay:_=!0,delay:lt=0,type:ft="keyframes",repeat:mt=0,repeatDelay:pt=0,repeatType:gt="loop",...bt}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=time.now(),this.options={autoplay:_,delay:lt,type:ft,repeat:mt,repeatDelay:pt,repeatType:gt,...bt},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&flushKeyframeResolvers(),this._resolved}onKeyframesResolved(_,lt){this.resolvedAt=time.now(),this.hasAttemptedResolve=!0;const{name:ft,type:mt,velocity:pt,delay:gt,onComplete:bt,onUpdate:wt,isGenerator:vt}=this.options;if(!vt&&!canAnimate(_,ft,mt,pt))if(gt)this.options.duration=0;else{wt==null||wt(getFinalKeyframe(_,this.options,lt)),bt==null||bt(),this.resolveFinishedPromise();return}const Ct=this.initPlayback(_,lt);Ct!==!1&&(this._resolved={keyframes:_,finalKeyframe:lt,...Ct},this.onPostResolved())}onPostResolved(){}then(_,lt){return this.currentFinishedPromise.then(_,lt)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(_=>{this.resolveFinishedPromise=_})}}function velocityPerSecond(it,_){return _?it*(1e3/_):0}const velocitySampleDuration=5;function calcGeneratorVelocity(it,_,lt){const ft=Math.max(_-velocitySampleDuration,0);return velocityPerSecond(lt-it(ft),_-ft)}const safeMin=.001,minDuration=.01,maxDuration$1=10,minDamping=.05,maxDamping=1;function findSpring({duration:it=800,bounce:_=.25,velocity:lt=0,mass:ft=1}){let mt,pt,gt=1-_;gt=clamp$1(minDamping,maxDamping,gt),it=clamp$1(minDuration,maxDuration$1,millisecondsToSeconds(it)),gt<1?(mt=vt=>{const Ct=vt*gt,Rt=Ct*it,Mt=Ct-lt,Ot=calcAngularFreq(vt,gt),Nt=Math.exp(-Rt);return safeMin-Mt/Ot*Nt},pt=vt=>{const Rt=vt*gt*it,Mt=Rt*lt+lt,Ot=Math.pow(gt,2)*Math.pow(vt,2)*it,Nt=Math.exp(-Rt),Ht=calcAngularFreq(Math.pow(vt,2),gt);return(-mt(vt)+safeMin>0?-1:1)*((Mt-Ot)*Nt)/Ht}):(mt=vt=>{const Ct=Math.exp(-vt*it),Rt=(vt-lt)*it+1;return-safeMin+Ct*Rt},pt=vt=>{const Ct=Math.exp(-vt*it),Rt=(lt-vt)*(it*it);return Ct*Rt});const bt=5/it,wt=approximateRoot(mt,pt,bt);if(it=secondsToMilliseconds(it),isNaN(wt))return{stiffness:100,damping:10,duration:it};{const vt=Math.pow(wt,2)*ft;return{stiffness:vt,damping:gt*2*Math.sqrt(ft*vt),duration:it}}}const rootIterations=12;function approximateRoot(it,_,lt){let ft=lt;for(let mt=1;mt<rootIterations;mt++)ft=ft-it(ft)/_(ft);return ft}function calcAngularFreq(it,_){return it*Math.sqrt(1-_*_)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(it,_){return _.some(lt=>it[lt]!==void 0)}function getSpringOptions(it){let _={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...it};if(!isSpringType(it,physicsKeys)&&isSpringType(it,durationKeys)){const lt=findSpring(it);_={..._,...lt,mass:1},_.isResolvedFromDuration=!0}return _}function spring({keyframes:it,restDelta:_,restSpeed:lt,...ft}){const mt=it[0],pt=it[it.length-1],gt={done:!1,value:mt},{stiffness:bt,damping:wt,mass:vt,duration:Ct,velocity:Rt,isResolvedFromDuration:Mt}=getSpringOptions({...ft,velocity:-millisecondsToSeconds(ft.velocity||0)}),Ot=Rt||0,Nt=wt/(2*Math.sqrt(bt*vt)),Ht=pt-mt,Kt=millisecondsToSeconds(Math.sqrt(bt/vt)),hr=Math.abs(Ht)<5;lt||(lt=hr?.01:2),_||(_=hr?.005:.5);let Qt;if(Nt<1){const mr=calcAngularFreq(Kt,Nt);Qt=br=>{const Fr=Math.exp(-Nt*Kt*br);return pt-Fr*((Ot+Nt*Kt*Ht)/mr*Math.sin(mr*br)+Ht*Math.cos(mr*br))}}else if(Nt===1)Qt=mr=>pt-Math.exp(-Kt*mr)*(Ht+(Ot+Kt*Ht)*mr);else{const mr=Kt*Math.sqrt(Nt*Nt-1);Qt=br=>{const Fr=Math.exp(-Nt*Kt*br),kr=Math.min(mr*br,300);return pt-Fr*((Ot+Nt*Kt*Ht)*Math.sinh(kr)+mr*Ht*Math.cosh(kr))/mr}}return{calculatedDuration:Mt&&Ct||null,next:mr=>{const br=Qt(mr);if(Mt)gt.done=mr>=Ct;else{let Fr=0;Nt<1&&(Fr=mr===0?secondsToMilliseconds(Ot):calcGeneratorVelocity(Qt,mr,br));const kr=Math.abs(Fr)<=lt,Br=Math.abs(pt-br)<=_;gt.done=kr&&Br}return gt.value=gt.done?pt:br,gt}}}function inertia({keyframes:it,velocity:_=0,power:lt=.8,timeConstant:ft=325,bounceDamping:mt=10,bounceStiffness:pt=500,modifyTarget:gt,min:bt,max:wt,restDelta:vt=.5,restSpeed:Ct}){const Rt=it[0],Mt={done:!1,value:Rt},Ot=Nr=>bt!==void 0&&Nr<bt||wt!==void 0&&Nr>wt,Nt=Nr=>bt===void 0?wt:wt===void 0||Math.abs(bt-Nr)<Math.abs(wt-Nr)?bt:wt;let Ht=lt*_;const Kt=Rt+Ht,hr=gt===void 0?Kt:gt(Kt);hr!==Kt&&(Ht=hr-Rt);const Qt=Nr=>-Ht*Math.exp(-Nr/ft),mr=Nr=>hr+Qt(Nr),br=Nr=>{const jn=Qt(Nr),Yn=mr(Nr);Mt.done=Math.abs(jn)<=vt,Mt.value=Mt.done?hr:Yn};let Fr,kr;const Br=Nr=>{Ot(Mt.value)&&(Fr=Nr,kr=spring({keyframes:[Mt.value,Nt(Mt.value)],velocity:calcGeneratorVelocity(mr,Nr,Mt.value),damping:mt,stiffness:pt,restDelta:vt,restSpeed:Ct}))};return Br(0),{calculatedDuration:null,next:Nr=>{let jn=!1;return!kr&&Fr===void 0&&(jn=!0,br(Nr),Br(Nr)),Fr!==void 0&&Nr>=Fr?kr.next(Nr-Fr):(!jn&&br(Nr),Mt)}}}const easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=it=>Array.isArray(it)&&typeof it[0]!="number",isBezierDefinition=it=>Array.isArray(it)&&typeof it[0]=="number",easingLookup={linear:noop$1,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},easingDefinitionToFunction=it=>{if(isBezierDefinition(it)){invariant(it.length===4);const[_,lt,ft,mt]=it;return cubicBezier(_,lt,ft,mt)}else if(typeof it=="string")return invariant(easingLookup[it]!==void 0),easingLookup[it];return it},combineFunctions=(it,_)=>lt=>_(it(lt)),pipe=(...it)=>it.reduce(combineFunctions),progress=(it,_,lt)=>{const ft=_-it;return ft===0?1:(lt-it)/ft},mixNumber$1=(it,_,lt)=>it+(_-it)*lt;function hueToRgb(it,_,lt){return lt<0&&(lt+=1),lt>1&&(lt-=1),lt<1/6?it+(_-it)*6*lt:lt<1/2?_:lt<2/3?it+(_-it)*(2/3-lt)*6:it}function hslaToRgba({hue:it,saturation:_,lightness:lt,alpha:ft}){it/=360,_/=100,lt/=100;let mt=0,pt=0,gt=0;if(!_)mt=pt=gt=lt;else{const bt=lt<.5?lt*(1+_):lt+_-lt*_,wt=2*lt-bt;mt=hueToRgb(wt,bt,it+1/3),pt=hueToRgb(wt,bt,it),gt=hueToRgb(wt,bt,it-1/3)}return{red:Math.round(mt*255),green:Math.round(pt*255),blue:Math.round(gt*255),alpha:ft}}function mixImmediate(it,_){return lt=>lt>0?_:it}const mixLinearColor=(it,_,lt)=>{const ft=it*it,mt=lt*(_*_-ft)+ft;return mt<0?0:Math.sqrt(mt)},colorTypes=[hex,rgba,hsla],getColorType=it=>colorTypes.find(_=>_.test(it));function asRGBA(it){const _=getColorType(it);if(!_)return!1;let lt=_.parse(it);return _===hsla&&(lt=hslaToRgba(lt)),lt}const mixColor=(it,_)=>{const lt=asRGBA(it),ft=asRGBA(_);if(!lt||!ft)return mixImmediate(it,_);const mt={...lt};return pt=>(mt.red=mixLinearColor(lt.red,ft.red,pt),mt.green=mixLinearColor(lt.green,ft.green,pt),mt.blue=mixLinearColor(lt.blue,ft.blue,pt),mt.alpha=mixNumber$1(lt.alpha,ft.alpha,pt),rgba.transform(mt))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(it,_){return invisibleValues.has(it)?lt=>lt<=0?it:_:lt=>lt>=1?_:it}function mixNumber(it,_){return lt=>mixNumber$1(it,_,lt)}function getMixer(it){return typeof it=="number"?mixNumber:typeof it=="string"?isCSSVariableToken(it)?mixImmediate:color.test(it)?mixColor:mixComplex:Array.isArray(it)?mixArray:typeof it=="object"?color.test(it)?mixColor:mixObject:mixImmediate}function mixArray(it,_){const lt=[...it],ft=lt.length,mt=it.map((pt,gt)=>getMixer(pt)(pt,_[gt]));return pt=>{for(let gt=0;gt<ft;gt++)lt[gt]=mt[gt](pt);return lt}}function mixObject(it,_){const lt={...it,..._},ft={};for(const mt in lt)it[mt]!==void 0&&_[mt]!==void 0&&(ft[mt]=getMixer(it[mt])(it[mt],_[mt]));return mt=>{for(const pt in ft)lt[pt]=ft[pt](mt);return lt}}function matchOrder(it,_){var lt;const ft=[],mt={color:0,var:0,number:0};for(let pt=0;pt<_.values.length;pt++){const gt=_.types[pt],bt=it.indexes[gt][mt[gt]],wt=(lt=it.values[bt])!==null&&lt!==void 0?lt:0;ft[pt]=wt,mt[gt]++}return ft}const mixComplex=(it,_)=>{const lt=complex.createTransformer(_),ft=analyseComplexValue(it),mt=analyseComplexValue(_);return ft.indexes.var.length===mt.indexes.var.length&&ft.indexes.color.length===mt.indexes.color.length&&ft.indexes.number.length>=mt.indexes.number.length?invisibleValues.has(it)&&!mt.values.length||invisibleValues.has(_)&&!ft.values.length?mixVisibility(it,_):pipe(mixArray(matchOrder(ft,mt),mt.values),lt):mixImmediate(it,_)};function mix(it,_,lt){return typeof it=="number"&&typeof _=="number"&&typeof lt=="number"?mixNumber$1(it,_,lt):getMixer(it)(it,_)}function createMixers(it,_,lt){const ft=[],mt=lt||mix,pt=it.length-1;for(let gt=0;gt<pt;gt++){let bt=mt(it[gt],it[gt+1]);if(_){const wt=Array.isArray(_)?_[gt]||noop$1:_;bt=pipe(wt,bt)}ft.push(bt)}return ft}function interpolate(it,_,{clamp:lt=!0,ease:ft,mixer:mt}={}){const pt=it.length;if(invariant(pt===_.length),pt===1)return()=>_[0];if(pt===2&&it[0]===it[1])return()=>_[1];it[0]>it[pt-1]&&(it=[...it].reverse(),_=[..._].reverse());const gt=createMixers(_,ft,mt),bt=gt.length,wt=vt=>{let Ct=0;if(bt>1)for(;Ct<it.length-2&&!(vt<it[Ct+1]);Ct++);const Rt=progress(it[Ct],it[Ct+1],vt);return gt[Ct](Rt)};return lt?vt=>wt(clamp$1(it[0],it[pt-1],vt)):wt}function fillOffset(it,_){const lt=it[it.length-1];for(let ft=1;ft<=_;ft++){const mt=progress(0,_,ft);it.push(mixNumber$1(lt,1,mt))}}function defaultOffset(it){const _=[0];return fillOffset(_,it.length-1),_}function convertOffsetToTimes(it,_){return it.map(lt=>lt*_)}function defaultEasing(it,_){return it.map(()=>_||easeInOut).splice(0,it.length-1)}function keyframes({duration:it=300,keyframes:_,times:lt,ease:ft="easeInOut"}){const mt=isEasingArray(ft)?ft.map(easingDefinitionToFunction):easingDefinitionToFunction(ft),pt={done:!1,value:_[0]},gt=convertOffsetToTimes(lt&&lt.length===_.length?lt:defaultOffset(_),it),bt=interpolate(gt,_,{ease:Array.isArray(mt)?mt:defaultEasing(_,mt)});return{calculatedDuration:it,next:wt=>(pt.value=bt(wt),pt.done=wt>=it,pt)}}const maxGeneratorDuration=2e4;function calcGeneratorDuration(it){let _=0;const lt=50;let ft=it.next(_);for(;!ft.done&&_<maxGeneratorDuration;)_+=lt,ft=it.next(_);return _>=maxGeneratorDuration?1/0:_}const frameloopDriver=it=>{const _=({timestamp:lt})=>it(lt);return{start:()=>frame.update(_,!0),stop:()=>cancelFrame(_),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generators={decay:inertia,inertia,tween:keyframes,keyframes,spring},percentToProgress=it=>it/100;class MainThreadAnimation extends BaseAnimation{constructor(_){super(_),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:wt}=this.options;wt&&wt()};const{name:lt,motionValue:ft,element:mt,keyframes:pt}=this.options,gt=(mt==null?void 0:mt.KeyframeResolver)||KeyframeResolver,bt=(wt,vt)=>this.onKeyframesResolved(wt,vt);this.resolver=new gt(pt,bt,lt,ft,mt),this.resolver.scheduleResolve()}initPlayback(_){const{type:lt="keyframes",repeat:ft=0,repeatDelay:mt=0,repeatType:pt,velocity:gt=0}=this.options,bt=isGenerator(lt)?lt:generators[lt]||keyframes;let wt,vt;bt!==keyframes&&typeof _[0]!="number"&&(wt=pipe(percentToProgress,mix(_[0],_[1])),_=[0,100]);const Ct=bt({...this.options,keyframes:_});pt==="mirror"&&(vt=bt({...this.options,keyframes:[..._].reverse(),velocity:-gt})),Ct.calculatedDuration===null&&(Ct.calculatedDuration=calcGeneratorDuration(Ct));const{calculatedDuration:Rt}=Ct,Mt=Rt+mt,Ot=Mt*(ft+1)-mt;return{generator:Ct,mirroredGenerator:vt,mapPercentToKeyframes:wt,calculatedDuration:Rt,resolvedDuration:Mt,totalDuration:Ot}}onPostResolved(){const{autoplay:_=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!_?this.pause():this.state=this.pendingPlayState}tick(_,lt=!1){const{resolved:ft}=this;if(!ft){const{keyframes:Nr}=this.options;return{done:!0,value:Nr[Nr.length-1]}}const{finalKeyframe:mt,generator:pt,mirroredGenerator:gt,mapPercentToKeyframes:bt,keyframes:wt,calculatedDuration:vt,totalDuration:Ct,resolvedDuration:Rt}=ft;if(this.startTime===null)return pt.next(0);const{delay:Mt,repeat:Ot,repeatType:Nt,repeatDelay:Ht,onUpdate:Kt}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,_):this.speed<0&&(this.startTime=Math.min(_-Ct/this.speed,this.startTime)),lt?this.currentTime=_:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(_-this.startTime)*this.speed;const hr=this.currentTime-Mt*(this.speed>=0?1:-1),Qt=this.speed>=0?hr<0:hr>Ct;this.currentTime=Math.max(hr,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=Ct);let mr=this.currentTime,br=pt;if(Ot){const Nr=Math.min(this.currentTime,Ct)/Rt;let jn=Math.floor(Nr),Yn=Nr%1;!Yn&&Nr>=1&&(Yn=1),Yn===1&&jn--,jn=Math.min(jn,Ot+1),!!(jn%2)&&(Nt==="reverse"?(Yn=1-Yn,Ht&&(Yn-=Ht/Rt)):Nt==="mirror"&&(br=gt)),mr=clamp$1(0,1,Yn)*Rt}const Fr=Qt?{done:!1,value:wt[0]}:br.next(mr);bt&&(Fr.value=bt(Fr.value));let{done:kr}=Fr;!Qt&&vt!==null&&(kr=this.speed>=0?this.currentTime>=Ct:this.currentTime<=0);const Br=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&kr);return Br&&mt!==void 0&&(Fr.value=getFinalKeyframe(wt,this.options,mt)),Kt&&Kt(Fr.value),Br&&this.finish(),Fr}get duration(){const{resolved:_}=this;return _?millisecondsToSeconds(_.calculatedDuration):0}get time(){return millisecondsToSeconds(this.currentTime)}set time(_){_=secondsToMilliseconds(_),this.currentTime=_,this.holdTime!==null||this.speed===0?this.holdTime=_:this.driver&&(this.startTime=this.driver.now()-_/this.speed)}get speed(){return this.playbackSpeed}set speed(_){const lt=this.playbackSpeed!==_;this.playbackSpeed=_,lt&&(this.time=millisecondsToSeconds(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:_=frameloopDriver,onPlay:lt,startTime:ft}=this.options;this.driver||(this.driver=_(pt=>this.tick(pt))),lt&&lt();const mt=this.driver.now();this.holdTime!==null?this.startTime=mt-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=mt):this.startTime=ft??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var _;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(_=this.currentTime)!==null&&_!==void 0?_:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:_}=this.options;_&&_()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(_){return this.startTime=0,this.tick(_,!0)}}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),resolution=10,generateLinearEasing=(it,_)=>{let lt="";const ft=Math.max(Math.round(_/resolution),2);for(let mt=0;mt<ft;mt++)lt+=it(progress(0,ft-1,mt))+", ";return`linear(${lt.substring(0,lt.length-2)})`};function memo(it){let _;return()=>(_===void 0&&(_=it()),_)}const supportsFlags={linearEasing:void 0};function memoSupports(it,_){const lt=memo(it);return()=>{var ft;return(ft=supportsFlags[_])!==null&&ft!==void 0?ft:lt()}}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing");function isWaapiSupportedEasing(it){return!!(typeof it=="function"&&supportsLinearEasing()||!it||typeof it=="string"&&(it in supportedWaapiEasing||supportsLinearEasing())||isBezierDefinition(it)||Array.isArray(it)&&it.every(isWaapiSupportedEasing))}const cubicBezierAsString=([it,_,lt,ft])=>`cubic-bezier(${it}, ${_}, ${lt}, ${ft})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(it,_){if(it)return typeof it=="function"&&supportsLinearEasing()?generateLinearEasing(it,_):isBezierDefinition(it)?cubicBezierAsString(it):Array.isArray(it)?it.map(lt=>mapEasingToNativeEasing(lt,_)||supportedWaapiEasing.easeOut):supportedWaapiEasing[it]}function startWaapiAnimation(it,_,lt,{delay:ft=0,duration:mt=300,repeat:pt=0,repeatType:gt="loop",ease:bt,times:wt}={}){const vt={[_]:lt};wt&&(vt.offset=wt);const Ct=mapEasingToNativeEasing(bt,mt);return Array.isArray(Ct)&&(vt.easing=Ct),it.animate(vt,{delay:ft,duration:mt,easing:Array.isArray(Ct)?"linear":Ct,fill:"both",iterations:pt+1,direction:gt==="reverse"?"alternate":"normal"})}function attachTimeline(it,_){it.timeline=_,it.onfinish=null}const supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),sampleDelta=10,maxDuration=2e4;function requiresPregeneratedKeyframes(it){return isGenerator(it.type)||it.type==="spring"||!isWaapiSupportedEasing(it.ease)}function pregenerateKeyframes(it,_){const lt=new MainThreadAnimation({..._,keyframes:it,repeat:0,delay:0,isGenerator:!0});let ft={done:!1,value:it[0]};const mt=[];let pt=0;for(;!ft.done&&pt<maxDuration;)ft=lt.sample(pt),mt.push(ft.value),pt+=sampleDelta;return{times:void 0,keyframes:mt,duration:pt-sampleDelta,ease:"linear"}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(it){return it in unsupportedEasingFunctions}class AcceleratedAnimation extends BaseAnimation{constructor(_){super(_);const{name:lt,motionValue:ft,element:mt,keyframes:pt}=this.options;this.resolver=new DOMKeyframesResolver(pt,(gt,bt)=>this.onKeyframesResolved(gt,bt),lt,ft,mt),this.resolver.scheduleResolve()}initPlayback(_,lt){var ft;let{duration:mt=300,times:pt,ease:gt,type:bt,motionValue:wt,name:vt,startTime:Ct}=this.options;if(!(!((ft=wt.owner)===null||ft===void 0)&&ft.current))return!1;if(typeof gt=="string"&&supportsLinearEasing()&&isUnsupportedEase(gt)&&(gt=unsupportedEasingFunctions[gt]),requiresPregeneratedKeyframes(this.options)){const{onComplete:Mt,onUpdate:Ot,motionValue:Nt,element:Ht,...Kt}=this.options,hr=pregenerateKeyframes(_,Kt);_=hr.keyframes,_.length===1&&(_[1]=_[0]),mt=hr.duration,pt=hr.times,gt=hr.ease,bt="keyframes"}const Rt=startWaapiAnimation(wt.owner.current,vt,_,{...this.options,duration:mt,times:pt,ease:gt});return Rt.startTime=Ct??this.calcStartTime(),this.pendingTimeline?(attachTimeline(Rt,this.pendingTimeline),this.pendingTimeline=void 0):Rt.onfinish=()=>{const{onComplete:Mt}=this.options;wt.set(getFinalKeyframe(_,this.options,lt)),Mt&&Mt(),this.cancel(),this.resolveFinishedPromise()},{animation:Rt,duration:mt,times:pt,type:bt,ease:gt,keyframes:_}}get duration(){const{resolved:_}=this;if(!_)return 0;const{duration:lt}=_;return millisecondsToSeconds(lt)}get time(){const{resolved:_}=this;if(!_)return 0;const{animation:lt}=_;return millisecondsToSeconds(lt.currentTime||0)}set time(_){const{resolved:lt}=this;if(!lt)return;const{animation:ft}=lt;ft.currentTime=secondsToMilliseconds(_)}get speed(){const{resolved:_}=this;if(!_)return 1;const{animation:lt}=_;return lt.playbackRate}set speed(_){const{resolved:lt}=this;if(!lt)return;const{animation:ft}=lt;ft.playbackRate=_}get state(){const{resolved:_}=this;if(!_)return"idle";const{animation:lt}=_;return lt.playState}get startTime(){const{resolved:_}=this;if(!_)return null;const{animation:lt}=_;return lt.startTime}attachTimeline(_){if(!this._resolved)this.pendingTimeline=_;else{const{resolved:lt}=this;if(!lt)return noop$1;const{animation:ft}=lt;attachTimeline(ft,_)}return noop$1}play(){if(this.isStopped)return;const{resolved:_}=this;if(!_)return;const{animation:lt}=_;lt.playState==="finished"&&this.updateFinishedPromise(),lt.play()}pause(){const{resolved:_}=this;if(!_)return;const{animation:lt}=_;lt.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:_}=this;if(!_)return;const{animation:lt,keyframes:ft,duration:mt,type:pt,ease:gt,times:bt}=_;if(lt.playState==="idle"||lt.playState==="finished")return;if(this.time){const{motionValue:vt,onUpdate:Ct,onComplete:Rt,element:Mt,...Ot}=this.options,Nt=new MainThreadAnimation({...Ot,keyframes:ft,duration:mt,type:pt,ease:gt,times:bt,isGenerator:!0}),Ht=secondsToMilliseconds(this.time);vt.setWithVelocity(Nt.sample(Ht-sampleDelta).value,Nt.sample(Ht).value,sampleDelta)}const{onStop:wt}=this.options;wt&&wt(),this.cancel()}complete(){const{resolved:_}=this;_&&_.animation.finish()}cancel(){const{resolved:_}=this;_&&_.animation.cancel()}static supports(_){const{motionValue:lt,name:ft,repeatDelay:mt,repeatType:pt,damping:gt,type:bt}=_;return supportsWaapi()&&ft&&acceleratedValues.has(ft)&&lt&&lt.owner&&lt.owner.current instanceof HTMLElement&&!lt.owner.getProps().onUpdate&&!mt&&pt!=="mirror"&&gt!==0&&bt!=="inertia"}}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0);class GroupPlaybackControls{constructor(_){this.stop=()=>this.runAll("stop"),this.animations=_.filter(Boolean)}then(_,lt){return Promise.all(this.animations).then(_).catch(lt)}getAll(_){return this.animations[0][_]}setAll(_,lt){for(let ft=0;ft<this.animations.length;ft++)this.animations[ft][_]=lt}attachTimeline(_,lt){const ft=this.animations.map(mt=>supportsScrollTimeline()&&mt.attachTimeline?mt.attachTimeline(_):lt(mt));return()=>{ft.forEach((mt,pt)=>{mt&&mt(),this.animations[pt].stop()})}}get time(){return this.getAll("time")}set time(_){this.setAll("time",_)}get speed(){return this.getAll("speed")}set speed(_){this.setAll("speed",_)}get startTime(){return this.getAll("startTime")}get duration(){let _=0;for(let lt=0;lt<this.animations.length;lt++)_=Math.max(_,this.animations[lt].duration);return _}runAll(_){this.animations.forEach(lt=>lt[_]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function isTransitionDefined({when:it,delay:_,delayChildren:lt,staggerChildren:ft,staggerDirection:mt,repeat:pt,repeatType:gt,repeatDelay:bt,from:wt,elapsed:vt,...Ct}){return!!Object.keys(Ct).length}const animateMotionValue=(it,_,lt,ft={},mt,pt)=>gt=>{const bt=getValueTransition(ft,it)||{},wt=bt.delay||ft.delay||0;let{elapsed:vt=0}=ft;vt=vt-secondsToMilliseconds(wt);let Ct={keyframes:Array.isArray(lt)?lt:[null,lt],ease:"easeOut",velocity:_.getVelocity(),...bt,delay:-vt,onUpdate:Mt=>{_.set(Mt),bt.onUpdate&&bt.onUpdate(Mt)},onComplete:()=>{gt(),bt.onComplete&&bt.onComplete()},name:it,motionValue:_,element:pt?void 0:mt};isTransitionDefined(bt)||(Ct={...Ct,...getDefaultTransition(it,Ct)}),Ct.duration&&(Ct.duration=secondsToMilliseconds(Ct.duration)),Ct.repeatDelay&&(Ct.repeatDelay=secondsToMilliseconds(Ct.repeatDelay)),Ct.from!==void 0&&(Ct.keyframes[0]=Ct.from);let Rt=!1;if((Ct.type===!1||Ct.duration===0&&!Ct.repeatDelay)&&(Ct.duration=0,Ct.delay===0&&(Rt=!0)),Rt&&!pt&&_.get()!==void 0){const Mt=getFinalKeyframe(Ct.keyframes,bt);if(Mt!==void 0)return frame.update(()=>{Ct.onUpdate(Mt),Ct.onComplete()}),new GroupPlaybackControls([])}return!pt&&AcceleratedAnimation.supports(Ct)?new AcceleratedAnimation(Ct):new MainThreadAnimation(Ct)},isCustomValue=it=>!!(it&&typeof it=="object"&&it.mix&&it.toValue),resolveFinalValueInKeyframes=it=>isKeyframesTarget(it)?it[it.length-1]||0:it;function addUniqueItem(it,_){it.indexOf(_)===-1&&it.push(_)}function removeItem(it,_){const lt=it.indexOf(_);lt>-1&&it.splice(lt,1)}class SubscriptionManager{constructor(){this.subscriptions=[]}add(_){return addUniqueItem(this.subscriptions,_),()=>removeItem(this.subscriptions,_)}notify(_,lt,ft){const mt=this.subscriptions.length;if(mt)if(mt===1)this.subscriptions[0](_,lt,ft);else for(let pt=0;pt<mt;pt++){const gt=this.subscriptions[pt];gt&&gt(_,lt,ft)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const MAX_VELOCITY_DELTA=30,isFloat=it=>!isNaN(parseFloat(it));class MotionValue{constructor(_,lt={}){this.version="11.11.11",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(ft,mt=!0)=>{const pt=time.now();this.updatedAt!==pt&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(ft),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),mt&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(_),this.owner=lt.owner}setCurrent(_){this.current=_,this.updatedAt=time.now(),this.canTrackVelocity===null&&_!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(_=this.current){this.prevFrameValue=_,this.prevUpdatedAt=this.updatedAt}onChange(_){return this.on("change",_)}on(_,lt){this.events[_]||(this.events[_]=new SubscriptionManager);const ft=this.events[_].add(lt);return _==="change"?()=>{ft(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:ft}clearListeners(){for(const _ in this.events)this.events[_].clear()}attach(_,lt){this.passiveEffect=_,this.stopPassiveEffect=lt}set(_,lt=!0){!lt||!this.passiveEffect?this.updateAndNotify(_,lt):this.passiveEffect(_,this.updateAndNotify)}setWithVelocity(_,lt,ft){this.set(lt),this.prev=void 0,this.prevFrameValue=_,this.prevUpdatedAt=this.updatedAt-ft}jump(_,lt=!0){this.updateAndNotify(_),this.prev=_,this.prevUpdatedAt=this.prevFrameValue=void 0,lt&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const _=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||_-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const lt=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),lt)}start(_){return this.stop(),new Promise(lt=>{this.hasAnimated=!0,this.animation=_(lt),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(it,_){return new MotionValue(it,_)}function setMotionValue(it,_,lt){it.hasValue(_)?it.getValue(_).set(lt):it.addValue(_,motionValue(lt))}function setTarget(it,_){const lt=resolveVariant(it,_);let{transitionEnd:ft={},transition:mt={},...pt}=lt||{};pt={...pt,...ft};for(const gt in pt){const bt=resolveFinalValueInKeyframes(pt[gt]);setMotionValue(it,gt,bt)}}const camelToDash=it=>it.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId);function getOptimisedAppearId(it){return it.props[optimizedAppearDataAttribute]}const isMotionValue=it=>!!(it&&it.getVelocity);function isWillChangeMotionValue(it){return!!(isMotionValue(it)&&it.add)}function addValueToWillChange(it,_){const lt=it.getValue("willChange");if(isWillChangeMotionValue(lt))return lt.add(_)}function shouldBlockAnimation({protectedKeys:it,needsAnimating:_},lt){const ft=it.hasOwnProperty(lt)&&_[lt]!==!0;return _[lt]=!1,ft}function animateTarget(it,_,{delay:lt=0,transitionOverride:ft,type:mt}={}){var pt;let{transition:gt=it.getDefaultTransition(),transitionEnd:bt,...wt}=_;ft&&(gt=ft);const vt=[],Ct=mt&&it.animationState&&it.animationState.getState()[mt];for(const Rt in wt){const Mt=it.getValue(Rt,(pt=it.latestValues[Rt])!==null&&pt!==void 0?pt:null),Ot=wt[Rt];if(Ot===void 0||Ct&&shouldBlockAnimation(Ct,Rt))continue;const Nt={delay:lt,...getValueTransition(gt||{},Rt)};let Ht=!1;if(window.MotionHandoffAnimation){const hr=getOptimisedAppearId(it);if(hr){const Qt=window.MotionHandoffAnimation(hr,Rt,frame);Qt!==null&&(Nt.startTime=Qt,Ht=!0)}}addValueToWillChange(it,Rt),Mt.start(animateMotionValue(Rt,Mt,Ot,it.shouldReduceMotion&&transformProps.has(Rt)?{type:!1}:Nt,it,Ht));const Kt=Mt.animation;Kt&&vt.push(Kt)}return bt&&Promise.all(vt).then(()=>{frame.update(()=>{bt&&setTarget(it,bt)})}),vt}function animateVariant(it,_,lt={}){var ft;const mt=resolveVariant(it,_,lt.type==="exit"?(ft=it.presenceContext)===null||ft===void 0?void 0:ft.custom:void 0);let{transition:pt=it.getDefaultTransition()||{}}=mt||{};lt.transitionOverride&&(pt=lt.transitionOverride);const gt=mt?()=>Promise.all(animateTarget(it,mt,lt)):()=>Promise.resolve(),bt=it.variantChildren&&it.variantChildren.size?(vt=0)=>{const{delayChildren:Ct=0,staggerChildren:Rt,staggerDirection:Mt}=pt;return animateChildren(it,_,Ct+vt,Rt,Mt,lt)}:()=>Promise.resolve(),{when:wt}=pt;if(wt){const[vt,Ct]=wt==="beforeChildren"?[gt,bt]:[bt,gt];return vt().then(()=>Ct())}else return Promise.all([gt(),bt(lt.delay)])}function animateChildren(it,_,lt=0,ft=0,mt=1,pt){const gt=[],bt=(it.variantChildren.size-1)*ft,wt=mt===1?(vt=0)=>vt*ft:(vt=0)=>bt-vt*ft;return Array.from(it.variantChildren).sort(sortByTreeOrder).forEach((vt,Ct)=>{vt.notify("AnimationStart",_),gt.push(animateVariant(vt,_,{...pt,delay:lt+wt(Ct)}).then(()=>vt.notify("AnimationComplete",_)))}),Promise.all(gt)}function sortByTreeOrder(it,_){return it.sortNodePosition(_)}function animateVisualElement(it,_,lt={}){it.notify("AnimationStart",_);let ft;if(Array.isArray(_)){const mt=_.map(pt=>animateVariant(it,pt,lt));ft=Promise.all(mt)}else if(typeof _=="string")ft=animateVariant(it,_,lt);else{const mt=typeof _=="function"?resolveVariant(it,_,lt.custom):_;ft=Promise.all(animateTarget(it,mt,lt))}return ft.then(()=>{it.notify("AnimationComplete",_)})}const numVariantProps=variantProps.length;function getVariantContext(it){if(!it)return;if(!it.isControllingVariants){const lt=it.parent?getVariantContext(it.parent)||{}:{};return it.props.initial!==void 0&&(lt.initial=it.props.initial),lt}const _={};for(let lt=0;lt<numVariantProps;lt++){const ft=variantProps[lt],mt=it.props[ft];(isVariantLabel(mt)||mt===!1)&&(_[ft]=mt)}return _}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(it){return _=>Promise.all(_.map(({animation:lt,options:ft})=>animateVisualElement(it,lt,ft)))}function createAnimationState(it){let _=animateList(it),lt=createState(),ft=!0;const mt=wt=>(vt,Ct)=>{var Rt;const Mt=resolveVariant(it,Ct,wt==="exit"?(Rt=it.presenceContext)===null||Rt===void 0?void 0:Rt.custom:void 0);if(Mt){const{transition:Ot,transitionEnd:Nt,...Ht}=Mt;vt={...vt,...Ht,...Nt}}return vt};function pt(wt){_=wt(it)}function gt(wt){const{props:vt}=it,Ct=getVariantContext(it.parent)||{},Rt=[],Mt=new Set;let Ot={},Nt=1/0;for(let Kt=0;Kt<numAnimationTypes;Kt++){const hr=reversePriorityOrder[Kt],Qt=lt[hr],mr=vt[hr]!==void 0?vt[hr]:Ct[hr],br=isVariantLabel(mr),Fr=hr===wt?Qt.isActive:null;Fr===!1&&(Nt=Kt);let kr=mr===Ct[hr]&&mr!==vt[hr]&&br;if(kr&&ft&&it.manuallyAnimateOnMount&&(kr=!1),Qt.protectedKeys={...Ot},!Qt.isActive&&Fr===null||!mr&&!Qt.prevProp||isAnimationControls(mr)||typeof mr=="boolean")continue;const Br=checkVariantsDidChange(Qt.prevProp,mr);let Nr=Br||hr===wt&&Qt.isActive&&!kr&&br||Kt>Nt&&br,jn=!1;const Yn=Array.isArray(mr)?mr:[mr];let ga=Yn.reduce(mt(hr),{});Fr===!1&&(ga={});const{prevResolvedValues:Kn={}}=Qt,Xn={...Kn,...ga},eo=ro=>{Nr=!0,Mt.has(ro)&&(jn=!0,Mt.delete(ro)),Qt.needsAnimating[ro]=!0;const bs=it.getValue(ro);bs&&(bs.liveStyle=!1)};for(const ro in Xn){const bs=ga[ro],ba=Kn[ro];if(Ot.hasOwnProperty(ro))continue;let Zn=!1;isKeyframesTarget(bs)&&isKeyframesTarget(ba)?Zn=!shallowCompare(bs,ba):Zn=bs!==ba,Zn?bs!=null?eo(ro):Mt.add(ro):bs!==void 0&&Mt.has(ro)?eo(ro):Qt.protectedKeys[ro]=!0}Qt.prevProp=mr,Qt.prevResolvedValues=ga,Qt.isActive&&(Ot={...Ot,...ga}),ft&&it.blockInitialAnimation&&(Nr=!1),Nr&&(!(kr&&Br)||jn)&&Rt.push(...Yn.map(ro=>({animation:ro,options:{type:hr}})))}if(Mt.size){const Kt={};Mt.forEach(hr=>{const Qt=it.getBaseTarget(hr),mr=it.getValue(hr);mr&&(mr.liveStyle=!0),Kt[hr]=Qt??null}),Rt.push({animation:Kt})}let Ht=!!Rt.length;return ft&&(vt.initial===!1||vt.initial===vt.animate)&&!it.manuallyAnimateOnMount&&(Ht=!1),ft=!1,Ht?_(Rt):Promise.resolve()}function bt(wt,vt){var Ct;if(lt[wt].isActive===vt)return Promise.resolve();(Ct=it.variantChildren)===null||Ct===void 0||Ct.forEach(Mt=>{var Ot;return(Ot=Mt.animationState)===null||Ot===void 0?void 0:Ot.setActive(wt,vt)}),lt[wt].isActive=vt;const Rt=gt(wt);for(const Mt in lt)lt[Mt].protectedKeys={};return Rt}return{animateChanges:gt,setActive:bt,setAnimateFunction:pt,getState:()=>lt,reset:()=>{lt=createState(),ft=!0}}}function checkVariantsDidChange(it,_){return typeof _=="string"?_!==it:Array.isArray(_)?!shallowCompare(_,it):!1}function createTypeState(it=!1){return{isActive:it,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class Feature{constructor(_){this.isMounted=!1,this.node=_}update(){}}class AnimationFeature extends Feature{constructor(_){super(_),_.animationState||(_.animationState=createAnimationState(_))}updateAnimationControlsSubscription(){const{animate:_}=this.node.getProps();isAnimationControls(_)&&(this.unmountControls=_.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:_}=this.node.getProps(),{animate:lt}=this.node.prevProps||{};_!==lt&&this.updateAnimationControlsSubscription()}unmount(){var _;this.node.animationState.reset(),(_=this.unmountControls)===null||_===void 0||_.call(this)}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:_,onExitComplete:lt}=this.node.presenceContext,{isPresent:ft}=this.node.prevPresenceContext||{};if(!this.node.animationState||_===ft)return;const mt=this.node.animationState.setActive("exit",!_);lt&&!_&&mt.then(()=>lt(this.id))}mount(){const{register:_}=this.node.presenceContext||{};_&&(this.unmount=_(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}},isPrimaryPointer=it=>it.pointerType==="mouse"?typeof it.button!="number"||it.button<=0:it.isPrimary!==!1;function extractEventInfo(it,_="page"){return{point:{x:it[`${_}X`],y:it[`${_}Y`]}}}const addPointerInfo=it=>_=>isPrimaryPointer(_)&&it(_,extractEventInfo(_));function addDomEvent(it,_,lt,ft={passive:!0}){return it.addEventListener(_,lt,ft),()=>it.removeEventListener(_,lt)}function addPointerEvent(it,_,lt,ft){return addDomEvent(it,_,addPointerInfo(lt),ft)}const distance=(it,_)=>Math.abs(it-_);function distance2D(it,_){const lt=distance(it.x,_.x),ft=distance(it.y,_.y);return Math.sqrt(lt**2+ft**2)}class PanSession{constructor(_,lt,{transformPagePoint:ft,contextWindow:mt,dragSnapToOrigin:pt=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Rt=getPanInfo(this.lastMoveEventInfo,this.history),Mt=this.startEvent!==null,Ot=distance2D(Rt.offset,{x:0,y:0})>=3;if(!Mt&&!Ot)return;const{point:Nt}=Rt,{timestamp:Ht}=frameData;this.history.push({...Nt,timestamp:Ht});const{onStart:Kt,onMove:hr}=this.handlers;Mt||(Kt&&Kt(this.lastMoveEvent,Rt),this.startEvent=this.lastMoveEvent),hr&&hr(this.lastMoveEvent,Rt)},this.handlePointerMove=(Rt,Mt)=>{this.lastMoveEvent=Rt,this.lastMoveEventInfo=transformPoint(Mt,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(Rt,Mt)=>{this.end();const{onEnd:Ot,onSessionEnd:Nt,resumeAnimation:Ht}=this.handlers;if(this.dragSnapToOrigin&&Ht&&Ht(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Kt=getPanInfo(Rt.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(Mt,this.transformPagePoint),this.history);this.startEvent&&Ot&&Ot(Rt,Kt),Nt&&Nt(Rt,Kt)},!isPrimaryPointer(_))return;this.dragSnapToOrigin=pt,this.handlers=lt,this.transformPagePoint=ft,this.contextWindow=mt||window;const gt=extractEventInfo(_),bt=transformPoint(gt,this.transformPagePoint),{point:wt}=bt,{timestamp:vt}=frameData;this.history=[{...wt,timestamp:vt}];const{onSessionStart:Ct}=lt;Ct&&Ct(_,getPanInfo(bt,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(_){this.handlers=_}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(it,_){return _?{point:_(it.point)}:it}function subtractPoint(it,_){return{x:it.x-_.x,y:it.y-_.y}}function getPanInfo({point:it},_){return{point:it,delta:subtractPoint(it,lastDevicePoint(_)),offset:subtractPoint(it,startDevicePoint(_)),velocity:getVelocity(_,.1)}}function startDevicePoint(it){return it[0]}function lastDevicePoint(it){return it[it.length-1]}function getVelocity(it,_){if(it.length<2)return{x:0,y:0};let lt=it.length-1,ft=null;const mt=lastDevicePoint(it);for(;lt>=0&&(ft=it[lt],!(mt.timestamp-ft.timestamp>secondsToMilliseconds(_)));)lt--;if(!ft)return{x:0,y:0};const pt=millisecondsToSeconds(mt.timestamp-ft.timestamp);if(pt===0)return{x:0,y:0};const gt={x:(mt.x-ft.x)/pt,y:(mt.y-ft.y)/pt};return gt.x===1/0&&(gt.x=0),gt.y===1/0&&(gt.y=0),gt}function createLock(it){let _=null;return()=>{const lt=()=>{_=null};return _===null?(_=it,lt):!1}}const globalHorizontalLock=createLock("dragHorizontal"),globalVerticalLock=createLock("dragVertical");function getGlobalLock(it){let _=!1;if(it==="y")_=globalVerticalLock();else if(it==="x")_=globalHorizontalLock();else{const lt=globalHorizontalLock(),ft=globalVerticalLock();lt&&ft?_=()=>{lt(),ft()}:(lt&&lt(),ft&&ft())}return _}function isDragActive(){const it=getGlobalLock(!0);return it?(it(),!1):!0}function isRefObject(it){return it&&typeof it=="object"&&Object.prototype.hasOwnProperty.call(it,"current")}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(it){return it.max-it.min}function isNear(it,_,lt){return Math.abs(it-_)<=lt}function calcAxisDelta(it,_,lt,ft=.5){it.origin=ft,it.originPoint=mixNumber$1(_.min,_.max,it.origin),it.scale=calcLength(lt)/calcLength(_),it.translate=mixNumber$1(lt.min,lt.max,it.origin)-it.originPoint,(it.scale>=SCALE_MIN&&it.scale<=SCALE_MAX||isNaN(it.scale))&&(it.scale=1),(it.translate>=TRANSLATE_MIN&&it.translate<=TRANSLATE_MAX||isNaN(it.translate))&&(it.translate=0)}function calcBoxDelta(it,_,lt,ft){calcAxisDelta(it.x,_.x,lt.x,ft?ft.originX:void 0),calcAxisDelta(it.y,_.y,lt.y,ft?ft.originY:void 0)}function calcRelativeAxis(it,_,lt){it.min=lt.min+_.min,it.max=it.min+calcLength(_)}function calcRelativeBox(it,_,lt){calcRelativeAxis(it.x,_.x,lt.x),calcRelativeAxis(it.y,_.y,lt.y)}function calcRelativeAxisPosition(it,_,lt){it.min=_.min-lt.min,it.max=it.min+calcLength(_)}function calcRelativePosition(it,_,lt){calcRelativeAxisPosition(it.x,_.x,lt.x),calcRelativeAxisPosition(it.y,_.y,lt.y)}function applyConstraints(it,{min:_,max:lt},ft){return _!==void 0&&it<_?it=ft?mixNumber$1(_,it,ft.min):Math.max(it,_):lt!==void 0&&it>lt&&(it=ft?mixNumber$1(lt,it,ft.max):Math.min(it,lt)),it}function calcRelativeAxisConstraints(it,_,lt){return{min:_!==void 0?it.min+_:void 0,max:lt!==void 0?it.max+lt-(it.max-it.min):void 0}}function calcRelativeConstraints(it,{top:_,left:lt,bottom:ft,right:mt}){return{x:calcRelativeAxisConstraints(it.x,lt,mt),y:calcRelativeAxisConstraints(it.y,_,ft)}}function calcViewportAxisConstraints(it,_){let lt=_.min-it.min,ft=_.max-it.max;return _.max-_.min<it.max-it.min&&([lt,ft]=[ft,lt]),{min:lt,max:ft}}function calcViewportConstraints(it,_){return{x:calcViewportAxisConstraints(it.x,_.x),y:calcViewportAxisConstraints(it.y,_.y)}}function calcOrigin$1(it,_){let lt=.5;const ft=calcLength(it),mt=calcLength(_);return mt>ft?lt=progress(_.min,_.max-ft,it.min):ft>mt&&(lt=progress(it.min,it.max-mt,_.min)),clamp$1(0,1,lt)}function rebaseAxisConstraints(it,_){const lt={};return _.min!==void 0&&(lt.min=_.min-it.min),_.max!==void 0&&(lt.max=_.max-it.min),lt}const defaultElastic=.35;function resolveDragElastic(it=defaultElastic){return it===!1?it=0:it===!0&&(it=defaultElastic),{x:resolveAxisElastic(it,"left","right"),y:resolveAxisElastic(it,"top","bottom")}}function resolveAxisElastic(it,_,lt){return{min:resolvePointElastic(it,_),max:resolvePointElastic(it,lt)}}function resolvePointElastic(it,_){return typeof it=="number"?it:it[_]||0}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()});function eachAxis(it){return[it("x"),it("y")]}function convertBoundingBoxToBox({top:it,left:_,right:lt,bottom:ft}){return{x:{min:_,max:lt},y:{min:it,max:ft}}}function convertBoxToBoundingBox({x:it,y:_}){return{top:_.min,right:it.max,bottom:_.max,left:it.min}}function transformBoxPoints(it,_){if(!_)return it;const lt=_({x:it.left,y:it.top}),ft=_({x:it.right,y:it.bottom});return{top:lt.y,left:lt.x,bottom:ft.y,right:ft.x}}function isIdentityScale(it){return it===void 0||it===1}function hasScale({scale:it,scaleX:_,scaleY:lt}){return!isIdentityScale(it)||!isIdentityScale(_)||!isIdentityScale(lt)}function hasTransform(it){return hasScale(it)||has2DTranslate(it)||it.z||it.rotate||it.rotateX||it.rotateY||it.skewX||it.skewY}function has2DTranslate(it){return is2DTranslate(it.x)||is2DTranslate(it.y)}function is2DTranslate(it){return it&&it!=="0%"}function scalePoint(it,_,lt){const ft=it-lt,mt=_*ft;return lt+mt}function applyPointDelta(it,_,lt,ft,mt){return mt!==void 0&&(it=scalePoint(it,mt,ft)),scalePoint(it,lt,ft)+_}function applyAxisDelta(it,_=0,lt=1,ft,mt){it.min=applyPointDelta(it.min,_,lt,ft,mt),it.max=applyPointDelta(it.max,_,lt,ft,mt)}function applyBoxDelta(it,{x:_,y:lt}){applyAxisDelta(it.x,_.translate,_.scale,_.originPoint),applyAxisDelta(it.y,lt.translate,lt.scale,lt.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(it,_,lt,ft=!1){const mt=lt.length;if(!mt)return;_.x=_.y=1;let pt,gt;for(let bt=0;bt<mt;bt++){pt=lt[bt],gt=pt.projectionDelta;const{visualElement:wt}=pt.options;wt&&wt.props.style&&wt.props.style.display==="contents"||(ft&&pt.options.layoutScroll&&pt.scroll&&pt!==pt.root&&transformBox(it,{x:-pt.scroll.offset.x,y:-pt.scroll.offset.y}),gt&&(_.x*=gt.x.scale,_.y*=gt.y.scale,applyBoxDelta(it,gt)),ft&&hasTransform(pt.latestValues)&&transformBox(it,pt.latestValues))}_.x<TREE_SCALE_SNAP_MAX&&_.x>TREE_SCALE_SNAP_MIN&&(_.x=1),_.y<TREE_SCALE_SNAP_MAX&&_.y>TREE_SCALE_SNAP_MIN&&(_.y=1)}function translateAxis(it,_){it.min=it.min+_,it.max=it.max+_}function transformAxis(it,_,lt,ft,mt=.5){const pt=mixNumber$1(it.min,it.max,mt);applyAxisDelta(it,_,lt,pt,ft)}function transformBox(it,_){transformAxis(it.x,_.x,_.scaleX,_.scale,_.originX),transformAxis(it.y,_.y,_.scaleY,_.scale,_.originY)}function measureViewportBox(it,_){return convertBoundingBoxToBox(transformBoxPoints(it.getBoundingClientRect(),_))}function measurePageBox(it,_,lt){const ft=measureViewportBox(it,lt),{scroll:mt}=_;return mt&&(translateAxis(ft.x,mt.offset.x),translateAxis(ft.y,mt.offset.y)),ft}const getContextWindow=({current:it})=>it?it.ownerDocument.defaultView:null,elementDragControls=new WeakMap;class VisualElementDragControls{constructor(_){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.visualElement=_}start(_,{snapToCursor:lt=!1}={}){const{presenceContext:ft}=this.visualElement;if(ft&&ft.isPresent===!1)return;const mt=Ct=>{const{dragSnapToOrigin:Rt}=this.getProps();Rt?this.pauseAnimation():this.stopAnimation(),lt&&this.snapToCursor(extractEventInfo(Ct,"page").point)},pt=(Ct,Rt)=>{const{drag:Mt,dragPropagation:Ot,onDragStart:Nt}=this.getProps();if(Mt&&!Ot&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=getGlobalLock(Mt),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(Kt=>{let hr=this.getAxisMotionValue(Kt).get()||0;if(percent.test(hr)){const{projection:Qt}=this.visualElement;if(Qt&&Qt.layout){const mr=Qt.layout.layoutBox[Kt];mr&&(hr=calcLength(mr)*(parseFloat(hr)/100))}}this.originPoint[Kt]=hr}),Nt&&frame.postRender(()=>Nt(Ct,Rt)),addValueToWillChange(this.visualElement,"transform");const{animationState:Ht}=this.visualElement;Ht&&Ht.setActive("whileDrag",!0)},gt=(Ct,Rt)=>{const{dragPropagation:Mt,dragDirectionLock:Ot,onDirectionLock:Nt,onDrag:Ht}=this.getProps();if(!Mt&&!this.openGlobalLock)return;const{offset:Kt}=Rt;if(Ot&&this.currentDirection===null){this.currentDirection=getCurrentDirection(Kt),this.currentDirection!==null&&Nt&&Nt(this.currentDirection);return}this.updateAxis("x",Rt.point,Kt),this.updateAxis("y",Rt.point,Kt),this.visualElement.render(),Ht&&Ht(Ct,Rt)},bt=(Ct,Rt)=>this.stop(Ct,Rt),wt=()=>eachAxis(Ct=>{var Rt;return this.getAnimationState(Ct)==="paused"&&((Rt=this.getAxisMotionValue(Ct).animation)===null||Rt===void 0?void 0:Rt.play())}),{dragSnapToOrigin:vt}=this.getProps();this.panSession=new PanSession(_,{onSessionStart:mt,onStart:pt,onMove:gt,onSessionEnd:bt,resumeAnimation:wt},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:vt,contextWindow:getContextWindow(this.visualElement)})}stop(_,lt){const ft=this.isDragging;if(this.cancel(),!ft)return;const{velocity:mt}=lt;this.startAnimation(mt);const{onDragEnd:pt}=this.getProps();pt&&frame.postRender(()=>pt(_,lt))}cancel(){this.isDragging=!1;const{projection:_,animationState:lt}=this.visualElement;_&&(_.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:ft}=this.getProps();!ft&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),lt&&lt.setActive("whileDrag",!1)}updateAxis(_,lt,ft){const{drag:mt}=this.getProps();if(!ft||!shouldDrag(_,mt,this.currentDirection))return;const pt=this.getAxisMotionValue(_);let gt=this.originPoint[_]+ft[_];this.constraints&&this.constraints[_]&&(gt=applyConstraints(gt,this.constraints[_],this.elastic[_])),pt.set(gt)}resolveConstraints(){var _;const{dragConstraints:lt,dragElastic:ft}=this.getProps(),mt=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(_=this.visualElement.projection)===null||_===void 0?void 0:_.layout,pt=this.constraints;lt&&isRefObject(lt)?this.constraints||(this.constraints=this.resolveRefConstraints()):lt&&mt?this.constraints=calcRelativeConstraints(mt.layoutBox,lt):this.constraints=!1,this.elastic=resolveDragElastic(ft),pt!==this.constraints&&mt&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(gt=>{this.constraints!==!1&&this.getAxisMotionValue(gt)&&(this.constraints[gt]=rebaseAxisConstraints(mt.layoutBox[gt],this.constraints[gt]))})}resolveRefConstraints(){const{dragConstraints:_,onMeasureDragConstraints:lt}=this.getProps();if(!_||!isRefObject(_))return!1;const ft=_.current,{projection:mt}=this.visualElement;if(!mt||!mt.layout)return!1;const pt=measurePageBox(ft,mt.root,this.visualElement.getTransformPagePoint());let gt=calcViewportConstraints(mt.layout.layoutBox,pt);if(lt){const bt=lt(convertBoxToBoundingBox(gt));this.hasMutatedConstraints=!!bt,bt&&(gt=convertBoundingBoxToBox(bt))}return gt}startAnimation(_){const{drag:lt,dragMomentum:ft,dragElastic:mt,dragTransition:pt,dragSnapToOrigin:gt,onDragTransitionEnd:bt}=this.getProps(),wt=this.constraints||{},vt=eachAxis(Ct=>{if(!shouldDrag(Ct,lt,this.currentDirection))return;let Rt=wt&&wt[Ct]||{};gt&&(Rt={min:0,max:0});const Mt=mt?200:1e6,Ot=mt?40:1e7,Nt={type:"inertia",velocity:ft?_[Ct]:0,bounceStiffness:Mt,bounceDamping:Ot,timeConstant:750,restDelta:1,restSpeed:10,...pt,...Rt};return this.startAxisValueAnimation(Ct,Nt)});return Promise.all(vt).then(bt)}startAxisValueAnimation(_,lt){const ft=this.getAxisMotionValue(_);return addValueToWillChange(this.visualElement,_),ft.start(animateMotionValue(_,ft,0,lt,this.visualElement,!1))}stopAnimation(){eachAxis(_=>this.getAxisMotionValue(_).stop())}pauseAnimation(){eachAxis(_=>{var lt;return(lt=this.getAxisMotionValue(_).animation)===null||lt===void 0?void 0:lt.pause()})}getAnimationState(_){var lt;return(lt=this.getAxisMotionValue(_).animation)===null||lt===void 0?void 0:lt.state}getAxisMotionValue(_){const lt=`_drag${_.toUpperCase()}`,ft=this.visualElement.getProps(),mt=ft[lt];return mt||this.visualElement.getValue(_,(ft.initial?ft.initial[_]:void 0)||0)}snapToCursor(_){eachAxis(lt=>{const{drag:ft}=this.getProps();if(!shouldDrag(lt,ft,this.currentDirection))return;const{projection:mt}=this.visualElement,pt=this.getAxisMotionValue(lt);if(mt&&mt.layout){const{min:gt,max:bt}=mt.layout.layoutBox[lt];pt.set(_[lt]-mixNumber$1(gt,bt,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:_,dragConstraints:lt}=this.getProps(),{projection:ft}=this.visualElement;if(!isRefObject(lt)||!ft||!this.constraints)return;this.stopAnimation();const mt={x:0,y:0};eachAxis(gt=>{const bt=this.getAxisMotionValue(gt);if(bt&&this.constraints!==!1){const wt=bt.get();mt[gt]=calcOrigin$1({min:wt,max:wt},this.constraints[gt])}});const{transformTemplate:pt}=this.visualElement.getProps();this.visualElement.current.style.transform=pt?pt({},""):"none",ft.root&&ft.root.updateScroll(),ft.updateLayout(),this.resolveConstraints(),eachAxis(gt=>{if(!shouldDrag(gt,_,null))return;const bt=this.getAxisMotionValue(gt),{min:wt,max:vt}=this.constraints[gt];bt.set(mixNumber$1(wt,vt,mt[gt]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const _=this.visualElement.current,lt=addPointerEvent(_,"pointerdown",wt=>{const{drag:vt,dragListener:Ct=!0}=this.getProps();vt&&Ct&&this.start(wt)}),ft=()=>{const{dragConstraints:wt}=this.getProps();isRefObject(wt)&&wt.current&&(this.constraints=this.resolveRefConstraints())},{projection:mt}=this.visualElement,pt=mt.addEventListener("measure",ft);mt&&!mt.layout&&(mt.root&&mt.root.updateScroll(),mt.updateLayout()),frame.read(ft);const gt=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),bt=mt.addEventListener("didUpdate",({delta:wt,hasLayoutChanged:vt})=>{this.isDragging&&vt&&(eachAxis(Ct=>{const Rt=this.getAxisMotionValue(Ct);Rt&&(this.originPoint[Ct]+=wt[Ct].translate,Rt.set(Rt.get()+wt[Ct].translate))}),this.visualElement.render())});return()=>{gt(),lt(),pt(),bt&&bt()}}getProps(){const _=this.visualElement.getProps(),{drag:lt=!1,dragDirectionLock:ft=!1,dragPropagation:mt=!1,dragConstraints:pt=!1,dragElastic:gt=defaultElastic,dragMomentum:bt=!0}=_;return{..._,drag:lt,dragDirectionLock:ft,dragPropagation:mt,dragConstraints:pt,dragElastic:gt,dragMomentum:bt}}}function shouldDrag(it,_,lt){return(_===!0||_===it)&&(lt===null||lt===it)}function getCurrentDirection(it,_=10){let lt=null;return Math.abs(it.y)>_?lt="y":Math.abs(it.x)>_&&(lt="x"),lt}class DragGesture extends Feature{constructor(_){super(_),this.removeGroupControls=noop$1,this.removeListeners=noop$1,this.controls=new VisualElementDragControls(_)}mount(){const{dragControls:_}=this.node.getProps();_&&(this.removeGroupControls=_.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop$1}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=it=>(_,lt)=>{it&&frame.postRender(()=>it(_,lt))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop$1}onPointerDown(_){this.session=new PanSession(_,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:_,onPanStart:lt,onPan:ft,onPanEnd:mt}=this.node.getProps();return{onSessionStart:asyncHandler(_),onStart:asyncHandler(lt),onMove:ft,onEnd:(pt,gt)=>{delete this.session,mt&&frame.postRender(()=>mt(pt,gt))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",_=>this.onPointerDown(_))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const PresenceContext=reactExports.createContext(null);function usePresence(){const it=reactExports.useContext(PresenceContext);if(it===null)return[!0,null];const{isPresent:_,onExitComplete:lt,register:ft}=it,mt=reactExports.useId();reactExports.useEffect(()=>ft(mt),[]);const pt=reactExports.useCallback(()=>lt&&lt(mt),[mt,lt]);return!_&&lt?[!1,pt]:[!0]}const LayoutGroupContext=reactExports.createContext({}),SwitchLayoutGroupContext=reactExports.createContext({}),globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pixelsToPercent(it,_){return _.max===_.min?0:it/(_.max-_.min)*100}const correctBorderRadius={correct:(it,_)=>{if(!_.target)return it;if(typeof it=="string")if(px.test(it))it=parseFloat(it);else return it;const lt=pixelsToPercent(it,_.target.x),ft=pixelsToPercent(it,_.target.y);return`${lt}% ${ft}%`}},correctBoxShadow={correct:(it,{treeScale:_,projectionDelta:lt})=>{const ft=it,mt=complex.parse(it);if(mt.length>5)return ft;const pt=complex.createTransformer(it),gt=typeof mt[0]!="number"?1:0,bt=lt.x.scale*_.x,wt=lt.y.scale*_.y;mt[0+gt]/=bt,mt[1+gt]/=wt;const vt=mixNumber$1(bt,wt,.5);return typeof mt[2+gt]=="number"&&(mt[2+gt]/=vt),typeof mt[3+gt]=="number"&&(mt[3+gt]/=vt),pt(mt)}},scaleCorrectors={};function addScaleCorrector(it){Object.assign(scaleCorrectors,it)}const{schedule:microtask,cancel:cancelMicrotask}=createRenderBatcher(queueMicrotask,!1);class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:_,layoutGroup:lt,switchLayoutGroup:ft,layoutId:mt}=this.props,{projection:pt}=_;addScaleCorrector(defaultScaleCorrectors),pt&&(lt.group&&lt.group.add(pt),ft&&ft.register&&mt&&ft.register(pt),pt.root.didUpdate(),pt.addEventListener("animationComplete",()=>{this.safeToRemove()}),pt.setOptions({...pt.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(_){const{layoutDependency:lt,visualElement:ft,drag:mt,isPresent:pt}=this.props,gt=ft.projection;return gt&&(gt.isPresent=pt,mt||_.layoutDependency!==lt||lt===void 0?gt.willUpdate():this.safeToRemove(),_.isPresent!==pt&&(pt?gt.promote():gt.relegate()||frame.postRender(()=>{const bt=gt.getStack();(!bt||!bt.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:_}=this.props.visualElement;_&&(_.root.didUpdate(),microtask.postRender(()=>{!_.currentAnimation&&_.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:_,layoutGroup:lt,switchLayoutGroup:ft}=this.props,{projection:mt}=_;mt&&(mt.scheduleCheckAfterUnmount(),lt&&lt.group&&lt.group.remove(mt),ft&&ft.deregister&&ft.deregister(mt))}safeToRemove(){const{safeToRemove:_}=this.props;_&&_()}render(){return null}}function MeasureLayout(it){const[_,lt]=usePresence(),ft=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...it,layoutGroup:ft,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:_,safeToRemove:lt})}const defaultScaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow},borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=it=>typeof it=="string"?parseFloat(it):it,isPx=it=>typeof it=="number"||px.test(it);function mixValues(it,_,lt,ft,mt,pt){mt?(it.opacity=mixNumber$1(0,lt.opacity!==void 0?lt.opacity:1,easeCrossfadeIn(ft)),it.opacityExit=mixNumber$1(_.opacity!==void 0?_.opacity:1,0,easeCrossfadeOut(ft))):pt&&(it.opacity=mixNumber$1(_.opacity!==void 0?_.opacity:1,lt.opacity!==void 0?lt.opacity:1,ft));for(let gt=0;gt<numBorders;gt++){const bt=`border${borders[gt]}Radius`;let wt=getRadius(_,bt),vt=getRadius(lt,bt);if(wt===void 0&&vt===void 0)continue;wt||(wt=0),vt||(vt=0),wt===0||vt===0||isPx(wt)===isPx(vt)?(it[bt]=Math.max(mixNumber$1(asNumber(wt),asNumber(vt),ft),0),(percent.test(vt)||percent.test(wt))&&(it[bt]+="%")):it[bt]=vt}(_.rotate||lt.rotate)&&(it.rotate=mixNumber$1(_.rotate||0,lt.rotate||0,ft))}function getRadius(it,_){return it[_]!==void 0?it[_]:it.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop$1);function compress(it,_,lt){return ft=>ft<it?0:ft>_?1:lt(progress(it,_,ft))}function copyAxisInto(it,_){it.min=_.min,it.max=_.max}function copyBoxInto(it,_){copyAxisInto(it.x,_.x),copyAxisInto(it.y,_.y)}function copyAxisDeltaInto(it,_){it.translate=_.translate,it.scale=_.scale,it.originPoint=_.originPoint,it.origin=_.origin}function removePointDelta(it,_,lt,ft,mt){return it-=_,it=scalePoint(it,1/lt,ft),mt!==void 0&&(it=scalePoint(it,1/mt,ft)),it}function removeAxisDelta(it,_=0,lt=1,ft=.5,mt,pt=it,gt=it){if(percent.test(_)&&(_=parseFloat(_),_=mixNumber$1(gt.min,gt.max,_/100)-gt.min),typeof _!="number")return;let bt=mixNumber$1(pt.min,pt.max,ft);it===pt&&(bt-=_),it.min=removePointDelta(it.min,_,lt,bt,mt),it.max=removePointDelta(it.max,_,lt,bt,mt)}function removeAxisTransforms(it,_,[lt,ft,mt],pt,gt){removeAxisDelta(it,_[lt],_[ft],_[mt],_.scale,pt,gt)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(it,_,lt,ft){removeAxisTransforms(it.x,_,xKeys,lt?lt.x:void 0,ft?ft.x:void 0),removeAxisTransforms(it.y,_,yKeys,lt?lt.y:void 0,ft?ft.y:void 0)}function isAxisDeltaZero(it){return it.translate===0&&it.scale===1}function isDeltaZero(it){return isAxisDeltaZero(it.x)&&isAxisDeltaZero(it.y)}function axisEquals(it,_){return it.min===_.min&&it.max===_.max}function boxEquals(it,_){return axisEquals(it.x,_.x)&&axisEquals(it.y,_.y)}function axisEqualsRounded(it,_){return Math.round(it.min)===Math.round(_.min)&&Math.round(it.max)===Math.round(_.max)}function boxEqualsRounded(it,_){return axisEqualsRounded(it.x,_.x)&&axisEqualsRounded(it.y,_.y)}function aspectRatio(it){return calcLength(it.x)/calcLength(it.y)}function axisDeltaEquals(it,_){return it.translate===_.translate&&it.scale===_.scale&&it.originPoint===_.originPoint}class NodeStack{constructor(){this.members=[]}add(_){addUniqueItem(this.members,_),_.scheduleRender()}remove(_){if(removeItem(this.members,_),_===this.prevLead&&(this.prevLead=void 0),_===this.lead){const lt=this.members[this.members.length-1];lt&&this.promote(lt)}}relegate(_){const lt=this.members.findIndex(mt=>_===mt);if(lt===0)return!1;let ft;for(let mt=lt;mt>=0;mt--){const pt=this.members[mt];if(pt.isPresent!==!1){ft=pt;break}}return ft?(this.promote(ft),!0):!1}promote(_,lt){const ft=this.lead;if(_!==ft&&(this.prevLead=ft,this.lead=_,_.show(),ft)){ft.instance&&ft.scheduleRender(),_.scheduleRender(),_.resumeFrom=ft,lt&&(_.resumeFrom.preserveOpacity=!0),ft.snapshot&&(_.snapshot=ft.snapshot,_.snapshot.latestValues=ft.animationValues||ft.latestValues),_.root&&_.root.isUpdating&&(_.isLayoutDirty=!0);const{crossfade:mt}=_.options;mt===!1&&ft.hide()}}exitAnimationComplete(){this.members.forEach(_=>{const{options:lt,resumingFrom:ft}=_;lt.onExitComplete&&lt.onExitComplete(),ft&&ft.options.onExitComplete&&ft.options.onExitComplete()})}scheduleRender(){this.members.forEach(_=>{_.instance&&_.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(it,_,lt){let ft="";const mt=it.x.translate/_.x,pt=it.y.translate/_.y,gt=(lt==null?void 0:lt.z)||0;if((mt||pt||gt)&&(ft=`translate3d(${mt}px, ${pt}px, ${gt}px) `),(_.x!==1||_.y!==1)&&(ft+=`scale(${1/_.x}, ${1/_.y}) `),lt){const{transformPerspective:vt,rotate:Ct,rotateX:Rt,rotateY:Mt,skewX:Ot,skewY:Nt}=lt;vt&&(ft=`perspective(${vt}px) ${ft}`),Ct&&(ft+=`rotate(${Ct}deg) `),Rt&&(ft+=`rotateX(${Rt}deg) `),Mt&&(ft+=`rotateY(${Mt}deg) `),Ot&&(ft+=`skewX(${Ot}deg) `),Nt&&(ft+=`skewY(${Nt}deg) `)}const bt=it.x.scale*_.x,wt=it.y.scale*_.y;return(bt!==1||wt!==1)&&(ft+=`scale(${bt}, ${wt})`),ft||"none"}const compareByDepth=(it,_)=>it.depth-_.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(_){addUniqueItem(this.children,_),this.isDirty=!0}remove(_){removeItem(this.children,_),this.isDirty=!0}forEach(_){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(_)}}function resolveMotionValue(it){const _=isMotionValue(it)?it.get():it;return isCustomValue(_)?_.toValue():_}function delay(it,_){const lt=time.now(),ft=({timestamp:mt})=>{const pt=mt-lt;pt>=_&&(cancelFrame(ft),it(pt-_))};return frame.read(ft,!0),()=>cancelFrame(ft)}function isSVGElement(it){return it instanceof SVGElement&&it.tagName!=="svg"}function animateSingleValue(it,_,lt){const ft=isMotionValue(it)?it:motionValue(it);return ft.start(animateMotionValue("",ft,_,lt)),ft.animation}const metrics={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},isDebug=typeof window<"u"&&window.MotionDebug!==void 0,transformAxes=["","X","Y","Z"],hiddenVisibility={visibility:"hidden"},animationTarget=1e3;let id=0;function resetDistortingTransform(it,_,lt,ft){const{latestValues:mt}=_;mt[it]&&(lt[it]=mt[it],_.setStaticValue(it,0),ft&&(ft[it]=0))}function cancelTreeOptimisedTransformAnimations(it){if(it.hasCheckedOptimisedAppear=!0,it.root===it)return;const{visualElement:_}=it.options;if(!_)return;const lt=getOptimisedAppearId(_);if(window.MotionHasOptimisedAnimation(lt,"transform")){const{layout:mt,layoutId:pt}=it.options;window.MotionCancelOptimisedAnimation(lt,"transform",frame,!(mt||pt))}const{parent:ft}=it;ft&&!ft.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(ft)}function createProjectionNode$1({attachResizeListener:it,defaultParent:_,measureScroll:lt,checkIsScrollRoot:ft,resetTransform:mt}){return class{constructor(gt={},bt=_==null?void 0:_()){this.id=id++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,isDebug&&(metrics.totalNodes=metrics.resolvedTargetDeltas=metrics.recalculatedProjection=0),this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes),isDebug&&window.MotionDebug.record(metrics)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=gt,this.root=bt?bt.root||bt:this,this.path=bt?[...bt.path,bt]:[],this.parent=bt,this.depth=bt?bt.depth+1:0;for(let wt=0;wt<this.path.length;wt++)this.path[wt].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(gt,bt){return this.eventHandlers.has(gt)||this.eventHandlers.set(gt,new SubscriptionManager),this.eventHandlers.get(gt).add(bt)}notifyListeners(gt,...bt){const wt=this.eventHandlers.get(gt);wt&&wt.notify(...bt)}hasListeners(gt){return this.eventHandlers.has(gt)}mount(gt,bt=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=isSVGElement(gt),this.instance=gt;const{layoutId:wt,layout:vt,visualElement:Ct}=this.options;if(Ct&&!Ct.current&&Ct.mount(gt),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),bt&&(vt||wt)&&(this.isLayoutDirty=!0),it){let Rt;const Mt=()=>this.root.updateBlockedByResize=!1;it(gt,()=>{this.root.updateBlockedByResize=!0,Rt&&Rt(),Rt=delay(Mt,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation))})}wt&&this.root.registerSharedNode(wt,this),this.options.animate!==!1&&Ct&&(wt||vt)&&this.addEventListener("didUpdate",({delta:Rt,hasLayoutChanged:Mt,hasRelativeTargetChanged:Ot,layout:Nt})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Ht=this.options.transition||Ct.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:Kt,onLayoutAnimationComplete:hr}=Ct.getProps(),Qt=!this.targetLayout||!boxEqualsRounded(this.targetLayout,Nt)||Ot,mr=!Mt&&Ot;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||mr||Mt&&(Qt||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(Rt,mr);const br={...getValueTransition(Ht,"layout"),onPlay:Kt,onComplete:hr};(Ct.shouldReduceMotion||this.options.layoutRoot)&&(br.delay=0,br.type=!1),this.startAnimation(br)}else Mt||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Nt})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const gt=this.getStack();gt&&gt.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:gt}=this.options;return gt&&gt.getProps().transformTemplate}willUpdate(gt=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let Ct=0;Ct<this.path.length;Ct++){const Rt=this.path[Ct];Rt.shouldResetTransform=!0,Rt.updateScroll("snapshot"),Rt.options.layoutRoot&&Rt.willUpdate(!1)}const{layoutId:bt,layout:wt}=this.options;if(bt===void 0&&!wt)return;const vt=this.getTransformTemplate();this.prevTransformTemplateValue=vt?vt(this.latestValues,""):void 0,this.updateSnapshot(),gt&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}this.isUpdating||this.nodes.forEach(clearIsLayoutDirty),this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate),this.clearAllSnapshots();const bt=time.now();frameData.delta=clamp$1(0,1e3/60,bt-frameData.timestamp),frameData.timestamp=bt,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let wt=0;wt<this.path.length;wt++)this.path[wt].updateScroll();const gt=this.layout;this.layout=this.measure(!1),this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:bt}=this.options;bt&&bt.notify("LayoutMeasure",this.layout.layoutBox,gt?gt.layoutBox:void 0)}updateScroll(gt="measure"){let bt=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===gt&&(bt=!1),bt){const wt=ft(this.instance);this.scroll={animationId:this.root.animationId,phase:gt,isRoot:wt,offset:lt(this.instance),wasRoot:this.scroll?this.scroll.isRoot:wt}}}resetTransform(){if(!mt)return;const gt=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,bt=this.projectionDelta&&!isDeltaZero(this.projectionDelta),wt=this.getTransformTemplate(),vt=wt?wt(this.latestValues,""):void 0,Ct=vt!==this.prevTransformTemplateValue;gt&&(bt||hasTransform(this.latestValues)||Ct)&&(mt(this.instance,vt),this.shouldResetTransform=!1,this.scheduleRender())}measure(gt=!0){const bt=this.measurePageBox();let wt=this.removeElementScroll(bt);return gt&&(wt=this.removeTransform(wt)),roundBox(wt),{animationId:this.root.animationId,measuredBox:bt,layoutBox:wt,latestValues:{},source:this.id}}measurePageBox(){var gt;const{visualElement:bt}=this.options;if(!bt)return createBox();const wt=bt.measureViewportBox();if(!(((gt=this.scroll)===null||gt===void 0?void 0:gt.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:Ct}=this.root;Ct&&(translateAxis(wt.x,Ct.offset.x),translateAxis(wt.y,Ct.offset.y))}return wt}removeElementScroll(gt){var bt;const wt=createBox();if(copyBoxInto(wt,gt),!((bt=this.scroll)===null||bt===void 0)&&bt.wasRoot)return wt;for(let vt=0;vt<this.path.length;vt++){const Ct=this.path[vt],{scroll:Rt,options:Mt}=Ct;Ct!==this.root&&Rt&&Mt.layoutScroll&&(Rt.wasRoot&&copyBoxInto(wt,gt),translateAxis(wt.x,Rt.offset.x),translateAxis(wt.y,Rt.offset.y))}return wt}applyTransform(gt,bt=!1){const wt=createBox();copyBoxInto(wt,gt);for(let vt=0;vt<this.path.length;vt++){const Ct=this.path[vt];!bt&&Ct.options.layoutScroll&&Ct.scroll&&Ct!==Ct.root&&transformBox(wt,{x:-Ct.scroll.offset.x,y:-Ct.scroll.offset.y}),hasTransform(Ct.latestValues)&&transformBox(wt,Ct.latestValues)}return hasTransform(this.latestValues)&&transformBox(wt,this.latestValues),wt}removeTransform(gt){const bt=createBox();copyBoxInto(bt,gt);for(let wt=0;wt<this.path.length;wt++){const vt=this.path[wt];if(!vt.instance||!hasTransform(vt.latestValues))continue;hasScale(vt.latestValues)&&vt.updateSnapshot();const Ct=createBox(),Rt=vt.measurePageBox();copyBoxInto(Ct,Rt),removeBoxTransforms(bt,vt.latestValues,vt.snapshot?vt.snapshot.layoutBox:void 0,Ct)}return hasTransform(this.latestValues)&&removeBoxTransforms(bt,this.latestValues),bt}setTargetDelta(gt){this.targetDelta=gt,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(gt){this.options={...this.options,...gt,crossfade:gt.crossfade!==void 0?gt.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(gt=!1){var bt;const wt=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=wt.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=wt.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=wt.isSharedProjectionDirty);const vt=!!this.resumingFrom||this!==wt;if(!(gt||vt&&this.isSharedProjectionDirty||this.isProjectionDirty||!((bt=this.parent)===null||bt===void 0)&&bt.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:Rt,layoutId:Mt}=this.options;if(!(!this.layout||!(Rt||Mt))){if(this.resolvedRelativeTargetAt=frameData.timestamp,!this.targetDelta&&!this.relativeTarget){const Ot=this.getClosestProjectingParent();Ot&&Ot.layout&&this.animationProgress!==1?(this.relativeParent=Ot,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.layout.layoutBox,Ot.layout.layoutBox),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const Ot=this.getClosestProjectingParent();Ot&&!!Ot.resumingFrom==!!this.resumingFrom&&!Ot.options.layoutScroll&&Ot.target&&this.animationProgress!==1?(this.relativeParent=Ot,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.target,Ot.target),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}isDebug&&metrics.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var gt;const bt=this.getLead(),wt=!!this.resumingFrom||this!==bt;let vt=!0;if((this.isProjectionDirty||!((gt=this.parent)===null||gt===void 0)&&gt.isProjectionDirty)&&(vt=!1),wt&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(vt=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(vt=!1),vt)return;const{layout:Ct,layoutId:Rt}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(Ct||Rt))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const Mt=this.treeScale.x,Ot=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,wt),bt.layout&&!bt.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(bt.target=bt.layout.layoutBox,bt.targetWithTransforms=createBox());const{target:Nt}=bt;if(!Nt){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,Nt,this.latestValues),(this.treeScale.x!==Mt||this.treeScale.y!==Ot||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Nt)),isDebug&&metrics.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(gt=!0){var bt;if((bt=this.options.visualElement)===null||bt===void 0||bt.scheduleRender(),gt){const wt=this.getStack();wt&&wt.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(gt,bt=!1){const wt=this.snapshot,vt=wt?wt.latestValues:{},Ct={...this.latestValues},Rt=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!bt;const Mt=createBox(),Ot=wt?wt.source:void 0,Nt=this.layout?this.layout.source:void 0,Ht=Ot!==Nt,Kt=this.getStack(),hr=!Kt||Kt.members.length<=1,Qt=!!(Ht&&!hr&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let mr;this.mixTargetDelta=br=>{const Fr=br/1e3;mixAxisDelta(Rt.x,gt.x,Fr),mixAxisDelta(Rt.y,gt.y,Fr),this.setTargetDelta(Rt),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(Mt,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,Mt,Fr),mr&&boxEquals(this.relativeTarget,mr)&&(this.isProjectionDirty=!1),mr||(mr=createBox()),copyBoxInto(mr,this.relativeTarget)),Ht&&(this.animationValues=Ct,mixValues(Ct,vt,this.latestValues,Fr,Qt,hr)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Fr},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(gt){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.currentAnimation=animateSingleValue(0,animationTarget,{...gt,onUpdate:bt=>{this.mixTargetDelta(bt),gt.onUpdate&&gt.onUpdate(bt)},onComplete:()=>{gt.onComplete&&gt.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const gt=this.getStack();gt&&gt.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const gt=this.getLead();let{targetWithTransforms:bt,target:wt,layout:vt,latestValues:Ct}=gt;if(!(!bt||!wt||!vt)){if(this!==gt&&this.layout&&vt&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,vt.layoutBox)){wt=this.target||createBox();const Rt=calcLength(this.layout.layoutBox.x);wt.x.min=gt.target.x.min,wt.x.max=wt.x.min+Rt;const Mt=calcLength(this.layout.layoutBox.y);wt.y.min=gt.target.y.min,wt.y.max=wt.y.min+Mt}copyBoxInto(bt,wt),transformBox(bt,Ct),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,bt,Ct)}}registerSharedNode(gt,bt){this.sharedNodes.has(gt)||this.sharedNodes.set(gt,new NodeStack),this.sharedNodes.get(gt).add(bt);const vt=bt.options.initialPromotionConfig;bt.promote({transition:vt?vt.transition:void 0,preserveFollowOpacity:vt&&vt.shouldPreserveFollowOpacity?vt.shouldPreserveFollowOpacity(bt):void 0})}isLead(){const gt=this.getStack();return gt?gt.lead===this:!0}getLead(){var gt;const{layoutId:bt}=this.options;return bt?((gt=this.getStack())===null||gt===void 0?void 0:gt.lead)||this:this}getPrevLead(){var gt;const{layoutId:bt}=this.options;return bt?(gt=this.getStack())===null||gt===void 0?void 0:gt.prevLead:void 0}getStack(){const{layoutId:gt}=this.options;if(gt)return this.root.sharedNodes.get(gt)}promote({needsReset:gt,transition:bt,preserveFollowOpacity:wt}={}){const vt=this.getStack();vt&&vt.promote(this,wt),gt&&(this.projectionDelta=void 0,this.needsReset=!0),bt&&this.setOptions({transition:bt})}relegate(){const gt=this.getStack();return gt?gt.relegate(this):!1}resetSkewAndRotation(){const{visualElement:gt}=this.options;if(!gt)return;let bt=!1;const{latestValues:wt}=gt;if((wt.z||wt.rotate||wt.rotateX||wt.rotateY||wt.rotateZ||wt.skewX||wt.skewY)&&(bt=!0),!bt)return;const vt={};wt.z&&resetDistortingTransform("z",gt,vt,this.animationValues);for(let Ct=0;Ct<transformAxes.length;Ct++)resetDistortingTransform(`rotate${transformAxes[Ct]}`,gt,vt,this.animationValues),resetDistortingTransform(`skew${transformAxes[Ct]}`,gt,vt,this.animationValues);gt.render();for(const Ct in vt)gt.setStaticValue(Ct,vt[Ct]),this.animationValues&&(this.animationValues[Ct]=vt[Ct]);gt.scheduleRender()}getProjectionStyles(gt){var bt,wt;if(!this.instance||this.isSVG)return;if(!this.isVisible)return hiddenVisibility;const vt={visibility:""},Ct=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,vt.opacity="",vt.pointerEvents=resolveMotionValue(gt==null?void 0:gt.pointerEvents)||"",vt.transform=Ct?Ct(this.latestValues,""):"none",vt;const Rt=this.getLead();if(!this.projectionDelta||!this.layout||!Rt.target){const Ht={};return this.options.layoutId&&(Ht.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,Ht.pointerEvents=resolveMotionValue(gt==null?void 0:gt.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(Ht.transform=Ct?Ct({},""):"none",this.hasProjected=!1),Ht}const Mt=Rt.animationValues||Rt.latestValues;this.applyTransformsToTarget(),vt.transform=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,Mt),Ct&&(vt.transform=Ct(Mt,vt.transform));const{x:Ot,y:Nt}=this.projectionDelta;vt.transformOrigin=`${Ot.origin*100}% ${Nt.origin*100}% 0`,Rt.animationValues?vt.opacity=Rt===this?(wt=(bt=Mt.opacity)!==null&&bt!==void 0?bt:this.latestValues.opacity)!==null&&wt!==void 0?wt:1:this.preserveOpacity?this.latestValues.opacity:Mt.opacityExit:vt.opacity=Rt===this?Mt.opacity!==void 0?Mt.opacity:"":Mt.opacityExit!==void 0?Mt.opacityExit:0;for(const Ht in scaleCorrectors){if(Mt[Ht]===void 0)continue;const{correct:Kt,applyTo:hr}=scaleCorrectors[Ht],Qt=vt.transform==="none"?Mt[Ht]:Kt(Mt[Ht],Rt);if(hr){const mr=hr.length;for(let br=0;br<mr;br++)vt[hr[br]]=Qt}else vt[Ht]=Qt}return this.options.layoutId&&(vt.pointerEvents=Rt===this?resolveMotionValue(gt==null?void 0:gt.pointerEvents)||"":"none"),vt}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(gt=>{var bt;return(bt=gt.currentAnimation)===null||bt===void 0?void 0:bt.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(it){it.updateLayout()}function notifyLayoutUpdate(it){var _;const lt=((_=it.resumeFrom)===null||_===void 0?void 0:_.snapshot)||it.snapshot;if(it.isLead()&&it.layout&&lt&&it.hasListeners("didUpdate")){const{layoutBox:ft,measuredBox:mt}=it.layout,{animationType:pt}=it.options,gt=lt.source!==it.layout.source;pt==="size"?eachAxis(Rt=>{const Mt=gt?lt.measuredBox[Rt]:lt.layoutBox[Rt],Ot=calcLength(Mt);Mt.min=ft[Rt].min,Mt.max=Mt.min+Ot}):shouldAnimatePositionOnly(pt,lt.layoutBox,ft)&&eachAxis(Rt=>{const Mt=gt?lt.measuredBox[Rt]:lt.layoutBox[Rt],Ot=calcLength(ft[Rt]);Mt.max=Mt.min+Ot,it.relativeTarget&&!it.currentAnimation&&(it.isProjectionDirty=!0,it.relativeTarget[Rt].max=it.relativeTarget[Rt].min+Ot)});const bt=createDelta();calcBoxDelta(bt,ft,lt.layoutBox);const wt=createDelta();gt?calcBoxDelta(wt,it.applyTransform(mt,!0),lt.measuredBox):calcBoxDelta(wt,ft,lt.layoutBox);const vt=!isDeltaZero(bt);let Ct=!1;if(!it.resumeFrom){const Rt=it.getClosestProjectingParent();if(Rt&&!Rt.resumeFrom){const{snapshot:Mt,layout:Ot}=Rt;if(Mt&&Ot){const Nt=createBox();calcRelativePosition(Nt,lt.layoutBox,Mt.layoutBox);const Ht=createBox();calcRelativePosition(Ht,ft,Ot.layoutBox),boxEqualsRounded(Nt,Ht)||(Ct=!0),Rt.options.layoutRoot&&(it.relativeTarget=Ht,it.relativeTargetOrigin=Nt,it.relativeParent=Rt)}}}it.notifyListeners("didUpdate",{layout:ft,snapshot:lt,delta:wt,layoutDelta:bt,hasLayoutChanged:vt,hasRelativeTargetChanged:Ct})}else if(it.isLead()){const{onExitComplete:ft}=it.options;ft&&ft()}it.options.transition=void 0}function propagateDirtyNodes(it){isDebug&&metrics.totalNodes++,it.parent&&(it.isProjecting()||(it.isProjectionDirty=it.parent.isProjectionDirty),it.isSharedProjectionDirty||(it.isSharedProjectionDirty=!!(it.isProjectionDirty||it.parent.isProjectionDirty||it.parent.isSharedProjectionDirty)),it.isTransformDirty||(it.isTransformDirty=it.parent.isTransformDirty))}function cleanDirtyNodes(it){it.isProjectionDirty=it.isSharedProjectionDirty=it.isTransformDirty=!1}function clearSnapshot(it){it.clearSnapshot()}function clearMeasurements(it){it.clearMeasurements()}function clearIsLayoutDirty(it){it.isLayoutDirty=!1}function resetTransformStyle(it){const{visualElement:_}=it.options;_&&_.getProps().onBeforeLayoutMeasure&&_.notify("BeforeLayoutMeasure"),it.resetTransform()}function finishAnimation(it){it.finishAnimation(),it.targetDelta=it.relativeTarget=it.target=void 0,it.isProjectionDirty=!0}function resolveTargetDelta(it){it.resolveTargetDelta()}function calcProjection(it){it.calcProjection()}function resetSkewAndRotation(it){it.resetSkewAndRotation()}function removeLeadSnapshots(it){it.removeLeadSnapshot()}function mixAxisDelta(it,_,lt){it.translate=mixNumber$1(_.translate,0,lt),it.scale=mixNumber$1(_.scale,1,lt),it.origin=_.origin,it.originPoint=_.originPoint}function mixAxis(it,_,lt,ft){it.min=mixNumber$1(_.min,lt.min,ft),it.max=mixNumber$1(_.max,lt.max,ft)}function mixBox(it,_,lt,ft){mixAxis(it.x,_.x,lt.x,ft),mixAxis(it.y,_.y,lt.y,ft)}function hasOpacityCrossfade(it){return it.animationValues&&it.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=it=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(it),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop$1;function roundAxis(it){it.min=roundPoint(it.min),it.max=roundPoint(it.max)}function roundBox(it){roundAxis(it.x),roundAxis(it.y)}function shouldAnimatePositionOnly(it,_,lt){return it==="position"||it==="preserve-aspect"&&!isNear(aspectRatio(_),aspectRatio(lt),.2)}function checkNodeWasScrollRoot(it){var _;return it!==it.root&&((_=it.scroll)===null||_===void 0?void 0:_.wasRoot)}const DocumentProjectionNode=createProjectionNode$1({attachResizeListener:(it,_)=>addDomEvent(it,"resize",_),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode$1({measureScroll:it=>({x:it.scrollLeft,y:it.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const it=new DocumentProjectionNode({});it.mount(window),it.setOptions({layoutScroll:!0}),rootProjectionNode.current=it}return rootProjectionNode.current},resetTransform:(it,_)=>{it.style.transform=_!==void 0?_:"none"},checkIsScrollRoot:it=>window.getComputedStyle(it).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function addHoverEvent(it,_){const lt=_?"pointerenter":"pointerleave",ft=_?"onHoverStart":"onHoverEnd",mt=(pt,gt)=>{if(pt.pointerType==="touch"||isDragActive())return;const bt=it.getProps();it.animationState&&bt.whileHover&&it.animationState.setActive("whileHover",_);const wt=bt[ft];wt&&frame.postRender(()=>wt(pt,gt))};return addPointerEvent(it.current,lt,mt,{passive:!it.getProps()[ft]})}class HoverGesture extends Feature{mount(){this.unmount=pipe(addHoverEvent(this.node,!0),addHoverEvent(this.node,!1))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let _=!1;try{_=this.node.current.matches(":focus-visible")}catch{_=!0}!_||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const isNodeOrChild=(it,_)=>_?it===_?!0:isNodeOrChild(it,_.parentElement):!1;function fireSyntheticPointerEvent(it,_){if(!_)return;const lt=new PointerEvent("pointer"+it);_(lt,extractEventInfo(lt))}class PressGesture extends Feature{constructor(){super(...arguments),this.removeStartListeners=noop$1,this.removeEndListeners=noop$1,this.removeAccessibleListeners=noop$1,this.startPointerPress=(_,lt)=>{if(this.isPressing)return;this.removeEndListeners();const ft=this.node.getProps(),pt=addPointerEvent(window,"pointerup",(bt,wt)=>{if(!this.checkPressEnd())return;const{onTap:vt,onTapCancel:Ct,globalTapTarget:Rt}=this.node.getProps(),Mt=!Rt&&!isNodeOrChild(this.node.current,bt.target)?Ct:vt;Mt&&frame.update(()=>Mt(bt,wt))},{passive:!(ft.onTap||ft.onPointerUp)}),gt=addPointerEvent(window,"pointercancel",(bt,wt)=>this.cancelPress(bt,wt),{passive:!(ft.onTapCancel||ft.onPointerCancel)});this.removeEndListeners=pipe(pt,gt),this.startPress(_,lt)},this.startAccessiblePress=()=>{const _=pt=>{if(pt.key!=="Enter"||this.isPressing)return;const gt=bt=>{bt.key!=="Enter"||!this.checkPressEnd()||fireSyntheticPointerEvent("up",(wt,vt)=>{const{onTap:Ct}=this.node.getProps();Ct&&frame.postRender(()=>Ct(wt,vt))})};this.removeEndListeners(),this.removeEndListeners=addDomEvent(this.node.current,"keyup",gt),fireSyntheticPointerEvent("down",(bt,wt)=>{this.startPress(bt,wt)})},lt=addDomEvent(this.node.current,"keydown",_),ft=()=>{this.isPressing&&fireSyntheticPointerEvent("cancel",(pt,gt)=>this.cancelPress(pt,gt))},mt=addDomEvent(this.node.current,"blur",ft);this.removeAccessibleListeners=pipe(lt,mt)}}startPress(_,lt){this.isPressing=!0;const{onTapStart:ft,whileTap:mt}=this.node.getProps();mt&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),ft&&frame.postRender(()=>ft(_,lt))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!isDragActive()}cancelPress(_,lt){if(!this.checkPressEnd())return;const{onTapCancel:ft}=this.node.getProps();ft&&frame.postRender(()=>ft(_,lt))}mount(){const _=this.node.getProps(),lt=addPointerEvent(_.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(_.onTapStart||_.onPointerStart)}),ft=addDomEvent(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=pipe(lt,ft)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=it=>{const _=observerCallbacks.get(it.target);_&&_(it)},fireAllObserverCallbacks=it=>{it.forEach(fireObserverCallback)};function initIntersectionObserver({root:it,..._}){const lt=it||document;observers.has(lt)||observers.set(lt,{});const ft=observers.get(lt),mt=JSON.stringify(_);return ft[mt]||(ft[mt]=new IntersectionObserver(fireAllObserverCallbacks,{root:it,..._})),ft[mt]}function observeIntersection(it,_,lt){const ft=initIntersectionObserver(_);return observerCallbacks.set(it,lt),ft.observe(it),()=>{observerCallbacks.delete(it),ft.unobserve(it)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:_={}}=this.node.getProps(),{root:lt,margin:ft,amount:mt="some",once:pt}=_,gt={root:lt?lt.current:void 0,rootMargin:ft,threshold:typeof mt=="number"?mt:thresholdNames[mt]},bt=wt=>{const{isIntersecting:vt}=wt;if(this.isInView===vt||(this.isInView=vt,pt&&!vt&&this.hasEnteredView))return;vt&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",vt);const{onViewportEnter:Ct,onViewportLeave:Rt}=this.node.getProps(),Mt=vt?Ct:Rt;Mt&&Mt(wt)};return observeIntersection(this.node.current,gt,bt)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:_,prevProps:lt}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(_,lt))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:it={}},{viewport:_={}}={}){return lt=>it[lt]!==_[lt]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},MotionConfigContext=reactExports.createContext({transformPagePoint:it=>it,isStatic:!1,reducedMotion:"never"}),MotionContext=reactExports.createContext({}),isBrowser=typeof window<"u",useIsomorphicLayoutEffect=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,LazyContext=reactExports.createContext({strict:!1});function useVisualElement(it,_,lt,ft,mt){var pt,gt;const{visualElement:bt}=reactExports.useContext(MotionContext),wt=reactExports.useContext(LazyContext),vt=reactExports.useContext(PresenceContext),Ct=reactExports.useContext(MotionConfigContext).reducedMotion,Rt=reactExports.useRef();ft=ft||wt.renderer,!Rt.current&&ft&&(Rt.current=ft(it,{visualState:_,parent:bt,props:lt,presenceContext:vt,blockInitialAnimation:vt?vt.initial===!1:!1,reducedMotionConfig:Ct}));const Mt=Rt.current,Ot=reactExports.useContext(SwitchLayoutGroupContext);Mt&&!Mt.projection&&mt&&(Mt.type==="html"||Mt.type==="svg")&&createProjectionNode(Rt.current,lt,mt,Ot);const Nt=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{Mt&&Nt.current&&Mt.update(lt,vt)});const Ht=lt[optimizedAppearDataAttribute],Kt=reactExports.useRef(!!Ht&&!(!((pt=window.MotionHandoffIsComplete)===null||pt===void 0)&&pt.call(window,Ht))&&((gt=window.MotionHasOptimisedAnimation)===null||gt===void 0?void 0:gt.call(window,Ht)));return useIsomorphicLayoutEffect(()=>{Mt&&(Nt.current=!0,window.MotionIsMounted=!0,Mt.updateFeatures(),microtask.render(Mt.render),Kt.current&&Mt.animationState&&Mt.animationState.animateChanges())}),reactExports.useEffect(()=>{Mt&&(!Kt.current&&Mt.animationState&&Mt.animationState.animateChanges(),Kt.current&&(queueMicrotask(()=>{var hr;(hr=window.MotionHandoffMarkAsComplete)===null||hr===void 0||hr.call(window,Ht)}),Kt.current=!1))}),Mt}function createProjectionNode(it,_,lt,ft){const{layoutId:mt,layout:pt,drag:gt,dragConstraints:bt,layoutScroll:wt,layoutRoot:vt}=_;it.projection=new lt(it.latestValues,_["data-framer-portal-id"]?void 0:getClosestProjectingNode(it.parent)),it.projection.setOptions({layoutId:mt,layout:pt,alwaysMeasureLayout:!!gt||bt&&isRefObject(bt),visualElement:it,animationType:typeof pt=="string"?pt:"both",initialPromotionConfig:ft,layoutScroll:wt,layoutRoot:vt})}function getClosestProjectingNode(it){if(it)return it.options.allowProjection!==!1?it.projection:getClosestProjectingNode(it.parent)}function useMotionRef(it,_,lt){return reactExports.useCallback(ft=>{ft&&it.mount&&it.mount(ft),_&&(ft?_.mount(ft):_.unmount()),lt&&(typeof lt=="function"?lt(ft):isRefObject(lt)&&(lt.current=ft))},[_])}function isControllingVariants(it){return isAnimationControls(it.animate)||variantProps.some(_=>isVariantLabel(it[_]))}function isVariantNode(it){return!!(isControllingVariants(it)||it.variants)}function getCurrentTreeVariants(it,_){if(isControllingVariants(it)){const{initial:lt,animate:ft}=it;return{initial:lt===!1||isVariantLabel(lt)?lt:void 0,animate:isVariantLabel(ft)?ft:void 0}}return it.inherit!==!1?_:{}}function useCreateMotionContext(it){const{initial:_,animate:lt}=getCurrentTreeVariants(it,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:_,animate:lt}),[variantLabelsAsDependency(_),variantLabelsAsDependency(lt)])}function variantLabelsAsDependency(it){return Array.isArray(it)?it.join(" "):it}const featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const it in featureProps)featureDefinitions[it]={isEnabled:_=>featureProps[it].some(lt=>!!_[lt])};function loadFeatures(it){for(const _ in it)featureDefinitions[_]={...featureDefinitions[_],...it[_]}}const motionComponentSymbol=Symbol.for("motionComponentSymbol");function createRendererMotionComponent({preloadedFeatures:it,createVisualElement:_,useRender:lt,useVisualState:ft,Component:mt}){it&&loadFeatures(it);function pt(bt,wt){let vt;const Ct={...reactExports.useContext(MotionConfigContext),...bt,layoutId:useLayoutId(bt)},{isStatic:Rt}=Ct,Mt=useCreateMotionContext(bt),Ot=ft(bt,Rt);if(!Rt&&isBrowser){useStrictMode();const Nt=getProjectionFunctionality(Ct);vt=Nt.MeasureLayout,Mt.visualElement=useVisualElement(mt,Ot,Ct,_,Nt.ProjectionNode)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:Mt,children:[vt&&Mt.visualElement?jsxRuntimeExports.jsx(vt,{visualElement:Mt.visualElement,...Ct}):null,lt(mt,bt,useMotionRef(Ot,Mt.visualElement,wt),Ot,Rt,Mt.visualElement)]})}const gt=reactExports.forwardRef(pt);return gt[motionComponentSymbol]=mt,gt}function useLayoutId({layoutId:it}){const _=reactExports.useContext(LayoutGroupContext).id;return _&&it!==void 0?_+"-"+it:it}function useStrictMode(it,_){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(it){const{drag:_,layout:lt}=featureDefinitions;if(!_&&!lt)return{};const ft={..._,...lt};return{MeasureLayout:_!=null&&_.isEnabled(it)||lt!=null&&lt.isEnabled(it)?ft.MeasureLayout:void 0,ProjectionNode:ft.ProjectionNode}}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(it){return typeof it!="string"||it.includes("-")?!1:!!(lowercaseSVGElements.indexOf(it)>-1||/[A-Z]/u.test(it))}function renderHTML(it,{style:_,vars:lt},ft,mt){Object.assign(it.style,_,mt&&mt.getProjectionStyles(ft));for(const pt in lt)it.style.setProperty(pt,lt[pt])}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(it,_,lt,ft){renderHTML(it,_,void 0,ft);for(const mt in _.attrs)it.setAttribute(camelCaseAttributes.has(mt)?mt:camelToDash(mt),_.attrs[mt])}function isForcedMotionValue(it,{layout:_,layoutId:lt}){return transformProps.has(it)||it.startsWith("origin")||(_||lt!==void 0)&&(!!scaleCorrectors[it]||it==="opacity")}function scrapeMotionValuesFromProps$1(it,_,lt){var ft;const{style:mt}=it,pt={};for(const gt in mt)(isMotionValue(mt[gt])||_.style&&isMotionValue(_.style[gt])||isForcedMotionValue(gt,it)||((ft=lt==null?void 0:lt.getValue(gt))===null||ft===void 0?void 0:ft.liveStyle)!==void 0)&&(pt[gt]=mt[gt]);return pt}function scrapeMotionValuesFromProps(it,_,lt){const ft=scrapeMotionValuesFromProps$1(it,_,lt);for(const mt in it)if(isMotionValue(it[mt])||isMotionValue(_[mt])){const pt=transformPropOrder.indexOf(mt)!==-1?"attr"+mt.charAt(0).toUpperCase()+mt.substring(1):mt;ft[pt]=it[mt]}return ft}function useConstant(it){const _=reactExports.useRef(null);return _.current===null&&(_.current=it()),_.current}function makeState({scrapeMotionValuesFromProps:it,createRenderState:_,onMount:lt},ft,mt,pt){const gt={latestValues:makeLatestValues(ft,mt,pt,it),renderState:_()};return lt&&(gt.mount=bt=>lt(ft,bt,gt)),gt}const makeUseVisualState=it=>(_,lt)=>{const ft=reactExports.useContext(MotionContext),mt=reactExports.useContext(PresenceContext),pt=()=>makeState(it,_,ft,mt);return lt?pt():useConstant(pt)};function makeLatestValues(it,_,lt,ft){const mt={},pt=ft(it,{});for(const Mt in pt)mt[Mt]=resolveMotionValue(pt[Mt]);let{initial:gt,animate:bt}=it;const wt=isControllingVariants(it),vt=isVariantNode(it);_&&vt&&!wt&&it.inherit!==!1&&(gt===void 0&&(gt=_.initial),bt===void 0&&(bt=_.animate));let Ct=lt?lt.initial===!1:!1;Ct=Ct||gt===!1;const Rt=Ct?bt:gt;if(Rt&&typeof Rt!="boolean"&&!isAnimationControls(Rt)){const Mt=Array.isArray(Rt)?Rt:[Rt];for(let Ot=0;Ot<Mt.length;Ot++){const Nt=resolveVariantFromProps(it,Mt[Ot]);if(Nt){const{transitionEnd:Ht,transition:Kt,...hr}=Nt;for(const Qt in hr){let mr=hr[Qt];if(Array.isArray(mr)){const br=Ct?mr.length-1:0;mr=mr[br]}mr!==null&&(mt[Qt]=mr)}for(const Qt in Ht)mt[Qt]=Ht[Qt]}}}return mt}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),getValueAsType=(it,_)=>_&&typeof it=="number"?_.transform(it):it,translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(it,_,lt){let ft="",mt=!0;for(let pt=0;pt<numTransforms;pt++){const gt=transformPropOrder[pt],bt=it[gt];if(bt===void 0)continue;let wt=!0;if(typeof bt=="number"?wt=bt===(gt.startsWith("scale")?1:0):wt=parseFloat(bt)===0,!wt||lt){const vt=getValueAsType(bt,numberValueTypes[gt]);if(!wt){mt=!1;const Ct=translateAlias[gt]||gt;ft+=`${Ct}(${vt}) `}lt&&(_[gt]=vt)}}return ft=ft.trim(),lt?ft=lt(_,mt?"":ft):mt&&(ft="none"),ft}function buildHTMLStyles(it,_,lt){const{style:ft,vars:mt,transformOrigin:pt}=it;let gt=!1,bt=!1;for(const wt in _){const vt=_[wt];if(transformProps.has(wt)){gt=!0;continue}else if(isCSSVariableName(wt)){mt[wt]=vt;continue}else{const Ct=getValueAsType(vt,numberValueTypes[wt]);wt.startsWith("origin")?(bt=!0,pt[wt]=Ct):ft[wt]=Ct}}if(_.transform||(gt||lt?ft.transform=buildTransform(_,it.transform,lt):ft.transform&&(ft.transform="none")),bt){const{originX:wt="50%",originY:vt="50%",originZ:Ct=0}=pt;ft.transformOrigin=`${wt} ${vt} ${Ct}`}}function calcOrigin(it,_,lt){return typeof it=="string"?it:px.transform(_+lt*it)}function calcSVGTransformOrigin(it,_,lt){const ft=calcOrigin(_,it.x,it.width),mt=calcOrigin(lt,it.y,it.height);return`${ft} ${mt}`}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(it,_,lt=1,ft=0,mt=!0){it.pathLength=1;const pt=mt?dashKeys:camelKeys;it[pt.offset]=px.transform(-ft);const gt=px.transform(_),bt=px.transform(lt);it[pt.array]=`${gt} ${bt}`}function buildSVGAttrs(it,{attrX:_,attrY:lt,attrScale:ft,originX:mt,originY:pt,pathLength:gt,pathSpacing:bt=1,pathOffset:wt=0,...vt},Ct,Rt){if(buildHTMLStyles(it,vt,Rt),Ct){it.style.viewBox&&(it.attrs.viewBox=it.style.viewBox);return}it.attrs=it.style,it.style={};const{attrs:Mt,style:Ot,dimensions:Nt}=it;Mt.transform&&(Nt&&(Ot.transform=Mt.transform),delete Mt.transform),Nt&&(mt!==void 0||pt!==void 0||Ot.transform)&&(Ot.transformOrigin=calcSVGTransformOrigin(Nt,mt!==void 0?mt:.5,pt!==void 0?pt:.5)),_!==void 0&&(Mt.x=_),lt!==void 0&&(Mt.y=lt),ft!==void 0&&(Mt.scale=ft),gt!==void 0&&buildSVGPath(Mt,gt,bt,wt,!1)}const isSVGTag=it=>typeof it=="string"&&it.toLowerCase()==="svg",svgMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState,onMount:(it,_,{renderState:lt,latestValues:ft})=>{frame.read(()=>{try{lt.dimensions=typeof _.getBBox=="function"?_.getBBox():_.getBoundingClientRect()}catch{lt.dimensions={x:0,y:0,width:0,height:0}}}),frame.render(()=>{buildSVGAttrs(lt,ft,isSVGTag(_.tagName),it.transformTemplate),renderSVG(_,lt)})}})},htmlMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState})};function copyRawValuesOnly(it,_,lt){for(const ft in _)!isMotionValue(_[ft])&&!isForcedMotionValue(ft,lt)&&(it[ft]=_[ft])}function useInitialMotionValues({transformTemplate:it},_){return reactExports.useMemo(()=>{const lt=createHtmlRenderState();return buildHTMLStyles(lt,_,it),Object.assign({},lt.vars,lt.style)},[_])}function useStyle(it,_){const lt=it.style||{},ft={};return copyRawValuesOnly(ft,lt,it),Object.assign(ft,useInitialMotionValues(it,_)),ft}function useHTMLProps(it,_){const lt={},ft=useStyle(it,_);return it.drag&&it.dragListener!==!1&&(lt.draggable=!1,ft.userSelect=ft.WebkitUserSelect=ft.WebkitTouchCallout="none",ft.touchAction=it.drag===!0?"none":`pan-${it.drag==="x"?"y":"x"}`),it.tabIndex===void 0&&(it.onTap||it.onTapStart||it.whileTap)&&(lt.tabIndex=0),lt.style=ft,lt}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(it){return it.startsWith("while")||it.startsWith("drag")&&it!=="draggable"||it.startsWith("layout")||it.startsWith("onTap")||it.startsWith("onPan")||it.startsWith("onLayout")||validMotionProps.has(it)}let shouldForward=it=>!isValidMotionProp(it);function loadExternalIsValidProp(it){it&&(shouldForward=_=>_.startsWith("on")?!isValidMotionProp(_):it(_))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(it,_,lt){const ft={};for(const mt in it)mt==="values"&&typeof it.values=="object"||(shouldForward(mt)||lt===!0&&isValidMotionProp(mt)||!_&&!isValidMotionProp(mt)||it.draggable&&mt.startsWith("onDrag"))&&(ft[mt]=it[mt]);return ft}function useSVGProps(it,_,lt,ft){const mt=reactExports.useMemo(()=>{const pt=createSvgRenderState();return buildSVGAttrs(pt,_,isSVGTag(ft),it.transformTemplate),{...pt.attrs,style:{...pt.style}}},[_]);if(it.style){const pt={};copyRawValuesOnly(pt,it.style,it),mt.style={...pt,...mt.style}}return mt}function createUseRender(it=!1){return(lt,ft,mt,{latestValues:pt},gt)=>{const wt=(isSVGComponent(lt)?useSVGProps:useHTMLProps)(ft,pt,gt,lt),vt=filterProps(ft,typeof lt=="string",it),Ct=lt!==reactExports.Fragment?{...vt,...wt,ref:mt}:{},{children:Rt}=ft,Mt=reactExports.useMemo(()=>isMotionValue(Rt)?Rt.get():Rt,[Rt]);return reactExports.createElement(lt,{...Ct,children:Mt})}}function createMotionComponentFactory(it,_){return function(ft,{forwardMotionProps:mt}={forwardMotionProps:!1}){const gt={...isSVGComponent(ft)?svgMotionConfig:htmlMotionConfig,preloadedFeatures:it,useRender:createUseRender(mt),createVisualElement:_,Component:ft};return createRendererMotionComponent(gt)}}const prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const it=window.matchMedia("(prefers-reduced-motion)"),_=()=>prefersReducedMotion.current=it.matches;it.addListener(_),_()}else prefersReducedMotion.current=!1}function updateMotionValuesFromProps(it,_,lt){for(const ft in _){const mt=_[ft],pt=lt[ft];if(isMotionValue(mt))it.addValue(ft,mt);else if(isMotionValue(pt))it.addValue(ft,motionValue(mt,{owner:it}));else if(pt!==mt)if(it.hasValue(ft)){const gt=it.getValue(ft);gt.liveStyle===!0?gt.jump(mt):gt.hasAnimated||gt.set(mt)}else{const gt=it.getStaticValue(ft);it.addValue(ft,motionValue(gt!==void 0?gt:mt,{owner:it}))}}for(const ft in lt)_[ft]===void 0&&it.removeValue(ft);return _}const visualElementStore=new WeakMap,valueTypes=[...dimensionValueTypes,color,complex],findValueType=it=>valueTypes.find(testValueType(it)),propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(_,lt,ft){return{}}constructor({parent:_,props:lt,presenceContext:ft,reducedMotionConfig:mt,blockInitialAnimation:pt,visualState:gt},bt={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Mt=time.now();this.renderScheduledAt<Mt&&(this.renderScheduledAt=Mt,frame.render(this.render,!1,!0))};const{latestValues:wt,renderState:vt}=gt;this.latestValues=wt,this.baseTarget={...wt},this.initialValues=lt.initial?{...wt}:{},this.renderState=vt,this.parent=_,this.props=lt,this.presenceContext=ft,this.depth=_?_.depth+1:0,this.reducedMotionConfig=mt,this.options=bt,this.blockInitialAnimation=!!pt,this.isControllingVariants=isControllingVariants(lt),this.isVariantNode=isVariantNode(lt),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(_&&_.current);const{willChange:Ct,...Rt}=this.scrapeMotionValuesFromProps(lt,{},this);for(const Mt in Rt){const Ot=Rt[Mt];wt[Mt]!==void 0&&isMotionValue(Ot)&&Ot.set(wt[Mt],!1)}}mount(_){this.current=_,visualElementStore.set(_,this),this.projection&&!this.projection.instance&&this.projection.mount(_),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((lt,ft)=>this.bindToMotionValue(ft,lt)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){visualElementStore.delete(this.current),this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(_=>_()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const _ in this.events)this.events[_].clear();for(const _ in this.features){const lt=this.features[_];lt&&(lt.unmount(),lt.isMounted=!1)}this.current=null}bindToMotionValue(_,lt){this.valueSubscriptions.has(_)&&this.valueSubscriptions.get(_)();const ft=transformProps.has(_),mt=lt.on("change",bt=>{this.latestValues[_]=bt,this.props.onUpdate&&frame.preRender(this.notifyUpdate),ft&&this.projection&&(this.projection.isTransformDirty=!0)}),pt=lt.on("renderRequest",this.scheduleRender);let gt;window.MotionCheckAppearSync&&(gt=window.MotionCheckAppearSync(this,_,lt)),this.valueSubscriptions.set(_,()=>{mt(),pt(),gt&&gt(),lt.owner&&lt.stop()})}sortNodePosition(_){return!this.current||!this.sortInstanceNodePosition||this.type!==_.type?0:this.sortInstanceNodePosition(this.current,_.current)}updateFeatures(){let _="animation";for(_ in featureDefinitions){const lt=featureDefinitions[_];if(!lt)continue;const{isEnabled:ft,Feature:mt}=lt;if(!this.features[_]&&mt&&ft(this.props)&&(this.features[_]=new mt(this)),this.features[_]){const pt=this.features[_];pt.isMounted?pt.update():(pt.mount(),pt.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(_){return this.latestValues[_]}setStaticValue(_,lt){this.latestValues[_]=lt}update(_,lt){(_.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=_,this.prevPresenceContext=this.presenceContext,this.presenceContext=lt;for(let ft=0;ft<propEventHandlers.length;ft++){const mt=propEventHandlers[ft];this.propEventSubscriptions[mt]&&(this.propEventSubscriptions[mt](),delete this.propEventSubscriptions[mt]);const pt="on"+mt,gt=_[pt];gt&&(this.propEventSubscriptions[mt]=this.on(mt,gt))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(_,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(_){return this.props.variants?this.props.variants[_]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(_){const lt=this.getClosestVariantNode();if(lt)return lt.variantChildren&&lt.variantChildren.add(_),()=>lt.variantChildren.delete(_)}addValue(_,lt){const ft=this.values.get(_);lt!==ft&&(ft&&this.removeValue(_),this.bindToMotionValue(_,lt),this.values.set(_,lt),this.latestValues[_]=lt.get())}removeValue(_){this.values.delete(_);const lt=this.valueSubscriptions.get(_);lt&&(lt(),this.valueSubscriptions.delete(_)),delete this.latestValues[_],this.removeValueFromRenderState(_,this.renderState)}hasValue(_){return this.values.has(_)}getValue(_,lt){if(this.props.values&&this.props.values[_])return this.props.values[_];let ft=this.values.get(_);return ft===void 0&&lt!==void 0&&(ft=motionValue(lt===null?void 0:lt,{owner:this}),this.addValue(_,ft)),ft}readValue(_,lt){var ft;let mt=this.latestValues[_]!==void 0||!this.current?this.latestValues[_]:(ft=this.getBaseTargetFromProps(this.props,_))!==null&&ft!==void 0?ft:this.readValueFromInstance(this.current,_,this.options);return mt!=null&&(typeof mt=="string"&&(isNumericalString(mt)||isZeroValueString(mt))?mt=parseFloat(mt):!findValueType(mt)&&complex.test(lt)&&(mt=getAnimatableNone(_,lt)),this.setBaseTarget(_,isMotionValue(mt)?mt.get():mt)),isMotionValue(mt)?mt.get():mt}setBaseTarget(_,lt){this.baseTarget[_]=lt}getBaseTarget(_){var lt;const{initial:ft}=this.props;let mt;if(typeof ft=="string"||typeof ft=="object"){const gt=resolveVariantFromProps(this.props,ft,(lt=this.presenceContext)===null||lt===void 0?void 0:lt.custom);gt&&(mt=gt[_])}if(ft&&mt!==void 0)return mt;const pt=this.getBaseTargetFromProps(this.props,_);return pt!==void 0&&!isMotionValue(pt)?pt:this.initialValues[_]!==void 0&&mt===void 0?void 0:this.baseTarget[_]}on(_,lt){return this.events[_]||(this.events[_]=new SubscriptionManager),this.events[_].add(lt)}notify(_,...lt){this.events[_]&&this.events[_].notify(...lt)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(_,lt){return _.compareDocumentPosition(lt)&2?1:-1}getBaseTargetFromProps(_,lt){return _.style?_.style[lt]:void 0}removeValueFromRenderState(_,{vars:lt,style:ft}){delete lt[_],delete ft[_]}}function getComputedStyle(it){return window.getComputedStyle(it)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(_,lt){if(transformProps.has(lt)){const ft=getDefaultValueType(lt);return ft&&ft.default||0}else{const ft=getComputedStyle(_),mt=(isCSSVariableName(lt)?ft.getPropertyValue(lt):ft[lt])||0;return typeof mt=="string"?mt.trim():mt}}measureInstanceViewportBox(_,{transformPagePoint:lt}){return measureViewportBox(_,lt)}build(_,lt,ft){buildHTMLStyles(_,lt,ft.transformTemplate)}scrapeMotionValuesFromProps(_,lt,ft){return scrapeMotionValuesFromProps$1(_,lt,ft)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:_}=this.props;isMotionValue(_)&&(this.childSubscription=_.on("change",lt=>{this.current&&(this.current.textContent=`${lt}`)}))}}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(_,lt){return _[lt]}readValueFromInstance(_,lt){if(transformProps.has(lt)){const ft=getDefaultValueType(lt);return ft&&ft.default||0}return lt=camelCaseAttributes.has(lt)?lt:camelToDash(lt),_.getAttribute(lt)}scrapeMotionValuesFromProps(_,lt,ft){return scrapeMotionValuesFromProps(_,lt,ft)}build(_,lt,ft){buildSVGAttrs(_,lt,this.isSVGTag,ft.transformTemplate)}renderInstance(_,lt,ft,mt){renderSVG(_,lt,ft,mt)}mount(_){this.isSVGTag=isSVGTag(_.tagName),super.mount(_)}}const createDomVisualElement=(it,_)=>isSVGComponent(it)?new SVGVisualElement(_):new HTMLVisualElement(_,{allowProjection:it!==reactExports.Fragment}),createMotionComponent=createMotionComponentFactory({...animations,...gestureAnimations,...drag,...layout},createDomVisualElement),motion=createDOMMotionComponentProxy(createMotionComponent);var ENV=(it=>(it[it.WEBGL_LEGACY=0]="WEBGL_LEGACY",it[it.WEBGL=1]="WEBGL",it[it.WEBGL2=2]="WEBGL2",it))(ENV||{}),RENDERER_TYPE=(it=>(it[it.UNKNOWN=0]="UNKNOWN",it[it.WEBGL=1]="WEBGL",it[it.CANVAS=2]="CANVAS",it))(RENDERER_TYPE||{}),BUFFER_BITS=(it=>(it[it.COLOR=16384]="COLOR",it[it.DEPTH=256]="DEPTH",it[it.STENCIL=1024]="STENCIL",it))(BUFFER_BITS||{}),BLEND_MODES=(it=>(it[it.NORMAL=0]="NORMAL",it[it.ADD=1]="ADD",it[it.MULTIPLY=2]="MULTIPLY",it[it.SCREEN=3]="SCREEN",it[it.OVERLAY=4]="OVERLAY",it[it.DARKEN=5]="DARKEN",it[it.LIGHTEN=6]="LIGHTEN",it[it.COLOR_DODGE=7]="COLOR_DODGE",it[it.COLOR_BURN=8]="COLOR_BURN",it[it.HARD_LIGHT=9]="HARD_LIGHT",it[it.SOFT_LIGHT=10]="SOFT_LIGHT",it[it.DIFFERENCE=11]="DIFFERENCE",it[it.EXCLUSION=12]="EXCLUSION",it[it.HUE=13]="HUE",it[it.SATURATION=14]="SATURATION",it[it.COLOR=15]="COLOR",it[it.LUMINOSITY=16]="LUMINOSITY",it[it.NORMAL_NPM=17]="NORMAL_NPM",it[it.ADD_NPM=18]="ADD_NPM",it[it.SCREEN_NPM=19]="SCREEN_NPM",it[it.NONE=20]="NONE",it[it.SRC_OVER=0]="SRC_OVER",it[it.SRC_IN=21]="SRC_IN",it[it.SRC_OUT=22]="SRC_OUT",it[it.SRC_ATOP=23]="SRC_ATOP",it[it.DST_OVER=24]="DST_OVER",it[it.DST_IN=25]="DST_IN",it[it.DST_OUT=26]="DST_OUT",it[it.DST_ATOP=27]="DST_ATOP",it[it.ERASE=26]="ERASE",it[it.SUBTRACT=28]="SUBTRACT",it[it.XOR=29]="XOR",it))(BLEND_MODES||{}),DRAW_MODES=(it=>(it[it.POINTS=0]="POINTS",it[it.LINES=1]="LINES",it[it.LINE_LOOP=2]="LINE_LOOP",it[it.LINE_STRIP=3]="LINE_STRIP",it[it.TRIANGLES=4]="TRIANGLES",it[it.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",it[it.TRIANGLE_FAN=6]="TRIANGLE_FAN",it))(DRAW_MODES||{}),FORMATS=(it=>(it[it.RGBA=6408]="RGBA",it[it.RGB=6407]="RGB",it[it.RG=33319]="RG",it[it.RED=6403]="RED",it[it.RGBA_INTEGER=36249]="RGBA_INTEGER",it[it.RGB_INTEGER=36248]="RGB_INTEGER",it[it.RG_INTEGER=33320]="RG_INTEGER",it[it.RED_INTEGER=36244]="RED_INTEGER",it[it.ALPHA=6406]="ALPHA",it[it.LUMINANCE=6409]="LUMINANCE",it[it.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",it[it.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",it[it.DEPTH_STENCIL=34041]="DEPTH_STENCIL",it))(FORMATS||{}),TARGETS=(it=>(it[it.TEXTURE_2D=3553]="TEXTURE_2D",it[it.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",it[it.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",it[it.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",it[it.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",it[it.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",it[it.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",it[it.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",it[it.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",it))(TARGETS||{}),TYPES=(it=>(it[it.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",it[it.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",it[it.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",it[it.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",it[it.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",it[it.UNSIGNED_INT=5125]="UNSIGNED_INT",it[it.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",it[it.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",it[it.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",it[it.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",it[it.BYTE=5120]="BYTE",it[it.SHORT=5122]="SHORT",it[it.INT=5124]="INT",it[it.FLOAT=5126]="FLOAT",it[it.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",it[it.HALF_FLOAT=36193]="HALF_FLOAT",it))(TYPES||{}),SAMPLER_TYPES=(it=>(it[it.FLOAT=0]="FLOAT",it[it.INT=1]="INT",it[it.UINT=2]="UINT",it))(SAMPLER_TYPES||{}),SCALE_MODES=(it=>(it[it.NEAREST=0]="NEAREST",it[it.LINEAR=1]="LINEAR",it))(SCALE_MODES||{}),WRAP_MODES=(it=>(it[it.CLAMP=33071]="CLAMP",it[it.REPEAT=10497]="REPEAT",it[it.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",it))(WRAP_MODES||{}),MIPMAP_MODES=(it=>(it[it.OFF=0]="OFF",it[it.POW2=1]="POW2",it[it.ON=2]="ON",it[it.ON_MANUAL=3]="ON_MANUAL",it))(MIPMAP_MODES||{}),ALPHA_MODES=(it=>(it[it.NPM=0]="NPM",it[it.UNPACK=1]="UNPACK",it[it.PMA=2]="PMA",it[it.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",it[it.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",it[it.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",it))(ALPHA_MODES||{}),CLEAR_MODES=(it=>(it[it.NO=0]="NO",it[it.YES=1]="YES",it[it.AUTO=2]="AUTO",it[it.BLEND=0]="BLEND",it[it.CLEAR=1]="CLEAR",it[it.BLIT=2]="BLIT",it))(CLEAR_MODES||{}),GC_MODES=(it=>(it[it.AUTO=0]="AUTO",it[it.MANUAL=1]="MANUAL",it))(GC_MODES||{}),PRECISION=(it=>(it.LOW="lowp",it.MEDIUM="mediump",it.HIGH="highp",it))(PRECISION||{}),MASK_TYPES=(it=>(it[it.NONE=0]="NONE",it[it.SCISSOR=1]="SCISSOR",it[it.STENCIL=2]="STENCIL",it[it.SPRITE=3]="SPRITE",it[it.COLOR=4]="COLOR",it))(MASK_TYPES||{}),MSAA_QUALITY=(it=>(it[it.NONE=0]="NONE",it[it.LOW=2]="LOW",it[it.MEDIUM=4]="MEDIUM",it[it.HIGH=8]="HIGH",it))(MSAA_QUALITY||{}),BUFFER_TYPE=(it=>(it[it.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",it[it.ARRAY_BUFFER=34962]="ARRAY_BUFFER",it[it.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",it))(BUFFER_TYPE||{});const BrowserAdapter={createCanvas:(it,_)=>{const lt=document.createElement("canvas");return lt.width=it,lt.height=_,lt},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(it,_)=>fetch(it,_),parseXML:it=>new DOMParser().parseFromString(it,"text/xml")},settings={ADAPTER:BrowserAdapter,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(it){return typeof it<"u"&&it.platform==="MacIntel"&&typeof it.maxTouchPoints=="number"&&it.maxTouchPoints>1&&typeof MSStream>"u"};function createMatch(it){return function(_){return _.test(it)}}function isMobile$2(it){var _={userAgent:"",platform:"",maxTouchPoints:0};!it&&typeof navigator<"u"?_={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof it=="string"?_.userAgent=it:it&&it.userAgent&&(_={userAgent:it.userAgent,platform:it.platform,maxTouchPoints:it.maxTouchPoints||0});var lt=_.userAgent,ft=lt.split("[FBAN");typeof ft[1]<"u"&&(lt=ft[0]),ft=lt.split("Twitter"),typeof ft[1]<"u"&&(lt=ft[0]);var mt=createMatch(lt),pt={apple:{phone:mt(appleIphone)&&!mt(windowsPhone),ipod:mt(appleIpod),tablet:!mt(appleIphone)&&(mt(appleTablet)||isAppleTabletOnIos13(_))&&!mt(windowsPhone),universal:mt(appleUniversal),device:(mt(appleIphone)||mt(appleIpod)||mt(appleTablet)||mt(appleUniversal)||isAppleTabletOnIos13(_))&&!mt(windowsPhone)},amazon:{phone:mt(amazonPhone),tablet:!mt(amazonPhone)&&mt(amazonTablet),device:mt(amazonPhone)||mt(amazonTablet)},android:{phone:!mt(windowsPhone)&&mt(amazonPhone)||!mt(windowsPhone)&&mt(androidPhone),tablet:!mt(windowsPhone)&&!mt(amazonPhone)&&!mt(androidPhone)&&(mt(amazonTablet)||mt(androidTablet)),device:!mt(windowsPhone)&&(mt(amazonPhone)||mt(amazonTablet)||mt(androidPhone)||mt(androidTablet))||mt(/\bokhttp\b/i)},windows:{phone:mt(windowsPhone),tablet:mt(windowsTablet),device:mt(windowsPhone)||mt(windowsTablet)},other:{blackberry:mt(otherBlackBerry),blackberry10:mt(otherBlackBerry10),opera:mt(otherOpera),firefox:mt(otherFirefox),chrome:mt(otherChrome),device:mt(otherBlackBerry)||mt(otherBlackBerry10)||mt(otherOpera)||mt(otherFirefox)||mt(otherChrome)},any:!1,phone:!1,tablet:!1};return pt.any=pt.apple.device||pt.android.device||pt.windows.device||pt.other.device,pt.phone=pt.apple.phone||pt.android.phone||pt.windows.phone,pt.tablet=pt.apple.tablet||pt.android.tablet||pt.windows.tablet,pt}const isMobileCall=isMobile$2.default??isMobile$2,isMobile$1=isMobileCall(globalThis.navigator);settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var eventemitter3={exports:{}};(function(it){var _=Object.prototype.hasOwnProperty,lt="~";function ft(){}Object.create&&(ft.prototype=Object.create(null),new ft().__proto__||(lt=!1));function mt(wt,vt,Ct){this.fn=wt,this.context=vt,this.once=Ct||!1}function pt(wt,vt,Ct,Rt,Mt){if(typeof Ct!="function")throw new TypeError("The listener must be a function");var Ot=new mt(Ct,Rt||wt,Mt),Nt=lt?lt+vt:vt;return wt._events[Nt]?wt._events[Nt].fn?wt._events[Nt]=[wt._events[Nt],Ot]:wt._events[Nt].push(Ot):(wt._events[Nt]=Ot,wt._eventsCount++),wt}function gt(wt,vt){--wt._eventsCount===0?wt._events=new ft:delete wt._events[vt]}function bt(){this._events=new ft,this._eventsCount=0}bt.prototype.eventNames=function(){var vt=[],Ct,Rt;if(this._eventsCount===0)return vt;for(Rt in Ct=this._events)_.call(Ct,Rt)&&vt.push(lt?Rt.slice(1):Rt);return Object.getOwnPropertySymbols?vt.concat(Object.getOwnPropertySymbols(Ct)):vt},bt.prototype.listeners=function(vt){var Ct=lt?lt+vt:vt,Rt=this._events[Ct];if(!Rt)return[];if(Rt.fn)return[Rt.fn];for(var Mt=0,Ot=Rt.length,Nt=new Array(Ot);Mt<Ot;Mt++)Nt[Mt]=Rt[Mt].fn;return Nt},bt.prototype.listenerCount=function(vt){var Ct=lt?lt+vt:vt,Rt=this._events[Ct];return Rt?Rt.fn?1:Rt.length:0},bt.prototype.emit=function(vt,Ct,Rt,Mt,Ot,Nt){var Ht=lt?lt+vt:vt;if(!this._events[Ht])return!1;var Kt=this._events[Ht],hr=arguments.length,Qt,mr;if(Kt.fn){switch(Kt.once&&this.removeListener(vt,Kt.fn,void 0,!0),hr){case 1:return Kt.fn.call(Kt.context),!0;case 2:return Kt.fn.call(Kt.context,Ct),!0;case 3:return Kt.fn.call(Kt.context,Ct,Rt),!0;case 4:return Kt.fn.call(Kt.context,Ct,Rt,Mt),!0;case 5:return Kt.fn.call(Kt.context,Ct,Rt,Mt,Ot),!0;case 6:return Kt.fn.call(Kt.context,Ct,Rt,Mt,Ot,Nt),!0}for(mr=1,Qt=new Array(hr-1);mr<hr;mr++)Qt[mr-1]=arguments[mr];Kt.fn.apply(Kt.context,Qt)}else{var br=Kt.length,Fr;for(mr=0;mr<br;mr++)switch(Kt[mr].once&&this.removeListener(vt,Kt[mr].fn,void 0,!0),hr){case 1:Kt[mr].fn.call(Kt[mr].context);break;case 2:Kt[mr].fn.call(Kt[mr].context,Ct);break;case 3:Kt[mr].fn.call(Kt[mr].context,Ct,Rt);break;case 4:Kt[mr].fn.call(Kt[mr].context,Ct,Rt,Mt);break;default:if(!Qt)for(Fr=1,Qt=new Array(hr-1);Fr<hr;Fr++)Qt[Fr-1]=arguments[Fr];Kt[mr].fn.apply(Kt[mr].context,Qt)}}return!0},bt.prototype.on=function(vt,Ct,Rt){return pt(this,vt,Ct,Rt,!1)},bt.prototype.once=function(vt,Ct,Rt){return pt(this,vt,Ct,Rt,!0)},bt.prototype.removeListener=function(vt,Ct,Rt,Mt){var Ot=lt?lt+vt:vt;if(!this._events[Ot])return this;if(!Ct)return gt(this,Ot),this;var Nt=this._events[Ot];if(Nt.fn)Nt.fn===Ct&&(!Mt||Nt.once)&&(!Rt||Nt.context===Rt)&&gt(this,Ot);else{for(var Ht=0,Kt=[],hr=Nt.length;Ht<hr;Ht++)(Nt[Ht].fn!==Ct||Mt&&!Nt[Ht].once||Rt&&Nt[Ht].context!==Rt)&&Kt.push(Nt[Ht]);Kt.length?this._events[Ot]=Kt.length===1?Kt[0]:Kt:gt(this,Ot)}return this},bt.prototype.removeAllListeners=function(vt){var Ct;return vt?(Ct=lt?lt+vt:vt,this._events[Ct]&&gt(this,Ct)):(this._events=new ft,this._eventsCount=0),this},bt.prototype.off=bt.prototype.removeListener,bt.prototype.addListener=bt.prototype.on,bt.prefixed=lt,bt.EventEmitter=bt,it.exports=bt})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);var earcut$2={exports:{}};earcut$2.exports=earcut;earcut$2.exports.default=earcut;function earcut(it,_,lt){lt=lt||2;var ft=_&&_.length,mt=ft?_[0]*lt:it.length,pt=linkedList(it,0,mt,lt,!0),gt=[];if(!pt||pt.next===pt.prev)return gt;var bt,wt,vt,Ct,Rt,Mt,Ot;if(ft&&(pt=eliminateHoles(it,_,pt,lt)),it.length>80*lt){bt=vt=it[0],wt=Ct=it[1];for(var Nt=lt;Nt<mt;Nt+=lt)Rt=it[Nt],Mt=it[Nt+1],Rt<bt&&(bt=Rt),Mt<wt&&(wt=Mt),Rt>vt&&(vt=Rt),Mt>Ct&&(Ct=Mt);Ot=Math.max(vt-bt,Ct-wt),Ot=Ot!==0?32767/Ot:0}return earcutLinked(pt,gt,lt,bt,wt,Ot,0),gt}function linkedList(it,_,lt,ft,mt){var pt,gt;if(mt===signedArea(it,_,lt,ft)>0)for(pt=_;pt<lt;pt+=ft)gt=insertNode(pt,it[pt],it[pt+1],gt);else for(pt=lt-ft;pt>=_;pt-=ft)gt=insertNode(pt,it[pt],it[pt+1],gt);return gt&&equals(gt,gt.next)&&(removeNode(gt),gt=gt.next),gt}function filterPoints(it,_){if(!it)return it;_||(_=it);var lt=it,ft;do if(ft=!1,!lt.steiner&&(equals(lt,lt.next)||area(lt.prev,lt,lt.next)===0)){if(removeNode(lt),lt=_=lt.prev,lt===lt.next)break;ft=!0}else lt=lt.next;while(ft||lt!==_);return _}function earcutLinked(it,_,lt,ft,mt,pt,gt){if(it){!gt&&pt&&indexCurve(it,ft,mt,pt);for(var bt=it,wt,vt;it.prev!==it.next;){if(wt=it.prev,vt=it.next,pt?isEarHashed(it,ft,mt,pt):isEar(it)){_.push(wt.i/lt|0),_.push(it.i/lt|0),_.push(vt.i/lt|0),removeNode(it),it=vt.next,bt=vt.next;continue}if(it=vt,it===bt){gt?gt===1?(it=cureLocalIntersections(filterPoints(it),_,lt),earcutLinked(it,_,lt,ft,mt,pt,2)):gt===2&&splitEarcut(it,_,lt,ft,mt,pt):earcutLinked(filterPoints(it),_,lt,ft,mt,pt,1);break}}}}function isEar(it){var _=it.prev,lt=it,ft=it.next;if(area(_,lt,ft)>=0)return!1;for(var mt=_.x,pt=lt.x,gt=ft.x,bt=_.y,wt=lt.y,vt=ft.y,Ct=mt<pt?mt<gt?mt:gt:pt<gt?pt:gt,Rt=bt<wt?bt<vt?bt:vt:wt<vt?wt:vt,Mt=mt>pt?mt>gt?mt:gt:pt>gt?pt:gt,Ot=bt>wt?bt>vt?bt:vt:wt>vt?wt:vt,Nt=ft.next;Nt!==_;){if(Nt.x>=Ct&&Nt.x<=Mt&&Nt.y>=Rt&&Nt.y<=Ot&&pointInTriangle(mt,bt,pt,wt,gt,vt,Nt.x,Nt.y)&&area(Nt.prev,Nt,Nt.next)>=0)return!1;Nt=Nt.next}return!0}function isEarHashed(it,_,lt,ft){var mt=it.prev,pt=it,gt=it.next;if(area(mt,pt,gt)>=0)return!1;for(var bt=mt.x,wt=pt.x,vt=gt.x,Ct=mt.y,Rt=pt.y,Mt=gt.y,Ot=bt<wt?bt<vt?bt:vt:wt<vt?wt:vt,Nt=Ct<Rt?Ct<Mt?Ct:Mt:Rt<Mt?Rt:Mt,Ht=bt>wt?bt>vt?bt:vt:wt>vt?wt:vt,Kt=Ct>Rt?Ct>Mt?Ct:Mt:Rt>Mt?Rt:Mt,hr=zOrder(Ot,Nt,_,lt,ft),Qt=zOrder(Ht,Kt,_,lt,ft),mr=it.prevZ,br=it.nextZ;mr&&mr.z>=hr&&br&&br.z<=Qt;){if(mr.x>=Ot&&mr.x<=Ht&&mr.y>=Nt&&mr.y<=Kt&&mr!==mt&&mr!==gt&&pointInTriangle(bt,Ct,wt,Rt,vt,Mt,mr.x,mr.y)&&area(mr.prev,mr,mr.next)>=0||(mr=mr.prevZ,br.x>=Ot&&br.x<=Ht&&br.y>=Nt&&br.y<=Kt&&br!==mt&&br!==gt&&pointInTriangle(bt,Ct,wt,Rt,vt,Mt,br.x,br.y)&&area(br.prev,br,br.next)>=0))return!1;br=br.nextZ}for(;mr&&mr.z>=hr;){if(mr.x>=Ot&&mr.x<=Ht&&mr.y>=Nt&&mr.y<=Kt&&mr!==mt&&mr!==gt&&pointInTriangle(bt,Ct,wt,Rt,vt,Mt,mr.x,mr.y)&&area(mr.prev,mr,mr.next)>=0)return!1;mr=mr.prevZ}for(;br&&br.z<=Qt;){if(br.x>=Ot&&br.x<=Ht&&br.y>=Nt&&br.y<=Kt&&br!==mt&&br!==gt&&pointInTriangle(bt,Ct,wt,Rt,vt,Mt,br.x,br.y)&&area(br.prev,br,br.next)>=0)return!1;br=br.nextZ}return!0}function cureLocalIntersections(it,_,lt){var ft=it;do{var mt=ft.prev,pt=ft.next.next;!equals(mt,pt)&&intersects(mt,ft,ft.next,pt)&&locallyInside(mt,pt)&&locallyInside(pt,mt)&&(_.push(mt.i/lt|0),_.push(ft.i/lt|0),_.push(pt.i/lt|0),removeNode(ft),removeNode(ft.next),ft=it=pt),ft=ft.next}while(ft!==it);return filterPoints(ft)}function splitEarcut(it,_,lt,ft,mt,pt){var gt=it;do{for(var bt=gt.next.next;bt!==gt.prev;){if(gt.i!==bt.i&&isValidDiagonal(gt,bt)){var wt=splitPolygon(gt,bt);gt=filterPoints(gt,gt.next),wt=filterPoints(wt,wt.next),earcutLinked(gt,_,lt,ft,mt,pt,0),earcutLinked(wt,_,lt,ft,mt,pt,0);return}bt=bt.next}gt=gt.next}while(gt!==it)}function eliminateHoles(it,_,lt,ft){var mt=[],pt,gt,bt,wt,vt;for(pt=0,gt=_.length;pt<gt;pt++)bt=_[pt]*ft,wt=pt<gt-1?_[pt+1]*ft:it.length,vt=linkedList(it,bt,wt,ft,!1),vt===vt.next&&(vt.steiner=!0),mt.push(getLeftmost(vt));for(mt.sort(compareX),pt=0;pt<mt.length;pt++)lt=eliminateHole(mt[pt],lt);return lt}function compareX(it,_){return it.x-_.x}function eliminateHole(it,_){var lt=findHoleBridge(it,_);if(!lt)return _;var ft=splitPolygon(lt,it);return filterPoints(ft,ft.next),filterPoints(lt,lt.next)}function findHoleBridge(it,_){var lt=_,ft=it.x,mt=it.y,pt=-1/0,gt;do{if(mt<=lt.y&&mt>=lt.next.y&&lt.next.y!==lt.y){var bt=lt.x+(mt-lt.y)*(lt.next.x-lt.x)/(lt.next.y-lt.y);if(bt<=ft&&bt>pt&&(pt=bt,gt=lt.x<lt.next.x?lt:lt.next,bt===ft))return gt}lt=lt.next}while(lt!==_);if(!gt)return null;var wt=gt,vt=gt.x,Ct=gt.y,Rt=1/0,Mt;lt=gt;do ft>=lt.x&&lt.x>=vt&&ft!==lt.x&&pointInTriangle(mt<Ct?ft:pt,mt,vt,Ct,mt<Ct?pt:ft,mt,lt.x,lt.y)&&(Mt=Math.abs(mt-lt.y)/(ft-lt.x),locallyInside(lt,it)&&(Mt<Rt||Mt===Rt&&(lt.x>gt.x||lt.x===gt.x&&sectorContainsSector(gt,lt)))&&(gt=lt,Rt=Mt)),lt=lt.next;while(lt!==wt);return gt}function sectorContainsSector(it,_){return area(it.prev,it,_.prev)<0&&area(_.next,it,it.next)<0}function indexCurve(it,_,lt,ft){var mt=it;do mt.z===0&&(mt.z=zOrder(mt.x,mt.y,_,lt,ft)),mt.prevZ=mt.prev,mt.nextZ=mt.next,mt=mt.next;while(mt!==it);mt.prevZ.nextZ=null,mt.prevZ=null,sortLinked(mt)}function sortLinked(it){var _,lt,ft,mt,pt,gt,bt,wt,vt=1;do{for(lt=it,it=null,pt=null,gt=0;lt;){for(gt++,ft=lt,bt=0,_=0;_<vt&&(bt++,ft=ft.nextZ,!!ft);_++);for(wt=vt;bt>0||wt>0&&ft;)bt!==0&&(wt===0||!ft||lt.z<=ft.z)?(mt=lt,lt=lt.nextZ,bt--):(mt=ft,ft=ft.nextZ,wt--),pt?pt.nextZ=mt:it=mt,mt.prevZ=pt,pt=mt;lt=ft}pt.nextZ=null,vt*=2}while(gt>1);return it}function zOrder(it,_,lt,ft,mt){return it=(it-lt)*mt|0,_=(_-ft)*mt|0,it=(it|it<<8)&16711935,it=(it|it<<4)&252645135,it=(it|it<<2)&858993459,it=(it|it<<1)&1431655765,_=(_|_<<8)&16711935,_=(_|_<<4)&252645135,_=(_|_<<2)&858993459,_=(_|_<<1)&1431655765,it|_<<1}function getLeftmost(it){var _=it,lt=it;do(_.x<lt.x||_.x===lt.x&&_.y<lt.y)&&(lt=_),_=_.next;while(_!==it);return lt}function pointInTriangle(it,_,lt,ft,mt,pt,gt,bt){return(mt-gt)*(_-bt)>=(it-gt)*(pt-bt)&&(it-gt)*(ft-bt)>=(lt-gt)*(_-bt)&&(lt-gt)*(pt-bt)>=(mt-gt)*(ft-bt)}function isValidDiagonal(it,_){return it.next.i!==_.i&&it.prev.i!==_.i&&!intersectsPolygon(it,_)&&(locallyInside(it,_)&&locallyInside(_,it)&&middleInside(it,_)&&(area(it.prev,it,_.prev)||area(it,_.prev,_))||equals(it,_)&&area(it.prev,it,it.next)>0&&area(_.prev,_,_.next)>0)}function area(it,_,lt){return(_.y-it.y)*(lt.x-_.x)-(_.x-it.x)*(lt.y-_.y)}function equals(it,_){return it.x===_.x&&it.y===_.y}function intersects(it,_,lt,ft){var mt=sign$1(area(it,_,lt)),pt=sign$1(area(it,_,ft)),gt=sign$1(area(lt,ft,it)),bt=sign$1(area(lt,ft,_));return!!(mt!==pt&&gt!==bt||mt===0&&onSegment(it,lt,_)||pt===0&&onSegment(it,ft,_)||gt===0&&onSegment(lt,it,ft)||bt===0&&onSegment(lt,_,ft))}function onSegment(it,_,lt){return _.x<=Math.max(it.x,lt.x)&&_.x>=Math.min(it.x,lt.x)&&_.y<=Math.max(it.y,lt.y)&&_.y>=Math.min(it.y,lt.y)}function sign$1(it){return it>0?1:it<0?-1:0}function intersectsPolygon(it,_){var lt=it;do{if(lt.i!==it.i&&lt.next.i!==it.i&&lt.i!==_.i&&lt.next.i!==_.i&&intersects(lt,lt.next,it,_))return!0;lt=lt.next}while(lt!==it);return!1}function locallyInside(it,_){return area(it.prev,it,it.next)<0?area(it,_,it.next)>=0&&area(it,it.prev,_)>=0:area(it,_,it.prev)<0||area(it,it.next,_)<0}function middleInside(it,_){var lt=it,ft=!1,mt=(it.x+_.x)/2,pt=(it.y+_.y)/2;do lt.y>pt!=lt.next.y>pt&&lt.next.y!==lt.y&&mt<(lt.next.x-lt.x)*(pt-lt.y)/(lt.next.y-lt.y)+lt.x&&(ft=!ft),lt=lt.next;while(lt!==it);return ft}function splitPolygon(it,_){var lt=new Node(it.i,it.x,it.y),ft=new Node(_.i,_.x,_.y),mt=it.next,pt=_.prev;return it.next=_,_.prev=it,lt.next=mt,mt.prev=lt,ft.next=lt,lt.prev=ft,pt.next=ft,ft.prev=pt,ft}function insertNode(it,_,lt,ft){var mt=new Node(it,_,lt);return ft?(mt.next=ft.next,mt.prev=ft,ft.next.prev=mt,ft.next=mt):(mt.prev=mt,mt.next=mt),mt}function removeNode(it){it.next.prev=it.prev,it.prev.next=it.next,it.prevZ&&(it.prevZ.nextZ=it.nextZ),it.nextZ&&(it.nextZ.prevZ=it.prevZ)}function Node(it,_,lt){this.i=it,this.x=_,this.y=lt,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}earcut.deviation=function(it,_,lt,ft){var mt=_&&_.length,pt=mt?_[0]*lt:it.length,gt=Math.abs(signedArea(it,0,pt,lt));if(mt)for(var bt=0,wt=_.length;bt<wt;bt++){var vt=_[bt]*lt,Ct=bt<wt-1?_[bt+1]*lt:it.length;gt-=Math.abs(signedArea(it,vt,Ct,lt))}var Rt=0;for(bt=0;bt<ft.length;bt+=3){var Mt=ft[bt]*lt,Ot=ft[bt+1]*lt,Nt=ft[bt+2]*lt;Rt+=Math.abs((it[Mt]-it[Nt])*(it[Ot+1]-it[Mt+1])-(it[Mt]-it[Ot])*(it[Nt+1]-it[Mt+1]))}return gt===0&&Rt===0?0:Math.abs((Rt-gt)/gt)};function signedArea(it,_,lt,ft){for(var mt=0,pt=_,gt=lt-ft;pt<lt;pt+=ft)mt+=(it[gt]-it[pt])*(it[pt+1]+it[gt+1]),gt=pt;return mt}earcut.flatten=function(it){for(var _=it[0][0].length,lt={vertices:[],holes:[],dimensions:_},ft=0,mt=0;mt<it.length;mt++){for(var pt=0;pt<it[mt].length;pt++)for(var gt=0;gt<_;gt++)lt.vertices.push(it[mt][pt][gt]);mt>0&&(ft+=it[mt-1].length,lt.holes.push(ft))}return lt};var earcutExports=earcut$2.exports;const earcut$1=getDefaultExportFromCjs(earcutExports);var punycode$1={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */punycode$1.exports;(function(it,_){(function(lt){var ft=_&&!_.nodeType&&_,mt=it&&!it.nodeType&&it,pt=typeof commonjsGlobal=="object"&&commonjsGlobal;(pt.global===pt||pt.window===pt||pt.self===pt)&&(lt=pt);var gt,bt=2147483647,wt=36,vt=1,Ct=26,Rt=38,Mt=700,Ot=72,Nt=128,Ht="-",Kt=/^xn--/,hr=/[^\x20-\x7E]/,Qt=/[\x2E\u3002\uFF0E\uFF61]/g,mr={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},br=wt-vt,Fr=Math.floor,kr=String.fromCharCode,Br;function Nr(Zn){throw new RangeError(mr[Zn])}function jn(Zn,Qn){for(var ip=Zn.length,Sm=[];ip--;)Sm[ip]=Qn(Zn[ip]);return Sm}function Yn(Zn,Qn){var ip=Zn.split("@"),Sm="";ip.length>1&&(Sm=ip[0]+"@",Zn=ip[1]),Zn=Zn.replace(Qt,".");var Pm=Zn.split("."),Cm=jn(Pm,Qn).join(".");return Sm+Cm}function ga(Zn){for(var Qn=[],ip=0,Sm=Zn.length,Pm,Cm;ip<Sm;)Pm=Zn.charCodeAt(ip++),Pm>=55296&&Pm<=56319&&ip<Sm?(Cm=Zn.charCodeAt(ip++),(Cm&64512)==56320?Qn.push(((Pm&1023)<<10)+(Cm&1023)+65536):(Qn.push(Pm),ip--)):Qn.push(Pm);return Qn}function Kn(Zn){return jn(Zn,function(Qn){var ip="";return Qn>65535&&(Qn-=65536,ip+=kr(Qn>>>10&1023|55296),Qn=56320|Qn&1023),ip+=kr(Qn),ip}).join("")}function Xn(Zn){return Zn-48<10?Zn-22:Zn-65<26?Zn-65:Zn-97<26?Zn-97:wt}function eo(Zn,Qn){return Zn+22+75*(Zn<26)-((Qn!=0)<<5)}function lp(Zn,Qn,ip){var Sm=0;for(Zn=ip?Fr(Zn/Mt):Zn>>1,Zn+=Fr(Zn/Qn);Zn>br*Ct>>1;Sm+=wt)Zn=Fr(Zn/br);return Fr(Sm+(br+1)*Zn/(Zn+Rt))}function $a(Zn){var Qn=[],ip=Zn.length,Sm,Pm=0,Cm=Nt,Im=Ot,Rm,Nm,Vm,Mm,Tm,Om,$m,Xm,zm;for(Rm=Zn.lastIndexOf(Ht),Rm<0&&(Rm=0),Nm=0;Nm<Rm;++Nm)Zn.charCodeAt(Nm)>=128&&Nr("not-basic"),Qn.push(Zn.charCodeAt(Nm));for(Vm=Rm>0?Rm+1:0;Vm<ip;){for(Mm=Pm,Tm=1,Om=wt;Vm>=ip&&Nr("invalid-input"),$m=Xn(Zn.charCodeAt(Vm++)),($m>=wt||$m>Fr((bt-Pm)/Tm))&&Nr("overflow"),Pm+=$m*Tm,Xm=Om<=Im?vt:Om>=Im+Ct?Ct:Om-Im,!($m<Xm);Om+=wt)zm=wt-Xm,Tm>Fr(bt/zm)&&Nr("overflow"),Tm*=zm;Sm=Qn.length+1,Im=lp(Pm-Mm,Sm,Mm==0),Fr(Pm/Sm)>bt-Cm&&Nr("overflow"),Cm+=Fr(Pm/Sm),Pm%=Sm,Qn.splice(Pm++,0,Cm)}return Kn(Qn)}function ro(Zn){var Qn,ip,Sm,Pm,Cm,Im,Rm,Nm,Vm,Mm,Tm,Om=[],$m,Xm,zm,ny;for(Zn=ga(Zn),$m=Zn.length,Qn=Nt,ip=0,Cm=Ot,Im=0;Im<$m;++Im)Tm=Zn[Im],Tm<128&&Om.push(kr(Tm));for(Sm=Pm=Om.length,Pm&&Om.push(Ht);Sm<$m;){for(Rm=bt,Im=0;Im<$m;++Im)Tm=Zn[Im],Tm>=Qn&&Tm<Rm&&(Rm=Tm);for(Xm=Sm+1,Rm-Qn>Fr((bt-ip)/Xm)&&Nr("overflow"),ip+=(Rm-Qn)*Xm,Qn=Rm,Im=0;Im<$m;++Im)if(Tm=Zn[Im],Tm<Qn&&++ip>bt&&Nr("overflow"),Tm==Qn){for(Nm=ip,Vm=wt;Mm=Vm<=Cm?vt:Vm>=Cm+Ct?Ct:Vm-Cm,!(Nm<Mm);Vm+=wt)ny=Nm-Mm,zm=wt-Mm,Om.push(kr(eo(Mm+ny%zm,0))),Nm=Fr(ny/zm);Om.push(kr(eo(Nm,0))),Cm=lp(ip,Xm,Sm==Pm),ip=0,++Sm}++ip,++Qn}return Om.join("")}function bs(Zn){return Yn(Zn,function(Qn){return Kt.test(Qn)?$a(Qn.slice(4).toLowerCase()):Qn})}function ba(Zn){return Yn(Zn,function(Qn){return hr.test(Qn)?"xn--"+ro(Qn):Qn})}if(gt={version:"1.4.1",ucs2:{decode:ga,encode:Kn},decode:$a,encode:ro,toASCII:ba,toUnicode:bs},ft&&mt)if(it.exports==ft)mt.exports=gt;else for(Br in gt)gt.hasOwnProperty(Br)&&(ft[Br]=gt[Br]);else lt.punycode=gt})(commonjsGlobal)})(punycode$1,punycode$1.exports);var punycodeExports=punycode$1.exports,esErrors=Error,_eval=EvalError,range=RangeError,ref=ReferenceError,syntax=SyntaxError,type=TypeError,uri=URIError,shams=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var _={},lt=Symbol("test"),ft=Object(lt);if(typeof lt=="string"||Object.prototype.toString.call(lt)!=="[object Symbol]"||Object.prototype.toString.call(ft)!=="[object Symbol]")return!1;var mt=42;_[lt]=mt;for(lt in _)return!1;if(typeof Object.keys=="function"&&Object.keys(_).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(_).length!==0)return!1;var pt=Object.getOwnPropertySymbols(_);if(pt.length!==1||pt[0]!==lt||!Object.prototype.propertyIsEnumerable.call(_,lt))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var gt=Object.getOwnPropertyDescriptor(_,lt);if(gt.value!==mt||gt.enumerable!==!0)return!1}return!0},origSymbol=typeof Symbol<"u"&&Symbol,hasSymbolSham=shams,hasSymbols$1=function(){return typeof origSymbol!="function"||typeof Symbol!="function"||typeof origSymbol("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:hasSymbolSham()},test={__proto__:null,foo:{}},$Object=Object,hasProto$1=function(){return{__proto__:test}.foo===test.foo&&!(test instanceof $Object)},ERROR_MESSAGE="Function.prototype.bind called on incompatible ",toStr$1=Object.prototype.toString,max=Math.max,funcType="[object Function]",concatty=function(_,lt){for(var ft=[],mt=0;mt<_.length;mt+=1)ft[mt]=_[mt];for(var pt=0;pt<lt.length;pt+=1)ft[pt+_.length]=lt[pt];return ft},slicy=function(_,lt){for(var ft=[],mt=lt,pt=0;mt<_.length;mt+=1,pt+=1)ft[pt]=_[mt];return ft},joiny=function(it,_){for(var lt="",ft=0;ft<it.length;ft+=1)lt+=it[ft],ft+1<it.length&&(lt+=_);return lt},implementation$1=function(_){var lt=this;if(typeof lt!="function"||toStr$1.apply(lt)!==funcType)throw new TypeError(ERROR_MESSAGE+lt);for(var ft=slicy(arguments,1),mt,pt=function(){if(this instanceof mt){var Ct=lt.apply(this,concatty(ft,arguments));return Object(Ct)===Ct?Ct:this}return lt.apply(_,concatty(ft,arguments))},gt=max(0,lt.length-ft.length),bt=[],wt=0;wt<gt;wt++)bt[wt]="$"+wt;if(mt=Function("binder","return function ("+joiny(bt,",")+"){ return binder.apply(this,arguments); }")(pt),lt.prototype){var vt=function(){};vt.prototype=lt.prototype,mt.prototype=new vt,vt.prototype=null}return mt},implementation=implementation$1,functionBind=Function.prototype.bind||implementation,call=Function.prototype.call,$hasOwn=Object.prototype.hasOwnProperty,bind$1=functionBind,hasown=bind$1.call(call,$hasOwn),undefined$1,$Error=esErrors,$EvalError=_eval,$RangeError=range,$ReferenceError=ref,$SyntaxError$1=syntax,$TypeError$3=type,$URIError=uri,$Function=Function,getEvalledConstructor=function(it){try{return $Function('"use strict"; return ('+it+").constructor;")()}catch{}},$gOPD$1=Object.getOwnPropertyDescriptor;if($gOPD$1)try{$gOPD$1({},"")}catch{$gOPD$1=null}var throwTypeError=function(){throw new $TypeError$3},ThrowTypeError=$gOPD$1?function(){try{return arguments.callee,throwTypeError}catch{try{return $gOPD$1(arguments,"callee").get}catch{return throwTypeError}}}():throwTypeError,hasSymbols=hasSymbols$1(),hasProto=hasProto$1(),getProto=Object.getPrototypeOf||(hasProto?function(it){return it.__proto__}:null),needsEval={},TypedArray=typeof Uint8Array>"u"||!getProto?undefined$1:getProto(Uint8Array),INTRINSICS={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?undefined$1:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?undefined$1:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols&&getProto?getProto([][Symbol.iterator]()):undefined$1,"%AsyncFromSyncIteratorPrototype%":undefined$1,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":typeof Atomics>"u"?undefined$1:Atomics,"%BigInt%":typeof BigInt>"u"?undefined$1:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?undefined$1:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?undefined$1:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?undefined$1:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":$Error,"%eval%":eval,"%EvalError%":$EvalError,"%Float32Array%":typeof Float32Array>"u"?undefined$1:Float32Array,"%Float64Array%":typeof Float64Array>"u"?undefined$1:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?undefined$1:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":typeof Int8Array>"u"?undefined$1:Int8Array,"%Int16Array%":typeof Int16Array>"u"?undefined$1:Int16Array,"%Int32Array%":typeof Int32Array>"u"?undefined$1:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols&&getProto?getProto(getProto([][Symbol.iterator]())):undefined$1,"%JSON%":typeof JSON=="object"?JSON:undefined$1,"%Map%":typeof Map>"u"?undefined$1:Map,"%MapIteratorPrototype%":typeof Map>"u"||!hasSymbols||!getProto?undefined$1:getProto(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?undefined$1:Promise,"%Proxy%":typeof Proxy>"u"?undefined$1:Proxy,"%RangeError%":$RangeError,"%ReferenceError%":$ReferenceError,"%Reflect%":typeof Reflect>"u"?undefined$1:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?undefined$1:Set,"%SetIteratorPrototype%":typeof Set>"u"||!hasSymbols||!getProto?undefined$1:getProto(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?undefined$1:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols&&getProto?getProto(""[Symbol.iterator]()):undefined$1,"%Symbol%":hasSymbols?Symbol:undefined$1,"%SyntaxError%":$SyntaxError$1,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError$3,"%Uint8Array%":typeof Uint8Array>"u"?undefined$1:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?undefined$1:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?undefined$1:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?undefined$1:Uint32Array,"%URIError%":$URIError,"%WeakMap%":typeof WeakMap>"u"?undefined$1:WeakMap,"%WeakRef%":typeof WeakRef>"u"?undefined$1:WeakRef,"%WeakSet%":typeof WeakSet>"u"?undefined$1:WeakSet};if(getProto)try{null.error}catch(it){var errorProto=getProto(getProto(it));INTRINSICS["%Error.prototype%"]=errorProto}var doEval=function it(_){var lt;if(_==="%AsyncFunction%")lt=getEvalledConstructor("async function () {}");else if(_==="%GeneratorFunction%")lt=getEvalledConstructor("function* () {}");else if(_==="%AsyncGeneratorFunction%")lt=getEvalledConstructor("async function* () {}");else if(_==="%AsyncGenerator%"){var ft=it("%AsyncGeneratorFunction%");ft&&(lt=ft.prototype)}else if(_==="%AsyncIteratorPrototype%"){var mt=it("%AsyncGenerator%");mt&&getProto&&(lt=getProto(mt.prototype))}return INTRINSICS[_]=lt,lt},LEGACY_ALIASES={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bind=functionBind,hasOwn$1=hasown,$concat$1=bind.call(Function.call,Array.prototype.concat),$spliceApply=bind.call(Function.apply,Array.prototype.splice),$replace$1=bind.call(Function.call,String.prototype.replace),$strSlice=bind.call(Function.call,String.prototype.slice),$exec=bind.call(Function.call,RegExp.prototype.exec),rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=function(_){var lt=$strSlice(_,0,1),ft=$strSlice(_,-1);if(lt==="%"&&ft!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected closing `%`");if(ft==="%"&&lt!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected opening `%`");var mt=[];return $replace$1(_,rePropName,function(pt,gt,bt,wt){mt[mt.length]=bt?$replace$1(wt,reEscapeChar,"$1"):gt||pt}),mt},getBaseIntrinsic=function(_,lt){var ft=_,mt;if(hasOwn$1(LEGACY_ALIASES,ft)&&(mt=LEGACY_ALIASES[ft],ft="%"+mt[0]+"%"),hasOwn$1(INTRINSICS,ft)){var pt=INTRINSICS[ft];if(pt===needsEval&&(pt=doEval(ft)),typeof pt>"u"&&!lt)throw new $TypeError$3("intrinsic "+_+" exists, but is not available. Please file an issue!");return{alias:mt,name:ft,value:pt}}throw new $SyntaxError$1("intrinsic "+_+" does not exist!")},getIntrinsic=function(_,lt){if(typeof _!="string"||_.length===0)throw new $TypeError$3("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof lt!="boolean")throw new $TypeError$3('"allowMissing" argument must be a boolean');if($exec(/^%?[^%]*%?$/,_)===null)throw new $SyntaxError$1("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ft=stringToPath(_),mt=ft.length>0?ft[0]:"",pt=getBaseIntrinsic("%"+mt+"%",lt),gt=pt.name,bt=pt.value,wt=!1,vt=pt.alias;vt&&(mt=vt[0],$spliceApply(ft,$concat$1([0,1],vt)));for(var Ct=1,Rt=!0;Ct<ft.length;Ct+=1){var Mt=ft[Ct],Ot=$strSlice(Mt,0,1),Nt=$strSlice(Mt,-1);if((Ot==='"'||Ot==="'"||Ot==="`"||Nt==='"'||Nt==="'"||Nt==="`")&&Ot!==Nt)throw new $SyntaxError$1("property names with quotes must have matching quotes");if((Mt==="constructor"||!Rt)&&(wt=!0),mt+="."+Mt,gt="%"+mt+"%",hasOwn$1(INTRINSICS,gt))bt=INTRINSICS[gt];else if(bt!=null){if(!(Mt in bt)){if(!lt)throw new $TypeError$3("base intrinsic for "+_+" exists, but the property is not available.");return}if($gOPD$1&&Ct+1>=ft.length){var Ht=$gOPD$1(bt,Mt);Rt=!!Ht,Rt&&"get"in Ht&&!("originalValue"in Ht.get)?bt=Ht.get:bt=bt[Mt]}else Rt=hasOwn$1(bt,Mt),bt=bt[Mt];Rt&&!wt&&(INTRINSICS[gt]=bt)}}return bt},callBind$1={exports:{}},esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var it=getIntrinsic,_=it("%Object.defineProperty%",!0)||!1;if(_)try{_({},"a",{value:1})}catch{_=!1}return esDefineProperty=_,esDefineProperty}var GetIntrinsic$3=getIntrinsic,$gOPD=GetIntrinsic$3("%Object.getOwnPropertyDescriptor%",!0);if($gOPD)try{$gOPD([],"length")}catch{$gOPD=null}var gopd$1=$gOPD,$defineProperty$1=requireEsDefineProperty(),$SyntaxError=syntax,$TypeError$2=type,gopd=gopd$1,defineDataProperty=function(_,lt,ft){if(!_||typeof _!="object"&&typeof _!="function")throw new $TypeError$2("`obj` must be an object or a function`");if(typeof lt!="string"&&typeof lt!="symbol")throw new $TypeError$2("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new $TypeError$2("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new $TypeError$2("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new $TypeError$2("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new $TypeError$2("`loose`, if provided, must be a boolean");var mt=arguments.length>3?arguments[3]:null,pt=arguments.length>4?arguments[4]:null,gt=arguments.length>5?arguments[5]:null,bt=arguments.length>6?arguments[6]:!1,wt=!!gopd&&gopd(_,lt);if($defineProperty$1)$defineProperty$1(_,lt,{configurable:gt===null&&wt?wt.configurable:!gt,enumerable:mt===null&&wt?wt.enumerable:!mt,value:ft,writable:pt===null&&wt?wt.writable:!pt});else if(bt||!mt&&!pt&&!gt)_[lt]=ft;else throw new $SyntaxError("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},$defineProperty=requireEsDefineProperty(),hasPropertyDescriptors=function(){return!!$defineProperty};hasPropertyDescriptors.hasArrayLengthDefineBug=function(){if(!$defineProperty)return null;try{return $defineProperty([],"length",{value:1}).length!==1}catch{return!0}};var hasPropertyDescriptors_1=hasPropertyDescriptors,GetIntrinsic$2=getIntrinsic,define=defineDataProperty,hasDescriptors=hasPropertyDescriptors_1(),gOPD=gopd$1,$TypeError$1=type,$floor$1=GetIntrinsic$2("%Math.floor%"),setFunctionLength=function(_,lt){if(typeof _!="function")throw new $TypeError$1("`fn` is not a function");if(typeof lt!="number"||lt<0||lt>4294967295||$floor$1(lt)!==lt)throw new $TypeError$1("`length` must be a positive 32-bit integer");var ft=arguments.length>2&&!!arguments[2],mt=!0,pt=!0;if("length"in _&&gOPD){var gt=gOPD(_,"length");gt&&!gt.configurable&&(mt=!1),gt&&!gt.writable&&(pt=!1)}return(mt||pt||!ft)&&(hasDescriptors?define(_,"length",lt,!0,!0):define(_,"length",lt)),_};(function(it){var _=functionBind,lt=getIntrinsic,ft=setFunctionLength,mt=type,pt=lt("%Function.prototype.apply%"),gt=lt("%Function.prototype.call%"),bt=lt("%Reflect.apply%",!0)||_.call(gt,pt),wt=requireEsDefineProperty(),vt=lt("%Math.max%");it.exports=function(Mt){if(typeof Mt!="function")throw new mt("a function is required");var Ot=bt(_,gt,arguments);return ft(Ot,1+vt(0,Mt.length-(arguments.length-1)),!0)};var Ct=function(){return bt(_,pt,arguments)};wt?wt(it.exports,"apply",{value:Ct}):it.exports.apply=Ct})(callBind$1);var callBindExports=callBind$1.exports,GetIntrinsic$1=getIntrinsic,callBind=callBindExports,$indexOf=callBind(GetIntrinsic$1("String.prototype.indexOf")),callBound$1=function(_,lt){var ft=GetIntrinsic$1(_,!!lt);return typeof ft=="function"&&$indexOf(_,".prototype.")>-1?callBind(ft):ft};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var hasMap=typeof Map=="function"&&Map.prototype,mapSizeDescriptor=Object.getOwnPropertyDescriptor&&hasMap?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,mapSize$1=hasMap&&mapSizeDescriptor&&typeof mapSizeDescriptor.get=="function"?mapSizeDescriptor.get:null,mapForEach=hasMap&&Map.prototype.forEach,hasSet=typeof Set=="function"&&Set.prototype,setSizeDescriptor=Object.getOwnPropertyDescriptor&&hasSet?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,setSize=hasSet&&setSizeDescriptor&&typeof setSizeDescriptor.get=="function"?setSizeDescriptor.get:null,setForEach=hasSet&&Set.prototype.forEach,hasWeakMap=typeof WeakMap=="function"&&WeakMap.prototype,weakMapHas=hasWeakMap?WeakMap.prototype.has:null,hasWeakSet=typeof WeakSet=="function"&&WeakSet.prototype,weakSetHas=hasWeakSet?WeakSet.prototype.has:null,hasWeakRef=typeof WeakRef=="function"&&WeakRef.prototype,weakRefDeref=hasWeakRef?WeakRef.prototype.deref:null,booleanValueOf=Boolean.prototype.valueOf,objectToString=Object.prototype.toString,functionToString=Function.prototype.toString,$match=String.prototype.match,$slice=String.prototype.slice,$replace=String.prototype.replace,$toUpperCase=String.prototype.toUpperCase,$toLowerCase=String.prototype.toLowerCase,$test=RegExp.prototype.test,$concat=Array.prototype.concat,$join=Array.prototype.join,$arrSlice=Array.prototype.slice,$floor=Math.floor,bigIntValueOf=typeof BigInt=="function"?BigInt.prototype.valueOf:null,gOPS=Object.getOwnPropertySymbols,symToString=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,hasShammedSymbols=typeof Symbol=="function"&&typeof Symbol.iterator=="object",toStringTag=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===hasShammedSymbols||!0)?Symbol.toStringTag:null,isEnumerable=Object.prototype.propertyIsEnumerable,gPO=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(it){return it.__proto__}:null);function addNumericSeparator(it,_){if(it===1/0||it===-1/0||it!==it||it&&it>-1e3&&it<1e3||$test.call(/e/,_))return _;var lt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof it=="number"){var ft=it<0?-$floor(-it):$floor(it);if(ft!==it){var mt=String(ft),pt=$slice.call(_,mt.length+1);return $replace.call(mt,lt,"$&_")+"."+$replace.call($replace.call(pt,/([0-9]{3})/g,"$&_"),/_$/,"")}}return $replace.call(_,lt,"$&_")}var utilInspect=require$$0,inspectCustom=utilInspect.custom,inspectSymbol=isSymbol(inspectCustom)?inspectCustom:null,objectInspect=function it(_,lt,ft,mt){var pt=lt||{};if(has$3(pt,"quoteStyle")&&pt.quoteStyle!=="single"&&pt.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(has$3(pt,"maxStringLength")&&(typeof pt.maxStringLength=="number"?pt.maxStringLength<0&&pt.maxStringLength!==1/0:pt.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var gt=has$3(pt,"customInspect")?pt.customInspect:!0;if(typeof gt!="boolean"&&gt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(has$3(pt,"indent")&&pt.indent!==null&&pt.indent!=="	"&&!(parseInt(pt.indent,10)===pt.indent&&pt.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(has$3(pt,"numericSeparator")&&typeof pt.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var bt=pt.numericSeparator;if(typeof _>"u")return"undefined";if(_===null)return"null";if(typeof _=="boolean")return _?"true":"false";if(typeof _=="string")return inspectString(_,pt);if(typeof _=="number"){if(_===0)return 1/0/_>0?"0":"-0";var wt=String(_);return bt?addNumericSeparator(_,wt):wt}if(typeof _=="bigint"){var vt=String(_)+"n";return bt?addNumericSeparator(_,vt):vt}var Ct=typeof pt.depth>"u"?5:pt.depth;if(typeof ft>"u"&&(ft=0),ft>=Ct&&Ct>0&&typeof _=="object")return isArray$3(_)?"[Array]":"[Object]";var Rt=getIndent(pt,ft);if(typeof mt>"u")mt=[];else if(indexOf(mt,_)>=0)return"[Circular]";function Mt(Xn,eo,lp){if(eo&&(mt=$arrSlice.call(mt),mt.push(eo)),lp){var $a={depth:pt.depth};return has$3(pt,"quoteStyle")&&($a.quoteStyle=pt.quoteStyle),it(Xn,$a,ft+1,mt)}return it(Xn,pt,ft+1,mt)}if(typeof _=="function"&&!isRegExp$1(_)){var Ot=nameOf(_),Nt=arrObjKeys(_,Mt);return"[Function"+(Ot?": "+Ot:" (anonymous)")+"]"+(Nt.length>0?" { "+$join.call(Nt,", ")+" }":"")}if(isSymbol(_)){var Ht=hasShammedSymbols?$replace.call(String(_),/^(Symbol\(.*\))_[^)]*$/,"$1"):symToString.call(_);return typeof _=="object"&&!hasShammedSymbols?markBoxed(Ht):Ht}if(isElement(_)){for(var Kt="<"+$toLowerCase.call(String(_.nodeName)),hr=_.attributes||[],Qt=0;Qt<hr.length;Qt++)Kt+=" "+hr[Qt].name+"="+wrapQuotes(quote(hr[Qt].value),"double",pt);return Kt+=">",_.childNodes&&_.childNodes.length&&(Kt+="..."),Kt+="</"+$toLowerCase.call(String(_.nodeName))+">",Kt}if(isArray$3(_)){if(_.length===0)return"[]";var mr=arrObjKeys(_,Mt);return Rt&&!singleLineValues(mr)?"["+indentedJoin(mr,Rt)+"]":"[ "+$join.call(mr,", ")+" ]"}if(isError(_)){var br=arrObjKeys(_,Mt);return!("cause"in Error.prototype)&&"cause"in _&&!isEnumerable.call(_,"cause")?"{ ["+String(_)+"] "+$join.call($concat.call("[cause]: "+Mt(_.cause),br),", ")+" }":br.length===0?"["+String(_)+"]":"{ ["+String(_)+"] "+$join.call(br,", ")+" }"}if(typeof _=="object"&&gt){if(inspectSymbol&&typeof _[inspectSymbol]=="function"&&utilInspect)return utilInspect(_,{depth:Ct-ft});if(gt!=="symbol"&&typeof _.inspect=="function")return _.inspect()}if(isMap(_)){var Fr=[];return mapForEach&&mapForEach.call(_,function(Xn,eo){Fr.push(Mt(eo,_,!0)+" => "+Mt(Xn,_))}),collectionOf("Map",mapSize$1.call(_),Fr,Rt)}if(isSet(_)){var kr=[];return setForEach&&setForEach.call(_,function(Xn){kr.push(Mt(Xn,_))}),collectionOf("Set",setSize.call(_),kr,Rt)}if(isWeakMap(_))return weakCollectionOf("WeakMap");if(isWeakSet(_))return weakCollectionOf("WeakSet");if(isWeakRef(_))return weakCollectionOf("WeakRef");if(isNumber(_))return markBoxed(Mt(Number(_)));if(isBigInt(_))return markBoxed(Mt(bigIntValueOf.call(_)));if(isBoolean(_))return markBoxed(booleanValueOf.call(_));if(isString(_))return markBoxed(Mt(String(_)));if(typeof window<"u"&&_===window)return"{ [object Window] }";if(typeof globalThis<"u"&&_===globalThis||typeof commonjsGlobal<"u"&&_===commonjsGlobal)return"{ [object globalThis] }";if(!isDate(_)&&!isRegExp$1(_)){var Br=arrObjKeys(_,Mt),Nr=gPO?gPO(_)===Object.prototype:_ instanceof Object||_.constructor===Object,jn=_ instanceof Object?"":"null prototype",Yn=!Nr&&toStringTag&&Object(_)===_&&toStringTag in _?$slice.call(toStr(_),8,-1):jn?"Object":"",ga=Nr||typeof _.constructor!="function"?"":_.constructor.name?_.constructor.name+" ":"",Kn=ga+(Yn||jn?"["+$join.call($concat.call([],Yn||[],jn||[]),": ")+"] ":"");return Br.length===0?Kn+"{}":Rt?Kn+"{"+indentedJoin(Br,Rt)+"}":Kn+"{ "+$join.call(Br,", ")+" }"}return String(_)};function wrapQuotes(it,_,lt){var ft=(lt.quoteStyle||_)==="double"?'"':"'";return ft+it+ft}function quote(it){return $replace.call(String(it),/"/g,"&quot;")}function isArray$3(it){return toStr(it)==="[object Array]"&&(!toStringTag||!(typeof it=="object"&&toStringTag in it))}function isDate(it){return toStr(it)==="[object Date]"&&(!toStringTag||!(typeof it=="object"&&toStringTag in it))}function isRegExp$1(it){return toStr(it)==="[object RegExp]"&&(!toStringTag||!(typeof it=="object"&&toStringTag in it))}function isError(it){return toStr(it)==="[object Error]"&&(!toStringTag||!(typeof it=="object"&&toStringTag in it))}function isString(it){return toStr(it)==="[object String]"&&(!toStringTag||!(typeof it=="object"&&toStringTag in it))}function isNumber(it){return toStr(it)==="[object Number]"&&(!toStringTag||!(typeof it=="object"&&toStringTag in it))}function isBoolean(it){return toStr(it)==="[object Boolean]"&&(!toStringTag||!(typeof it=="object"&&toStringTag in it))}function isSymbol(it){if(hasShammedSymbols)return it&&typeof it=="object"&&it instanceof Symbol;if(typeof it=="symbol")return!0;if(!it||typeof it!="object"||!symToString)return!1;try{return symToString.call(it),!0}catch{}return!1}function isBigInt(it){if(!it||typeof it!="object"||!bigIntValueOf)return!1;try{return bigIntValueOf.call(it),!0}catch{}return!1}var hasOwn=Object.prototype.hasOwnProperty||function(it){return it in this};function has$3(it,_){return hasOwn.call(it,_)}function toStr(it){return objectToString.call(it)}function nameOf(it){if(it.name)return it.name;var _=$match.call(functionToString.call(it),/^function\s*([\w$]+)/);return _?_[1]:null}function indexOf(it,_){if(it.indexOf)return it.indexOf(_);for(var lt=0,ft=it.length;lt<ft;lt++)if(it[lt]===_)return lt;return-1}function isMap(it){if(!mapSize$1||!it||typeof it!="object")return!1;try{mapSize$1.call(it);try{setSize.call(it)}catch{return!0}return it instanceof Map}catch{}return!1}function isWeakMap(it){if(!weakMapHas||!it||typeof it!="object")return!1;try{weakMapHas.call(it,weakMapHas);try{weakSetHas.call(it,weakSetHas)}catch{return!0}return it instanceof WeakMap}catch{}return!1}function isWeakRef(it){if(!weakRefDeref||!it||typeof it!="object")return!1;try{return weakRefDeref.call(it),!0}catch{}return!1}function isSet(it){if(!setSize||!it||typeof it!="object")return!1;try{setSize.call(it);try{mapSize$1.call(it)}catch{return!0}return it instanceof Set}catch{}return!1}function isWeakSet(it){if(!weakSetHas||!it||typeof it!="object")return!1;try{weakSetHas.call(it,weakSetHas);try{weakMapHas.call(it,weakMapHas)}catch{return!0}return it instanceof WeakSet}catch{}return!1}function isElement(it){return!it||typeof it!="object"?!1:typeof HTMLElement<"u"&&it instanceof HTMLElement?!0:typeof it.nodeName=="string"&&typeof it.getAttribute=="function"}function inspectString(it,_){if(it.length>_.maxStringLength){var lt=it.length-_.maxStringLength,ft="... "+lt+" more character"+(lt>1?"s":"");return inspectString($slice.call(it,0,_.maxStringLength),_)+ft}var mt=$replace.call($replace.call(it,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,lowbyte);return wrapQuotes(mt,"single",_)}function lowbyte(it){var _=it.charCodeAt(0),lt={8:"b",9:"t",10:"n",12:"f",13:"r"}[_];return lt?"\\"+lt:"\\x"+(_<16?"0":"")+$toUpperCase.call(_.toString(16))}function markBoxed(it){return"Object("+it+")"}function weakCollectionOf(it){return it+" { ? }"}function collectionOf(it,_,lt,ft){var mt=ft?indentedJoin(lt,ft):$join.call(lt,", ");return it+" ("+_+") {"+mt+"}"}function singleLineValues(it){for(var _=0;_<it.length;_++)if(indexOf(it[_],`
`)>=0)return!1;return!0}function getIndent(it,_){var lt;if(it.indent==="	")lt="	";else if(typeof it.indent=="number"&&it.indent>0)lt=$join.call(Array(it.indent+1)," ");else return null;return{base:lt,prev:$join.call(Array(_+1),lt)}}function indentedJoin(it,_){if(it.length===0)return"";var lt=`
`+_.prev+_.base;return lt+$join.call(it,","+lt)+`
`+_.prev}function arrObjKeys(it,_){var lt=isArray$3(it),ft=[];if(lt){ft.length=it.length;for(var mt=0;mt<it.length;mt++)ft[mt]=has$3(it,mt)?_(it[mt],it):""}var pt=typeof gOPS=="function"?gOPS(it):[],gt;if(hasShammedSymbols){gt={};for(var bt=0;bt<pt.length;bt++)gt["$"+pt[bt]]=pt[bt]}for(var wt in it)has$3(it,wt)&&(lt&&String(Number(wt))===wt&&wt<it.length||hasShammedSymbols&&gt["$"+wt]instanceof Symbol||($test.call(/[^\w$]/,wt)?ft.push(_(wt,it)+": "+_(it[wt],it)):ft.push(wt+": "+_(it[wt],it))));if(typeof gOPS=="function")for(var vt=0;vt<pt.length;vt++)isEnumerable.call(it,pt[vt])&&ft.push("["+_(pt[vt])+"]: "+_(it[pt[vt]],it));return ft}var GetIntrinsic=getIntrinsic,callBound=callBound$1,inspect=objectInspect,$TypeError=type,$WeakMap=GetIntrinsic("%WeakMap%",!0),$Map=GetIntrinsic("%Map%",!0),$weakMapGet=callBound("WeakMap.prototype.get",!0),$weakMapSet=callBound("WeakMap.prototype.set",!0),$weakMapHas=callBound("WeakMap.prototype.has",!0),$mapGet=callBound("Map.prototype.get",!0),$mapSet=callBound("Map.prototype.set",!0),$mapHas=callBound("Map.prototype.has",!0),listGetNode=function(it,_){for(var lt=it,ft;(ft=lt.next)!==null;lt=ft)if(ft.key===_)return lt.next=ft.next,ft.next=it.next,it.next=ft,ft},listGet=function(it,_){var lt=listGetNode(it,_);return lt&&lt.value},listSet=function(it,_,lt){var ft=listGetNode(it,_);ft?ft.value=lt:it.next={key:_,next:it.next,value:lt}},listHas=function(it,_){return!!listGetNode(it,_)},sideChannel=function(){var _,lt,ft,mt={assert:function(pt){if(!mt.has(pt))throw new $TypeError("Side channel does not contain "+inspect(pt))},get:function(pt){if($WeakMap&&pt&&(typeof pt=="object"||typeof pt=="function")){if(_)return $weakMapGet(_,pt)}else if($Map){if(lt)return $mapGet(lt,pt)}else if(ft)return listGet(ft,pt)},has:function(pt){if($WeakMap&&pt&&(typeof pt=="object"||typeof pt=="function")){if(_)return $weakMapHas(_,pt)}else if($Map){if(lt)return $mapHas(lt,pt)}else if(ft)return listHas(ft,pt);return!1},set:function(pt,gt){$WeakMap&&pt&&(typeof pt=="object"||typeof pt=="function")?(_||(_=new $WeakMap),$weakMapSet(_,pt,gt)):$Map?(lt||(lt=new $Map),$mapSet(lt,pt,gt)):(ft||(ft={key:{},next:null}),listSet(ft,pt,gt))}};return mt},replace=String.prototype.replace,percentTwenties=/%20/g,Format={RFC1738:"RFC1738",RFC3986:"RFC3986"},formats$4={default:Format.RFC3986,formatters:{RFC1738:function(it){return replace.call(it,percentTwenties,"+")},RFC3986:function(it){return String(it)}},RFC1738:Format.RFC1738,RFC3986:Format.RFC3986},formats$3=formats$4,has$2=Object.prototype.hasOwnProperty,isArray$2=Array.isArray,hexTable=function(){for(var it=[],_=0;_<256;++_)it.push("%"+((_<16?"0":"")+_.toString(16)).toUpperCase());return it}(),compactQueue=function(_){for(;_.length>1;){var lt=_.pop(),ft=lt.obj[lt.prop];if(isArray$2(ft)){for(var mt=[],pt=0;pt<ft.length;++pt)typeof ft[pt]<"u"&&mt.push(ft[pt]);lt.obj[lt.prop]=mt}}},arrayToObject=function(_,lt){for(var ft=lt&&lt.plainObjects?Object.create(null):{},mt=0;mt<_.length;++mt)typeof _[mt]<"u"&&(ft[mt]=_[mt]);return ft},merge=function it(_,lt,ft){if(!lt)return _;if(typeof lt!="object"){if(isArray$2(_))_.push(lt);else if(_&&typeof _=="object")(ft&&(ft.plainObjects||ft.allowPrototypes)||!has$2.call(Object.prototype,lt))&&(_[lt]=!0);else return[_,lt];return _}if(!_||typeof _!="object")return[_].concat(lt);var mt=_;return isArray$2(_)&&!isArray$2(lt)&&(mt=arrayToObject(_,ft)),isArray$2(_)&&isArray$2(lt)?(lt.forEach(function(pt,gt){if(has$2.call(_,gt)){var bt=_[gt];bt&&typeof bt=="object"&&pt&&typeof pt=="object"?_[gt]=it(bt,pt,ft):_.push(pt)}else _[gt]=pt}),_):Object.keys(lt).reduce(function(pt,gt){var bt=lt[gt];return has$2.call(pt,gt)?pt[gt]=it(pt[gt],bt,ft):pt[gt]=bt,pt},mt)},assign=function(_,lt){return Object.keys(lt).reduce(function(ft,mt){return ft[mt]=lt[mt],ft},_)},decode=function(it,_,lt){var ft=it.replace(/\+/g," ");if(lt==="iso-8859-1")return ft.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(ft)}catch{return ft}},limit=1024,encode=function(_,lt,ft,mt,pt){if(_.length===0)return _;var gt=_;if(typeof _=="symbol"?gt=Symbol.prototype.toString.call(_):typeof _!="string"&&(gt=String(_)),ft==="iso-8859-1")return escape(gt).replace(/%u[0-9a-f]{4}/gi,function(Ot){return"%26%23"+parseInt(Ot.slice(2),16)+"%3B"});for(var bt="",wt=0;wt<gt.length;wt+=limit){for(var vt=gt.length>=limit?gt.slice(wt,wt+limit):gt,Ct=[],Rt=0;Rt<vt.length;++Rt){var Mt=vt.charCodeAt(Rt);if(Mt===45||Mt===46||Mt===95||Mt===126||Mt>=48&&Mt<=57||Mt>=65&&Mt<=90||Mt>=97&&Mt<=122||pt===formats$3.RFC1738&&(Mt===40||Mt===41)){Ct[Ct.length]=vt.charAt(Rt);continue}if(Mt<128){Ct[Ct.length]=hexTable[Mt];continue}if(Mt<2048){Ct[Ct.length]=hexTable[192|Mt>>6]+hexTable[128|Mt&63];continue}if(Mt<55296||Mt>=57344){Ct[Ct.length]=hexTable[224|Mt>>12]+hexTable[128|Mt>>6&63]+hexTable[128|Mt&63];continue}Rt+=1,Mt=65536+((Mt&1023)<<10|vt.charCodeAt(Rt)&1023),Ct[Ct.length]=hexTable[240|Mt>>18]+hexTable[128|Mt>>12&63]+hexTable[128|Mt>>6&63]+hexTable[128|Mt&63]}bt+=Ct.join("")}return bt},compact=function(_){for(var lt=[{obj:{o:_},prop:"o"}],ft=[],mt=0;mt<lt.length;++mt)for(var pt=lt[mt],gt=pt.obj[pt.prop],bt=Object.keys(gt),wt=0;wt<bt.length;++wt){var vt=bt[wt],Ct=gt[vt];typeof Ct=="object"&&Ct!==null&&ft.indexOf(Ct)===-1&&(lt.push({obj:gt,prop:vt}),ft.push(Ct))}return compactQueue(lt),_},isRegExp=function(_){return Object.prototype.toString.call(_)==="[object RegExp]"},isBuffer=function(_){return!_||typeof _!="object"?!1:!!(_.constructor&&_.constructor.isBuffer&&_.constructor.isBuffer(_))},combine=function(_,lt){return[].concat(_,lt)},maybeMap=function(_,lt){if(isArray$2(_)){for(var ft=[],mt=0;mt<_.length;mt+=1)ft.push(lt(_[mt]));return ft}return lt(_)},utils$3={arrayToObject,assign,combine,compact,decode,encode,isBuffer,isRegExp,maybeMap,merge},getSideChannel=sideChannel,utils$2=utils$3,formats$2=formats$4,has$1=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function(_){return _+"[]"},comma:"comma",indices:function(_,lt){return _+"["+lt+"]"},repeat:function(_){return _}},isArray$1=Array.isArray,push=Array.prototype.push,pushToArray=function(it,_){push.apply(it,isArray$1(_)?_:[_])},toISO=Date.prototype.toISOString,defaultFormat=formats$2.default,defaults$1={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:utils$2.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:formats$2.formatters[defaultFormat],indices:!1,serializeDate:function(_){return toISO.call(_)},skipNulls:!1,strictNullHandling:!1},isNonNullishPrimitive=function(_){return typeof _=="string"||typeof _=="number"||typeof _=="boolean"||typeof _=="symbol"||typeof _=="bigint"},sentinel={},stringify$1=function it(_,lt,ft,mt,pt,gt,bt,wt,vt,Ct,Rt,Mt,Ot,Nt,Ht,Kt,hr,Qt){for(var mr=_,br=Qt,Fr=0,kr=!1;(br=br.get(sentinel))!==void 0&&!kr;){var Br=br.get(_);if(Fr+=1,typeof Br<"u"){if(Br===Fr)throw new RangeError("Cyclic object value");kr=!0}typeof br.get(sentinel)>"u"&&(Fr=0)}if(typeof Ct=="function"?mr=Ct(lt,mr):mr instanceof Date?mr=Ot(mr):ft==="comma"&&isArray$1(mr)&&(mr=utils$2.maybeMap(mr,function(Zn){return Zn instanceof Date?Ot(Zn):Zn})),mr===null){if(gt)return vt&&!Kt?vt(lt,defaults$1.encoder,hr,"key",Nt):lt;mr=""}if(isNonNullishPrimitive(mr)||utils$2.isBuffer(mr)){if(vt){var Nr=Kt?lt:vt(lt,defaults$1.encoder,hr,"key",Nt);return[Ht(Nr)+"="+Ht(vt(mr,defaults$1.encoder,hr,"value",Nt))]}return[Ht(lt)+"="+Ht(String(mr))]}var jn=[];if(typeof mr>"u")return jn;var Yn;if(ft==="comma"&&isArray$1(mr))Kt&&vt&&(mr=utils$2.maybeMap(mr,vt)),Yn=[{value:mr.length>0?mr.join(",")||null:void 0}];else if(isArray$1(Ct))Yn=Ct;else{var ga=Object.keys(mr);Yn=Rt?ga.sort(Rt):ga}var Kn=wt?lt.replace(/\./g,"%2E"):lt,Xn=mt&&isArray$1(mr)&&mr.length===1?Kn+"[]":Kn;if(pt&&isArray$1(mr)&&mr.length===0)return Xn+"[]";for(var eo=0;eo<Yn.length;++eo){var lp=Yn[eo],$a=typeof lp=="object"&&typeof lp.value<"u"?lp.value:mr[lp];if(!(bt&&$a===null)){var ro=Mt&&wt?lp.replace(/\./g,"%2E"):lp,bs=isArray$1(mr)?typeof ft=="function"?ft(Xn,ro):Xn:Xn+(Mt?"."+ro:"["+ro+"]");Qt.set(_,Fr);var ba=getSideChannel();ba.set(sentinel,Qt),pushToArray(jn,it($a,bs,ft,mt,pt,gt,bt,wt,ft==="comma"&&Kt&&isArray$1(mr)?null:vt,Ct,Rt,Mt,Ot,Nt,Ht,Kt,hr,ba))}}return jn},normalizeStringifyOptions=function(_){if(!_)return defaults$1;if(typeof _.allowEmptyArrays<"u"&&typeof _.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof _.encodeDotInKeys<"u"&&typeof _.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(_.encoder!==null&&typeof _.encoder<"u"&&typeof _.encoder!="function")throw new TypeError("Encoder has to be a function.");var lt=_.charset||defaults$1.charset;if(typeof _.charset<"u"&&_.charset!=="utf-8"&&_.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var ft=formats$2.default;if(typeof _.format<"u"){if(!has$1.call(formats$2.formatters,_.format))throw new TypeError("Unknown format option provided.");ft=_.format}var mt=formats$2.formatters[ft],pt=defaults$1.filter;(typeof _.filter=="function"||isArray$1(_.filter))&&(pt=_.filter);var gt;if(_.arrayFormat in arrayPrefixGenerators?gt=_.arrayFormat:"indices"in _?gt=_.indices?"indices":"repeat":gt=defaults$1.arrayFormat,"commaRoundTrip"in _&&typeof _.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var bt=typeof _.allowDots>"u"?_.encodeDotInKeys===!0?!0:defaults$1.allowDots:!!_.allowDots;return{addQueryPrefix:typeof _.addQueryPrefix=="boolean"?_.addQueryPrefix:defaults$1.addQueryPrefix,allowDots:bt,allowEmptyArrays:typeof _.allowEmptyArrays=="boolean"?!!_.allowEmptyArrays:defaults$1.allowEmptyArrays,arrayFormat:gt,charset:lt,charsetSentinel:typeof _.charsetSentinel=="boolean"?_.charsetSentinel:defaults$1.charsetSentinel,commaRoundTrip:_.commaRoundTrip,delimiter:typeof _.delimiter>"u"?defaults$1.delimiter:_.delimiter,encode:typeof _.encode=="boolean"?_.encode:defaults$1.encode,encodeDotInKeys:typeof _.encodeDotInKeys=="boolean"?_.encodeDotInKeys:defaults$1.encodeDotInKeys,encoder:typeof _.encoder=="function"?_.encoder:defaults$1.encoder,encodeValuesOnly:typeof _.encodeValuesOnly=="boolean"?_.encodeValuesOnly:defaults$1.encodeValuesOnly,filter:pt,format:ft,formatter:mt,serializeDate:typeof _.serializeDate=="function"?_.serializeDate:defaults$1.serializeDate,skipNulls:typeof _.skipNulls=="boolean"?_.skipNulls:defaults$1.skipNulls,sort:typeof _.sort=="function"?_.sort:null,strictNullHandling:typeof _.strictNullHandling=="boolean"?_.strictNullHandling:defaults$1.strictNullHandling}},stringify_1=function(it,_){var lt=it,ft=normalizeStringifyOptions(_),mt,pt;typeof ft.filter=="function"?(pt=ft.filter,lt=pt("",lt)):isArray$1(ft.filter)&&(pt=ft.filter,mt=pt);var gt=[];if(typeof lt!="object"||lt===null)return"";var bt=arrayPrefixGenerators[ft.arrayFormat],wt=bt==="comma"&&ft.commaRoundTrip;mt||(mt=Object.keys(lt)),ft.sort&&mt.sort(ft.sort);for(var vt=getSideChannel(),Ct=0;Ct<mt.length;++Ct){var Rt=mt[Ct];ft.skipNulls&&lt[Rt]===null||pushToArray(gt,stringify$1(lt[Rt],Rt,bt,wt,ft.allowEmptyArrays,ft.strictNullHandling,ft.skipNulls,ft.encodeDotInKeys,ft.encode?ft.encoder:null,ft.filter,ft.sort,ft.allowDots,ft.serializeDate,ft.format,ft.formatter,ft.encodeValuesOnly,ft.charset,vt))}var Mt=gt.join(ft.delimiter),Ot=ft.addQueryPrefix===!0?"?":"";return ft.charsetSentinel&&(ft.charset==="iso-8859-1"?Ot+="utf8=%26%2310003%3B&":Ot+="utf8=%E2%9C%93&"),Mt.length>0?Ot+Mt:""},utils$1=utils$3,has=Object.prototype.hasOwnProperty,isArray=Array.isArray,defaults={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:utils$1.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},interpretNumericEntities=function(it){return it.replace(/&#(\d+);/g,function(_,lt){return String.fromCharCode(parseInt(lt,10))})},parseArrayValue=function(it,_){return it&&typeof it=="string"&&_.comma&&it.indexOf(",")>-1?it.split(","):it},isoSentinel="utf8=%26%2310003%3B",charsetSentinel="utf8=%E2%9C%93",parseValues=function(_,lt){var ft={__proto__:null},mt=lt.ignoreQueryPrefix?_.replace(/^\?/,""):_;mt=mt.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var pt=lt.parameterLimit===1/0?void 0:lt.parameterLimit,gt=mt.split(lt.delimiter,pt),bt=-1,wt,vt=lt.charset;if(lt.charsetSentinel)for(wt=0;wt<gt.length;++wt)gt[wt].indexOf("utf8=")===0&&(gt[wt]===charsetSentinel?vt="utf-8":gt[wt]===isoSentinel&&(vt="iso-8859-1"),bt=wt,wt=gt.length);for(wt=0;wt<gt.length;++wt)if(wt!==bt){var Ct=gt[wt],Rt=Ct.indexOf("]="),Mt=Rt===-1?Ct.indexOf("="):Rt+1,Ot,Nt;Mt===-1?(Ot=lt.decoder(Ct,defaults.decoder,vt,"key"),Nt=lt.strictNullHandling?null:""):(Ot=lt.decoder(Ct.slice(0,Mt),defaults.decoder,vt,"key"),Nt=utils$1.maybeMap(parseArrayValue(Ct.slice(Mt+1),lt),function(Kt){return lt.decoder(Kt,defaults.decoder,vt,"value")})),Nt&&lt.interpretNumericEntities&&vt==="iso-8859-1"&&(Nt=interpretNumericEntities(Nt)),Ct.indexOf("[]=")>-1&&(Nt=isArray(Nt)?[Nt]:Nt);var Ht=has.call(ft,Ot);Ht&&lt.duplicates==="combine"?ft[Ot]=utils$1.combine(ft[Ot],Nt):(!Ht||lt.duplicates==="last")&&(ft[Ot]=Nt)}return ft},parseObject=function(it,_,lt,ft){for(var mt=ft?_:parseArrayValue(_,lt),pt=it.length-1;pt>=0;--pt){var gt,bt=it[pt];if(bt==="[]"&&lt.parseArrays)gt=lt.allowEmptyArrays&&(mt===""||lt.strictNullHandling&&mt===null)?[]:[].concat(mt);else{gt=lt.plainObjects?Object.create(null):{};var wt=bt.charAt(0)==="["&&bt.charAt(bt.length-1)==="]"?bt.slice(1,-1):bt,vt=lt.decodeDotInKeys?wt.replace(/%2E/g,"."):wt,Ct=parseInt(vt,10);!lt.parseArrays&&vt===""?gt={0:mt}:!isNaN(Ct)&&bt!==vt&&String(Ct)===vt&&Ct>=0&&lt.parseArrays&&Ct<=lt.arrayLimit?(gt=[],gt[Ct]=mt):vt!=="__proto__"&&(gt[vt]=mt)}mt=gt}return mt},parseKeys=function(_,lt,ft,mt){if(_){var pt=ft.allowDots?_.replace(/\.([^.[]+)/g,"[$1]"):_,gt=/(\[[^[\]]*])/,bt=/(\[[^[\]]*])/g,wt=ft.depth>0&&gt.exec(pt),vt=wt?pt.slice(0,wt.index):pt,Ct=[];if(vt){if(!ft.plainObjects&&has.call(Object.prototype,vt)&&!ft.allowPrototypes)return;Ct.push(vt)}for(var Rt=0;ft.depth>0&&(wt=bt.exec(pt))!==null&&Rt<ft.depth;){if(Rt+=1,!ft.plainObjects&&has.call(Object.prototype,wt[1].slice(1,-1))&&!ft.allowPrototypes)return;Ct.push(wt[1])}if(wt){if(ft.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+ft.depth+" and strictDepth is true");Ct.push("["+pt.slice(wt.index)+"]")}return parseObject(Ct,lt,ft,mt)}},normalizeParseOptions=function(_){if(!_)return defaults;if(typeof _.allowEmptyArrays<"u"&&typeof _.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof _.decodeDotInKeys<"u"&&typeof _.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(_.decoder!==null&&typeof _.decoder<"u"&&typeof _.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof _.charset<"u"&&_.charset!=="utf-8"&&_.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var lt=typeof _.charset>"u"?defaults.charset:_.charset,ft=typeof _.duplicates>"u"?defaults.duplicates:_.duplicates;if(ft!=="combine"&&ft!=="first"&&ft!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var mt=typeof _.allowDots>"u"?_.decodeDotInKeys===!0?!0:defaults.allowDots:!!_.allowDots;return{allowDots:mt,allowEmptyArrays:typeof _.allowEmptyArrays=="boolean"?!!_.allowEmptyArrays:defaults.allowEmptyArrays,allowPrototypes:typeof _.allowPrototypes=="boolean"?_.allowPrototypes:defaults.allowPrototypes,allowSparse:typeof _.allowSparse=="boolean"?_.allowSparse:defaults.allowSparse,arrayLimit:typeof _.arrayLimit=="number"?_.arrayLimit:defaults.arrayLimit,charset:lt,charsetSentinel:typeof _.charsetSentinel=="boolean"?_.charsetSentinel:defaults.charsetSentinel,comma:typeof _.comma=="boolean"?_.comma:defaults.comma,decodeDotInKeys:typeof _.decodeDotInKeys=="boolean"?_.decodeDotInKeys:defaults.decodeDotInKeys,decoder:typeof _.decoder=="function"?_.decoder:defaults.decoder,delimiter:typeof _.delimiter=="string"||utils$1.isRegExp(_.delimiter)?_.delimiter:defaults.delimiter,depth:typeof _.depth=="number"||_.depth===!1?+_.depth:defaults.depth,duplicates:ft,ignoreQueryPrefix:_.ignoreQueryPrefix===!0,interpretNumericEntities:typeof _.interpretNumericEntities=="boolean"?_.interpretNumericEntities:defaults.interpretNumericEntities,parameterLimit:typeof _.parameterLimit=="number"?_.parameterLimit:defaults.parameterLimit,parseArrays:_.parseArrays!==!1,plainObjects:typeof _.plainObjects=="boolean"?_.plainObjects:defaults.plainObjects,strictDepth:typeof _.strictDepth=="boolean"?!!_.strictDepth:defaults.strictDepth,strictNullHandling:typeof _.strictNullHandling=="boolean"?_.strictNullHandling:defaults.strictNullHandling}},parse$2=function(it,_){var lt=normalizeParseOptions(_);if(it===""||it===null||typeof it>"u")return lt.plainObjects?Object.create(null):{};for(var ft=typeof it=="string"?parseValues(it,lt):it,mt=lt.plainObjects?Object.create(null):{},pt=Object.keys(ft),gt=0;gt<pt.length;++gt){var bt=pt[gt],wt=parseKeys(bt,ft[bt],lt,typeof it=="string");mt=utils$1.merge(mt,wt,lt)}return lt.allowSparse===!0?mt:utils$1.compact(mt)},stringify=stringify_1,parse$1=parse$2,formats$1=formats$4,lib={formats:formats$1,parse:parse$1,stringify},punycode=punycodeExports;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r",`
`,"	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=lib;function urlParse(it,_,lt){if(it&&typeof it=="object"&&it instanceof Url)return it;var ft=new Url;return ft.parse(it,_,lt),ft}Url.prototype.parse=function(it,_,lt){if(typeof it!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof it);var ft=it.indexOf("?"),mt=ft!==-1&&ft<it.indexOf("#")?"?":"#",pt=it.split(mt),gt=/\\/g;pt[0]=pt[0].replace(gt,"/"),it=pt.join(mt);var bt=it;if(bt=bt.trim(),!lt&&it.split("#").length===1){var wt=simplePathPattern.exec(bt);if(wt)return this.path=bt,this.href=bt,this.pathname=wt[1],wt[2]?(this.search=wt[2],_?this.query=querystring.parse(this.search.substr(1)):this.query=this.search.substr(1)):_&&(this.search="",this.query={}),this}var vt=protocolPattern.exec(bt);if(vt){vt=vt[0];var Ct=vt.toLowerCase();this.protocol=Ct,bt=bt.substr(vt.length)}if(lt||vt||bt.match(/^\/\/[^@/]+@[^@/]+/)){var Rt=bt.substr(0,2)==="//";Rt&&!(vt&&hostlessProtocol[vt])&&(bt=bt.substr(2),this.slashes=!0)}if(!hostlessProtocol[vt]&&(Rt||vt&&!slashedProtocol[vt])){for(var Mt=-1,Ot=0;Ot<hostEndingChars.length;Ot++){var Nt=bt.indexOf(hostEndingChars[Ot]);Nt!==-1&&(Mt===-1||Nt<Mt)&&(Mt=Nt)}var Ht,Kt;Mt===-1?Kt=bt.lastIndexOf("@"):Kt=bt.lastIndexOf("@",Mt),Kt!==-1&&(Ht=bt.slice(0,Kt),bt=bt.slice(Kt+1),this.auth=decodeURIComponent(Ht)),Mt=-1;for(var Ot=0;Ot<nonHostChars.length;Ot++){var Nt=bt.indexOf(nonHostChars[Ot]);Nt!==-1&&(Mt===-1||Nt<Mt)&&(Mt=Nt)}Mt===-1&&(Mt=bt.length),this.host=bt.slice(0,Mt),bt=bt.slice(Mt),this.parseHost(),this.hostname=this.hostname||"";var hr=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!hr)for(var Qt=this.hostname.split(/\./),Ot=0,mr=Qt.length;Ot<mr;Ot++){var br=Qt[Ot];if(br&&!br.match(hostnamePartPattern)){for(var Fr="",kr=0,Br=br.length;kr<Br;kr++)br.charCodeAt(kr)>127?Fr+="x":Fr+=br[kr];if(!Fr.match(hostnamePartPattern)){var Nr=Qt.slice(0,Ot),jn=Qt.slice(Ot+1),Yn=br.match(hostnamePartStart);Yn&&(Nr.push(Yn[1]),jn.unshift(Yn[2])),jn.length&&(bt="/"+jn.join(".")+bt),this.hostname=Nr.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),hr||(this.hostname=punycode.toASCII(this.hostname));var ga=this.port?":"+this.port:"",Kn=this.hostname||"";this.host=Kn+ga,this.href+=this.host,hr&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),bt[0]!=="/"&&(bt="/"+bt))}if(!unsafeProtocol[Ct])for(var Ot=0,mr=autoEscape.length;Ot<mr;Ot++){var Xn=autoEscape[Ot];if(bt.indexOf(Xn)!==-1){var eo=encodeURIComponent(Xn);eo===Xn&&(eo=escape(Xn)),bt=bt.split(Xn).join(eo)}}var lp=bt.indexOf("#");lp!==-1&&(this.hash=bt.substr(lp),bt=bt.slice(0,lp));var $a=bt.indexOf("?");if($a!==-1?(this.search=bt.substr($a),this.query=bt.substr($a+1),_&&(this.query=querystring.parse(this.query)),bt=bt.slice(0,$a)):_&&(this.search="",this.query={}),bt&&(this.pathname=bt),slashedProtocol[Ct]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ga=this.pathname||"",ro=this.search||"";this.path=ga+ro}return this.href=this.format(),this};function urlFormat(it){return typeof it=="string"&&(it=urlParse(it)),it instanceof Url?it.format():Url.prototype.format.call(it)}Url.prototype.format=function(){var it=this.auth||"";it&&(it=encodeURIComponent(it),it=it.replace(/%3A/i,":"),it+="@");var _=this.protocol||"",lt=this.pathname||"",ft=this.hash||"",mt=!1,pt="";this.host?mt=it+this.host:this.hostname&&(mt=it+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(mt+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(pt=querystring.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var gt=this.search||pt&&"?"+pt||"";return _&&_.substr(-1)!==":"&&(_+=":"),this.slashes||(!_||slashedProtocol[_])&&mt!==!1?(mt="//"+(mt||""),lt&&lt.charAt(0)!=="/"&&(lt="/"+lt)):mt||(mt=""),ft&&ft.charAt(0)!=="#"&&(ft="#"+ft),gt&&gt.charAt(0)!=="?"&&(gt="?"+gt),lt=lt.replace(/[?#]/g,function(bt){return encodeURIComponent(bt)}),gt=gt.replace("#","%23"),_+mt+lt+gt+ft};function urlResolve(it,_){return urlParse(it,!1,!0).resolve(_)}Url.prototype.resolve=function(it){return this.resolveObject(urlParse(it,!1,!0)).format()};Url.prototype.resolveObject=function(it){if(typeof it=="string"){var _=new Url;_.parse(it,!1,!0),it=_}for(var lt=new Url,ft=Object.keys(this),mt=0;mt<ft.length;mt++){var pt=ft[mt];lt[pt]=this[pt]}if(lt.hash=it.hash,it.href==="")return lt.href=lt.format(),lt;if(it.slashes&&!it.protocol){for(var gt=Object.keys(it),bt=0;bt<gt.length;bt++){var wt=gt[bt];wt!=="protocol"&&(lt[wt]=it[wt])}return slashedProtocol[lt.protocol]&&lt.hostname&&!lt.pathname&&(lt.pathname="/",lt.path=lt.pathname),lt.href=lt.format(),lt}if(it.protocol&&it.protocol!==lt.protocol){if(!slashedProtocol[it.protocol]){for(var vt=Object.keys(it),Ct=0;Ct<vt.length;Ct++){var Rt=vt[Ct];lt[Rt]=it[Rt]}return lt.href=lt.format(),lt}if(lt.protocol=it.protocol,!it.host&&!hostlessProtocol[it.protocol]){for(var mr=(it.pathname||"").split("/");mr.length&&!(it.host=mr.shift()););it.host||(it.host=""),it.hostname||(it.hostname=""),mr[0]!==""&&mr.unshift(""),mr.length<2&&mr.unshift(""),lt.pathname=mr.join("/")}else lt.pathname=it.pathname;if(lt.search=it.search,lt.query=it.query,lt.host=it.host||"",lt.auth=it.auth,lt.hostname=it.hostname||it.host,lt.port=it.port,lt.pathname||lt.search){var Mt=lt.pathname||"",Ot=lt.search||"";lt.path=Mt+Ot}return lt.slashes=lt.slashes||it.slashes,lt.href=lt.format(),lt}var Nt=lt.pathname&&lt.pathname.charAt(0)==="/",Ht=it.host||it.pathname&&it.pathname.charAt(0)==="/",Kt=Ht||Nt||lt.host&&it.pathname,hr=Kt,Qt=lt.pathname&&lt.pathname.split("/")||[],mr=it.pathname&&it.pathname.split("/")||[],br=lt.protocol&&!slashedProtocol[lt.protocol];if(br&&(lt.hostname="",lt.port=null,lt.host&&(Qt[0]===""?Qt[0]=lt.host:Qt.unshift(lt.host)),lt.host="",it.protocol&&(it.hostname=null,it.port=null,it.host&&(mr[0]===""?mr[0]=it.host:mr.unshift(it.host)),it.host=null),Kt=Kt&&(mr[0]===""||Qt[0]==="")),Ht)lt.host=it.host||it.host===""?it.host:lt.host,lt.hostname=it.hostname||it.hostname===""?it.hostname:lt.hostname,lt.search=it.search,lt.query=it.query,Qt=mr;else if(mr.length)Qt||(Qt=[]),Qt.pop(),Qt=Qt.concat(mr),lt.search=it.search,lt.query=it.query;else if(it.search!=null){if(br){lt.host=Qt.shift(),lt.hostname=lt.host;var Fr=lt.host&&lt.host.indexOf("@")>0?lt.host.split("@"):!1;Fr&&(lt.auth=Fr.shift(),lt.hostname=Fr.shift(),lt.host=lt.hostname)}return lt.search=it.search,lt.query=it.query,(lt.pathname!==null||lt.search!==null)&&(lt.path=(lt.pathname?lt.pathname:"")+(lt.search?lt.search:"")),lt.href=lt.format(),lt}if(!Qt.length)return lt.pathname=null,lt.search?lt.path="/"+lt.search:lt.path=null,lt.href=lt.format(),lt;for(var kr=Qt.slice(-1)[0],Br=(lt.host||it.host||Qt.length>1)&&(kr==="."||kr==="..")||kr==="",Nr=0,jn=Qt.length;jn>=0;jn--)kr=Qt[jn],kr==="."?Qt.splice(jn,1):kr===".."?(Qt.splice(jn,1),Nr++):Nr&&(Qt.splice(jn,1),Nr--);if(!Kt&&!hr)for(;Nr--;Nr)Qt.unshift("..");Kt&&Qt[0]!==""&&(!Qt[0]||Qt[0].charAt(0)!=="/")&&Qt.unshift(""),Br&&Qt.join("/").substr(-1)!=="/"&&Qt.push("");var Yn=Qt[0]===""||Qt[0]&&Qt[0].charAt(0)==="/";if(br){lt.hostname=Yn?"":Qt.length?Qt.shift():"",lt.host=lt.hostname;var Fr=lt.host&&lt.host.indexOf("@")>0?lt.host.split("@"):!1;Fr&&(lt.auth=Fr.shift(),lt.hostname=Fr.shift(),lt.host=lt.hostname)}return Kt=Kt||lt.host&&Qt.length,Kt&&!Yn&&Qt.unshift(""),Qt.length>0?lt.pathname=Qt.join("/"):(lt.pathname=null,lt.path=null),(lt.pathname!==null||lt.search!==null)&&(lt.path=(lt.pathname?lt.pathname:"")+(lt.search?lt.search:"")),lt.auth=it.auth||lt.auth,lt.slashes=lt.slashes||it.slashes,lt.href=lt.format(),lt};Url.prototype.parseHost=function(){var it=this.host,_=portPattern.exec(it);_&&(_=_[0],_!==":"&&(this.port=_.substr(1)),it=it.substr(0,it.length-_.length)),it&&(this.hostname=it)};var parse=urlParse,resolve=urlResolve,format=urlFormat;const warnings={};function deprecation(it,_,lt=3){if(warnings[_])return;let ft=new Error().stack;typeof ft>"u"?console.warn("PixiJS Deprecation Warning: ",`${_}
Deprecated since v${it}`):(ft=ft.split(`
`).splice(lt).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${_}
Deprecated since v${it}`),console.warn(ft),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${_}
Deprecated since v${it}`),console.warn(ft))),warnings[_]=!0}const url={get parse(){return deprecation("7.3.0","utils.url.parse is deprecated, use native URL API instead."),parse},get format(){return deprecation("7.3.0","utils.url.format is deprecated, use native URL API instead."),format},get resolve(){return deprecation("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),resolve}};function assertPath(it){if(typeof it!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(it)}`)}function removeUrlParams(it){return it.split("?")[0].split("#")[0]}function escapeRegExp(it){return it.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function replaceAll(it,_,lt){return it.replace(new RegExp(escapeRegExp(_),"g"),lt)}function normalizeStringPosix(it,_){let lt="",ft=0,mt=-1,pt=0,gt=-1;for(let bt=0;bt<=it.length;++bt){if(bt<it.length)gt=it.charCodeAt(bt);else{if(gt===47)break;gt=47}if(gt===47){if(!(mt===bt-1||pt===1))if(mt!==bt-1&&pt===2){if(lt.length<2||ft!==2||lt.charCodeAt(lt.length-1)!==46||lt.charCodeAt(lt.length-2)!==46){if(lt.length>2){const wt=lt.lastIndexOf("/");if(wt!==lt.length-1){wt===-1?(lt="",ft=0):(lt=lt.slice(0,wt),ft=lt.length-1-lt.lastIndexOf("/")),mt=bt,pt=0;continue}}else if(lt.length===2||lt.length===1){lt="",ft=0,mt=bt,pt=0;continue}}}else lt.length>0?lt+=`/${it.slice(mt+1,bt)}`:lt=it.slice(mt+1,bt),ft=bt-mt-1;mt=bt,pt=0}else gt===46&&pt!==-1?++pt:pt=-1}return lt}const path={toPosix(it){return replaceAll(it,"\\","/")},isUrl(it){return/^https?:/.test(this.toPosix(it))},isDataUrl(it){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(it)},isBlobUrl(it){return it.startsWith("blob:")},hasProtocol(it){return/^[^/:]+:/.test(this.toPosix(it))},getProtocol(it){assertPath(it),it=this.toPosix(it);const _=/^file:\/\/\//.exec(it);if(_)return _[0];const lt=/^[^/:]+:\/{0,2}/.exec(it);return lt?lt[0]:""},toAbsolute(it,_,lt){if(assertPath(it),this.isDataUrl(it)||this.isBlobUrl(it))return it;const ft=removeUrlParams(this.toPosix(_??settings.ADAPTER.getBaseUrl())),mt=removeUrlParams(this.toPosix(lt??this.rootname(ft)));return it=this.toPosix(it),it.startsWith("/")?path.join(mt,it.slice(1)):this.isAbsolute(it)?it:this.join(ft,it)},normalize(it){if(assertPath(it),it.length===0)return".";if(this.isDataUrl(it)||this.isBlobUrl(it))return it;it=this.toPosix(it);let _="";const lt=it.startsWith("/");this.hasProtocol(it)&&(_=this.rootname(it),it=it.slice(_.length));const ft=it.endsWith("/");return it=normalizeStringPosix(it),it.length>0&&ft&&(it+="/"),lt?`/${it}`:_+it},isAbsolute(it){return assertPath(it),it=this.toPosix(it),this.hasProtocol(it)?!0:it.startsWith("/")},join(...it){if(it.length===0)return".";let _;for(let lt=0;lt<it.length;++lt){const ft=it[lt];if(assertPath(ft),ft.length>0)if(_===void 0)_=ft;else{const mt=it[lt-1]??"";this.joinExtensions.includes(this.extname(mt).toLowerCase())?_+=`/../${ft}`:_+=`/${ft}`}}return _===void 0?".":this.normalize(_)},dirname(it){if(assertPath(it),it.length===0)return".";it=this.toPosix(it);let _=it.charCodeAt(0);const lt=_===47;let ft=-1,mt=!0;const pt=this.getProtocol(it),gt=it;it=it.slice(pt.length);for(let bt=it.length-1;bt>=1;--bt)if(_=it.charCodeAt(bt),_===47){if(!mt){ft=bt;break}}else mt=!1;return ft===-1?lt?"/":this.isUrl(gt)?pt+it:pt:lt&&ft===1?"//":pt+it.slice(0,ft)},rootname(it){assertPath(it),it=this.toPosix(it);let _="";if(it.startsWith("/")?_="/":_=this.getProtocol(it),this.isUrl(it)){const lt=it.indexOf("/",_.length);lt!==-1?_=it.slice(0,lt):_=it,_.endsWith("/")||(_+="/")}return _},basename(it,_){assertPath(it),_&&assertPath(_),it=removeUrlParams(this.toPosix(it));let lt=0,ft=-1,mt=!0,pt;if(_!==void 0&&_.length>0&&_.length<=it.length){if(_.length===it.length&&_===it)return"";let gt=_.length-1,bt=-1;for(pt=it.length-1;pt>=0;--pt){const wt=it.charCodeAt(pt);if(wt===47){if(!mt){lt=pt+1;break}}else bt===-1&&(mt=!1,bt=pt+1),gt>=0&&(wt===_.charCodeAt(gt)?--gt===-1&&(ft=pt):(gt=-1,ft=bt))}return lt===ft?ft=bt:ft===-1&&(ft=it.length),it.slice(lt,ft)}for(pt=it.length-1;pt>=0;--pt)if(it.charCodeAt(pt)===47){if(!mt){lt=pt+1;break}}else ft===-1&&(mt=!1,ft=pt+1);return ft===-1?"":it.slice(lt,ft)},extname(it){assertPath(it),it=removeUrlParams(this.toPosix(it));let _=-1,lt=0,ft=-1,mt=!0,pt=0;for(let gt=it.length-1;gt>=0;--gt){const bt=it.charCodeAt(gt);if(bt===47){if(!mt){lt=gt+1;break}continue}ft===-1&&(mt=!1,ft=gt+1),bt===46?_===-1?_=gt:pt!==1&&(pt=1):_!==-1&&(pt=-1)}return _===-1||ft===-1||pt===0||pt===1&&_===ft-1&&_===lt+1?"":it.slice(_,ft)},parse(it){assertPath(it);const _={root:"",dir:"",base:"",ext:"",name:""};if(it.length===0)return _;it=removeUrlParams(this.toPosix(it));let lt=it.charCodeAt(0);const ft=this.isAbsolute(it);let mt;_.root=this.rootname(it),ft||this.hasProtocol(it)?mt=1:mt=0;let pt=-1,gt=0,bt=-1,wt=!0,vt=it.length-1,Ct=0;for(;vt>=mt;--vt){if(lt=it.charCodeAt(vt),lt===47){if(!wt){gt=vt+1;break}continue}bt===-1&&(wt=!1,bt=vt+1),lt===46?pt===-1?pt=vt:Ct!==1&&(Ct=1):pt!==-1&&(Ct=-1)}return pt===-1||bt===-1||Ct===0||Ct===1&&pt===bt-1&&pt===gt+1?bt!==-1&&(gt===0&&ft?_.base=_.name=it.slice(1,bt):_.base=_.name=it.slice(gt,bt)):(gt===0&&ft?(_.name=it.slice(1,pt),_.base=it.slice(1,bt)):(_.name=it.slice(gt,pt),_.base=it.slice(gt,bt)),_.ext=it.slice(pt,bt)),_.dir=this.dirname(it),_},sep:"/",delimiter:":",joinExtensions:[".html"]};let promise;async function detectVideoAlphaMode(){return promise??(promise=(async()=>{var pt;const it=document.createElement("canvas").getContext("webgl");if(!it)return ALPHA_MODES.UNPACK;const _=await new Promise(gt=>{const bt=document.createElement("video");bt.onloadeddata=()=>gt(bt),bt.onerror=()=>gt(null),bt.autoplay=!1,bt.crossOrigin="anonymous",bt.preload="auto",bt.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",bt.load()});if(!_)return ALPHA_MODES.UNPACK;const lt=it.createTexture();it.bindTexture(it.TEXTURE_2D,lt);const ft=it.createFramebuffer();it.bindFramebuffer(it.FRAMEBUFFER,ft),it.framebufferTexture2D(it.FRAMEBUFFER,it.COLOR_ATTACHMENT0,it.TEXTURE_2D,lt,0),it.pixelStorei(it.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),it.pixelStorei(it.UNPACK_COLORSPACE_CONVERSION_WEBGL,it.NONE),it.texImage2D(it.TEXTURE_2D,0,it.RGBA,it.RGBA,it.UNSIGNED_BYTE,_);const mt=new Uint8Array(4);return it.readPixels(0,0,1,1,it.RGBA,it.UNSIGNED_BYTE,mt),it.deleteFramebuffer(ft),it.deleteTexture(lt),(pt=it.getExtension("WEBGL_lose_context"))==null||pt.loseContext(),mt[0]<=mt[3]?ALPHA_MODES.PMA:ALPHA_MODES.UNPACK})()),promise}let supported;function isWebGLSupported(){return typeof supported>"u"&&(supported=function(){var _;const it={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!settings.ADAPTER.getWebGLRenderingContext())return!1;const lt=settings.ADAPTER.createCanvas();let ft=lt.getContext("webgl",it)||lt.getContext("experimental-webgl",it);const mt=!!((_=ft==null?void 0:ft.getContextAttributes())!=null&&_.stencil);if(ft){const pt=ft.getExtension("WEBGL_lose_context");pt&&pt.loseContext()}return ft=null,mt}catch{return!1}}()),supported}var r={grad:.9,turn:360,rad:360/(2*Math.PI)},t=function(it){return typeof it=="string"?it.length>0:typeof it=="number"},n=function(it,_,lt){return _===void 0&&(_=0),lt===void 0&&(lt=Math.pow(10,_)),Math.round(lt*it)/lt+0},e=function(it,_,lt){return _===void 0&&(_=0),lt===void 0&&(lt=1),it>lt?lt:it>_?it:_},u=function(it){return(it=isFinite(it)?it%360:0)>0?it:it+360},a=function(it){return{r:e(it.r,0,255),g:e(it.g,0,255),b:e(it.b,0,255),a:e(it.a)}},o=function(it){return{r:n(it.r),g:n(it.g),b:n(it.b),a:n(it.a,3)}},i=/^#([0-9a-f]{3,8})$/i,s=function(it){var _=it.toString(16);return _.length<2?"0"+_:_},h=function(it){var _=it.r,lt=it.g,ft=it.b,mt=it.a,pt=Math.max(_,lt,ft),gt=pt-Math.min(_,lt,ft),bt=gt?pt===_?(lt-ft)/gt:pt===lt?2+(ft-_)/gt:4+(_-lt)/gt:0;return{h:60*(bt<0?bt+6:bt),s:pt?gt/pt*100:0,v:pt/255*100,a:mt}},b=function(it){var _=it.h,lt=it.s,ft=it.v,mt=it.a;_=_/360*6,lt/=100,ft/=100;var pt=Math.floor(_),gt=ft*(1-lt),bt=ft*(1-(_-pt)*lt),wt=ft*(1-(1-_+pt)*lt),vt=pt%6;return{r:255*[ft,bt,gt,gt,wt,ft][vt],g:255*[wt,ft,ft,bt,gt,gt][vt],b:255*[gt,gt,wt,ft,ft,bt][vt],a:mt}},g=function(it){return{h:u(it.h),s:e(it.s,0,100),l:e(it.l,0,100),a:e(it.a)}},d=function(it){return{h:n(it.h),s:n(it.s),l:n(it.l),a:n(it.a,3)}},f=function(it){return b((lt=(_=it).s,{h:_.h,s:(lt*=((ft=_.l)<50?ft:100-ft)/100)>0?2*lt/(ft+lt)*100:0,v:ft+lt,a:_.a}));var _,lt,ft},c=function(it){return{h:(_=h(it)).h,s:(mt=(200-(lt=_.s))*(ft=_.v)/100)>0&&mt<200?lt*ft/100/(mt<=100?mt:200-mt)*100:0,l:mt/2,a:_.a};var _,lt,ft,mt},l=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,p=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,v=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,y={string:[[function(it){var _=i.exec(it);return _?(it=_[1]).length<=4?{r:parseInt(it[0]+it[0],16),g:parseInt(it[1]+it[1],16),b:parseInt(it[2]+it[2],16),a:it.length===4?n(parseInt(it[3]+it[3],16)/255,2):1}:it.length===6||it.length===8?{r:parseInt(it.substr(0,2),16),g:parseInt(it.substr(2,2),16),b:parseInt(it.substr(4,2),16),a:it.length===8?n(parseInt(it.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(it){var _=v.exec(it)||m.exec(it);return _?_[2]!==_[4]||_[4]!==_[6]?null:a({r:Number(_[1])/(_[2]?100/255:1),g:Number(_[3])/(_[4]?100/255:1),b:Number(_[5])/(_[6]?100/255:1),a:_[7]===void 0?1:Number(_[7])/(_[8]?100:1)}):null},"rgb"],[function(it){var _=l.exec(it)||p.exec(it);if(!_)return null;var lt,ft,mt=g({h:(lt=_[1],ft=_[2],ft===void 0&&(ft="deg"),Number(lt)*(r[ft]||1)),s:Number(_[3]),l:Number(_[4]),a:_[5]===void 0?1:Number(_[5])/(_[6]?100:1)});return f(mt)},"hsl"]],object:[[function(it){var _=it.r,lt=it.g,ft=it.b,mt=it.a,pt=mt===void 0?1:mt;return t(_)&&t(lt)&&t(ft)?a({r:Number(_),g:Number(lt),b:Number(ft),a:Number(pt)}):null},"rgb"],[function(it){var _=it.h,lt=it.s,ft=it.l,mt=it.a,pt=mt===void 0?1:mt;if(!t(_)||!t(lt)||!t(ft))return null;var gt=g({h:Number(_),s:Number(lt),l:Number(ft),a:Number(pt)});return f(gt)},"hsl"],[function(it){var _=it.h,lt=it.s,ft=it.v,mt=it.a,pt=mt===void 0?1:mt;if(!t(_)||!t(lt)||!t(ft))return null;var gt=function(bt){return{h:u(bt.h),s:e(bt.s,0,100),v:e(bt.v,0,100),a:e(bt.a)}}({h:Number(_),s:Number(lt),v:Number(ft),a:Number(pt)});return b(gt)},"hsv"]]},N=function(it,_){for(var lt=0;lt<_.length;lt++){var ft=_[lt][0](it);if(ft)return[ft,_[lt][1]]}return[null,void 0]},x=function(it){return typeof it=="string"?N(it.trim(),y.string):typeof it=="object"&&it!==null?N(it,y.object):[null,void 0]},M=function(it,_){var lt=c(it);return{h:lt.h,s:e(lt.s+100*_,0,100),l:lt.l,a:lt.a}},H=function(it){return(299*it.r+587*it.g+114*it.b)/1e3/255},$=function(it,_){var lt=c(it);return{h:lt.h,s:lt.s,l:e(lt.l+100*_,0,100),a:lt.a}},j=function(){function it(_){this.parsed=x(_)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return it.prototype.isValid=function(){return this.parsed!==null},it.prototype.brightness=function(){return n(H(this.rgba),2)},it.prototype.isDark=function(){return H(this.rgba)<.5},it.prototype.isLight=function(){return H(this.rgba)>=.5},it.prototype.toHex=function(){return _=o(this.rgba),lt=_.r,ft=_.g,mt=_.b,gt=(pt=_.a)<1?s(n(255*pt)):"","#"+s(lt)+s(ft)+s(mt)+gt;var _,lt,ft,mt,pt,gt},it.prototype.toRgb=function(){return o(this.rgba)},it.prototype.toRgbString=function(){return _=o(this.rgba),lt=_.r,ft=_.g,mt=_.b,(pt=_.a)<1?"rgba("+lt+", "+ft+", "+mt+", "+pt+")":"rgb("+lt+", "+ft+", "+mt+")";var _,lt,ft,mt,pt},it.prototype.toHsl=function(){return d(c(this.rgba))},it.prototype.toHslString=function(){return _=d(c(this.rgba)),lt=_.h,ft=_.s,mt=_.l,(pt=_.a)<1?"hsla("+lt+", "+ft+"%, "+mt+"%, "+pt+")":"hsl("+lt+", "+ft+"%, "+mt+"%)";var _,lt,ft,mt,pt},it.prototype.toHsv=function(){return _=h(this.rgba),{h:n(_.h),s:n(_.s),v:n(_.v),a:n(_.a,3)};var _},it.prototype.invert=function(){return w({r:255-(_=this.rgba).r,g:255-_.g,b:255-_.b,a:_.a});var _},it.prototype.saturate=function(_){return _===void 0&&(_=.1),w(M(this.rgba,_))},it.prototype.desaturate=function(_){return _===void 0&&(_=.1),w(M(this.rgba,-_))},it.prototype.grayscale=function(){return w(M(this.rgba,-1))},it.prototype.lighten=function(_){return _===void 0&&(_=.1),w($(this.rgba,_))},it.prototype.darken=function(_){return _===void 0&&(_=.1),w($(this.rgba,-_))},it.prototype.rotate=function(_){return _===void 0&&(_=15),this.hue(this.hue()+_)},it.prototype.alpha=function(_){return typeof _=="number"?w({r:(lt=this.rgba).r,g:lt.g,b:lt.b,a:_}):n(this.rgba.a,3);var lt},it.prototype.hue=function(_){var lt=c(this.rgba);return typeof _=="number"?w({h:_,s:lt.s,l:lt.l,a:lt.a}):n(lt.h)},it.prototype.isEqual=function(_){return this.toHex()===w(_).toHex()},it}(),w=function(it){return it instanceof j?it:new j(it)},S=[],k=function(it){it.forEach(function(_){S.indexOf(_)<0&&(_(j,y),S.push(_))})};function namesPlugin(it,_){var lt={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},ft={};for(var mt in lt)ft[lt[mt]]=mt;var pt={};it.prototype.toName=function(gt){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var bt,wt,vt=ft[this.toHex()];if(vt)return vt;if(gt!=null&&gt.closest){var Ct=this.toRgb(),Rt=1/0,Mt="black";if(!pt.length)for(var Ot in lt)pt[Ot]=new it(lt[Ot]).toRgb();for(var Nt in lt){var Ht=(bt=Ct,wt=pt[Nt],Math.pow(bt.r-wt.r,2)+Math.pow(bt.g-wt.g,2)+Math.pow(bt.b-wt.b,2));Ht<Rt&&(Rt=Ht,Mt=Nt)}return Mt}},_.string.push([function(gt){var bt=gt.toLowerCase(),wt=bt==="transparent"?"#0000":lt[bt];return wt?new it(wt).toRgb():null},"name"])}k([namesPlugin]);const _Color=class ky{constructor(_=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=_}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(_){return this.value=_,this}set value(_){if(_ instanceof ky)this._value=this.cloneSource(_._value),this._int=_._int,this._components.set(_._components);else{if(_===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,_))&&(this.normalize(_),this._value=this.cloneSource(_))}}get value(){return this._value}cloneSource(_){return typeof _=="string"||typeof _=="number"||_ instanceof Number||_===null?_:Array.isArray(_)||ArrayBuffer.isView(_)?_.slice(0):typeof _=="object"&&_!==null?{..._}:_}isSourceEqual(_,lt){const ft=typeof _;if(ft!==typeof lt)return!1;if(ft==="number"||ft==="string"||_ instanceof Number)return _===lt;if(Array.isArray(_)&&Array.isArray(lt)||ArrayBuffer.isView(_)&&ArrayBuffer.isView(lt))return _.length!==lt.length?!1:_.every((mt,pt)=>mt===lt[pt]);if(_!==null&&lt!==null){const mt=Object.keys(_),pt=Object.keys(lt);return mt.length!==pt.length?!1:mt.every(gt=>_[gt]===lt[gt])}return _===lt}toRgba(){const[_,lt,ft,mt]=this._components;return{r:_,g:lt,b:ft,a:mt}}toRgb(){const[_,lt,ft]=this._components;return{r:_,g:lt,b:ft}}toRgbaString(){const[_,lt,ft]=this.toUint8RgbArray();return`rgba(${_},${lt},${ft},${this.alpha})`}toUint8RgbArray(_){const[lt,ft,mt]=this._components;return _=_??[],_[0]=Math.round(lt*255),_[1]=Math.round(ft*255),_[2]=Math.round(mt*255),_}toRgbArray(_){_=_??[];const[lt,ft,mt]=this._components;return _[0]=lt,_[1]=ft,_[2]=mt,_}toNumber(){return this._int}toLittleEndianNumber(){const _=this._int;return(_>>16)+(_&65280)+((_&255)<<16)}multiply(_){const[lt,ft,mt,pt]=ky.temp.setValue(_)._components;return this._components[0]*=lt,this._components[1]*=ft,this._components[2]*=mt,this._components[3]*=pt,this.refreshInt(),this._value=null,this}premultiply(_,lt=!0){return lt&&(this._components[0]*=_,this._components[1]*=_,this._components[2]*=_),this._components[3]=_,this.refreshInt(),this._value=null,this}toPremultiplied(_,lt=!0){if(_===1)return(255<<24)+this._int;if(_===0)return lt?0:this._int;let ft=this._int>>16&255,mt=this._int>>8&255,pt=this._int&255;return lt&&(ft=ft*_+.5|0,mt=mt*_+.5|0,pt=pt*_+.5|0),(_*255<<24)+(ft<<16)+(mt<<8)+pt}toHex(){const _=this._int.toString(16);return`#${"000000".substring(0,6-_.length)+_}`}toHexa(){const _=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-_.length)+_}setAlpha(_){return this._components[3]=this._clamp(_),this}round(_){const[lt,ft,mt]=this._components;return this._components[0]=Math.round(lt*_)/_,this._components[1]=Math.round(ft*_)/_,this._components[2]=Math.round(mt*_)/_,this.refreshInt(),this._value=null,this}toArray(_){_=_??[];const[lt,ft,mt,pt]=this._components;return _[0]=lt,_[1]=ft,_[2]=mt,_[3]=pt,_}normalize(_){let lt,ft,mt,pt;if((typeof _=="number"||_ instanceof Number)&&_>=0&&_<=16777215){const gt=_;lt=(gt>>16&255)/255,ft=(gt>>8&255)/255,mt=(gt&255)/255,pt=1}else if((Array.isArray(_)||_ instanceof Float32Array)&&_.length>=3&&_.length<=4)_=this._clamp(_),[lt,ft,mt,pt=1]=_;else if((_ instanceof Uint8Array||_ instanceof Uint8ClampedArray)&&_.length>=3&&_.length<=4)_=this._clamp(_,0,255),[lt,ft,mt,pt=255]=_,lt/=255,ft/=255,mt/=255,pt/=255;else if(typeof _=="string"||typeof _=="object"){if(typeof _=="string"){const bt=ky.HEX_PATTERN.exec(_);bt&&(_=`#${bt[2]}`)}const gt=w(_);gt.isValid()&&({r:lt,g:ft,b:mt,a:pt}=gt.rgba,lt/=255,ft/=255,mt/=255)}if(lt!==void 0)this._components[0]=lt,this._components[1]=ft,this._components[2]=mt,this._components[3]=pt,this.refreshInt();else throw new Error(`Unable to convert color ${_}`)}refreshInt(){this._clamp(this._components);const[_,lt,ft]=this._components;this._int=(_*255<<16)+(lt*255<<8)+(ft*255|0)}_clamp(_,lt=0,ft=1){return typeof _=="number"?Math.min(Math.max(_,lt),ft):(_.forEach((mt,pt)=>{_[pt]=Math.min(Math.max(mt,lt),ft)}),_)}};_Color.shared=new _Color,_Color.temp=new _Color,_Color.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Color=_Color;function hex2string(it){return deprecation("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Color.shared.setValue(it).toHex()}function rgb2hex(it){return deprecation("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Color.shared.setValue(it).toNumber()}function mapPremultipliedBlendModes(){const it=[],_=[];for(let ft=0;ft<32;ft++)it[ft]=ft,_[ft]=ft;it[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL,it[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD,it[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN,_[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM,_[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM,_[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;const lt=[];return lt.push(_),lt.push(it),lt}const premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(it,_){return premultiplyBlendMode[_?1:0][it]}function createIndicesForQuads(it,_=null){const lt=it*6;if(_=_||new Uint16Array(lt),_.length!==lt)throw new Error(`Out buffer length is incorrect, got ${_.length} and expected ${lt}`);for(let ft=0,mt=0;ft<lt;ft+=6,mt+=4)_[ft+0]=mt+0,_[ft+1]=mt+1,_[ft+2]=mt+2,_[ft+3]=mt+0,_[ft+4]=mt+2,_[ft+5]=mt+3;return _}function getBufferType(it){if(it.BYTES_PER_ELEMENT===4)return it instanceof Float32Array?"Float32Array":it instanceof Uint32Array?"Uint32Array":"Int32Array";if(it.BYTES_PER_ELEMENT===2){if(it instanceof Uint16Array)return"Uint16Array"}else if(it.BYTES_PER_ELEMENT===1&&it instanceof Uint8Array)return"Uint8Array";return null}function nextPow2(it){return it+=it===0?1:0,--it,it|=it>>>1,it|=it>>>2,it|=it>>>4,it|=it>>>8,it|=it>>>16,it+1}function isPow2(it){return!(it&it-1)&&!!it}function log2(it){let _=(it>65535?1:0)<<4;it>>>=_;let lt=(it>255?1:0)<<3;return it>>>=lt,_|=lt,lt=(it>15?1:0)<<2,it>>>=lt,_|=lt,lt=(it>3?1:0)<<1,it>>>=lt,_|=lt,_|it>>1}function removeItems(it,_,lt){const ft=it.length;let mt;if(_>=ft||lt===0)return;lt=_+lt>ft?ft-_:lt;const pt=ft-lt;for(mt=_;mt<pt;++mt)it[mt]=it[mt+lt];it.length=pt}function sign(it){return it===0?0:it<0?-1:1}let nextUid=0;function uid(){return++nextUid}const _BoundingBox=class{constructor(it,_,lt,ft){this.left=it,this.top=_,this.right=lt,this.bottom=ft}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};_BoundingBox.EMPTY=new _BoundingBox(0,0,0,0);let BoundingBox=_BoundingBox;const ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);class CanvasRenderTarget{constructor(_,lt,ft){this._canvas=settings.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=ft||settings.RESOLUTION,this.resize(_,lt)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(_,lt){this._checkDestroyed(),this._canvas.width=Math.round(_*this.resolution),this._canvas.height=Math.round(lt*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(_){this._checkDestroyed(),this._canvas.width=Math.round(_)}get height(){return this._checkDestroyed(),this._canvas.height}set height(_){this._checkDestroyed(),this._canvas.height=Math.round(_)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function checkRow(it,_,lt){for(let ft=0,mt=4*lt*_;ft<_;++ft,mt+=4)if(it[mt+3]!==0)return!1;return!0}function checkColumn(it,_,lt,ft,mt){const pt=4*_;for(let gt=ft,bt=ft*pt+4*lt;gt<=mt;++gt,bt+=pt)if(it[bt+3]!==0)return!1;return!0}function getCanvasBoundingBox(it){const{width:_,height:lt}=it,ft=it.getContext("2d",{willReadFrequently:!0});if(ft===null)throw new TypeError("Failed to get canvas 2D context");const mt=ft.getImageData(0,0,_,lt).data;let pt=0,gt=0,bt=_-1,wt=lt-1;for(;gt<lt&&checkRow(mt,_,gt);)++gt;if(gt===lt)return BoundingBox.EMPTY;for(;checkRow(mt,_,wt);)--wt;for(;checkColumn(mt,_,pt,gt,wt);)++pt;for(;checkColumn(mt,_,bt,gt,wt);)--bt;return++bt,++wt,new BoundingBox(pt,gt,bt,wt)}function trimCanvas(it){const _=getCanvasBoundingBox(it),{width:lt,height:ft}=_;let mt=null;if(!_.isEmpty()){const pt=it.getContext("2d");if(pt===null)throw new TypeError("Failed to get canvas 2D context");mt=pt.getImageData(_.left,_.top,lt,ft)}return{width:lt,height:ft,data:mt}}function determineCrossOrigin(it,_=globalThis.location){if(it.startsWith("data:"))return"";_=_||globalThis.location;const lt=new URL(it,document.baseURI);return lt.hostname!==_.hostname||lt.port!==_.port||lt.protocol!==_.protocol?"anonymous":""}function getResolutionOfUrl(it,_=1){var ft;const lt=(ft=settings.RETINA_PREFIX)==null?void 0:ft.exec(it);return lt?parseFloat(lt[1]):_}var ExtensionType=(it=>(it.Renderer="renderer",it.Application="application",it.RendererSystem="renderer-webgl-system",it.RendererPlugin="renderer-webgl-plugin",it.CanvasRendererSystem="renderer-canvas-system",it.CanvasRendererPlugin="renderer-canvas-plugin",it.Asset="asset",it.LoadParser="load-parser",it.ResolveParser="resolve-parser",it.CacheParser="cache-parser",it.DetectionParser="detection-parser",it))(ExtensionType||{});const normalizeExtension=it=>{if(typeof it=="function"||typeof it=="object"&&it.extension){if(!it.extension)throw new Error("Extension class must have an extension object");it={...typeof it.extension!="object"?{type:it.extension}:it.extension,ref:it}}if(typeof it=="object")it={...it};else throw new Error("Invalid extension type");return typeof it.type=="string"&&(it.type=[it.type]),it},normalizePriority=(it,_)=>normalizeExtension(it).priority??_,extensions$1={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...it){return it.map(normalizeExtension).forEach(_=>{_.type.forEach(lt=>{var ft,mt;return(mt=(ft=this._removeHandlers)[lt])==null?void 0:mt.call(ft,_)})}),this},add(...it){return it.map(normalizeExtension).forEach(_=>{_.type.forEach(lt=>{var pt,gt;const ft=this._addHandlers,mt=this._queue;ft[lt]?(pt=ft[lt])==null||pt.call(ft,_):(mt[lt]=mt[lt]||[],(gt=mt[lt])==null||gt.push(_))})}),this},handle(it,_,lt){var gt;const ft=this._addHandlers,mt=this._removeHandlers;if(ft[it]||mt[it])throw new Error(`Extension type ${it} already has a handler`);ft[it]=_,mt[it]=lt;const pt=this._queue;return pt[it]&&((gt=pt[it])==null||gt.forEach(bt=>_(bt)),delete pt[it]),this},handleByMap(it,_){return this.handle(it,lt=>{lt.name&&(_[lt.name]=lt.ref)},lt=>{lt.name&&delete _[lt.name]})},handleByList(it,_,lt=-1){return this.handle(it,ft=>{_.includes(ft.ref)||(_.push(ft.ref),_.sort((mt,pt)=>normalizePriority(pt,lt)-normalizePriority(mt,lt)))},ft=>{const mt=_.indexOf(ft.ref);mt!==-1&&_.splice(mt,1)})}};class ViewableBuffer{constructor(_){typeof _=="number"?this.rawBinaryData=new ArrayBuffer(_):_ instanceof Uint8Array?this.rawBinaryData=_.buffer:this.rawBinaryData=_,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(_){return this[`${_}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(_){switch(_){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${_} isn't a valid view type`)}}}const fragTemplate$1=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc(it){let _="";for(let lt=0;lt<it;++lt)lt>0&&(_+=`
else `),lt<it-1&&(_+=`if(test == ${lt}.0){}`);return _}function checkMaxIfStatementsInShader(it,_){if(it===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const lt=_.createShader(_.FRAGMENT_SHADER);for(;;){const ft=fragTemplate$1.replace(/%forloop%/gi,generateIfTestSrc(it));if(_.shaderSource(lt,ft),_.compileShader(lt),!_.getShaderParameter(lt,_.COMPILE_STATUS))it=it/2|0;else break}return it}const BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5;class State{constructor(){this.data=0,this.blendMode=BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<BLEND$1)}set blend(_){!!(this.data&1<<BLEND$1)!==_&&(this.data^=1<<BLEND$1)}get offsets(){return!!(this.data&1<<OFFSET$1)}set offsets(_){!!(this.data&1<<OFFSET$1)!==_&&(this.data^=1<<OFFSET$1)}get culling(){return!!(this.data&1<<CULLING$1)}set culling(_){!!(this.data&1<<CULLING$1)!==_&&(this.data^=1<<CULLING$1)}get depthTest(){return!!(this.data&1<<DEPTH_TEST$1)}set depthTest(_){!!(this.data&1<<DEPTH_TEST$1)!==_&&(this.data^=1<<DEPTH_TEST$1)}get depthMask(){return!!(this.data&1<<DEPTH_MASK$1)}set depthMask(_){!!(this.data&1<<DEPTH_MASK$1)!==_&&(this.data^=1<<DEPTH_MASK$1)}get clockwiseFrontFace(){return!!(this.data&1<<WINDING$1)}set clockwiseFrontFace(_){!!(this.data&1<<WINDING$1)!==_&&(this.data^=1<<WINDING$1)}get blendMode(){return this._blendMode}set blendMode(_){this.blend=_!==BLEND_MODES.NONE,this._blendMode=_}get polygonOffset(){return this._polygonOffset}set polygonOffset(_){this.offsets=!!_,this._polygonOffset=_}static for2d(){const _=new State;return _.depthTest=!1,_.blend=!0,_}}State.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const INSTALLED=[];function autoDetectResource(it,_){if(!it)return null;let lt="";if(typeof it=="string"){const ft=/\.(\w{3,4})(?:$|\?|#)/i.exec(it);ft&&(lt=ft[1].toLowerCase())}for(let ft=INSTALLED.length-1;ft>=0;--ft){const mt=INSTALLED[ft];if(mt.test&&mt.test(it,lt))return new mt(it,_)}throw new Error("Unrecognized source type to auto-detect Resource")}class Runner{constructor(_){this.items=[],this._name=_,this._aliasCount=0}emit(_,lt,ft,mt,pt,gt,bt,wt){if(arguments.length>8)throw new Error("max arguments reached");const{name:vt,items:Ct}=this;this._aliasCount++;for(let Rt=0,Mt=Ct.length;Rt<Mt;Rt++)Ct[Rt][vt](_,lt,ft,mt,pt,gt,bt,wt);return Ct===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(_){return _[this._name]&&(this.ensureNonAliasedItems(),this.remove(_),this.items.push(_)),this}remove(_){const lt=this.items.indexOf(_);return lt!==-1&&(this.ensureNonAliasedItems(),this.items.splice(lt,1)),this}contains(_){return this.items.includes(_)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});class Resource{constructor(_=0,lt=0){this._width=_,this._height=lt,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}bind(_){this.onResize.add(_),this.onUpdate.add(_),this.onError.add(_),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(_){this.onResize.remove(_),this.onUpdate.remove(_),this.onError.remove(_)}resize(_,lt){(_!==this._width||lt!==this._height)&&(this._width=_,this._height=lt,this.onResize.emit(_,lt))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(_,lt,ft){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(_,lt){return!1}}class BufferResource extends Resource{constructor(_,lt){const{width:ft,height:mt}=lt||{};if(!ft||!mt)throw new Error("BufferResource width or height invalid");super(ft,mt),this.data=_,this.unpackAlignment=lt.unpackAlignment??4}upload(_,lt,ft){const mt=_.gl;mt.pixelStorei(mt.UNPACK_ALIGNMENT,this.unpackAlignment),mt.pixelStorei(mt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,lt.alphaMode===ALPHA_MODES.UNPACK);const pt=lt.realWidth,gt=lt.realHeight;return ft.width===pt&&ft.height===gt?mt.texSubImage2D(lt.target,0,0,0,pt,gt,lt.format,ft.type,this.data):(ft.width=pt,ft.height=gt,mt.texImage2D(lt.target,0,ft.internalFormat,pt,gt,0,lt.format,ft.type,this.data)),!0}dispose(){this.data=null}static test(_){return _===null||_ instanceof Int8Array||_ instanceof Uint8Array||_ instanceof Uint8ClampedArray||_ instanceof Int16Array||_ instanceof Uint16Array||_ instanceof Int32Array||_ instanceof Uint32Array||_ instanceof Float32Array}}const defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,alphaMode:ALPHA_MODES.NPM},_BaseTexture=class hy extends EventEmitter{constructor(_=null,lt=null){super(),lt=Object.assign({},hy.defaultOptions,lt);const{alphaMode:ft,mipmap:mt,anisotropicLevel:pt,scaleMode:gt,width:bt,height:wt,wrapMode:vt,format:Ct,type:Rt,target:Mt,resolution:Ot,resourceOptions:Nt}=lt;_&&!(_ instanceof Resource)&&(_=autoDetectResource(_,Nt),_.internal=!0),this.resolution=Ot||settings.RESOLUTION,this.width=Math.round((bt||0)*this.resolution)/this.resolution,this.height=Math.round((wt||0)*this.resolution)/this.resolution,this._mipmap=mt,this.anisotropicLevel=pt,this._wrapMode=vt,this._scaleMode=gt,this.format=Ct,this.type=Rt,this.target=Mt,this.alphaMode=ft,this.uid=uid(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=bt>0&&wt>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(_)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(_){this._mipmap!==_&&(this._mipmap=_,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(_){this._scaleMode!==_&&(this._scaleMode=_,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(_){this._wrapMode!==_&&(this._wrapMode=_,this.dirtyStyleId++)}setStyle(_,lt){let ft;return _!==void 0&&_!==this.scaleMode&&(this.scaleMode=_,ft=!0),lt!==void 0&&lt!==this.mipmap&&(this.mipmap=lt,ft=!0),ft&&this.dirtyStyleId++,this}setSize(_,lt,ft){return ft=ft||this.resolution,this.setRealSize(_*ft,lt*ft,ft)}setRealSize(_,lt,ft){return this.resolution=ft||this.resolution,this.width=Math.round(_)/this.resolution,this.height=Math.round(lt)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)}setResolution(_){const lt=this.resolution;return lt===_?this:(this.resolution=_,this.valid&&(this.width=Math.round(this.width*lt)/_,this.height=Math.round(this.height*lt)/_,this.emit("update",this)),this._refreshPOT(),this)}setResource(_){if(this.resource===_)return this;if(this.resource)throw new Error("Resource can be set only once");return _.bind(this),this.resource=_,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(_){this.emit("error",this,_)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),hy.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(_,lt,ft=settings.STRICT_TEXTURE_CACHE){const mt=typeof _=="string";let pt=null;if(mt)pt=_;else{if(!_._pixiId){const bt=(lt==null?void 0:lt.pixiIdPrefix)||"pixiid";_._pixiId=`${bt}_${uid()}`}pt=_._pixiId}let gt=BaseTextureCache[pt];if(mt&&ft&&!gt)throw new Error(`The cacheId "${pt}" does not exist in BaseTextureCache.`);return gt||(gt=new hy(_,lt),gt.cacheId=pt,hy.addToCache(gt,pt)),gt}static fromBuffer(_,lt,ft,mt){_=_||new Float32Array(lt*ft*4);const pt=new BufferResource(_,{width:lt,height:ft,...mt==null?void 0:mt.resourceOptions});let gt,bt;return _ instanceof Float32Array?(gt=FORMATS.RGBA,bt=TYPES.FLOAT):_ instanceof Int32Array?(gt=FORMATS.RGBA_INTEGER,bt=TYPES.INT):_ instanceof Uint32Array?(gt=FORMATS.RGBA_INTEGER,bt=TYPES.UNSIGNED_INT):_ instanceof Int16Array?(gt=FORMATS.RGBA_INTEGER,bt=TYPES.SHORT):_ instanceof Uint16Array?(gt=FORMATS.RGBA_INTEGER,bt=TYPES.UNSIGNED_SHORT):_ instanceof Int8Array?(gt=FORMATS.RGBA,bt=TYPES.BYTE):(gt=FORMATS.RGBA,bt=TYPES.UNSIGNED_BYTE),pt.internal=!0,new hy(pt,Object.assign({},defaultBufferOptions,{type:bt,format:gt},mt))}static addToCache(_,lt){lt&&(_.textureCacheIds.includes(lt)||_.textureCacheIds.push(lt),BaseTextureCache[lt]&&BaseTextureCache[lt]!==_&&console.warn(`BaseTexture added to the cache with an id [${lt}] that already had an entry`),BaseTextureCache[lt]=_)}static removeFromCache(_){if(typeof _=="string"){const lt=BaseTextureCache[_];if(lt){const ft=lt.textureCacheIds.indexOf(_);return ft>-1&&lt.textureCacheIds.splice(ft,1),delete BaseTextureCache[_],lt}}else if(_!=null&&_.textureCacheIds){for(let lt=0;lt<_.textureCacheIds.length;++lt)delete BaseTextureCache[_.textureCacheIds[lt]];return _.textureCacheIds.length=0,_}return null}};_BaseTexture.defaultOptions={mipmap:MIPMAP_MODES.POW2,anisotropicLevel:0,scaleMode:SCALE_MODES.LINEAR,wrapMode:WRAP_MODES.CLAMP,alphaMode:ALPHA_MODES.UNPACK,target:TARGETS.TEXTURE_2D,format:FORMATS.RGBA,type:TYPES.UNSIGNED_BYTE},_BaseTexture._globalBatch=0;let BaseTexture=_BaseTexture;class BatchDrawCall{constructor(){this.texArray=null,this.blend=0,this.type=DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}}let UID$4=0,Buffer$1=class yv{constructor(_,lt=!0,ft=!1){this.data=_||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=ft,this.static=lt,this.id=UID$4++,this.disposeRunner=new Runner("disposeBuffer")}update(_){_ instanceof Array&&(_=new Float32Array(_)),this.data=_||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(_){this.type=_?BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:BUFFER_TYPE.ARRAY_BUFFER}get index(){return this.type===BUFFER_TYPE.ELEMENT_ARRAY_BUFFER}static from(_){return _ instanceof Array&&(_=new Float32Array(_)),new yv(_)}};class Attribute{constructor(_,lt=0,ft=!1,mt=TYPES.FLOAT,pt,gt,bt,wt=1){this.buffer=_,this.size=lt,this.normalized=ft,this.type=mt,this.stride=pt,this.start=gt,this.instance=bt,this.divisor=wt}destroy(){this.buffer=null}static from(_,lt,ft,mt,pt){return new Attribute(_,lt,ft,mt,pt)}}const map$1={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(it,_){let lt=0,ft=0;const mt={};for(let wt=0;wt<it.length;wt++)ft+=_[wt],lt+=it[wt].length;const pt=new ArrayBuffer(lt*4);let gt=null,bt=0;for(let wt=0;wt<it.length;wt++){const vt=_[wt],Ct=it[wt],Rt=getBufferType(Ct);mt[Rt]||(mt[Rt]=new map$1[Rt](pt)),gt=mt[Rt];for(let Mt=0;Mt<Ct.length;Mt++){const Ot=(Mt/vt|0)*ft+bt,Nt=Mt%vt;gt[Ot+Nt]=Ct[Mt]}bt+=vt}return new Float32Array(pt)}const byteSizeMap$1={5126:4,5123:2,5121:1};let UID$3=0;const map={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Geometry{constructor(_=[],lt={}){this.buffers=_,this.indexBuffer=null,this.attributes=lt,this.glVertexArrayObjects={},this.id=UID$3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}addAttribute(_,lt,ft=0,mt=!1,pt,gt,bt,wt=!1){if(!lt)throw new Error("You must pass a buffer when creating an attribute");lt instanceof Buffer$1||(lt instanceof Array&&(lt=new Float32Array(lt)),lt=new Buffer$1(lt));const vt=_.split("|");if(vt.length>1){for(let Rt=0;Rt<vt.length;Rt++)this.addAttribute(vt[Rt],lt,ft,mt,pt);return this}let Ct=this.buffers.indexOf(lt);return Ct===-1&&(this.buffers.push(lt),Ct=this.buffers.length-1),this.attributes[_]=new Attribute(Ct,ft,mt,pt,gt,bt,wt),this.instanced=this.instanced||wt,this}getAttribute(_){return this.attributes[_]}getBuffer(_){return this.buffers[this.getAttribute(_).buffer]}addIndex(_){return _ instanceof Buffer$1||(_ instanceof Array&&(_=new Uint16Array(_)),_=new Buffer$1(_)),_.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=_,this.buffers.includes(_)||this.buffers.push(_),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const _=[],lt=[],ft=new Buffer$1;let mt;for(mt in this.attributes){const pt=this.attributes[mt],gt=this.buffers[pt.buffer];_.push(gt.data),lt.push(pt.size*byteSizeMap$1[pt.type]/4),pt.buffer=0}for(ft.data=interleaveTypedArrays(_,lt),mt=0;mt<this.buffers.length;mt++)this.buffers[mt]!==this.indexBuffer&&this.buffers[mt].destroy();return this.buffers=[ft],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const _ in this.attributes){const lt=this.attributes[_];return this.buffers[lt.buffer].data.length/(lt.stride/4||lt.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const _=new Geometry;for(let lt=0;lt<this.buffers.length;lt++)_.buffers[lt]=new Buffer$1(this.buffers[lt].data.slice(0));for(const lt in this.attributes){const ft=this.attributes[lt];_.attributes[lt]=new Attribute(ft.buffer,ft.size,ft.normalized,ft.type,ft.stride,ft.start,ft.instance)}return this.indexBuffer&&(_.indexBuffer=_.buffers[this.buffers.indexOf(this.indexBuffer)],_.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),_}static merge(_){const lt=new Geometry,ft=[],mt=[],pt=[];let gt;for(let bt=0;bt<_.length;bt++){gt=_[bt];for(let wt=0;wt<gt.buffers.length;wt++)mt[wt]=mt[wt]||0,mt[wt]+=gt.buffers[wt].data.length,pt[wt]=0}for(let bt=0;bt<gt.buffers.length;bt++)ft[bt]=new map[getBufferType(gt.buffers[bt].data)](mt[bt]),lt.buffers[bt]=new Buffer$1(ft[bt]);for(let bt=0;bt<_.length;bt++){gt=_[bt];for(let wt=0;wt<gt.buffers.length;wt++)ft[wt].set(gt.buffers[wt].data,pt[wt]),pt[wt]+=gt.buffers[wt].data.length}if(lt.attributes=gt.attributes,gt.indexBuffer){lt.indexBuffer=lt.buffers[gt.buffers.indexOf(gt.indexBuffer)],lt.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;let bt=0,wt=0,vt=0,Ct=0;for(let Rt=0;Rt<gt.buffers.length;Rt++)if(gt.buffers[Rt]!==gt.indexBuffer){Ct=Rt;break}for(const Rt in gt.attributes){const Mt=gt.attributes[Rt];(Mt.buffer|0)===Ct&&(wt+=Mt.size*byteSizeMap$1[Mt.type]/4)}for(let Rt=0;Rt<_.length;Rt++){const Mt=_[Rt].indexBuffer.data;for(let Ot=0;Ot<Mt.length;Ot++)lt.indexBuffer.data[Ot+vt]+=bt;bt+=_[Rt].buffers[Ct].data.length/wt,vt+=Mt.length}}return lt}}class BatchGeometry extends Geometry{constructor(_=!1){super(),this._buffer=new Buffer$1(null,_,!1),this._indexBuffer=new Buffer$1(null,_,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aColor",this._buffer,4,!0,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,TYPES.FLOAT).addIndex(this._indexBuffer)}}const PI_2=Math.PI*2,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180;var SHAPES=(it=>(it[it.POLY=0]="POLY",it[it.RECT=1]="RECT",it[it.CIRC=2]="CIRC",it[it.ELIP=3]="ELIP",it[it.RREC=4]="RREC",it))(SHAPES||{});class Point{constructor(_=0,lt=0){this.x=0,this.y=0,this.x=_,this.y=lt}clone(){return new Point(this.x,this.y)}copyFrom(_){return this.set(_.x,_.y),this}copyTo(_){return _.set(this.x,this.y),_}equals(_){return _.x===this.x&&_.y===this.y}set(_=0,lt=_){return this.x=_,this.y=lt,this}}Point.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const tempPoints$1=[new Point,new Point,new Point,new Point];class Rectangle{constructor(_=0,lt=0,ft=0,mt=0){this.x=Number(_),this.y=Number(lt),this.width=Number(ft),this.height=Number(mt),this.type=SHAPES.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Rectangle(0,0,0,0)}clone(){return new Rectangle(this.x,this.y,this.width,this.height)}copyFrom(_){return this.x=_.x,this.y=_.y,this.width=_.width,this.height=_.height,this}copyTo(_){return _.x=this.x,_.y=this.y,_.width=this.width,_.height=this.height,_}contains(_,lt){return this.width<=0||this.height<=0?!1:_>=this.x&&_<this.x+this.width&&lt>=this.y&&lt<this.y+this.height}intersects(_,lt){if(!lt){const Nr=this.x<_.x?_.x:this.x;if((this.right>_.right?_.right:this.right)<=Nr)return!1;const jn=this.y<_.y?_.y:this.y;return(this.bottom>_.bottom?_.bottom:this.bottom)>jn}const ft=this.left,mt=this.right,pt=this.top,gt=this.bottom;if(mt<=ft||gt<=pt)return!1;const bt=tempPoints$1[0].set(_.left,_.top),wt=tempPoints$1[1].set(_.left,_.bottom),vt=tempPoints$1[2].set(_.right,_.top),Ct=tempPoints$1[3].set(_.right,_.bottom);if(vt.x<=bt.x||wt.y<=bt.y)return!1;const Rt=Math.sign(lt.a*lt.d-lt.b*lt.c);if(Rt===0||(lt.apply(bt,bt),lt.apply(wt,wt),lt.apply(vt,vt),lt.apply(Ct,Ct),Math.max(bt.x,wt.x,vt.x,Ct.x)<=ft||Math.min(bt.x,wt.x,vt.x,Ct.x)>=mt||Math.max(bt.y,wt.y,vt.y,Ct.y)<=pt||Math.min(bt.y,wt.y,vt.y,Ct.y)>=gt))return!1;const Mt=Rt*(wt.y-bt.y),Ot=Rt*(bt.x-wt.x),Nt=Mt*ft+Ot*pt,Ht=Mt*mt+Ot*pt,Kt=Mt*ft+Ot*gt,hr=Mt*mt+Ot*gt;if(Math.max(Nt,Ht,Kt,hr)<=Mt*bt.x+Ot*bt.y||Math.min(Nt,Ht,Kt,hr)>=Mt*Ct.x+Ot*Ct.y)return!1;const Qt=Rt*(bt.y-vt.y),mr=Rt*(vt.x-bt.x),br=Qt*ft+mr*pt,Fr=Qt*mt+mr*pt,kr=Qt*ft+mr*gt,Br=Qt*mt+mr*gt;return!(Math.max(br,Fr,kr,Br)<=Qt*bt.x+mr*bt.y||Math.min(br,Fr,kr,Br)>=Qt*Ct.x+mr*Ct.y)}pad(_=0,lt=_){return this.x-=_,this.y-=lt,this.width+=_*2,this.height+=lt*2,this}fit(_){const lt=Math.max(this.x,_.x),ft=Math.min(this.x+this.width,_.x+_.width),mt=Math.max(this.y,_.y),pt=Math.min(this.y+this.height,_.y+_.height);return this.x=lt,this.width=Math.max(ft-lt,0),this.y=mt,this.height=Math.max(pt-mt,0),this}ceil(_=1,lt=.001){const ft=Math.ceil((this.x+this.width-lt)*_)/_,mt=Math.ceil((this.y+this.height-lt)*_)/_;return this.x=Math.floor((this.x+lt)*_)/_,this.y=Math.floor((this.y+lt)*_)/_,this.width=ft-this.x,this.height=mt-this.y,this}enlarge(_){const lt=Math.min(this.x,_.x),ft=Math.max(this.x+this.width,_.x+_.width),mt=Math.min(this.y,_.y),pt=Math.max(this.y+this.height,_.y+_.height);return this.x=lt,this.width=ft-lt,this.y=mt,this.height=pt-mt,this}}Rectangle.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Circle{constructor(_=0,lt=0,ft=0){this.x=_,this.y=lt,this.radius=ft,this.type=SHAPES.CIRC}clone(){return new Circle(this.x,this.y,this.radius)}contains(_,lt){if(this.radius<=0)return!1;const ft=this.radius*this.radius;let mt=this.x-_,pt=this.y-lt;return mt*=mt,pt*=pt,mt+pt<=ft}getBounds(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Circle.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Ellipse{constructor(_=0,lt=0,ft=0,mt=0){this.x=_,this.y=lt,this.width=ft,this.height=mt,this.type=SHAPES.ELIP}clone(){return new Ellipse(this.x,this.y,this.width,this.height)}contains(_,lt){if(this.width<=0||this.height<=0)return!1;let ft=(_-this.x)/this.width,mt=(lt-this.y)/this.height;return ft*=ft,mt*=mt,ft+mt<=1}getBounds(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)}}Ellipse.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Polygon{constructor(..._){let lt=Array.isArray(_[0])?_[0]:_;if(typeof lt[0]!="number"){const ft=[];for(let mt=0,pt=lt.length;mt<pt;mt++)ft.push(lt[mt].x,lt[mt].y);lt=ft}this.points=lt,this.type=SHAPES.POLY,this.closeStroke=!0}clone(){const _=this.points.slice(),lt=new Polygon(_);return lt.closeStroke=this.closeStroke,lt}contains(_,lt){let ft=!1;const mt=this.points.length/2;for(let pt=0,gt=mt-1;pt<mt;gt=pt++){const bt=this.points[pt*2],wt=this.points[pt*2+1],vt=this.points[gt*2],Ct=this.points[gt*2+1];wt>lt!=Ct>lt&&_<(vt-bt)*((lt-wt)/(Ct-wt))+bt&&(ft=!ft)}return ft}}Polygon.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((it,_)=>`${it}, ${_}`,"")}]`};class RoundedRectangle{constructor(_=0,lt=0,ft=0,mt=0,pt=20){this.x=_,this.y=lt,this.width=ft,this.height=mt,this.radius=pt,this.type=SHAPES.RREC}clone(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)}contains(_,lt){if(this.width<=0||this.height<=0)return!1;if(_>=this.x&&_<=this.x+this.width&&lt>=this.y&&lt<=this.y+this.height){const ft=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(lt>=this.y+ft&&lt<=this.y+this.height-ft||_>=this.x+ft&&_<=this.x+this.width-ft)return!0;let mt=_-(this.x+ft),pt=lt-(this.y+ft);const gt=ft*ft;if(mt*mt+pt*pt<=gt||(mt=_-(this.x+this.width-ft),mt*mt+pt*pt<=gt)||(pt=lt-(this.y+this.height-ft),mt*mt+pt*pt<=gt)||(mt=_-(this.x+ft),mt*mt+pt*pt<=gt))return!0}return!1}}RoundedRectangle.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Matrix{constructor(_=1,lt=0,ft=0,mt=1,pt=0,gt=0){this.array=null,this.a=_,this.b=lt,this.c=ft,this.d=mt,this.tx=pt,this.ty=gt}fromArray(_){this.a=_[0],this.b=_[1],this.c=_[3],this.d=_[4],this.tx=_[2],this.ty=_[5]}set(_,lt,ft,mt,pt,gt){return this.a=_,this.b=lt,this.c=ft,this.d=mt,this.tx=pt,this.ty=gt,this}toArray(_,lt){this.array||(this.array=new Float32Array(9));const ft=lt||this.array;return _?(ft[0]=this.a,ft[1]=this.b,ft[2]=0,ft[3]=this.c,ft[4]=this.d,ft[5]=0,ft[6]=this.tx,ft[7]=this.ty,ft[8]=1):(ft[0]=this.a,ft[1]=this.c,ft[2]=this.tx,ft[3]=this.b,ft[4]=this.d,ft[5]=this.ty,ft[6]=0,ft[7]=0,ft[8]=1),ft}apply(_,lt){lt=lt||new Point;const ft=_.x,mt=_.y;return lt.x=this.a*ft+this.c*mt+this.tx,lt.y=this.b*ft+this.d*mt+this.ty,lt}applyInverse(_,lt){lt=lt||new Point;const ft=1/(this.a*this.d+this.c*-this.b),mt=_.x,pt=_.y;return lt.x=this.d*ft*mt+-this.c*ft*pt+(this.ty*this.c-this.tx*this.d)*ft,lt.y=this.a*ft*pt+-this.b*ft*mt+(-this.ty*this.a+this.tx*this.b)*ft,lt}translate(_,lt){return this.tx+=_,this.ty+=lt,this}scale(_,lt){return this.a*=_,this.d*=lt,this.c*=_,this.b*=lt,this.tx*=_,this.ty*=lt,this}rotate(_){const lt=Math.cos(_),ft=Math.sin(_),mt=this.a,pt=this.c,gt=this.tx;return this.a=mt*lt-this.b*ft,this.b=mt*ft+this.b*lt,this.c=pt*lt-this.d*ft,this.d=pt*ft+this.d*lt,this.tx=gt*lt-this.ty*ft,this.ty=gt*ft+this.ty*lt,this}append(_){const lt=this.a,ft=this.b,mt=this.c,pt=this.d;return this.a=_.a*lt+_.b*mt,this.b=_.a*ft+_.b*pt,this.c=_.c*lt+_.d*mt,this.d=_.c*ft+_.d*pt,this.tx=_.tx*lt+_.ty*mt+this.tx,this.ty=_.tx*ft+_.ty*pt+this.ty,this}setTransform(_,lt,ft,mt,pt,gt,bt,wt,vt){return this.a=Math.cos(bt+vt)*pt,this.b=Math.sin(bt+vt)*pt,this.c=-Math.sin(bt-wt)*gt,this.d=Math.cos(bt-wt)*gt,this.tx=_-(ft*this.a+mt*this.c),this.ty=lt-(ft*this.b+mt*this.d),this}prepend(_){const lt=this.tx;if(_.a!==1||_.b!==0||_.c!==0||_.d!==1){const ft=this.a,mt=this.c;this.a=ft*_.a+this.b*_.c,this.b=ft*_.b+this.b*_.d,this.c=mt*_.a+this.d*_.c,this.d=mt*_.b+this.d*_.d}return this.tx=lt*_.a+this.ty*_.c+_.tx,this.ty=lt*_.b+this.ty*_.d+_.ty,this}decompose(_){const lt=this.a,ft=this.b,mt=this.c,pt=this.d,gt=_.pivot,bt=-Math.atan2(-mt,pt),wt=Math.atan2(ft,lt),vt=Math.abs(bt+wt);return vt<1e-5||Math.abs(PI_2-vt)<1e-5?(_.rotation=wt,_.skew.x=_.skew.y=0):(_.rotation=0,_.skew.x=bt,_.skew.y=wt),_.scale.x=Math.sqrt(lt*lt+ft*ft),_.scale.y=Math.sqrt(mt*mt+pt*pt),_.position.x=this.tx+(gt.x*lt+gt.y*mt),_.position.y=this.ty+(gt.x*ft+gt.y*pt),_}invert(){const _=this.a,lt=this.b,ft=this.c,mt=this.d,pt=this.tx,gt=_*mt-lt*ft;return this.a=mt/gt,this.b=-lt/gt,this.c=-ft/gt,this.d=_/gt,this.tx=(ft*this.ty-mt*pt)/gt,this.ty=-(_*this.ty-lt*pt)/gt,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const _=new Matrix;return _.a=this.a,_.b=this.b,_.c=this.c,_.d=this.d,_.tx=this.tx,_.ty=this.ty,_}copyTo(_){return _.a=this.a,_.b=this.b,_.c=this.c,_.d=this.d,_.tx=this.tx,_.ty=this.ty,_}copyFrom(_){return this.a=_.a,this.b=_.b,this.c=_.c,this.d=_.d,this.tx=_.tx,this.ty=_.ty,this}static get IDENTITY(){return new Matrix}static get TEMP_MATRIX(){return new Matrix}}Matrix.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(let it=0;it<16;it++){const _=[];rotationCayley.push(_);for(let lt=0;lt<16;lt++){const ft=signum(ux[it]*ux[lt]+vx[it]*uy[lt]),mt=signum(uy[it]*ux[lt]+vy[it]*uy[lt]),pt=signum(ux[it]*vx[lt]+vx[it]*vy[lt]),gt=signum(uy[it]*vx[lt]+vy[it]*vy[lt]);for(let bt=0;bt<16;bt++)if(ux[bt]===ft&&uy[bt]===mt&&vx[bt]===pt&&vy[bt]===gt){_.push(bt);break}}}for(let it=0;it<16;it++){const _=new Matrix;_.set(ux[it],uy[it],vx[it],vy[it],0,0),rotationMatrices.push(_)}}init();const groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:it=>ux[it],uY:it=>uy[it],vX:it=>vx[it],vY:it=>vy[it],inv:it=>it&8?it&15:-it&7,add:(it,_)=>rotationCayley[it][_],sub:(it,_)=>rotationCayley[it][groupD8.inv(_)],rotate180:it=>it^4,isVertical:it=>(it&3)===2,byDirection:(it,_)=>Math.abs(it)*2<=Math.abs(_)?_>=0?groupD8.S:groupD8.N:Math.abs(_)*2<=Math.abs(it)?it>0?groupD8.E:groupD8.W:_>0?it>0?groupD8.SE:groupD8.SW:it>0?groupD8.NE:groupD8.NW,matrixAppendRotationInv:(it,_,lt=0,ft=0)=>{const mt=rotationMatrices[groupD8.inv(_)];mt.tx=lt,mt.ty=ft,it.append(mt)}};class ObservablePoint{constructor(_,lt,ft=0,mt=0){this._x=ft,this._y=mt,this.cb=_,this.scope=lt}clone(_=this.cb,lt=this.scope){return new ObservablePoint(_,lt,this._x,this._y)}set(_=0,lt=_){return(this._x!==_||this._y!==lt)&&(this._x=_,this._y=lt,this.cb.call(this.scope)),this}copyFrom(_){return(this._x!==_.x||this._y!==_.y)&&(this._x=_.x,this._y=_.y,this.cb.call(this.scope)),this}copyTo(_){return _.set(this._x,this._y),_}equals(_){return _.x===this._x&&_.y===this._y}get x(){return this._x}set x(_){this._x!==_&&(this._x=_,this.cb.call(this.scope))}get y(){return this._y}set y(_){this._y!==_&&(this._y=_,this.cb.call(this.scope))}}ObservablePoint.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const _Transform=class{constructor(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const it=this.localTransform;this._localID!==this._currentLocalID&&(it.a=this._cx*this.scale.x,it.b=this._sx*this.scale.x,it.c=this._cy*this.scale.y,it.d=this._sy*this.scale.y,it.tx=this.position.x-(this.pivot.x*it.a+this.pivot.y*it.c),it.ty=this.position.y-(this.pivot.x*it.b+this.pivot.y*it.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(it){const _=this.localTransform;if(this._localID!==this._currentLocalID&&(_.a=this._cx*this.scale.x,_.b=this._sx*this.scale.x,_.c=this._cy*this.scale.y,_.d=this._sy*this.scale.y,_.tx=this.position.x-(this.pivot.x*_.a+this.pivot.y*_.c),_.ty=this.position.y-(this.pivot.x*_.b+this.pivot.y*_.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==it._worldID){const lt=it.worldTransform,ft=this.worldTransform;ft.a=_.a*lt.a+_.b*lt.c,ft.b=_.a*lt.b+_.b*lt.d,ft.c=_.c*lt.a+_.d*lt.c,ft.d=_.c*lt.b+_.d*lt.d,ft.tx=_.tx*lt.a+_.ty*lt.c+lt.tx,ft.ty=_.tx*lt.b+_.ty*lt.d+lt.ty,this._parentID=it._worldID,this._worldID++}}setFromMatrix(it){it.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(it){this._rotation!==it&&(this._rotation=it,this.updateSkew())}};_Transform.IDENTITY=new _Transform;let Transform=_Transform;Transform.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var defaultFragment$2=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex$3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function compileShader(it,_,lt){const ft=it.createShader(_);return it.shaderSource(ft,lt),it.compileShader(ft),ft}function booleanArray(it){const _=new Array(it);for(let lt=0;lt<_.length;lt++)_[lt]=!1;return _}function defaultValue(it,_){switch(it){case"float":return 0;case"vec2":return new Float32Array(2*_);case"vec3":return new Float32Array(3*_);case"vec4":return new Float32Array(4*_);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*_);case"ivec3":return new Int32Array(3*_);case"ivec4":return new Int32Array(4*_);case"uvec2":return new Uint32Array(2*_);case"uvec3":return new Uint32Array(3*_);case"uvec4":return new Uint32Array(4*_);case"bool":return!1;case"bvec2":return booleanArray(2*_);case"bvec3":return booleanArray(3*_);case"bvec4":return booleanArray(4*_);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const uniformParsers=[{test:it=>it.type==="float"&&it.size===1&&!it.isArray,code:it=>`
            if(uv["${it}"] !== ud["${it}"].value)
            {
                ud["${it}"].value = uv["${it}"]
                gl.uniform1f(ud["${it}"].location, uv["${it}"])
            }
            `},{test:(it,_)=>(it.type==="sampler2D"||it.type==="samplerCube"||it.type==="sampler2DArray")&&it.size===1&&!it.isArray&&(_==null||_.castToBaseTexture!==void 0),code:it=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${it}"], t);

            if(ud["${it}"].value !== t)
            {
                ud["${it}"].value = t;
                gl.uniform1i(ud["${it}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(it,_)=>it.type==="mat3"&&it.size===1&&!it.isArray&&_.a!==void 0,code:it=>`
            gl.uniformMatrix3fv(ud["${it}"].location, false, uv["${it}"].toArray(true));
            `,codeUbo:it=>`
                var ${it}_matrix = uv.${it}.toArray(true);

                data[offset] = ${it}_matrix[0];
                data[offset+1] = ${it}_matrix[1];
                data[offset+2] = ${it}_matrix[2];
        
                data[offset + 4] = ${it}_matrix[3];
                data[offset + 5] = ${it}_matrix[4];
                data[offset + 6] = ${it}_matrix[5];
        
                data[offset + 8] = ${it}_matrix[6];
                data[offset + 9] = ${it}_matrix[7];
                data[offset + 10] = ${it}_matrix[8];
            `},{test:(it,_)=>it.type==="vec2"&&it.size===1&&!it.isArray&&_.x!==void 0,code:it=>`
                cv = ud["${it}"].value;
                v = uv["${it}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${it}"].location, v.x, v.y);
                }`,codeUbo:it=>`
                v = uv.${it};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:it=>it.type==="vec2"&&it.size===1&&!it.isArray,code:it=>`
                cv = ud["${it}"].value;
                v = uv["${it}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${it}"].location, v[0], v[1]);
                }
            `},{test:(it,_)=>it.type==="vec4"&&it.size===1&&!it.isArray&&_.width!==void 0,code:it=>`
                cv = ud["${it}"].value;
                v = uv["${it}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${it}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:it=>`
                    v = uv.${it};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(it,_)=>it.type==="vec4"&&it.size===1&&!it.isArray&&_.red!==void 0,code:it=>`
                cv = ud["${it}"].value;
                v = uv["${it}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${it}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:it=>`
                    v = uv.${it};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(it,_)=>it.type==="vec3"&&it.size===1&&!it.isArray&&_.red!==void 0,code:it=>`
                cv = ud["${it}"].value;
                v = uv["${it}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${it}"].location, v.red, v.green, v.blue)
                }`,codeUbo:it=>`
                    v = uv.${it};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:it=>it.type==="vec4"&&it.size===1&&!it.isArray,code:it=>`
                cv = ud["${it}"].value;
                v = uv["${it}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${it}"].location, v[0], v[1], v[2], v[3])
                }`}],GLSL_TO_SINGLE_SETTERS_CACHED={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(it,_){var ft;const lt=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const mt in it.uniforms){const pt=_[mt];if(!pt){((ft=it.uniforms[mt])==null?void 0:ft.group)===!0&&(it.uniforms[mt].ubo?lt.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${mt}, '${mt}');
                    `):lt.push(`
                        renderer.shader.syncUniformGroup(uv.${mt}, syncData);
                    `));continue}const gt=it.uniforms[mt];let bt=!1;for(let wt=0;wt<uniformParsers.length;wt++)if(uniformParsers[wt].test(pt,gt)){lt.push(uniformParsers[wt].code(mt,gt)),bt=!0;break}if(!bt){const wt=(pt.size===1&&!pt.isArray?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[pt.type].replace("location",`ud["${mt}"].location`);lt.push(`
            cu = ud["${mt}"];
            cv = cu.value;
            v = uv["${mt}"];
            ${wt};`)}}return new Function("ud","uv","renderer","syncData",lt.join(`
`))}const unknownContext={};let context=unknownContext;function getTestContext(){if(context===unknownContext||context!=null&&context.isContextLost()){const it=settings.ADAPTER.createCanvas();let _;settings.PREFER_ENV>=ENV.WEBGL2&&(_=it.getContext("webgl2",{})),_||(_=it.getContext("webgl",{})||it.getContext("experimental-webgl",{}),_?_.getExtension("WEBGL_draw_buffers"):_=null),context=_}return context}let maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;const it=getTestContext();if(it&&it.getShaderPrecisionFormat){const _=it.getShaderPrecisionFormat(it.FRAGMENT_SHADER,it.HIGH_FLOAT);_&&(maxFragmentPrecision=_.precision?PRECISION.HIGH:PRECISION.MEDIUM)}}return maxFragmentPrecision}function logPrettyShaderError(it,_){const lt=it.getShaderSource(_).split(`
`).map((vt,Ct)=>`${Ct}: ${vt}`),ft=it.getShaderInfoLog(_),mt=ft.split(`
`),pt={},gt=mt.map(vt=>parseFloat(vt.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(vt=>vt&&!pt[vt]?(pt[vt]=!0,!0):!1),bt=[""];gt.forEach(vt=>{lt[vt-1]=`%c${lt[vt-1]}%c`,bt.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const wt=lt.join(`
`);bt[0]=wt,console.error(ft),console.groupCollapsed("click to view full shader code"),console.warn(...bt),console.groupEnd()}function logProgramError(it,_,lt,ft){it.getProgramParameter(_,it.LINK_STATUS)||(it.getShaderParameter(lt,it.COMPILE_STATUS)||logPrettyShaderError(it,lt),it.getShaderParameter(ft,it.COMPILE_STATUS)||logPrettyShaderError(it,ft),console.error("PixiJS Error: Could not initialize shader."),it.getProgramInfoLog(_)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",it.getProgramInfoLog(_)))}const GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(it){return GLSL_TO_SIZE[it]}let GL_TABLE=null;const GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(it,_){if(!GL_TABLE){const lt=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(let ft=0;ft<lt.length;++ft){const mt=lt[ft];GL_TABLE[it[mt]]=GL_TO_GLSL_TYPES[mt]}}return GL_TABLE[_]}function setPrecision(it,_,lt){if(it.substring(0,9)!=="precision"){let ft=_;return _===PRECISION.HIGH&&lt!==PRECISION.HIGH&&(ft=PRECISION.MEDIUM),`precision ${ft} float;
${it}`}else if(lt!==PRECISION.HIGH&&it.substring(0,15)==="precision highp")return it.replace("precision highp","precision mediump");return it}let unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval=="boolean")return unsafeEval;try{unsafeEval=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{unsafeEval=!1}return unsafeEval}let UID$2=0;const nameCache={},_Program=class dy{constructor(_,lt,ft="pixi-shader",mt={}){this.extra={},this.id=UID$2++,this.vertexSrc=_||dy.defaultVertexSrc,this.fragmentSrc=lt||dy.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=mt,this.vertexSrc.substring(0,8)!=="#version"&&(ft=ft.replace(/\s+/g,"-"),nameCache[ft]?(nameCache[ft]++,ft+=`-${nameCache[ft]}`):nameCache[ft]=1,this.vertexSrc=`#define SHADER_NAME ${ft}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${ft}
${this.fragmentSrc}`,this.vertexSrc=setPrecision(this.vertexSrc,dy.defaultVertexPrecision,PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,dy.defaultFragmentPrecision,getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return defaultVertex$3}static get defaultFragmentSrc(){return defaultFragment$2}static from(_,lt,ft){const mt=_+lt;let pt=ProgramCache[mt];return pt||(ProgramCache[mt]=pt=new dy(_,lt,ft)),pt}};_Program.defaultVertexPrecision=PRECISION.HIGH,_Program.defaultFragmentPrecision=isMobile$1.apple.device?PRECISION.HIGH:PRECISION.MEDIUM;let Program=_Program,UID$1=0;class UniformGroup{constructor(_,lt,ft){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$1++,this.static=!!lt,this.ubo=!!ft,_ instanceof Buffer$1?(this.buffer=_,this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=_,this.ubo&&(this.buffer=new Buffer$1(new Float32Array(1)),this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(_,lt,ft){if(!this.ubo)this.uniforms[_]=new UniformGroup(lt,ft);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(_,lt,ft){return new UniformGroup(_,lt,ft)}static uboFrom(_,lt){return new UniformGroup(_,lt??!0,!0)}}class Shader{constructor(_,lt){this.uniformBindCount=0,this.program=_,lt?lt instanceof UniformGroup?this.uniformGroup=lt:this.uniformGroup=new UniformGroup(lt):this.uniformGroup=new UniformGroup({}),this.disposeRunner=new Runner("disposeShader")}checkUniformExists(_,lt){if(lt.uniforms[_])return!0;for(const ft in lt.uniforms){const mt=lt.uniforms[ft];if(mt.group===!0&&this.checkUniformExists(_,mt))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(_,lt,ft){const mt=Program.from(_,lt);return new Shader(mt,ft)}}class BatchShaderGenerator{constructor(_,lt){if(this.vertexSrc=_,this.fragTemplate=lt,this.programCache={},this.defaultGroupCache={},!lt.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!lt.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(_){if(!this.programCache[_]){const ft=new Int32Array(_);for(let pt=0;pt<_;pt++)ft[pt]=pt;this.defaultGroupCache[_]=UniformGroup.from({uSamplers:ft},!0);let mt=this.fragTemplate;mt=mt.replace(/%count%/gi,`${_}`),mt=mt.replace(/%forloop%/gi,this.generateSampleSrc(_)),this.programCache[_]=new Program(this.vertexSrc,mt)}const lt={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[_]};return new Shader(this.programCache[_],lt)}generateSampleSrc(_){let lt="";lt+=`
`,lt+=`
`;for(let ft=0;ft<_;ft++)ft>0&&(lt+=`
else `),ft<_-1&&(lt+=`if(vTextureId < ${ft}.5)`),lt+=`
{`,lt+=`
	color = texture2D(uSamplers[${ft}], vTextureCoord);`,lt+=`
}`;return lt+=`
`,lt+=`
`,lt}}class BatchTextureArray{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let _=0;_<this.count;_++)this.elements[_]=null;this.count=0}}function canUploadSameBuffer(){return!isMobile$1.apple.device}function maxRecommendedTextures(it){let _=!0;const lt=settings.ADAPTER.getNavigator();if(isMobile$1.tablet||isMobile$1.phone){if(isMobile$1.apple.device){const ft=lt.userAgent.match(/OS (\d+)_(\d+)?/);ft&&parseInt(ft[1],10)<11&&(_=!1)}if(isMobile$1.android.device){const ft=lt.userAgent.match(/Android\s([0-9.]*)/);ft&&parseInt(ft[1],10)<7&&(_=!1)}}return _?it:4}class ObjectRenderer{constructor(_){this.renderer=_}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(_){}}var defaultFragment$1=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,defaultVertex$2=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const _BatchRenderer=class Km extends ObjectRenderer{constructor(_){super(_),this.setShaderGenerator(),this.geometryClass=BatchGeometry,this.vertexSize=6,this.state=State.for2d(),this.size=Km.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),_.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??maxRecommendedTextures(32),this._defaultMaxTextures}static set defaultMaxTextures(_){this._defaultMaxTextures=_}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??canUploadSameBuffer(),this._canUploadSameBuffer}static set canUploadSameBuffer(_){this._canUploadSameBuffer=_}get MAX_TEXTURES(){return deprecation("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return defaultVertex$2}static get defaultFragmentTemplate(){return defaultFragment$1}setShaderGenerator({vertex:_=Km.defaultVertexSrc,fragment:lt=Km.defaultFragmentTemplate}={}){this.shaderGenerator=new BatchShaderGenerator(_,lt)}contextChange(){const _=this.renderer.gl;settings.PREFER_ENV===ENV.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS),Km.defaultMaxTextures),this.maxTextures=checkMaxIfStatementsInShader(this.maxTextures,_)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let lt=0;lt<this._packedGeometryPoolSize;lt++)this._packedGeometries[lt]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:_,_textureArrayPool:lt}=Km,ft=this.size/4,mt=Math.floor(ft/this.maxTextures)+1;for(;_.length<ft;)_.push(new BatchDrawCall);for(;lt.length<mt;)lt.push(new BatchTextureArray);for(let pt=0;pt<this.maxTextures;pt++)this._tempBoundTextures[pt]=null}onPrerender(){this._flushId=0}render(_){_._texture.valid&&(this._vertexCount+_.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=_.vertexData.length/2,this._indexCount+=_.indices.length,this._bufferedTextures[this._bufferSize]=_._texture.baseTexture,this._bufferedElements[this._bufferSize++]=_)}buildTexturesAndDrawCalls(){const{_bufferedTextures:_,maxTextures:lt}=this,ft=Km._textureArrayPool,mt=this.renderer.batch,pt=this._tempBoundTextures,gt=this.renderer.textureGC.count;let bt=++BaseTexture._globalBatch,wt=0,vt=ft[0],Ct=0;mt.copyBoundTextures(pt,lt);for(let Rt=0;Rt<this._bufferSize;++Rt){const Mt=_[Rt];_[Rt]=null,Mt._batchEnabled!==bt&&(vt.count>=lt&&(mt.boundArray(vt,pt,bt,lt),this.buildDrawCalls(vt,Ct,Rt),Ct=Rt,vt=ft[++wt],++bt),Mt._batchEnabled=bt,Mt.touched=gt,vt.elements[vt.count++]=Mt)}vt.count>0&&(mt.boundArray(vt,pt,bt,lt),this.buildDrawCalls(vt,Ct,this._bufferSize),++wt,++bt);for(let Rt=0;Rt<pt.length;Rt++)pt[Rt]=null;BaseTexture._globalBatch=bt}buildDrawCalls(_,lt,ft){const{_bufferedElements:mt,_attributeBuffer:pt,_indexBuffer:gt,vertexSize:bt}=this,wt=Km._drawCallPool;let vt=this._dcIndex,Ct=this._aIndex,Rt=this._iIndex,Mt=wt[vt];Mt.start=this._iIndex,Mt.texArray=_;for(let Ot=lt;Ot<ft;++Ot){const Nt=mt[Ot],Ht=Nt._texture.baseTexture,Kt=premultiplyBlendMode[Ht.alphaMode?1:0][Nt.blendMode];mt[Ot]=null,lt<Ot&&Mt.blend!==Kt&&(Mt.size=Rt-Mt.start,lt=Ot,Mt=wt[++vt],Mt.texArray=_,Mt.start=Rt),this.packInterleavedGeometry(Nt,pt,gt,Ct,Rt),Ct+=Nt.vertexData.length/2*bt,Rt+=Nt.indices.length,Mt.blend=Kt}lt<ft&&(Mt.size=Rt-Mt.start,++vt),this._dcIndex=vt,this._aIndex=Ct,this._iIndex=Rt}bindAndClearTexArray(_){const lt=this.renderer.texture;for(let ft=0;ft<_.count;ft++)lt.bind(_.elements[ft],_.ids[ft]),_.elements[ft]=null;_.count=0}updateGeometry(){const{_packedGeometries:_,_attributeBuffer:lt,_indexBuffer:ft}=this;Km.canUploadSameBuffer?(_[this._flushId]._buffer.update(lt.rawBinaryData),_[this._flushId]._indexBuffer.update(ft),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,_[this._flushId]=new this.geometryClass),_[this._flushId]._buffer.update(lt.rawBinaryData),_[this._flushId]._indexBuffer.update(ft),this.renderer.geometry.bind(_[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const _=this._dcIndex,{gl:lt,state:ft}=this.renderer,mt=Km._drawCallPool;let pt=null;for(let gt=0;gt<_;gt++){const{texArray:bt,type:wt,size:vt,start:Ct,blend:Rt}=mt[gt];pt!==bt&&(pt=bt,this.bindAndClearTexArray(bt)),this.state.blendMode=Rt,ft.set(this.state),lt.drawElements(wt,vt,lt.UNSIGNED_SHORT,Ct*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Km.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let _=0;_<this._packedGeometryPoolSize;_++)this._packedGeometries[_]&&this._packedGeometries[_].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(_){const lt=nextPow2(Math.ceil(_/8)),ft=log2(lt),mt=lt*8;this._aBuffers.length<=ft&&(this._iBuffers.length=ft+1);let pt=this._aBuffers[mt];return pt||(this._aBuffers[mt]=pt=new ViewableBuffer(mt*this.vertexSize*4)),pt}getIndexBuffer(_){const lt=nextPow2(Math.ceil(_/12)),ft=log2(lt),mt=lt*12;this._iBuffers.length<=ft&&(this._iBuffers.length=ft+1);let pt=this._iBuffers[ft];return pt||(this._iBuffers[ft]=pt=new Uint16Array(mt)),pt}packInterleavedGeometry(_,lt,ft,mt,pt){const{uint32View:gt,float32View:bt}=lt,wt=mt/this.vertexSize,vt=_.uvs,Ct=_.indices,Rt=_.vertexData,Mt=_._texture.baseTexture._batchLocation,Ot=Math.min(_.worldAlpha,1),Nt=Color.shared.setValue(_._tintRGB).toPremultiplied(Ot,_._texture.baseTexture.alphaMode>0);for(let Ht=0;Ht<Rt.length;Ht+=2)bt[mt++]=Rt[Ht],bt[mt++]=Rt[Ht+1],bt[mt++]=vt[Ht],bt[mt++]=vt[Ht+1],gt[mt++]=Nt,bt[mt++]=Mt;for(let Ht=0;Ht<Ct.length;Ht++)ft[pt++]=wt+Ct[Ht]}};_BatchRenderer.defaultBatchSize=4096,_BatchRenderer.extension={name:"batch",type:ExtensionType.RendererPlugin},_BatchRenderer._drawCallPool=[],_BatchRenderer._textureArrayPool=[];let BatchRenderer=_BatchRenderer;extensions$1.add(BatchRenderer);var defaultFragment=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,defaultVertex$1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const _Filter=class by extends Shader{constructor(_,lt,ft){const mt=Program.from(_||by.defaultVertexSrc,lt||by.defaultFragmentSrc);super(mt,ft),this.padding=0,this.resolution=by.defaultResolution,this.multisample=by.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new State}apply(_,lt,ft,mt,pt){_.applyFilter(this,lt,ft,mt)}get blendMode(){return this.state.blendMode}set blendMode(_){this.state.blendMode=_}get resolution(){return this._resolution}set resolution(_){this._resolution=_}static get defaultVertexSrc(){return defaultVertex$1}static get defaultFragmentSrc(){return defaultFragment}};_Filter.defaultResolution=1,_Filter.defaultMultisample=MSAA_QUALITY.NONE;let Filter=_Filter;class BackgroundSystem{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Color(0),this.alpha=1}init(_){this.clearBeforeRender=_.clearBeforeRender;const{backgroundColor:lt,background:ft,backgroundAlpha:mt}=_,pt=ft??lt;pt!==void 0&&(this.color=pt),this.alpha=mt}get color(){return this._backgroundColor.value}set color(_){this._backgroundColor.setValue(_)}get alpha(){return this._backgroundColor.alpha}set alpha(_){this._backgroundColor.setAlpha(_)}get backgroundColor(){return this._backgroundColor}destroy(){}}BackgroundSystem.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},BackgroundSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"background"};extensions$1.add(BackgroundSystem);class BatchSystem{constructor(_){this.renderer=_,this.emptyRenderer=new ObjectRenderer(_),this.currentRenderer=this.emptyRenderer}setObjectRenderer(_){this.currentRenderer!==_&&(this.currentRenderer.stop(),this.currentRenderer=_,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(_,lt){const{boundTextures:ft}=this.renderer.texture;for(let mt=lt-1;mt>=0;--mt)_[mt]=ft[mt]||null,_[mt]&&(_[mt]._batchLocation=mt)}boundArray(_,lt,ft,mt){const{elements:pt,ids:gt,count:bt}=_;let wt=0;for(let vt=0;vt<bt;vt++){const Ct=pt[vt],Rt=Ct._batchLocation;if(Rt>=0&&Rt<mt&&lt[Rt]===Ct){gt[vt]=Rt;continue}for(;wt<mt;){const Mt=lt[wt];if(Mt&&Mt._batchEnabled===ft&&Mt._batchLocation===wt){wt++;continue}gt[vt]=wt,Ct._batchLocation=wt,lt[wt]=Ct;break}}}destroy(){this.renderer=null}}BatchSystem.extension={type:ExtensionType.RendererSystem,name:"batch"};extensions$1.add(BatchSystem);let CONTEXT_UID_COUNTER=0;class ContextSystem{constructor(_){this.renderer=_,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(_){this.gl=_,this.renderer.gl=_,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++}init(_){if(_.context)this.initFromContext(_.context);else{const lt=this.renderer.background.alpha<1,ft=_.premultipliedAlpha;this.preserveDrawingBuffer=_.preserveDrawingBuffer,this.useContextAlpha=_.useContextAlpha,this.powerPreference=_.powerPreference,this.initFromOptions({alpha:lt,premultipliedAlpha:ft,antialias:_.antialias,stencil:!0,preserveDrawingBuffer:_.preserveDrawingBuffer,powerPreference:_.powerPreference})}}initFromContext(_){this.gl=_,this.validateContext(_),this.renderer.gl=_,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(_);const lt=this.renderer.view;lt.addEventListener!==void 0&&(lt.addEventListener("webglcontextlost",this.handleContextLost,!1),lt.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(_){const lt=this.createContext(this.renderer.view,_);this.initFromContext(lt)}createContext(_,lt){let ft;if(settings.PREFER_ENV>=ENV.WEBGL2&&(ft=_.getContext("webgl2",lt)),ft)this.webGLVersion=2;else if(this.webGLVersion=1,ft=_.getContext("webgl",lt)||_.getContext("experimental-webgl",lt),!ft)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=ft,this.getExtensions(),this.gl}getExtensions(){const{gl:_}=this,lt={loseContext:_.getExtension("WEBGL_lose_context"),anisotropicFiltering:_.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:_.getExtension("OES_texture_float_linear"),s3tc:_.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:_.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:_.getExtension("WEBGL_compressed_texture_etc"),etc1:_.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:_.getExtension("WEBGL_compressed_texture_pvrtc")||_.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:_.getExtension("WEBGL_compressed_texture_atc"),astc:_.getExtension("WEBGL_compressed_texture_astc"),bptc:_.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,lt,{drawBuffers:_.getExtension("WEBGL_draw_buffers"),depthTexture:_.getExtension("WEBGL_depth_texture"),vertexArrayObject:_.getExtension("OES_vertex_array_object")||_.getExtension("MOZ_OES_vertex_array_object")||_.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:_.getExtension("OES_element_index_uint"),floatTexture:_.getExtension("OES_texture_float"),floatTextureLinear:_.getExtension("OES_texture_float_linear"),textureHalfFloat:_.getExtension("OES_texture_half_float"),textureHalfFloatLinear:_.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,lt,{colorBufferFloat:_.getExtension("EXT_color_buffer_float")})}handleContextLost(_){_.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const _=this.renderer.view;this.renderer=null,_.removeEventListener!==void 0&&(_.removeEventListener("webglcontextlost",this.handleContextLost),_.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(_){const lt=_.getContextAttributes(),ft="WebGL2RenderingContext"in globalThis&&_ instanceof globalThis.WebGL2RenderingContext;ft&&(this.webGLVersion=2),lt&&!lt.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const mt=ft||!!_.getExtension("OES_element_index_uint");this.supports.uint32Indices=mt,mt||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}ContextSystem.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},ContextSystem.extension={type:ExtensionType.RendererSystem,name:"context"};extensions$1.add(ContextSystem);class Framebuffer{constructor(_,lt){if(this.width=Math.round(_),this.height=Math.round(lt),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(_=0,lt){return this.colorTextures[_]=lt||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(_){return this.depthTexture=_||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(_,lt){if(_=Math.round(_),lt=Math.round(lt),!_||!lt)throw new Error("Framebuffer width and height must not be zero");if(!(_===this.width&&lt===this.height)){this.width=_,this.height=lt,this.dirtyId++,this.dirtySize++;for(let ft=0;ft<this.colorTextures.length;ft++){const mt=this.colorTextures[ft],pt=mt.resolution;mt.setSize(_/pt,lt/pt)}if(this.depthTexture){const ft=this.depthTexture.resolution;this.depthTexture.setSize(_/ft,lt/ft)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class BaseRenderTexture extends BaseTexture{constructor(_={}){if(typeof _=="number"){const lt=arguments[0],ft=arguments[1],mt=arguments[2],pt=arguments[3];_={width:lt,height:ft,scaleMode:mt,resolution:pt}}_.width=_.width??100,_.height=_.height??100,_.multisample??(_.multisample=MSAA_QUALITY.NONE),super(null,_),this.mipmap=MIPMAP_MODES.OFF,this.valid=!0,this._clear=new Color([0,0,0,0]),this.framebuffer=new Framebuffer(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=_.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(_){this._clear.setValue(_)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(_){this.framebuffer.multisample=_}resize(_,lt){this.framebuffer.resize(_*this.resolution,lt*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class BaseImageResource extends Resource{constructor(_){const lt=_,ft=lt.naturalWidth||lt.videoWidth||lt.displayWidth||lt.width,mt=lt.naturalHeight||lt.videoHeight||lt.displayHeight||lt.height;super(ft,mt),this.source=_,this.noSubImage=!1}static crossOrigin(_,lt,ft){ft===void 0&&!lt.startsWith("data:")?_.crossOrigin=determineCrossOrigin(lt):ft!==!1&&(_.crossOrigin=typeof ft=="string"?ft:"anonymous")}upload(_,lt,ft,mt){const pt=_.gl,gt=lt.realWidth,bt=lt.realHeight;if(mt=mt||this.source,typeof HTMLImageElement<"u"&&mt instanceof HTMLImageElement){if(!mt.complete||mt.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&mt instanceof HTMLVideoElement&&mt.readyState<=1)return!1;return pt.pixelStorei(pt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,lt.alphaMode===ALPHA_MODES.UNPACK),!this.noSubImage&&lt.target===pt.TEXTURE_2D&&ft.width===gt&&ft.height===bt?pt.texSubImage2D(pt.TEXTURE_2D,0,0,0,lt.format,ft.type,mt):(ft.width=gt,ft.height=bt,pt.texImage2D(lt.target,0,ft.internalFormat,lt.format,ft.type,mt)),!0}update(){if(this.destroyed)return;const _=this.source,lt=_.naturalWidth||_.videoWidth||_.width,ft=_.naturalHeight||_.videoHeight||_.height;this.resize(lt,ft),super.update()}dispose(){this.source=null}}class ImageResource extends BaseImageResource{constructor(_,lt){if(lt=lt||{},typeof _=="string"){const ft=new Image;BaseImageResource.crossOrigin(ft,_,lt.crossorigin),ft.src=_,_=ft}super(_),!_.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=_.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(lt.createBitmap??settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof lt.alphaMode=="number"?lt.alphaMode:null,this.bitmap=null,this._load=null,lt.autoLoad!==!1&&this.load()}load(_){return this._load?this._load:(_!==void 0&&(this.createBitmap=_),this._load=new Promise((lt,ft)=>{const mt=this.source;this.url=mt.src;const pt=()=>{this.destroyed||(mt.onload=null,mt.onerror=null,this.update(),this._load=null,this.createBitmap?lt(this.process()):lt(this))};mt.complete&&mt.src?pt():(mt.onload=pt,mt.onerror=gt=>{ft(gt),this.onError.emit(gt)})}),this._load)}process(){const _=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const lt=globalThis.createImageBitmap,ft=!_.crossOrigin||_.crossOrigin==="anonymous";return this._process=fetch(_.src,{mode:ft?"cors":"no-cors"}).then(mt=>mt.blob()).then(mt=>lt(mt,0,0,_.width,_.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"})).then(mt=>this.destroyed?Promise.reject():(this.bitmap=mt,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(_,lt,ft){if(typeof this.alphaMode=="number"&&(lt.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(_,lt,ft);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(_,lt,ft,this.bitmap),!this.preserveBitmap){let mt=!0;const pt=lt._glTextures;for(const gt in pt){const bt=pt[gt];if(bt!==ft&&bt.dirtyId!==lt.dirtyId){mt=!1;break}}mt&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(_){return typeof HTMLImageElement<"u"&&(typeof _=="string"||_ instanceof HTMLImageElement)}}class TextureUvs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(_,lt,ft){const mt=lt.width,pt=lt.height;if(ft){const gt=_.width/2/mt,bt=_.height/2/pt,wt=_.x/mt+gt,vt=_.y/pt+bt;ft=groupD8.add(ft,groupD8.NW),this.x0=wt+gt*groupD8.uX(ft),this.y0=vt+bt*groupD8.uY(ft),ft=groupD8.add(ft,2),this.x1=wt+gt*groupD8.uX(ft),this.y1=vt+bt*groupD8.uY(ft),ft=groupD8.add(ft,2),this.x2=wt+gt*groupD8.uX(ft),this.y2=vt+bt*groupD8.uY(ft),ft=groupD8.add(ft,2),this.x3=wt+gt*groupD8.uX(ft),this.y3=vt+bt*groupD8.uY(ft)}else this.x0=_.x/mt,this.y0=_.y/pt,this.x1=(_.x+_.width)/mt,this.y1=_.y/pt,this.x2=(_.x+_.width)/mt,this.y2=(_.y+_.height)/pt,this.x3=_.x/mt,this.y3=(_.y+_.height)/pt;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}TextureUvs.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const DEFAULT_UVS=new TextureUvs;function removeAllHandlers(it){it.destroy=function(){},it.on=function(){},it.once=function(){},it.emit=function(){}}class Texture extends EventEmitter{constructor(_,lt,ft,mt,pt,gt,bt){if(super(),this.noFrame=!1,lt||(this.noFrame=!0,lt=new Rectangle(0,0,1,1)),_ instanceof Texture&&(_=_.baseTexture),this.baseTexture=_,this._frame=lt,this.trim=mt,this.valid=!1,this.destroyed=!1,this._uvs=DEFAULT_UVS,this.uvMatrix=null,this.orig=ft||lt,this._rotate=Number(pt||0),pt===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=gt?new Point(gt.x,gt.y):new Point(0,0),this.defaultBorders=bt,this._updateID=0,this.textureCacheIds=[],_.valid?this.noFrame?_.valid&&this.onBaseTextureUpdated(_):this.frame=lt:_.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&_.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(_){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=_.width,this._frame.height=_.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(_){if(this.baseTexture){if(_){const{resource:lt}=this.baseTexture;lt!=null&&lt.url&&TextureCache[lt.url]&&Texture.removeFromCache(lt.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var mt;const _=this._frame.clone(),lt=this._frame===this.orig?_:this.orig.clone(),ft=new Texture(this.baseTexture,!this.noFrame&&_,lt,(mt=this.trim)==null?void 0:mt.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(ft._frame=_),ft}updateUvs(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(_,lt={},ft=settings.STRICT_TEXTURE_CACHE){const mt=typeof _=="string";let pt=null;if(mt)pt=_;else if(_ instanceof BaseTexture){if(!_.cacheId){const bt=(lt==null?void 0:lt.pixiIdPrefix)||"pixiid";_.cacheId=`${bt}-${uid()}`,BaseTexture.addToCache(_,_.cacheId)}pt=_.cacheId}else{if(!_._pixiId){const bt=(lt==null?void 0:lt.pixiIdPrefix)||"pixiid";_._pixiId=`${bt}_${uid()}`}pt=_._pixiId}let gt=TextureCache[pt];if(mt&&ft&&!gt)throw new Error(`The cacheId "${pt}" does not exist in TextureCache.`);return!gt&&!(_ instanceof BaseTexture)?(lt.resolution||(lt.resolution=getResolutionOfUrl(_)),gt=new Texture(new BaseTexture(_,lt)),gt.baseTexture.cacheId=pt,BaseTexture.addToCache(gt.baseTexture,pt),Texture.addToCache(gt,pt)):!gt&&_ instanceof BaseTexture&&(gt=new Texture(_),Texture.addToCache(gt,pt)),gt}static fromURL(_,lt){const ft=Object.assign({autoLoad:!1},lt==null?void 0:lt.resourceOptions),mt=Texture.from(_,Object.assign({resourceOptions:ft},lt),!1),pt=mt.baseTexture.resource;return mt.baseTexture.valid?Promise.resolve(mt):pt.load().then(()=>Promise.resolve(mt))}static fromBuffer(_,lt,ft,mt){return new Texture(BaseTexture.fromBuffer(_,lt,ft,mt))}static fromLoader(_,lt,ft,mt){const pt=new BaseTexture(_,Object.assign({scaleMode:BaseTexture.defaultOptions.scaleMode,resolution:getResolutionOfUrl(lt)},mt)),{resource:gt}=pt;gt instanceof ImageResource&&(gt.url=lt);const bt=new Texture(pt);return ft||(ft=lt),BaseTexture.addToCache(bt.baseTexture,ft),Texture.addToCache(bt,ft),ft!==lt&&(BaseTexture.addToCache(bt.baseTexture,lt),Texture.addToCache(bt,lt)),bt.baseTexture.valid?Promise.resolve(bt):new Promise(wt=>{bt.baseTexture.once("loaded",()=>wt(bt))})}static addToCache(_,lt){lt&&(_.textureCacheIds.includes(lt)||_.textureCacheIds.push(lt),TextureCache[lt]&&TextureCache[lt]!==_&&console.warn(`Texture added to the cache with an id [${lt}] that already had an entry`),TextureCache[lt]=_)}static removeFromCache(_){if(typeof _=="string"){const lt=TextureCache[_];if(lt){const ft=lt.textureCacheIds.indexOf(_);return ft>-1&&lt.textureCacheIds.splice(ft,1),delete TextureCache[_],lt}}else if(_!=null&&_.textureCacheIds){for(let lt=0;lt<_.textureCacheIds.length;++lt)TextureCache[_.textureCacheIds[lt]]===_&&delete TextureCache[_.textureCacheIds[lt]];return _.textureCacheIds.length=0,_}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(_){this._frame=_,this.noFrame=!1;const{x:lt,y:ft,width:mt,height:pt}=_,gt=lt+mt>this.baseTexture.width,bt=ft+pt>this.baseTexture.height;if(gt||bt){const wt=gt&&bt?"and":"or",vt=`X: ${lt} + ${mt} = ${lt+mt} > ${this.baseTexture.width}`,Ct=`Y: ${ft} + ${pt} = ${ft+pt} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${vt} ${wt} ${Ct}`)}this.valid=mt&&pt&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=_),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(_){this._rotate=_,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Texture._EMPTY||(Texture._EMPTY=new Texture(new BaseTexture),removeAllHandlers(Texture._EMPTY),removeAllHandlers(Texture._EMPTY.baseTexture)),Texture._EMPTY}static get WHITE(){if(!Texture._WHITE){const _=settings.ADAPTER.createCanvas(16,16),lt=_.getContext("2d");_.width=16,_.height=16,lt.fillStyle="white",lt.fillRect(0,0,16,16),Texture._WHITE=new Texture(BaseTexture.from(_)),removeAllHandlers(Texture._WHITE),removeAllHandlers(Texture._WHITE.baseTexture)}return Texture._WHITE}}class RenderTexture extends Texture{constructor(_,lt){super(_,lt),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(_){this.framebuffer.multisample=_}resize(_,lt,ft=!0){const mt=this.baseTexture.resolution,pt=Math.round(_*mt)/mt,gt=Math.round(lt*mt)/mt;this.valid=pt>0&&gt>0,this._frame.width=this.orig.width=pt,this._frame.height=this.orig.height=gt,ft&&this.baseTexture.resize(pt,gt),this.updateUvs()}setResolution(_){const{baseTexture:lt}=this;lt.resolution!==_&&(lt.setResolution(_),this.resize(lt.width,lt.height,!1))}static create(_){return new RenderTexture(new BaseRenderTexture(_))}}class RenderTexturePool{constructor(_){this.texturePool={},this.textureOptions=_||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(_,lt,ft=MSAA_QUALITY.NONE){const mt=new BaseRenderTexture(Object.assign({width:_,height:lt,resolution:1,multisample:ft},this.textureOptions));return new RenderTexture(mt)}getOptimalTexture(_,lt,ft=1,mt=MSAA_QUALITY.NONE){let pt;_=Math.max(Math.ceil(_*ft-1e-6),1),lt=Math.max(Math.ceil(lt*ft-1e-6),1),!this.enableFullScreen||_!==this._pixelsWidth||lt!==this._pixelsHeight?(_=nextPow2(_),lt=nextPow2(lt),pt=((_&65535)<<16|lt&65535)>>>0,mt>1&&(pt+=mt*4294967296)):pt=mt>1?-mt:-1,this.texturePool[pt]||(this.texturePool[pt]=[]);let gt=this.texturePool[pt].pop();return gt||(gt=this.createTexture(_,lt,mt)),gt.filterPoolKey=pt,gt.setResolution(ft),gt}getFilterTexture(_,lt,ft){const mt=this.getOptimalTexture(_.width,_.height,lt||_.resolution,ft||MSAA_QUALITY.NONE);return mt.filterFrame=_.filterFrame,mt}returnTexture(_){const lt=_.filterPoolKey;_.filterFrame=null,this.texturePool[lt].push(_)}returnFilterTexture(_){this.returnTexture(_)}clear(_){if(_=_!==!1,_)for(const lt in this.texturePool){const ft=this.texturePool[lt];if(ft)for(let mt=0;mt<ft.length;mt++)ft[mt].destroy(!0)}this.texturePool={}}setScreenSize(_){if(!(_.width===this._pixelsWidth&&_.height===this._pixelsHeight)){this.enableFullScreen=_.width>0&&_.height>0;for(const lt in this.texturePool){if(!(Number(lt)<0))continue;const ft=this.texturePool[lt];if(ft)for(let mt=0;mt<ft.length;mt++)ft[mt].destroy(!0);this.texturePool[lt]=[]}this._pixelsWidth=_.width,this._pixelsHeight=_.height}}}RenderTexturePool.SCREEN_KEY=-1;class Quad extends Geometry{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class QuadUv extends Geometry{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Buffer$1(this.vertices),this.uvBuffer=new Buffer$1(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(_,lt){let ft=0,mt=0;return this.uvs[0]=ft,this.uvs[1]=mt,this.uvs[2]=ft+lt.width/_.width,this.uvs[3]=mt,this.uvs[4]=ft+lt.width/_.width,this.uvs[5]=mt+lt.height/_.height,this.uvs[6]=ft,this.uvs[7]=mt+lt.height/_.height,ft=lt.x,mt=lt.y,this.vertices[0]=ft,this.vertices[1]=mt,this.vertices[2]=ft+lt.width,this.vertices[3]=mt,this.vertices[4]=ft+lt.width,this.vertices[5]=mt+lt.height,this.vertices[6]=ft,this.vertices[7]=mt+lt.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class FilterState{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=MSAA_QUALITY.NONE,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const tempPoints=[new Point,new Point,new Point,new Point],tempMatrix$4=new Matrix;class FilterSystem{constructor(_){this.renderer=_,this.defaultFilterStack=[{}],this.texturePool=new RenderTexturePool,this.statePool=[],this.quad=new Quad,this.quadUv=new QuadUv,this.tempRect=new Rectangle,this.activeState={},this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(_,lt){const ft=this.renderer,mt=this.defaultFilterStack,pt=this.statePool.pop()||new FilterState,gt=ft.renderTexture;let bt,wt;if(gt.current){const Kt=gt.current;bt=Kt.resolution,wt=Kt.multisample}else bt=ft.resolution,wt=ft.multisample;let vt=lt[0].resolution||bt,Ct=lt[0].multisample??wt,Rt=lt[0].padding,Mt=lt[0].autoFit,Ot=lt[0].legacy??!0;for(let Kt=1;Kt<lt.length;Kt++){const hr=lt[Kt];vt=Math.min(vt,hr.resolution||bt),Ct=Math.min(Ct,hr.multisample??wt),Rt=this.useMaxPadding?Math.max(Rt,hr.padding):Rt+hr.padding,Mt=Mt&&hr.autoFit,Ot=Ot||(hr.legacy??!0)}mt.length===1&&(this.defaultFilterStack[0].renderTexture=gt.current),mt.push(pt),pt.resolution=vt,pt.multisample=Ct,pt.legacy=Ot,pt.target=_,pt.sourceFrame.copyFrom(_.filterArea||_.getBounds(!0)),pt.sourceFrame.pad(Rt);const Nt=this.tempRect.copyFrom(gt.sourceFrame);ft.projection.transform&&this.transformAABB(tempMatrix$4.copyFrom(ft.projection.transform).invert(),Nt),Mt?(pt.sourceFrame.fit(Nt),(pt.sourceFrame.width<=0||pt.sourceFrame.height<=0)&&(pt.sourceFrame.width=0,pt.sourceFrame.height=0)):pt.sourceFrame.intersects(Nt)||(pt.sourceFrame.width=0,pt.sourceFrame.height=0),this.roundFrame(pt.sourceFrame,gt.current?gt.current.resolution:ft.resolution,gt.sourceFrame,gt.destinationFrame,ft.projection.transform),pt.renderTexture=this.getOptimalFilterTexture(pt.sourceFrame.width,pt.sourceFrame.height,vt,Ct),pt.filters=lt,pt.destinationFrame.width=pt.renderTexture.width,pt.destinationFrame.height=pt.renderTexture.height;const Ht=this.tempRect;Ht.x=0,Ht.y=0,Ht.width=pt.sourceFrame.width,Ht.height=pt.sourceFrame.height,pt.renderTexture.filterFrame=pt.sourceFrame,pt.bindingSourceFrame.copyFrom(gt.sourceFrame),pt.bindingDestinationFrame.copyFrom(gt.destinationFrame),pt.transform=ft.projection.transform,ft.projection.transform=null,gt.bind(pt.renderTexture,pt.sourceFrame,Ht),ft.framebuffer.clear(0,0,0,0)}pop(){const _=this.defaultFilterStack,lt=_.pop(),ft=lt.filters;this.activeState=lt;const mt=this.globalUniforms.uniforms;mt.outputFrame=lt.sourceFrame,mt.resolution=lt.resolution;const pt=mt.inputSize,gt=mt.inputPixel,bt=mt.inputClamp;if(pt[0]=lt.destinationFrame.width,pt[1]=lt.destinationFrame.height,pt[2]=1/pt[0],pt[3]=1/pt[1],gt[0]=Math.round(pt[0]*lt.resolution),gt[1]=Math.round(pt[1]*lt.resolution),gt[2]=1/gt[0],gt[3]=1/gt[1],bt[0]=.5*gt[2],bt[1]=.5*gt[3],bt[2]=lt.sourceFrame.width*pt[2]-.5*gt[2],bt[3]=lt.sourceFrame.height*pt[3]-.5*gt[3],lt.legacy){const vt=mt.filterArea;vt[0]=lt.destinationFrame.width,vt[1]=lt.destinationFrame.height,vt[2]=lt.sourceFrame.x,vt[3]=lt.sourceFrame.y,mt.filterClamp=mt.inputClamp}this.globalUniforms.update();const wt=_[_.length-1];if(this.renderer.framebuffer.blit(),ft.length===1)ft[0].apply(this,lt.renderTexture,wt.renderTexture,CLEAR_MODES.BLEND,lt),this.returnFilterTexture(lt.renderTexture);else{let vt=lt.renderTexture,Ct=this.getOptimalFilterTexture(vt.width,vt.height,lt.resolution);Ct.filterFrame=vt.filterFrame;let Rt=0;for(Rt=0;Rt<ft.length-1;++Rt){Rt===1&&lt.multisample>1&&(Ct=this.getOptimalFilterTexture(vt.width,vt.height,lt.resolution),Ct.filterFrame=vt.filterFrame),ft[Rt].apply(this,vt,Ct,CLEAR_MODES.CLEAR,lt);const Mt=vt;vt=Ct,Ct=Mt}ft[Rt].apply(this,vt,wt.renderTexture,CLEAR_MODES.BLEND,lt),Rt>1&&lt.multisample>1&&this.returnFilterTexture(lt.renderTexture),this.returnFilterTexture(vt),this.returnFilterTexture(Ct)}lt.clear(),this.statePool.push(lt)}bindAndClear(_,lt=CLEAR_MODES.CLEAR){const{renderTexture:ft,state:mt}=this.renderer;if(_===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,_==null?void 0:_.filterFrame){const gt=this.tempRect;gt.x=0,gt.y=0,gt.width=_.filterFrame.width,gt.height=_.filterFrame.height,ft.bind(_,_.filterFrame,gt)}else _!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?ft.bind(_):this.renderer.renderTexture.bind(_,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const pt=mt.stateId&1||this.forceClear;(lt===CLEAR_MODES.CLEAR||lt===CLEAR_MODES.BLIT&&pt)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(_,lt,ft,mt){const pt=this.renderer;pt.state.set(_.state),this.bindAndClear(ft,mt),_.uniforms.uSampler=lt,_.uniforms.filterGlobals=this.globalUniforms,pt.shader.bind(_),_.legacy=!!_.program.attributeData.aTextureCoord,_.legacy?(this.quadUv.map(lt._frame,lt.filterFrame),pt.geometry.bind(this.quadUv),pt.geometry.draw(DRAW_MODES.TRIANGLES)):(pt.geometry.bind(this.quad),pt.geometry.draw(DRAW_MODES.TRIANGLE_STRIP))}calculateSpriteMatrix(_,lt){const{sourceFrame:ft,destinationFrame:mt}=this.activeState,{orig:pt}=lt._texture,gt=_.set(mt.width,0,0,mt.height,ft.x,ft.y),bt=lt.worldTransform.copyTo(Matrix.TEMP_MATRIX);return bt.invert(),gt.prepend(bt),gt.scale(1/pt.width,1/pt.height),gt.translate(lt.anchor.x,lt.anchor.y),gt}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(_,lt,ft=1,mt=MSAA_QUALITY.NONE){return this.texturePool.getOptimalTexture(_,lt,ft,mt)}getFilterTexture(_,lt,ft){if(typeof _=="number"){const pt=_;_=lt,lt=pt}_=_||this.activeState.renderTexture;const mt=this.texturePool.getOptimalTexture(_.width,_.height,lt||_.resolution,ft||MSAA_QUALITY.NONE);return mt.filterFrame=_.filterFrame,mt}returnFilterTexture(_){this.texturePool.returnTexture(_)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(_,lt){const ft=tempPoints[0],mt=tempPoints[1],pt=tempPoints[2],gt=tempPoints[3];ft.set(lt.left,lt.top),mt.set(lt.left,lt.bottom),pt.set(lt.right,lt.top),gt.set(lt.right,lt.bottom),_.apply(ft,ft),_.apply(mt,mt),_.apply(pt,pt),_.apply(gt,gt);const bt=Math.min(ft.x,mt.x,pt.x,gt.x),wt=Math.min(ft.y,mt.y,pt.y,gt.y),vt=Math.max(ft.x,mt.x,pt.x,gt.x),Ct=Math.max(ft.y,mt.y,pt.y,gt.y);lt.x=bt,lt.y=wt,lt.width=vt-bt,lt.height=Ct-wt}roundFrame(_,lt,ft,mt,pt){if(!(_.width<=0||_.height<=0||ft.width<=0||ft.height<=0)){if(pt){const{a:gt,b:bt,c:wt,d:vt}=pt;if((Math.abs(bt)>1e-4||Math.abs(wt)>1e-4)&&(Math.abs(gt)>1e-4||Math.abs(vt)>1e-4))return}pt=pt?tempMatrix$4.copyFrom(pt):tempMatrix$4.identity(),pt.translate(-ft.x,-ft.y).scale(mt.width/ft.width,mt.height/ft.height).translate(mt.x,mt.y),this.transformAABB(pt,_),_.ceil(lt),this.transformAABB(pt.invert(),_)}}}FilterSystem.extension={type:ExtensionType.RendererSystem,name:"filter"};extensions$1.add(FilterSystem);class GLFramebuffer{constructor(_){this.framebuffer=_,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const tempRectangle=new Rectangle;class FramebufferSystem{constructor(_){this.renderer=_,this.managedFramebuffers=[],this.unknownFramebuffer=new Framebuffer(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const _=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let lt=this.renderer.context.extensions.drawBuffers,ft=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(lt=null,ft=null),lt?_.drawBuffers=mt=>lt.drawBuffersWEBGL(mt):(this.hasMRT=!1,_.drawBuffers=()=>{}),ft||(this.writeDepthTexture=!1)}else this.msaaSamples=_.getInternalformatParameter(_.RENDERBUFFER,_.RGBA8,_.SAMPLES)}bind(_,lt,ft=0){const{gl:mt}=this;if(_){const pt=_.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(_);this.current!==_&&(this.current=_,mt.bindFramebuffer(mt.FRAMEBUFFER,pt.framebuffer)),pt.mipLevel!==ft&&(_.dirtyId++,_.dirtyFormat++,pt.mipLevel=ft),pt.dirtyId!==_.dirtyId&&(pt.dirtyId=_.dirtyId,pt.dirtyFormat!==_.dirtyFormat?(pt.dirtyFormat=_.dirtyFormat,pt.dirtySize=_.dirtySize,this.updateFramebuffer(_,ft)):pt.dirtySize!==_.dirtySize&&(pt.dirtySize=_.dirtySize,this.resizeFramebuffer(_)));for(let gt=0;gt<_.colorTextures.length;gt++){const bt=_.colorTextures[gt];this.renderer.texture.unbind(bt.parentTextureArray||bt)}if(_.depthTexture&&this.renderer.texture.unbind(_.depthTexture),lt){const gt=lt.width>>ft,bt=lt.height>>ft,wt=gt/lt.width;this.setViewport(lt.x*wt,lt.y*wt,gt,bt)}else{const gt=_.width>>ft,bt=_.height>>ft;this.setViewport(0,0,gt,bt)}}else this.current&&(this.current=null,mt.bindFramebuffer(mt.FRAMEBUFFER,null)),lt?this.setViewport(lt.x,lt.y,lt.width,lt.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(_,lt,ft,mt){const pt=this.viewport;_=Math.round(_),lt=Math.round(lt),ft=Math.round(ft),mt=Math.round(mt),(pt.width!==ft||pt.height!==mt||pt.x!==_||pt.y!==lt)&&(pt.x=_,pt.y=lt,pt.width=ft,pt.height=mt,this.gl.viewport(_,lt,ft,mt))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(_,lt,ft,mt,pt=BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH){const{gl:gt}=this;gt.clearColor(_,lt,ft,mt),gt.clear(pt)}initFramebuffer(_){const{gl:lt}=this,ft=new GLFramebuffer(lt.createFramebuffer());return ft.multisample=this.detectSamples(_.multisample),_.glFramebuffers[this.CONTEXT_UID]=ft,this.managedFramebuffers.push(_),_.disposeRunner.add(this),ft}resizeFramebuffer(_){const{gl:lt}=this,ft=_.glFramebuffers[this.CONTEXT_UID];if(ft.stencil){lt.bindRenderbuffer(lt.RENDERBUFFER,ft.stencil);let gt;this.renderer.context.webGLVersion===1?gt=lt.DEPTH_STENCIL:_.depth&&_.stencil?gt=lt.DEPTH24_STENCIL8:_.depth?gt=lt.DEPTH_COMPONENT24:gt=lt.STENCIL_INDEX8,ft.msaaBuffer?lt.renderbufferStorageMultisample(lt.RENDERBUFFER,ft.multisample,gt,_.width,_.height):lt.renderbufferStorage(lt.RENDERBUFFER,gt,_.width,_.height)}const mt=_.colorTextures;let pt=mt.length;lt.drawBuffers||(pt=Math.min(pt,1));for(let gt=0;gt<pt;gt++){const bt=mt[gt],wt=bt.parentTextureArray||bt;this.renderer.texture.bind(wt,0),gt===0&&ft.msaaBuffer&&(lt.bindRenderbuffer(lt.RENDERBUFFER,ft.msaaBuffer),lt.renderbufferStorageMultisample(lt.RENDERBUFFER,ft.multisample,wt._glTextures[this.CONTEXT_UID].internalFormat,_.width,_.height))}_.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(_.depthTexture,0)}updateFramebuffer(_,lt){const{gl:ft}=this,mt=_.glFramebuffers[this.CONTEXT_UID],pt=_.colorTextures;let gt=pt.length;ft.drawBuffers||(gt=Math.min(gt,1)),mt.multisample>1&&this.canMultisampleFramebuffer(_)?mt.msaaBuffer=mt.msaaBuffer||ft.createRenderbuffer():mt.msaaBuffer&&(ft.deleteRenderbuffer(mt.msaaBuffer),mt.msaaBuffer=null,mt.blitFramebuffer&&(mt.blitFramebuffer.dispose(),mt.blitFramebuffer=null));const bt=[];for(let wt=0;wt<gt;wt++){const vt=pt[wt],Ct=vt.parentTextureArray||vt;this.renderer.texture.bind(Ct,0),wt===0&&mt.msaaBuffer?(ft.bindRenderbuffer(ft.RENDERBUFFER,mt.msaaBuffer),ft.renderbufferStorageMultisample(ft.RENDERBUFFER,mt.multisample,Ct._glTextures[this.CONTEXT_UID].internalFormat,_.width,_.height),ft.framebufferRenderbuffer(ft.FRAMEBUFFER,ft.COLOR_ATTACHMENT0,ft.RENDERBUFFER,mt.msaaBuffer)):(ft.framebufferTexture2D(ft.FRAMEBUFFER,ft.COLOR_ATTACHMENT0+wt,vt.target,Ct._glTextures[this.CONTEXT_UID].texture,lt),bt.push(ft.COLOR_ATTACHMENT0+wt))}if(bt.length>1&&ft.drawBuffers(bt),_.depthTexture&&this.writeDepthTexture){const wt=_.depthTexture;this.renderer.texture.bind(wt,0),ft.framebufferTexture2D(ft.FRAMEBUFFER,ft.DEPTH_ATTACHMENT,ft.TEXTURE_2D,wt._glTextures[this.CONTEXT_UID].texture,lt)}if((_.stencil||_.depth)&&!(_.depthTexture&&this.writeDepthTexture)){mt.stencil=mt.stencil||ft.createRenderbuffer();let wt,vt;this.renderer.context.webGLVersion===1?(wt=ft.DEPTH_STENCIL_ATTACHMENT,vt=ft.DEPTH_STENCIL):_.depth&&_.stencil?(wt=ft.DEPTH_STENCIL_ATTACHMENT,vt=ft.DEPTH24_STENCIL8):_.depth?(wt=ft.DEPTH_ATTACHMENT,vt=ft.DEPTH_COMPONENT24):(wt=ft.STENCIL_ATTACHMENT,vt=ft.STENCIL_INDEX8),ft.bindRenderbuffer(ft.RENDERBUFFER,mt.stencil),mt.msaaBuffer?ft.renderbufferStorageMultisample(ft.RENDERBUFFER,mt.multisample,vt,_.width,_.height):ft.renderbufferStorage(ft.RENDERBUFFER,vt,_.width,_.height),ft.framebufferRenderbuffer(ft.FRAMEBUFFER,wt,ft.RENDERBUFFER,mt.stencil)}else mt.stencil&&(ft.deleteRenderbuffer(mt.stencil),mt.stencil=null)}canMultisampleFramebuffer(_){return this.renderer.context.webGLVersion!==1&&_.colorTextures.length<=1&&!_.depthTexture}detectSamples(_){const{msaaSamples:lt}=this;let ft=MSAA_QUALITY.NONE;if(_<=1||lt===null)return ft;for(let mt=0;mt<lt.length;mt++)if(lt[mt]<=_){ft=lt[mt];break}return ft===1&&(ft=MSAA_QUALITY.NONE),ft}blit(_,lt,ft){const{current:mt,renderer:pt,gl:gt,CONTEXT_UID:bt}=this;if(pt.context.webGLVersion!==2||!mt)return;const wt=mt.glFramebuffers[bt];if(!wt)return;if(!_){if(!wt.msaaBuffer)return;const Ct=mt.colorTextures[0];if(!Ct)return;wt.blitFramebuffer||(wt.blitFramebuffer=new Framebuffer(mt.width,mt.height),wt.blitFramebuffer.addColorTexture(0,Ct)),_=wt.blitFramebuffer,_.colorTextures[0]!==Ct&&(_.colorTextures[0]=Ct,_.dirtyId++,_.dirtyFormat++),(_.width!==mt.width||_.height!==mt.height)&&(_.width=mt.width,_.height=mt.height,_.dirtyId++,_.dirtySize++)}lt||(lt=tempRectangle,lt.width=mt.width,lt.height=mt.height),ft||(ft=lt);const vt=lt.width===ft.width&&lt.height===ft.height;this.bind(_),gt.bindFramebuffer(gt.READ_FRAMEBUFFER,wt.framebuffer),gt.blitFramebuffer(lt.left,lt.top,lt.right,lt.bottom,ft.left,ft.top,ft.right,ft.bottom,gt.COLOR_BUFFER_BIT,vt?gt.NEAREST:gt.LINEAR),gt.bindFramebuffer(gt.READ_FRAMEBUFFER,_.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(_,lt){const ft=_.glFramebuffers[this.CONTEXT_UID],mt=this.gl;if(!ft)return;delete _.glFramebuffers[this.CONTEXT_UID];const pt=this.managedFramebuffers.indexOf(_);pt>=0&&this.managedFramebuffers.splice(pt,1),_.disposeRunner.remove(this),lt||(mt.deleteFramebuffer(ft.framebuffer),ft.msaaBuffer&&mt.deleteRenderbuffer(ft.msaaBuffer),ft.stencil&&mt.deleteRenderbuffer(ft.stencil)),ft.blitFramebuffer&&this.disposeFramebuffer(ft.blitFramebuffer,lt)}disposeAll(_){const lt=this.managedFramebuffers;this.managedFramebuffers=[];for(let ft=0;ft<lt.length;ft++)this.disposeFramebuffer(lt[ft],_)}forceStencil(){const _=this.current;if(!_)return;const lt=_.glFramebuffers[this.CONTEXT_UID];if(!lt||lt.stencil&&_.stencil)return;_.stencil=!0;const ft=_.width,mt=_.height,pt=this.gl,gt=lt.stencil=pt.createRenderbuffer();pt.bindRenderbuffer(pt.RENDERBUFFER,gt);let bt,wt;this.renderer.context.webGLVersion===1?(bt=pt.DEPTH_STENCIL_ATTACHMENT,wt=pt.DEPTH_STENCIL):_.depth?(bt=pt.DEPTH_STENCIL_ATTACHMENT,wt=pt.DEPTH24_STENCIL8):(bt=pt.STENCIL_ATTACHMENT,wt=pt.STENCIL_INDEX8),lt.msaaBuffer?pt.renderbufferStorageMultisample(pt.RENDERBUFFER,lt.multisample,wt,ft,mt):pt.renderbufferStorage(pt.RENDERBUFFER,wt,ft,mt),pt.framebufferRenderbuffer(pt.FRAMEBUFFER,bt,pt.RENDERBUFFER,gt)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle}destroy(){this.renderer=null}}FramebufferSystem.extension={type:ExtensionType.RendererSystem,name:"framebuffer"};extensions$1.add(FramebufferSystem);const byteSizeMap={5126:4,5123:2,5121:1};class GeometrySystem{constructor(_){this.renderer=_,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const _=this.gl=this.renderer.gl,lt=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,lt.webGLVersion!==2){let ft=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(ft=null),ft?(_.createVertexArray=()=>ft.createVertexArrayOES(),_.bindVertexArray=mt=>ft.bindVertexArrayOES(mt),_.deleteVertexArray=mt=>ft.deleteVertexArrayOES(mt)):(this.hasVao=!1,_.createVertexArray=()=>null,_.bindVertexArray=()=>null,_.deleteVertexArray=()=>null)}if(lt.webGLVersion!==2){const ft=_.getExtension("ANGLE_instanced_arrays");ft?(_.vertexAttribDivisor=(mt,pt)=>ft.vertexAttribDivisorANGLE(mt,pt),_.drawElementsInstanced=(mt,pt,gt,bt,wt)=>ft.drawElementsInstancedANGLE(mt,pt,gt,bt,wt),_.drawArraysInstanced=(mt,pt,gt,bt)=>ft.drawArraysInstancedANGLE(mt,pt,gt,bt)):this.hasInstance=!1}this.canUseUInt32ElementIndex=lt.webGLVersion===2||!!lt.extensions.uint32ElementIndex}bind(_,lt){lt=lt||this.renderer.shader.shader;const{gl:ft}=this;let mt=_.glVertexArrayObjects[this.CONTEXT_UID],pt=!1;mt||(this.managedGeometries[_.id]=_,_.disposeRunner.add(this),_.glVertexArrayObjects[this.CONTEXT_UID]=mt={},pt=!0);const gt=mt[lt.program.id]||this.initGeometryVao(_,lt,pt);this._activeGeometry=_,this._activeVao!==gt&&(this._activeVao=gt,this.hasVao?ft.bindVertexArray(gt):this.activateVao(_,lt.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const _=this._activeGeometry,lt=this.renderer.buffer;for(let ft=0;ft<_.buffers.length;ft++){const mt=_.buffers[ft];lt.update(mt)}}checkCompatibility(_,lt){const ft=_.attributes,mt=lt.attributeData;for(const pt in mt)if(!ft[pt])throw new Error(`shader and geometry incompatible, geometry missing the "${pt}" attribute`)}getSignature(_,lt){const ft=_.attributes,mt=lt.attributeData,pt=["g",_.id];for(const gt in ft)mt[gt]&&pt.push(gt,mt[gt].location);return pt.join("-")}initGeometryVao(_,lt,ft=!0){const mt=this.gl,pt=this.CONTEXT_UID,gt=this.renderer.buffer,bt=lt.program;bt.glPrograms[pt]||this.renderer.shader.generateProgram(lt),this.checkCompatibility(_,bt);const wt=this.getSignature(_,bt),vt=_.glVertexArrayObjects[this.CONTEXT_UID];let Ct=vt[wt];if(Ct)return vt[bt.id]=Ct,Ct;const Rt=_.buffers,Mt=_.attributes,Ot={},Nt={};for(const Ht in Rt)Ot[Ht]=0,Nt[Ht]=0;for(const Ht in Mt)!Mt[Ht].size&&bt.attributeData[Ht]?Mt[Ht].size=bt.attributeData[Ht].size:Mt[Ht].size||console.warn(`PIXI Geometry attribute '${Ht}' size cannot be determined (likely the bound shader does not have the attribute)`),Ot[Mt[Ht].buffer]+=Mt[Ht].size*byteSizeMap[Mt[Ht].type];for(const Ht in Mt){const Kt=Mt[Ht],hr=Kt.size;Kt.stride===void 0&&(Ot[Kt.buffer]===hr*byteSizeMap[Kt.type]?Kt.stride=0:Kt.stride=Ot[Kt.buffer]),Kt.start===void 0&&(Kt.start=Nt[Kt.buffer],Nt[Kt.buffer]+=hr*byteSizeMap[Kt.type])}Ct=mt.createVertexArray(),mt.bindVertexArray(Ct);for(let Ht=0;Ht<Rt.length;Ht++){const Kt=Rt[Ht];gt.bind(Kt),ft&&Kt._glBuffers[pt].refCount++}return this.activateVao(_,bt),vt[bt.id]=Ct,vt[wt]=Ct,mt.bindVertexArray(null),gt.unbind(BUFFER_TYPE.ARRAY_BUFFER),Ct}disposeGeometry(_,lt){var bt;if(!this.managedGeometries[_.id])return;delete this.managedGeometries[_.id];const ft=_.glVertexArrayObjects[this.CONTEXT_UID],mt=this.gl,pt=_.buffers,gt=(bt=this.renderer)==null?void 0:bt.buffer;if(_.disposeRunner.remove(this),!!ft){if(gt)for(let wt=0;wt<pt.length;wt++){const vt=pt[wt]._glBuffers[this.CONTEXT_UID];vt&&(vt.refCount--,vt.refCount===0&&!lt&&gt.dispose(pt[wt],lt))}if(!lt){for(const wt in ft)if(wt[0]==="g"){const vt=ft[wt];this._activeVao===vt&&this.unbind(),mt.deleteVertexArray(vt)}}delete _.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(_){const lt=Object.keys(this.managedGeometries);for(let ft=0;ft<lt.length;ft++)this.disposeGeometry(this.managedGeometries[lt[ft]],_)}activateVao(_,lt){const ft=this.gl,mt=this.CONTEXT_UID,pt=this.renderer.buffer,gt=_.buffers,bt=_.attributes;_.indexBuffer&&pt.bind(_.indexBuffer);let wt=null;for(const vt in bt){const Ct=bt[vt],Rt=gt[Ct.buffer],Mt=Rt._glBuffers[mt];if(lt.attributeData[vt]){wt!==Mt&&(pt.bind(Rt),wt=Mt);const Ot=lt.attributeData[vt].location;if(ft.enableVertexAttribArray(Ot),ft.vertexAttribPointer(Ot,Ct.size,Ct.type||ft.FLOAT,Ct.normalized,Ct.stride,Ct.start),Ct.instance)if(this.hasInstance)ft.vertexAttribDivisor(Ot,Ct.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(_,lt,ft,mt){const{gl:pt}=this,gt=this._activeGeometry;if(gt.indexBuffer){const bt=gt.indexBuffer.data.BYTES_PER_ELEMENT,wt=bt===2?pt.UNSIGNED_SHORT:pt.UNSIGNED_INT;bt===2||bt===4&&this.canUseUInt32ElementIndex?gt.instanced?pt.drawElementsInstanced(_,lt||gt.indexBuffer.data.length,wt,(ft||0)*bt,mt||1):pt.drawElements(_,lt||gt.indexBuffer.data.length,wt,(ft||0)*bt):console.warn("unsupported index buffer type: uint32")}else gt.instanced?pt.drawArraysInstanced(_,ft,lt||gt.getSize(),mt||1):pt.drawArrays(_,ft,lt||gt.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}GeometrySystem.extension={type:ExtensionType.RendererSystem,name:"geometry"};extensions$1.add(GeometrySystem);const tempMat$1=new Matrix;class TextureMatrix{constructor(_,lt){this._texture=_,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof lt>"u"?.5:lt,this.isSimple=!1}get texture(){return this._texture}set texture(_){this._texture=_,this._textureID=-1}multiplyUvs(_,lt){lt===void 0&&(lt=_);const ft=this.mapCoord;for(let mt=0;mt<_.length;mt+=2){const pt=_[mt],gt=_[mt+1];lt[mt]=pt*ft.a+gt*ft.c+ft.tx,lt[mt+1]=pt*ft.b+gt*ft.d+ft.ty}return lt}update(_){const lt=this._texture;if(!lt||!lt.valid||!_&&this._textureID===lt._updateID)return!1;this._textureID=lt._updateID,this._updateID++;const ft=lt._uvs;this.mapCoord.set(ft.x1-ft.x0,ft.y1-ft.y0,ft.x3-ft.x0,ft.y3-ft.y0,ft.x0,ft.y0);const mt=lt.orig,pt=lt.trim;pt&&(tempMat$1.set(mt.width/pt.width,0,0,mt.height/pt.height,-pt.x/pt.width,-pt.y/pt.height),this.mapCoord.append(tempMat$1));const gt=lt.baseTexture,bt=this.uClampFrame,wt=this.clampMargin/gt.resolution,vt=this.clampOffset;return bt[0]=(lt._frame.x+wt+vt)/gt.width,bt[1]=(lt._frame.y+wt+vt)/gt.height,bt[2]=(lt._frame.x+lt._frame.width-wt+vt)/gt.width,bt[3]=(lt._frame.y+lt._frame.height-wt+vt)/gt.height,this.uClampOffset[0]=vt/gt.realWidth,this.uClampOffset[1]=vt/gt.realHeight,this.isSimple=lt._frame.width===gt.width&&lt._frame.height===gt.height&&lt.rotate===0,!0}}var fragment$7=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,vertex$4=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class SpriteMaskFilter extends Filter{constructor(_,lt,ft){let mt=null;typeof _!="string"&&lt===void 0&&ft===void 0&&(mt=_,_=void 0,lt=void 0,ft=void 0),super(_||vertex$4,lt||fragment$7,ft),this.maskSprite=mt,this.maskMatrix=new Matrix}get maskSprite(){return this._maskSprite}set maskSprite(_){this._maskSprite=_,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(_,lt,ft,mt){const pt=this._maskSprite,gt=pt._texture;gt.valid&&(gt.uvMatrix||(gt.uvMatrix=new TextureMatrix(gt,0)),gt.uvMatrix.update(),this.uniforms.npmAlpha=gt.baseTexture.alphaMode?0:1,this.uniforms.mask=gt,this.uniforms.otherMatrix=_.calculateSpriteMatrix(this.maskMatrix,pt).prepend(gt.uvMatrix.mapCoord),this.uniforms.alpha=pt.worldAlpha,this.uniforms.maskClamp=gt.uvMatrix.uClampFrame,_.applyFilter(this,lt,ft,mt))}}class MaskData{constructor(_=null){this.type=MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=_||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Filter.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(_){_?this._filters?this._filters[0]=_:this._filters=[_]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(_){_?(this._stencilCounter=_._stencilCounter,this._scissorCounter=_._scissorCounter,this._scissorRect=_._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class MaskSystem{constructor(_){this.renderer=_,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(_){this.maskStack=_,this.renderer.scissor.setMaskStack(_),this.renderer.stencil.setMaskStack(_)}push(_,lt){let ft=lt;if(!ft.isMaskData){const pt=this.maskDataPool.pop()||new MaskData;pt.pooled=!0,pt.maskObject=lt,ft=pt}const mt=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(ft.copyCountersOrReset(mt),ft._colorMask=mt?mt._colorMask:15,ft.autoDetect&&this.detect(ft),ft._target=_,ft.type!==MASK_TYPES.SPRITE&&this.maskStack.push(ft),ft.enabled)switch(ft.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.push(ft);break;case MASK_TYPES.STENCIL:this.renderer.stencil.push(ft);break;case MASK_TYPES.SPRITE:ft.copyCountersOrReset(null),this.pushSpriteMask(ft);break;case MASK_TYPES.COLOR:this.pushColorMask(ft);break}ft.type===MASK_TYPES.SPRITE&&this.maskStack.push(ft)}pop(_){const lt=this.maskStack.pop();if(!(!lt||lt._target!==_)){if(lt.enabled)switch(lt.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop(lt);break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(lt.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask(lt);break;case MASK_TYPES.COLOR:this.popColorMask(lt);break}if(lt.reset(),lt.pooled&&this.maskDataPool.push(lt),this.maskStack.length!==0){const ft=this.maskStack[this.maskStack.length-1];ft.type===MASK_TYPES.SPRITE&&ft._filters&&(ft._filters[0].maskSprite=ft.maskObject)}}}detect(_){const lt=_.maskObject;lt?lt.isSprite?_.type=MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(_)?_.type=MASK_TYPES.SCISSOR:_.type=MASK_TYPES.STENCIL:_.type=MASK_TYPES.COLOR}pushSpriteMask(_){const{maskObject:lt}=_,ft=_._target;let mt=_._filters;mt||(mt=this.alphaMaskPool[this.alphaMaskIndex],mt||(mt=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter])),mt[0].resolution=_.resolution,mt[0].multisample=_.multisample,mt[0].maskSprite=lt;const pt=ft.filterArea;ft.filterArea=lt.getBounds(!0),this.renderer.filter.push(ft,mt),ft.filterArea=pt,_._filters||this.alphaMaskIndex++}popSpriteMask(_){this.renderer.filter.pop(),_._filters?_._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(_){const lt=_._colorMask,ft=_._colorMask=lt&_.colorMask;ft!==lt&&this.renderer.gl.colorMask((ft&1)!==0,(ft&2)!==0,(ft&4)!==0,(ft&8)!==0)}popColorMask(_){const lt=_._colorMask,ft=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;ft!==lt&&this.renderer.gl.colorMask((ft&1)!==0,(ft&2)!==0,(ft&4)!==0,(ft&8)!==0)}destroy(){this.renderer=null}}MaskSystem.extension={type:ExtensionType.RendererSystem,name:"mask"};extensions$1.add(MaskSystem);class AbstractMaskSystem{constructor(_){this.renderer=_,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(_){const{gl:lt}=this.renderer,ft=this.getStackLength();this.maskStack=_;const mt=this.getStackLength();mt!==ft&&(mt===0?lt.disable(this.glConst):(lt.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const tempMatrix$3=new Matrix,rectPool=[],_ScissorSystem=class Ny extends AbstractMaskSystem{constructor(_){super(_),this.glConst=settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const _=this.maskStack[this.maskStack.length-1];return _?_._scissorCounter:0}calcScissorRect(_){if(_._scissorRectLocal)return;const lt=_._scissorRect,{maskObject:ft}=_,{renderer:mt}=this,pt=mt.renderTexture,gt=ft.getBounds(!0,rectPool.pop()??new Rectangle);this.roundFrameToPixels(gt,pt.current?pt.current.resolution:mt.resolution,pt.sourceFrame,pt.destinationFrame,mt.projection.transform),lt&&gt.fit(lt),_._scissorRectLocal=gt}static isMatrixRotated(_){if(!_)return!1;const{a:lt,b:ft,c:mt,d:pt}=_;return(Math.abs(ft)>1e-4||Math.abs(mt)>1e-4)&&(Math.abs(lt)>1e-4||Math.abs(pt)>1e-4)}testScissor(_){const{maskObject:lt}=_;if(!lt.isFastRect||!lt.isFastRect()||Ny.isMatrixRotated(lt.worldTransform)||Ny.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(_);const ft=_._scissorRectLocal;return ft.width>0&&ft.height>0}roundFrameToPixels(_,lt,ft,mt,pt){Ny.isMatrixRotated(pt)||(pt=pt?tempMatrix$3.copyFrom(pt):tempMatrix$3.identity(),pt.translate(-ft.x,-ft.y).scale(mt.width/ft.width,mt.height/ft.height).translate(mt.x,mt.y),this.renderer.filter.transformAABB(pt,_),_.fit(mt),_.x=Math.round(_.x*lt),_.y=Math.round(_.y*lt),_.width=Math.round(_.width*lt),_.height=Math.round(_.height*lt))}push(_){_._scissorRectLocal||this.calcScissorRect(_);const{gl:lt}=this.renderer;_._scissorRect||lt.enable(lt.SCISSOR_TEST),_._scissorCounter++,_._scissorRect=_._scissorRectLocal,this._useCurrent()}pop(_){const{gl:lt}=this.renderer;_&&rectPool.push(_._scissorRectLocal),this.getStackLength()>0?this._useCurrent():lt.disable(lt.SCISSOR_TEST)}_useCurrent(){const _=this.maskStack[this.maskStack.length-1]._scissorRect;let lt;this.renderer.renderTexture.current?lt=_.y:lt=this.renderer.height-_.height-_.y,this.renderer.gl.scissor(_.x,lt,_.width,_.height)}};_ScissorSystem.extension={type:ExtensionType.RendererSystem,name:"scissor"};let ScissorSystem=_ScissorSystem;extensions$1.add(ScissorSystem);class StencilSystem extends AbstractMaskSystem{constructor(_){super(_),this.glConst=settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const _=this.maskStack[this.maskStack.length-1];return _?_._stencilCounter:0}push(_){const lt=_.maskObject,{gl:ft}=this.renderer,mt=_._stencilCounter;mt===0&&(this.renderer.framebuffer.forceStencil(),ft.clearStencil(0),ft.clear(ft.STENCIL_BUFFER_BIT),ft.enable(ft.STENCIL_TEST)),_._stencilCounter++;const pt=_._colorMask;pt!==0&&(_._colorMask=0,ft.colorMask(!1,!1,!1,!1)),ft.stencilFunc(ft.EQUAL,mt,4294967295),ft.stencilOp(ft.KEEP,ft.KEEP,ft.INCR),lt.renderable=!0,lt.render(this.renderer),this.renderer.batch.flush(),lt.renderable=!1,pt!==0&&(_._colorMask=pt,ft.colorMask((pt&1)!==0,(pt&2)!==0,(pt&4)!==0,(pt&8)!==0)),this._useCurrent()}pop(_){const lt=this.renderer.gl;if(this.getStackLength()===0)lt.disable(lt.STENCIL_TEST);else{const ft=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,mt=ft?ft._colorMask:15;mt!==0&&(ft._colorMask=0,lt.colorMask(!1,!1,!1,!1)),lt.stencilOp(lt.KEEP,lt.KEEP,lt.DECR),_.renderable=!0,_.render(this.renderer),this.renderer.batch.flush(),_.renderable=!1,mt!==0&&(ft._colorMask=mt,lt.colorMask((mt&1)!==0,(mt&2)!==0,(mt&4)!==0,(mt&8)!==0)),this._useCurrent()}}_useCurrent(){const _=this.renderer.gl;_.stencilFunc(_.EQUAL,this.getStackLength(),4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP)}}StencilSystem.extension={type:ExtensionType.RendererSystem,name:"stencil"};extensions$1.add(StencilSystem);class PluginSystem{constructor(_){this.renderer=_,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return deprecation("7.0.0","renderer.plugins.extract has moved to renderer.extract"),_.extract}},prepare:{enumerable:!1,get(){return deprecation("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),_.prepare}},interaction:{enumerable:!1,get(){return deprecation("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),_.events}}})}init(){const _=this.rendererPlugins;for(const lt in _)this.plugins[lt]=new _[lt](this.renderer)}destroy(){for(const _ in this.plugins)this.plugins[_].destroy(),this.plugins[_]=null}}PluginSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_plugin"};extensions$1.add(PluginSystem);class ProjectionSystem{constructor(_){this.renderer=_,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Matrix,this.transform=null}update(_,lt,ft,mt){this.destinationFrame=_||this.destinationFrame||this.defaultFrame,this.sourceFrame=lt||this.sourceFrame||_,this.calculateProjection(this.destinationFrame,this.sourceFrame,ft,mt),this.transform&&this.projectionMatrix.append(this.transform);const pt=this.renderer;pt.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,pt.globalUniforms.update(),pt.shader.shader&&pt.shader.syncUniformGroup(pt.shader.shader.uniforms.globals)}calculateProjection(_,lt,ft,mt){const pt=this.projectionMatrix,gt=mt?-1:1;pt.identity(),pt.a=1/lt.width*2,pt.d=gt*(1/lt.height*2),pt.tx=-1-lt.x*pt.a,pt.ty=-gt-lt.y*pt.d}setTransform(_){}destroy(){this.renderer=null}}ProjectionSystem.extension={type:ExtensionType.RendererSystem,name:"projection"};extensions$1.add(ProjectionSystem);const tempTransform=new Transform,tempRect$1=new Rectangle;class GenerateTextureSystem{constructor(_){this.renderer=_,this._tempMatrix=new Matrix}generateTexture(_,lt){const{region:ft,...mt}=lt||{},pt=(ft==null?void 0:ft.copyTo(tempRect$1))||_.getLocalBounds(tempRect$1,!0),gt=mt.resolution||this.renderer.resolution;pt.width=Math.max(pt.width,1/gt),pt.height=Math.max(pt.height,1/gt),mt.width=pt.width,mt.height=pt.height,mt.resolution=gt,mt.multisample??(mt.multisample=this.renderer.multisample);const bt=RenderTexture.create(mt);this._tempMatrix.tx=-pt.x,this._tempMatrix.ty=-pt.y;const wt=_.transform;return _.transform=tempTransform,this.renderer.render(_,{renderTexture:bt,transform:this._tempMatrix,skipUpdateTransform:!!_.parent,blit:!0}),_.transform=wt,bt}destroy(){}}GenerateTextureSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"textureGenerator"};extensions$1.add(GenerateTextureSystem);const tempRect=new Rectangle,tempRect2=new Rectangle;class RenderTextureSystem{constructor(_){this.renderer=_,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.viewportFrame=new Rectangle}contextChange(){var lt;const _=(lt=this.renderer)==null?void 0:lt.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(_&&_.alpha&&_.premultipliedAlpha)}bind(_=null,lt,ft){const mt=this.renderer;this.current=_;let pt,gt,bt;_?(pt=_.baseTexture,bt=pt.resolution,lt||(tempRect.width=_.frame.width,tempRect.height=_.frame.height,lt=tempRect),ft||(tempRect2.x=_.frame.x,tempRect2.y=_.frame.y,tempRect2.width=lt.width,tempRect2.height=lt.height,ft=tempRect2),gt=pt.framebuffer):(bt=mt.resolution,lt||(tempRect.width=mt._view.screen.width,tempRect.height=mt._view.screen.height,lt=tempRect),ft||(ft=tempRect,ft.width=lt.width,ft.height=lt.height));const wt=this.viewportFrame;wt.x=ft.x*bt,wt.y=ft.y*bt,wt.width=ft.width*bt,wt.height=ft.height*bt,_||(wt.y=mt.view.height-(wt.y+wt.height)),wt.ceil(),this.renderer.framebuffer.bind(gt,wt),this.renderer.projection.update(ft,lt,bt,!gt),_?this.renderer.mask.setMaskStack(pt.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(lt),this.destinationFrame.copyFrom(ft)}clear(_,lt){const ft=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,mt=Color.shared.setValue(_||ft);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&mt.premultiply(mt.alpha);const pt=this.destinationFrame,gt=this.current?this.current.baseTexture:this.renderer._view.screen,bt=pt.width!==gt.width||pt.height!==gt.height;if(bt){let{x:wt,y:vt,width:Ct,height:Rt}=this.viewportFrame;wt=Math.round(wt),vt=Math.round(vt),Ct=Math.round(Ct),Rt=Math.round(Rt),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(wt,vt,Ct,Rt)}this.renderer.framebuffer.clear(mt.red,mt.green,mt.blue,mt.alpha,lt),bt&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}RenderTextureSystem.extension={type:ExtensionType.RendererSystem,name:"renderTexture"};extensions$1.add(RenderTextureSystem);class GLProgram{constructor(_,lt){this.program=_,this.uniformData=lt,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function getAttributeData(it,_){const lt={},ft=_.getProgramParameter(it,_.ACTIVE_ATTRIBUTES);for(let mt=0;mt<ft;mt++){const pt=_.getActiveAttrib(it,mt);if(pt.name.startsWith("gl_"))continue;const gt=mapType(_,pt.type),bt={type:gt,name:pt.name,size:mapSize(gt),location:_.getAttribLocation(it,pt.name)};lt[pt.name]=bt}return lt}function getUniformData(it,_){const lt={},ft=_.getProgramParameter(it,_.ACTIVE_UNIFORMS);for(let mt=0;mt<ft;mt++){const pt=_.getActiveUniform(it,mt),gt=pt.name.replace(/\[.*?\]$/,""),bt=!!pt.name.match(/\[.*?\]$/),wt=mapType(_,pt.type);lt[gt]={name:gt,index:mt,type:wt,size:pt.size,isArray:bt,value:defaultValue(wt,pt.size)}}return lt}function generateProgram(it,_){var bt;const lt=compileShader(it,it.VERTEX_SHADER,_.vertexSrc),ft=compileShader(it,it.FRAGMENT_SHADER,_.fragmentSrc),mt=it.createProgram();it.attachShader(mt,lt),it.attachShader(mt,ft);const pt=(bt=_.extra)==null?void 0:bt.transformFeedbackVaryings;if(pt&&(typeof it.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):it.transformFeedbackVaryings(mt,pt.names,pt.bufferMode==="separate"?it.SEPARATE_ATTRIBS:it.INTERLEAVED_ATTRIBS)),it.linkProgram(mt),it.getProgramParameter(mt,it.LINK_STATUS)||logProgramError(it,mt,lt,ft),_.attributeData=getAttributeData(mt,it),_.uniformData=getUniformData(mt,it),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(_.vertexSrc)){const wt=Object.keys(_.attributeData);wt.sort((vt,Ct)=>vt>Ct?1:-1);for(let vt=0;vt<wt.length;vt++)_.attributeData[wt[vt]].location=vt,it.bindAttribLocation(mt,vt,wt[vt]);it.linkProgram(mt)}it.deleteShader(lt),it.deleteShader(ft);const gt={};for(const wt in _.uniformData){const vt=_.uniformData[wt];gt[wt]={location:it.getUniformLocation(mt,wt),value:defaultValue(vt.type,vt.size)}}return new GLProgram(mt,gt)}function uboUpdate(it,_,lt,ft,mt){lt.buffer.update(mt)}const UBO_TO_SINGLE_SETTERS={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function createUBOElements(it){const _=it.map(pt=>({data:pt,offset:0,dataLen:0,dirty:0}));let lt=0,ft=0,mt=0;for(let pt=0;pt<_.length;pt++){const gt=_[pt];if(lt=GLSL_TO_STD40_SIZE[gt.data.type],gt.data.size>1&&(lt=Math.max(lt,16)*gt.data.size),gt.dataLen=lt,ft%lt!==0&&ft<16){const bt=ft%lt%16;ft+=bt,mt+=bt}ft+lt>16?(mt=Math.ceil(mt/16)*16,gt.offset=mt,mt+=lt,ft=lt):(gt.offset=mt,ft+=lt,mt+=lt)}return mt=Math.ceil(mt/16)*16,{uboElements:_,size:mt}}function getUBOData(it,_){const lt=[];for(const ft in it)_[ft]&&lt.push(_[ft]);return lt.sort((ft,mt)=>ft.index-mt.index),lt}function generateUniformBufferSync(it,_){if(!it.autoManage)return{size:0,syncFunc:uboUpdate};const lt=getUBOData(it.uniforms,_),{uboElements:ft,size:mt}=createUBOElements(lt),pt=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let gt=0;gt<ft.length;gt++){const bt=ft[gt],wt=it.uniforms[bt.data.name],vt=bt.data.name;let Ct=!1;for(let Rt=0;Rt<uniformParsers.length;Rt++){const Mt=uniformParsers[Rt];if(Mt.codeUbo&&Mt.test(bt.data,wt)){pt.push(`offset = ${bt.offset/4};`,uniformParsers[Rt].codeUbo(bt.data.name,wt)),Ct=!0;break}}if(!Ct)if(bt.data.size>1){const Rt=mapSize(bt.data.type),Mt=Math.max(GLSL_TO_STD40_SIZE[bt.data.type]/16,1),Ot=Rt/Mt,Nt=(4-Ot%4)%4;pt.push(`
                cv = ud.${vt}.value;
                v = uv.${vt};
                offset = ${bt.offset/4};

                t = 0;

                for(var i=0; i < ${bt.data.size*Mt}; i++)
                {
                    for(var j = 0; j < ${Ot}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${Nt};
                }

                `)}else{const Rt=UBO_TO_SINGLE_SETTERS[bt.data.type];pt.push(`
                cv = ud.${vt}.value;
                v = uv.${vt};
                offset = ${bt.offset/4};
                ${Rt};
                `)}}return pt.push(`
       renderer.buffer.update(buffer);
    `),{size:mt,syncFunc:new Function("ud","uv","renderer","syncData","buffer",pt.join(`
`))}}let UID=0;const defaultSyncData={textureCount:0,uboCount:0};class ShaderSystem{constructor(_){this.destroyed=!1,this.renderer=_,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=UID++}systemCheck(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(_){this.gl=_,this.reset()}bind(_,lt){_.disposeRunner.add(this),_.uniforms.globals=this.renderer.globalUniforms;const ft=_.program,mt=ft.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(_);return this.shader=_,this.program!==ft&&(this.program=ft,this.gl.useProgram(mt.program)),lt||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(_.uniformGroup,defaultSyncData)),mt}setUniforms(_){const lt=this.shader.program,ft=lt.glPrograms[this.renderer.CONTEXT_UID];lt.syncUniforms(ft.uniformData,_,this.renderer)}syncUniformGroup(_,lt){const ft=this.getGlProgram();(!_.static||_.dirtyId!==ft.uniformDirtyGroups[_.id])&&(ft.uniformDirtyGroups[_.id]=_.dirtyId,this.syncUniforms(_,ft,lt))}syncUniforms(_,lt,ft){(_.syncUniforms[this.shader.program.id]||this.createSyncGroups(_))(lt.uniformData,_.uniforms,this.renderer,ft)}createSyncGroups(_){const lt=this.getSignature(_,this.shader.program.uniformData,"u");return this.cache[lt]||(this.cache[lt]=generateUniformsSync(_,this.shader.program.uniformData)),_.syncUniforms[this.shader.program.id]=this.cache[lt],_.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(_,lt){const ft=this.getGlProgram();if(!_.static||_.dirtyId!==0||!ft.uniformGroups[_.id]){_.dirtyId=0;const mt=ft.uniformGroups[_.id]||this.createSyncBufferGroup(_,ft,lt);_.buffer.update(),mt(ft.uniformData,_.uniforms,this.renderer,defaultSyncData,_.buffer)}this.renderer.buffer.bindBufferBase(_.buffer,ft.uniformBufferBindings[lt])}createSyncBufferGroup(_,lt,ft){const{gl:mt}=this.renderer;this.renderer.buffer.bind(_.buffer);const pt=this.gl.getUniformBlockIndex(lt.program,ft);lt.uniformBufferBindings[ft]=this.shader.uniformBindCount,mt.uniformBlockBinding(lt.program,pt,this.shader.uniformBindCount),this.shader.uniformBindCount++;const gt=this.getSignature(_,this.shader.program.uniformData,"ubo");let bt=this._uboCache[gt];if(bt||(bt=this._uboCache[gt]=generateUniformBufferSync(_,this.shader.program.uniformData)),_.autoManage){const wt=new Float32Array(bt.size/4);_.buffer.update(wt)}return lt.uniformGroups[_.id]=bt.syncFunc,lt.uniformGroups[_.id]}getSignature(_,lt,ft){const mt=_.uniforms,pt=[`${ft}-`];for(const gt in mt)pt.push(gt),lt[gt]&&pt.push(lt[gt].type);return pt.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(_){const lt=this.gl,ft=_.program,mt=generateProgram(lt,ft);return ft.glPrograms[this.renderer.CONTEXT_UID]=mt,mt}reset(){this.program=null,this.shader=null}disposeShader(_){this.shader===_&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ShaderSystem.extension={type:ExtensionType.RendererSystem,name:"shader"};extensions$1.add(ShaderSystem);class StartupSystem{constructor(_){this.renderer=_}run(_){const{renderer:lt}=this;lt.runners.init.emit(lt.options),_.hello&&console.log(`PixiJS 7.4.2 - ${lt.rendererLogId} - https://pixijs.com`),lt.resize(lt.screen.width,lt.screen.height)}destroy(){}}StartupSystem.defaultOptions={hello:!1},StartupSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"startup"};extensions$1.add(StartupSystem);function mapWebGLBlendModesToPixi(it,_=[]){return _[BLEND_MODES.NORMAL]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.ADD]=[it.ONE,it.ONE],_[BLEND_MODES.MULTIPLY]=[it.DST_COLOR,it.ONE_MINUS_SRC_ALPHA,it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SCREEN]=[it.ONE,it.ONE_MINUS_SRC_COLOR,it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.OVERLAY]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.DARKEN]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.LIGHTEN]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.COLOR_DODGE]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.COLOR_BURN]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.HARD_LIGHT]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SOFT_LIGHT]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.DIFFERENCE]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.EXCLUSION]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.HUE]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SATURATION]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.COLOR]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.LUMINOSITY]=[it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.NONE]=[0,0],_[BLEND_MODES.NORMAL_NPM]=[it.SRC_ALPHA,it.ONE_MINUS_SRC_ALPHA,it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.ADD_NPM]=[it.SRC_ALPHA,it.ONE,it.ONE,it.ONE],_[BLEND_MODES.SCREEN_NPM]=[it.SRC_ALPHA,it.ONE_MINUS_SRC_COLOR,it.ONE,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SRC_IN]=[it.DST_ALPHA,it.ZERO],_[BLEND_MODES.SRC_OUT]=[it.ONE_MINUS_DST_ALPHA,it.ZERO],_[BLEND_MODES.SRC_ATOP]=[it.DST_ALPHA,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.DST_OVER]=[it.ONE_MINUS_DST_ALPHA,it.ONE],_[BLEND_MODES.DST_IN]=[it.ZERO,it.SRC_ALPHA],_[BLEND_MODES.DST_OUT]=[it.ZERO,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.DST_ATOP]=[it.ONE_MINUS_DST_ALPHA,it.SRC_ALPHA],_[BLEND_MODES.XOR]=[it.ONE_MINUS_DST_ALPHA,it.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SUBTRACT]=[it.ONE,it.ONE,it.ONE,it.ONE,it.FUNC_REVERSE_SUBTRACT,it.FUNC_ADD],_}const BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,_StateSystem=class qy{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[BLEND]=this.setBlend,this.map[OFFSET]=this.setOffset,this.map[CULLING]=this.setCullFace,this.map[DEPTH_TEST]=this.setDepthTest,this.map[WINDING]=this.setFrontFace,this.map[DEPTH_MASK]=this.setDepthMask,this.checks=[],this.defaultState=new State,this.defaultState.blend=!0}contextChange(_){this.gl=_,this.blendModes=mapWebGLBlendModesToPixi(_),this.set(this.defaultState),this.reset()}set(_){if(_=_||this.defaultState,this.stateId!==_.data){let lt=this.stateId^_.data,ft=0;for(;lt;)lt&1&&this.map[ft].call(this,!!(_.data&1<<ft)),lt=lt>>1,ft++;this.stateId=_.data}for(let lt=0;lt<this.checks.length;lt++)this.checks[lt](this,_)}forceState(_){_=_||this.defaultState;for(let lt=0;lt<this.map.length;lt++)this.map[lt].call(this,!!(_.data&1<<lt));for(let lt=0;lt<this.checks.length;lt++)this.checks[lt](this,_);this.stateId=_.data}setBlend(_){this.updateCheck(qy.checkBlendMode,_),this.gl[_?"enable":"disable"](this.gl.BLEND)}setOffset(_){this.updateCheck(qy.checkPolygonOffset,_),this.gl[_?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(_){this.gl[_?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(_){this.gl.depthMask(_)}setCullFace(_){this.gl[_?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(_){this.gl.frontFace(this.gl[_?"CW":"CCW"])}setBlendMode(_){if(_===this.blendMode)return;this.blendMode=_;const lt=this.blendModes[_],ft=this.gl;lt.length===2?ft.blendFunc(lt[0],lt[1]):ft.blendFuncSeparate(lt[0],lt[1],lt[2],lt[3]),lt.length===6?(this._blendEq=!0,ft.blendEquationSeparate(lt[4],lt[5])):this._blendEq&&(this._blendEq=!1,ft.blendEquationSeparate(ft.FUNC_ADD,ft.FUNC_ADD))}setPolygonOffset(_,lt){this.gl.polygonOffset(_,lt)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(_,lt){const ft=this.checks.indexOf(_);lt&&ft===-1?this.checks.push(_):!lt&&ft!==-1&&this.checks.splice(ft,1)}static checkBlendMode(_,lt){_.setBlendMode(lt.blendMode)}static checkPolygonOffset(_,lt){_.setPolygonOffset(1,lt.polygonOffset)}destroy(){this.gl=null}};_StateSystem.extension={type:ExtensionType.RendererSystem,name:"state"};let StateSystem=_StateSystem;extensions$1.add(StateSystem);class SystemManager extends EventEmitter{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(_){this.addRunners(..._.runners);const lt=(_.priority??[]).filter(mt=>_.systems[mt]),ft=[...lt,...Object.keys(_.systems).filter(mt=>!lt.includes(mt))];for(const mt of ft)this.addSystem(_.systems[mt],mt)}addRunners(..._){_.forEach(lt=>{this.runners[lt]=new Runner(lt)})}addSystem(_,lt){const ft=new _(this);if(this[lt])throw new Error(`Whoops! The name "${lt}" is already in use`);this[lt]=ft,this._systemsHash[lt]=ft;for(const mt in this.runners)this.runners[mt].add(ft);return this}emitWithCustomOptions(_,lt){const ft=Object.keys(this._systemsHash);_.items.forEach(mt=>{const pt=ft.find(gt=>this._systemsHash[gt]===mt);mt[_.name](lt[pt])})}destroy(){Object.values(this.runners).forEach(_=>{_.destroy()}),this._systemsHash={}}}const _TextureGCSystem=class By{constructor(_){this.renderer=_,this.count=0,this.checkCount=0,this.maxIdle=By.defaultMaxIdle,this.checkCountMax=By.defaultCheckCountMax,this.mode=By.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const _=this.renderer.texture,lt=_.managedTextures;let ft=!1;for(let mt=0;mt<lt.length;mt++){const pt=lt[mt];pt.resource&&this.count-pt.touched>this.maxIdle&&(_.destroyTexture(pt,!0),lt[mt]=null,ft=!0)}if(ft){let mt=0;for(let pt=0;pt<lt.length;pt++)lt[pt]!==null&&(lt[mt++]=lt[pt]);lt.length=mt}}unload(_){const lt=this.renderer.texture,ft=_._texture;ft&&!ft.framebuffer&&lt.destroyTexture(ft);for(let mt=_.children.length-1;mt>=0;mt--)this.unload(_.children[mt])}destroy(){this.renderer=null}};_TextureGCSystem.defaultMode=GC_MODES.AUTO,_TextureGCSystem.defaultMaxIdle=60*60,_TextureGCSystem.defaultCheckCountMax=60*10,_TextureGCSystem.extension={type:ExtensionType.RendererSystem,name:"textureGC"};let TextureGCSystem=_TextureGCSystem;extensions$1.add(TextureGCSystem);class GLTexture{constructor(_){this.texture=_,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=TYPES.UNSIGNED_BYTE,this.internalFormat=FORMATS.RGBA,this.samplerType=0}}function mapInternalFormatToSamplerType(it){let _;return"WebGL2RenderingContext"in globalThis&&it instanceof globalThis.WebGL2RenderingContext?_={[it.RGB]:SAMPLER_TYPES.FLOAT,[it.RGBA]:SAMPLER_TYPES.FLOAT,[it.ALPHA]:SAMPLER_TYPES.FLOAT,[it.LUMINANCE]:SAMPLER_TYPES.FLOAT,[it.LUMINANCE_ALPHA]:SAMPLER_TYPES.FLOAT,[it.R8]:SAMPLER_TYPES.FLOAT,[it.R8_SNORM]:SAMPLER_TYPES.FLOAT,[it.RG8]:SAMPLER_TYPES.FLOAT,[it.RG8_SNORM]:SAMPLER_TYPES.FLOAT,[it.RGB8]:SAMPLER_TYPES.FLOAT,[it.RGB8_SNORM]:SAMPLER_TYPES.FLOAT,[it.RGB565]:SAMPLER_TYPES.FLOAT,[it.RGBA4]:SAMPLER_TYPES.FLOAT,[it.RGB5_A1]:SAMPLER_TYPES.FLOAT,[it.RGBA8]:SAMPLER_TYPES.FLOAT,[it.RGBA8_SNORM]:SAMPLER_TYPES.FLOAT,[it.RGB10_A2]:SAMPLER_TYPES.FLOAT,[it.RGB10_A2UI]:SAMPLER_TYPES.FLOAT,[it.SRGB8]:SAMPLER_TYPES.FLOAT,[it.SRGB8_ALPHA8]:SAMPLER_TYPES.FLOAT,[it.R16F]:SAMPLER_TYPES.FLOAT,[it.RG16F]:SAMPLER_TYPES.FLOAT,[it.RGB16F]:SAMPLER_TYPES.FLOAT,[it.RGBA16F]:SAMPLER_TYPES.FLOAT,[it.R32F]:SAMPLER_TYPES.FLOAT,[it.RG32F]:SAMPLER_TYPES.FLOAT,[it.RGB32F]:SAMPLER_TYPES.FLOAT,[it.RGBA32F]:SAMPLER_TYPES.FLOAT,[it.R11F_G11F_B10F]:SAMPLER_TYPES.FLOAT,[it.RGB9_E5]:SAMPLER_TYPES.FLOAT,[it.R8I]:SAMPLER_TYPES.INT,[it.R8UI]:SAMPLER_TYPES.UINT,[it.R16I]:SAMPLER_TYPES.INT,[it.R16UI]:SAMPLER_TYPES.UINT,[it.R32I]:SAMPLER_TYPES.INT,[it.R32UI]:SAMPLER_TYPES.UINT,[it.RG8I]:SAMPLER_TYPES.INT,[it.RG8UI]:SAMPLER_TYPES.UINT,[it.RG16I]:SAMPLER_TYPES.INT,[it.RG16UI]:SAMPLER_TYPES.UINT,[it.RG32I]:SAMPLER_TYPES.INT,[it.RG32UI]:SAMPLER_TYPES.UINT,[it.RGB8I]:SAMPLER_TYPES.INT,[it.RGB8UI]:SAMPLER_TYPES.UINT,[it.RGB16I]:SAMPLER_TYPES.INT,[it.RGB16UI]:SAMPLER_TYPES.UINT,[it.RGB32I]:SAMPLER_TYPES.INT,[it.RGB32UI]:SAMPLER_TYPES.UINT,[it.RGBA8I]:SAMPLER_TYPES.INT,[it.RGBA8UI]:SAMPLER_TYPES.UINT,[it.RGBA16I]:SAMPLER_TYPES.INT,[it.RGBA16UI]:SAMPLER_TYPES.UINT,[it.RGBA32I]:SAMPLER_TYPES.INT,[it.RGBA32UI]:SAMPLER_TYPES.UINT,[it.DEPTH_COMPONENT16]:SAMPLER_TYPES.FLOAT,[it.DEPTH_COMPONENT24]:SAMPLER_TYPES.FLOAT,[it.DEPTH_COMPONENT32F]:SAMPLER_TYPES.FLOAT,[it.DEPTH_STENCIL]:SAMPLER_TYPES.FLOAT,[it.DEPTH24_STENCIL8]:SAMPLER_TYPES.FLOAT,[it.DEPTH32F_STENCIL8]:SAMPLER_TYPES.FLOAT}:_={[it.RGB]:SAMPLER_TYPES.FLOAT,[it.RGBA]:SAMPLER_TYPES.FLOAT,[it.ALPHA]:SAMPLER_TYPES.FLOAT,[it.LUMINANCE]:SAMPLER_TYPES.FLOAT,[it.LUMINANCE_ALPHA]:SAMPLER_TYPES.FLOAT,[it.DEPTH_STENCIL]:SAMPLER_TYPES.FLOAT},_}function mapTypeAndFormatToInternalFormat(it){let _;return"WebGL2RenderingContext"in globalThis&&it instanceof globalThis.WebGL2RenderingContext?_={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:it.RGBA8,[FORMATS.RGB]:it.RGB8,[FORMATS.RG]:it.RG8,[FORMATS.RED]:it.R8,[FORMATS.RGBA_INTEGER]:it.RGBA8UI,[FORMATS.RGB_INTEGER]:it.RGB8UI,[FORMATS.RG_INTEGER]:it.RG8UI,[FORMATS.RED_INTEGER]:it.R8UI,[FORMATS.ALPHA]:it.ALPHA,[FORMATS.LUMINANCE]:it.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:it.LUMINANCE_ALPHA},[TYPES.BYTE]:{[FORMATS.RGBA]:it.RGBA8_SNORM,[FORMATS.RGB]:it.RGB8_SNORM,[FORMATS.RG]:it.RG8_SNORM,[FORMATS.RED]:it.R8_SNORM,[FORMATS.RGBA_INTEGER]:it.RGBA8I,[FORMATS.RGB_INTEGER]:it.RGB8I,[FORMATS.RG_INTEGER]:it.RG8I,[FORMATS.RED_INTEGER]:it.R8I},[TYPES.UNSIGNED_SHORT]:{[FORMATS.RGBA_INTEGER]:it.RGBA16UI,[FORMATS.RGB_INTEGER]:it.RGB16UI,[FORMATS.RG_INTEGER]:it.RG16UI,[FORMATS.RED_INTEGER]:it.R16UI,[FORMATS.DEPTH_COMPONENT]:it.DEPTH_COMPONENT16},[TYPES.SHORT]:{[FORMATS.RGBA_INTEGER]:it.RGBA16I,[FORMATS.RGB_INTEGER]:it.RGB16I,[FORMATS.RG_INTEGER]:it.RG16I,[FORMATS.RED_INTEGER]:it.R16I},[TYPES.UNSIGNED_INT]:{[FORMATS.RGBA_INTEGER]:it.RGBA32UI,[FORMATS.RGB_INTEGER]:it.RGB32UI,[FORMATS.RG_INTEGER]:it.RG32UI,[FORMATS.RED_INTEGER]:it.R32UI,[FORMATS.DEPTH_COMPONENT]:it.DEPTH_COMPONENT24},[TYPES.INT]:{[FORMATS.RGBA_INTEGER]:it.RGBA32I,[FORMATS.RGB_INTEGER]:it.RGB32I,[FORMATS.RG_INTEGER]:it.RG32I,[FORMATS.RED_INTEGER]:it.R32I},[TYPES.FLOAT]:{[FORMATS.RGBA]:it.RGBA32F,[FORMATS.RGB]:it.RGB32F,[FORMATS.RG]:it.RG32F,[FORMATS.RED]:it.R32F,[FORMATS.DEPTH_COMPONENT]:it.DEPTH_COMPONENT32F},[TYPES.HALF_FLOAT]:{[FORMATS.RGBA]:it.RGBA16F,[FORMATS.RGB]:it.RGB16F,[FORMATS.RG]:it.RG16F,[FORMATS.RED]:it.R16F},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:it.RGB565},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:it.RGBA4},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:it.RGB5_A1},[TYPES.UNSIGNED_INT_2_10_10_10_REV]:{[FORMATS.RGBA]:it.RGB10_A2,[FORMATS.RGBA_INTEGER]:it.RGB10_A2UI},[TYPES.UNSIGNED_INT_10F_11F_11F_REV]:{[FORMATS.RGB]:it.R11F_G11F_B10F},[TYPES.UNSIGNED_INT_5_9_9_9_REV]:{[FORMATS.RGB]:it.RGB9_E5},[TYPES.UNSIGNED_INT_24_8]:{[FORMATS.DEPTH_STENCIL]:it.DEPTH24_STENCIL8},[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[FORMATS.DEPTH_STENCIL]:it.DEPTH32F_STENCIL8}}:_={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:it.RGBA,[FORMATS.RGB]:it.RGB,[FORMATS.ALPHA]:it.ALPHA,[FORMATS.LUMINANCE]:it.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:it.LUMINANCE_ALPHA},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:it.RGB},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:it.RGBA},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:it.RGBA}},_}class TextureSystem{constructor(_){this.renderer=_,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new BaseTexture,this.hasIntegerTextures=!1}contextChange(){const _=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=mapTypeAndFormatToInternalFormat(_),this.samplerTypes=mapInternalFormatToSamplerType(_);const lt=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=lt;for(let mt=0;mt<lt;mt++)this.boundTextures[mt]=null;this.emptyTextures={};const ft=new GLTexture(_.createTexture());_.bindTexture(_.TEXTURE_2D,ft.texture),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,1,1,0,_.RGBA,_.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[_.TEXTURE_2D]=ft,this.emptyTextures[_.TEXTURE_CUBE_MAP]=new GLTexture(_.createTexture()),_.bindTexture(_.TEXTURE_CUBE_MAP,this.emptyTextures[_.TEXTURE_CUBE_MAP].texture);for(let mt=0;mt<6;mt++)_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+mt,0,_.RGBA,1,1,0,_.RGBA,_.UNSIGNED_BYTE,null);_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MIN_FILTER,_.LINEAR);for(let mt=0;mt<this.boundTextures.length;mt++)this.bind(null,mt)}bind(_,lt=0){const{gl:ft}=this;if(_=_==null?void 0:_.castToBaseTexture(),(_==null?void 0:_.valid)&&!_.parentTextureArray){_.touched=this.renderer.textureGC.count;const mt=_._glTextures[this.CONTEXT_UID]||this.initTexture(_);this.boundTextures[lt]!==_&&(this.currentLocation!==lt&&(this.currentLocation=lt,ft.activeTexture(ft.TEXTURE0+lt)),ft.bindTexture(_.target,mt.texture)),mt.dirtyId!==_.dirtyId?(this.currentLocation!==lt&&(this.currentLocation=lt,ft.activeTexture(ft.TEXTURE0+lt)),this.updateTexture(_)):mt.dirtyStyleId!==_.dirtyStyleId&&this.updateTextureStyle(_),this.boundTextures[lt]=_}else this.currentLocation!==lt&&(this.currentLocation=lt,ft.activeTexture(ft.TEXTURE0+lt)),ft.bindTexture(ft.TEXTURE_2D,this.emptyTextures[ft.TEXTURE_2D].texture),this.boundTextures[lt]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let _=0;_<this.boundTextures.length;_++)this.boundTextures[_]=this.unknownTexture}unbind(_){const{gl:lt,boundTextures:ft}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let mt=0;mt<ft.length;mt++)ft[mt]===this.unknownTexture&&this.bind(null,mt)}for(let mt=0;mt<ft.length;mt++)ft[mt]===_&&(this.currentLocation!==mt&&(lt.activeTexture(lt.TEXTURE0+mt),this.currentLocation=mt),lt.bindTexture(_.target,this.emptyTextures[_.target].texture),ft[mt]=null)}ensureSamplerType(_){const{boundTextures:lt,hasIntegerTextures:ft,CONTEXT_UID:mt}=this;if(ft)for(let pt=_-1;pt>=0;--pt){const gt=lt[pt];gt&&gt._glTextures[mt].samplerType!==SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(gt)}}initTexture(_){const lt=new GLTexture(this.gl.createTexture());return lt.dirtyId=-1,_._glTextures[this.CONTEXT_UID]=lt,this.managedTextures.push(_),_.on("dispose",this.destroyTexture,this),lt}initTextureType(_,lt){var ft;lt.internalFormat=((ft=this.internalFormats[_.type])==null?void 0:ft[_.format])??_.format,lt.samplerType=this.samplerTypes[lt.internalFormat]??SAMPLER_TYPES.FLOAT,this.webGLVersion===2&&_.type===TYPES.HALF_FLOAT?lt.type=this.gl.HALF_FLOAT:lt.type=_.type}updateTexture(_){var mt;const lt=_._glTextures[this.CONTEXT_UID];if(!lt)return;const ft=this.renderer;if(this.initTextureType(_,lt),(mt=_.resource)==null?void 0:mt.upload(ft,_,lt))lt.samplerType!==SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{const pt=_.realWidth,gt=_.realHeight,bt=ft.gl;(lt.width!==pt||lt.height!==gt||lt.dirtyId<0)&&(lt.width=pt,lt.height=gt,bt.texImage2D(_.target,0,lt.internalFormat,pt,gt,0,_.format,lt.type,null))}_.dirtyStyleId!==lt.dirtyStyleId&&this.updateTextureStyle(_),lt.dirtyId=_.dirtyId}destroyTexture(_,lt){const{gl:ft}=this;if(_=_.castToBaseTexture(),_._glTextures[this.CONTEXT_UID]&&(this.unbind(_),ft.deleteTexture(_._glTextures[this.CONTEXT_UID].texture),_.off("dispose",this.destroyTexture,this),delete _._glTextures[this.CONTEXT_UID],!lt)){const mt=this.managedTextures.indexOf(_);mt!==-1&&removeItems(this.managedTextures,mt,1)}}updateTextureStyle(_){var ft;const lt=_._glTextures[this.CONTEXT_UID];lt&&((_.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!_.isPowerOfTwo?lt.mipmap=!1:lt.mipmap=_.mipmap>=1,this.webGLVersion!==2&&!_.isPowerOfTwo?lt.wrapMode=WRAP_MODES.CLAMP:lt.wrapMode=_.wrapMode,(ft=_.resource)!=null&&ft.style(this.renderer,_,lt)||this.setStyle(_,lt),lt.dirtyStyleId=_.dirtyStyleId)}setStyle(_,lt){const ft=this.gl;if(lt.mipmap&&_.mipmap!==MIPMAP_MODES.ON_MANUAL&&ft.generateMipmap(_.target),ft.texParameteri(_.target,ft.TEXTURE_WRAP_S,lt.wrapMode),ft.texParameteri(_.target,ft.TEXTURE_WRAP_T,lt.wrapMode),lt.mipmap){ft.texParameteri(_.target,ft.TEXTURE_MIN_FILTER,_.scaleMode===SCALE_MODES.LINEAR?ft.LINEAR_MIPMAP_LINEAR:ft.NEAREST_MIPMAP_NEAREST);const mt=this.renderer.context.extensions.anisotropicFiltering;if(mt&&_.anisotropicLevel>0&&_.scaleMode===SCALE_MODES.LINEAR){const pt=Math.min(_.anisotropicLevel,ft.getParameter(mt.MAX_TEXTURE_MAX_ANISOTROPY_EXT));ft.texParameterf(_.target,mt.TEXTURE_MAX_ANISOTROPY_EXT,pt)}}else ft.texParameteri(_.target,ft.TEXTURE_MIN_FILTER,_.scaleMode===SCALE_MODES.LINEAR?ft.LINEAR:ft.NEAREST);ft.texParameteri(_.target,ft.TEXTURE_MAG_FILTER,_.scaleMode===SCALE_MODES.LINEAR?ft.LINEAR:ft.NEAREST)}destroy(){this.renderer=null}}TextureSystem.extension={type:ExtensionType.RendererSystem,name:"texture"};extensions$1.add(TextureSystem);class TransformFeedbackSystem{constructor(_){this.renderer=_}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(_){const{gl:lt,CONTEXT_UID:ft}=this,mt=_._glTransformFeedbacks[ft]||this.createGLTransformFeedback(_);lt.bindTransformFeedback(lt.TRANSFORM_FEEDBACK,mt)}unbind(){const{gl:_}=this;_.bindTransformFeedback(_.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(_,lt){const{gl:ft,renderer:mt}=this;lt&&mt.shader.bind(lt),ft.beginTransformFeedback(_)}endTransformFeedback(){const{gl:_}=this;_.endTransformFeedback()}createGLTransformFeedback(_){const{gl:lt,renderer:ft,CONTEXT_UID:mt}=this,pt=lt.createTransformFeedback();_._glTransformFeedbacks[mt]=pt,lt.bindTransformFeedback(lt.TRANSFORM_FEEDBACK,pt);for(let gt=0;gt<_.buffers.length;gt++){const bt=_.buffers[gt];bt&&(ft.buffer.update(bt),bt._glBuffers[mt].refCount++,lt.bindBufferBase(lt.TRANSFORM_FEEDBACK_BUFFER,gt,bt._glBuffers[mt].buffer||null))}return lt.bindTransformFeedback(lt.TRANSFORM_FEEDBACK,null),_.disposeRunner.add(this),pt}disposeTransformFeedback(_,lt){const ft=_._glTransformFeedbacks[this.CONTEXT_UID],mt=this.gl;_.disposeRunner.remove(this);const pt=this.renderer.buffer;if(pt)for(let gt=0;gt<_.buffers.length;gt++){const bt=_.buffers[gt];if(!bt)continue;const wt=bt._glBuffers[this.CONTEXT_UID];wt&&(wt.refCount--,wt.refCount===0&&!lt&&pt.dispose(bt,lt))}ft&&(lt||mt.deleteTransformFeedback(ft),delete _._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}TransformFeedbackSystem.extension={type:ExtensionType.RendererSystem,name:"transformFeedback"};extensions$1.add(TransformFeedbackSystem);class ViewSystem{constructor(_){this.renderer=_}init(_){this.screen=new Rectangle(0,0,_.width,_.height),this.element=_.view||settings.ADAPTER.createCanvas(),this.resolution=_.resolution||settings.RESOLUTION,this.autoDensity=!!_.autoDensity}resizeView(_,lt){this.element.width=Math.round(_*this.resolution),this.element.height=Math.round(lt*this.resolution);const ft=this.element.width/this.resolution,mt=this.element.height/this.resolution;this.screen.width=ft,this.screen.height=mt,this.autoDensity&&(this.element.style.width=`${ft}px`,this.element.style.height=`${mt}px`),this.renderer.emit("resize",ft,mt),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(_){var lt;_&&((lt=this.element.parentNode)==null||lt.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}ViewSystem.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},ViewSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_view"};extensions$1.add(ViewSystem);settings.PREFER_ENV=ENV.WEBGL2;settings.STRICT_TEXTURE_CACHE=!1;settings.RENDER_OPTIONS={...ContextSystem.defaultOptions,...BackgroundSystem.defaultOptions,...ViewSystem.defaultOptions,...StartupSystem.defaultOptions};Object.defineProperties(settings,{WRAP_MODE:{get(){return BaseTexture.defaultOptions.wrapMode},set(it){deprecation("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),BaseTexture.defaultOptions.wrapMode=it}},SCALE_MODE:{get(){return BaseTexture.defaultOptions.scaleMode},set(it){deprecation("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),BaseTexture.defaultOptions.scaleMode=it}},MIPMAP_TEXTURES:{get(){return BaseTexture.defaultOptions.mipmap},set(it){deprecation("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),BaseTexture.defaultOptions.mipmap=it}},ANISOTROPIC_LEVEL:{get(){return BaseTexture.defaultOptions.anisotropicLevel},set(it){deprecation("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),BaseTexture.defaultOptions.anisotropicLevel=it}},FILTER_RESOLUTION:{get(){return deprecation("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Filter.defaultResolution},set(it){Filter.defaultResolution=it}},FILTER_MULTISAMPLE:{get(){return deprecation("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Filter.defaultMultisample},set(it){Filter.defaultMultisample=it}},SPRITE_MAX_TEXTURES:{get(){return BatchRenderer.defaultMaxTextures},set(it){deprecation("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),BatchRenderer.defaultMaxTextures=it}},SPRITE_BATCH_SIZE:{get(){return BatchRenderer.defaultBatchSize},set(it){deprecation("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),BatchRenderer.defaultBatchSize=it}},CAN_UPLOAD_SAME_BUFFER:{get(){return BatchRenderer.canUploadSameBuffer},set(it){deprecation("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),BatchRenderer.canUploadSameBuffer=it}},GC_MODE:{get(){return TextureGCSystem.defaultMode},set(it){deprecation("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),TextureGCSystem.defaultMode=it}},GC_MAX_IDLE:{get(){return TextureGCSystem.defaultMaxIdle},set(it){deprecation("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),TextureGCSystem.defaultMaxIdle=it}},GC_MAX_CHECK_COUNT:{get(){return TextureGCSystem.defaultCheckCountMax},set(it){deprecation("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),TextureGCSystem.defaultCheckCountMax=it}},PRECISION_VERTEX:{get(){return Program.defaultVertexPrecision},set(it){deprecation("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Program.defaultVertexPrecision=it}},PRECISION_FRAGMENT:{get(){return Program.defaultFragmentPrecision},set(it){deprecation("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Program.defaultFragmentPrecision=it}}});var UPDATE_PRIORITY=(it=>(it[it.INTERACTION=50]="INTERACTION",it[it.HIGH=25]="HIGH",it[it.NORMAL=0]="NORMAL",it[it.LOW=-25]="LOW",it[it.UTILITY=-50]="UTILITY",it))(UPDATE_PRIORITY||{});class TickerListener{constructor(_,lt=null,ft=0,mt=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=_,this.context=lt,this.priority=ft,this.once=mt}match(_,lt=null){return this.fn===_&&this.context===lt}emit(_){this.fn&&(this.context?this.fn.call(this.context,_):this.fn(_));const lt=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),lt}connect(_){this.previous=_,_.next&&(_.next.previous=this),this.next=_.next,_.next=this}destroy(_=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const lt=this.next;return this.next=_?null:lt,this.previous=null,lt}}const _Ticker=class qm{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/qm.targetFPMS,this.elapsedMS=1/qm.targetFPMS,this._tick=_=>{this._requestId=null,this.started&&(this.update(_),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(_,lt,ft=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(_,lt,ft))}addOnce(_,lt,ft=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(_,lt,ft,!0))}_addListener(_){let lt=this._head.next,ft=this._head;if(!lt)_.connect(ft);else{for(;lt;){if(_.priority>lt.priority){_.connect(ft);break}ft=lt,lt=lt.next}_.previous||_.connect(ft)}return this._startIfPossible(),this}remove(_,lt){let ft=this._head.next;for(;ft;)ft.match(_,lt)?ft=ft.destroy():ft=ft.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let _=0,lt=this._head;for(;lt=lt.next;)_++;return _}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let _=this._head.next;for(;_;)_=_.destroy(!0);this._head.destroy(),this._head=null}}update(_=performance.now()){let lt;if(_>this.lastTime){if(lt=this.elapsedMS=_-this.lastTime,lt>this._maxElapsedMS&&(lt=this._maxElapsedMS),lt*=this.speed,this._minElapsedMS){const pt=_-this._lastFrame|0;if(pt<this._minElapsedMS)return;this._lastFrame=_-pt%this._minElapsedMS}this.deltaMS=lt,this.deltaTime=this.deltaMS*qm.targetFPMS;const ft=this._head;let mt=ft.next;for(;mt;)mt=mt.emit(this.deltaTime);ft.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=_}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(_){const lt=Math.min(this.maxFPS,_),ft=Math.min(Math.max(0,lt)/1e3,qm.targetFPMS);this._maxElapsedMS=1/ft}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(_){if(_===0)this._minElapsedMS=0;else{const lt=Math.max(this.minFPS,_);this._minElapsedMS=1/(lt/1e3)}}static get shared(){if(!qm._shared){const _=qm._shared=new qm;_.autoStart=!0,_._protected=!0}return qm._shared}static get system(){if(!qm._system){const _=qm._system=new qm;_.autoStart=!0,_._protected=!0}return qm._system}};_Ticker.targetFPMS=.06;let Ticker=_Ticker;Object.defineProperties(settings,{TARGET_FPMS:{get(){return Ticker.targetFPMS},set(it){deprecation("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ticker.targetFPMS=it}}});class TickerPlugin{static init(_){_=Object.assign({autoStart:!0,sharedTicker:!1},_),Object.defineProperty(this,"ticker",{set(lt){this._ticker&&this._ticker.remove(this.render,this),this._ticker=lt,lt&&lt.add(this.render,this,UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=_.sharedTicker?Ticker.shared:new Ticker,_.autoStart&&this.start()}static destroy(){if(this._ticker){const _=this._ticker;this.ticker=null,_.destroy()}}}TickerPlugin.extension=ExtensionType.Application;extensions$1.add(TickerPlugin);const renderers=[];extensions$1.handleByList(ExtensionType.Renderer,renderers);function autoDetectRenderer(it){for(const _ of renderers)if(_.test(it))return new _(it);throw new Error("Unable to auto-detect a suitable renderer.")}var $defaultVertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,$defaultFilterVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const defaultVertex=$defaultVertex,defaultFilterVertex=$defaultFilterVertex;class MultisampleSystem{constructor(_){this.renderer=_}contextChange(_){let lt;if(this.renderer.context.webGLVersion===1){const ft=_.getParameter(_.FRAMEBUFFER_BINDING);_.bindFramebuffer(_.FRAMEBUFFER,null),lt=_.getParameter(_.SAMPLES),_.bindFramebuffer(_.FRAMEBUFFER,ft)}else{const ft=_.getParameter(_.DRAW_FRAMEBUFFER_BINDING);_.bindFramebuffer(_.DRAW_FRAMEBUFFER,null),lt=_.getParameter(_.SAMPLES),_.bindFramebuffer(_.DRAW_FRAMEBUFFER,ft)}lt>=MSAA_QUALITY.HIGH?this.multisample=MSAA_QUALITY.HIGH:lt>=MSAA_QUALITY.MEDIUM?this.multisample=MSAA_QUALITY.MEDIUM:lt>=MSAA_QUALITY.LOW?this.multisample=MSAA_QUALITY.LOW:this.multisample=MSAA_QUALITY.NONE}destroy(){}}MultisampleSystem.extension={type:ExtensionType.RendererSystem,name:"_multisample"};extensions$1.add(MultisampleSystem);class GLBuffer{constructor(_){this.buffer=_||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class BufferSystem{constructor(_){this.renderer=_,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(_){const{gl:lt,CONTEXT_UID:ft}=this,mt=_._glBuffers[ft]||this.createGLBuffer(_);lt.bindBuffer(_.type,mt.buffer)}unbind(_){const{gl:lt}=this;lt.bindBuffer(_,null)}bindBufferBase(_,lt){const{gl:ft,CONTEXT_UID:mt}=this;if(this.boundBufferBases[lt]!==_){const pt=_._glBuffers[mt]||this.createGLBuffer(_);this.boundBufferBases[lt]=_,ft.bindBufferBase(ft.UNIFORM_BUFFER,lt,pt.buffer)}}bindBufferRange(_,lt,ft){const{gl:mt,CONTEXT_UID:pt}=this;ft=ft||0;const gt=_._glBuffers[pt]||this.createGLBuffer(_);mt.bindBufferRange(mt.UNIFORM_BUFFER,lt||0,gt.buffer,ft*256,256)}update(_){const{gl:lt,CONTEXT_UID:ft}=this,mt=_._glBuffers[ft]||this.createGLBuffer(_);if(_._updateID!==mt.updateID)if(mt.updateID=_._updateID,lt.bindBuffer(_.type,mt.buffer),mt.byteLength>=_.data.byteLength)lt.bufferSubData(_.type,0,_.data);else{const pt=_.static?lt.STATIC_DRAW:lt.DYNAMIC_DRAW;mt.byteLength=_.data.byteLength,lt.bufferData(_.type,_.data,pt)}}dispose(_,lt){if(!this.managedBuffers[_.id])return;delete this.managedBuffers[_.id];const ft=_._glBuffers[this.CONTEXT_UID],mt=this.gl;_.disposeRunner.remove(this),ft&&(lt||mt.deleteBuffer(ft.buffer),delete _._glBuffers[this.CONTEXT_UID])}disposeAll(_){const lt=Object.keys(this.managedBuffers);for(let ft=0;ft<lt.length;ft++)this.dispose(this.managedBuffers[lt[ft]],_)}createGLBuffer(_){const{CONTEXT_UID:lt,gl:ft}=this;return _._glBuffers[lt]=new GLBuffer(ft.createBuffer()),this.managedBuffers[_.id]=_,_.disposeRunner.add(this),_._glBuffers[lt]}}BufferSystem.extension={type:ExtensionType.RendererSystem,name:"buffer"};extensions$1.add(BufferSystem);class ObjectRendererSystem{constructor(_){this.renderer=_}render(_,lt){const ft=this.renderer;let mt,pt,gt,bt;if(lt&&(mt=lt.renderTexture,pt=lt.clear,gt=lt.transform,bt=lt.skipUpdateTransform),this.renderingToScreen=!mt,ft.runners.prerender.emit(),ft.emit("prerender"),ft.projection.transform=gt,!ft.context.isLost){if(mt||(this.lastObjectRendered=_),!bt){const wt=_.enableTempParent();_.updateTransform(),_.disableTempParent(wt)}ft.renderTexture.bind(mt),ft.batch.currentRenderer.start(),(pt??ft.background.clearBeforeRender)&&ft.renderTexture.clear(),_.render(ft),ft.batch.currentRenderer.flush(),mt&&(lt.blit&&ft.framebuffer.blit(),mt.baseTexture.update()),ft.runners.postrender.emit(),ft.projection.transform=null,ft.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ObjectRendererSystem.extension={type:ExtensionType.RendererSystem,name:"objectRenderer"};extensions$1.add(ObjectRendererSystem);const _Renderer=class Ky extends SystemManager{constructor(_){super(),this.type=RENDERER_TYPE.WEBGL,_=Object.assign({},settings.RENDER_OPTIONS,_),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0);const lt={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ky.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(lt),"useContextAlpha"in _&&(deprecation("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),_.premultipliedAlpha=_.useContextAlpha&&_.useContextAlpha!=="notMultiplied",_.backgroundAlpha=_.useContextAlpha===!1?1:_.backgroundAlpha),this._plugin.rendererPlugins=Ky.__plugins,this.options=_,this.startup.run(this.options)}static test(_){return _!=null&&_.forceCanvas?!1:isWebGLSupported()}render(_,lt){this.objectRenderer.render(_,lt)}resize(_,lt){this._view.resizeView(_,lt)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(_=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:_}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(_){this._view.resolution=_,this.runners.resolutionChange.emit(_)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return deprecation("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return deprecation("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return deprecation("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(_){deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=_}get backgroundAlpha(){return deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(_){deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=_}get powerPreference(){return deprecation("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(_,lt){return this.textureGenerator.generateTexture(_,lt)}};_Renderer.extension={type:ExtensionType.Renderer,priority:1},_Renderer.__plugins={},_Renderer.__systems={};let Renderer=_Renderer;extensions$1.handleByMap(ExtensionType.RendererPlugin,Renderer.__plugins);extensions$1.handleByMap(ExtensionType.RendererSystem,Renderer.__systems);extensions$1.add(Renderer);class AbstractMultiResource extends Resource{constructor(_,lt){const{width:ft,height:mt}=lt||{};super(ft,mt),this.items=[],this.itemDirtyIds=[];for(let pt=0;pt<_;pt++){const gt=new BaseTexture;this.items.push(gt),this.itemDirtyIds.push(-2)}this.length=_,this._load=null,this.baseTexture=null}initFromArray(_,lt){for(let ft=0;ft<this.length;ft++)_[ft]&&(_[ft].castToBaseTexture?this.addBaseTextureAt(_[ft].castToBaseTexture(),ft):_[ft]instanceof Resource?this.addResourceAt(_[ft],ft):this.addResourceAt(autoDetectResource(_[ft],lt),ft))}dispose(){for(let _=0,lt=this.length;_<lt;_++)this.items[_].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(_,lt){if(!this.items[lt])throw new Error(`Index ${lt} is out of bounds`);return _.valid&&!this.valid&&this.resize(_.width,_.height),this.items[lt].setResource(_),this}bind(_){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(_);for(let lt=0;lt<this.length;lt++)this.items[lt].parentTextureArray=_,this.items[lt].on("update",_.update,_)}unbind(_){super.unbind(_);for(let lt=0;lt<this.length;lt++)this.items[lt].parentTextureArray=null,this.items[lt].off("update",_.update,_)}load(){if(this._load)return this._load;const _=this.items.map(lt=>lt.resource).filter(lt=>lt).map(lt=>lt.load());return this._load=Promise.all(_).then(()=>{const{realWidth:lt,realHeight:ft}=this.items[0];return this.resize(lt,ft),this.update(),Promise.resolve(this)}),this._load}}class ArrayResource extends AbstractMultiResource{constructor(_,lt){const{width:ft,height:mt}=lt||{};let pt,gt;Array.isArray(_)?(pt=_,gt=_.length):gt=_,super(gt,{width:ft,height:mt}),pt&&this.initFromArray(pt,lt)}addBaseTextureAt(_,lt){if(_.resource)this.addResourceAt(_.resource,lt);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(_){super.bind(_),_.target=TARGETS.TEXTURE_2D_ARRAY}upload(_,lt,ft){const{length:mt,itemDirtyIds:pt,items:gt}=this,{gl:bt}=_;ft.dirtyId<0&&bt.texImage3D(bt.TEXTURE_2D_ARRAY,0,ft.internalFormat,this._width,this._height,mt,0,lt.format,ft.type,null);for(let wt=0;wt<mt;wt++){const vt=gt[wt];pt[wt]<vt.dirtyId&&(pt[wt]=vt.dirtyId,vt.valid&&bt.texSubImage3D(bt.TEXTURE_2D_ARRAY,0,0,0,wt,vt.resource.width,vt.resource.height,1,lt.format,ft.type,vt.resource.source))}return!0}}class CanvasResource extends BaseImageResource{constructor(_){super(_)}static test(_){const{OffscreenCanvas:lt}=globalThis;return lt&&_ instanceof lt?!0:globalThis.HTMLCanvasElement&&_ instanceof HTMLCanvasElement}}const _CubeResource=class Ty extends AbstractMultiResource{constructor(_,lt){const{width:ft,height:mt,autoLoad:pt,linkBaseTexture:gt}=lt||{};if(_&&_.length!==Ty.SIDES)throw new Error(`Invalid length. Got ${_.length}, expected 6`);super(6,{width:ft,height:mt});for(let bt=0;bt<Ty.SIDES;bt++)this.items[bt].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+bt;this.linkBaseTexture=gt!==!1,_&&this.initFromArray(_,lt),pt!==!1&&this.load()}bind(_){super.bind(_),_.target=TARGETS.TEXTURE_CUBE_MAP}addBaseTextureAt(_,lt,ft){if(ft===void 0&&(ft=this.linkBaseTexture),!this.items[lt])throw new Error(`Index ${lt} is out of bounds`);if(!this.linkBaseTexture||_.parentTextureArray||Object.keys(_._glTextures).length>0)if(_.resource)this.addResourceAt(_.resource,lt);else throw new Error("CubeResource does not support copying of renderTexture.");else _.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+lt,_.parentTextureArray=this.baseTexture,this.items[lt]=_;return _.valid&&!this.valid&&this.resize(_.realWidth,_.realHeight),this.items[lt]=_,this}upload(_,lt,ft){const mt=this.itemDirtyIds;for(let pt=0;pt<Ty.SIDES;pt++){const gt=this.items[pt];(mt[pt]<gt.dirtyId||ft.dirtyId<lt.dirtyId)&&(gt.valid&&gt.resource?(gt.resource.upload(_,gt,ft),mt[pt]=gt.dirtyId):mt[pt]<-1&&(_.gl.texImage2D(gt.target,0,ft.internalFormat,lt.realWidth,lt.realHeight,0,lt.format,ft.type,null),mt[pt]=-1))}return!0}static test(_){return Array.isArray(_)&&_.length===Ty.SIDES}};_CubeResource.SIDES=6;let CubeResource=_CubeResource;class ImageBitmapResource extends BaseImageResource{constructor(_,lt){lt=lt||{};let ft,mt,pt;typeof _=="string"?(ft=ImageBitmapResource.EMPTY,mt=_,pt=!0):(ft=_,mt=null,pt=!1),super(ft),this.url=mt,this.crossOrigin=lt.crossOrigin??!0,this.alphaMode=typeof lt.alphaMode=="number"?lt.alphaMode:null,this.ownsImageBitmap=lt.ownsImageBitmap??pt,this._load=null,lt.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(_,lt)=>{if(this.url===null){_(this);return}try{const ft=await settings.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const mt=await ft.blob();if(this.destroyed)return;const pt=await createImageBitmap(mt,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"});if(this.destroyed){pt.close();return}this.source=pt,this.update(),_(this)}catch(ft){if(this.destroyed)return;lt(ft),this.onError.emit(ft)}}),this._load)}upload(_,lt,ft){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(lt.alphaMode=this.alphaMode),super.upload(_,lt,ft)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(_){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof _=="string"||_ instanceof ImageBitmap)}static get EMPTY(){return ImageBitmapResource._EMPTY=ImageBitmapResource._EMPTY??settings.ADAPTER.createCanvas(0,0),ImageBitmapResource._EMPTY}}const _SVGResource=class $y extends BaseImageResource{constructor(_,lt){lt=lt||{},super(settings.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=_,this.scale=lt.scale||1,this._overrideWidth=lt.width,this._overrideHeight=lt.height,this._resolve=null,this._crossorigin=lt.crossorigin,this._load=null,lt.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(_=>{if(this._resolve=()=>{this.update(),_(this)},$y.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const _=new Image;BaseImageResource.crossOrigin(_,this.svg,this._crossorigin),_.src=this.svg,_.onerror=lt=>{this._resolve&&(_.onerror=null,this.onError.emit(lt))},_.onload=()=>{if(!this._resolve)return;const lt=_.width,ft=_.height;if(!lt||!ft)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let mt=lt*this.scale,pt=ft*this.scale;(this._overrideWidth||this._overrideHeight)&&(mt=this._overrideWidth||this._overrideHeight/ft*lt,pt=this._overrideHeight||this._overrideWidth/lt*ft),mt=Math.round(mt),pt=Math.round(pt);const gt=this.source;gt.width=mt,gt.height=pt,gt._pixiId=`canvas_${uid()}`,gt.getContext("2d").drawImage(_,0,0,lt,ft,0,0,mt,pt),this._resolve(),this._resolve=null}}static getSize(_){const lt=$y.SVG_SIZE.exec(_),ft={};return lt&&(ft[lt[1]]=Math.round(parseFloat(lt[3])),ft[lt[5]]=Math.round(parseFloat(lt[7]))),ft}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(_,lt){return lt==="svg"||typeof _=="string"&&_.startsWith("data:image/svg+xml")||typeof _=="string"&&$y.SVG_XML.test(_)}};_SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,_SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let SVGResource=_SVGResource;class VideoFrameResource extends BaseImageResource{constructor(_){super(_)}static test(_){return!!globalThis.VideoFrame&&_ instanceof globalThis.VideoFrame}}const _VideoResource=class Zy extends BaseImageResource{constructor(_,lt){if(lt=lt||{},!(_ instanceof HTMLVideoElement)){const ft=document.createElement("video");lt.autoLoad!==!1&&ft.setAttribute("preload","auto"),lt.playsinline!==!1&&(ft.setAttribute("webkit-playsinline",""),ft.setAttribute("playsinline","")),lt.muted===!0&&(ft.setAttribute("muted",""),ft.muted=!0),lt.loop===!0&&ft.setAttribute("loop",""),lt.autoPlay!==!1&&ft.setAttribute("autoplay",""),typeof _=="string"&&(_=[_]);const mt=_[0].src||_[0];BaseImageResource.crossOrigin(ft,mt,lt.crossorigin);for(let pt=0;pt<_.length;++pt){const gt=document.createElement("source");let{src:bt,mime:wt}=_[pt];if(bt=bt||_[pt],bt.startsWith("data:"))wt=bt.slice(5,bt.indexOf(";"));else if(!bt.startsWith("blob:")){const vt=bt.split("?").shift().toLowerCase(),Ct=vt.slice(vt.lastIndexOf(".")+1);wt=wt||Zy.MIME_TYPES[Ct]||`video/${Ct}`}gt.src=bt,wt&&(gt.type=wt),ft.appendChild(gt)}_=ft}super(_),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=lt.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=lt.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),lt.autoLoad!==!1&&this.load()}update(_=0){if(!this.destroyed){if(this._updateFPS){const lt=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-lt)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const _=this.source;return(_.readyState===_.HAVE_ENOUGH_DATA||_.readyState===_.HAVE_FUTURE_DATA)&&_.width&&_.height&&(_.complete=!0),_.addEventListener("play",this._onPlayStart),_.addEventListener("pause",this._onPlayStop),_.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(_.addEventListener("canplay",this._onCanPlay),_.addEventListener("canplaythrough",this._onCanPlay),_.addEventListener("error",this._onError,!0)),this._load=new Promise((lt,ft)=>{this.valid?lt(this):(this._resolve=lt,this._reject=ft,_.load())}),this._load}_onError(_){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(_),this._reject&&(this._reject(_),this._reject=null,this._resolve=null)}_isSourcePlaying(){const _=this.source;return!_.paused&&!_.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const _=this.source;_.removeEventListener("canplay",this._onCanPlay),_.removeEventListener("canplaythrough",this._onCanPlay);const lt=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!lt&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&_.play()}dispose(){this._configureAutoUpdate();const _=this.source;_&&(_.removeEventListener("play",this._onPlayStart),_.removeEventListener("pause",this._onPlayStop),_.removeEventListener("seeked",this._onSeeked),_.removeEventListener("canplay",this._onCanPlay),_.removeEventListener("canplaythrough",this._onCanPlay),_.removeEventListener("error",this._onError,!0),_.pause(),_.src="",_.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(_){_!==this._autoUpdate&&(this._autoUpdate=_,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(_){_!==this._updateFPS&&(this._updateFPS=_,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(_,lt){return globalThis.HTMLVideoElement&&_ instanceof HTMLVideoElement||Zy.TYPES.includes(lt)}};_VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],_VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let VideoResource=_VideoResource;INSTALLED.push(ImageBitmapResource,ImageResource,CanvasResource,VideoResource,VideoFrameResource,SVGResource,BufferResource,CubeResource,ArrayResource);class Bounds{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(_){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:(_=_||new Rectangle(0,0,1,1),_.x=this.minX,_.y=this.minY,_.width=this.maxX-this.minX,_.height=this.maxY-this.minY,_)}addPoint(_){this.minX=Math.min(this.minX,_.x),this.maxX=Math.max(this.maxX,_.x),this.minY=Math.min(this.minY,_.y),this.maxY=Math.max(this.maxY,_.y)}addPointMatrix(_,lt){const{a:ft,b:mt,c:pt,d:gt,tx:bt,ty:wt}=_,vt=ft*lt.x+pt*lt.y+bt,Ct=mt*lt.x+gt*lt.y+wt;this.minX=Math.min(this.minX,vt),this.maxX=Math.max(this.maxX,vt),this.minY=Math.min(this.minY,Ct),this.maxY=Math.max(this.maxY,Ct)}addQuad(_){let lt=this.minX,ft=this.minY,mt=this.maxX,pt=this.maxY,gt=_[0],bt=_[1];lt=gt<lt?gt:lt,ft=bt<ft?bt:ft,mt=gt>mt?gt:mt,pt=bt>pt?bt:pt,gt=_[2],bt=_[3],lt=gt<lt?gt:lt,ft=bt<ft?bt:ft,mt=gt>mt?gt:mt,pt=bt>pt?bt:pt,gt=_[4],bt=_[5],lt=gt<lt?gt:lt,ft=bt<ft?bt:ft,mt=gt>mt?gt:mt,pt=bt>pt?bt:pt,gt=_[6],bt=_[7],lt=gt<lt?gt:lt,ft=bt<ft?bt:ft,mt=gt>mt?gt:mt,pt=bt>pt?bt:pt,this.minX=lt,this.minY=ft,this.maxX=mt,this.maxY=pt}addFrame(_,lt,ft,mt,pt){this.addFrameMatrix(_.worldTransform,lt,ft,mt,pt)}addFrameMatrix(_,lt,ft,mt,pt){const gt=_.a,bt=_.b,wt=_.c,vt=_.d,Ct=_.tx,Rt=_.ty;let Mt=this.minX,Ot=this.minY,Nt=this.maxX,Ht=this.maxY,Kt=gt*lt+wt*ft+Ct,hr=bt*lt+vt*ft+Rt;Mt=Kt<Mt?Kt:Mt,Ot=hr<Ot?hr:Ot,Nt=Kt>Nt?Kt:Nt,Ht=hr>Ht?hr:Ht,Kt=gt*mt+wt*ft+Ct,hr=bt*mt+vt*ft+Rt,Mt=Kt<Mt?Kt:Mt,Ot=hr<Ot?hr:Ot,Nt=Kt>Nt?Kt:Nt,Ht=hr>Ht?hr:Ht,Kt=gt*lt+wt*pt+Ct,hr=bt*lt+vt*pt+Rt,Mt=Kt<Mt?Kt:Mt,Ot=hr<Ot?hr:Ot,Nt=Kt>Nt?Kt:Nt,Ht=hr>Ht?hr:Ht,Kt=gt*mt+wt*pt+Ct,hr=bt*mt+vt*pt+Rt,Mt=Kt<Mt?Kt:Mt,Ot=hr<Ot?hr:Ot,Nt=Kt>Nt?Kt:Nt,Ht=hr>Ht?hr:Ht,this.minX=Mt,this.minY=Ot,this.maxX=Nt,this.maxY=Ht}addVertexData(_,lt,ft){let mt=this.minX,pt=this.minY,gt=this.maxX,bt=this.maxY;for(let wt=lt;wt<ft;wt+=2){const vt=_[wt],Ct=_[wt+1];mt=vt<mt?vt:mt,pt=Ct<pt?Ct:pt,gt=vt>gt?vt:gt,bt=Ct>bt?Ct:bt}this.minX=mt,this.minY=pt,this.maxX=gt,this.maxY=bt}addVertices(_,lt,ft,mt){this.addVerticesMatrix(_.worldTransform,lt,ft,mt)}addVerticesMatrix(_,lt,ft,mt,pt=0,gt=pt){const bt=_.a,wt=_.b,vt=_.c,Ct=_.d,Rt=_.tx,Mt=_.ty;let Ot=this.minX,Nt=this.minY,Ht=this.maxX,Kt=this.maxY;for(let hr=ft;hr<mt;hr+=2){const Qt=lt[hr],mr=lt[hr+1],br=bt*Qt+vt*mr+Rt,Fr=Ct*mr+wt*Qt+Mt;Ot=Math.min(Ot,br-pt),Ht=Math.max(Ht,br+pt),Nt=Math.min(Nt,Fr-gt),Kt=Math.max(Kt,Fr+gt)}this.minX=Ot,this.minY=Nt,this.maxX=Ht,this.maxY=Kt}addBounds(_){const lt=this.minX,ft=this.minY,mt=this.maxX,pt=this.maxY;this.minX=_.minX<lt?_.minX:lt,this.minY=_.minY<ft?_.minY:ft,this.maxX=_.maxX>mt?_.maxX:mt,this.maxY=_.maxY>pt?_.maxY:pt}addBoundsMask(_,lt){const ft=_.minX>lt.minX?_.minX:lt.minX,mt=_.minY>lt.minY?_.minY:lt.minY,pt=_.maxX<lt.maxX?_.maxX:lt.maxX,gt=_.maxY<lt.maxY?_.maxY:lt.maxY;if(ft<=pt&&mt<=gt){const bt=this.minX,wt=this.minY,vt=this.maxX,Ct=this.maxY;this.minX=ft<bt?ft:bt,this.minY=mt<wt?mt:wt,this.maxX=pt>vt?pt:vt,this.maxY=gt>Ct?gt:Ct}}addBoundsMatrix(_,lt){this.addFrameMatrix(lt,_.minX,_.minY,_.maxX,_.maxY)}addBoundsArea(_,lt){const ft=_.minX>lt.x?_.minX:lt.x,mt=_.minY>lt.y?_.minY:lt.y,pt=_.maxX<lt.x+lt.width?_.maxX:lt.x+lt.width,gt=_.maxY<lt.y+lt.height?_.maxY:lt.y+lt.height;if(ft<=pt&&mt<=gt){const bt=this.minX,wt=this.minY,vt=this.maxX,Ct=this.maxY;this.minX=ft<bt?ft:bt,this.minY=mt<wt?mt:wt,this.maxX=pt>vt?pt:vt,this.maxY=gt>Ct?gt:Ct}}pad(_=0,lt=_){this.isEmpty()||(this.minX-=_,this.maxX+=_,this.minY-=lt,this.maxY+=lt)}addFramePad(_,lt,ft,mt,pt,gt){_-=pt,lt-=gt,ft+=pt,mt+=gt,this.minX=this.minX<_?this.minX:_,this.maxX=this.maxX>ft?this.maxX:ft,this.minY=this.minY<lt?this.minY:lt,this.maxY=this.maxY>mt?this.maxY:mt}}class DisplayObject extends EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Transform,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Bounds,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(_){const lt=Object.keys(_);for(let ft=0;ft<lt.length;++ft){const mt=lt[ft];Object.defineProperty(DisplayObject.prototype,mt,Object.getOwnPropertyDescriptor(_,mt))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(_,lt){return _||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),lt||(this._boundsRect||(this._boundsRect=new Rectangle),lt=this._boundsRect),this._bounds.getRectangle(lt)}getLocalBounds(_){_||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),_=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);const lt=this.transform,ft=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(ft==null?void 0:ft.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const mt=this._bounds,pt=this._boundsID;this._bounds=this._localBounds;const gt=this.getBounds(!1,_);return this.parent=ft,this.transform=lt,this._bounds=mt,this._bounds.updateID+=this._boundsID-pt,gt}toGlobal(_,lt,ft=!1){return ft||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(_,lt)}toLocal(_,lt,ft,mt){return lt&&(_=lt.toGlobal(_,ft,mt)),mt||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(_,ft)}setParent(_){if(!_||!_.addChild)throw new Error("setParent: Argument must be a Container");return _.addChild(this),_}removeFromParent(){var _;(_=this.parent)==null||_.removeChild(this)}setTransform(_=0,lt=0,ft=1,mt=1,pt=0,gt=0,bt=0,wt=0,vt=0){return this.position.x=_,this.position.y=lt,this.scale.x=ft||1,this.scale.y=mt||1,this.rotation=pt,this.skew.x=gt,this.skew.y=bt,this.pivot.x=wt,this.pivot.y=vt,this}destroy(_){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent}enableTempParent(){const _=this.parent;return this.parent=this._tempDisplayObjectParent,_}disableTempParent(_){this.parent=_}get x(){return this.position.x}set x(_){this.transform.position.x=_}get y(){return this.position.y}set y(_){this.transform.position.y=_}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(_){this.transform.position.copyFrom(_)}get scale(){return this.transform.scale}set scale(_){this.transform.scale.copyFrom(_)}get pivot(){return this.transform.pivot}set pivot(_){this.transform.pivot.copyFrom(_)}get skew(){return this.transform.skew}set skew(_){this.transform.skew.copyFrom(_)}get rotation(){return this.transform.rotation}set rotation(_){this.transform.rotation=_}get angle(){return this.transform.rotation*RAD_TO_DEG}set angle(_){this.transform.rotation=_*DEG_TO_RAD}get zIndex(){return this._zIndex}set zIndex(_){this._zIndex!==_&&(this._zIndex=_,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let _=this;do{if(!_.visible)return!1;_=_.parent}while(_);return!0}get mask(){return this._mask}set mask(_){if(this._mask!==_){if(this._mask){const lt=this._mask.isMaskData?this._mask.maskObject:this._mask;lt&&(lt._maskRefCount--,lt._maskRefCount===0&&(lt.renderable=!0,lt.isMask=!1))}if(this._mask=_,this._mask){const lt=this._mask.isMaskData?this._mask.maskObject:this._mask;lt&&(lt._maskRefCount===0&&(lt.renderable=!1,lt.isMask=!0),lt._maskRefCount++)}}}}class TemporaryDisplayObject extends DisplayObject{constructor(){super(...arguments),this.sortDirty=null}}DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;const tempMatrix$2=new Matrix;function sortChildren(it,_){return it.zIndex===_.zIndex?it._lastSortedIndex-_._lastSortedIndex:it.zIndex-_.zIndex}const _Container=class Jy extends DisplayObject{constructor(){super(),this.children=[],this.sortableChildren=Jy.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(_){}addChild(..._){if(_.length>1)for(let lt=0;lt<_.length;lt++)this.addChild(_[lt]);else{const lt=_[0];lt.parent&&lt.parent.removeChild(lt),lt.parent=this,this.sortDirty=!0,lt.transform._parentID=-1,this.children.push(lt),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",lt,this,this.children.length-1),lt.emit("added",this)}return _[0]}addChildAt(_,lt){if(lt<0||lt>this.children.length)throw new Error(`${_}addChildAt: The index ${lt} supplied is out of bounds ${this.children.length}`);return _.parent&&_.parent.removeChild(_),_.parent=this,this.sortDirty=!0,_.transform._parentID=-1,this.children.splice(lt,0,_),this._boundsID++,this.onChildrenChange(lt),_.emit("added",this),this.emit("childAdded",_,this,lt),_}swapChildren(_,lt){if(_===lt)return;const ft=this.getChildIndex(_),mt=this.getChildIndex(lt);this.children[ft]=lt,this.children[mt]=_,this.onChildrenChange(ft<mt?ft:mt)}getChildIndex(_){const lt=this.children.indexOf(_);if(lt===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return lt}setChildIndex(_,lt){if(lt<0||lt>=this.children.length)throw new Error(`The index ${lt} supplied is out of bounds ${this.children.length}`);const ft=this.getChildIndex(_);removeItems(this.children,ft,1),this.children.splice(lt,0,_),this.onChildrenChange(lt)}getChildAt(_){if(_<0||_>=this.children.length)throw new Error(`getChildAt: Index (${_}) does not exist.`);return this.children[_]}removeChild(..._){if(_.length>1)for(let lt=0;lt<_.length;lt++)this.removeChild(_[lt]);else{const lt=_[0],ft=this.children.indexOf(lt);if(ft===-1)return null;lt.parent=null,lt.transform._parentID=-1,removeItems(this.children,ft,1),this._boundsID++,this.onChildrenChange(ft),lt.emit("removed",this),this.emit("childRemoved",lt,this,ft)}return _[0]}removeChildAt(_){const lt=this.getChildAt(_);return lt.parent=null,lt.transform._parentID=-1,removeItems(this.children,_,1),this._boundsID++,this.onChildrenChange(_),lt.emit("removed",this),this.emit("childRemoved",lt,this,_),lt}removeChildren(_=0,lt=this.children.length){const ft=_,mt=lt,pt=mt-ft;let gt;if(pt>0&&pt<=mt){gt=this.children.splice(ft,pt);for(let bt=0;bt<gt.length;++bt)gt[bt].parent=null,gt[bt].transform&&(gt[bt].transform._parentID=-1);this._boundsID++,this.onChildrenChange(_);for(let bt=0;bt<gt.length;++bt)gt[bt].emit("removed",this),this.emit("childRemoved",gt[bt],this,bt);return gt}else if(pt===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let _=!1;for(let lt=0,ft=this.children.length;lt<ft;++lt){const mt=this.children[lt];mt._lastSortedIndex=lt,!_&&mt.zIndex!==0&&(_=!0)}_&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let _=0,lt=this.children.length;_<lt;++_){const ft=this.children[_];ft.visible&&ft.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let _=0;_<this.children.length;_++){const lt=this.children[_];if(!(!lt.visible||!lt.renderable))if(lt.calculateBounds(),lt._mask){const ft=lt._mask.isMaskData?lt._mask.maskObject:lt._mask;ft?(ft.calculateBounds(),this._bounds.addBoundsMask(lt._bounds,ft._bounds)):this._bounds.addBounds(lt._bounds)}else lt.filterArea?this._bounds.addBoundsArea(lt._bounds,lt.filterArea):this._bounds.addBounds(lt._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(_,lt=!1){const ft=super.getLocalBounds(_);if(!lt)for(let mt=0,pt=this.children.length;mt<pt;++mt){const gt=this.children[mt];gt.visible&&gt.updateTransform()}return ft}_calculateBounds(){}_renderWithCulling(_){const lt=_.renderTexture.sourceFrame;if(!(lt.width>0&&lt.height>0))return;let ft,mt;this.cullArea?(ft=this.cullArea,mt=this.worldTransform):this._render!==Jy.prototype._render&&(ft=this.getBounds(!0));const pt=_.projection.transform;if(pt&&(mt?(mt=tempMatrix$2.copyFrom(mt),mt.prepend(pt)):mt=pt),ft&&lt.intersects(ft,mt))this._render(_);else if(this.cullArea)return;for(let gt=0,bt=this.children.length;gt<bt;++gt){const wt=this.children[gt],vt=wt.cullable;wt.cullable=vt||!this.cullArea,wt.render(_),wt.cullable=vt}}render(_){var lt;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(lt=this.filters)!=null&&lt.length)this.renderAdvanced(_);else if(this.cullable)this._renderWithCulling(_);else{this._render(_);for(let ft=0,mt=this.children.length;ft<mt;++ft)this.children[ft].render(_)}}renderAdvanced(_){var pt,gt,bt;const lt=this.filters,ft=this._mask;if(lt){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let wt=0;wt<lt.length;wt++)lt[wt].enabled&&this._enabledFilters.push(lt[wt])}const mt=lt&&((pt=this._enabledFilters)==null?void 0:pt.length)||ft&&(!ft.isMaskData||ft.enabled&&(ft.autoDetect||ft.type!==MASK_TYPES.NONE));if(mt&&_.batch.flush(),lt&&((gt=this._enabledFilters)!=null&&gt.length)&&_.filter.push(this,this._enabledFilters),ft&&_.mask.push(this,this._mask),this.cullable)this._renderWithCulling(_);else{this._render(_);for(let wt=0,vt=this.children.length;wt<vt;++wt)this.children[wt].render(_)}mt&&_.batch.flush(),ft&&_.mask.pop(this),lt&&((bt=this._enabledFilters)!=null&&bt.length)&&_.filter.pop()}_render(_){}destroy(_){super.destroy(),this.sortDirty=!1;const lt=typeof _=="boolean"?_:_==null?void 0:_.children,ft=this.removeChildren(0,this.children.length);if(lt)for(let mt=0;mt<ft.length;++mt)ft[mt].destroy(_)}get width(){return this.scale.x*this.getLocalBounds().width}set width(_){const lt=this.getLocalBounds().width;lt!==0?this.scale.x=_/lt:this.scale.x=1,this._width=_}get height(){return this.scale.y*this.getLocalBounds().height}set height(_){const lt=this.getLocalBounds().height;lt!==0?this.scale.y=_/lt:this.scale.y=1,this._height=_}};_Container.defaultSortableChildren=!1;let Container=_Container;Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;Object.defineProperties(settings,{SORTABLE_CHILDREN:{get(){return Container.defaultSortableChildren},set(it){deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Container.defaultSortableChildren=it}}});var __defProp=Object.defineProperty,__pow=Math.pow,__defNormalProp=(it,_,lt)=>_ in it?__defProp(it,_,{enumerable:!0,configurable:!0,writable:!0,value:lt}):it[_]=lt,__publicField=(it,_,lt)=>(__defNormalProp(it,typeof _!="symbol"?_+"":_,lt),lt),__async=(it,_,lt)=>new Promise((ft,mt)=>{var pt=wt=>{try{bt(lt.next(wt))}catch(vt){mt(vt)}},gt=wt=>{try{bt(lt.throw(wt))}catch(vt){mt(vt)}},bt=wt=>wt.done?ft(wt.value):Promise.resolve(wt.value).then(pt,gt);bt((lt=lt.apply(it,_)).next())});const LOGICAL_WIDTH=2,LOGICAL_HEIGHT=2;var CubismConfig;(it=>{it.supportMoreMaskDivisions=!0,it.setOpacityFromMotion=!1})(CubismConfig||(CubismConfig={}));const LOG_LEVEL_VERBOSE=0,LOG_LEVEL_WARNING=1,LOG_LEVEL_ERROR=2,LOG_LEVEL_NONE=999,config={LOG_LEVEL_VERBOSE,LOG_LEVEL_WARNING,LOG_LEVEL_ERROR,LOG_LEVEL_NONE,logLevel:LOG_LEVEL_WARNING,sound:!0,motionSync:!0,motionFadingDuration:500,idleMotionFadingDuration:2e3,expressionFadingDuration:500,preserveExpressionOnMotion:!0,cubism4:CubismConfig},logger={log(it,..._){},warn(it,..._){console.warn(`[${it}]`,..._)},error(it,..._){console.error(`[${it}]`,..._)}};function clamp(it,_,lt){return it<_?_:it>lt?lt:it}function rand(it,_){return Math.random()*(_-it)+it}function copyProperty(it,_,lt,ft,mt){const pt=_[ft];pt!==null&&typeof pt===it&&(lt[mt]=pt)}function copyArray(it,_,lt,ft,mt){const pt=_[ft];Array.isArray(pt)&&(lt[mt]=pt.filter(gt=>gt!==null&&typeof gt===it))}function applyMixins(it,_){_.forEach(lt=>{Object.getOwnPropertyNames(lt.prototype).forEach(ft=>{ft!=="constructor"&&Object.defineProperty(it.prototype,ft,Object.getOwnPropertyDescriptor(lt.prototype,ft))})})}function folderName(it){let _=it.lastIndexOf("/");return _!=-1&&(it=it.slice(0,_)),_=it.lastIndexOf("/"),_!==-1&&(it=it.slice(_+1)),it}function remove(it,_){const lt=it.indexOf(_);lt!==-1&&it.splice(lt,1)}class ExpressionManager extends EventEmitter{constructor(_,lt){super(),__publicField(this,"tag"),__publicField(this,"settings"),__publicField(this,"expressions",[]),__publicField(this,"defaultExpression"),__publicField(this,"currentExpression"),__publicField(this,"reserveExpressionIndex",-1),__publicField(this,"destroyed",!1),this.settings=_,this.tag=`ExpressionManager(${_.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(_){return __async(this,null,function*(){if(!this.definitions[_]){logger.warn(this.tag,`Undefined expression at [${_}]`);return}if(this.expressions[_]===null){logger.warn(this.tag,`Cannot set expression at [${_}] because it's already failed in loading.`);return}if(this.expressions[_])return this.expressions[_];const lt=yield this._loadExpression(_);return this.expressions[_]=lt,lt})}_loadExpression(_){throw new Error("Not implemented.")}setRandomExpression(){return __async(this,null,function*(){if(this.definitions.length){const _=[];for(let lt=0;lt<this.definitions.length;lt++)this.expressions[lt]!==null&&this.expressions[lt]!==this.currentExpression&&lt!==this.reserveExpressionIndex&&_.push(lt);if(_.length){const lt=Math.floor(Math.random()*_.length);return this.setExpression(lt)}}return!1})}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(_){return __async(this,null,function*(){if(typeof _!="number"&&(_=this.getExpressionIndex(_)),!(_>-1&&_<this.definitions.length)||_===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=_;const lt=yield this.loadExpression(_);return!lt||this.reserveExpressionIndex!==_?!1:(this.reserveExpressionIndex=-1,this.currentExpression=lt,this._setExpression(lt),!0)})}update(_,lt){return this.isFinished()?!1:this.updateParameters(_,lt)}destroy(){this.destroyed=!0,this.emit("destroy");const _=this;_.definitions=void 0,_.expressions=void 0}}const EPSILON=.01,MAX_SPEED=40/7.5,ACCELERATION_TIME=1/(.15*1e3);class FocusController{constructor(){__publicField(this,"targetX",0),__publicField(this,"targetY",0),__publicField(this,"x",0),__publicField(this,"y",0),__publicField(this,"vx",0),__publicField(this,"vy",0)}focus(_,lt,ft=!1){this.targetX=clamp(_,-1,1),this.targetY=clamp(lt,-1,1),ft&&(this.x=this.targetX,this.y=this.targetY)}update(_){const lt=this.targetX-this.x,ft=this.targetY-this.y;if(Math.abs(lt)<EPSILON&&Math.abs(ft)<EPSILON)return;const mt=Math.sqrt(__pow(lt,2)+__pow(ft,2)),pt=MAX_SPEED/(1e3/_);let gt=pt*(lt/mt)-this.vx,bt=pt*(ft/mt)-this.vy;const wt=Math.sqrt(__pow(gt,2)+__pow(bt,2)),vt=pt*ACCELERATION_TIME*_;wt>vt&&(gt*=vt/wt,bt*=vt/wt),this.vx+=gt,this.vy+=bt;const Ct=Math.sqrt(__pow(this.vx,2)+__pow(this.vy,2)),Rt=.5*(Math.sqrt(__pow(vt,2)+8*vt*mt)-vt);Ct>Rt&&(this.vx*=Rt/Ct,this.vy*=Rt/Ct),this.x+=this.vx,this.y+=this.vy}}class ModelSettings{constructor(_){__publicField(this,"json"),__publicField(this,"name"),__publicField(this,"url"),__publicField(this,"pose"),__publicField(this,"physics"),this.json=_;const lt=_.url;if(typeof lt!="string")throw new TypeError("The `url` field in settings JSON must be defined as a string.");this.url=lt,this.name=folderName(this.url)}resolveURL(_){return url.resolve(this.url,_)}replaceFiles(_){this.moc=_(this.moc,"moc"),this.pose!==void 0&&(this.pose=_(this.pose,"pose")),this.physics!==void 0&&(this.physics=_(this.physics,"physics"));for(let lt=0;lt<this.textures.length;lt++)this.textures[lt]=_(this.textures[lt],`textures[${lt}]`)}getDefinedFiles(){const _=[];return this.replaceFiles(lt=>(_.push(lt),lt)),_}validateFiles(_){const lt=(pt,gt)=>{const bt=this.resolveURL(pt);if(!_.includes(bt)){if(gt)throw new Error(`File "${pt}" is defined in settings, but doesn't exist in given files`);return!1}return!0};return[this.moc,...this.textures].forEach(pt=>lt(pt,!0)),this.getDefinedFiles().filter(pt=>lt(pt,!1))}}var MotionPriority=(it=>(it[it.NONE=0]="NONE",it[it.IDLE=1]="IDLE",it[it.NORMAL=2]="NORMAL",it[it.FORCE=3]="FORCE",it))(MotionPriority||{});class MotionState{constructor(){__publicField(this,"tag"),__publicField(this,"debug",!1),__publicField(this,"currentPriority",0),__publicField(this,"reservePriority",0),__publicField(this,"currentGroup"),__publicField(this,"currentIndex"),__publicField(this,"reservedGroup"),__publicField(this,"reservedIndex"),__publicField(this,"reservedIdleGroup"),__publicField(this,"reservedIdleIndex")}reserve(_,lt,ft){if(ft<=0)return logger.log(this.tag,"Cannot start a motion with MotionPriority.NONE."),!1;if(_===this.currentGroup&&lt===this.currentIndex)return logger.log(this.tag,"Motion is already playing.",this.dump(_,lt)),!1;if(_===this.reservedGroup&&lt===this.reservedIndex||_===this.reservedIdleGroup&&lt===this.reservedIdleIndex)return logger.log(this.tag,"Motion is already reserved.",this.dump(_,lt)),!1;if(ft===1){if(this.currentPriority!==0)return logger.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(_,lt)),!1;if(this.reservedIdleGroup!==void 0)return logger.log(this.tag,"Cannot start idle motion because another idle motion has reserved.",this.dump(_,lt)),!1;this.setReservedIdle(_,lt)}else{if(ft<3){if(ft<=this.currentPriority)return logger.log(this.tag,"Cannot start motion because another motion is playing as an equivalent or higher priority.",this.dump(_,lt)),!1;if(ft<=this.reservePriority)return logger.log(this.tag,"Cannot start motion because another motion has reserved as an equivalent or higher priority.",this.dump(_,lt)),!1}this.setReserved(_,lt,ft)}return!0}start(_,lt,ft,mt){if(mt===1){if(this.setReservedIdle(void 0,void 0),this.currentPriority!==0)return logger.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(lt,ft)),!1}else{if(lt!==this.reservedGroup||ft!==this.reservedIndex)return logger.log(this.tag,"Cannot start motion because another motion has taken the place.",this.dump(lt,ft)),!1;this.setReserved(void 0,void 0,0)}return _?(this.setCurrent(lt,ft,mt),!0):!1}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(_,lt,ft){this.currentPriority=ft,this.currentGroup=_,this.currentIndex=lt}setReserved(_,lt,ft){this.reservePriority=ft,this.reservedGroup=_,this.reservedIndex=lt}setReservedIdle(_,lt){this.reservedIdleGroup=_,this.reservedIdleIndex=lt}isActive(_,lt){return _===this.currentGroup&&lt===this.currentIndex||_===this.reservedGroup&&lt===this.reservedIndex||_===this.reservedIdleGroup&&lt===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return this.currentGroup===void 0&&this.reservedIdleGroup===void 0}shouldOverrideExpression(){return!config.preserveExpressionOnMotion}dump(_,lt){if(this.debug){const ft=["currentPriority","reservePriority","currentGroup","currentIndex","reservedGroup","reservedIndex","reservedIdleGroup","reservedIdleIndex"];return`
<Requested> group = "${_}", index = ${lt}
`+ft.map(mt=>"["+mt+"] "+this[mt]).join(`
`)}return""}}const TAG$2="SoundManager",VOLUME=.5;class SoundManager{static get volume(){return this._volume}static set volume(_){this._volume=(_>1?1:_<0?0:_)||0,this.audios.forEach(lt=>lt.volume=this._volume)}static add(_,lt,ft,mt){const pt=new Audio(_);return pt.volume=this._volume,pt.preload="auto",pt.crossOrigin=mt,pt.addEventListener("ended",()=>{this.dispose(pt),lt==null||lt()}),pt.addEventListener("error",gt=>{this.dispose(pt),logger.warn(TAG$2,`Error occurred on "${_}"`,gt.error),ft==null||ft(gt.error)}),this.audios.push(pt),pt}static play(_){return new Promise((lt,ft)=>{var mt;(mt=_.play())==null||mt.catch(pt=>{_.dispatchEvent(new ErrorEvent("error",{error:pt})),ft(pt)}),_.readyState===_.HAVE_ENOUGH_DATA?lt():_.addEventListener("canplaythrough",lt)})}static addContext(_){const lt=new AudioContext;return this.contexts.push(lt),lt}static addAnalyzer(_,lt){const ft=lt.createMediaElementSource(_),mt=lt.createAnalyser();return mt.fftSize=256,mt.minDecibels=-90,mt.maxDecibels=-10,mt.smoothingTimeConstant=.85,ft.connect(mt),mt.connect(lt.destination),this.analysers.push(mt),mt}static analyze(_){if(_!=null){const lt=new Float32Array(_.fftSize);let ft=0;_.getFloatTimeDomainData(lt);for(const mt of lt)ft+=mt*mt;return parseFloat(Math.sqrt(ft/lt.length*20).toFixed(1))}else return parseFloat(Math.random().toFixed(1))}static dispose(_){_.pause(),_.removeAttribute("src"),remove(this.audios,_)}static destroy(){for(let _=this.contexts.length-1;_>=0;_--)this.contexts[_].close();for(let _=this.audios.length-1;_>=0;_--)this.dispose(this.audios[_])}}__publicField(SoundManager,"audios",[]);__publicField(SoundManager,"analysers",[]);__publicField(SoundManager,"contexts",[]);__publicField(SoundManager,"_volume",VOLUME);class MotionManager extends EventEmitter{constructor(_,lt){super(),__publicField(this,"tag"),__publicField(this,"settings"),__publicField(this,"motionGroups",{}),__publicField(this,"state",new MotionState),__publicField(this,"currentAudio"),__publicField(this,"currentAnalyzer"),__publicField(this,"currentContext"),__publicField(this,"playing",!1),__publicField(this,"destroyed",!1),this.settings=_,this.tag=`MotionManager(${_.name})`,this.state.tag=this.tag}init(_){_!=null&&_.idleMotionGroup&&(this.groups.idle=_.idleMotionGroup),this.setupMotions(_),this.stopAllMotions()}setupMotions(_){for(const ft of Object.keys(this.definitions))this.motionGroups[ft]=[];let lt;switch(_==null?void 0:_.motionPreload){case"NONE":return;case"ALL":lt=Object.keys(this.definitions);break;case"IDLE":default:lt=[this.groups.idle];break}for(const ft of lt)if(this.definitions[ft])for(let mt=0;mt<this.definitions[ft].length;mt++)this.loadMotion(ft,mt).then()}loadMotion(_,lt){return __async(this,null,function*(){var ft;if(!((ft=this.definitions[_])!=null&&ft[lt])){logger.warn(this.tag,`Undefined motion at "${_}"[${lt}]`);return}if(this.motionGroups[_][lt]===null){logger.warn(this.tag,`Cannot start motion at "${_}"[${lt}] because it's already failed in loading.`);return}if(this.motionGroups[_][lt])return this.motionGroups[_][lt];const mt=yield this._loadMotion(_,lt);if(!this.destroyed)return this.motionGroups[_][lt]=mt??null,mt})}_loadMotion(_,lt){throw new Error("Not implemented.")}speak(_){return __async(this,arguments,function*(lt,{volume:ft=VOLUME,expression:mt,resetExpression:pt=!0,crossOrigin:gt,onFinish:bt,onError:wt}={}){let vt,Ct,Rt;if(this.currentAudio&&!this.currentAudio.ended)return!1;let Mt;const Ot=lt&&lt.startsWith("data:");if(console.log(bt),lt&&!Ot){const Ht=document.createElement("a");Ht.href=lt,lt=Ht.href,Mt=lt}else Mt="data:audio/";const Nt=lt;if(Nt)try{vt=SoundManager.add(Nt,(Ht=this)=>{console.log("Audio finished playing"),bt==null||bt(),pt&&mt&&Ht.expressionManager&&Ht.expressionManager.resetExpression(),Ht.currentAudio=void 0},(Ht,Kt=this)=>{console.log("Error during audio playback:",Ht),wt==null||wt(Ht),pt&&mt&&Kt.expressionManager&&Kt.expressionManager.resetExpression(),Kt.currentAudio=void 0},gt),this.currentAudio=vt,SoundManager.volume=ft,Rt=SoundManager.addContext(this.currentAudio),this.currentContext=Rt,Ct=SoundManager.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=Ct}catch(Ht){return logger.warn(this.tag,"Failed to create audio",Mt,Ht),!1}if(vt){let Ht=!0;if(yield SoundManager.play(vt).catch(hr=>{logger.warn(this.tag,"Failed to play audio",vt.src,hr),Ht=!1}),!Ht)return!1}return this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),mt&&this.expressionManager&&this.expressionManager.setExpression(mt),this.playing=!0,!0})}startMotion(_,lt){return __async(this,arguments,function*(ft,mt,pt=MotionPriority.NORMAL,{sound:gt=void 0,volume:bt=VOLUME,expression:wt=void 0,resetExpression:vt=!0,crossOrigin:Ct,onFinish:Rt,onError:Mt}={}){var Ot;if(!this.state.reserve(ft,mt,pt)||this.currentAudio&&!this.currentAudio.ended&&pt!=MotionPriority.FORCE)return!1;const Nt=(Ot=this.definitions[ft])==null?void 0:Ot[mt];if(!Nt)return!1;this.currentAudio&&SoundManager.dispose(this.currentAudio);let Ht,Kt,hr,Qt;const mr=gt&&gt.startsWith("data:");if(gt&&!mr){const kr=document.createElement("a");kr.href=gt,gt=kr.href,Qt=gt}else Qt=this.getSoundFile(Nt),Qt&&(Qt=this.settings.resolveURL(Qt));const br=Qt;if(br)try{Ht=SoundManager.add(br,(kr=this)=>{console.log("Audio finished playing"),Rt==null||Rt(),console.log(Rt),vt&&wt&&kr.expressionManager&&kr.expressionManager.resetExpression(),kr.currentAudio=void 0},(kr,Br=this)=>{console.log("Error during audio playback:",kr),Mt==null||Mt(kr),vt&&wt&&Br.expressionManager&&Br.expressionManager.resetExpression(),Br.currentAudio=void 0},Ct),this.currentAudio=Ht,SoundManager.volume=bt,hr=SoundManager.addContext(this.currentAudio),this.currentContext=hr,Kt=SoundManager.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=Kt}catch(kr){logger.warn(this.tag,"Failed to create audio",Qt,kr)}const Fr=yield this.loadMotion(ft,mt);return Ht&&(yield SoundManager.play(Ht).catch(Br=>logger.warn(this.tag,"Failed to play audio",Ht.src,Br))),this.state.start(Fr,ft,mt,pt)?(this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),logger.log(this.tag,"Start motion:",this.getMotionName(Nt)),this.emit("motionStart",ft,mt,Ht),wt&&this.expressionManager&&this.state.shouldOverrideExpression()&&this.expressionManager.setExpression(wt),this.playing=!0,this._startMotion(Fr),!0):(Ht&&(SoundManager.dispose(Ht),this.currentAudio=void 0),!1)})}startRandomMotion(_,lt){return __async(this,arguments,function*(ft,mt,{sound:pt,volume:gt=VOLUME,expression:bt,resetExpression:wt=!0,crossOrigin:vt,onFinish:Ct,onError:Rt}={}){const Mt=this.definitions[ft];if(Mt!=null&&Mt.length){const Ot=[];for(let Nt=0;Nt<Mt.length;Nt++)this.motionGroups[ft][Nt]!==null&&!this.state.isActive(ft,Nt)&&Ot.push(Nt);if(Ot.length){const Nt=Ot[Math.floor(Math.random()*Ot.length)];return this.startMotion(ft,Nt,mt,{sound:pt,volume:gt,expression:bt,resetExpression:wt,crossOrigin:vt,onFinish:Ct,onError:Rt})}}return!1})}stopSpeaking(){this.currentAudio&&(SoundManager.dispose(this.currentAudio),this.currentAudio=void 0)}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.stopSpeaking()}update(_,lt){var ft;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.shouldOverrideExpression()&&((ft=this.expressionManager)==null||ft.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,MotionPriority.IDLE)),this.updateParameters(_,lt)}mouthSync(){return this.currentAnalyzer?SoundManager.analyze(this.currentAnalyzer):0}destroy(){var _;this.destroyed=!0,this.emit("destroy"),this.stopAllMotions(),(_=this.expressionManager)==null||_.destroy();const lt=this;lt.definitions=void 0,lt.motionGroups=void 0}}const tempBounds={x:0,y:0,width:0,height:0};class InternalModel extends EventEmitter{constructor(){super(...arguments),__publicField(this,"focusController",new FocusController),__publicField(this,"pose"),__publicField(this,"physics"),__publicField(this,"originalWidth",0),__publicField(this,"originalHeight",0),__publicField(this,"width",0),__publicField(this,"height",0),__publicField(this,"localTransform",new Matrix),__publicField(this,"drawingMatrix",new Matrix),__publicField(this,"hitAreas",{}),__publicField(this,"textureFlipY",!1),__publicField(this,"viewport",[0,0,0,0]),__publicField(this,"destroyed",!1)}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const _=this,lt=this.getSize();_.originalWidth=lt[0],_.originalHeight=lt[1];const ft=Object.assign({width:LOGICAL_WIDTH,height:LOGICAL_HEIGHT},this.getLayout());this.localTransform.scale(ft.width/LOGICAL_WIDTH,ft.height/LOGICAL_HEIGHT),_.width=this.originalWidth*this.localTransform.a,_.height=this.originalHeight*this.localTransform.d;const mt=ft.x!==void 0&&ft.x-ft.width/2||ft.centerX!==void 0&&ft.centerX||ft.left!==void 0&&ft.left-ft.width/2||ft.right!==void 0&&ft.right+ft.width/2||0,pt=ft.y!==void 0&&ft.y-ft.height/2||ft.centerY!==void 0&&ft.centerY||ft.top!==void 0&&ft.top-ft.height/2||ft.bottom!==void 0&&ft.bottom+ft.height/2||0;this.localTransform.translate(this.width*mt,-this.height*pt)}setupHitAreas(){const _=this.getHitAreaDefs().filter(lt=>lt.index>=0);for(const lt of _)this.hitAreas[lt.name]=lt}hitTest(_,lt){return Object.keys(this.hitAreas).filter(ft=>this.isHit(ft,_,lt))}isHit(_,lt,ft){if(!this.hitAreas[_])return!1;const mt=this.hitAreas[_].index,pt=this.getDrawableBounds(mt,tempBounds);return pt.x<=lt&&lt<=pt.x+pt.width&&pt.y<=ft&&ft<=pt.y+pt.height}getDrawableBounds(_,lt){const ft=this.getDrawableVertices(_);let mt=ft[0],pt=ft[0],gt=ft[1],bt=ft[1];for(let wt=0;wt<ft.length;wt+=2){const vt=ft[wt],Ct=ft[wt+1];mt=Math.min(vt,mt),pt=Math.max(vt,pt),gt=Math.min(Ct,gt),bt=Math.max(Ct,bt)}return lt??(lt={}),lt.x=mt,lt.y=gt,lt.width=pt-mt,lt.height=bt-gt,lt}updateTransform(_){this.drawingMatrix.copyFrom(_).append(this.localTransform)}update(_,lt){this.focusController.update(_)}destroy(){this.destroyed=!0,this.emit("destroy"),this.motionManager.destroy(),this.motionManager=void 0}}const TAG$1="XHRLoader";class NetworkError extends Error{constructor(_,lt,ft,mt=!1){super(_),this.url=lt,this.status=ft,this.aborted=mt}}const _XHRLoader=class Ym{static createXHR(_,lt,ft,mt,pt){const gt=new XMLHttpRequest;if(Ym.allXhrSet.add(gt),_){let bt=Ym.xhrMap.get(_);bt?bt.add(gt):(bt=new Set([gt]),Ym.xhrMap.set(_,bt)),_.listeners("destroy").includes(Ym.cancelXHRs)||_.once("destroy",Ym.cancelXHRs)}return gt.open("GET",lt),gt.responseType=ft,gt.onload=()=>{(gt.status===200||gt.status===0)&&gt.response?mt(gt.response):gt.onerror()},gt.onerror=()=>{logger.warn(TAG$1,`Failed to load resource as ${gt.responseType} (Status ${gt.status}): ${lt}`),pt(new NetworkError("Network error.",lt,gt.status))},gt.onabort=()=>pt(new NetworkError("Aborted.",lt,gt.status,!0)),gt.onloadend=()=>{var bt;Ym.allXhrSet.delete(gt),_&&((bt=Ym.xhrMap.get(_))==null||bt.delete(gt))},gt}static cancelXHRs(){var _;(_=Ym.xhrMap.get(this))==null||_.forEach(lt=>{lt.abort(),Ym.allXhrSet.delete(lt)}),Ym.xhrMap.delete(this)}static release(){Ym.allXhrSet.forEach(_=>_.abort()),Ym.allXhrSet.clear(),Ym.xhrMap=new WeakMap}};__publicField(_XHRLoader,"xhrMap",new WeakMap);__publicField(_XHRLoader,"allXhrSet",new Set);__publicField(_XHRLoader,"loader",(it,_)=>new Promise((lt,ft)=>{_XHRLoader.createXHR(it.target,it.settings?it.settings.resolveURL(it.url):it.url,it.type,pt=>{it.result=pt,lt()},ft).send()}));let XHRLoader=_XHRLoader;function runMiddlewares(it,_){let lt=-1;return ft(0);function ft(mt,pt){if(pt)return Promise.reject(pt);if(mt<=lt)return Promise.reject(new Error("next() called multiple times"));lt=mt;const gt=it[mt];if(!gt)return Promise.resolve();try{return Promise.resolve(gt(_,ft.bind(null,mt+1)))}catch(bt){return Promise.reject(bt)}}}class Live2DLoader{static load(_){return runMiddlewares(this.middlewares,_).then(()=>_.result)}}__publicField(Live2DLoader,"middlewares",[XHRLoader.loader]);function createTexture$1(it,_={}){var lt;const ft={resourceOptions:{crossorigin:_.crossOrigin}};if(Texture.fromURL)return Texture.fromURL(it,ft).catch(gt=>{if(gt instanceof Error)throw gt;const bt=new Error("Texture loading error");throw bt.event=gt,bt});ft.resourceOptions.autoLoad=!1;const mt=Texture.from(it,ft);if(mt.baseTexture.valid)return Promise.resolve(mt);const pt=mt.baseTexture.resource;return(lt=pt._live2d_load)!=null||(pt._live2d_load=new Promise((gt,bt)=>{const wt=vt=>{pt.source.removeEventListener("error",wt);const Ct=new Error("Texture loading error");Ct.event=vt,bt(Ct)};pt.source.addEventListener("error",wt),pt.load().then(()=>gt(mt)).catch(wt)})),pt._live2d_load}function noop(){}const TAG="Live2DFactory",urlToJSON=(it,_)=>__async(void 0,null,function*(){if(typeof it.source=="string"){const lt=yield Live2DLoader.load({url:it.source,type:"json",target:it.live2dModel});lt.url=it.source,it.source=lt,it.live2dModel.emit("settingsJSONLoaded",lt)}return _()}),jsonToSettings=(it,_)=>__async(void 0,null,function*(){if(it.source instanceof ModelSettings)return it.settings=it.source,_();if(typeof it.source=="object"){const lt=Live2DFactory.findRuntime(it.source);if(lt){const ft=lt.createModelSettings(it.source);return it.settings=ft,it.live2dModel.emit("settingsLoaded",ft),_()}}throw new TypeError("Unknown settings format.")}),waitUntilReady=(it,_)=>{if(it.settings){const lt=Live2DFactory.findRuntime(it.settings);if(lt)return lt.ready().then(_)}return _()},setupOptionals=(it,_)=>__async(void 0,null,function*(){yield _();const lt=it.internalModel;if(lt){const ft=it.settings,mt=Live2DFactory.findRuntime(ft);if(mt){const pt=[];ft.pose&&pt.push(Live2DLoader.load({settings:ft,url:ft.pose,type:"json",target:lt}).then(gt=>{lt.pose=mt.createPose(lt.coreModel,gt),it.live2dModel.emit("poseLoaded",lt.pose)}).catch(gt=>{it.live2dModel.emit("poseLoadError",gt),logger.warn(TAG,"Failed to load pose.",gt)})),ft.physics&&pt.push(Live2DLoader.load({settings:ft,url:ft.physics,type:"json",target:lt}).then(gt=>{lt.physics=mt.createPhysics(lt.coreModel,gt),it.live2dModel.emit("physicsLoaded",lt.physics)}).catch(gt=>{it.live2dModel.emit("physicsLoadError",gt),logger.warn(TAG,"Failed to load physics.",gt)})),pt.length&&(yield Promise.all(pt))}}}),setupEssentials=(it,_)=>__async(void 0,null,function*(){if(it.settings){const lt=it.live2dModel,ft=Promise.all(it.settings.textures.map(mt=>{const pt=it.settings.resolveURL(mt);return createTexture$1(pt,{crossOrigin:it.options.crossOrigin})}));if(ft.catch(noop),yield _(),it.internalModel)lt.internalModel=it.internalModel,lt.emit("modelLoaded",it.internalModel);else throw new TypeError("Missing internal model.");lt.textures=yield ft,lt.emit("textureLoaded",lt.textures)}else throw new TypeError("Missing settings.")}),createInternalModel=(it,_)=>__async(void 0,null,function*(){const lt=it.settings;if(lt instanceof ModelSettings){const ft=Live2DFactory.findRuntime(lt);if(!ft)throw new TypeError("Unknown model settings.");const mt=yield Live2DLoader.load({settings:lt,url:lt.moc,type:"arraybuffer",target:it.live2dModel});if(!ft.isValidMoc(mt))throw new Error("Invalid moc data");const pt=ft.createCoreModel(mt);return it.internalModel=ft.createInternalModel(pt,lt,it.options),_()}throw new TypeError("Missing settings.")}),_ZipLoader=class fy{static unzip(_,lt){return __async(this,null,function*(){const ft=yield fy.getFilePaths(_),mt=[];for(const gt of lt.getDefinedFiles()){const bt=decodeURI(url.resolve(lt.url,gt));ft.includes(bt)&&mt.push(bt)}const pt=yield fy.getFiles(_,mt);for(let gt=0;gt<pt.length;gt++){const bt=mt[gt],wt=pt[gt];Object.defineProperty(wt,"webkitRelativePath",{value:bt})}return pt})}static createSettings(_){return __async(this,null,function*(){const ft=(yield fy.getFilePaths(_)).find(bt=>bt.endsWith("model.json")||bt.endsWith("model3.json"));if(!ft)throw new Error("Settings file not found");const mt=yield fy.readText(_,ft);if(!mt)throw new Error("Empty settings file: "+ft);const pt=JSON.parse(mt);pt.url=ft;const gt=fy.live2dFactory.findRuntime(pt);if(!gt)throw new Error("Unknown settings JSON");return gt.createModelSettings(pt)})}static zipReader(_,lt){return __async(this,null,function*(){throw new Error("Not implemented")})}static getFilePaths(_){return __async(this,null,function*(){throw new Error("Not implemented")})}static getFiles(_,lt){return __async(this,null,function*(){throw new Error("Not implemented")})}static readText(_,lt){return __async(this,null,function*(){throw new Error("Not implemented")})}static releaseReader(_){}};__publicField(_ZipLoader,"live2dFactory");__publicField(_ZipLoader,"ZIP_PROTOCOL","zip://");__publicField(_ZipLoader,"uid",0);__publicField(_ZipLoader,"factory",(it,_)=>__async(_ZipLoader,null,function*(){const lt=it.source;let ft,mt,pt;if(typeof lt=="string"&&(lt.endsWith(".zip")||lt.startsWith(_ZipLoader.ZIP_PROTOCOL))?(lt.startsWith(_ZipLoader.ZIP_PROTOCOL)?ft=lt.slice(_ZipLoader.ZIP_PROTOCOL.length):ft=lt,mt=yield Live2DLoader.load({url:ft,type:"blob",target:it.live2dModel})):Array.isArray(lt)&&lt.length===1&&lt[0]instanceof File&&lt[0].name.endsWith(".zip")&&(mt=lt[0],ft=URL.createObjectURL(mt),pt=lt.settings),mt){if(!mt.size)throw new Error("Empty zip file");const gt=yield _ZipLoader.zipReader(mt,ft);pt||(pt=yield _ZipLoader.createSettings(gt)),pt._objectURL=_ZipLoader.ZIP_PROTOCOL+_ZipLoader.uid+"/"+pt.url;const bt=yield _ZipLoader.unzip(gt,pt);bt.settings=pt,it.source=bt,ft.startsWith("blob:")&&it.live2dModel.once("modelLoaded",wt=>{wt.once("destroy",function(){URL.revokeObjectURL(ft)})}),_ZipLoader.releaseReader(gt)}return _()}));let ZipLoader=_ZipLoader;const _FileLoader=class Uy{static resolveURL(_,lt){var ft;const mt=(ft=Uy.filesMap[_])==null?void 0:ft[lt];if(mt===void 0)throw new Error("Cannot find this file from uploaded files: "+lt);return mt}static upload(_,lt){return __async(this,null,function*(){const ft={};for(const mt of lt.getDefinedFiles()){const pt=decodeURI(url.resolve(lt.url,mt)),gt=_.find(bt=>bt.webkitRelativePath===pt);gt&&(ft[mt]=URL.createObjectURL(gt))}Uy.filesMap[lt._objectURL]=ft})}static createSettings(_){return __async(this,null,function*(){const lt=_.find(bt=>bt.name.endsWith("model.json")||bt.name.endsWith("model3.json"));if(!lt)throw new TypeError("Settings file not found");const ft=yield Uy.readText(lt),mt=JSON.parse(ft);mt.url=lt.webkitRelativePath;const pt=Live2DFactory.findRuntime(mt);if(!pt)throw new Error("Unknown settings JSON");const gt=pt.createModelSettings(mt);return gt._objectURL=URL.createObjectURL(lt),gt})}static readText(_){return __async(this,null,function*(){return new Promise((lt,ft)=>{const mt=new FileReader;mt.onload=()=>lt(mt.result),mt.onerror=ft,mt.readAsText(_,"utf8")})})}};__publicField(_FileLoader,"live2dFactory");__publicField(_FileLoader,"filesMap",{});__publicField(_FileLoader,"factory",(it,_)=>__async(_FileLoader,null,function*(){if(Array.isArray(it.source)&&it.source[0]instanceof File){const lt=it.source;let ft=lt.settings;if(!ft)ft=yield _FileLoader.createSettings(lt);else if(!ft._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings');ft.validateFiles(lt.map(mt=>encodeURI(mt.webkitRelativePath))),yield _FileLoader.upload(lt,ft),ft.resolveURL=function(mt){return _FileLoader.resolveURL(this._objectURL,mt)},it.source=ft,it.live2dModel.once("modelLoaded",mt=>{mt.once("destroy",function(){const pt=this.settings._objectURL;if(URL.revokeObjectURL(pt),_FileLoader.filesMap[pt])for(const gt of Object.values(_FileLoader.filesMap[pt]))URL.revokeObjectURL(gt);delete _FileLoader.filesMap[pt]})})}return _()}));let FileLoader=_FileLoader;const _Live2DFactory=class Wm{static registerRuntime(_){Wm.runtimes.push(_),Wm.runtimes.sort((lt,ft)=>ft.version-lt.version)}static findRuntime(_){for(const lt of Wm.runtimes)if(lt.test(_))return lt}static setupLive2DModel(_,lt,ft){return __async(this,null,function*(){const mt=new Promise(bt=>_.once("textureLoaded",bt)),pt=new Promise(bt=>_.once("modelLoaded",bt)),gt=Promise.all([mt,pt]).then(()=>_.emit("ready"));yield runMiddlewares(Wm.live2DModelMiddlewares,{live2dModel:_,source:lt,options:ft||{}}),yield gt,_.emit("load")})}static loadMotion(_,lt,ft){var mt,pt;const gt=bt=>_.emit("motionLoadError",lt,ft,bt);try{const bt=(mt=_.definitions[lt])==null?void 0:mt[ft];if(!bt)return Promise.resolve(void 0);_.listeners("destroy").includes(Wm.releaseTasks)||_.once("destroy",Wm.releaseTasks);let wt=Wm.motionTasksMap.get(_);wt||(wt={},Wm.motionTasksMap.set(_,wt));let vt=wt[lt];vt||(vt=[],wt[lt]=vt);const Ct=_.getMotionFile(bt);return(pt=vt[ft])!=null||(vt[ft]=Live2DLoader.load({url:Ct,settings:_.settings,type:_.motionDataType,target:_}).then(Rt=>{var Mt;const Ot=(Mt=Wm.motionTasksMap.get(_))==null?void 0:Mt[lt];Ot&&delete Ot[ft];const Nt=_.createMotion(Rt,lt,bt);return _.emit("motionLoaded",lt,ft,Nt),Nt}).catch(Rt=>{logger.warn(_.tag,`Failed to load motion: ${Ct}
`,Rt),gt(Rt)})),vt[ft]}catch(bt){logger.warn(_.tag,`Failed to load motion at "${lt}"[${ft}]
`,bt),gt(bt)}return Promise.resolve(void 0)}static loadExpression(_,lt){var ft;const mt=pt=>_.emit("expressionLoadError",lt,pt);try{const pt=_.definitions[lt];if(!pt)return Promise.resolve(void 0);_.listeners("destroy").includes(Wm.releaseTasks)||_.once("destroy",Wm.releaseTasks);let gt=Wm.expressionTasksMap.get(_);gt||(gt=[],Wm.expressionTasksMap.set(_,gt));const bt=_.getExpressionFile(pt);return(ft=gt[lt])!=null||(gt[lt]=Live2DLoader.load({url:bt,settings:_.settings,type:"json",target:_}).then(wt=>{const vt=Wm.expressionTasksMap.get(_);vt&&delete vt[lt];const Ct=_.createExpression(wt,pt);return _.emit("expressionLoaded",lt,Ct),Ct}).catch(wt=>{logger.warn(_.tag,`Failed to load expression: ${bt}
`,wt),mt(wt)})),gt[lt]}catch(pt){logger.warn(_.tag,`Failed to load expression at [${lt}]
`,pt),mt(pt)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof MotionManager?Wm.motionTasksMap.delete(this):Wm.expressionTasksMap.delete(this)}};__publicField(_Live2DFactory,"runtimes",[]);__publicField(_Live2DFactory,"urlToJSON",urlToJSON);__publicField(_Live2DFactory,"jsonToSettings",jsonToSettings);__publicField(_Live2DFactory,"waitUntilReady",waitUntilReady);__publicField(_Live2DFactory,"setupOptionals",setupOptionals);__publicField(_Live2DFactory,"setupEssentials",setupEssentials);__publicField(_Live2DFactory,"createInternalModel",createInternalModel);__publicField(_Live2DFactory,"live2DModelMiddlewares",[ZipLoader.factory,FileLoader.factory,urlToJSON,jsonToSettings,waitUntilReady,setupOptionals,setupEssentials,createInternalModel]);__publicField(_Live2DFactory,"motionTasksMap",new WeakMap);__publicField(_Live2DFactory,"expressionTasksMap",new WeakMap);let Live2DFactory=_Live2DFactory;MotionManager.prototype._loadMotion=function(it,_){return Live2DFactory.loadMotion(this,it,_)};ExpressionManager.prototype._loadExpression=function(it){return Live2DFactory.loadExpression(this,it)};FileLoader.live2dFactory=Live2DFactory;ZipLoader.live2dFactory=Live2DFactory;const _Automator=class Qy{constructor(_,{autoUpdate:lt=!0,autoHitTest:ft=!0,autoFocus:mt=!0,autoInteract:pt,ticker:gt}={}){__publicField(this,"model"),__publicField(this,"destroyed",!1),__publicField(this,"_ticker"),__publicField(this,"_autoUpdate",!1),__publicField(this,"_autoHitTest",!1),__publicField(this,"_autoFocus",!1),gt||(Qy.defaultTicker?gt=Qy.defaultTicker:typeof PIXI<"u"&&(gt=PIXI.Ticker.shared)),pt!==void 0&&(ft=pt,mt=pt,logger.warn(_.tag,"options.autoInteract is deprecated since v0.5.0, use autoHitTest and autoFocus instead.")),this.model=_,this.ticker=gt,this.autoUpdate=lt,this.autoHitTest=ft,this.autoFocus=mt,(ft||mt)&&(this.model.eventMode="static")}get ticker(){return this._ticker}set ticker(_){var lt;this._ticker&&this._ticker.remove(onTickerUpdate,this),this._ticker=_,this._autoUpdate&&((lt=this._ticker)==null||lt.add(onTickerUpdate,this))}get autoUpdate(){return this._autoUpdate}set autoUpdate(_){var lt;this.destroyed||(_?this._ticker?(this._ticker.add(onTickerUpdate,this),this._autoUpdate=!0):logger.warn(this.model.tag,"No Ticker to be used for automatic updates. Either set option.ticker when creating Live2DModel, or expose PIXI to global scope (window.PIXI = PIXI)."):((lt=this._ticker)==null||lt.remove(onTickerUpdate,this),this._autoUpdate=!1))}get autoHitTest(){return this._autoHitTest}set autoHitTest(_){_!==this.autoHitTest&&(_?this.model.on("pointertap",onTap,this):this.model.off("pointertap",onTap,this),this._autoHitTest=_)}get autoFocus(){return this._autoFocus}set autoFocus(_){_!==this.autoFocus&&(_?this.model.on("globalpointermove",onPointerMove,this):this.model.off("globalpointermove",onPointerMove,this),this._autoFocus=_)}get autoInteract(){return this._autoHitTest&&this._autoFocus}set autoInteract(_){this.autoHitTest=_,this.autoFocus=_}onTickerUpdate(){const _=this.ticker.deltaMS;this.model.update(_)}onTap(_){this.model.tap(_.global.x,_.global.y)}onPointerMove(_){this.model.focus(_.global.x,_.global.y)}destroy(){this.autoFocus=!1,this.autoHitTest=!1,this.autoUpdate=!1,this.ticker=void 0,this.destroyed=!0}};__publicField(_Automator,"defaultTicker");let Automator=_Automator;function onTickerUpdate(){this.onTickerUpdate()}function onTap(it){this.onTap(it)}function onPointerMove(it){this.onPointerMove(it)}class Live2DTransform extends Transform{}const tempPoint$2=new Point,tempMatrix$1=new Matrix;class Live2DModel extends Container{constructor(_){super(),__publicField(this,"tag","Live2DModel(uninitialized)"),__publicField(this,"internalModel"),__publicField(this,"textures",[]),__publicField(this,"transform",new Live2DTransform),__publicField(this,"anchor",new ObservablePoint(this.onAnchorChange,this,0,0)),__publicField(this,"glContextID",-1),__publicField(this,"elapsedTime",0),__publicField(this,"deltaTime",0),__publicField(this,"automator"),this.automator=new Automator(this,_),this.once("modelLoaded",()=>this.init(_))}static from(_,lt){const ft=new this(lt);return Live2DFactory.setupLive2DModel(ft,_,lt).then(()=>ft)}static fromSync(_,lt){const ft=new this(lt);return Live2DFactory.setupLive2DModel(ft,_,lt).then(lt==null?void 0:lt.onLoad).catch(lt==null?void 0:lt.onError),ft}static registerTicker(_){Automator.defaultTicker=_.shared}init(_){this.tag=`Live2DModel(${this.internalModel.settings.name})`}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(_,lt,ft,{sound:mt=void 0,volume:pt=VOLUME,expression:gt=void 0,resetExpression:bt=!0,crossOrigin:wt,onFinish:vt,onError:Ct}={}){return lt===void 0?this.internalModel.motionManager.startRandomMotion(_,ft,{sound:mt,volume:pt,expression:gt,resetExpression:bt,crossOrigin:wt,onFinish:vt,onError:Ct}):this.internalModel.motionManager.startMotion(_,lt,ft,{sound:mt,volume:pt,expression:gt,resetExpression:bt,crossOrigin:wt,onFinish:vt,onError:Ct})}stopMotions(){return this.internalModel.motionManager.stopAllMotions()}speak(_,{volume:lt=VOLUME,expression:ft,resetExpression:mt=!0,crossOrigin:pt,onFinish:gt,onError:bt}={}){return this.internalModel.motionManager.speak(_,{volume:lt,expression:ft,resetExpression:mt,crossOrigin:pt,onFinish:gt,onError:bt})}stopSpeaking(){return this.internalModel.motionManager.stopSpeaking()}expression(_){return this.internalModel.motionManager.expressionManager?_===void 0?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(_):Promise.resolve(!1)}focus(_,lt,ft=!1){tempPoint$2.x=_,tempPoint$2.y=lt,this.toModelPosition(tempPoint$2,tempPoint$2,!0);const mt=tempPoint$2.x/this.internalModel.originalWidth*2-1,pt=tempPoint$2.y/this.internalModel.originalHeight*2-1,gt=Math.atan2(pt,mt);this.internalModel.focusController.focus(Math.cos(gt),-Math.sin(gt),ft)}tap(_,lt){const ft=this.hitTest(_,lt);ft.length&&(logger.log(this.tag,"Hit",ft),this.emit("hit",ft))}hitTest(_,lt){return tempPoint$2.x=_,tempPoint$2.y=lt,this.toModelPosition(tempPoint$2,tempPoint$2),this.internalModel.hitTest(tempPoint$2.x,tempPoint$2.y)}toModelPosition(_,lt=_.clone(),ft){return ft||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(_,lt),this.internalModel.localTransform.applyInverse(lt,lt),lt}containsPoint(_){return this.getBounds(!0).contains(_.x,_.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}update(_){this.deltaTime+=_,this.elapsedTime+=_}_render(_){_.batch.reset(),_.geometry.reset(),_.shader.reset(),_.state.reset();let lt=!1;this.glContextID!==_.CONTEXT_UID&&(this.glContextID=_.CONTEXT_UID,this.internalModel.updateWebGLContext(_.gl,this.glContextID),lt=!0);for(let pt=0;pt<this.textures.length;pt++){const gt=this.textures[pt];gt.valid&&((lt||!gt.baseTexture._glTextures[this.glContextID])&&(_.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),_.texture.bind(gt.baseTexture,0)),this.internalModel.bindTexture(pt,gt.baseTexture._glTextures[this.glContextID].texture),gt.baseTexture.touched=_.textureGC.count)}const ft=_.framebuffer.viewport;this.internalModel.viewport=[ft.x,ft.y,ft.width,ft.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const mt=tempMatrix$1.copyFrom(_.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(mt),this.internalModel.draw(_.gl),_.state.reset(),_.texture.reset()}destroy(_){this.emit("destroy"),_!=null&&_.texture&&this.textures.forEach(lt=>lt.destroy(_.baseTexture)),this.automator.destroy(),this.internalModel.destroy(),super.destroy(_)}}if(!window.Live2D)throw new Error("Could not find Cubism 2 runtime. This plugin requires live2d.min.js to be loaded.");const originalUpdateParam=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(it,_){originalUpdateParam.call(this,it,_),_.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)};class Live2DExpression extends AMotion{constructor(_){super(),__publicField(this,"params",[]),this.setFadeIn(_.fade_in>0?_.fade_in:config.expressionFadingDuration),this.setFadeOut(_.fade_out>0?_.fade_out:config.expressionFadingDuration),Array.isArray(_.params)&&_.params.forEach(lt=>{const ft=lt.calc||"add";if(ft==="add"){const mt=lt.def||0;lt.val-=mt}else if(ft==="mult"){const mt=lt.def||1;lt.val/=mt}this.params.push({calc:ft,val:lt.val,id:lt.id})})}updateParamExe(_,lt,ft,mt){this.params.forEach(pt=>{_.setParamFloat(pt.id,pt.val*ft)})}}class Cubism2ExpressionManager extends ExpressionManager{constructor(_,lt){var ft;super(_,lt),__publicField(this,"queueManager",new MotionQueueManager),__publicField(this,"definitions"),this.definitions=(ft=this.settings.expressions)!=null?ft:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(_){return this.definitions.findIndex(lt=>lt.name===_)}getExpressionFile(_){return _.file}createExpression(_,lt){return new Live2DExpression(_)}_setExpression(_){return this.queueManager.startMotion(_)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(_,lt){return this.queueManager.updateParam(_)}}class Cubism2MotionManager extends MotionManager{constructor(_,lt){super(_,lt),__publicField(this,"definitions"),__publicField(this,"groups",{idle:"idle"}),__publicField(this,"motionDataType","arraybuffer"),__publicField(this,"queueManager",new MotionQueueManager),__publicField(this,"lipSyncIds"),__publicField(this,"expressionManager"),this.definitions=this.settings.motions,this.init(lt),this.lipSyncIds=["PARAM_MOUTH_OPEN_Y"]}init(_){super.init(_),this.settings.expressions&&(this.expressionManager=new Cubism2ExpressionManager(this.settings,_))}isFinished(){return this.queueManager.isFinished()}createMotion(_,lt,ft){const mt=Live2DMotion.loadMotion(_),pt=lt===this.groups.idle?config.idleMotionFadingDuration:config.motionFadingDuration;return mt.setFadeIn(ft.fade_in>0?ft.fade_in:pt),mt.setFadeOut(ft.fade_out>0?ft.fade_out:pt),mt}getMotionFile(_){return _.file}getMotionName(_){return _.file}getSoundFile(_){return _.sound}_startMotion(_,lt){return _.onFinishHandler=lt,this.queueManager.stopAllMotions(),this.queueManager.startMotion(_)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(_,lt){return this.queueManager.updateParam(_)}destroy(){super.destroy(),this.queueManager=void 0}}class Live2DEyeBlink{constructor(_){__publicField(this,"leftParam"),__publicField(this,"rightParam"),__publicField(this,"blinkInterval",4e3),__publicField(this,"closingDuration",100),__publicField(this,"closedDuration",50),__publicField(this,"openingDuration",150),__publicField(this,"eyeState",0),__publicField(this,"eyeParamValue",1),__publicField(this,"closedTimer",0),__publicField(this,"nextBlinkTimeLeft",this.blinkInterval),this.coreModel=_,this.leftParam=_.getParamIndex("PARAM_EYE_L_OPEN"),this.rightParam=_.getParamIndex("PARAM_EYE_R_OPEN")}setEyeParams(_){this.eyeParamValue=clamp(_,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(_){switch(this.eyeState){case 0:this.nextBlinkTimeLeft-=_,this.nextBlinkTimeLeft<0&&(this.eyeState=1,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+rand(0,2e3));break;case 1:this.setEyeParams(this.eyeParamValue+_/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=2,this.closedTimer=0);break;case 2:this.closedTimer+=_,this.closedTimer>=this.closedDuration&&(this.eyeState=3);break;case 3:this.setEyeParams(this.eyeParamValue+_/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=0)}}}const tempMatrixArray=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Cubism2InternalModel extends InternalModel{constructor(_,lt,ft){super(),__publicField(this,"settings"),__publicField(this,"coreModel"),__publicField(this,"motionManager"),__publicField(this,"eyeBlink"),__publicField(this,"eyeballXParamIndex"),__publicField(this,"eyeballYParamIndex"),__publicField(this,"angleXParamIndex"),__publicField(this,"angleYParamIndex"),__publicField(this,"angleZParamIndex"),__publicField(this,"bodyAngleXParamIndex"),__publicField(this,"breathParamIndex"),__publicField(this,"textureFlipY",!0),__publicField(this,"lipSync",!0),__publicField(this,"drawDataCount",0),__publicField(this,"disableCulling",!1),__publicField(this,"hasDrawn",!1),this.coreModel=_,this.settings=lt,this.motionManager=new Cubism2MotionManager(lt,ft),this.eyeBlink=new Live2DEyeBlink(_),this.eyeballXParamIndex=_.getParamIndex("PARAM_EYE_BALL_X"),this.eyeballYParamIndex=_.getParamIndex("PARAM_EYE_BALL_Y"),this.angleXParamIndex=_.getParamIndex("PARAM_ANGLE_X"),this.angleYParamIndex=_.getParamIndex("PARAM_ANGLE_Y"),this.angleZParamIndex=_.getParamIndex("PARAM_ANGLE_Z"),this.bodyAngleXParamIndex=_.getParamIndex("PARAM_BODY_ANGLE_X"),this.breathParamIndex=_.getParamIndex("PARAM_BREATH"),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach(({id:pt,value:gt})=>this.coreModel.setParamFloat(pt,gt)),this.settings.initOpacities&&this.settings.initOpacities.forEach(({id:pt,value:gt})=>this.coreModel.setPartsOpacity(pt,gt)),this.coreModel.saveParam();const _=this.coreModel.getModelContext()._$aS;_!=null&&_.length&&(this.drawDataCount=_.length);let lt=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,"culling",{set:pt=>lt=pt,get:()=>this.disableCulling?!1:lt});const ft=this.coreModel.getModelContext().clipManager,mt=ft.setupClip;ft.setupClip=(pt,gt)=>{mt.call(ft,pt,gt),gt.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const _={};if(this.settings.layout)for(const[lt,ft]of Object.entries(this.settings.layout)){let mt=lt;lt==="center_x"?mt="centerX":lt==="center_y"&&(mt="centerY"),_[mt]=ft}return _}updateWebGLContext(_,lt){const ft=this.coreModel.drawParamWebGL;ft.firstDraw=!0,ft.setGL(_),ft.glno=lt;for(const[gt,bt]of Object.entries(ft))bt instanceof WebGLBuffer&&(ft[gt]=null);const mt=this.coreModel.getModelContext().clipManager;mt.curFrameNo=lt;const pt=_.getParameter(_.FRAMEBUFFER_BINDING);mt.getMaskRenderTexture(),_.bindFramebuffer(_.FRAMEBUFFER,pt)}bindTexture(_,lt){this.coreModel.setTexture(_,lt)}getHitAreaDefs(){var _;return((_=this.settings.hitAreas)==null?void 0:_.map(lt=>({id:lt.id,name:lt.name,index:this.coreModel.getDrawDataIndex(lt.id)})))||[]}getDrawableIDs(){const _=this.coreModel.getModelContext(),lt=[];for(let ft=0;ft<this.drawDataCount;ft++){const mt=_.getDrawData(ft);mt&&lt.push(mt.getDrawDataID().id)}return lt}getDrawableIndex(_){return this.coreModel.getDrawDataIndex(_)}getDrawableVertices(_){if(typeof _=="string"&&(_=this.coreModel.getDrawDataIndex(_),_===-1))throw new TypeError("Unable to find drawable ID: "+_);return this.coreModel.getTransformedPoints(_).slice()}hitTest(_,lt){return this.hasDrawn||logger.warn("Trying to hit-test a Cubism 2 model that has not been rendered yet. The result will always be empty since the draw data is not ready."),super.hitTest(_,lt)}update(_,lt){var ft,mt,pt,gt;super.update(_,lt);const bt=this.coreModel;this.emit("beforeMotionUpdate");const wt=this.motionManager.update(this.coreModel,lt);if(this.emit("afterMotionUpdate"),bt.saveParam(),(ft=this.motionManager.expressionManager)==null||ft.update(bt,lt),wt||(mt=this.eyeBlink)==null||mt.update(_),this.updateFocus(),this.updateNaturalMovements(_,lt),this.lipSync&&this.motionManager.currentAudio){let vt=this.motionManager.mouthSync(),Ct=0;const Rt=1,Mt=1.2,Ot=.7;vt>0&&(Ct=.4),vt=Math.pow(vt,Ot),vt=clamp(vt*Mt,Ct,Rt);for(let Nt=0;Nt<this.motionManager.lipSyncIds.length;++Nt)this.coreModel.setParamFloat(this.coreModel.getParamIndex(this.motionManager.lipSyncIds[Nt]),vt)}(pt=this.physics)==null||pt.update(lt),(gt=this.pose)==null||gt.update(_),this.emit("beforeModelUpdate"),bt.update(),bt.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,this.focusController.x*30),this.coreModel.addToParamFloat(this.angleYParamIndex,this.focusController.y*30),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,this.focusController.x*10)}updateNaturalMovements(_,lt){const ft=lt/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*Math.sin(ft/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*Math.sin(ft/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*Math.sin(ft/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*Math.sin(ft/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(ft/3.2345))}draw(_){const lt=this.disableCulling;_.getParameter(_.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const ft=this.drawingMatrix;tempMatrixArray[0]=ft.a,tempMatrixArray[1]=ft.b,tempMatrixArray[4]=ft.c,tempMatrixArray[5]=ft.d,tempMatrixArray[12]=ft.tx,tempMatrixArray[13]=ft.ty,this.coreModel.setMatrix(tempMatrixArray),this.coreModel.draw(),this.hasDrawn=!0,this.disableCulling=lt}destroy(){super.destroy(),this.coreModel=void 0}}class Cubism2ModelSettings extends ModelSettings{constructor(_){if(super(_),__publicField(this,"moc"),__publicField(this,"textures"),__publicField(this,"layout"),__publicField(this,"hitAreas"),__publicField(this,"initParams"),__publicField(this,"initOpacities"),__publicField(this,"expressions"),__publicField(this,"motions",{}),!Cubism2ModelSettings.isValidJSON(_))throw new TypeError("Invalid JSON.");this.moc=_.model,copyArray("string",_,this,"textures","textures"),this.copy(_)}static isValidJSON(_){var lt;return!!_&&typeof _.model=="string"&&((lt=_.textures)==null?void 0:lt.length)>0&&_.textures.every(ft=>typeof ft=="string")}copy(_){copyProperty("string",_,this,"name","name"),copyProperty("string",_,this,"pose","pose"),copyProperty("string",_,this,"physics","physics"),copyProperty("object",_,this,"layout","layout"),copyProperty("object",_,this,"motions","motions"),copyArray("object",_,this,"hit_areas","hitAreas"),copyArray("object",_,this,"expressions","expressions"),copyArray("object",_,this,"init_params","initParams"),copyArray("object",_,this,"init_opacities","initOpacities")}replaceFiles(_){super.replaceFiles(_);for(const[lt,ft]of Object.entries(this.motions))for(let mt=0;mt<ft.length;mt++)ft[mt].file=_(ft[mt].file,`motions.${lt}[${mt}].file`),ft[mt].sound!==void 0&&(ft[mt].sound=_(ft[mt].sound,`motions.${lt}[${mt}].sound`));if(this.expressions)for(let lt=0;lt<this.expressions.length;lt++)this.expressions[lt].file=_(this.expressions[lt].file,`expressions[${lt}].file`)}}const SRC_TYPE_MAP={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},TARGET_TYPE_MAP={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class Live2DPhysics{constructor(_,lt){__publicField(this,"physicsHairs",[]),this.coreModel=_,lt.physics_hair&&(this.physicsHairs=lt.physics_hair.map(ft=>{const mt=new PhysicsHair;return mt.setup(ft.setup.length,ft.setup.regist,ft.setup.mass),ft.src.forEach(({id:pt,ptype:gt,scale:bt,weight:wt})=>{const vt=SRC_TYPE_MAP[gt];vt&&mt.addSrcParam(vt,pt,bt,wt)}),ft.targets.forEach(({id:pt,ptype:gt,scale:bt,weight:wt})=>{const vt=TARGET_TYPE_MAP[gt];vt&&mt.addTargetParam(vt,pt,bt,wt)}),mt}))}update(_){this.physicsHairs.forEach(lt=>lt.update(this.coreModel,_))}}class Live2DPartsParam{constructor(_){__publicField(this,"paramIndex",-1),__publicField(this,"partsIndex",-1),__publicField(this,"link",[]),this.id=_}initIndex(_){this.paramIndex=_.getParamIndex("VISIBLE:"+this.id),this.partsIndex=_.getPartsDataIndex(PartsDataID.getID(this.id)),_.setParamFloat(this.paramIndex,1)}}class Live2DPose{constructor(_,lt){__publicField(this,"opacityAnimDuration",500),__publicField(this,"partsGroups",[]),this.coreModel=_,lt.parts_visible&&(this.partsGroups=lt.parts_visible.map(({group:ft})=>ft.map(({id:mt,link:pt})=>{const gt=new Live2DPartsParam(mt);return pt&&(gt.link=pt.map(bt=>new Live2DPartsParam(bt))),gt})),this.init())}init(){this.partsGroups.forEach(_=>{_.forEach(lt=>{if(lt.initIndex(this.coreModel),lt.paramIndex>=0){const ft=this.coreModel.getParamFloat(lt.paramIndex)!==0;this.coreModel.setPartsOpacity(lt.partsIndex,ft?1:0),this.coreModel.setParamFloat(lt.paramIndex,ft?1:0),lt.link.length>0&&lt.link.forEach(mt=>mt.initIndex(this.coreModel))}})})}normalizePartsOpacityGroup(_,lt){const ft=this.coreModel,mt=.5,pt=.15;let gt=1,bt=_.findIndex(({paramIndex:wt,partsIndex:vt})=>vt>=0&&ft.getParamFloat(wt)!==0);if(bt>=0){const wt=ft.getPartsOpacity(_[bt].partsIndex);gt=clamp(wt+lt/this.opacityAnimDuration,0,1)}else bt=0,gt=1;_.forEach(({partsIndex:wt},vt)=>{if(wt>=0)if(bt==vt)ft.setPartsOpacity(wt,gt);else{let Ct=ft.getPartsOpacity(wt),Rt;gt<mt?Rt=gt*(mt-1)/mt+1:Rt=(1-gt)*mt/(1-mt),(1-Rt)*(1-gt)>pt&&(Rt=1-pt/(1-gt)),Ct>Rt&&(Ct=Rt),ft.setPartsOpacity(wt,Ct)}})}copyOpacity(_){const lt=this.coreModel;_.forEach(({partsIndex:ft,link:mt})=>{if(ft>=0&&mt){const pt=lt.getPartsOpacity(ft);mt.forEach(({partsIndex:gt})=>{gt>=0&&lt.setPartsOpacity(gt,pt)})}})}update(_){this.partsGroups.forEach(lt=>{this.normalizePartsOpacityGroup(lt,_),this.copyOpacity(lt)})}}Live2DFactory.registerRuntime({version:2,test(it){return it instanceof Cubism2ModelSettings||Cubism2ModelSettings.isValidJSON(it)},ready(){return Promise.resolve()},isValidMoc(it){if(it.byteLength<3)return!1;const _=new Int8Array(it,0,3);return String.fromCharCode(..._)==="moc"},createModelSettings(it){return new Cubism2ModelSettings(it)},createCoreModel(it){const _=Live2DModelWebGL.loadModel(it),lt=Live2D.getError();if(lt)throw lt;return _},createInternalModel(it,_,lt){return new Cubism2InternalModel(it,_,lt)},createPose(it,_){return new Live2DPose(it,_)},createPhysics(it,_){return new Live2DPhysics(it,_)}});if(!window.Live2DCubismCore)throw new Error("Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.");class CubismVector2{constructor(_,lt){this.x=_||0,this.y=lt||0}add(_){const lt=new CubismVector2(0,0);return lt.x=this.x+_.x,lt.y=this.y+_.y,lt}substract(_){const lt=new CubismVector2(0,0);return lt.x=this.x-_.x,lt.y=this.y-_.y,lt}multiply(_){const lt=new CubismVector2(0,0);return lt.x=this.x*_.x,lt.y=this.y*_.y,lt}multiplyByScaler(_){return this.multiply(new CubismVector2(_,_))}division(_){const lt=new CubismVector2(0,0);return lt.x=this.x/_.x,lt.y=this.y/_.y,lt}divisionByScalar(_){return this.division(new CubismVector2(_,_))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(_){return Math.sqrt((this.x-_.x)*(this.x-_.x)+(this.y-_.y)*(this.y-_.y))}dot(_){return this.x*_.x+this.y*_.y}normalize(){const _=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/_,this.y=this.y/_}isEqual(_){return this.x==_.x&&this.y==_.y}isNotEqual(_){return!this.isEqual(_)}}const _CubismMath=class jy{static range(_,lt,ft){return _<lt?_=lt:_>ft&&(_=ft),_}static sin(_){return Math.sin(_)}static cos(_){return Math.cos(_)}static abs(_){return Math.abs(_)}static sqrt(_){return Math.sqrt(_)}static cbrt(_){if(_===0)return _;let lt=_;const ft=lt<0;ft&&(lt=-lt);let mt;return lt===1/0?mt=1/0:(mt=Math.exp(Math.log(lt)/3),mt=(lt/(mt*mt)+2*mt)/3),ft?-mt:mt}static getEasingSine(_){return _<0?0:_>1?1:.5-.5*this.cos(_*Math.PI)}static max(_,lt){return _>lt?_:lt}static min(_,lt){return _>lt?lt:_}static degreesToRadian(_){return _/180*Math.PI}static radianToDegrees(_){return _*180/Math.PI}static directionToRadian(_,lt){const ft=Math.atan2(lt.y,lt.x),mt=Math.atan2(_.y,_.x);let pt=ft-mt;for(;pt<-Math.PI;)pt+=Math.PI*2;for(;pt>Math.PI;)pt-=Math.PI*2;return pt}static directionToDegrees(_,lt){const ft=this.directionToRadian(_,lt);let mt=this.radianToDegrees(ft);return lt.x-_.x>0&&(mt=-mt),mt}static radianToDirection(_){const lt=new CubismVector2;return lt.x=this.sin(_),lt.y=this.cos(_),lt}static quadraticEquation(_,lt,ft){return this.abs(_)<jy.Epsilon?this.abs(lt)<jy.Epsilon?-ft:-ft/lt:-(lt+this.sqrt(lt*lt-4*_*ft))/(2*_)}static cardanoAlgorithmForBezier(_,lt,ft,mt){if(this.sqrt(_)<jy.Epsilon)return this.range(this.quadraticEquation(lt,ft,mt),0,1);const pt=lt/_,gt=ft/_,bt=mt/_,wt=(3*gt-pt*pt)/3,vt=wt/3,Ct=(2*pt*pt*pt-9*pt*gt+27*bt)/27,Rt=Ct/2,Mt=Rt*Rt+vt*vt*vt,Ot=.5,Nt=Ot+.01;if(Mt<0){const mr=-wt/3,br=mr*mr*mr,Fr=this.sqrt(br),kr=-Ct/(2*Fr),Br=this.range(kr,-1,1),Nr=Math.acos(Br),Yn=2*this.cbrt(Fr),ga=Yn*this.cos(Nr/3)-pt/3;if(this.abs(ga-Ot)<Nt)return this.range(ga,0,1);const Kn=Yn*this.cos((Nr+2*Math.PI)/3)-pt/3;if(this.abs(Kn-Ot)<Nt)return this.range(Kn,0,1);const Xn=Yn*this.cos((Nr+4*Math.PI)/3)-pt/3;return this.range(Xn,0,1)}if(Mt==0){let mr;Rt<0?mr=this.cbrt(-Rt):mr=-this.cbrt(Rt);const br=2*mr-pt/3;if(this.abs(br-Ot)<Nt)return this.range(br,0,1);const Fr=-mr-pt/3;return this.range(Fr,0,1)}const Ht=this.sqrt(Mt),Kt=this.cbrt(Ht-Rt),hr=this.cbrt(Ht+Rt),Qt=Kt-hr-pt/3;return this.range(Qt,0,1)}constructor(){}};_CubismMath.Epsilon=1e-5;let CubismMath=_CubismMath;class CubismMatrix44{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(_,lt,ft){const mt=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),pt=4;for(let gt=0;gt<pt;++gt)for(let bt=0;bt<pt;++bt)for(let wt=0;wt<pt;++wt)mt[bt+gt*4]+=_[wt+gt*4]*lt[bt+wt*4];for(let gt=0;gt<16;++gt)ft[gt]=mt[gt]}loadIdentity(){const _=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(_)}setMatrix(_){for(let lt=0;lt<16;++lt)this._tr[lt]=_[lt]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(_){return this._tr[0]*_+this._tr[12]}transformY(_){return this._tr[5]*_+this._tr[13]}invertTransformX(_){return(_-this._tr[12])/this._tr[0]}invertTransformY(_){return(_-this._tr[13])/this._tr[5]}translateRelative(_,lt){const ft=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,_,lt,0,1]);CubismMatrix44.multiply(ft,this._tr,this._tr)}translate(_,lt){this._tr[12]=_,this._tr[13]=lt}translateX(_){this._tr[12]=_}translateY(_){this._tr[13]=_}scaleRelative(_,lt){const ft=new Float32Array([_,0,0,0,0,lt,0,0,0,0,1,0,0,0,0,1]);CubismMatrix44.multiply(ft,this._tr,this._tr)}scale(_,lt){this._tr[0]=_,this._tr[5]=lt}multiplyByMatrix(_){CubismMatrix44.multiply(_.getArray(),this._tr,this._tr)}clone(){const _=new CubismMatrix44;for(let lt=0;lt<this._tr.length;lt++)_._tr[lt]=this._tr[lt];return _}}class CubismRenderer{initialize(_){this._model=_}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(_){this._mvpMatrix4x4.setMatrix(_.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(_,lt,ft,mt){_<0?_=0:_>1&&(_=1),lt<0?lt=0:lt>1&&(lt=1),ft<0?ft=0:ft>1&&(ft=1),mt<0?mt=0:mt>1&&(mt=1),this._modelColor.R=_,this._modelColor.G=lt,this._modelColor.B=ft,this._modelColor.A=mt}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(_){this._isPremultipliedAlpha=_}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(_){this._isCulling=_}isCulling(){return this._isCulling}setAnisotropy(_){this._anisotropy=_}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(_){this._useHighPrecisionMask=_}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._modelColor=new CubismTextureColor,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new CubismMatrix44,this._mvpMatrix4x4.loadIdentity()}}var CubismBlendMode=(it=>(it[it.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",it[it.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",it[it.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",it))(CubismBlendMode||{});class CubismTextureColor{constructor(_=1,lt=1,ft=1,mt=1){this.R=_,this.G=lt,this.B=ft,this.A=mt}}let s_isStarted=!1,s_isInitialized=!1,s_option;const Constant={vertexOffset:0,vertexStep:2};class CubismFramework{static startUp(_){if(s_isStarted)return CubismLogInfo("CubismFramework.startUp() is already done."),s_isStarted;if(Live2DCubismCore._isStarted)return s_isStarted=!0,!0;if(Live2DCubismCore._isStarted=!0,s_option=_,s_option&&Live2DCubismCore.Logging.csmSetLogFunction(s_option.logFunction),s_isStarted=!0,s_isStarted){const lt=Live2DCubismCore.Version.csmGetVersion(),ft=(lt&4278190080)>>24,mt=(lt&16711680)>>16,pt=lt&65535,gt=lt;CubismLogInfo("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+ft).slice(-2),("00"+mt).slice(-2),("0000"+pt).slice(-4),gt)}return CubismLogInfo("CubismFramework.startUp() is complete."),s_isStarted}static cleanUp(){s_isStarted=!1,s_isInitialized=!1,s_option=void 0}static initialize(_=0){if(!s_isStarted){CubismLogWarning("CubismFramework is not started.");return}if(s_isInitialized){CubismLogWarning("CubismFramework.initialize() skipped, already initialized.");return}Live2DCubismCore.Memory.initializeAmountOfMemory(_),s_isInitialized=!0,CubismLogInfo("CubismFramework.initialize() is complete.")}static dispose(){if(!s_isStarted){CubismLogWarning("CubismFramework is not started.");return}if(!s_isInitialized){CubismLogWarning("CubismFramework.dispose() skipped, not initialized.");return}CubismRenderer.staticRelease(),s_isInitialized=!1,CubismLogInfo("CubismFramework.dispose() is complete.")}static isStarted(){return s_isStarted}static isInitialized(){return s_isInitialized}static coreLogFunction(_){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(_)}static getLoggingLevel(){return s_option!=null?s_option.loggingLevel:5}constructor(){}}var LogLevel=(it=>(it[it.LogLevel_Verbose=0]="LogLevel_Verbose",it[it.LogLevel_Debug=1]="LogLevel_Debug",it[it.LogLevel_Info=2]="LogLevel_Info",it[it.LogLevel_Warning=3]="LogLevel_Warning",it[it.LogLevel_Error=4]="LogLevel_Error",it[it.LogLevel_Off=5]="LogLevel_Off",it))(LogLevel||{});const CSM_ASSERT=typeof process<"u"?()=>{}:it=>console.assert(it);function CubismLogDebug(it,..._){CubismDebug.print(LogLevel.LogLevel_Debug,"[CSM][D]"+it+`
`,_)}function CubismLogInfo(it,..._){CubismDebug.print(LogLevel.LogLevel_Info,"[CSM][I]"+it+`
`,_)}function CubismLogWarning(it,..._){CubismDebug.print(LogLevel.LogLevel_Warning,"[CSM][W]"+it+`
`,_)}function CubismLogError(it,..._){CubismDebug.print(LogLevel.LogLevel_Error,"[CSM][E]"+it+`
`,_)}class CubismDebug{static print(_,lt,ft){if(_<CubismFramework.getLoggingLevel())return;const mt=CubismFramework.coreLogFunction;if(!mt)return;const pt=lt.replace(/{(\d+)}/g,(gt,bt)=>ft[bt]);mt(pt)}static dumpBytes(_,lt,ft){for(let mt=0;mt<ft;mt++)mt%16==0&&mt>0?this.print(_,`
`):mt%8==0&&mt>0&&this.print(_,"  "),this.print(_,"{0} ",[lt[mt]&255]);this.print(_,`
`)}constructor(){}}class ACubismMotion{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(_,lt,ft){if(!lt.isAvailable()||lt.isFinished())return;if(!lt.isStarted()){lt.setIsStarted(!0),lt.setStartTime(ft-this._offsetSeconds),lt.setFadeInStartTime(ft);const bt=this.getDuration();lt.getEndTime()<0&&lt.setEndTime(bt<=0?-1:lt.getStartTime()+bt)}let mt=this._weight;const pt=this._fadeInSeconds==0?1:CubismMath.getEasingSine((ft-lt.getFadeInStartTime())/this._fadeInSeconds),gt=this._fadeOutSeconds==0||lt.getEndTime()<0?1:CubismMath.getEasingSine((lt.getEndTime()-ft)/this._fadeOutSeconds);mt=mt*pt*gt,lt.setState(ft,mt),CSM_ASSERT(0<=mt&&mt<=1),this.doUpdateParameters(_,ft,mt,lt),lt.getEndTime()>0&&lt.getEndTime()<ft&&lt.setIsFinished(!0)}setFadeInTime(_){this._fadeInSeconds=_}setFadeOutTime(_){this._fadeOutSeconds=_}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(_){this._weight=_}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(_){this._offsetSeconds=_}getFiredEvent(_,lt){return this._firedEventValues}setFinishedMotionHandler(_){this._onFinishedMotion=_}getFinishedMotionHandler(){return this._onFinishedMotion}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(_){}getModelOpacityValue(){return 1}}const DefaultFadeTime=1;class CubismExpressionMotion extends ACubismMotion{static create(_){const lt=new CubismExpressionMotion;return lt.parse(_),lt}doUpdateParameters(_,lt,ft,mt){for(let pt=0;pt<this._parameters.length;++pt){const gt=this._parameters[pt];switch(gt.blendType){case 0:{_.addParameterValueById(gt.parameterId,gt.value,ft);break}case 1:{_.multiplyParameterValueById(gt.parameterId,gt.value,ft);break}case 2:{_.setParameterValueById(gt.parameterId,gt.value,ft);break}}}}parse(_){this.setFadeInTime(_.FadeInTime!=null?_.FadeInTime:DefaultFadeTime),this.setFadeOutTime(_.FadeOutTime!=null?_.FadeOutTime:DefaultFadeTime);const lt=(_.Parameters||[]).length;for(let ft=0;ft<lt;++ft){const mt=_.Parameters[ft],pt=mt.Id,gt=mt.Value;let bt;!mt.Blend||mt.Blend==="Add"?bt=0:mt.Blend==="Multiply"?bt=1:mt.Blend==="Overwrite"?bt=2:bt=0;const wt={parameterId:pt,blendType:bt,value:gt};this._parameters.push(wt)}}constructor(){super(),this._parameters=[]}}class CubismMotionQueueEntry{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(_){this._fadeOutSeconds=_,this._isTriggeredFadeOut=!0}startFadeOut(_,lt){const ft=lt+_;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||ft<this._endTimeSeconds)&&(this._endTimeSeconds=ft)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(_){this._startTimeSeconds=_}setFadeInStartTime(_){this._fadeInStartTimeSeconds=_}setEndTime(_){this._endTimeSeconds=_}setIsFinished(_){this._finished=_}setIsStarted(_){this._started=_}isAvailable(){return this._available}setIsAvailable(_){this._available=_}setState(_,lt){this._stateTimeSeconds=_,this._stateWeight=lt}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(_){this._lastEventCheckSeconds=_}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class CubismMotionQueueManager{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let _=0;_<this._motions.length;++_)this._motions[_]&&this._motions[_].release();this._motions=void 0}startMotion(_,lt,ft){if(_==null)return InvalidMotionQueueEntryHandleValue;let mt;for(let pt=0;pt<this._motions.length;++pt)mt=this._motions[pt],mt!=null&&mt.setFadeOut(mt._motion.getFadeOutTime());return mt=new CubismMotionQueueEntry,mt._autoDelete=lt,mt._motion=_,this._motions.push(mt),mt._motionQueueEntryHandle}isFinished(){let _=0;for(;_<this._motions.length;){const lt=this._motions[_];if(lt==null){this._motions.splice(_,1);continue}if(lt._motion==null){lt.release(),this._motions.splice(_,1);continue}if(!lt.isFinished())return!1;_++}return!0}isFinishedByHandle(_){for(let lt=0;lt<this._motions.length;lt++){const ft=this._motions[lt];if(ft!=null&&ft._motionQueueEntryHandle==_&&!ft.isFinished())return!1}return!0}stopAllMotions(){for(let _=0;_<this._motions.length;_++){const lt=this._motions[_];lt!=null&&lt.release()}this._motions=[]}getCubismMotionQueueEntry(_){return this._motions.find(lt=>lt!=null&&lt._motionQueueEntryHandle==_)}setEventCallback(_,lt=null){this._eventCallBack=_,this._eventCustomData=lt}doUpdateMotion(_,lt){let ft=!1,mt=0;for(;mt<this._motions.length;){const pt=this._motions[mt];if(pt==null){this._motions.splice(mt,1);continue}const gt=pt._motion;if(gt==null){pt.release(),this._motions.splice(mt,1);continue}gt.updateParameters(_,pt,lt),ft=!0;const bt=gt.getFiredEvent(pt.getLastCheckEventSeconds()-pt.getStartTime(),lt-pt.getStartTime());for(let wt=0;wt<bt.length;++wt)this._eventCallBack(this,bt[wt],this._eventCustomData);pt.setLastCheckEventSeconds(lt),pt.isFinished()?(pt.release(),this._motions.splice(mt,1)):(pt.isTriggeredFadeOut()&&pt.startFadeOut(pt.getFadeOutSeconds(),lt),mt++)}return ft}}const InvalidMotionQueueEntryHandleValue=-1;class Cubism4ExpressionManager extends ExpressionManager{constructor(_,lt){var ft;super(_,lt),__publicField(this,"queueManager",new CubismMotionQueueManager),__publicField(this,"definitions"),this.definitions=(ft=_.expressions)!=null?ft:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(_){return this.definitions.findIndex(lt=>lt.Name===_)}getExpressionFile(_){return _.File}createExpression(_,lt){return CubismExpressionMotion.create(_)}_setExpression(_){return this.queueManager.startMotion(_,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(_,lt){return this.queueManager.doUpdateMotion(_,lt)}}var CubismMotionCurveTarget=(it=>(it[it.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",it[it.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",it[it.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",it))(CubismMotionCurveTarget||{}),CubismMotionSegmentType=(it=>(it[it.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",it[it.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",it[it.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",it[it.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",it))(CubismMotionSegmentType||{});class CubismMotionPoint{constructor(_=0,lt=0){this.time=_,this.value=lt}}class CubismMotionSegment{constructor(){this.basePointIndex=0,this.segmentType=0}}class CubismMotionCurve{constructor(){this.id="",this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class CubismMotionEvent{constructor(){this.fireTime=0,this.value=""}}class CubismMotionData{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class CubismMotionJson{constructor(_){this._json=_}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(_){return _==0?!!this._json.Meta.AreBeziersRestricted:!1}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(_){return this._json.Curves[_].Target}getMotionCurveId(_){return this._json.Curves[_].Id}getMotionCurveFadeInTime(_){return this._json.Curves[_].FadeInTime}getMotionCurveFadeOutTime(_){return this._json.Curves[_].FadeOutTime}getMotionCurveSegmentCount(_){return this._json.Curves[_].Segments.length}getMotionCurveSegment(_,lt){return this._json.Curves[_].Segments[lt]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(_){return this._json.UserData[_].Time}getEventValue(_){return this._json.UserData[_].Value}}var EvaluationOptionFlag=(it=>(it[it.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",it))(EvaluationOptionFlag||{});const EffectNameEyeBlink="EyeBlink",EffectNameLipSync="LipSync",TargetNameModel="Model",TargetNameParameter="Parameter",TargetNamePartOpacity="PartOpacity",IdNameOpacity="Opacity",UseOldBeziersCurveMotion=!1;function lerpPoints(it,_,lt){const ft=new CubismMotionPoint;return ft.time=it.time+(_.time-it.time)*lt,ft.value=it.value+(_.value-it.value)*lt,ft}function linearEvaluate(it,_){let lt=(_-it[0].time)/(it[1].time-it[0].time);return lt<0&&(lt=0),it[0].value+(it[1].value-it[0].value)*lt}function bezierEvaluate(it,_){let lt=(_-it[0].time)/(it[3].time-it[0].time);lt<0&&(lt=0);const ft=lerpPoints(it[0],it[1],lt),mt=lerpPoints(it[1],it[2],lt),pt=lerpPoints(it[2],it[3],lt),gt=lerpPoints(ft,mt,lt),bt=lerpPoints(mt,pt,lt);return lerpPoints(gt,bt,lt).value}function bezierEvaluateCardanoInterpretation(it,_){const lt=_,ft=it[0].time,mt=it[3].time,pt=it[1].time,gt=it[2].time,bt=mt-3*gt+3*pt-ft,wt=3*gt-6*pt+3*ft,vt=3*pt-3*ft,Ct=ft-lt,Rt=CubismMath.cardanoAlgorithmForBezier(bt,wt,vt,Ct),Mt=lerpPoints(it[0],it[1],Rt),Ot=lerpPoints(it[1],it[2],Rt),Nt=lerpPoints(it[2],it[3],Rt),Ht=lerpPoints(Mt,Ot,Rt),Kt=lerpPoints(Ot,Nt,Rt);return lerpPoints(Ht,Kt,Rt).value}function steppedEvaluate(it,_){return it[0].value}function inverseSteppedEvaluate(it,_){return it[1].value}function evaluateCurve(it,_,lt){const ft=it.curves[_];let mt=-1;const pt=ft.baseSegmentIndex+ft.segmentCount;let gt=0;for(let wt=ft.baseSegmentIndex;wt<pt;++wt)if(gt=it.segments[wt].basePointIndex+(it.segments[wt].segmentType==CubismMotionSegmentType.CubismMotionSegmentType_Bezier?3:1),it.points[gt].time>lt){mt=wt;break}if(mt==-1)return it.points[gt].value;const bt=it.segments[mt];return bt.evaluate(it.points.slice(bt.basePointIndex),lt)}class CubismMotion extends ACubismMotion{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._modelOpacity=1}static create(_,lt){const ft=new CubismMotion;return ft.parse(_),ft._sourceFrameRate=ft._motionData.fps,ft._loopDurationSeconds=ft._motionData.duration,ft._onFinishedMotion=lt,ft}doUpdateParameters(_,lt,ft,mt){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=EffectNameEyeBlink),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=EffectNameLipSync),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=IdNameOpacity);let pt=lt-mt.getStartTime();pt<0&&(pt=0);let gt=Number.MAX_VALUE,bt=Number.MAX_VALUE;const wt=64;let vt=0,Ct=0;this._eyeBlinkParameterIds.length>wt&&CubismLogDebug("too many eye blink targets : {0}",this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>wt&&CubismLogDebug("too many lip sync targets : {0}",this._lipSyncParameterIds.length);const Rt=this._fadeInSeconds<=0?1:CubismMath.getEasingSine((lt-mt.getFadeInStartTime())/this._fadeInSeconds),Mt=this._fadeOutSeconds<=0||mt.getEndTime()<0?1:CubismMath.getEasingSine((mt.getEndTime()-lt)/this._fadeOutSeconds);let Ot,Nt,Ht,Kt=pt;if(this._isLoop)for(;Kt>this._motionData.duration;)Kt-=this._motionData.duration;const hr=this._motionData.curves;for(Nt=0;Nt<this._motionData.curveCount&&hr[Nt].type==CubismMotionCurveTarget.CubismMotionCurveTarget_Model;++Nt)Ot=evaluateCurve(this._motionData,Nt,Kt),hr[Nt].id==this._modelCurveIdEyeBlink?bt=Ot:hr[Nt].id==this._modelCurveIdLipSync?gt=Ot:hr[Nt].id==this._modelCurveIdOpacity&&(this._modelOpacity=Ot,_.setModelOapcity(this.getModelOpacityValue()));for(;Nt<this._motionData.curveCount&&hr[Nt].type==CubismMotionCurveTarget.CubismMotionCurveTarget_Parameter;++Nt){if(Ht=_.getParameterIndex(hr[Nt].id),Ht==-1)continue;const Qt=_.getParameterValueByIndex(Ht);if(Ot=evaluateCurve(this._motionData,Nt,Kt),bt!=Number.MAX_VALUE){for(let br=0;br<this._eyeBlinkParameterIds.length&&br<wt;++br)if(this._eyeBlinkParameterIds[br]==hr[Nt].id){Ot*=bt,Ct|=1<<br;break}}if(gt!=Number.MAX_VALUE){for(let br=0;br<this._lipSyncParameterIds.length&&br<wt;++br)if(this._lipSyncParameterIds[br]==hr[Nt].id){Ot+=gt,vt|=1<<br;break}}let mr;if(hr[Nt].fadeInTime<0&&hr[Nt].fadeOutTime<0)mr=Qt+(Ot-Qt)*ft;else{let br,Fr;hr[Nt].fadeInTime<0?br=Rt:br=hr[Nt].fadeInTime==0?1:CubismMath.getEasingSine((lt-mt.getFadeInStartTime())/hr[Nt].fadeInTime),hr[Nt].fadeOutTime<0?Fr=Mt:Fr=hr[Nt].fadeOutTime==0||mt.getEndTime()<0?1:CubismMath.getEasingSine((mt.getEndTime()-lt)/hr[Nt].fadeOutTime);const kr=this._weight*br*Fr;mr=Qt+(Ot-Qt)*kr}_.setParameterValueByIndex(Ht,mr,1)}{if(bt!=Number.MAX_VALUE)for(let Qt=0;Qt<this._eyeBlinkParameterIds.length&&Qt<wt;++Qt){const mr=_.getParameterValueById(this._eyeBlinkParameterIds[Qt]);if(Ct>>Qt&1)continue;const br=mr+(bt-mr)*ft;_.setParameterValueById(this._eyeBlinkParameterIds[Qt],br)}if(gt!=Number.MAX_VALUE)for(let Qt=0;Qt<this._lipSyncParameterIds.length&&Qt<wt;++Qt){const mr=_.getParameterValueById(this._lipSyncParameterIds[Qt]);if(vt>>Qt&1)continue;const br=mr+(gt-mr)*ft;_.setParameterValueById(this._lipSyncParameterIds[Qt],br)}}for(;Nt<this._motionData.curveCount&&hr[Nt].type==CubismMotionCurveTarget.CubismMotionCurveTarget_PartOpacity;++Nt)if(Ot=evaluateCurve(this._motionData,Nt,Kt),CubismConfig.setOpacityFromMotion)_.setPartOpacityById(hr[Nt].id,Ot);else{if(Ht=_.getParameterIndex(hr[Nt].id),Ht==-1)continue;_.setParameterValueByIndex(Ht,Ot)}pt>=this._motionData.duration&&(this._isLoop?(mt.setStartTime(lt),this._isLoopFadeIn&&mt.setFadeInStartTime(lt)):(this._onFinishedMotion&&this._onFinishedMotion(this),mt.setIsFinished(!0))),this._lastWeight=ft}setIsLoop(_){this._isLoop=_}isLoop(){return this._isLoop}setIsLoopFadeIn(_){this._isLoopFadeIn=_}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(_,lt){const ft=this._motionData.curves;for(let mt=0;mt<this._motionData.curveCount;++mt)if(_==ft[mt].id){ft[mt].fadeInTime=lt;return}}setParameterFadeOutTime(_,lt){const ft=this._motionData.curves;for(let mt=0;mt<this._motionData.curveCount;++mt)if(_==ft[mt].id){ft[mt].fadeOutTime=lt;return}}getParameterFadeInTime(_){const lt=this._motionData.curves;for(let ft=0;ft<this._motionData.curveCount;++ft)if(_==lt[ft].id)return lt[ft].fadeInTime;return-1}getParameterFadeOutTime(_){const lt=this._motionData.curves;for(let ft=0;ft<this._motionData.curveCount;++ft)if(_==lt[ft].id)return lt[ft].fadeOutTime;return-1}setEffectIds(_,lt){this._eyeBlinkParameterIds=_,this._lipSyncParameterIds=lt}release(){this._motionData=void 0}parse(_){this._motionData=new CubismMotionData;const lt=new CubismMotionJson(_);this._motionData.duration=lt.getMotionDuration(),this._motionData.loop=lt.isMotionLoop(),this._motionData.curveCount=lt.getMotionCurveCount(),this._motionData.fps=lt.getMotionFps(),this._motionData.eventCount=lt.getEventCount();const ft=lt.getEvaluationOptionFlag(EvaluationOptionFlag.EvaluationOptionFlag_AreBeziersRistricted),mt=lt.getMotionFadeInTime(),pt=lt.getMotionFadeOutTime();mt!==void 0?this._fadeInSeconds=mt<0?1:mt:this._fadeInSeconds=1,pt!==void 0?this._fadeOutSeconds=pt<0?1:pt:this._fadeOutSeconds=1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map(()=>new CubismMotionCurve),this._motionData.segments=Array.from({length:lt.getMotionTotalSegmentCount()}).map(()=>new CubismMotionSegment),this._motionData.events=Array.from({length:this._motionData.eventCount}).map(()=>new CubismMotionEvent),this._motionData.points=[];let gt=0,bt=0;for(let wt=0;wt<this._motionData.curveCount;++wt){const vt=this._motionData.curves[wt];switch(lt.getMotionCurveTarget(wt)){case TargetNameModel:vt.type=CubismMotionCurveTarget.CubismMotionCurveTarget_Model;break;case TargetNameParameter:vt.type=CubismMotionCurveTarget.CubismMotionCurveTarget_Parameter;break;case TargetNamePartOpacity:vt.type=CubismMotionCurveTarget.CubismMotionCurveTarget_PartOpacity;break;default:CubismLogWarning('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!')}vt.id=lt.getMotionCurveId(wt),vt.baseSegmentIndex=bt;const Ct=lt.getMotionCurveFadeInTime(wt),Rt=lt.getMotionCurveFadeOutTime(wt);vt.fadeInTime=Ct!==void 0?Ct:-1,vt.fadeOutTime=Rt!==void 0?Rt:-1;for(let Mt=0;Mt<lt.getMotionCurveSegmentCount(wt);){switch(Mt==0?(this._motionData.segments[bt].basePointIndex=gt,this._motionData.points[gt]=new CubismMotionPoint(lt.getMotionCurveSegment(wt,Mt),lt.getMotionCurveSegment(wt,Mt+1)),gt+=1,Mt+=2):this._motionData.segments[bt].basePointIndex=gt-1,lt.getMotionCurveSegment(wt,Mt)){case CubismMotionSegmentType.CubismMotionSegmentType_Linear:{this._motionData.segments[bt].segmentType=CubismMotionSegmentType.CubismMotionSegmentType_Linear,this._motionData.segments[bt].evaluate=linearEvaluate,this._motionData.points[gt]=new CubismMotionPoint(lt.getMotionCurveSegment(wt,Mt+1),lt.getMotionCurveSegment(wt,Mt+2)),gt+=1,Mt+=3;break}case CubismMotionSegmentType.CubismMotionSegmentType_Bezier:{this._motionData.segments[bt].segmentType=CubismMotionSegmentType.CubismMotionSegmentType_Bezier,ft||UseOldBeziersCurveMotion?this._motionData.segments[bt].evaluate=bezierEvaluate:this._motionData.segments[bt].evaluate=bezierEvaluateCardanoInterpretation,this._motionData.points[gt]=new CubismMotionPoint(lt.getMotionCurveSegment(wt,Mt+1),lt.getMotionCurveSegment(wt,Mt+2)),this._motionData.points[gt+1]=new CubismMotionPoint(lt.getMotionCurveSegment(wt,Mt+3),lt.getMotionCurveSegment(wt,Mt+4)),this._motionData.points[gt+2]=new CubismMotionPoint(lt.getMotionCurveSegment(wt,Mt+5),lt.getMotionCurveSegment(wt,Mt+6)),gt+=3,Mt+=7;break}case CubismMotionSegmentType.CubismMotionSegmentType_Stepped:{this._motionData.segments[bt].segmentType=CubismMotionSegmentType.CubismMotionSegmentType_Stepped,this._motionData.segments[bt].evaluate=steppedEvaluate,this._motionData.points[gt]=new CubismMotionPoint(lt.getMotionCurveSegment(wt,Mt+1),lt.getMotionCurveSegment(wt,Mt+2)),gt+=1,Mt+=3;break}case CubismMotionSegmentType.CubismMotionSegmentType_InverseStepped:{this._motionData.segments[bt].segmentType=CubismMotionSegmentType.CubismMotionSegmentType_InverseStepped,this._motionData.segments[bt].evaluate=inverseSteppedEvaluate,this._motionData.points[gt]=new CubismMotionPoint(lt.getMotionCurveSegment(wt,Mt+1),lt.getMotionCurveSegment(wt,Mt+2)),gt+=1,Mt+=3;break}default:{CSM_ASSERT(0);break}}++vt.segmentCount,++bt}this._motionData.curves.push(vt)}for(let wt=0;wt<lt.getEventCount();++wt)this._motionData.events[wt].fireTime=lt.getEventTime(wt),this._motionData.events[wt].value=lt.getEventValue(wt);lt.release()}getFiredEvent(_,lt){this._firedEventValues.length=0;for(let ft=0;ft<this._motionData.eventCount;++ft)this._motionData.events[ft].fireTime>_&&this._motionData.events[ft].fireTime<=lt&&this._firedEventValues.push(this._motionData.events[ft].value);return this._firedEventValues}isExistModelOpacity(){for(let _=0;_<this._motionData.curveCount;_++){const lt=this._motionData.curves[_];if(lt.type==CubismMotionCurveTarget.CubismMotionCurveTarget_Model&&lt.id===IdNameOpacity)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let _=0;_<this._motionData.curveCount;_++){const lt=this._motionData.curves[_];if(lt.type==CubismMotionCurveTarget.CubismMotionCurveTarget_Model&&lt.id===IdNameOpacity)return _}return-1}getModelOpacityId(_){if(_!=-1){const lt=this._motionData.curves[_];if(lt.type==CubismMotionCurveTarget.CubismMotionCurveTarget_Model&&lt.id===IdNameOpacity)return lt.id}}getModelOpacityValue(){return this._modelOpacity}}class Cubism4MotionManager extends MotionManager{constructor(_,lt){var ft;super(_,lt),__publicField(this,"definitions"),__publicField(this,"groups",{idle:"Idle"}),__publicField(this,"motionDataType","json"),__publicField(this,"queueManager",new CubismMotionQueueManager),__publicField(this,"expressionManager"),__publicField(this,"eyeBlinkIds"),__publicField(this,"lipSyncIds",["ParamMouthOpenY"]),this.definitions=(ft=_.motions)!=null?ft:{},this.eyeBlinkIds=_.getEyeBlinkParameters()||[];const mt=_.getLipSyncParameters();mt!=null&&mt.length&&(this.lipSyncIds=mt),this.init(lt)}init(_){super.init(_),this.settings.expressions&&(this.expressionManager=new Cubism4ExpressionManager(this.settings,_)),this.queueManager.setEventCallback((lt,ft,mt)=>{this.emit("motion:"+ft)})}isFinished(){return this.queueManager.isFinished()}_startMotion(_,lt){return _.setFinishedMotionHandler(lt),this.queueManager.stopAllMotions(),this.queueManager.startMotion(_,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(_,lt,ft){const mt=CubismMotion.create(_),pt=new CubismMotionJson(_),gt=(lt===this.groups.idle?config.idleMotionFadingDuration:config.motionFadingDuration)/1e3;return pt.getMotionFadeInTime()===void 0&&mt.setFadeInTime(ft.FadeInTime>0?ft.FadeInTime:gt),pt.getMotionFadeOutTime()===void 0&&mt.setFadeOutTime(ft.FadeOutTime>0?ft.FadeOutTime:gt),mt.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),mt}getMotionFile(_){return _.File}getMotionName(_){return _.File}getSoundFile(_){return _.Sound}updateParameters(_,lt){return this.queueManager.doUpdateMotion(_,lt)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}const ParamAngleX="ParamAngleX",ParamAngleY="ParamAngleY",ParamAngleZ="ParamAngleZ",ParamEyeBallX="ParamEyeBallX",ParamEyeBallY="ParamEyeBallY",ParamMouthForm="ParamMouthForm",ParamBodyAngleX="ParamBodyAngleX",ParamBreath="ParamBreath";class CubismBreath{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new CubismBreath}setParameters(_){this._breathParameters=_}getParameters(){return this._breathParameters}updateParameters(_,lt){this._currentTime+=lt;const ft=this._currentTime*2*3.14159;for(let mt=0;mt<this._breathParameters.length;++mt){const pt=this._breathParameters[mt];_.addParameterValueById(pt.parameterId,pt.offset+pt.peak*Math.sin(ft/pt.cycle),pt.weight)}}}class BreathParameterData{constructor(_,lt,ft,mt,pt){this.parameterId=_??void 0,this.offset=lt??0,this.peak=ft??0,this.cycle=mt??0,this.weight=pt??0}}const _CubismEyeBlink=class ev{static create(_){return new ev(_)}setBlinkingInterval(_){this._blinkingIntervalSeconds=_}setBlinkingSetting(_,lt,ft){this._closingSeconds=_,this._closedSeconds=lt,this._openingSeconds=ft}setParameterIds(_){this._parameterIds=_}getParameterIds(){return this._parameterIds}updateParameters(_,lt){this._userTimeSeconds+=lt;let ft,mt=0;switch(this._blinkingState){case 2:mt=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,mt>=1&&(mt=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),ft=1-mt;break;case 3:mt=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,mt>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),ft=0;break;case 4:mt=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,mt>=1&&(mt=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),ft=mt;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),ft=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),ft=1;break}ev.CloseIfZero||(ft=-ft);for(let pt=0;pt<this._parameterIds.length;++pt)_.setParameterValueById(this._parameterIds[pt],ft)}constructor(_){var lt,ft;this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],_!=null&&(this._parameterIds=(ft=(lt=_.getEyeBlinkParameters())==null?void 0:lt.slice())!=null?ft:this._parameterIds)}determinNextBlinkingTiming(){const _=Math.random();return this._userTimeSeconds+_*(2*this._blinkingIntervalSeconds-1)}};_CubismEyeBlink.CloseIfZero=!0;let CubismEyeBlink=_CubismEyeBlink;class csmRect{constructor(_=0,lt=0,ft=0,mt=0){this.x=_,this.y=lt,this.width=ft,this.height=mt}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(_){this.x=_.x,this.y=_.y,this.width=_.width,this.height=_.height}expand(_,lt){this.x-=_,this.y-=lt,this.width+=_*2,this.height+=lt*2}}const ColorChannelCount=4,ClippingMaskMaxCountOnDefault=36,ClippingMaskMaxCountOnMultiRenderTexture=32,ShaderCount=10;let s_instance,s_viewport,s_fbo;class CubismClippingManager_WebGL{getChannelFlagAsColor(_){return this._channelColors[_]}getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures=[],this._maskColorBuffers=[];const _=this._clippingMaskBufferSize;for(let lt=0;lt<this._renderTextureCount;lt++)this._maskColorBuffers.push(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers[lt]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,_,_,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.push(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures[lt]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers[lt],0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s_fbo),this._maskTexture=new CubismRenderTextureResource(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(_){this.gl=_}calcClippedDrawTotalBounds(_,lt){let ft=Number.MAX_VALUE,mt=Number.MAX_VALUE,pt=Number.MIN_VALUE,gt=Number.MIN_VALUE;const bt=lt._clippedDrawableIndexList.length;for(let wt=0;wt<bt;wt++){const vt=lt._clippedDrawableIndexList[wt],Ct=_.getDrawableVertexCount(vt),Rt=_.getDrawableVertices(vt);let Mt=Number.MAX_VALUE,Ot=Number.MAX_VALUE,Nt=-Number.MAX_VALUE,Ht=-Number.MAX_VALUE;const Kt=Ct*Constant.vertexStep;for(let hr=Constant.vertexOffset;hr<Kt;hr+=Constant.vertexStep){const Qt=Rt[hr],mr=Rt[hr+1];Qt<Mt&&(Mt=Qt),Qt>Nt&&(Nt=Qt),mr<Ot&&(Ot=mr),mr>Ht&&(Ht=mr)}if(Mt!=Number.MAX_VALUE)if(Mt<ft&&(ft=Mt),Ot<mt&&(mt=Ot),Nt>pt&&(pt=Nt),Ht>gt&&(gt=Ht),ft==Number.MAX_VALUE)lt._allClippedDrawRect.x=0,lt._allClippedDrawRect.y=0,lt._allClippedDrawRect.width=0,lt._allClippedDrawRect.height=0,lt._isUsing=!1;else{lt._isUsing=!0;const hr=pt-ft,Qt=gt-mt;lt._allClippedDrawRect.x=ft,lt._allClippedDrawRect.y=mt,lt._allClippedDrawRect.width=hr,lt._allClippedDrawRect.height=Qt}}}constructor(){this._currentMaskRenderTexture=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new csmRect,this._tmpMatrix=new CubismMatrix44,this._tmpMatrixForMask=new CubismMatrix44,this._tmpMatrixForDraw=new CubismMatrix44;let _=new CubismTextureColor;_.R=1,_.G=0,_.B=0,_.A=0,this._channelColors.push(_),_=new CubismTextureColor,_.R=0,_.G=1,_.B=0,_.A=0,this._channelColors.push(_),_=new CubismTextureColor,_.R=0,_.G=0,_.B=1,_.A=0,this._channelColors.push(_),_=new CubismTextureColor,_.R=0,_.G=0,_.B=0,_.A=1,this._channelColors.push(_)}release(){var _;const lt=this;for(let ft=0;ft<this._clippingContextListForMask.length;ft++)this._clippingContextListForMask[ft]&&((_=this._clippingContextListForMask[ft])==null||_.release());if(lt._clippingContextListForMask=void 0,lt._clippingContextListForDraw=void 0,this._maskTexture){for(let ft=0;ft<this._maskTexture.textures.length;ft++)this.gl.deleteFramebuffer(this._maskTexture.textures[ft]);this._maskTexture=void 0}if(lt._channelColors=void 0,this._maskColorBuffers)for(let ft=0;ft<this._maskColorBuffers.length;ft++)this.gl.deleteTexture(this._maskColorBuffers[ft]);this._maskColorBuffers=void 0,this._maskRenderTextures=void 0,this._clearedFrameBufferflags=void 0}initialize(_,lt,ft,mt,pt){pt%1!=0&&(CubismLogWarning("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),pt=~~pt),pt<1&&CubismLogWarning("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=pt<1?1:pt,this._clearedFrameBufferflags=[];for(let gt=0;gt<lt;gt++){if(mt[gt]<=0){this._clippingContextListForDraw.push(null);continue}let bt=this.findSameClip(ft[gt],mt[gt]);bt==null&&(bt=new CubismClippingContext(this,ft[gt],mt[gt]),this._clippingContextListForMask.push(bt)),bt.addClippedDrawable(gt),this._clippingContextListForDraw.push(bt)}}setupClippingContext(_,lt){this._currentFrameNo++;let ft=0;for(let mt=0;mt<this._clippingContextListForMask.length;mt++){const pt=this._clippingContextListForMask[mt];this.calcClippedDrawTotalBounds(_,pt),pt._isUsing&&ft++}if(ft>0){this.setupLayoutBounds(lt.isUsingHighPrecisionMask()?0:ft),lt.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture()[0],lt.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags||(this._clearedFrameBufferflags=[]);for(let mt=0;mt<this._renderTextureCount;mt++)this._clearedFrameBufferflags[mt]=!1;for(let mt=0;mt<this._clippingContextListForMask.length;mt++){const pt=this._clippingContextListForMask[mt],gt=pt._allClippedDrawRect,bt=pt._layoutBounds,wt=.05;let vt=0,Ct=0;const Rt=this.getMaskRenderTexture()[pt._bufferIndex];if(this._currentMaskRenderTexture!=Rt&&!lt.isUsingHighPrecisionMask()&&(this._currentMaskRenderTexture=Rt,lt.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),lt.isUsingHighPrecisionMask()){const Mt=_.getPixelsPerUnit(),Ot=pt.getClippingManager()._clippingMaskBufferSize,Nt=bt.width*Ot,Ht=bt.height*Ot;this._tmpBoundsOnModel.setRect(gt),this._tmpBoundsOnModel.width*Mt>Nt?(this._tmpBoundsOnModel.expand(gt.width*wt,0),vt=bt.width/this._tmpBoundsOnModel.width):vt=Mt/Nt,this._tmpBoundsOnModel.height*Mt>Ht?(this._tmpBoundsOnModel.expand(0,gt.height*wt),Ct=bt.height/this._tmpBoundsOnModel.height):Ct=Mt/Ht}else this._tmpBoundsOnModel.setRect(gt),this._tmpBoundsOnModel.expand(gt.width*wt,gt.height*wt),vt=bt.width/this._tmpBoundsOnModel.width,Ct=bt.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(bt.x,bt.y),this._tmpMatrix.scaleRelative(vt,Ct),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(bt.x,bt.y),this._tmpMatrix.scaleRelative(vt,Ct),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),pt._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),pt._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!lt.isUsingHighPrecisionMask()){const Mt=pt._clippingIdCount;for(let Ot=0;Ot<Mt;Ot++){const Nt=pt._clippingIdList[Ot];_.getDrawableDynamicFlagVertexPositionsDidChange(Nt)&&(lt.setIsCulling(_.getDrawableCulling(Nt)!=!1),this._clearedFrameBufferflags[pt._bufferIndex]||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags[pt._bufferIndex]=!0),lt.setClippingContextBufferForMask(pt),lt.drawMesh(_.getDrawableTextureIndex(Nt),_.getDrawableVertexIndexCount(Nt),_.getDrawableVertexCount(Nt),_.getDrawableVertexIndices(Nt),_.getDrawableVertices(Nt),_.getDrawableVertexUvs(Nt),_.getMultiplyColor(Nt),_.getScreenColor(Nt),_.getDrawableOpacity(Nt),CubismBlendMode.CubismBlendMode_Normal,!1))}}}lt.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s_fbo),lt.setClippingContextBufferForMask(null),this.gl.viewport(s_viewport[0],s_viewport[1],s_viewport[2],s_viewport[3]))}}findSameClip(_,lt){for(let ft=0;ft<this._clippingContextListForMask.length;ft++){const mt=this._clippingContextListForMask[ft],pt=mt._clippingIdCount;if(pt!=lt)continue;let gt=0;for(let bt=0;bt<pt;bt++){const wt=mt._clippingIdList[bt];for(let vt=0;vt<pt;vt++)if(_[vt]==wt){gt++;break}}if(gt==pt)return mt}return null}setupLayoutBounds(_){const lt=this._renderTextureCount<=1?ClippingMaskMaxCountOnDefault:ClippingMaskMaxCountOnMultiRenderTexture*this._renderTextureCount;if(_<=0||_>lt){_>lt&&CubismLogError(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,_-lt,this._renderTextureCount,_);for(let vt=0;vt<this._clippingContextListForMask.length;vt++){const Ct=this._clippingContextListForMask[vt];Ct._layoutChannelNo=0,Ct._layoutBounds.x=0,Ct._layoutBounds.y=0,Ct._layoutBounds.width=1,Ct._layoutBounds.height=1,Ct._bufferIndex=0}return}const ft=this._renderTextureCount<=1?9:8;let mt=_/this._renderTextureCount,pt=_%this._renderTextureCount;mt=~~mt,pt=~~pt;let gt=mt/ColorChannelCount,bt=mt%ColorChannelCount;gt=~~gt,bt=~~bt;let wt=0;for(let vt=0;vt<this._renderTextureCount;vt++)for(let Ct=0;Ct<ColorChannelCount;Ct++){let Rt=gt+(Ct<bt?1:0);const Mt=bt+1>=ColorChannelCount?0:bt+1;if(Rt<ft&&Ct==Mt&&(Rt+=vt<pt?1:0),Rt!=0)if(Rt==1){const Ot=this._clippingContextListForMask[wt++];Ot._layoutChannelNo=Ct,Ot._layoutBounds.x=0,Ot._layoutBounds.y=0,Ot._layoutBounds.width=1,Ot._layoutBounds.height=1,Ot._bufferIndex=vt}else if(Rt==2)for(let Ot=0;Ot<Rt;Ot++){let Nt=Ot%2;Nt=~~Nt;const Ht=this._clippingContextListForMask[wt++];Ht._layoutChannelNo=Ct,Ht._layoutBounds.x=Nt*.5,Ht._layoutBounds.y=0,Ht._layoutBounds.width=.5,Ht._layoutBounds.height=1,Ht._bufferIndex=vt}else if(Rt<=4)for(let Ot=0;Ot<Rt;Ot++){let Nt=Ot%2,Ht=Ot/2;Nt=~~Nt,Ht=~~Ht;const Kt=this._clippingContextListForMask[wt++];Kt._layoutChannelNo=Ct,Kt._layoutBounds.x=Nt*.5,Kt._layoutBounds.y=Ht*.5,Kt._layoutBounds.width=.5,Kt._layoutBounds.height=.5,Kt._bufferIndex=vt}else if(Rt<=ft)for(let Ot=0;Ot<Rt;Ot++){let Nt=Ot%3,Ht=Ot/3;Nt=~~Nt,Ht=~~Ht;const Kt=this._clippingContextListForMask[wt++];Kt._layoutChannelNo=Ct,Kt._layoutBounds.x=Nt/3,Kt._layoutBounds.y=Ht/3,Kt._layoutBounds.width=1/3,Kt._layoutBounds.height=1/3,Kt._bufferIndex=vt}else if(CubismConfig.supportMoreMaskDivisions&&Rt<=16)for(let Ot=0;Ot<Rt;Ot++){let Nt=Ot%4,Ht=Ot/4;Nt=~~Nt,Ht=~~Ht;const Kt=this._clippingContextListForMask[wt++];Kt._layoutChannelNo=Ct,Kt._layoutBounds.x=Nt/4,Kt._layoutBounds.y=Ht/4,Kt._layoutBounds.width=1/4,Kt._layoutBounds.height=1/4,Kt._bufferIndex=vt}else{CubismLogError(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,_-lt,this._renderTextureCount,_);for(let Ot=0;Ot<Rt;Ot++){const Nt=this._clippingContextListForMask[wt++];Nt._layoutChannelNo=0,Nt._layoutBounds.x=0,Nt._layoutBounds.y=0,Nt._layoutBounds.width=1,Nt._layoutBounds.height=1,Nt._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.length}setClippingMaskBufferSize(_){this._clippingMaskBufferSize=_}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class CubismRenderTextureResource{constructor(_,lt){this.frameNo=_,this.textures=lt}}class CubismClippingContext{constructor(_,lt,ft){this._isUsing=!1,this._owner=_,this._clippingIdList=lt,this._clippingIdCount=ft,this._allClippedDrawRect=new csmRect,this._layoutBounds=new csmRect,this._clippedDrawableIndexList=[],this._matrixForMask=new CubismMatrix44,this._matrixForDraw=new CubismMatrix44,this._bufferIndex=0}release(){const _=this;_._layoutBounds=void 0,_._allClippedDrawRect=void 0,_._clippedDrawableIndexList=void 0}addClippedDrawable(_){this._clippedDrawableIndexList.push(_)}getClippingManager(){return this._owner}setGl(_){this._owner.setGL(_)}}class CubismRendererProfile_WebGL{setGlEnable(_,lt){lt?this.gl.enable(_):this.gl.disable(_)}setGlEnableVertexAttribArray(_,lt){lt?this.gl.enableVertexAttribArray(_):this.gl.disableVertexAttribArray(_)}save(){if(this.gl==null){CubismLogError(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){CubismLogError(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(_){this.gl=_}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class CubismShader_WebGL{static getInstance(){return s_instance==null&&(s_instance=new CubismShader_WebGL),s_instance}static deleteInstance(){s_instance&&(s_instance.release(),s_instance=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(_,lt,ft,mt,pt,gt,bt,wt,vt,Ct,Rt,Mt,Ot,Nt,Ht){Ot||CubismLogError("NoPremultipliedAlpha is not allowed"),this._shaderSets.length==0&&this.generateShaders();let Kt,hr,Qt,mr;const br=_.getClippingContextBufferForMask();if(br!=null){const Fr=this._shaderSets[0];this.gl.useProgram(Fr.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,lt),this.gl.uniform1i(Fr.samplerTexture0Location,0),bt.vertex==null&&(bt.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,bt.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,mt,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(Fr.attributePositionLocation),this.gl.vertexAttribPointer(Fr.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),bt.uv==null&&(bt.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,bt.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,gt,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(Fr.attributeTexCoordLocation),this.gl.vertexAttribPointer(Fr.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const kr=br._layoutChannelNo,Br=br.getClippingManager().getChannelFlagAsColor(kr);this.gl.uniform4f(Fr.uniformChannelFlagLocation,Br.R,Br.G,Br.B,Br.A),this.gl.uniformMatrix4fv(Fr.uniformClipMatrixLocation,!1,br._matrixForMask.getArray());const Nr=br._layoutBounds;this.gl.uniform4f(Fr.uniformBaseColorLocation,Nr.x*2-1,Nr.y*2-1,Nr.getRight()*2-1,Nr.getBottom()*2-1),this.gl.uniform4f(Fr.uniformMultiplyColorLocation,Rt.R,Rt.G,Rt.B,Rt.A),this.gl.uniform4f(Fr.uniformScreenColorLocation,Mt.R,Mt.G,Mt.B,Mt.A),Kt=this.gl.ZERO,hr=this.gl.ONE_MINUS_SRC_COLOR,Qt=this.gl.ZERO,mr=this.gl.ONE_MINUS_SRC_ALPHA}else{const Fr=_.getClippingContextBufferForDraw(),Br=Fr!=null?Ht?2:1:0;let Nr;switch(vt){case CubismBlendMode.CubismBlendMode_Normal:default:Nr=this._shaderSets[1+Br],Kt=this.gl.ONE,hr=this.gl.ONE_MINUS_SRC_ALPHA,Qt=this.gl.ONE,mr=this.gl.ONE_MINUS_SRC_ALPHA;break;case CubismBlendMode.CubismBlendMode_Additive:Nr=this._shaderSets[4+Br],Kt=this.gl.ONE,hr=this.gl.ONE,Qt=this.gl.ZERO,mr=this.gl.ONE;break;case CubismBlendMode.CubismBlendMode_Multiplicative:Nr=this._shaderSets[7+Br],Kt=this.gl.DST_COLOR,hr=this.gl.ONE_MINUS_SRC_ALPHA,Qt=this.gl.ZERO,mr=this.gl.ONE;break}if(this.gl.useProgram(Nr.shaderProgram),bt.vertex==null&&(bt.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,bt.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,mt,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(Nr.attributePositionLocation),this.gl.vertexAttribPointer(Nr.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),bt.uv==null&&(bt.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,bt.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,gt,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(Nr.attributeTexCoordLocation),this.gl.vertexAttribPointer(Nr.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),Fr!=null){this.gl.activeTexture(this.gl.TEXTURE1);const jn=Fr.getClippingManager().getColorBuffer()[_.getClippingContextBufferForDraw()._bufferIndex];this.gl.bindTexture(this.gl.TEXTURE_2D,jn),this.gl.uniform1i(Nr.samplerTexture1Location,1),this.gl.uniformMatrix4fv(Nr.uniformClipMatrixLocation,!1,Fr._matrixForDraw.getArray());const Yn=Fr._layoutChannelNo,ga=Fr.getClippingManager().getChannelFlagAsColor(Yn);this.gl.uniform4f(Nr.uniformChannelFlagLocation,ga.R,ga.G,ga.B,ga.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,lt),this.gl.uniform1i(Nr.samplerTexture0Location,0),this.gl.uniformMatrix4fv(Nr.uniformMatrixLocation,!1,Nt.getArray()),this.gl.uniform4f(Nr.uniformBaseColorLocation,Ct.R,Ct.G,Ct.B,Ct.A),this.gl.uniform4f(Nr.uniformMultiplyColorLocation,Rt.R,Rt.G,Rt.B,Rt.A),this.gl.uniform4f(Nr.uniformScreenColorLocation,Mt.R,Mt.G,Mt.B,Mt.A)}bt.index==null&&(bt.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,bt.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,pt,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(Kt,hr,Qt,mr)}releaseShaderProgram(){for(let _=0;_<this._shaderSets.length;_++)this.gl.deleteProgram(this._shaderSets[_].shaderProgram),this._shaderSets[_].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let _=0;_<ShaderCount;_++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(vertexShaderSrcSetupMask,fragmentShaderSrcsetupMask),this._shaderSets[1].shaderProgram=this.loadShaderProgram(vertexShaderSrc,fragmentShaderSrcPremultipliedAlpha),this._shaderSets[2].shaderProgram=this.loadShaderProgram(vertexShaderSrcMasked,fragmentShaderSrcMaskPremultipliedAlpha),this._shaderSets[3].shaderProgram=this.loadShaderProgram(vertexShaderSrcMasked,fragmentShaderSrcMaskInvertedPremultipliedAlpha),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_position"),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_texCoord"),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"s_texture0"),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_clipMatrix"),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_channelFlag"),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_baseColor"),this._shaderSets[0].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_multiplyColor"),this._shaderSets[0].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_screenColor"),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_position"),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_texCoord"),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"s_texture0"),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_matrix"),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_baseColor"),this._shaderSets[1].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_multiplyColor"),this._shaderSets[1].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_screenColor"),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_position"),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_texCoord"),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture0"),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture1"),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_matrix"),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_clipMatrix"),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_channelFlag"),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_baseColor"),this._shaderSets[2].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_multiplyColor"),this._shaderSets[2].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_screenColor"),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_position"),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_texCoord"),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture0"),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture1"),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_matrix"),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_clipMatrix"),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_channelFlag"),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_baseColor"),this._shaderSets[3].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_multiplyColor"),this._shaderSets[3].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_screenColor"),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_position"),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_texCoord"),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"s_texture0"),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_matrix"),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_baseColor"),this._shaderSets[4].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_multiplyColor"),this._shaderSets[4].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_screenColor"),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_position"),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_texCoord"),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture0"),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture1"),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_matrix"),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_clipMatrix"),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_channelFlag"),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_baseColor"),this._shaderSets[5].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_multiplyColor"),this._shaderSets[5].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_screenColor"),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_position"),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_texCoord"),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture0"),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture1"),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_matrix"),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_clipMatrix"),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_channelFlag"),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_baseColor"),this._shaderSets[6].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_multiplyColor"),this._shaderSets[6].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_screenColor"),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_position"),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_texCoord"),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"s_texture0"),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_matrix"),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_baseColor"),this._shaderSets[7].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_multiplyColor"),this._shaderSets[7].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_screenColor"),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_position"),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_texCoord"),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture0"),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture1"),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_matrix"),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_clipMatrix"),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_channelFlag"),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_baseColor"),this._shaderSets[8].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_multiplyColor"),this._shaderSets[8].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_screenColor"),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_position"),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_texCoord"),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture0"),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture1"),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_matrix"),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_clipMatrix"),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_channelFlag"),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_baseColor"),this._shaderSets[9].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_multiplyColor"),this._shaderSets[9].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_screenColor")}loadShaderProgram(_,lt){const ft=this.gl.createProgram(),mt=this.compileShaderSource(this.gl.VERTEX_SHADER,_);if(!mt)return CubismLogError("Vertex shader compile error!"),0;const pt=this.compileShaderSource(this.gl.FRAGMENT_SHADER,lt);return pt?(this.gl.attachShader(ft,mt),this.gl.attachShader(ft,pt),this.gl.linkProgram(ft),this.gl.getProgramParameter(ft,this.gl.LINK_STATUS)?(this.gl.deleteShader(mt),this.gl.deleteShader(pt),ft):(CubismLogError("Failed to link program: {0}",ft),this.gl.deleteShader(mt),this.gl.deleteShader(pt),ft&&this.gl.deleteProgram(ft),0)):(CubismLogError("Vertex shader compile error!"),0)}compileShaderSource(_,lt){const ft=lt,mt=this.gl.createShader(_);if(this.gl.shaderSource(mt,ft),this.gl.compileShader(mt),!mt){const gt=this.gl.getShaderInfoLog(mt);CubismLogError("Shader compile log: {0} ",gt)}return this.gl.getShaderParameter(mt,this.gl.COMPILE_STATUS)?mt:(this.gl.deleteShader(mt),null)}setGl(_){this.gl=_}}const vertexShaderSrcSetupMask="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",fragmentShaderSrcsetupMask="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",vertexShaderSrc="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",vertexShaderSrcMasked="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",fragmentShaderSrcPremultipliedAlpha="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",fragmentShaderSrcMaskPremultipliedAlpha="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",fragmentShaderSrcMaskInvertedPremultipliedAlpha="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";class CubismRenderer_WebGL extends CubismRenderer{initialize(_,lt=1){_.isUsingMasking()&&(this._clippingManager=new CubismClippingManager_WebGL,this._clippingManager.initialize(_,_.getDrawableCount(),_.getDrawableMasks(),_.getDrawableMaskCounts(),lt));for(let ft=_.getDrawableCount()-1;ft>=0;ft--)this._sortedDrawableIndexList[ft]=0;super.initialize(_)}bindTexture(_,lt){this._textures[_]=lt}getBindedTextures(){return this._textures}setClippingMaskBufferSize(_){if(!this._model.isUsingMasking())return;const lt=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=new CubismClippingManager_WebGL,this._clippingManager.setClippingMaskBufferSize(_),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),lt)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new CubismRendererProfile_WebGL,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}release(){var _,lt,ft;const mt=this;this._clippingManager.release(),mt._clippingManager=void 0,(_=this.gl)==null||_.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,(lt=this.gl)==null||lt.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,(ft=this.gl)==null||ft.deleteBuffer(this._bufferData.index),this._bufferData.index=null,mt._bufferData=void 0,mt._textures=void 0}doDrawModel(){if(this.gl==null){CubismLogError(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const _=this.getModel().getDrawableCount(),lt=this.getModel().getDrawableRenderOrders();for(let ft=0;ft<_;++ft){const mt=lt[ft];this._sortedDrawableIndexList[mt]=ft}for(let ft=0;ft<_;++ft){const mt=this._sortedDrawableIndexList[ft];if(!this.getModel().getDrawableDynamicFlagIsVisible(mt))continue;const pt=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw()[mt]:null;if(pt!=null&&this.isUsingHighPrecisionMask()){pt._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,pt.getClippingManager().getMaskRenderTexture()[pt._bufferIndex]),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const gt=pt._clippingIdCount;for(let bt=0;bt<gt;bt++){const wt=pt._clippingIdList[bt];this._model.getDrawableDynamicFlagVertexPositionsDidChange(wt)&&(this.setIsCulling(this._model.getDrawableCulling(wt)!=!1),this.setClippingContextBufferForMask(pt),this.drawMesh(this.getModel().getDrawableTextureIndex(wt),this.getModel().getDrawableVertexIndexCount(wt),this.getModel().getDrawableVertexCount(wt),this.getModel().getDrawableVertexIndices(wt),this.getModel().getDrawableVertices(wt),this.getModel().getDrawableVertexUvs(wt),this.getModel().getMultiplyColor(wt),this.getModel().getScreenColor(wt),this.getModel().getDrawableOpacity(wt),CubismBlendMode.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s_fbo),this.setClippingContextBufferForMask(null),this.gl.viewport(s_viewport[0],s_viewport[1],s_viewport[2],s_viewport[3]),this.preDraw()}this.setClippingContextBufferForDraw(pt),this.setIsCulling(this.getModel().getDrawableCulling(mt)),this.drawMesh(this.getModel().getDrawableTextureIndex(mt),this.getModel().getDrawableVertexIndexCount(mt),this.getModel().getDrawableVertexCount(mt),this.getModel().getDrawableVertexIndices(mt),this.getModel().getDrawableVertices(mt),this.getModel().getDrawableVertexUvs(mt),this.getModel().getMultiplyColor(mt),this.getModel().getScreenColor(mt),this.getModel().getDrawableOpacity(mt),this.getModel().getDrawableBlendMode(mt),this.getModel().getDrawableInvertedMaskBit(mt))}}drawMesh(_,lt,ft,mt,pt,gt,bt,wt,vt,Ct,Rt){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const Mt=this.getModelColor();this.getClippingContextBufferForMask()==null&&(Mt.A*=vt,this.isPremultipliedAlpha()&&(Mt.R*=Mt.A,Mt.G*=Mt.A,Mt.B*=Mt.A));let Ot=null;this._textures[_]!=null&&(Ot=this._textures[_]),CubismShader_WebGL.getInstance().setupShaderProgram(this,Ot,ft,pt,mt,gt,this._bufferData,vt,Ct,Mt,bt,wt,this.isPremultipliedAlpha(),this.getMvpMatrix(),Rt),this.gl.drawElements(this.gl.TRIANGLES,lt,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){CubismShader_WebGL.deleteInstance()}setRenderState(_,lt){s_fbo=_,s_viewport=lt}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(const _ of Object.entries(this._textures))this.gl.bindTexture(this.gl.TEXTURE_2D,_),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(_){this._clippingContextBufferForMask=_}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(_){this._clippingContextBufferForDraw=_}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(_){this.gl=_,this._clippingManager&&this._clippingManager.setGL(_),CubismShader_WebGL.getInstance().setGl(_),this._rendererProfile.setGl(_),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}CubismRenderer.staticRelease=()=>{CubismRenderer_WebGL.doStaticRelease()};const tempMatrix=new CubismMatrix44;class Cubism4InternalModel extends InternalModel{constructor(_,lt,ft){super(),__publicField(this,"settings"),__publicField(this,"coreModel"),__publicField(this,"motionManager"),__publicField(this,"lipSync",!0),__publicField(this,"breath",CubismBreath.create()),__publicField(this,"eyeBlink"),__publicField(this,"userData"),__publicField(this,"renderer",new CubismRenderer_WebGL),__publicField(this,"idParamAngleX",ParamAngleX),__publicField(this,"idParamAngleY",ParamAngleY),__publicField(this,"idParamAngleZ",ParamAngleZ),__publicField(this,"idParamEyeBallX",ParamEyeBallX),__publicField(this,"idParamEyeBallY",ParamEyeBallY),__publicField(this,"idParamBodyAngleX",ParamBodyAngleX),__publicField(this,"idParamBreath",ParamBreath),__publicField(this,"idParamMouthForm",ParamMouthForm),__publicField(this,"pixelsPerUnit",1),__publicField(this,"centeringTransform",new Matrix),this.coreModel=_,this.settings=lt,this.motionManager=new Cubism4MotionManager(lt,ft),this.init()}init(){var _;super.init(),(_=this.settings.getEyeBlinkParameters())!=null&&_.length&&(this.eyeBlink=CubismEyeBlink.create(this.settings)),this.breath.setParameters([new BreathParameterData(this.idParamAngleX,0,15,6.5345,.5),new BreathParameterData(this.idParamAngleY,0,8,3.5345,.5),new BreathParameterData(this.idParamAngleZ,0,10,5.5345,.5),new BreathParameterData(this.idParamBodyAngleX,0,4,15.5345,.5),new BreathParameterData(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const _={};if(this.settings.layout)for(const[lt,ft]of Object.entries(this.settings.layout)){const mt=lt.charAt(0).toLowerCase()+lt.slice(1);_[mt]=ft}return _}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(_,lt){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(_),this.renderer._clippingManager._currentFrameNo=lt,this.renderer._clippingManager._maskTexture=void 0,CubismShader_WebGL.getInstance()._shaderSets=[]}bindTexture(_,lt){this.renderer.bindTexture(_,lt)}getHitAreaDefs(){var _,lt;return(lt=(_=this.settings.hitAreas)==null?void 0:_.map(ft=>({id:ft.Id,name:ft.Name,index:this.coreModel.getDrawableIndex(ft.Id)})))!=null?lt:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(_){return this.coreModel.getDrawableIndex(_)}getDrawableVertices(_){if(typeof _=="string"&&(_=this.coreModel.getDrawableIndex(_),_===-1))throw new TypeError("Unable to find drawable ID: "+_);const lt=this.coreModel.getDrawableVertices(_).slice();for(let ft=0;ft<lt.length;ft+=2)lt[ft]=lt[ft]*this.pixelsPerUnit+this.originalWidth/2,lt[ft+1]=-lt[ft+1]*this.pixelsPerUnit+this.originalHeight/2;return lt}updateTransform(_){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(_)}update(_,lt){var ft,mt,pt,gt;super.update(_,lt),_/=1e3,lt/=1e3;const bt=this.coreModel;this.emit("beforeMotionUpdate");const wt=this.motionManager.update(this.coreModel,lt);if(this.emit("afterMotionUpdate"),bt.saveParameters(),(ft=this.motionManager.expressionManager)==null||ft.update(bt,lt),wt||(mt=this.eyeBlink)==null||mt.updateParameters(bt,_),this.updateFocus(),this.updateNaturalMovements(_*1e3,lt*1e3),this.lipSync&&this.motionManager.currentAudio){let vt=this.motionManager.mouthSync(),Ct=0;const Rt=1,Mt=1.2;vt>0&&(Ct=.4),vt=clamp(vt*Mt,Ct,Rt);for(let Ot=0;Ot<this.motionManager.lipSyncIds.length;++Ot)bt.addParameterValueById(this.motionManager.lipSyncIds[Ot],vt,.8)}(pt=this.physics)==null||pt.evaluate(bt,_),(gt=this.pose)==null||gt.updateParameters(bt,_),this.emit("beforeModelUpdate"),bt.update(),bt.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,this.focusController.x*30),this.coreModel.addParameterValueById(this.idParamAngleY,this.focusController.y*30),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,this.focusController.x*10)}updateFacialEmotion(_){this.coreModel.addParameterValueById(this.idParamMouthForm,_)}updateNaturalMovements(_,lt){var ft;(ft=this.breath)==null||ft.updateParameters(this.coreModel,_/1e3)}draw(_){const lt=this.drawingMatrix,ft=tempMatrix.getArray();ft[0]=lt.a,ft[1]=lt.b,ft[4]=-lt.c,ft[5]=-lt.d,ft[12]=lt.tx,ft[13]=lt.ty,this.renderer.setMvpMatrix(tempMatrix),this.renderer.setRenderState(_.getParameter(_.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}class CubismModelSettingsJson{constructor(_){this.groups=_.Groups,this.hitAreas=_.HitAreas,this.layout=_.Layout,this.moc=_.FileReferences.Moc,this.expressions=_.FileReferences.Expressions,this.motions=_.FileReferences.Motions,this.textures=_.FileReferences.Textures,this.physics=_.FileReferences.Physics,this.pose=_.FileReferences.Pose}getEyeBlinkParameters(){var _,lt;return(lt=(_=this.groups)==null?void 0:_.find(ft=>ft.Name==="EyeBlink"))==null?void 0:lt.Ids}getLipSyncParameters(){var _,lt;return(lt=(_=this.groups)==null?void 0:_.find(ft=>ft.Name==="LipSync"))==null?void 0:lt.Ids}}class Cubism4ModelSettings extends ModelSettings{constructor(_){if(super(_),__publicField(this,"moc"),__publicField(this,"textures"),!Cubism4ModelSettings.isValidJSON(_))throw new TypeError("Invalid JSON.");Object.assign(this,new CubismModelSettingsJson(_))}static isValidJSON(_){var lt;return!!(_!=null&&_.FileReferences)&&typeof _.FileReferences.Moc=="string"&&((lt=_.FileReferences.Textures)==null?void 0:lt.length)>0&&_.FileReferences.Textures.every(ft=>typeof ft=="string")}replaceFiles(_){if(super.replaceFiles(_),this.motions)for(const[lt,ft]of Object.entries(this.motions))for(let mt=0;mt<ft.length;mt++)ft[mt].File=_(ft[mt].File,`motions.${lt}[${mt}].File`),ft[mt].Sound!==void 0&&(ft[mt].Sound=_(ft[mt].Sound,`motions.${lt}[${mt}].Sound`));if(this.expressions)for(let lt=0;lt<this.expressions.length;lt++)this.expressions[lt].File=_(this.expressions[lt].File,`expressions[${lt}].File`)}}applyMixins(Cubism4ModelSettings,[CubismModelSettingsJson]);let startupPromise,startupRetries=20;function cubism4Ready(){return CubismFramework.isStarted()?Promise.resolve():(startupPromise??(startupPromise=new Promise((it,_)=>{function lt(){try{startUpCubism4(),it()}catch(ft){if(startupRetries--,startupRetries<0){const mt=new Error("Failed to start up Cubism 4 framework.");mt.cause=ft,_(mt);return}setTimeout(lt,10)}}lt()})),startupPromise)}function startUpCubism4(it){it=Object.assign({logFunction:console.log,loggingLevel:LogLevel.LogLevel_Verbose},it),CubismFramework.startUp(it),CubismFramework.initialize()}const Epsilon=.001,DefaultFadeInSeconds=.5;class CubismPose{static create(_){const lt=new CubismPose;typeof _.FadeInTime=="number"&&(lt._fadeTimeSeconds=_.FadeInTime,lt._fadeTimeSeconds<=0&&(lt._fadeTimeSeconds=DefaultFadeInSeconds));const ft=_.Groups,mt=ft.length;for(let pt=0;pt<mt;++pt){const gt=ft[pt],bt=gt.length;let wt=0;for(let vt=0;vt<bt;++vt){const Ct=gt[vt],Rt=new PartData;Rt.partId=Ct.Id;const Mt=Ct.Link;if(Mt){const Ot=Mt.length;for(let Nt=0;Nt<Ot;++Nt){const Ht=new PartData;Ht.partId=Mt[Nt],Rt.link.push(Ht)}}lt._partGroups.push(Rt),++wt}lt._partGroupCounts.push(wt)}return lt}updateParameters(_,lt){_!=this._lastModel&&this.reset(_),this._lastModel=_,lt<0&&(lt=0);let ft=0;for(let mt=0;mt<this._partGroupCounts.length;mt++){const pt=this._partGroupCounts[mt];this.doFade(_,lt,ft,pt),ft+=pt}this.copyPartOpacities(_)}reset(_){let lt=0;for(let ft=0;ft<this._partGroupCounts.length;++ft){const mt=this._partGroupCounts[ft];for(let pt=lt;pt<lt+mt;++pt){this._partGroups[pt].initialize(_);const gt=this._partGroups[pt].partIndex,bt=this._partGroups[pt].parameterIndex;if(!(gt<0)){_.setPartOpacityByIndex(gt,pt==lt?1:0),_.setParameterValueByIndex(bt,pt==lt?1:0);for(let wt=0;wt<this._partGroups[pt].link.length;++wt)this._partGroups[pt].link[wt].initialize(_)}}lt+=mt}}copyPartOpacities(_){for(let lt=0;lt<this._partGroups.length;++lt){const ft=this._partGroups[lt];if(ft.link.length==0)continue;const mt=this._partGroups[lt].partIndex,pt=_.getPartOpacityByIndex(mt);for(let gt=0;gt<ft.link.length;++gt){const wt=ft.link[gt].partIndex;wt<0||_.setPartOpacityByIndex(wt,pt)}}}doFade(_,lt,ft,mt){let pt=-1,gt=1;const bt=.5,wt=.15;for(let vt=ft;vt<ft+mt;++vt){const Ct=this._partGroups[vt].partIndex,Rt=this._partGroups[vt].parameterIndex;if(_.getParameterValueByIndex(Rt)>Epsilon){if(pt>=0)break;pt=vt,gt=_.getPartOpacityByIndex(Ct),gt+=lt/this._fadeTimeSeconds,gt>1&&(gt=1)}}pt<0&&(pt=0,gt=1);for(let vt=ft;vt<ft+mt;++vt){const Ct=this._partGroups[vt].partIndex;if(pt==vt)_.setPartOpacityByIndex(Ct,gt);else{let Rt=_.getPartOpacityByIndex(Ct),Mt;gt<bt?Mt=gt*(bt-1)/bt+1:Mt=(1-gt)*bt/(1-bt),(1-Mt)*(1-gt)>wt&&(Mt=1-wt/(1-gt)),Rt>Mt&&(Rt=Mt),_.setPartOpacityByIndex(Ct,Rt)}}}constructor(){this._fadeTimeSeconds=DefaultFadeInSeconds,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class PartData{constructor(_){this.parameterIndex=0,this.partIndex=0,this.partId="",this.link=[],_!=null&&this.assignment(_)}assignment(_){return this.partId=_.partId,this.link=_.link.map(lt=>lt.clone()),this}initialize(_){this.parameterIndex=_.getParameterIndex(this.partId),this.partIndex=_.getPartIndex(this.partId),_.setParameterValueByIndex(this.parameterIndex,1)}clone(){const _=new PartData;return _.partId=this.partId,_.parameterIndex=this.parameterIndex,_.partIndex=this.partIndex,_.link=this.link.map(lt=>lt.clone()),_}}class DrawableColorData{constructor(_=!1,lt=new CubismTextureColor){this.isOverwritten=_,this.Color=lt}}class PartColorData{constructor(_=!1,lt=new CubismTextureColor){this.isOverwritten=_,this.Color=lt}}class DrawableCullingData{constructor(_=!1,lt=!1){this.isOverwritten=_,this.isCulling=lt}}class CubismModel{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const _=this._model.parameters.count,lt=this._savedParameters.length;for(let ft=0;ft<_;++ft)ft<lt?this._savedParameters[ft]=this._parameterValues[ft]:this._savedParameters.push(this._parameterValues[ft])}getMultiplyColor(_){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(_)?this._userMultiplyColors[_].Color:this.getDrawableMultiplyColor(_)}getScreenColor(_){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(_)?this._userScreenColors[_].Color:this.getDrawableScreenColor(_)}setMultiplyColorByTextureColor(_,lt){this.setMultiplyColorByRGBA(_,lt.R,lt.G,lt.B,lt.A)}setMultiplyColorByRGBA(_,lt,ft,mt,pt=1){this._userMultiplyColors[_].Color.R=lt,this._userMultiplyColors[_].Color.G=ft,this._userMultiplyColors[_].Color.B=mt,this._userMultiplyColors[_].Color.A=pt}setScreenColorByTextureColor(_,lt){this.setScreenColorByRGBA(_,lt.R,lt.G,lt.B,lt.A)}setScreenColorByRGBA(_,lt,ft,mt,pt=1){this._userScreenColors[_].Color.R=lt,this._userScreenColors[_].Color.G=ft,this._userScreenColors[_].Color.B=mt,this._userScreenColors[_].Color.A=pt}getPartMultiplyColor(_){return this._userPartMultiplyColors[_].Color}getPartScreenColor(_){return this._userPartScreenColors[_].Color}setPartColor(_,lt,ft,mt,pt,gt,bt){if(gt[_].Color.R=lt,gt[_].Color.G=ft,gt[_].Color.B=mt,gt[_].Color.A=pt,gt[_].isOverwritten)for(let wt=0;wt<this._partChildDrawables[_].length;++wt){const vt=this._partChildDrawables[_][wt];bt[vt].Color.R=lt,bt[vt].Color.G=ft,bt[vt].Color.B=mt,bt[vt].Color.A=pt}}setPartMultiplyColorByTextureColor(_,lt){this.setPartMultiplyColorByRGBA(_,lt.R,lt.G,lt.B,lt.A)}setPartMultiplyColorByRGBA(_,lt,ft,mt,pt){this.setPartColor(_,lt,ft,mt,pt,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(_,lt){this.setPartScreenColorByRGBA(_,lt.R,lt.G,lt.B,lt.A)}setPartScreenColorByRGBA(_,lt,ft,mt,pt){this.setPartColor(_,lt,ft,mt,pt,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(_){this._isOverwrittenModelMultiplyColors=_}setOverwriteFlagForModelScreenColors(_){this._isOverwrittenModelScreenColors=_}getOverwriteFlagForDrawableMultiplyColors(_){return this._userMultiplyColors[_].isOverwritten}getOverwriteFlagForDrawableScreenColors(_){return this._userScreenColors[_].isOverwritten}setOverwriteFlagForDrawableMultiplyColors(_,lt){this._userMultiplyColors[_].isOverwritten=lt}setOverwriteFlagForDrawableScreenColors(_,lt){this._userScreenColors[_].isOverwritten=lt}getOverwriteColorForPartMultiplyColors(_){return this._userPartMultiplyColors[_].isOverwritten}getOverwriteColorForPartScreenColors(_){return this._userPartScreenColors[_].isOverwritten}setOverwriteColorForPartColors(_,lt,ft,mt){ft[_].isOverwritten=lt;for(let pt=0;pt<this._partChildDrawables[_].length;++pt){const gt=this._partChildDrawables[_][pt];mt[gt].isOverwritten=lt,lt&&(mt[gt].Color.R=ft[_].Color.R,mt[gt].Color.G=ft[_].Color.G,mt[gt].Color.B=ft[_].Color.B,mt[gt].Color.A=ft[_].Color.A)}}setOverwriteColorForPartMultiplyColors(_,lt){this._userPartMultiplyColors[_].isOverwritten=lt,this.setOverwriteColorForPartColors(_,lt,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(_,lt){this._userPartScreenColors[_].isOverwritten=lt,this.setOverwriteColorForPartColors(_,lt,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(_){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(_))return this._userCullings[_].isCulling;const lt=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(lt[_])}setDrawableCulling(_,lt){this._userCullings[_].isCulling=lt}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(_){this._isOverwrittenCullings=_}getOverwriteFlagForDrawableCullings(_){return this._userCullings[_].isOverwritten}setOverwriteFlagForDrawableCullings(_,lt){this._userCullings[_].isOverwritten=lt}getModelOapcity(){return this._modelOpacity}setModelOapcity(_){this._modelOpacity=_}getModel(){return this._model}getPartIndex(_){let lt;const ft=this._model.parts.count;for(lt=0;lt<ft;++lt)if(_==this._partIds[lt])return lt;return _ in this._notExistPartId?this._notExistPartId[_]:(lt=ft+this._notExistPartId.length,this._notExistPartId[_]=lt,this._notExistPartOpacities[lt]=0,lt)}getPartId(_){return this._model.parts.ids[_]}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(_,lt){if(_ in this._notExistPartOpacities){this._notExistPartOpacities[_]=lt;return}CSM_ASSERT(0<=_&&_<this.getPartCount()),this._partOpacities[_]=lt}setPartOpacityById(_,lt){const ft=this.getPartIndex(_);ft<0||this.setPartOpacityByIndex(ft,lt)}getPartOpacityByIndex(_){return _ in this._notExistPartOpacities?this._notExistPartOpacities[_]:(CSM_ASSERT(0<=_&&_<this.getPartCount()),this._partOpacities[_])}getPartOpacityById(_){const lt=this.getPartIndex(_);return lt<0?0:this.getPartOpacityByIndex(lt)}getParameterIndex(_){let lt;const ft=this._model.parameters.count;for(lt=0;lt<ft;++lt)if(_==this._parameterIds[lt])return lt;return _ in this._notExistParameterId?this._notExistParameterId[_]:(lt=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[_]=lt,this._notExistParameterValues[lt]=0,lt)}getParameterCount(){return this._model.parameters.count}getParameterType(_){return this._model.parameters.types[_]}getParameterMaximumValue(_){return this._model.parameters.maximumValues[_]}getParameterMinimumValue(_){return this._model.parameters.minimumValues[_]}getParameterDefaultValue(_){return this._model.parameters.defaultValues[_]}getParameterValueByIndex(_){return _ in this._notExistParameterValues?this._notExistParameterValues[_]:(CSM_ASSERT(0<=_&&_<this.getParameterCount()),this._parameterValues[_])}getParameterValueById(_){const lt=this.getParameterIndex(_);return this.getParameterValueByIndex(lt)}setParameterValueByIndex(_,lt,ft=1){if(_ in this._notExistParameterValues){this._notExistParameterValues[_]=ft==1?lt:this._notExistParameterValues[_]*(1-ft)+lt*ft;return}CSM_ASSERT(0<=_&&_<this.getParameterCount()),this._model.parameters.maximumValues[_]<lt&&(lt=this._model.parameters.maximumValues[_]),this._model.parameters.minimumValues[_]>lt&&(lt=this._model.parameters.minimumValues[_]),this._parameterValues[_]=ft==1?lt:this._parameterValues[_]=this._parameterValues[_]*(1-ft)+lt*ft}setParameterValueById(_,lt,ft=1){const mt=this.getParameterIndex(_);this.setParameterValueByIndex(mt,lt,ft)}addParameterValueByIndex(_,lt,ft=1){this.setParameterValueByIndex(_,this.getParameterValueByIndex(_)+lt*ft)}addParameterValueById(_,lt,ft=1){const mt=this.getParameterIndex(_);this.addParameterValueByIndex(mt,lt,ft)}multiplyParameterValueById(_,lt,ft=1){const mt=this.getParameterIndex(_);this.multiplyParameterValueByIndex(mt,lt,ft)}multiplyParameterValueByIndex(_,lt,ft=1){this.setParameterValueByIndex(_,this.getParameterValueByIndex(_)*(1+(lt-1)*ft))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(_){const lt=this._model.drawables.count;for(let ft=0;ft<lt;++ft)if(this._drawableIds[ft]==_)return ft;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(_){return this._model.drawables.ids[_]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(_){return this.getDrawableTextureIndex(_)}getDrawableTextureIndex(_){return this._model.drawables.textureIndices[_]}getDrawableDynamicFlagVertexPositionsDidChange(_){const lt=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(lt[_])}getDrawableVertexIndexCount(_){return this._model.drawables.indexCounts[_]}getDrawableVertexCount(_){return this._model.drawables.vertexCounts[_]}getDrawableVertices(_){return this.getDrawableVertexPositions(_)}getDrawableVertexIndices(_){return this._model.drawables.indices[_]}getDrawableVertexPositions(_){return this._model.drawables.vertexPositions[_]}getDrawableVertexUvs(_){return this._model.drawables.vertexUvs[_]}getDrawableOpacity(_){return this._model.drawables.opacities[_]}getDrawableMultiplyColor(_){const lt=this._model.drawables.multiplyColors,ft=_*4,mt=new CubismTextureColor;return mt.R=lt[ft],mt.G=lt[ft+1],mt.B=lt[ft+2],mt.A=lt[ft+3],mt}getDrawableScreenColor(_){const lt=this._model.drawables.screenColors,ft=_*4,mt=new CubismTextureColor;return mt.R=lt[ft],mt.G=lt[ft+1],mt.B=lt[ft+2],mt.A=lt[ft+3],mt}getDrawableParentPartIndex(_){return this._model.drawables.parentPartIndices[_]}getDrawableBlendMode(_){const lt=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(lt[_])?CubismBlendMode.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(lt[_])?CubismBlendMode.CubismBlendMode_Multiplicative:CubismBlendMode.CubismBlendMode_Normal}getDrawableInvertedMaskBit(_){const lt=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(lt[_])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let _=0;_<this._model.drawables.count;++_)if(!(this._model.drawables.maskCounts[_]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(_){const lt=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(lt[_])}getDrawableDynamicFlagVisibilityDidChange(_){const lt=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(lt[_])}getDrawableDynamicFlagOpacityDidChange(_){const lt=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(lt[_])}getDrawableDynamicFlagRenderOrderDidChange(_){const lt=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(lt[_])}getDrawableDynamicFlagBlendColorDidChange(_){const lt=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(lt[_])}loadParameters(){let _=this._model.parameters.count;const lt=this._savedParameters.length;_>lt&&(_=lt);for(let ft=0;ft<_;++ft)this._parameterValues[ft]=this._savedParameters[ft]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const lt=this._model.parameters.ids,ft=this._model.parameters.count;for(let mt=0;mt<ft;++mt)this._parameterIds.push(lt[mt])}const _=this._model.parts.count;{const lt=this._model.parts.ids;for(let ft=0;ft<_;++ft)this._partIds.push(lt[ft])}{const lt=this._model.drawables.ids,ft=this._model.drawables.count,mt=new DrawableCullingData(!1,!1);for(let pt=0;pt<_;++pt){const gt=new CubismTextureColor(1,1,1,1),bt=new CubismTextureColor(0,0,0,1),wt=new PartColorData(!1,gt),vt=new PartColorData(!1,bt);this._userPartMultiplyColors.push(wt),this._userPartScreenColors.push(vt),this._partChildDrawables.push([])}for(let pt=0;pt<ft;++pt){const gt=new CubismTextureColor(1,1,1,1),bt=new CubismTextureColor(0,0,0,1),wt=new DrawableColorData(!1,gt),vt=new DrawableColorData(!1,bt);this._drawableIds.push(lt[pt]),this._userMultiplyColors.push(wt),this._userScreenColors.push(vt),this._userCullings.push(mt);const Ct=this.getDrawableParentPartIndex(pt);Ct>=0&&this._partChildDrawables[Ct].push(pt)}}}constructor(_){this._model=_,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=[],this._userScreenColors=[],this._userCullings=[],this._userPartMultiplyColors=[],this._userPartScreenColors=[],this._partChildDrawables=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class CubismMoc{static create(_,lt){if(lt&&!this.hasMocConsistency(_))throw new Error("Inconsistent MOC3.");const ft=Live2DCubismCore.Moc.fromArrayBuffer(_);if(ft){const mt=new CubismMoc(ft);return mt._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(ft,_),mt}throw new Error("Failed to CubismMoc.create().")}createModel(){let _;const lt=Live2DCubismCore.Model.fromMoc(this._moc);if(lt)return _=new CubismModel(lt),++this._modelCount,_;throw new Error("Unknown error")}deleteModel(_){_!=null&&--this._modelCount}constructor(_){this._moc=_,this._modelCount=0,this._mocVersion=0}release(){this._moc._release(),this._moc=void 0}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(_){return Live2DCubismCore.Moc.prototype.hasMocConsistency(_)===1}}var CubismPhysicsTargetType=(it=>(it[it.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",it))(CubismPhysicsTargetType||{}),CubismPhysicsSource=(it=>(it[it.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",it[it.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",it[it.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",it))(CubismPhysicsSource||{});class CubismPhysicsParticle{constructor(){this.initialPosition=new CubismVector2(0,0),this.position=new CubismVector2(0,0),this.lastPosition=new CubismVector2(0,0),this.lastGravity=new CubismVector2(0,0),this.force=new CubismVector2(0,0),this.velocity=new CubismVector2(0,0)}}class CubismPhysicsSubRig{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class CubismPhysicsInput{constructor(){this.source={}}}class CubismPhysicsOutput{constructor(){this.destination={},this.translationScale=new CubismVector2(0,0)}}class CubismPhysicsRig{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new CubismVector2(0,0),this.wind=new CubismVector2(0,0),this.fps=0}}class CubismPhysicsJson{constructor(_){this._json=_}release(){this._json=void 0}getGravity(){const _=new CubismVector2(0,0);return _.x=this._json.Meta.EffectiveForces.Gravity.X,_.y=this._json.Meta.EffectiveForces.Gravity.Y,_}getWind(){const _=new CubismVector2(0,0);return _.x=this._json.Meta.EffectiveForces.Wind.X,_.y=this._json.Meta.EffectiveForces.Wind.Y,_}getFps(){return this._json.Meta.Fps||0}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(_){return this._json.PhysicsSettings[_].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(_){return this._json.PhysicsSettings[_].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(_){return this._json.PhysicsSettings[_].Normalization.Position.Default}getNormalizationAngleMinimumValue(_){return this._json.PhysicsSettings[_].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(_){return this._json.PhysicsSettings[_].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(_){return this._json.PhysicsSettings[_].Normalization.Angle.Default}getInputCount(_){return this._json.PhysicsSettings[_].Input.length}getInputWeight(_,lt){return this._json.PhysicsSettings[_].Input[lt].Weight}getInputReflect(_,lt){return this._json.PhysicsSettings[_].Input[lt].Reflect}getInputType(_,lt){return this._json.PhysicsSettings[_].Input[lt].Type}getInputSourceId(_,lt){return this._json.PhysicsSettings[_].Input[lt].Source.Id}getOutputCount(_){return this._json.PhysicsSettings[_].Output.length}getOutputVertexIndex(_,lt){return this._json.PhysicsSettings[_].Output[lt].VertexIndex}getOutputAngleScale(_,lt){return this._json.PhysicsSettings[_].Output[lt].Scale}getOutputWeight(_,lt){return this._json.PhysicsSettings[_].Output[lt].Weight}getOutputDestinationId(_,lt){return this._json.PhysicsSettings[_].Output[lt].Destination.Id}getOutputType(_,lt){return this._json.PhysicsSettings[_].Output[lt].Type}getOutputReflect(_,lt){return this._json.PhysicsSettings[_].Output[lt].Reflect}getParticleCount(_){return this._json.PhysicsSettings[_].Vertices.length}getParticleMobility(_,lt){return this._json.PhysicsSettings[_].Vertices[lt].Mobility}getParticleDelay(_,lt){return this._json.PhysicsSettings[_].Vertices[lt].Delay}getParticleAcceleration(_,lt){return this._json.PhysicsSettings[_].Vertices[lt].Acceleration}getParticleRadius(_,lt){return this._json.PhysicsSettings[_].Vertices[lt].Radius}getParticlePosition(_,lt){const ft=new CubismVector2(0,0);return ft.x=this._json.PhysicsSettings[_].Vertices[lt].Position.X,ft.y=this._json.PhysicsSettings[_].Vertices[lt].Position.Y,ft}}const PhysicsTypeTagX="X",PhysicsTypeTagY="Y",PhysicsTypeTagAngle="Angle",AirResistance=5,MaximumWeight=100,MovementThreshold=.001,MaxDeltaTime=5;class CubismPhysics{static create(_){const lt=new CubismPhysics;return lt.parse(_),lt._physicsRig.gravity.y=0,lt}static delete(_){_!=null&&_.release()}parse(_){this._physicsRig=new CubismPhysicsRig;const lt=new CubismPhysicsJson(_);this._physicsRig.gravity=lt.getGravity(),this._physicsRig.wind=lt.getWind(),this._physicsRig.subRigCount=lt.getSubRigCount(),this._physicsRig.fps=lt.getFps(),this._currentRigOutputs=[],this._previousRigOutputs=[];let ft=0,mt=0,pt=0;for(let gt=0;gt<this._physicsRig.subRigCount;++gt){const bt=new CubismPhysicsSubRig;bt.normalizationPosition.minimum=lt.getNormalizationPositionMinimumValue(gt),bt.normalizationPosition.maximum=lt.getNormalizationPositionMaximumValue(gt),bt.normalizationPosition.defalut=lt.getNormalizationPositionDefaultValue(gt),bt.normalizationAngle.minimum=lt.getNormalizationAngleMinimumValue(gt),bt.normalizationAngle.maximum=lt.getNormalizationAngleMaximumValue(gt),bt.normalizationAngle.defalut=lt.getNormalizationAngleDefaultValue(gt),bt.inputCount=lt.getInputCount(gt),bt.baseInputIndex=ft,ft+=bt.inputCount;for(let Ct=0;Ct<bt.inputCount;++Ct){const Rt=new CubismPhysicsInput;switch(Rt.sourceParameterIndex=-1,Rt.weight=lt.getInputWeight(gt,Ct),Rt.reflect=lt.getInputReflect(gt,Ct),lt.getInputType(gt,Ct)){case PhysicsTypeTagX:Rt.type=CubismPhysicsSource.CubismPhysicsSource_X,Rt.getNormalizedParameterValue=getInputTranslationXFromNormalizedParameterValue;break;case PhysicsTypeTagY:Rt.type=CubismPhysicsSource.CubismPhysicsSource_Y,Rt.getNormalizedParameterValue=getInputTranslationYFromNormalizedParamterValue;break;case PhysicsTypeTagAngle:Rt.type=CubismPhysicsSource.CubismPhysicsSource_Angle,Rt.getNormalizedParameterValue=getInputAngleFromNormalizedParameterValue;break}Rt.source.targetType=CubismPhysicsTargetType.CubismPhysicsTargetType_Parameter,Rt.source.id=lt.getInputSourceId(gt,Ct),this._physicsRig.inputs.push(Rt)}bt.outputCount=lt.getOutputCount(gt),bt.baseOutputIndex=mt;const wt=new PhysicsOutput,vt=new PhysicsOutput;for(let Ct=0;Ct<bt.outputCount;++Ct){wt.outputs[Ct]=0,vt.outputs[Ct]=0;let Rt=this._physicsRig.outputs[mt+Ct];switch(Rt||(Rt=new CubismPhysicsOutput,this._physicsRig.outputs[mt+Ct]=Rt),Rt.destinationParameterIndex=-1,Rt.vertexIndex=lt.getOutputVertexIndex(gt,Ct),Rt.angleScale=lt.getOutputAngleScale(gt,Ct),Rt.weight=lt.getOutputWeight(gt,Ct),Rt.destination.targetType=CubismPhysicsTargetType.CubismPhysicsTargetType_Parameter,Rt.destination.id=lt.getOutputDestinationId(gt,Ct),lt.getOutputType(gt,Ct)){case PhysicsTypeTagX:Rt.type=CubismPhysicsSource.CubismPhysicsSource_X,Rt.getValue=getOutputTranslationX,Rt.getScale=getOutputScaleTranslationX;break;case PhysicsTypeTagY:Rt.type=CubismPhysicsSource.CubismPhysicsSource_Y,Rt.getValue=getOutputTranslationY,Rt.getScale=getOutputScaleTranslationY;break;case PhysicsTypeTagAngle:Rt.type=CubismPhysicsSource.CubismPhysicsSource_Angle,Rt.getValue=getOutputAngle,Rt.getScale=getOutputScaleAngle;break}Rt.reflect=lt.getOutputReflect(gt,Ct)}this._currentRigOutputs.push(wt),this._previousRigOutputs.push(vt),mt+=bt.outputCount,bt.particleCount=lt.getParticleCount(gt),bt.baseParticleIndex=pt,pt+=bt.particleCount;for(let Ct=0;Ct<bt.particleCount;++Ct){const Rt=new CubismPhysicsParticle;Rt.mobility=lt.getParticleMobility(gt,Ct),Rt.delay=lt.getParticleDelay(gt,Ct),Rt.acceleration=lt.getParticleAcceleration(gt,Ct),Rt.radius=lt.getParticleRadius(gt,Ct),Rt.position=lt.getParticlePosition(gt,Ct),this._physicsRig.particles.push(Rt)}this._physicsRig.settings.push(bt)}this.initialize(),lt.release()}stabilization(_){var lt,ft,mt,pt;let gt,bt,wt,vt;const Ct=new CubismVector2;let Rt,Mt,Ot,Nt,Ht,Kt,hr,Qt;Ht=_.getModel().parameters.values,Kt=_.getModel().parameters.maximumValues,hr=_.getModel().parameters.minimumValues,Qt=_.getModel().parameters.defaultValues,((ft=(lt=this._parameterCaches)==null?void 0:lt.length)!=null?ft:0)<_.getParameterCount()&&(this._parameterCaches=new Float32Array(_.getParameterCount())),((pt=(mt=this._parameterInputCaches)==null?void 0:mt.length)!=null?pt:0)<_.getParameterCount()&&(this._parameterInputCaches=new Float32Array(_.getParameterCount()));for(let mr=0;mr<_.getParameterCount();++mr)this._parameterCaches[mr]=Ht[mr],this._parameterInputCaches[mr]=Ht[mr];for(let mr=0;mr<this._physicsRig.subRigCount;++mr){gt={angle:0},Ct.x=0,Ct.y=0,Rt=this._physicsRig.settings[mr],Mt=this._physicsRig.inputs.slice(Rt.baseInputIndex),Ot=this._physicsRig.outputs.slice(Rt.baseOutputIndex),Nt=this._physicsRig.particles.slice(Rt.baseParticleIndex);for(let br=0;br<Rt.inputCount;++br)bt=Mt[br].weight/MaximumWeight,Mt[br].sourceParameterIndex==-1&&(Mt[br].sourceParameterIndex=_.getParameterIndex(Mt[br].source.id)),Mt[br].getNormalizedParameterValue(Ct,gt,Ht[Mt[br].sourceParameterIndex],hr[Mt[br].sourceParameterIndex],Kt[Mt[br].sourceParameterIndex],Qt[Mt[br].sourceParameterIndex],Rt.normalizationPosition,Rt.normalizationAngle,Mt[br].reflect,bt),this._parameterCaches[Mt[br].sourceParameterIndex]=Ht[Mt[br].sourceParameterIndex];wt=CubismMath.degreesToRadian(-gt.angle),Ct.x=Ct.x*CubismMath.cos(wt)-Ct.y*CubismMath.sin(wt),Ct.y=Ct.x*CubismMath.sin(wt)+Ct.y*CubismMath.cos(wt),updateParticlesForStabilization(Nt,Rt.particleCount,Ct,gt.angle,this._options.wind,MovementThreshold*Rt.normalizationPosition.maximum);for(let br=0;br<Rt.outputCount;++br){const Fr=Ot[br].vertexIndex;if(Ot[br].destinationParameterIndex==-1&&(Ot[br].destinationParameterIndex=_.getParameterIndex(Ot[br].destination.id)),Fr<1||Fr>=Rt.particleCount)continue;let kr=new CubismVector2;kr=Nt[Fr].position.substract(Nt[Fr-1].position),vt=Ot[br].getValue(kr,Nt,Fr,Ot[br].reflect,this._options.gravity),this._currentRigOutputs[mr].outputs[br]=vt,this._previousRigOutputs[mr].outputs[br]=vt;const Br=Ot[br].destinationParameterIndex,Nr=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(Ht.subarray(Br))):Ht.slice(Br);updateOutputParameterValue(Nr,hr[Br],Kt[Br],vt,Ot[br]);for(let jn=Br,Yn=0;jn<this._parameterCaches.length;jn++,Yn++)Ht[jn]=this._parameterCaches[jn]=Nr[Yn]}}}evaluate(_,lt){var ft,mt,pt,gt;let bt,wt,vt,Ct;const Rt=new CubismVector2;let Mt,Ot,Nt,Ht;if(0>=lt)return;let Kt,hr,Qt,mr,br;if(this._currentRemainTime+=lt,this._currentRemainTime>MaxDeltaTime&&(this._currentRemainTime=0),Kt=_.getModel().parameters.values,hr=_.getModel().parameters.maximumValues,Qt=_.getModel().parameters.minimumValues,mr=_.getModel().parameters.defaultValues,((mt=(ft=this._parameterCaches)==null?void 0:ft.length)!=null?mt:0)<_.getParameterCount()&&(this._parameterCaches=new Float32Array(_.getParameterCount())),((gt=(pt=this._parameterInputCaches)==null?void 0:pt.length)!=null?gt:0)<_.getParameterCount()){this._parameterInputCaches=new Float32Array(_.getParameterCount());for(let kr=0;kr<_.getParameterCount();++kr)this._parameterInputCaches[kr]=Kt[kr]}for(this._physicsRig.fps>0?br=1/this._physicsRig.fps:br=lt;this._currentRemainTime>=br;){for(let Br=0;Br<this._physicsRig.subRigCount;++Br){Mt=this._physicsRig.settings[Br],Nt=this._physicsRig.outputs.slice(Mt.baseOutputIndex);for(let Nr=0;Nr<Mt.outputCount;++Nr)this._previousRigOutputs[Br].outputs[Nr]=this._currentRigOutputs[Br].outputs[Nr]}const kr=br/this._currentRemainTime;for(let Br=0;Br<_.getParameterCount();++Br)this._parameterCaches[Br]=this._parameterInputCaches[Br]*(1-kr)+Kt[Br]*kr,this._parameterInputCaches[Br]=this._parameterCaches[Br];for(let Br=0;Br<this._physicsRig.subRigCount;++Br){bt={angle:0},Rt.x=0,Rt.y=0,Mt=this._physicsRig.settings[Br],Ot=this._physicsRig.inputs.slice(Mt.baseInputIndex),Nt=this._physicsRig.outputs.slice(Mt.baseOutputIndex),Ht=this._physicsRig.particles.slice(Mt.baseParticleIndex);for(let Nr=0;Nr<Mt.inputCount;++Nr)wt=Ot[Nr].weight/MaximumWeight,Ot[Nr].sourceParameterIndex==-1&&(Ot[Nr].sourceParameterIndex=_.getParameterIndex(Ot[Nr].source.id)),Ot[Nr].getNormalizedParameterValue(Rt,bt,this._parameterCaches[Ot[Nr].sourceParameterIndex],Qt[Ot[Nr].sourceParameterIndex],hr[Ot[Nr].sourceParameterIndex],mr[Ot[Nr].sourceParameterIndex],Mt.normalizationPosition,Mt.normalizationAngle,Ot[Nr].reflect,wt);vt=CubismMath.degreesToRadian(-bt.angle),Rt.x=Rt.x*CubismMath.cos(vt)-Rt.y*CubismMath.sin(vt),Rt.y=Rt.x*CubismMath.sin(vt)+Rt.y*CubismMath.cos(vt),updateParticles(Ht,Mt.particleCount,Rt,bt.angle,this._options.wind,MovementThreshold*Mt.normalizationPosition.maximum,br,AirResistance);for(let Nr=0;Nr<Mt.outputCount;++Nr){const jn=Nt[Nr].vertexIndex;if(Nt[Nr].destinationParameterIndex==-1&&(Nt[Nr].destinationParameterIndex=_.getParameterIndex(Nt[Nr].destination.id)),jn<1||jn>=Mt.particleCount)continue;const Yn=new CubismVector2;Yn.x=Ht[jn].position.x-Ht[jn-1].position.x,Yn.y=Ht[jn].position.y-Ht[jn-1].position.y,Ct=Nt[Nr].getValue(Yn,Ht,jn,Nt[Nr].reflect,this._options.gravity),this._currentRigOutputs[Br].outputs[Nr]=Ct;const ga=Nt[Nr].destinationParameterIndex,Kn=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(ga))):this._parameterCaches.slice(ga);updateOutputParameterValue(Kn,Qt[ga],hr[ga],Ct,Nt[Nr]);for(let Xn=ga,eo=0;Xn<this._parameterCaches.length;Xn++,eo++)this._parameterCaches[Xn]=Kn[eo]}}this._currentRemainTime-=br}const Fr=this._currentRemainTime/br;this.interpolate(_,Fr)}interpolate(_,lt){let ft,mt,pt,gt,bt;pt=_.getModel().parameters.values,gt=_.getModel().parameters.maximumValues,bt=_.getModel().parameters.minimumValues;for(let wt=0;wt<this._physicsRig.subRigCount;++wt){mt=this._physicsRig.settings[wt],ft=this._physicsRig.outputs.slice(mt.baseOutputIndex);for(let vt=0;vt<mt.outputCount;++vt){if(ft[vt].destinationParameterIndex==-1)continue;const Ct=ft[vt].destinationParameterIndex,Rt=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(pt.subarray(Ct))):pt.slice(Ct);updateOutputParameterValue(Rt,bt[Ct],gt[Ct],this._previousRigOutputs[wt].outputs[vt]*(1-lt)+this._currentRigOutputs[wt].outputs[vt]*lt,ft[vt]);for(let Mt=Ct,Ot=0;Mt<pt.length;Mt++,Ot++)pt[Mt]=Rt[Ot]}}}setOptions(_){this._options=_}getOption(){return this._options}constructor(){this._options=new Options,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=[],this._previousRigOutputs=[],this._currentRemainTime=0}release(){this._physicsRig=void 0}initialize(){let _,lt,ft;for(let mt=0;mt<this._physicsRig.subRigCount;++mt){lt=this._physicsRig.settings[mt],_=this._physicsRig.particles.slice(lt.baseParticleIndex),_[0].initialPosition=new CubismVector2(0,0),_[0].lastPosition=new CubismVector2(_[0].initialPosition.x,_[0].initialPosition.y),_[0].lastGravity=new CubismVector2(0,-1),_[0].lastGravity.y*=-1,_[0].velocity=new CubismVector2(0,0),_[0].force=new CubismVector2(0,0);for(let pt=1;pt<lt.particleCount;++pt)ft=new CubismVector2(0,0),ft.y=_[pt].radius,_[pt].initialPosition=new CubismVector2(_[pt-1].initialPosition.x+ft.x,_[pt-1].initialPosition.y+ft.y),_[pt].position=new CubismVector2(_[pt].initialPosition.x,_[pt].initialPosition.y),_[pt].lastPosition=new CubismVector2(_[pt].initialPosition.x,_[pt].initialPosition.y),_[pt].lastGravity=new CubismVector2(0,-1),_[pt].lastGravity.y*=-1,_[pt].velocity=new CubismVector2(0,0),_[pt].force=new CubismVector2(0,0)}}}class Options{constructor(){this.gravity=new CubismVector2(0,0),this.wind=new CubismVector2(0,0)}}class PhysicsOutput{constructor(){this.outputs=[]}}function getInputTranslationXFromNormalizedParameterValue(it,_,lt,ft,mt,pt,gt,bt,wt,vt){it.x+=normalizeParameterValue(lt,ft,mt,pt,gt.minimum,gt.maximum,gt.defalut,wt)*vt}function getInputTranslationYFromNormalizedParamterValue(it,_,lt,ft,mt,pt,gt,bt,wt,vt){it.y+=normalizeParameterValue(lt,ft,mt,pt,gt.minimum,gt.maximum,gt.defalut,wt)*vt}function getInputAngleFromNormalizedParameterValue(it,_,lt,ft,mt,pt,gt,bt,wt,vt){_.angle+=normalizeParameterValue(lt,ft,mt,pt,bt.minimum,bt.maximum,bt.defalut,wt)*vt}function getOutputTranslationX(it,_,lt,ft,mt){let pt=it.x;return ft&&(pt*=-1),pt}function getOutputTranslationY(it,_,lt,ft,mt){let pt=it.y;return ft&&(pt*=-1),pt}function getOutputAngle(it,_,lt,ft,mt){let pt;return lt>=2?mt=_[lt-1].position.substract(_[lt-2].position):mt=mt.multiplyByScaler(-1),pt=CubismMath.directionToRadian(mt,it),ft&&(pt*=-1),pt}function getRangeValue(it,_){return Math.abs(Math.max(it,_)-Math.min(it,_))}function getDefaultValue(it,_){return Math.min(it,_)+getRangeValue(it,_)/2}function getOutputScaleTranslationX(it,_){return it.x}function getOutputScaleTranslationY(it,_){return it.y}function getOutputScaleAngle(it,_){return _}function updateParticles(it,_,lt,ft,mt,pt,gt,bt){let wt,vt,Ct,Rt,Mt=new CubismVector2(0,0),Ot=new CubismVector2(0,0),Nt=new CubismVector2(0,0),Ht=new CubismVector2(0,0);it[0].position=new CubismVector2(lt.x,lt.y),wt=CubismMath.degreesToRadian(ft),Rt=CubismMath.radianToDirection(wt),Rt.normalize();for(let Kt=1;Kt<_;++Kt)it[Kt].force=Rt.multiplyByScaler(it[Kt].acceleration).add(mt),it[Kt].lastPosition=new CubismVector2(it[Kt].position.x,it[Kt].position.y),vt=it[Kt].delay*gt*30,Mt=it[Kt].position.substract(it[Kt-1].position),Ct=CubismMath.directionToRadian(it[Kt].lastGravity,Rt)/bt,Mt.x=CubismMath.cos(Ct)*Mt.x-Mt.y*CubismMath.sin(Ct),Mt.y=CubismMath.sin(Ct)*Mt.x+Mt.y*CubismMath.cos(Ct),it[Kt].position=it[Kt-1].position.add(Mt),Ot=it[Kt].velocity.multiplyByScaler(vt),Nt=it[Kt].force.multiplyByScaler(vt).multiplyByScaler(vt),it[Kt].position=it[Kt].position.add(Ot).add(Nt),Ht=it[Kt].position.substract(it[Kt-1].position),Ht.normalize(),it[Kt].position=it[Kt-1].position.add(Ht.multiplyByScaler(it[Kt].radius)),CubismMath.abs(it[Kt].position.x)<pt&&(it[Kt].position.x=0),vt!=0&&(it[Kt].velocity=it[Kt].position.substract(it[Kt].lastPosition),it[Kt].velocity=it[Kt].velocity.divisionByScalar(vt),it[Kt].velocity=it[Kt].velocity.multiplyByScaler(it[Kt].mobility)),it[Kt].force=new CubismVector2(0,0),it[Kt].lastGravity=new CubismVector2(Rt.x,Rt.y)}function updateParticlesForStabilization(it,_,lt,ft,mt,pt){let gt,bt,wt=new CubismVector2(0,0);it[0].position=new CubismVector2(lt.x,lt.y),gt=CubismMath.degreesToRadian(ft),bt=CubismMath.radianToDirection(gt),bt.normalize();for(let vt=1;vt<_;++vt)it[vt].force=bt.multiplyByScaler(it[vt].acceleration).add(mt),it[vt].lastPosition=new CubismVector2(it[vt].position.x,it[vt].position.y),it[vt].velocity=new CubismVector2(0,0),wt=it[vt].force,wt.normalize(),wt=wt.multiplyByScaler(it[vt].radius),it[vt].position=it[vt-1].position.add(wt),CubismMath.abs(it[vt].position.x)<pt&&(it[vt].position.x=0),it[vt].force=new CubismVector2(0,0),it[vt].lastGravity=new CubismVector2(bt.x,bt.y)}function updateOutputParameterValue(it,_,lt,ft,mt){let pt,gt,bt;pt=mt.getScale(mt.translationScale,mt.angleScale),gt=ft*pt,gt<_?(gt<mt.valueBelowMinimum&&(mt.valueBelowMinimum=gt),gt=_):gt>lt&&(gt>mt.valueExceededMaximum&&(mt.valueExceededMaximum=gt),gt=lt),bt=mt.weight/MaximumWeight,bt>=1||(gt=it[0]*(1-bt)+gt*bt),it[0]=gt}function normalizeParameterValue(it,_,lt,ft,mt,pt,gt,bt){let wt=0;const vt=CubismMath.max(lt,_);vt<it&&(it=vt);const Ct=CubismMath.min(lt,_);Ct>it&&(it=Ct);const Rt=CubismMath.min(mt,pt),Mt=CubismMath.max(mt,pt),Ot=gt,Nt=getDefaultValue(Ct,vt),Ht=it-Nt;switch(Math.sign(Ht)){case 1:{const Kt=Mt-Ot,hr=vt-Nt;hr!=0&&(wt=Ht*(Kt/hr),wt+=Ot);break}case-1:{const Kt=Rt-Ot,hr=Ct-Nt;hr!=0&&(wt=Ht*(Kt/hr),wt+=Ot);break}case 0:{wt=Ot;break}}return bt?wt:wt*-1}Live2DFactory.registerRuntime({version:4,ready:cubism4Ready,test(it){return it instanceof Cubism4ModelSettings||Cubism4ModelSettings.isValidJSON(it)},isValidMoc(it){if(it.byteLength<4)return!1;const _=new Int8Array(it,0,4);return String.fromCharCode(..._)==="MOC3"},createModelSettings(it){return new Cubism4ModelSettings(it)},createCoreModel(it,_){const lt=CubismMoc.create(it,!!(_!=null&&_.checkMocConsistency));try{const ft=lt.createModel();return ft.__moc=lt,ft}catch(ft){try{lt.release()}catch{}throw ft}},createInternalModel(it,_,lt){const ft=new Cubism4InternalModel(it,_,lt),mt=it;return mt.__moc&&(ft.__moc=mt.__moc,delete mt.__moc,ft.once("destroy",releaseMoc)),ft},createPhysics(it,_){return CubismPhysics.create(_)},createPose(it,_){return CubismPose.create(_)}});function releaseMoc(){var it;(it=this.__moc)==null||it.release()}const tempPoint$1=new Point,indices=new Uint16Array([0,1,2,0,2,3]);class Sprite extends Container{constructor(_){super(),this._anchor=new ObservablePoint(this._onAnchorUpdate,this,_?_.defaultAnchor.x:0,_?_.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Color(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=BLEND_MODES.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=_||Texture.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=indices,this.pluginName="batch",this.isSprite=!0,this._roundPixels=settings.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const _=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===_._updateID)return;this._textureID!==_._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=_._updateID;const lt=this.transform.worldTransform,ft=lt.a,mt=lt.b,pt=lt.c,gt=lt.d,bt=lt.tx,wt=lt.ty,vt=this.vertexData,Ct=_.trim,Rt=_.orig,Mt=this._anchor;let Ot=0,Nt=0,Ht=0,Kt=0;if(Ct?(Nt=Ct.x-Mt._x*Rt.width,Ot=Nt+Ct.width,Kt=Ct.y-Mt._y*Rt.height,Ht=Kt+Ct.height):(Nt=-Mt._x*Rt.width,Ot=Nt+Rt.width,Kt=-Mt._y*Rt.height,Ht=Kt+Rt.height),vt[0]=ft*Nt+pt*Kt+bt,vt[1]=gt*Kt+mt*Nt+wt,vt[2]=ft*Ot+pt*Kt+bt,vt[3]=gt*Kt+mt*Ot+wt,vt[4]=ft*Ot+pt*Ht+bt,vt[5]=gt*Ht+mt*Ot+wt,vt[6]=ft*Nt+pt*Ht+bt,vt[7]=gt*Ht+mt*Nt+wt,this._roundPixels){const hr=settings.RESOLUTION;for(let Qt=0;Qt<vt.length;++Qt)vt[Qt]=Math.round(vt[Qt]*hr)/hr}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const _=this._texture,lt=this.vertexTrimmedData,ft=_.orig,mt=this._anchor,pt=this.transform.worldTransform,gt=pt.a,bt=pt.b,wt=pt.c,vt=pt.d,Ct=pt.tx,Rt=pt.ty,Mt=-mt._x*ft.width,Ot=Mt+ft.width,Nt=-mt._y*ft.height,Ht=Nt+ft.height;if(lt[0]=gt*Mt+wt*Nt+Ct,lt[1]=vt*Nt+bt*Mt+Rt,lt[2]=gt*Ot+wt*Nt+Ct,lt[3]=vt*Nt+bt*Ot+Rt,lt[4]=gt*Ot+wt*Ht+Ct,lt[5]=vt*Ht+bt*Ot+Rt,lt[6]=gt*Mt+wt*Ht+Ct,lt[7]=vt*Ht+bt*Mt+Rt,this._roundPixels){const Kt=settings.RESOLUTION;for(let hr=0;hr<lt.length;++hr)lt[hr]=Math.round(lt[hr]*Kt)/Kt}}_render(_){this.calculateVertices(),_.batch.setObjectRenderer(_.plugins[this.pluginName]),_.plugins[this.pluginName].render(this)}_calculateBounds(){const _=this._texture.trim,lt=this._texture.orig;!_||_.width===lt.width&&_.height===lt.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(_){return this.children.length===0?(this._localBounds||(this._localBounds=new Bounds),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),_||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),_=this._localBoundsRect),this._localBounds.getRectangle(_)):super.getLocalBounds.call(this,_)}containsPoint(_){this.worldTransform.applyInverse(_,tempPoint$1);const lt=this._texture.orig.width,ft=this._texture.orig.height,mt=-lt*this.anchor.x;let pt=0;return tempPoint$1.x>=mt&&tempPoint$1.x<mt+lt&&(pt=-ft*this.anchor.y,tempPoint$1.y>=pt&&tempPoint$1.y<pt+ft)}destroy(_){if(super.destroy(_),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof _=="boolean"?_:_==null?void 0:_.texture){const lt=typeof _=="boolean"?_:_==null?void 0:_.baseTexture;this._texture.destroy(!!lt)}this._texture=null}static from(_,lt){const ft=_ instanceof Texture?_:Texture.from(_,lt);return new Sprite(ft)}set roundPixels(_){this._roundPixels!==_&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=_}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(_){const lt=sign(this.scale.x)||1;this.scale.x=lt*_/this._texture.orig.width,this._width=_}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(_){const lt=sign(this.scale.y)||1;this.scale.y=lt*_/this._texture.orig.height,this._height=_}get anchor(){return this._anchor}set anchor(_){this._anchor.copyFrom(_)}get tint(){return this._tintColor.value}set tint(_){this._tintColor.setValue(_),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(_){this._texture!==_&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=_||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,_&&(_.baseTexture.valid?this._onTextureUpdate():_.once("update",this._onTextureUpdate,this)))}}const _tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1;DisplayObject.prototype._cacheData=null;DisplayObject.prototype._cacheAsBitmapResolution=null;DisplayObject.prototype._cacheAsBitmapMultisample=null;class CacheData{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(it){it!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=it,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(it){it!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=it,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(it){if(this._cacheAsBitmap===it)return;this._cacheAsBitmap=it;let _;it?(this._cacheData||(this._cacheData=new CacheData),_=this._cacheData,_.originalRender=this.render,_.originalRenderCanvas=this.renderCanvas,_.originalUpdateTransform=this.updateTransform,_.originalCalculateBounds=this.calculateBounds,_.originalGetLocalBounds=this.getLocalBounds,_.originalDestroy=this.destroy,_.originalContainsPoint=this.containsPoint,_.originalMask=this._mask,_.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(_=this._cacheData,_.sprite&&this._destroyCachedDisplayObject(),this.render=_.originalRender,this.renderCanvas=_.originalRenderCanvas,this.calculateBounds=_.originalCalculateBounds,this.getLocalBounds=_.originalGetLocalBounds,this.destroy=_.originalDestroy,this.updateTransform=_.originalUpdateTransform,this.containsPoint=_.originalContainsPoint,this._mask=_.originalMask,this.filterArea=_.originalFilterArea)}}});DisplayObject.prototype._renderCached=function(it){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(it),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(it))};DisplayObject.prototype._initCachedDisplayObject=function(it){var Mt,Ot;if((Mt=this._cacheData)!=null&&Mt.sprite)return;const _=this.alpha;this.alpha=1,it.batch.flush();const lt=this.getLocalBounds(new Rectangle,!0);if((Ot=this.filters)!=null&&Ot.length){const Nt=this.filters[0].padding;lt.pad(Nt)}const ft=this.cacheAsBitmapResolution||it.resolution;lt.ceil(ft),lt.width=Math.max(lt.width,1/ft),lt.height=Math.max(lt.height,1/ft);const mt=it.renderTexture.current,pt=it.renderTexture.sourceFrame.clone(),gt=it.renderTexture.destinationFrame.clone(),bt=it.projection.transform,wt=RenderTexture.create({width:lt.width,height:lt.height,resolution:ft,multisample:this.cacheAsBitmapMultisample??it.multisample}),vt=`cacheAsBitmap_${uid()}`;this._cacheData.textureCacheId=vt,BaseTexture.addToCache(wt.baseTexture,vt),Texture.addToCache(wt,vt);const Ct=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-lt.x,-lt.y);this.render=this._cacheData.originalRender,it.render(this,{renderTexture:wt,clear:!0,transform:Ct,skipUpdateTransform:!1}),it.framebuffer.blit(),it.projection.transform=bt,it.renderTexture.bind(mt,pt,gt),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=_;const Rt=new Sprite(wt);Rt.transform.worldTransform=this.transform.worldTransform,Rt.anchor.x=-(lt.x/lt.width),Rt.anchor.y=-(lt.y/lt.height),Rt.alpha=_,Rt._bounds=this._bounds,this._cacheData.sprite=Rt,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=Rt.containsPoint.bind(Rt)};DisplayObject.prototype._renderCachedCanvas=function(it){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(it),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(it))};DisplayObject.prototype._initCachedDisplayObjectCanvas=function(it){var Ct;if((Ct=this._cacheData)!=null&&Ct.sprite)return;const _=this.getLocalBounds(new Rectangle,!0),lt=this.alpha;this.alpha=1;const ft=it.canvasContext.activeContext,mt=it._projTransform,pt=this.cacheAsBitmapResolution||it.resolution;_.ceil(pt),_.width=Math.max(_.width,1/pt),_.height=Math.max(_.height,1/pt);const gt=RenderTexture.create({width:_.width,height:_.height,resolution:pt}),bt=`cacheAsBitmap_${uid()}`;this._cacheData.textureCacheId=bt,BaseTexture.addToCache(gt.baseTexture,bt),Texture.addToCache(gt,bt);const wt=_tempMatrix;this.transform.localTransform.copyTo(wt),wt.invert(),wt.tx-=_.x,wt.ty-=_.y,this.renderCanvas=this._cacheData.originalRenderCanvas,it.render(this,{renderTexture:gt,clear:!0,transform:wt,skipUpdateTransform:!1}),it.canvasContext.activeContext=ft,it._projTransform=mt,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=lt;const vt=new Sprite(gt);vt.transform.worldTransform=this.transform.worldTransform,vt.anchor.x=-(_.x/_.width),vt.anchor.y=-(_.y/_.height),vt.alpha=lt,vt._bounds=this._bounds,this._cacheData.sprite=vt,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=it._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=vt.containsPoint.bind(vt)};DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function(it){this.cacheAsBitmap=!1,this.destroy(it)};DisplayObject.prototype.name=null;Container.prototype.getChildByName=function(it,_){for(let lt=0,ft=this.children.length;lt<ft;lt++)if(this.children[lt].name===it)return this.children[lt];if(_)for(let lt=0,ft=this.children.length;lt<ft;lt++){const mt=this.children[lt];if(!mt.getChildByName)continue;const pt=mt.getChildByName(it,!0);if(pt)return pt}return null};DisplayObject.prototype.getGlobalPosition=function(it=new Point,_=!1){return this.parent?this.parent.toGlobal(this.position,it,_):(it.x=this.position.x,it.y=this.position.y),it};var fragment$6=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class AlphaFilter extends Filter{constructor(_=1){super(defaultVertex,fragment$6,{uAlpha:1}),this.alpha=_}get alpha(){return this.uniforms.uAlpha}set alpha(_){this.uniforms.uAlpha=_}}const GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function generateBlurFragSource(it){const _=GAUSSIAN_VALUES[it],lt=_.length;let ft=fragTemplate,mt="";const pt="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let gt;for(let bt=0;bt<it;bt++){let wt=pt.replace("%index%",bt.toString());gt=bt,bt>=lt&&(gt=it-bt-1),wt=wt.replace("%value%",_[gt].toString()),mt+=wt,mt+=`
`}return ft=ft.replace("%blur%",mt),ft=ft.replace("%size%",it.toString()),ft}const vertTemplate=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function generateBlurVertSource(it,_){const lt=Math.ceil(it/2);let ft=vertTemplate,mt="",pt;_?pt="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":pt="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let gt=0;gt<it;gt++){let bt=pt.replace("%index%",gt.toString());bt=bt.replace("%sampleIndex%",`${gt-(lt-1)}.0`),mt+=bt,mt+=`
`}return ft=ft.replace("%blur%",mt),ft=ft.replace("%size%",it.toString()),ft}class BlurFilterPass extends Filter{constructor(_,lt=8,ft=4,mt=Filter.defaultResolution,pt=5){const gt=generateBlurVertSource(pt,_),bt=generateBlurFragSource(pt);super(gt,bt),this.horizontal=_,this.resolution=mt,this._quality=0,this.quality=ft,this.blur=lt}apply(_,lt,ft,mt){if(ft?this.horizontal?this.uniforms.strength=1/ft.width*(ft.width/lt.width):this.uniforms.strength=1/ft.height*(ft.height/lt.height):this.horizontal?this.uniforms.strength=1/_.renderer.width*(_.renderer.width/lt.width):this.uniforms.strength=1/_.renderer.height*(_.renderer.height/lt.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)_.applyFilter(this,lt,ft,mt);else{const pt=_.getFilterTexture(),gt=_.renderer;let bt=lt,wt=pt;this.state.blend=!1,_.applyFilter(this,bt,wt,CLEAR_MODES.CLEAR);for(let vt=1;vt<this.passes-1;vt++){_.bindAndClear(bt,CLEAR_MODES.BLIT),this.uniforms.uSampler=wt;const Ct=wt;wt=bt,bt=Ct,gt.shader.bind(this),gt.geometry.draw(5)}this.state.blend=!0,_.applyFilter(this,wt,ft,mt),_.returnFilterTexture(pt)}}get blur(){return this.strength}set blur(_){this.padding=1+Math.abs(_)*2,this.strength=_}get quality(){return this._quality}set quality(_){this._quality=_,this.passes=_}}class BlurFilter extends Filter{constructor(_=8,lt=4,ft=Filter.defaultResolution,mt=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new BlurFilterPass(!0,_,lt,ft,mt),this.blurYFilter=new BlurFilterPass(!1,_,lt,ft,mt),this.resolution=ft,this.quality=lt,this.blur=_,this.repeatEdgePixels=!1}apply(_,lt,ft,mt){const pt=Math.abs(this.blurXFilter.strength),gt=Math.abs(this.blurYFilter.strength);if(pt&&gt){const bt=_.getFilterTexture();this.blurXFilter.apply(_,lt,bt,CLEAR_MODES.CLEAR),this.blurYFilter.apply(_,bt,ft,mt),_.returnFilterTexture(bt)}else gt?this.blurYFilter.apply(_,lt,ft,mt):this.blurXFilter.apply(_,lt,ft,mt)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(_){this.blurXFilter.blur=this.blurYFilter.blur=_,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(_){this.blurXFilter.quality=this.blurYFilter.quality=_}get blurX(){return this.blurXFilter.blur}set blurX(_){this.blurXFilter.blur=_,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(_){this.blurYFilter.blur=_,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(_){this.blurYFilter.blendMode=_}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(_){this._repeatEdgePixels=_,this.updatePadding()}}var fragment$5=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ColorMatrixFilter extends Filter{constructor(){const _={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(defaultFilterVertex,fragment$5,_),this.alpha=1}_loadMatrix(_,lt=!1){let ft=_;lt&&(this._multiply(ft,this.uniforms.m,_),ft=this._colorMatrix(ft)),this.uniforms.m=ft}_multiply(_,lt,ft){return _[0]=lt[0]*ft[0]+lt[1]*ft[5]+lt[2]*ft[10]+lt[3]*ft[15],_[1]=lt[0]*ft[1]+lt[1]*ft[6]+lt[2]*ft[11]+lt[3]*ft[16],_[2]=lt[0]*ft[2]+lt[1]*ft[7]+lt[2]*ft[12]+lt[3]*ft[17],_[3]=lt[0]*ft[3]+lt[1]*ft[8]+lt[2]*ft[13]+lt[3]*ft[18],_[4]=lt[0]*ft[4]+lt[1]*ft[9]+lt[2]*ft[14]+lt[3]*ft[19]+lt[4],_[5]=lt[5]*ft[0]+lt[6]*ft[5]+lt[7]*ft[10]+lt[8]*ft[15],_[6]=lt[5]*ft[1]+lt[6]*ft[6]+lt[7]*ft[11]+lt[8]*ft[16],_[7]=lt[5]*ft[2]+lt[6]*ft[7]+lt[7]*ft[12]+lt[8]*ft[17],_[8]=lt[5]*ft[3]+lt[6]*ft[8]+lt[7]*ft[13]+lt[8]*ft[18],_[9]=lt[5]*ft[4]+lt[6]*ft[9]+lt[7]*ft[14]+lt[8]*ft[19]+lt[9],_[10]=lt[10]*ft[0]+lt[11]*ft[5]+lt[12]*ft[10]+lt[13]*ft[15],_[11]=lt[10]*ft[1]+lt[11]*ft[6]+lt[12]*ft[11]+lt[13]*ft[16],_[12]=lt[10]*ft[2]+lt[11]*ft[7]+lt[12]*ft[12]+lt[13]*ft[17],_[13]=lt[10]*ft[3]+lt[11]*ft[8]+lt[12]*ft[13]+lt[13]*ft[18],_[14]=lt[10]*ft[4]+lt[11]*ft[9]+lt[12]*ft[14]+lt[13]*ft[19]+lt[14],_[15]=lt[15]*ft[0]+lt[16]*ft[5]+lt[17]*ft[10]+lt[18]*ft[15],_[16]=lt[15]*ft[1]+lt[16]*ft[6]+lt[17]*ft[11]+lt[18]*ft[16],_[17]=lt[15]*ft[2]+lt[16]*ft[7]+lt[17]*ft[12]+lt[18]*ft[17],_[18]=lt[15]*ft[3]+lt[16]*ft[8]+lt[17]*ft[13]+lt[18]*ft[18],_[19]=lt[15]*ft[4]+lt[16]*ft[9]+lt[17]*ft[14]+lt[18]*ft[19]+lt[19],_}_colorMatrix(_){const lt=new Float32Array(_);return lt[4]/=255,lt[9]/=255,lt[14]/=255,lt[19]/=255,lt}brightness(_,lt){const ft=[_,0,0,0,0,0,_,0,0,0,0,0,_,0,0,0,0,0,1,0];this._loadMatrix(ft,lt)}tint(_,lt){const[ft,mt,pt]=Color.shared.setValue(_).toArray(),gt=[ft,0,0,0,0,0,mt,0,0,0,0,0,pt,0,0,0,0,0,1,0];this._loadMatrix(gt,lt)}greyscale(_,lt){const ft=[_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,0,0,0,1,0];this._loadMatrix(ft,lt)}blackAndWhite(_){const lt=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(lt,_)}hue(_,lt){_=(_||0)/180*Math.PI;const ft=Math.cos(_),mt=Math.sin(_),pt=Math.sqrt,gt=1/3,bt=pt(gt),wt=ft+(1-ft)*gt,vt=gt*(1-ft)-bt*mt,Ct=gt*(1-ft)+bt*mt,Rt=gt*(1-ft)+bt*mt,Mt=ft+gt*(1-ft),Ot=gt*(1-ft)-bt*mt,Nt=gt*(1-ft)-bt*mt,Ht=gt*(1-ft)+bt*mt,Kt=ft+gt*(1-ft),hr=[wt,vt,Ct,0,0,Rt,Mt,Ot,0,0,Nt,Ht,Kt,0,0,0,0,0,1,0];this._loadMatrix(hr,lt)}contrast(_,lt){const ft=(_||0)+1,mt=-.5*(ft-1),pt=[ft,0,0,0,mt,0,ft,0,0,mt,0,0,ft,0,mt,0,0,0,1,0];this._loadMatrix(pt,lt)}saturate(_=0,lt){const ft=_*2/3+1,mt=(ft-1)*-.5,pt=[ft,mt,mt,0,0,mt,ft,mt,0,0,mt,mt,ft,0,0,0,0,0,1,0];this._loadMatrix(pt,lt)}desaturate(){this.saturate(-1)}negative(_){const lt=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(lt,_)}sepia(_){const lt=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(lt,_)}technicolor(_){const lt=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(lt,_)}polaroid(_){const lt=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(lt,_)}toBGR(_){const lt=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(lt,_)}kodachrome(_){const lt=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(lt,_)}browni(_){const lt=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(lt,_)}vintage(_){const lt=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(lt,_)}colorTone(_,lt,ft,mt,pt){_=_||.2,lt=lt||.15,ft=ft||16770432,mt=mt||3375104;const gt=Color.shared,[bt,wt,vt]=gt.setValue(ft).toArray(),[Ct,Rt,Mt]=gt.setValue(mt).toArray(),Ot=[.3,.59,.11,0,0,bt,wt,vt,_,0,Ct,Rt,Mt,lt,0,bt-Ct,wt-Rt,vt-Mt,0,0];this._loadMatrix(Ot,pt)}night(_,lt){_=_||.1;const ft=[_*-2,-_,0,0,0,-_,0,_,0,0,0,_,_*2,0,0,0,0,0,1,0];this._loadMatrix(ft,lt)}predator(_,lt){const ft=[11.224130630493164*_,-4.794486999511719*_,-2.8746118545532227*_,0*_,.40342438220977783*_,-3.6330697536468506*_,9.193157196044922*_,-2.951810836791992*_,0*_,-1.316135048866272*_,-3.2184197902679443*_,-4.2375030517578125*_,7.476448059082031*_,0*_,.8044459223747253*_,0,0,0,1,0];this._loadMatrix(ft,lt)}lsd(_){const lt=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(lt,_)}reset(){const _=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(_,!1)}get matrix(){return this.uniforms.m}set matrix(_){this.uniforms.m=_}get alpha(){return this.uniforms.uAlpha}set alpha(_){this.uniforms.uAlpha=_}}ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;var fragment$4=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,vertex$3=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class DisplacementFilter extends Filter{constructor(_,lt){const ft=new Matrix;_.renderable=!1,super(vertex$3,fragment$4,{mapSampler:_._texture,filterMatrix:ft,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=_,this.maskMatrix=ft,lt==null&&(lt=20),this.scale=new Point(lt,lt)}apply(_,lt,ft,mt){this.uniforms.filterMatrix=_.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const pt=this.maskSprite.worldTransform,gt=Math.sqrt(pt.a*pt.a+pt.b*pt.b),bt=Math.sqrt(pt.c*pt.c+pt.d*pt.d);gt!==0&&bt!==0&&(this.uniforms.rotation[0]=pt.a/gt,this.uniforms.rotation[1]=pt.b/gt,this.uniforms.rotation[2]=pt.c/bt,this.uniforms.rotation[3]=pt.d/bt),_.applyFilter(this,lt,ft,mt)}get map(){return this.uniforms.mapSampler}set map(_){this.uniforms.mapSampler=_}}var fragment$3=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,vertex$2=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class FXAAFilter extends Filter{constructor(){super(vertex$2,fragment$3)}}var fragment$2=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class NoiseFilter extends Filter{constructor(_=.5,lt=Math.random()){super(defaultFilterVertex,fragment$2,{uNoise:0,uSeed:0}),this.noise=_,this.seed=lt}get noise(){return this.uniforms.uNoise}set noise(_){this.uniforms.uNoise=_}get seed(){return this.uniforms.uSeed}set seed(_){this.uniforms.uSeed=_}}const filters={AlphaFilter,BlurFilter,BlurFilterPass,ColorMatrixFilter,DisplacementFilter,FXAAFilter,NoiseFilter};Object.entries(filters).forEach(([it,_])=>{Object.defineProperty(filters,it,{get(){return deprecation("7.1.0",`filters.${it} has moved to ${it}`),_}})});class EventsTickerClass{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(_){this.removeTickerListener(),this.events=_,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(_){this._pauseUpdate=_}addTickerListener(){this.tickerAdded||!this.domElement||(Ticker.system.add(this.tickerUpdate,this,UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ticker.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const _=this.events.rootPointerEvent;this.events.supportsTouchEvents&&_.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:_.clientX,clientY:_.clientY}))}tickerUpdate(_){this._deltaTime+=_,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const EventsTicker=new EventsTickerClass;class FederatedEvent{constructor(_){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=FederatedEvent.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Point,this.page=new Point,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=_}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(_,lt,ft){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(_,lt,ft,mt,pt){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class FederatedMouseEvent extends FederatedEvent{constructor(){super(...arguments),this.client=new Point,this.movement=new Point,this.offset=new Point,this.global=new Point,this.screen=new Point}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(_,lt,ft){return _.worldTransform.applyInverse(ft||this.global,lt)}getModifierState(_){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(_)}initMouseEvent(_,lt,ft,mt,pt,gt,bt,wt,vt,Ct,Rt,Mt,Ot,Nt,Ht){throw new Error("Method not implemented.")}}class FederatedPointerEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class FederatedWheelEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}FederatedWheelEvent.DOM_DELTA_PIXEL=0,FederatedWheelEvent.DOM_DELTA_LINE=1,FederatedWheelEvent.DOM_DELTA_PAGE=2;const PROPAGATION_LIMIT=2048,tempHitLocation=new Point,tempLocalMapping=new Point;class EventBoundary{constructor(_){this.dispatch=new EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=_,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(_,lt){this.mappingTable[_]||(this.mappingTable[_]=[]),this.mappingTable[_].push({fn:lt,priority:0}),this.mappingTable[_].sort((ft,mt)=>ft.priority-mt.priority)}dispatchEvent(_,lt){_.propagationStopped=!1,_.propagationImmediatelyStopped=!1,this.propagate(_,lt),this.dispatch.emit(lt||_.type,_)}mapEvent(_){if(!this.rootTarget)return;const lt=this.mappingTable[_.type];if(lt)for(let ft=0,mt=lt.length;ft<mt;ft++)lt[ft].fn(_);else console.warn(`[EventBoundary]: Event mapping not defined for ${_.type}`)}hitTest(_,lt){EventsTicker.pauseUpdate=!0;const ft=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",mt=this[ft](this.rootTarget,this.rootTarget.eventMode,tempHitLocation.set(_,lt),this.hitTestFn,this.hitPruneFn);return mt&&mt[0]}propagate(_,lt){if(!_.target)return;const ft=_.composedPath();_.eventPhase=_.CAPTURING_PHASE;for(let mt=0,pt=ft.length-1;mt<pt;mt++)if(_.currentTarget=ft[mt],this.notifyTarget(_,lt),_.propagationStopped||_.propagationImmediatelyStopped)return;if(_.eventPhase=_.AT_TARGET,_.currentTarget=_.target,this.notifyTarget(_,lt),!(_.propagationStopped||_.propagationImmediatelyStopped)){_.eventPhase=_.BUBBLING_PHASE;for(let mt=ft.length-2;mt>=0;mt--)if(_.currentTarget=ft[mt],this.notifyTarget(_,lt),_.propagationStopped||_.propagationImmediatelyStopped)return}}all(_,lt,ft=this._allInteractiveElements){if(ft.length===0)return;_.eventPhase=_.BUBBLING_PHASE;const mt=Array.isArray(lt)?lt:[lt];for(let pt=ft.length-1;pt>=0;pt--)mt.forEach(gt=>{_.currentTarget=ft[pt],this.notifyTarget(_,gt)})}propagationPath(_){const lt=[_];for(let ft=0;ft<PROPAGATION_LIMIT&&_!==this.rootTarget;ft++){if(!_.parent)throw new Error("Cannot find propagation path to disconnected target");lt.push(_.parent),_=_.parent}return lt.reverse(),lt}hitTestMoveRecursive(_,lt,ft,mt,pt,gt=!1){let bt=!1;if(this._interactivePrune(_))return null;if((_.eventMode==="dynamic"||lt==="dynamic")&&(EventsTicker.pauseUpdate=!1),_.interactiveChildren&&_.children){const Ct=_.children;for(let Rt=Ct.length-1;Rt>=0;Rt--){const Mt=Ct[Rt],Ot=this.hitTestMoveRecursive(Mt,this._isInteractive(lt)?lt:Mt.eventMode,ft,mt,pt,gt||pt(_,ft));if(Ot){if(Ot.length>0&&!Ot[Ot.length-1].parent)continue;const Nt=_.isInteractive();(Ot.length>0||Nt)&&(Nt&&this._allInteractiveElements.push(_),Ot.push(_)),this._hitElements.length===0&&(this._hitElements=Ot),bt=!0}}}const wt=this._isInteractive(lt),vt=_.isInteractive();return wt&&vt&&this._allInteractiveElements.push(_),gt||this._hitElements.length>0?null:bt?this._hitElements:wt&&!pt(_,ft)&&mt(_,ft)?vt?[_]:[]:null}hitTestRecursive(_,lt,ft,mt,pt){if(this._interactivePrune(_)||pt(_,ft))return null;if((_.eventMode==="dynamic"||lt==="dynamic")&&(EventsTicker.pauseUpdate=!1),_.interactiveChildren&&_.children){const wt=_.children;for(let vt=wt.length-1;vt>=0;vt--){const Ct=wt[vt],Rt=this.hitTestRecursive(Ct,this._isInteractive(lt)?lt:Ct.eventMode,ft,mt,pt);if(Rt){if(Rt.length>0&&!Rt[Rt.length-1].parent)continue;const Mt=_.isInteractive();return(Rt.length>0||Mt)&&Rt.push(_),Rt}}}const gt=this._isInteractive(lt),bt=_.isInteractive();return gt&&mt(_,ft)?bt?[_]:[]:null}_isInteractive(_){return _==="static"||_==="dynamic"}_interactivePrune(_){return!!(!_||_.isMask||!_.visible||!_.renderable||_.eventMode==="none"||_.eventMode==="passive"&&!_.interactiveChildren||_.isMask)}hitPruneFn(_,lt){var ft;if(_.hitArea&&(_.worldTransform.applyInverse(lt,tempLocalMapping),!_.hitArea.contains(tempLocalMapping.x,tempLocalMapping.y)))return!0;if(_._mask){const mt=_._mask.isMaskData?_._mask.maskObject:_._mask;if(mt&&!((ft=mt.containsPoint)!=null&&ft.call(mt,lt)))return!0}return!1}hitTestFn(_,lt){return _.eventMode==="passive"?!1:_.hitArea?!0:_.containsPoint?_.containsPoint(lt):!1}notifyTarget(_,lt){var pt,gt;lt=lt??_.type;const ft=`on${lt}`;(gt=(pt=_.currentTarget)[ft])==null||gt.call(pt,_);const mt=_.eventPhase===_.CAPTURING_PHASE||_.eventPhase===_.AT_TARGET?`${lt}capture`:lt;this.notifyListeners(_,mt),_.eventPhase===_.AT_TARGET&&this.notifyListeners(_,lt)}mapPointerDown(_){if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const lt=this.createPointerEvent(_);if(this.dispatchEvent(lt,"pointerdown"),lt.pointerType==="touch")this.dispatchEvent(lt,"touchstart");else if(lt.pointerType==="mouse"||lt.pointerType==="pen"){const mt=lt.button===2;this.dispatchEvent(lt,mt?"rightdown":"mousedown")}const ft=this.trackingData(_.pointerId);ft.pressTargetsByButton[_.button]=lt.composedPath(),this.freeEvent(lt)}mapPointerMove(_){var wt,vt;if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const lt=this.createPointerEvent(_);this._isPointerMoveEvent=!1;const ft=lt.pointerType==="mouse"||lt.pointerType==="pen",mt=this.trackingData(_.pointerId),pt=this.findMountedTarget(mt.overTargets);if(((wt=mt.overTargets)==null?void 0:wt.length)>0&&pt!==lt.target){const Ct=_.type==="mousemove"?"mouseout":"pointerout",Rt=this.createPointerEvent(_,Ct,pt);if(this.dispatchEvent(Rt,"pointerout"),ft&&this.dispatchEvent(Rt,"mouseout"),!lt.composedPath().includes(pt)){const Mt=this.createPointerEvent(_,"pointerleave",pt);for(Mt.eventPhase=Mt.AT_TARGET;Mt.target&&!lt.composedPath().includes(Mt.target);)Mt.currentTarget=Mt.target,this.notifyTarget(Mt),ft&&this.notifyTarget(Mt,"mouseleave"),Mt.target=Mt.target.parent;this.freeEvent(Mt)}this.freeEvent(Rt)}if(pt!==lt.target){const Ct=_.type==="mousemove"?"mouseover":"pointerover",Rt=this.clonePointerEvent(lt,Ct);this.dispatchEvent(Rt,"pointerover"),ft&&this.dispatchEvent(Rt,"mouseover");let Mt=pt==null?void 0:pt.parent;for(;Mt&&Mt!==this.rootTarget.parent&&Mt!==lt.target;)Mt=Mt.parent;if(!Mt||Mt===this.rootTarget.parent){const Ot=this.clonePointerEvent(lt,"pointerenter");for(Ot.eventPhase=Ot.AT_TARGET;Ot.target&&Ot.target!==pt&&Ot.target!==this.rootTarget.parent;)Ot.currentTarget=Ot.target,this.notifyTarget(Ot),ft&&this.notifyTarget(Ot,"mouseenter"),Ot.target=Ot.target.parent;this.freeEvent(Ot)}this.freeEvent(Rt)}const gt=[],bt=this.enableGlobalMoveEvents??!0;this.moveOnAll?gt.push("pointermove"):this.dispatchEvent(lt,"pointermove"),bt&&gt.push("globalpointermove"),lt.pointerType==="touch"&&(this.moveOnAll?gt.splice(1,0,"touchmove"):this.dispatchEvent(lt,"touchmove"),bt&&gt.push("globaltouchmove")),ft&&(this.moveOnAll?gt.splice(1,0,"mousemove"):this.dispatchEvent(lt,"mousemove"),bt&&gt.push("globalmousemove"),this.cursor=(vt=lt.target)==null?void 0:vt.cursor),gt.length>0&&this.all(lt,gt),this._allInteractiveElements.length=0,this._hitElements.length=0,mt.overTargets=lt.composedPath(),this.freeEvent(lt)}mapPointerOver(_){var gt;if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const lt=this.trackingData(_.pointerId),ft=this.createPointerEvent(_),mt=ft.pointerType==="mouse"||ft.pointerType==="pen";this.dispatchEvent(ft,"pointerover"),mt&&this.dispatchEvent(ft,"mouseover"),ft.pointerType==="mouse"&&(this.cursor=(gt=ft.target)==null?void 0:gt.cursor);const pt=this.clonePointerEvent(ft,"pointerenter");for(pt.eventPhase=pt.AT_TARGET;pt.target&&pt.target!==this.rootTarget.parent;)pt.currentTarget=pt.target,this.notifyTarget(pt),mt&&this.notifyTarget(pt,"mouseenter"),pt.target=pt.target.parent;lt.overTargets=ft.composedPath(),this.freeEvent(ft),this.freeEvent(pt)}mapPointerOut(_){if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const lt=this.trackingData(_.pointerId);if(lt.overTargets){const ft=_.pointerType==="mouse"||_.pointerType==="pen",mt=this.findMountedTarget(lt.overTargets),pt=this.createPointerEvent(_,"pointerout",mt);this.dispatchEvent(pt),ft&&this.dispatchEvent(pt,"mouseout");const gt=this.createPointerEvent(_,"pointerleave",mt);for(gt.eventPhase=gt.AT_TARGET;gt.target&&gt.target!==this.rootTarget.parent;)gt.currentTarget=gt.target,this.notifyTarget(gt),ft&&this.notifyTarget(gt,"mouseleave"),gt.target=gt.target.parent;lt.overTargets=null,this.freeEvent(pt),this.freeEvent(gt)}this.cursor=null}mapPointerUp(_){if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const lt=performance.now(),ft=this.createPointerEvent(_);if(this.dispatchEvent(ft,"pointerup"),ft.pointerType==="touch")this.dispatchEvent(ft,"touchend");else if(ft.pointerType==="mouse"||ft.pointerType==="pen"){const bt=ft.button===2;this.dispatchEvent(ft,bt?"rightup":"mouseup")}const mt=this.trackingData(_.pointerId),pt=this.findMountedTarget(mt.pressTargetsByButton[_.button]);let gt=pt;if(pt&&!ft.composedPath().includes(pt)){let bt=pt;for(;bt&&!ft.composedPath().includes(bt);){if(ft.currentTarget=bt,this.notifyTarget(ft,"pointerupoutside"),ft.pointerType==="touch")this.notifyTarget(ft,"touchendoutside");else if(ft.pointerType==="mouse"||ft.pointerType==="pen"){const wt=ft.button===2;this.notifyTarget(ft,wt?"rightupoutside":"mouseupoutside")}bt=bt.parent}delete mt.pressTargetsByButton[_.button],gt=bt}if(gt){const bt=this.clonePointerEvent(ft,"click");bt.target=gt,bt.path=null,mt.clicksByButton[_.button]||(mt.clicksByButton[_.button]={clickCount:0,target:bt.target,timeStamp:lt});const wt=mt.clicksByButton[_.button];if(wt.target===bt.target&&lt-wt.timeStamp<200?++wt.clickCount:wt.clickCount=1,wt.target=bt.target,wt.timeStamp=lt,bt.detail=wt.clickCount,bt.pointerType==="mouse"){const vt=bt.button===2;this.dispatchEvent(bt,vt?"rightclick":"click")}else bt.pointerType==="touch"&&this.dispatchEvent(bt,"tap");this.dispatchEvent(bt,"pointertap"),this.freeEvent(bt)}this.freeEvent(ft)}mapPointerUpOutside(_){if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const lt=this.trackingData(_.pointerId),ft=this.findMountedTarget(lt.pressTargetsByButton[_.button]),mt=this.createPointerEvent(_);if(ft){let pt=ft;for(;pt;)mt.currentTarget=pt,this.notifyTarget(mt,"pointerupoutside"),mt.pointerType==="touch"?this.notifyTarget(mt,"touchendoutside"):(mt.pointerType==="mouse"||mt.pointerType==="pen")&&this.notifyTarget(mt,mt.button===2?"rightupoutside":"mouseupoutside"),pt=pt.parent;delete lt.pressTargetsByButton[_.button]}this.freeEvent(mt)}mapWheel(_){if(!(_ instanceof FederatedWheelEvent)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const lt=this.createWheelEvent(_);this.dispatchEvent(lt),this.freeEvent(lt)}findMountedTarget(_){if(!_)return null;let lt=_[0];for(let ft=1;ft<_.length&&_[ft].parent===lt;ft++)lt=_[ft];return lt}createPointerEvent(_,lt,ft){const mt=this.allocateEvent(FederatedPointerEvent);return this.copyPointerData(_,mt),this.copyMouseData(_,mt),this.copyData(_,mt),mt.nativeEvent=_.nativeEvent,mt.originalEvent=_,mt.target=ft??this.hitTest(mt.global.x,mt.global.y)??this._hitElements[0],typeof lt=="string"&&(mt.type=lt),mt}createWheelEvent(_){const lt=this.allocateEvent(FederatedWheelEvent);return this.copyWheelData(_,lt),this.copyMouseData(_,lt),this.copyData(_,lt),lt.nativeEvent=_.nativeEvent,lt.originalEvent=_,lt.target=this.hitTest(lt.global.x,lt.global.y),lt}clonePointerEvent(_,lt){const ft=this.allocateEvent(FederatedPointerEvent);return ft.nativeEvent=_.nativeEvent,ft.originalEvent=_.originalEvent,this.copyPointerData(_,ft),this.copyMouseData(_,ft),this.copyData(_,ft),ft.target=_.target,ft.path=_.composedPath().slice(),ft.type=lt??ft.type,ft}copyWheelData(_,lt){lt.deltaMode=_.deltaMode,lt.deltaX=_.deltaX,lt.deltaY=_.deltaY,lt.deltaZ=_.deltaZ}copyPointerData(_,lt){_ instanceof FederatedPointerEvent&&lt instanceof FederatedPointerEvent&&(lt.pointerId=_.pointerId,lt.width=_.width,lt.height=_.height,lt.isPrimary=_.isPrimary,lt.pointerType=_.pointerType,lt.pressure=_.pressure,lt.tangentialPressure=_.tangentialPressure,lt.tiltX=_.tiltX,lt.tiltY=_.tiltY,lt.twist=_.twist)}copyMouseData(_,lt){_ instanceof FederatedMouseEvent&&lt instanceof FederatedMouseEvent&&(lt.altKey=_.altKey,lt.button=_.button,lt.buttons=_.buttons,lt.client.copyFrom(_.client),lt.ctrlKey=_.ctrlKey,lt.metaKey=_.metaKey,lt.movement.copyFrom(_.movement),lt.screen.copyFrom(_.screen),lt.shiftKey=_.shiftKey,lt.global.copyFrom(_.global))}copyData(_,lt){lt.isTrusted=_.isTrusted,lt.srcElement=_.srcElement,lt.timeStamp=performance.now(),lt.type=_.type,lt.detail=_.detail,lt.view=_.view,lt.which=_.which,lt.layer.copyFrom(_.layer),lt.page.copyFrom(_.page)}trackingData(_){return this.mappingState.trackingData[_]||(this.mappingState.trackingData[_]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[_]}allocateEvent(_){this.eventPool.has(_)||this.eventPool.set(_,[]);const lt=this.eventPool.get(_).pop()||new _(this);return lt.eventPhase=lt.NONE,lt.currentTarget=null,lt.path=null,lt.target=null,lt}freeEvent(_){if(_.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const lt=_.constructor;this.eventPool.has(lt)||this.eventPool.set(lt,[]),this.eventPool.get(lt).push(_)}notifyListeners(_,lt){const ft=_.currentTarget._events[lt];if(ft&&_.currentTarget.isInteractive())if("fn"in ft)ft.once&&_.currentTarget.removeListener(lt,ft.fn,void 0,!0),ft.fn.call(ft.context,_);else for(let mt=0,pt=ft.length;mt<pt&&!_.propagationImmediatelyStopped;mt++)ft[mt].once&&_.currentTarget.removeListener(lt,ft[mt].fn,void 0,!0),ft[mt].fn.call(ft[mt].context,_)}}const MOUSE_POINTER_ID=1,TOUCH_TO_POINTER={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},_EventSystem=class tv{constructor(_){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=_,this.rootBoundary=new EventBoundary(null),EventsTicker.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new FederatedPointerEvent(null),this.rootWheelEvent=new FederatedWheelEvent(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...tv.defaultEventFeatures},{set:(lt,ft,mt)=>(ft==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=mt),lt[ft]=mt,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(_){const{view:lt,resolution:ft}=this.renderer;this.setTargetElement(lt),this.resolution=ft,tv._defaultEventMode=_.eventMode??"auto",Object.assign(this.features,_.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(_){this.resolution=_}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(_){_=_||"default";let lt=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(lt=!1),this.currentCursor===_)return;this.currentCursor=_;const ft=this.cursorStyles[_];if(ft)switch(typeof ft){case"string":lt&&(this.domElement.style.cursor=ft);break;case"function":ft(_);break;case"object":lt&&Object.assign(this.domElement.style,ft);break}else lt&&typeof _=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,_)&&(this.domElement.style.cursor=_)}get pointer(){return this.rootPointerEvent}onPointerDown(_){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const lt=this.normalizeToPointerData(_);this.autoPreventDefault&&lt[0].isNormalized&&(_.cancelable||!("cancelable"in _))&&_.preventDefault();for(let ft=0,mt=lt.length;ft<mt;ft++){const pt=lt[ft],gt=this.bootstrapEvent(this.rootPointerEvent,pt);this.rootBoundary.mapEvent(gt)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(_){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,EventsTicker.pointerMoved();const lt=this.normalizeToPointerData(_);for(let ft=0,mt=lt.length;ft<mt;ft++){const pt=this.bootstrapEvent(this.rootPointerEvent,lt[ft]);this.rootBoundary.mapEvent(pt)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(_){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let lt=_.target;_.composedPath&&_.composedPath().length>0&&(lt=_.composedPath()[0]);const ft=lt!==this.domElement?"outside":"",mt=this.normalizeToPointerData(_);for(let pt=0,gt=mt.length;pt<gt;pt++){const bt=this.bootstrapEvent(this.rootPointerEvent,mt[pt]);bt.type+=ft,this.rootBoundary.mapEvent(bt)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(_){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const lt=this.normalizeToPointerData(_);for(let ft=0,mt=lt.length;ft<mt;ft++){const pt=this.bootstrapEvent(this.rootPointerEvent,lt[ft]);this.rootBoundary.mapEvent(pt)}this.setCursor(this.rootBoundary.cursor)}onWheel(_){if(!this.features.wheel)return;const lt=this.normalizeWheelEvent(_);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(lt)}setTargetElement(_){this.removeEvents(),this.domElement=_,EventsTicker.domElement=_,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;EventsTicker.addTickerListener();const _=this.domElement.style;_&&(globalThis.navigator.msPointerEnabled?(_.msContentZooming="none",_.msTouchAction="none"):this.supportsPointerEvents&&(_.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;EventsTicker.removeTickerListener();const _=this.domElement.style;globalThis.navigator.msPointerEnabled?(_.msContentZooming="",_.msTouchAction=""):this.supportsPointerEvents&&(_.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(_,lt,ft){const mt=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},pt=1/this.resolution;_.x=(lt-mt.left)*(this.domElement.width/mt.width)*pt,_.y=(ft-mt.top)*(this.domElement.height/mt.height)*pt}normalizeToPointerData(_){const lt=[];if(this.supportsTouchEvents&&_ instanceof TouchEvent)for(let ft=0,mt=_.changedTouches.length;ft<mt;ft++){const pt=_.changedTouches[ft];typeof pt.button>"u"&&(pt.button=0),typeof pt.buttons>"u"&&(pt.buttons=1),typeof pt.isPrimary>"u"&&(pt.isPrimary=_.touches.length===1&&_.type==="touchstart"),typeof pt.width>"u"&&(pt.width=pt.radiusX||1),typeof pt.height>"u"&&(pt.height=pt.radiusY||1),typeof pt.tiltX>"u"&&(pt.tiltX=0),typeof pt.tiltY>"u"&&(pt.tiltY=0),typeof pt.pointerType>"u"&&(pt.pointerType="touch"),typeof pt.pointerId>"u"&&(pt.pointerId=pt.identifier||0),typeof pt.pressure>"u"&&(pt.pressure=pt.force||.5),typeof pt.twist>"u"&&(pt.twist=0),typeof pt.tangentialPressure>"u"&&(pt.tangentialPressure=0),typeof pt.layerX>"u"&&(pt.layerX=pt.offsetX=pt.clientX),typeof pt.layerY>"u"&&(pt.layerY=pt.offsetY=pt.clientY),pt.isNormalized=!0,pt.type=_.type,lt.push(pt)}else if(!globalThis.MouseEvent||_ instanceof MouseEvent&&(!this.supportsPointerEvents||!(_ instanceof globalThis.PointerEvent))){const ft=_;typeof ft.isPrimary>"u"&&(ft.isPrimary=!0),typeof ft.width>"u"&&(ft.width=1),typeof ft.height>"u"&&(ft.height=1),typeof ft.tiltX>"u"&&(ft.tiltX=0),typeof ft.tiltY>"u"&&(ft.tiltY=0),typeof ft.pointerType>"u"&&(ft.pointerType="mouse"),typeof ft.pointerId>"u"&&(ft.pointerId=MOUSE_POINTER_ID),typeof ft.pressure>"u"&&(ft.pressure=.5),typeof ft.twist>"u"&&(ft.twist=0),typeof ft.tangentialPressure>"u"&&(ft.tangentialPressure=0),ft.isNormalized=!0,lt.push(ft)}else lt.push(_);return lt}normalizeWheelEvent(_){const lt=this.rootWheelEvent;return this.transferMouseData(lt,_),lt.deltaX=_.deltaX,lt.deltaY=_.deltaY,lt.deltaZ=_.deltaZ,lt.deltaMode=_.deltaMode,this.mapPositionToPoint(lt.screen,_.clientX,_.clientY),lt.global.copyFrom(lt.screen),lt.offset.copyFrom(lt.screen),lt.nativeEvent=_,lt.type=_.type,lt}bootstrapEvent(_,lt){return _.originalEvent=null,_.nativeEvent=lt,_.pointerId=lt.pointerId,_.width=lt.width,_.height=lt.height,_.isPrimary=lt.isPrimary,_.pointerType=lt.pointerType,_.pressure=lt.pressure,_.tangentialPressure=lt.tangentialPressure,_.tiltX=lt.tiltX,_.tiltY=lt.tiltY,_.twist=lt.twist,this.transferMouseData(_,lt),this.mapPositionToPoint(_.screen,lt.clientX,lt.clientY),_.global.copyFrom(_.screen),_.offset.copyFrom(_.screen),_.isTrusted=lt.isTrusted,_.type==="pointerleave"&&(_.type="pointerout"),_.type.startsWith("mouse")&&(_.type=_.type.replace("mouse","pointer")),_.type.startsWith("touch")&&(_.type=TOUCH_TO_POINTER[_.type]||_.type),_}transferMouseData(_,lt){_.isTrusted=lt.isTrusted,_.srcElement=lt.srcElement,_.timeStamp=performance.now(),_.type=lt.type,_.altKey=lt.altKey,_.button=lt.button,_.buttons=lt.buttons,_.client.x=lt.clientX,_.client.y=lt.clientY,_.ctrlKey=lt.ctrlKey,_.metaKey=lt.metaKey,_.movement.x=lt.movementX,_.movement.y=lt.movementY,_.page.x=lt.pageX,_.page.y=lt.pageY,_.relatedTarget=null,_.shiftKey=lt.shiftKey}};_EventSystem.extension={name:"events",type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem]},_EventSystem.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let EventSystem=_EventSystem;extensions$1.add(EventSystem);function convertEventModeToInteractiveMode(it){return it==="dynamic"||it==="static"}const FederatedDisplayObject={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??convertEventModeToInteractiveMode(EventSystem.defaultEventMode)},set interactive(it){deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=it,this.eventMode=it?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??EventSystem.defaultEventMode},set eventMode(it){this._internalInteractive=convertEventModeToInteractiveMode(it),this._internalEventMode=it},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(it,_,lt){const ft=typeof lt=="boolean"&&lt||typeof lt=="object"&&lt.capture,mt=typeof lt=="object"?lt.signal:void 0,pt=typeof lt=="object"?lt.once===!0:!1,gt=typeof _=="function"?void 0:_;it=ft?`${it}capture`:it;const bt=typeof _=="function"?_:_.handleEvent,wt=this;mt&&mt.addEventListener("abort",()=>{wt.off(it,bt,gt)}),pt?wt.once(it,bt,gt):wt.on(it,bt,gt)},removeEventListener(it,_,lt){const ft=typeof lt=="boolean"&&lt||typeof lt=="object"&&lt.capture,mt=typeof _=="function"?void 0:_;it=ft?`${it}capture`:it,_=typeof _=="function"?_:_.handleEvent,this.off(it,_,mt)},dispatchEvent(it){if(!(it instanceof FederatedEvent))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return it.defaultPrevented=!1,it.path=null,it.target=this,it.manager.dispatchEvent(it),!it.defaultPrevented}};DisplayObject.mixin(FederatedDisplayObject);const accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};DisplayObject.mixin(accessibleTarget);const KEY_CODE_TAB=9,DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,DIV_HOOK_SIZE=1,DIV_HOOK_POS_X=-1e3,DIV_HOOK_POS_Y=-1e3,DIV_HOOK_ZINDEX=2;class AccessibilityManager{constructor(_){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(isMobile$1.tablet||isMobile$1.phone)&&this.createTouchHook();const lt=document.createElement("div");lt.style.width=`${DIV_TOUCH_SIZE}px`,lt.style.height=`${DIV_TOUCH_SIZE}px`,lt.style.position="absolute",lt.style.top=`${DIV_TOUCH_POS_X}px`,lt.style.left=`${DIV_TOUCH_POS_Y}px`,lt.style.zIndex=DIV_TOUCH_ZINDEX.toString(),this.div=lt,this.renderer=_,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const _=document.createElement("button");_.style.width=`${DIV_HOOK_SIZE}px`,_.style.height=`${DIV_HOOK_SIZE}px`,_.style.position="absolute",_.style.top=`${DIV_HOOK_POS_X}px`,_.style.left=`${DIV_HOOK_POS_Y}px`,_.style.zIndex=DIV_HOOK_ZINDEX.toString(),_.style.backgroundColor="#FF0000",_.title="select to enable accessibility for this content",_.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(_),this._hookDiv=_}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var _;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(_=this.renderer.view.parentNode)==null||_.appendChild(this.div))}deactivate(){var _;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(_=this.div.parentNode)==null||_.removeChild(this.div))}updateAccessibleObjects(_){if(!_.visible||!_.accessibleChildren)return;_.accessible&&_.isInteractive()&&(_._accessibleActive||this.addChild(_),_.renderId=this.renderId);const lt=_.children;if(lt)for(let ft=0;ft<lt.length;ft++)this.updateAccessibleObjects(lt[ft])}update(){const _=performance.now();if(isMobile$1.android.device&&_<this.androidUpdateCount||(this.androidUpdateCount=_+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:lt,y:ft,width:mt,height:pt}=this.renderer.view.getBoundingClientRect(),{width:gt,height:bt,resolution:wt}=this.renderer,vt=mt/gt*wt,Ct=pt/bt*wt;let Rt=this.div;Rt.style.left=`${lt}px`,Rt.style.top=`${ft}px`,Rt.style.width=`${gt}px`,Rt.style.height=`${bt}px`;for(let Mt=0;Mt<this.children.length;Mt++){const Ot=this.children[Mt];if(Ot.renderId!==this.renderId)Ot._accessibleActive=!1,removeItems(this.children,Mt,1),this.div.removeChild(Ot._accessibleDiv),this.pool.push(Ot._accessibleDiv),Ot._accessibleDiv=null,Mt--;else{Rt=Ot._accessibleDiv;let Nt=Ot.hitArea;const Ht=Ot.worldTransform;Ot.hitArea?(Rt.style.left=`${(Ht.tx+Nt.x*Ht.a)*vt}px`,Rt.style.top=`${(Ht.ty+Nt.y*Ht.d)*Ct}px`,Rt.style.width=`${Nt.width*Ht.a*vt}px`,Rt.style.height=`${Nt.height*Ht.d*Ct}px`):(Nt=Ot.getBounds(),this.capHitArea(Nt),Rt.style.left=`${Nt.x*vt}px`,Rt.style.top=`${Nt.y*Ct}px`,Rt.style.width=`${Nt.width*vt}px`,Rt.style.height=`${Nt.height*Ct}px`,Rt.title!==Ot.accessibleTitle&&Ot.accessibleTitle!==null&&(Rt.title=Ot.accessibleTitle),Rt.getAttribute("aria-label")!==Ot.accessibleHint&&Ot.accessibleHint!==null&&Rt.setAttribute("aria-label",Ot.accessibleHint)),(Ot.accessibleTitle!==Rt.title||Ot.tabIndex!==Rt.tabIndex)&&(Rt.title=Ot.accessibleTitle,Rt.tabIndex=Ot.tabIndex,this.debug&&this.updateDebugHTML(Rt))}}this.renderId++}updateDebugHTML(_){_.innerHTML=`type: ${_.type}</br> title : ${_.title}</br> tabIndex: ${_.tabIndex}`}capHitArea(_){_.x<0&&(_.width+=_.x,_.x=0),_.y<0&&(_.height+=_.y,_.y=0);const{width:lt,height:ft}=this.renderer;_.x+_.width>lt&&(_.width=lt-_.x),_.y+_.height>ft&&(_.height=ft-_.y)}addChild(_){let lt=this.pool.pop();lt||(lt=document.createElement("button"),lt.style.width=`${DIV_TOUCH_SIZE}px`,lt.style.height=`${DIV_TOUCH_SIZE}px`,lt.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",lt.style.position="absolute",lt.style.zIndex=DIV_TOUCH_ZINDEX.toString(),lt.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?lt.setAttribute("aria-live","off"):lt.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?lt.setAttribute("aria-relevant","additions"):lt.setAttribute("aria-relevant","text"),lt.addEventListener("click",this._onClick.bind(this)),lt.addEventListener("focus",this._onFocus.bind(this)),lt.addEventListener("focusout",this._onFocusOut.bind(this))),lt.style.pointerEvents=_.accessiblePointerEvents,lt.type=_.accessibleType,_.accessibleTitle&&_.accessibleTitle!==null?lt.title=_.accessibleTitle:(!_.accessibleHint||_.accessibleHint===null)&&(lt.title=`displayObject ${_.tabIndex}`),_.accessibleHint&&_.accessibleHint!==null&&lt.setAttribute("aria-label",_.accessibleHint),this.debug&&this.updateDebugHTML(lt),_._accessibleActive=!0,_._accessibleDiv=lt,lt.displayObject=_,this.children.push(_),this.div.appendChild(_._accessibleDiv),_._accessibleDiv.tabIndex=_.tabIndex}_dispatchEvent(_,lt){const{displayObject:ft}=_.target,mt=this.renderer.events.rootBoundary,pt=Object.assign(new FederatedEvent(mt),{target:ft});mt.rootTarget=this.renderer.lastObjectRendered,lt.forEach(gt=>mt.dispatchEvent(pt,gt))}_onClick(_){this._dispatchEvent(_,["click","pointertap","tap"])}_onFocus(_){_.target.getAttribute("aria-live")||_.target.setAttribute("aria-live","assertive"),this._dispatchEvent(_,["mouseover"])}_onFocusOut(_){_.target.getAttribute("aria-live")||_.target.setAttribute("aria-live","polite"),this._dispatchEvent(_,["mouseout"])}_onKeyDown(_){_.keyCode===KEY_CODE_TAB&&this.activate()}_onMouseMove(_){_.movementX===0&&_.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}AccessibilityManager.extension={name:"accessibility",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]};extensions$1.add(AccessibilityManager);const _Application=class rv{constructor(_){this.stage=new Container,_=Object.assign({forceCanvas:!1},_),this.renderer=autoDetectRenderer(_),rv._plugins.forEach(lt=>{lt.init.call(this,_)})}render(){this.renderer.render(this.stage)}get view(){var _;return(_=this.renderer)==null?void 0:_.view}get screen(){var _;return(_=this.renderer)==null?void 0:_.screen}destroy(_,lt){const ft=rv._plugins.slice(0);ft.reverse(),ft.forEach(mt=>{mt.destroy.call(this)}),this.stage.destroy(lt),this.stage=null,this.renderer.destroy(_),this.renderer=null}};_Application._plugins=[];let Application=_Application;extensions$1.handleByList(ExtensionType.Application,Application._plugins);class ResizePlugin{static init(_){Object.defineProperty(this,"resizeTo",{set(lt){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=lt,lt&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let lt,ft;if(this._resizeTo===globalThis.window)lt=globalThis.innerWidth,ft=globalThis.innerHeight;else{const{clientWidth:mt,clientHeight:pt}=this._resizeTo;lt=mt,ft=pt}this.renderer.resize(lt,ft),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=_.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ResizePlugin.extension=ExtensionType.Application;extensions$1.add(ResizePlugin);const assetKeyMap={loader:ExtensionType.LoadParser,resolver:ExtensionType.ResolveParser,cache:ExtensionType.CacheParser,detection:ExtensionType.DetectionParser};extensions$1.handle(ExtensionType.Asset,it=>{const _=it.ref;Object.entries(assetKeyMap).filter(([lt])=>!!_[lt]).forEach(([lt,ft])=>extensions$1.add(Object.assign(_[lt],{extension:_[lt].extension??ft})))},it=>{const _=it.ref;Object.keys(assetKeyMap).filter(lt=>!!_[lt]).forEach(lt=>extensions$1.remove(_[lt]))});class BackgroundLoader{constructor(_,lt=!1){this._loader=_,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=lt}add(_){_.forEach(lt=>{this._assetList.push(lt)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const _=[],lt=Math.min(this._assetList.length,this._maxConcurrent);for(let ft=0;ft<lt;ft++)_.push(this._assetList.pop());await this._loader.load(_),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(_){this._isActive!==_&&(this._isActive=_,_&&!this._isLoading&&this._next())}}function checkDataUrl(it,_){if(Array.isArray(_)){for(const lt of _)if(it.startsWith(`data:${lt}`))return!0;return!1}return it.startsWith(`data:${_}`)}function checkExtension(it,_){const lt=it.split("?")[0],ft=path.extname(lt).toLowerCase();return Array.isArray(_)?_.includes(ft):ft===_}const convertToList=(it,_,lt=!1)=>(Array.isArray(it)||(it=[it]),_?it.map(ft=>typeof ft=="string"||lt?_(ft):ft):it),copySearchParams=(it,_)=>{const lt=_.split("?")[1];return lt&&(it+=`?${lt}`),it};function processX(it,_,lt,ft,mt){const pt=_[lt];for(let gt=0;gt<pt.length;gt++){const bt=pt[gt];lt<_.length-1?processX(it.replace(ft[lt],bt),_,lt+1,ft,mt):mt.push(it.replace(ft[lt],bt))}}function createStringVariations(it){const _=/\{(.*?)\}/g,lt=it.match(_),ft=[];if(lt){const mt=[];lt.forEach(pt=>{const gt=pt.substring(1,pt.length-1).split(",");mt.push(gt)}),processX(it,mt,0,lt,ft)}else ft.push(it);return ft}const isSingleItem=it=>!Array.isArray(it);class CacheClass{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(_){return this._cache.has(_)}get(_){const lt=this._cache.get(_);return lt||console.warn(`[Assets] Asset id ${_} was not found in the Cache`),lt}set(_,lt){const ft=convertToList(_);let mt;for(let bt=0;bt<this.parsers.length;bt++){const wt=this.parsers[bt];if(wt.test(lt)){mt=wt.getCacheableAssets(ft,lt);break}}mt||(mt={},ft.forEach(bt=>{mt[bt]=lt}));const pt=Object.keys(mt),gt={cacheKeys:pt,keys:ft};if(ft.forEach(bt=>{this._cacheMap.set(bt,gt)}),pt.forEach(bt=>{this._cache.has(bt)&&this._cache.get(bt)!==lt&&console.warn("[Cache] already has key:",bt),this._cache.set(bt,mt[bt])}),lt instanceof Texture){const bt=lt;ft.forEach(wt=>{bt.baseTexture!==Texture.EMPTY.baseTexture&&BaseTexture.addToCache(bt.baseTexture,wt),Texture.addToCache(bt,wt)})}}remove(_){if(!this._cacheMap.has(_)){console.warn(`[Assets] Asset id ${_} was not found in the Cache`);return}const lt=this._cacheMap.get(_);lt.cacheKeys.forEach(ft=>{this._cache.delete(ft)}),lt.keys.forEach(ft=>{this._cacheMap.delete(ft)})}get parsers(){return this._parsers}}const Cache=new CacheClass;class Loader{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(_,lt,ft)=>(this._parsersValidated=!1,_[lt]=ft,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(_,lt){const ft={promise:null,parser:null};return ft.promise=(async()=>{var gt,bt;let mt=null,pt=null;if(lt.loadParser&&(pt=this._parserHash[lt.loadParser],pt||console.warn(`[Assets] specified load parser "${lt.loadParser}" not found while loading ${_}`)),!pt){for(let wt=0;wt<this.parsers.length;wt++){const vt=this.parsers[wt];if(vt.load&&((gt=vt.test)!=null&&gt.call(vt,_,lt,this))){pt=vt;break}}if(!pt)return console.warn(`[Assets] ${_} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}mt=await pt.load(_,lt,this),ft.parser=pt;for(let wt=0;wt<this.parsers.length;wt++){const vt=this.parsers[wt];vt.parse&&vt.parse&&await((bt=vt.testParse)==null?void 0:bt.call(vt,mt,lt,this))&&(mt=await vt.parse(mt,lt,this)||mt,ft.parser=vt)}return mt})(),ft}async load(_,lt){this._parsersValidated||this._validateParsers();let ft=0;const mt={},pt=isSingleItem(_),gt=convertToList(_,vt=>({alias:[vt],src:vt})),bt=gt.length,wt=gt.map(async vt=>{const Ct=path.toAbsolute(vt.src);if(!mt[vt.src])try{this.promiseCache[Ct]||(this.promiseCache[Ct]=this._getLoadPromiseAndParser(Ct,vt)),mt[vt.src]=await this.promiseCache[Ct].promise,lt&&lt(++ft/bt)}catch(Rt){throw delete this.promiseCache[Ct],delete mt[vt.src],new Error(`[Loader.load] Failed to load ${Ct}.
${Rt}`)}});return await Promise.all(wt),pt?mt[gt[0].src]:mt}async unload(_){const lt=convertToList(_,ft=>({alias:[ft],src:ft})).map(async ft=>{var gt,bt;const mt=path.toAbsolute(ft.src),pt=this.promiseCache[mt];if(pt){const wt=await pt.promise;delete this.promiseCache[mt],(bt=(gt=pt.parser)==null?void 0:gt.unload)==null||bt.call(gt,wt,ft,this)}});await Promise.all(lt)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(_=>_.name).reduce((_,lt)=>(_[lt.name]&&console.warn(`[Assets] loadParser name conflict "${lt.name}"`),{..._,[lt.name]:lt}),{})}}var LoaderParserPriority=(it=>(it[it.Low=0]="Low",it[it.Normal=1]="Normal",it[it.High=2]="High",it))(LoaderParserPriority||{});const validJSONExtension=".json",validJSONMIME="application/json",loadJson={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},name:"loadJson",test(it){return checkDataUrl(it,validJSONMIME)||checkExtension(it,validJSONExtension)},async load(it){return await(await settings.ADAPTER.fetch(it)).json()}};extensions$1.add(loadJson);const validTXTExtension=".txt",validTXTMIME="text/plain",loadTxt={name:"loadTxt",extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test(it){return checkDataUrl(it,validTXTMIME)||checkExtension(it,validTXTExtension)},async load(it){return await(await settings.ADAPTER.fetch(it)).text()}};extensions$1.add(loadTxt);const validWeights=["normal","bold","100","200","300","400","500","600","700","800","900"],validFontExtensions=[".ttf",".otf",".woff",".woff2"],validFontMIMEs=["font/ttf","font/otf","font/woff","font/woff2"],CSS_IDENT_TOKEN_REGEX=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function getFontFamilyName(it){const _=path.extname(it),lt=path.basename(it,_).replace(/(-|_)/g," ").toLowerCase().split(" ").map(pt=>pt.charAt(0).toUpperCase()+pt.slice(1));let ft=lt.length>0;for(const pt of lt)if(!pt.match(CSS_IDENT_TOKEN_REGEX)){ft=!1;break}let mt=lt.join(" ");return ft||(mt=`"${mt.replace(/[\\"]/g,"\\$&")}"`),mt}const validURICharactersRegex=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function encodeURIWhenNeeded(it){return validURICharactersRegex.test(it)?it:encodeURI(it)}const loadWebFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},name:"loadWebFont",test(it){return checkDataUrl(it,validFontMIMEs)||checkExtension(it,validFontExtensions)},async load(it,_){var ft,mt,pt;const lt=settings.ADAPTER.getFontFaceSet();if(lt){const gt=[],bt=((ft=_.data)==null?void 0:ft.family)??getFontFamilyName(it),wt=((pt=(mt=_.data)==null?void 0:mt.weights)==null?void 0:pt.filter(Ct=>validWeights.includes(Ct)))??["normal"],vt=_.data??{};for(let Ct=0;Ct<wt.length;Ct++){const Rt=wt[Ct],Mt=new FontFace(bt,`url(${encodeURIWhenNeeded(it)})`,{...vt,weight:Rt});await Mt.load(),lt.add(Mt),gt.push(Mt)}return gt.length===1?gt[0]:gt}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(it){(Array.isArray(it)?it:[it]).forEach(_=>settings.ADAPTER.getFontFaceSet().delete(_))}};extensions$1.add(loadWebFont);const WORKER_CODE$1=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let WORKER_URL$1=null,WorkerInstance$1=class{constructor(){WORKER_URL$1||(WORKER_URL$1=URL.createObjectURL(new Blob([WORKER_CODE$1],{type:"application/javascript"}))),this.worker=new Worker(WORKER_URL$1)}};WorkerInstance$1.revokeObjectURL=function(){WORKER_URL$1&&(URL.revokeObjectURL(WORKER_URL$1),WORKER_URL$1=null)};const WORKER_CODE=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let WORKER_URL=null;class WorkerInstance{constructor(){WORKER_URL||(WORKER_URL=URL.createObjectURL(new Blob([WORKER_CODE],{type:"application/javascript"}))),this.worker=new Worker(WORKER_URL)}}WorkerInstance.revokeObjectURL=function(){WORKER_URL&&(URL.revokeObjectURL(WORKER_URL),WORKER_URL=null)};let UUID=0,MAX_WORKERS;class WorkerManagerClass{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(_=>{const{worker:lt}=new WorkerInstance$1;lt.addEventListener("message",ft=>{lt.terminate(),WorkerInstance$1.revokeObjectURL(),_(ft.data)})}),this._isImageBitmapSupported)}loadImageBitmap(_){return this._run("loadImageBitmap",[_])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){MAX_WORKERS===void 0&&(MAX_WORKERS=navigator.hardwareConcurrency||4);let _=this.workerPool.pop();return!_&&this._createdWorkers<MAX_WORKERS&&(this._createdWorkers++,_=new WorkerInstance().worker,_.addEventListener("message",lt=>{this.complete(lt.data),this.returnWorker(lt.target),this.next()})),_}returnWorker(_){this.workerPool.push(_)}complete(_){_.error!==void 0?this.resolveHash[_.uuid].reject(_.error):this.resolveHash[_.uuid].resolve(_.data),this.resolveHash[_.uuid]=null}async _run(_,lt){await this._initWorkers();const ft=new Promise((mt,pt)=>{this.queue.push({id:_,arguments:lt,resolve:mt,reject:pt})});return this.next(),ft}next(){if(!this.queue.length)return;const _=this.getWorker();if(!_)return;const lt=this.queue.pop(),ft=lt.id;this.resolveHash[UUID]={resolve:lt.resolve,reject:lt.reject},_.postMessage({data:lt.arguments,uuid:UUID++,id:ft})}}const WorkerManager=new WorkerManagerClass;function createTexture(it,_,lt){it.resource.internal=!0;const ft=new Texture(it),mt=()=>{delete _.promiseCache[lt],Cache.has(lt)&&Cache.remove(lt)};return ft.baseTexture.once("destroyed",()=>{lt in _.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),mt())}),ft.once("destroyed",()=>{it.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),mt())}),ft}const validImageExtensions=[".jpeg",".jpg",".png",".webp",".avif"],validImageMIMEs=["image/jpeg","image/png","image/webp","image/avif"];async function loadImageBitmap(it){const _=await settings.ADAPTER.fetch(it);if(!_.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${it}: ${_.status} ${_.statusText}`);const lt=await _.blob();return await createImageBitmap(lt)}const loadTextures={name:"loadTextures",extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(it){return checkDataUrl(it,validImageMIMEs)||checkExtension(it,validImageExtensions)},async load(it,_,lt){var bt;const ft=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let mt;ft?this.config.preferWorkers&&await WorkerManager.isImageBitmapSupported()?mt=await WorkerManager.loadImageBitmap(it):mt=await loadImageBitmap(it):mt=await new Promise((wt,vt)=>{const Ct=new Image;Ct.crossOrigin=this.config.crossOrigin,Ct.src=it,Ct.complete?wt(Ct):(Ct.onload=()=>wt(Ct),Ct.onerror=Rt=>vt(Rt))});const pt={..._.data};pt.resolution??(pt.resolution=getResolutionOfUrl(it)),ft&&((bt=pt.resourceOptions)==null?void 0:bt.ownsImageBitmap)===void 0&&(pt.resourceOptions={...pt.resourceOptions},pt.resourceOptions.ownsImageBitmap=!0);const gt=new BaseTexture(mt,pt);return gt.resource.src=it,createTexture(gt,lt,it)},unload(it){it.destroy(!0)}};extensions$1.add(loadTextures);const validSVGExtension=".svg",validSVGMIME="image/svg+xml",loadSVG={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},name:"loadSVG",test(it){return checkDataUrl(it,validSVGMIME)||checkExtension(it,validSVGExtension)},async testParse(it){return SVGResource.test(it)},async parse(it,_,lt){var pt;const ft=new SVGResource(it,(pt=_==null?void 0:_.data)==null?void 0:pt.resourceOptions);await ft.load();const mt=new BaseTexture(ft,{resolution:getResolutionOfUrl(it),..._==null?void 0:_.data});return mt.resource.src=_.src,createTexture(mt,lt,_.src)},async load(it,_){return(await settings.ADAPTER.fetch(it)).text()},unload:loadTextures.unload};extensions$1.add(loadSVG);const validVideoExtensions=[".mp4",".m4v",".webm",".ogv"],validVideoMIMEs=["video/mp4","video/webm","video/ogg"],loadVideo={name:"loadVideo",extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(it){return checkDataUrl(it,validVideoMIMEs)||checkExtension(it,validVideoExtensions)},async load(it,_,lt){var gt;let ft;const mt=await(await settings.ADAPTER.fetch(it)).blob(),pt=URL.createObjectURL(mt);try{const bt={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(gt=_==null?void 0:_.data)==null?void 0:gt.resourceOptions,autoLoad:!0},wt=new VideoResource(pt,bt);await wt.load();const vt=new BaseTexture(wt,{alphaMode:await detectVideoAlphaMode(),resolution:getResolutionOfUrl(it),..._==null?void 0:_.data});vt.resource.src=it,ft=createTexture(vt,lt,it),ft.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(pt)})}catch(bt){throw URL.revokeObjectURL(pt),bt}return ft},unload(it){it.destroy(!0)}};extensions$1.add(loadVideo);class Resolver{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(_,lt)=>`${_}${this._bundleIdConnector}${lt}`,extractAssetIdFromBundle:(_,lt)=>lt.replace(`${_}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(_){if(this._bundleIdConnector=_.connector??this._bundleIdConnector,this._createBundleAssetId=_.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=_.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(..._){_.forEach(lt=>{this._preferredOrder.push(lt),lt.priority||(lt.priority=Object.keys(lt.params))}),this._resolverHash={}}set basePath(_){this._basePath=_}get basePath(){return this._basePath}set rootPath(_){this._rootPath=_}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(_){if(typeof _=="string")this._defaultSearchParams=_;else{const lt=_;this._defaultSearchParams=Object.keys(lt).map(ft=>`${encodeURIComponent(ft)}=${encodeURIComponent(lt[ft])}`).join("&")}}getAlias(_){const{alias:lt,name:ft,src:mt,srcs:pt}=_;return convertToList(lt||ft||mt||pt,gt=>typeof gt=="string"?gt:Array.isArray(gt)?gt.map(bt=>(bt==null?void 0:bt.src)??(bt==null?void 0:bt.srcs)??bt):gt!=null&&gt.src||gt!=null&&gt.srcs?gt.src??gt.srcs:gt,!0)}addManifest(_){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=_,_.bundles.forEach(lt=>{this.addBundle(lt.name,lt.assets)})}addBundle(_,lt){const ft=[];Array.isArray(lt)?lt.forEach(mt=>{const pt=mt.src??mt.srcs,gt=mt.alias??mt.name;let bt;if(typeof gt=="string"){const wt=this._createBundleAssetId(_,gt);ft.push(wt),bt=[gt,wt]}else{const wt=gt.map(vt=>this._createBundleAssetId(_,vt));ft.push(...wt),bt=[...gt,...wt]}this.add({...mt,alias:bt,src:pt})}):Object.keys(lt).forEach(mt=>{const pt=[mt,this._createBundleAssetId(_,mt)];if(typeof lt[mt]=="string")this.add({alias:pt,src:lt[mt]});else if(Array.isArray(lt[mt]))this.add({alias:pt,src:lt[mt]});else{const gt=lt[mt],bt=gt.src??gt.srcs;this.add({...gt,alias:pt,src:Array.isArray(bt)?bt:[bt]})}ft.push(...pt)}),this._bundles[_]=ft}add(_,lt,ft,mt,pt){const gt=[];typeof _=="string"||Array.isArray(_)&&typeof _[0]=="string"?(deprecation("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),gt.push({alias:_,src:lt,data:ft,format:mt,loadParser:pt})):Array.isArray(_)?gt.push(..._):gt.push(_);let bt;bt=wt=>{this.hasKey(wt)&&console.warn(`[Resolver] already has key: ${wt} overwriting`)},convertToList(gt).forEach(wt=>{const{src:vt,srcs:Ct}=wt;let{data:Rt,format:Mt,loadParser:Ot}=wt;const Nt=convertToList(vt||Ct).map(hr=>typeof hr=="string"?createStringVariations(hr):Array.isArray(hr)?hr:[hr]),Ht=this.getAlias(wt);Array.isArray(Ht)?Ht.forEach(bt):bt(Ht);const Kt=[];Nt.forEach(hr=>{hr.forEach(Qt=>{let mr={};if(typeof Qt!="object"){mr.src=Qt;for(let br=0;br<this._parsers.length;br++){const Fr=this._parsers[br];if(Fr.test(Qt)){mr=Fr.parse(Qt);break}}}else Rt=Qt.data??Rt,Mt=Qt.format??Mt,Ot=Qt.loadParser??Ot,mr={...mr,...Qt};if(!Ht)throw new Error(`[Resolver] alias is undefined for this asset: ${mr.src}`);mr=this.buildResolvedAsset(mr,{aliases:Ht,data:Rt,format:Mt,loadParser:Ot}),Kt.push(mr)})}),Ht.forEach(hr=>{this._assetMap[hr]=Kt})})}resolveBundle(_){const lt=isSingleItem(_);_=convertToList(_);const ft={};return _.forEach(mt=>{const pt=this._bundles[mt];if(pt){const gt=this.resolve(pt),bt={};for(const wt in gt){const vt=gt[wt];bt[this._extractAssetIdFromBundle(mt,wt)]=vt}ft[mt]=bt}}),lt?ft[_[0]]:ft}resolveUrl(_){const lt=this.resolve(_);if(typeof _!="string"){const ft={};for(const mt in lt)ft[mt]=lt[mt].src;return ft}return lt.src}resolve(_){const lt=isSingleItem(_);_=convertToList(_);const ft={};return _.forEach(mt=>{if(!this._resolverHash[mt])if(this._assetMap[mt]){let pt=this._assetMap[mt];const gt=pt[0],bt=this._getPreferredOrder(pt);bt==null||bt.priority.forEach(wt=>{bt.params[wt].forEach(vt=>{const Ct=pt.filter(Rt=>Rt[wt]?Rt[wt]===vt:!1);Ct.length&&(pt=Ct)})}),this._resolverHash[mt]=pt[0]??gt}else this._resolverHash[mt]=this.buildResolvedAsset({alias:[mt],src:mt},{});ft[mt]=this._resolverHash[mt]}),lt?ft[_[0]]:ft}hasKey(_){return!!this._assetMap[_]}hasBundle(_){return!!this._bundles[_]}_getPreferredOrder(_){for(let lt=0;lt<_.length;lt++){const ft=_[0],mt=this._preferredOrder.find(pt=>pt.params.format.includes(ft.format));if(mt)return mt}return this._preferredOrder[0]}_appendDefaultSearchParams(_){if(!this._defaultSearchParams)return _;const lt=/\?/.test(_)?"&":"?";return`${_}${lt}${this._defaultSearchParams}`}buildResolvedAsset(_,lt){const{aliases:ft,data:mt,loadParser:pt,format:gt}=lt;return(this._basePath||this._rootPath)&&(_.src=path.toAbsolute(_.src,this._basePath,this._rootPath)),_.alias=ft??_.alias??[_.src],_.src=this._appendDefaultSearchParams(_.src),_.data={...mt||{},..._.data},_.loadParser=pt??_.loadParser,_.format=gt??_.format??path.extname(_.src).slice(1),_.srcs=_.src,_.name=_.alias,_}}class AssetsClass{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Resolver,this.loader=new Loader,this.cache=Cache,this._backgroundLoader=new BackgroundLoader(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(_={}){var pt,gt;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,_.defaultSearchParams&&this.resolver.setDefaultSearchParams(_.defaultSearchParams),_.basePath&&(this.resolver.basePath=_.basePath),_.bundleIdentifier&&this.resolver.setBundleIdentifier(_.bundleIdentifier),_.manifest){let bt=_.manifest;typeof bt=="string"&&(bt=await this.load(bt)),this.resolver.addManifest(bt)}const lt=((pt=_.texturePreference)==null?void 0:pt.resolution)??1,ft=typeof lt=="number"?[lt]:lt,mt=await this._detectFormats({preferredFormats:(gt=_.texturePreference)==null?void 0:gt.format,skipDetections:_.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:mt,resolution:ft}}),_.preferences&&this.setPreferences(_.preferences)}add(_,lt,ft,mt,pt){this.resolver.add(_,lt,ft,mt,pt)}async load(_,lt){this._initialized||await this.init();const ft=isSingleItem(_),mt=convertToList(_).map(bt=>{if(typeof bt!="string"){const wt=this.resolver.getAlias(bt);return wt.some(vt=>!this.resolver.hasKey(vt))&&this.add(bt),Array.isArray(wt)?wt[0]:wt}return this.resolver.hasKey(bt)||this.add({alias:bt,src:bt}),bt}),pt=this.resolver.resolve(mt),gt=await this._mapLoadToResolve(pt,lt);return ft?gt[mt[0]]:gt}addBundle(_,lt){this.resolver.addBundle(_,lt)}async loadBundle(_,lt){this._initialized||await this.init();let ft=!1;typeof _=="string"&&(ft=!0,_=[_]);const mt=this.resolver.resolveBundle(_),pt={},gt=Object.keys(mt);let bt=0,wt=0;const vt=()=>{lt==null||lt(++bt/wt)},Ct=gt.map(Rt=>{const Mt=mt[Rt];return wt+=Object.keys(Mt).length,this._mapLoadToResolve(Mt,vt).then(Ot=>{pt[Rt]=Ot})});return await Promise.all(Ct),ft?pt[_[0]]:pt}async backgroundLoad(_){this._initialized||await this.init(),typeof _=="string"&&(_=[_]);const lt=this.resolver.resolve(_);this._backgroundLoader.add(Object.values(lt))}async backgroundLoadBundle(_){this._initialized||await this.init(),typeof _=="string"&&(_=[_]);const lt=this.resolver.resolveBundle(_);Object.values(lt).forEach(ft=>{this._backgroundLoader.add(Object.values(ft))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(_){if(typeof _=="string")return Cache.get(_);const lt={};for(let ft=0;ft<_.length;ft++)lt[ft]=Cache.get(_[ft]);return lt}async _mapLoadToResolve(_,lt){const ft=Object.values(_),mt=Object.keys(_);this._backgroundLoader.active=!1;const pt=await this.loader.load(ft,lt);this._backgroundLoader.active=!0;const gt={};return ft.forEach((bt,wt)=>{const vt=pt[bt.src],Ct=[bt.src];bt.alias&&Ct.push(...bt.alias),gt[mt[wt]]=vt,Cache.set(Ct,vt)}),gt}async unload(_){this._initialized||await this.init();const lt=convertToList(_).map(mt=>typeof mt!="string"?mt.src:mt),ft=this.resolver.resolve(lt);await this._unloadFromResolved(ft)}async unloadBundle(_){this._initialized||await this.init(),_=convertToList(_);const lt=this.resolver.resolveBundle(_),ft=Object.keys(lt).map(mt=>this._unloadFromResolved(lt[mt]));await Promise.all(ft)}async _unloadFromResolved(_){const lt=Object.values(_);lt.forEach(ft=>{Cache.remove(ft.src)}),await this.loader.unload(lt)}async _detectFormats(_){let lt=[];_.preferredFormats&&(lt=Array.isArray(_.preferredFormats)?_.preferredFormats:[_.preferredFormats]);for(const ft of _.detections)_.skipDetections||await ft.test()?lt=await ft.add(lt):_.skipDetections||(lt=await ft.remove(lt));return lt=lt.filter((ft,mt)=>lt.indexOf(ft)===mt),lt}get detections(){return this._detections}get preferWorkers(){return loadTextures.config.preferWorkers}set preferWorkers(_){deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:_})}setPreferences(_){this.loader.parsers.forEach(lt=>{lt.config&&Object.keys(lt.config).filter(ft=>ft in _).forEach(ft=>{lt.config[ft]=_[ft]})})}}const Assets=new AssetsClass;extensions$1.handleByList(ExtensionType.LoadParser,Assets.loader.parsers).handleByList(ExtensionType.ResolveParser,Assets.resolver.parsers).handleByList(ExtensionType.CacheParser,Assets.cache.parsers).handleByList(ExtensionType.DetectionParser,Assets.detections);const cacheTextureArray={extension:ExtensionType.CacheParser,test:it=>Array.isArray(it)&&it.every(_=>_ instanceof Texture),getCacheableAssets:(it,_)=>{const lt={};return it.forEach(ft=>{_.forEach((mt,pt)=>{lt[ft+(pt===0?"":pt+1)]=mt})}),lt}};extensions$1.add(cacheTextureArray);async function testImageFormat(it){if("Image"in globalThis)return new Promise(_=>{const lt=new Image;lt.onload=()=>{_(!0)},lt.onerror=()=>{_(!1)},lt.src=it});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const _=await(await fetch(it)).blob();await createImageBitmap(_)}catch{return!1}return!0}return!1}const detectAvif={extension:{type:ExtensionType.DetectionParser,priority:1},test:async()=>testImageFormat("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async it=>[...it,"avif"],remove:async it=>it.filter(_=>_!=="avif")};extensions$1.add(detectAvif);const detectWebp={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>testImageFormat("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async it=>[...it,"webp"],remove:async it=>it.filter(_=>_!=="webp")};extensions$1.add(detectWebp);const imageFormats=["png","jpg","jpeg"],detectDefaults={extension:{type:ExtensionType.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async it=>[...it,...imageFormats],remove:async it=>it.filter(_=>!imageFormats.includes(_))};extensions$1.add(detectDefaults);const inWorker="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function testVideoFormat(it){return inWorker?!1:document.createElement("video").canPlayType(it)!==""}const detectWebm={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>testVideoFormat("video/webm"),add:async it=>[...it,"webm"],remove:async it=>it.filter(_=>_!=="webm")};extensions$1.add(detectWebm);const detectMp4={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>testVideoFormat("video/mp4"),add:async it=>[...it,"mp4","m4v"],remove:async it=>it.filter(_=>_!=="mp4"&&_!=="m4v")};extensions$1.add(detectMp4);const detectOgv={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>testVideoFormat("video/ogg"),add:async it=>[...it,"ogv"],remove:async it=>it.filter(_=>_!=="ogv")};extensions$1.add(detectOgv);const resolveTextureUrl={extension:ExtensionType.ResolveParser,test:loadTextures.test,parse:it=>{var _;return{resolution:parseFloat(((_=settings.RETINA_PREFIX.exec(it))==null?void 0:_[1])??"1"),format:path.extname(it).slice(1),src:it}}};extensions$1.add(resolveTextureUrl);var INTERNAL_FORMATS=(it=>(it[it.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",it[it.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",it[it.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",it[it.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",it[it.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",it[it.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",it[it.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",it[it.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",it[it.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",it[it.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",it[it.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",it[it.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",it[it.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",it[it.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",it[it.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",it[it.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",it[it.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",it[it.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",it[it.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",it[it.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",it[it.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",it[it.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",it[it.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",it[it.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",it[it.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",it[it.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",it[it.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",it[it.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",it[it.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",it[it.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",it[it.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",it))(INTERNAL_FORMATS||{});const INTERNAL_FORMAT_TO_BYTES_PER_PIXEL={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let storedGl,extensions;function getCompressedTextureExtensions(){extensions={bptc:storedGl.getExtension("EXT_texture_compression_bptc"),astc:storedGl.getExtension("WEBGL_compressed_texture_astc"),etc:storedGl.getExtension("WEBGL_compressed_texture_etc"),s3tc:storedGl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:storedGl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:storedGl.getExtension("WEBGL_compressed_texture_pvrtc")||storedGl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:storedGl.getExtension("WEBGL_compressed_texture_etc1"),atc:storedGl.getExtension("WEBGL_compressed_texture_atc")}}const detectCompressedTextures={extension:{type:ExtensionType.DetectionParser,priority:2},test:async()=>{const it=settings.ADAPTER.createCanvas().getContext("webgl");return it?(storedGl=it,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async it=>{extensions||getCompressedTextureExtensions();const _=[];for(const lt in extensions)extensions[lt]&&_.push(lt);return[..._,...it]},remove:async it=>(extensions||getCompressedTextureExtensions(),it.filter(_=>!(_ in extensions)))};extensions$1.add(detectCompressedTextures);class BlobResource extends BufferResource{constructor(_,lt={width:1,height:1,autoLoad:!0}){let ft,mt;typeof _=="string"?(ft=_,mt=new Uint8Array):(ft=null,mt=_),super(mt,lt),this.origin=ft,this.buffer=mt?new ViewableBuffer(mt):null,this._load=null,this.loaded=!1,this.origin!==null&&lt.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(_){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(_=>_.blob()).then(_=>_.arrayBuffer()).then(_=>(this.data=new Uint32Array(_),this.buffer=new ViewableBuffer(_),this.loaded=!0,this.onBlobLoaded(_),this.update(),this)),this._load)}}class CompressedTextureResource extends BlobResource{constructor(_,lt){super(_,lt),this.format=lt.format,this.levels=lt.levels||1,this._width=lt.width,this._height=lt.height,this._extension=CompressedTextureResource._formatToExtension(this.format),(lt.levelBuffers||this.buffer)&&(this._levelBuffers=lt.levelBuffers||CompressedTextureResource._createLevelBuffers(_ instanceof Uint8Array?_:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(_,lt,ft){const mt=_.gl;if(!_.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;mt.pixelStorei(mt.UNPACK_ALIGNMENT,4);for(let pt=0,gt=this.levels;pt<gt;pt++){const{levelID:bt,levelWidth:wt,levelHeight:vt,levelBuffer:Ct}=this._levelBuffers[pt];mt.compressedTexImage2D(mt.TEXTURE_2D,bt,this.format,wt,vt,0,Ct)}return!0}onBlobLoaded(){this._levelBuffers=CompressedTextureResource._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(_){if(_>=33776&&_<=33779)return"s3tc";if(_>=35916&&_<=35919)return"s3tc_sRGB";if(_>=37488&&_<=37497)return"etc";if(_>=35840&&_<=35843)return"pvrtc";if(_===36196)return"etc1";if(_===35986||_===35987||_===34798)return"atc";if(_>=36492&&_<=36495)return"bptc";if(_===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${_}`)}static _createLevelBuffers(_,lt,ft,mt,pt,gt,bt){const wt=new Array(ft);let vt=_.byteOffset,Ct=gt,Rt=bt,Mt=Ct+mt-1&~(mt-1),Ot=Rt+pt-1&~(pt-1),Nt=Mt*Ot*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[lt];for(let Ht=0;Ht<ft;Ht++)wt[Ht]={levelID:Ht,levelWidth:ft>1?Ct:Mt,levelHeight:ft>1?Rt:Ot,levelBuffer:new Uint8Array(_.buffer,vt,Nt)},vt+=Nt,Ct=Ct>>1||1,Rt=Rt>>1||1,Mt=Ct+mt-1&~(mt-1),Ot=Rt+pt-1&~(pt-1),Nt=Mt*Ot*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[lt];return wt}}const DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT={[FOURCC_DXT1]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[FOURCC_DXT3]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[FOURCC_DXT5]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT},DXGI_TO_FORMAT={70:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:INTERNAL_FORMATS.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:INTERNAL_FORMATS.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:INTERNAL_FORMATS.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function parseDDS(it){const _=new Uint32Array(it);if(_[0]!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");const lt=new Uint32Array(it,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),ft=lt[DDS_FIELDS.HEIGHT],mt=lt[DDS_FIELDS.WIDTH],pt=lt[DDS_FIELDS.MIPMAP_COUNT],gt=new Uint32Array(it,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),bt=gt[PF_FLAGS];if(bt&DDPF_FOURCC){const wt=gt[DDS_PF_FIELDS.FOURCC];if(wt!==FOURCC_DX10){const Qt=FOURCC_TO_FORMAT[wt],mr=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,br=new Uint8Array(it,mr);return[new CompressedTextureResource(br,{format:Qt,width:mt,height:ft,levels:pt})]}const vt=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,Ct=new Uint32Array(_.buffer,vt,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),Rt=Ct[DDS_DX10_FIELDS.DXGI_FORMAT],Mt=Ct[DDS_DX10_FIELDS.RESOURCE_DIMENSION],Ot=Ct[DDS_DX10_FIELDS.MISC_FLAG],Nt=Ct[DDS_DX10_FIELDS.ARRAY_SIZE],Ht=DXGI_TO_FORMAT[Rt];if(Ht===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${Rt}`);if(Ot===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(Mt===6)throw new Error("DDSParser does not supported 3D texture data");const Kt=new Array,hr=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(Nt===1)Kt.push(new Uint8Array(it,hr));else{const Qt=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[Ht];let mr=0,br=mt,Fr=ft;for(let Br=0;Br<pt;Br++){const Nr=Math.max(1,br+3&-4),jn=Math.max(1,Fr+3&-4),Yn=Nr*jn*Qt;mr+=Yn,br=br>>>1,Fr=Fr>>>1}let kr=hr;for(let Br=0;Br<Nt;Br++)Kt.push(new Uint8Array(it,kr,mr)),kr+=mr}return Kt.map(Qt=>new CompressedTextureResource(Qt,{format:Ht,width:mt,height:ft,levels:pt}))}throw bt&DDPF_RGB?new Error("DDSParser does not support uncompressed texture data."):bt&DDPF_YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):bt&DDPF_LUMINANCE?new Error("DDSParser does not support single-channel (lumninance) texture data!"):bt&DDPF_ALPHA?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT={[TYPES.UNSIGNED_BYTE]:1,[TYPES.UNSIGNED_SHORT]:2,[TYPES.INT]:4,[TYPES.UNSIGNED_INT]:4,[TYPES.FLOAT]:4,[TYPES.HALF_FLOAT]:8},FORMATS_TO_COMPONENTS={[FORMATS.RGBA]:4,[FORMATS.RGB]:3,[FORMATS.RG]:2,[FORMATS.RED]:1,[FORMATS.LUMINANCE]:1,[FORMATS.LUMINANCE_ALPHA]:2,[FORMATS.ALPHA]:1},TYPES_TO_BYTES_PER_PIXEL={[TYPES.UNSIGNED_SHORT_4_4_4_4]:2,[TYPES.UNSIGNED_SHORT_5_5_5_1]:2,[TYPES.UNSIGNED_SHORT_5_6_5]:2};function parseKTX(it,_,lt=!1){const ft=new DataView(_);if(!validate(it,ft))return null;const mt=ft.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,pt=ft.getUint32(KTX_FIELDS.GL_TYPE,mt),gt=ft.getUint32(KTX_FIELDS.GL_FORMAT,mt),bt=ft.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,mt),wt=ft.getUint32(KTX_FIELDS.PIXEL_WIDTH,mt),vt=ft.getUint32(KTX_FIELDS.PIXEL_HEIGHT,mt)||1,Ct=ft.getUint32(KTX_FIELDS.PIXEL_DEPTH,mt)||1,Rt=ft.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,mt)||1,Mt=ft.getUint32(KTX_FIELDS.NUMBER_OF_FACES,mt),Ot=ft.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,mt),Nt=ft.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,mt);if(vt===0||Ct!==1)throw new Error("Only 2D textures are supported");if(Mt!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(Rt!==1)throw new Error("WebGL does not support array textures");const Ht=4,Kt=4,hr=wt+3&-4,Qt=vt+3&-4,mr=new Array(Rt);let br=wt*vt;pt===0&&(br=hr*Qt);let Fr;if(pt!==0?TYPES_TO_BYTES_PER_COMPONENT[pt]?Fr=TYPES_TO_BYTES_PER_COMPONENT[pt]*FORMATS_TO_COMPONENTS[gt]:Fr=TYPES_TO_BYTES_PER_PIXEL[pt]:Fr=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[bt],Fr===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const kr=lt?parseKvData(ft,Nt,mt):null;let Br=br*Fr,Nr=wt,jn=vt,Yn=hr,ga=Qt,Kn=FILE_HEADER_SIZE+Nt;for(let Xn=0;Xn<Ot;Xn++){const eo=ft.getUint32(Kn,mt);let lp=Kn+4;for(let $a=0;$a<Rt;$a++){let ro=mr[$a];ro||(ro=mr[$a]=new Array(Ot)),ro[Xn]={levelID:Xn,levelWidth:Ot>1||pt!==0?Nr:Yn,levelHeight:Ot>1||pt!==0?jn:ga,levelBuffer:new Uint8Array(_,lp,Br)},lp+=Br}Kn+=eo+4,Kn=Kn%4!==0?Kn+4-Kn%4:Kn,Nr=Nr>>1||1,jn=jn>>1||1,Yn=Nr+Ht-1&~(Ht-1),ga=jn+Kt-1&~(Kt-1),Br=Yn*ga*Fr}return pt!==0?{uncompressed:mr.map(Xn=>{let eo=Xn[0].levelBuffer,lp=!1;return pt===TYPES.FLOAT?eo=new Float32Array(Xn[0].levelBuffer.buffer,Xn[0].levelBuffer.byteOffset,Xn[0].levelBuffer.byteLength/4):pt===TYPES.UNSIGNED_INT?(lp=!0,eo=new Uint32Array(Xn[0].levelBuffer.buffer,Xn[0].levelBuffer.byteOffset,Xn[0].levelBuffer.byteLength/4)):pt===TYPES.INT&&(lp=!0,eo=new Int32Array(Xn[0].levelBuffer.buffer,Xn[0].levelBuffer.byteOffset,Xn[0].levelBuffer.byteLength/4)),{resource:new BufferResource(eo,{width:Xn[0].levelWidth,height:Xn[0].levelHeight}),type:pt,format:lp?convertFormatToInteger(gt):gt}}),kvData:kr}:{compressed:mr.map(Xn=>new CompressedTextureResource(null,{format:bt,width:wt,height:vt,levels:Ot,levelBuffers:Xn})),kvData:kr}}function validate(it,_){for(let lt=0;lt<FILE_IDENTIFIER.length;lt++)if(_.getUint8(lt)!==FILE_IDENTIFIER[lt])return console.error(`${it} is not a valid *.ktx file!`),!1;return!0}function convertFormatToInteger(it){switch(it){case FORMATS.RGBA:return FORMATS.RGBA_INTEGER;case FORMATS.RGB:return FORMATS.RGB_INTEGER;case FORMATS.RG:return FORMATS.RG_INTEGER;case FORMATS.RED:return FORMATS.RED_INTEGER;default:return it}}function parseKvData(it,_,lt){const ft=new Map;let mt=0;for(;mt<_;){const pt=it.getUint32(FILE_HEADER_SIZE+mt,lt),gt=FILE_HEADER_SIZE+mt+4,bt=3-(pt+3)%4;if(pt===0||pt>_-mt){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let wt=0;for(;wt<pt&&it.getUint8(gt+wt)!==0;wt++);if(wt===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const vt=new TextDecoder().decode(new Uint8Array(it.buffer,gt,wt)),Ct=new DataView(it.buffer,gt+wt+1,pt-wt-1);ft.set(vt,Ct),mt+=4+pt+bt}return ft}const loadDDS={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},name:"loadDDS",test(it){return checkExtension(it,".dds")},async load(it,_,lt){const ft=await(await settings.ADAPTER.fetch(it)).arrayBuffer(),mt=parseDDS(ft).map(pt=>{const gt=new BaseTexture(pt,{mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(it),..._.data});return createTexture(gt,lt,it)});return mt.length===1?mt[0]:mt},unload(it){Array.isArray(it)?it.forEach(_=>_.destroy(!0)):it.destroy(!0)}};extensions$1.add(loadDDS);const loadKTX={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},name:"loadKTX",test(it){return checkExtension(it,".ktx")},async load(it,_,lt){const ft=await(await settings.ADAPTER.fetch(it)).arrayBuffer(),{compressed:mt,uncompressed:pt,kvData:gt}=parseKTX(it,ft),bt=mt??pt,wt={mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(it),..._.data},vt=bt.map(Ct=>{bt===pt&&Object.assign(wt,{type:Ct.type,format:Ct.format});const Rt=Ct.resource??Ct,Mt=new BaseTexture(Rt,wt);return Mt.ktxKeyValueData=gt,createTexture(Mt,lt,it)});return vt.length===1?vt[0]:vt},unload(it){Array.isArray(it)?it.forEach(_=>_.destroy(!0)):it.destroy(!0)}};extensions$1.add(loadKTX);const knownFormats=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],resolveCompressedTextureUrl={extension:ExtensionType.ResolveParser,test:it=>{const _=path.extname(it).slice(1);return["basis","ktx","dds"].includes(_)},parse:it=>{var ft,mt;const _=it.split("."),lt=_.pop();if(["ktx","dds"].includes(lt)){const pt=_.pop();if(knownFormats.includes(pt))return{resolution:parseFloat(((ft=settings.RETINA_PREFIX.exec(it))==null?void 0:ft[1])??"1"),format:pt,src:it}}return{resolution:parseFloat(((mt=settings.RETINA_PREFIX.exec(it))==null?void 0:mt[1])??"1"),format:lt,src:it}}};extensions$1.add(resolveCompressedTextureUrl);const TEMP_RECT=new Rectangle,BYTES_PER_PIXEL=4,_Extract=class wy{constructor(_){this.renderer=_,this._rendererPremultipliedAlpha=!1}contextChange(){var lt;const _=(lt=this.renderer)==null?void 0:lt.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(_&&_.alpha&&_.premultipliedAlpha)}async image(_,lt,ft,mt){const pt=new Image;return pt.src=await this.base64(_,lt,ft,mt),pt}async base64(_,lt,ft,mt){const pt=this.canvas(_,mt);if(pt.toBlob!==void 0)return new Promise((gt,bt)=>{pt.toBlob(wt=>{if(!wt){bt(new Error("ICanvas.toBlob failed!"));return}const vt=new FileReader;vt.onload=()=>gt(vt.result),vt.onerror=bt,vt.readAsDataURL(wt)},lt,ft)});if(pt.toDataURL!==void 0)return pt.toDataURL(lt,ft);if(pt.convertToBlob!==void 0){const gt=await pt.convertToBlob({type:lt,quality:ft});return new Promise((bt,wt)=>{const vt=new FileReader;vt.onload=()=>bt(vt.result),vt.onerror=wt,vt.readAsDataURL(gt)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(_,lt){const{pixels:ft,width:mt,height:pt,flipY:gt,premultipliedAlpha:bt}=this._rawPixels(_,lt);gt&&wy._flipY(ft,mt,pt),bt&&wy._unpremultiplyAlpha(ft);const wt=new CanvasRenderTarget(mt,pt,1),vt=new ImageData(new Uint8ClampedArray(ft.buffer),mt,pt);return wt.context.putImageData(vt,0,0),wt.canvas}pixels(_,lt){const{pixels:ft,width:mt,height:pt,flipY:gt,premultipliedAlpha:bt}=this._rawPixels(_,lt);return gt&&wy._flipY(ft,mt,pt),bt&&wy._unpremultiplyAlpha(ft),ft}_rawPixels(_,lt){const ft=this.renderer;if(!ft)throw new Error("The Extract has already been destroyed");let mt,pt=!1,gt=!1,bt,wt=!1;_&&(_ instanceof RenderTexture?bt=_:(bt=ft.generateTexture(_,{region:lt,resolution:ft.resolution,multisample:ft.multisample}),wt=!0,lt&&(TEMP_RECT.width=lt.width,TEMP_RECT.height=lt.height,lt=TEMP_RECT)));const vt=ft.gl;if(bt){if(mt=bt.baseTexture.resolution,lt=lt??bt.frame,pt=!1,gt=bt.baseTexture.alphaMode>0&&bt.baseTexture.format===FORMATS.RGBA,!wt){ft.renderTexture.bind(bt);const Ot=bt.framebuffer.glFramebuffers[ft.CONTEXT_UID];Ot.blitFramebuffer&&ft.framebuffer.bind(Ot.blitFramebuffer)}}else mt=ft.resolution,lt||(lt=TEMP_RECT,lt.width=ft.width/mt,lt.height=ft.height/mt),pt=!0,gt=this._rendererPremultipliedAlpha,ft.renderTexture.bind();const Ct=Math.max(Math.round(lt.width*mt),1),Rt=Math.max(Math.round(lt.height*mt),1),Mt=new Uint8Array(BYTES_PER_PIXEL*Ct*Rt);return vt.readPixels(Math.round(lt.x*mt),Math.round(lt.y*mt),Ct,Rt,vt.RGBA,vt.UNSIGNED_BYTE,Mt),wt&&(bt==null||bt.destroy(!0)),{pixels:Mt,width:Ct,height:Rt,flipY:pt,premultipliedAlpha:gt}}destroy(){this.renderer=null}static _flipY(_,lt,ft){const mt=lt<<2,pt=ft>>1,gt=new Uint8Array(mt);for(let bt=0;bt<pt;bt++){const wt=bt*mt,vt=(ft-bt-1)*mt;gt.set(_.subarray(wt,wt+mt)),_.copyWithin(wt,vt,vt+mt),_.set(gt,vt)}}static _unpremultiplyAlpha(_){_ instanceof Uint8ClampedArray&&(_=new Uint8Array(_.buffer));const lt=_.length;for(let ft=0;ft<lt;ft+=4){const mt=_[ft+3];if(mt!==0){const pt=255.001/mt;_[ft]=_[ft]*pt+.5,_[ft+1]=_[ft+1]*pt+.5,_[ft+2]=_[ft+2]*pt+.5}}}};_Extract.extension={name:"extract",type:ExtensionType.RendererSystem};let Extract=_Extract;extensions$1.add(Extract);const buildCircle={build(it){const _=it.points;let lt,ft,mt,pt,gt,bt;if(it.type===SHAPES.CIRC){const Nt=it.shape;lt=Nt.x,ft=Nt.y,gt=bt=Nt.radius,mt=pt=0}else if(it.type===SHAPES.ELIP){const Nt=it.shape;lt=Nt.x,ft=Nt.y,gt=Nt.width,bt=Nt.height,mt=pt=0}else{const Nt=it.shape,Ht=Nt.width/2,Kt=Nt.height/2;lt=Nt.x+Ht,ft=Nt.y+Kt,gt=bt=Math.max(0,Math.min(Nt.radius,Math.min(Ht,Kt))),mt=Ht-gt,pt=Kt-bt}if(!(gt>=0&&bt>=0&&mt>=0&&pt>=0)){_.length=0;return}const wt=Math.ceil(2.3*Math.sqrt(gt+bt)),vt=wt*8+(mt?4:0)+(pt?4:0);if(_.length=vt,vt===0)return;if(wt===0){_.length=8,_[0]=_[6]=lt+mt,_[1]=_[3]=ft+pt,_[2]=_[4]=lt-mt,_[5]=_[7]=ft-pt;return}let Ct=0,Rt=wt*4+(mt?2:0)+2,Mt=Rt,Ot=vt;{const Nt=mt+gt,Ht=pt,Kt=lt+Nt,hr=lt-Nt,Qt=ft+Ht;if(_[Ct++]=Kt,_[Ct++]=Qt,_[--Rt]=Qt,_[--Rt]=hr,pt){const mr=ft-Ht;_[Mt++]=hr,_[Mt++]=mr,_[--Ot]=mr,_[--Ot]=Kt}}for(let Nt=1;Nt<wt;Nt++){const Ht=Math.PI/2*(Nt/wt),Kt=mt+Math.cos(Ht)*gt,hr=pt+Math.sin(Ht)*bt,Qt=lt+Kt,mr=lt-Kt,br=ft+hr,Fr=ft-hr;_[Ct++]=Qt,_[Ct++]=br,_[--Rt]=br,_[--Rt]=mr,_[Mt++]=mr,_[Mt++]=Fr,_[--Ot]=Fr,_[--Ot]=Qt}{const Nt=mt,Ht=pt+bt,Kt=lt+Nt,hr=lt-Nt,Qt=ft+Ht,mr=ft-Ht;_[Ct++]=Kt,_[Ct++]=Qt,_[--Ot]=mr,_[--Ot]=Kt,mt&&(_[Ct++]=hr,_[Ct++]=Qt,_[--Ot]=mr,_[--Ot]=hr)}},triangulate(it,_){const lt=it.points,ft=_.points,mt=_.indices;if(lt.length===0)return;let pt=ft.length/2;const gt=pt;let bt,wt;if(it.type!==SHAPES.RREC){const Ct=it.shape;bt=Ct.x,wt=Ct.y}else{const Ct=it.shape;bt=Ct.x+Ct.width/2,wt=Ct.y+Ct.height/2}const vt=it.matrix;ft.push(it.matrix?vt.a*bt+vt.c*wt+vt.tx:bt,it.matrix?vt.b*bt+vt.d*wt+vt.ty:wt),pt++,ft.push(lt[0],lt[1]);for(let Ct=2;Ct<lt.length;Ct+=2)ft.push(lt[Ct],lt[Ct+1]),mt.push(pt++,gt,pt);mt.push(gt+1,gt,pt)}};function fixOrientation(it,_=!1){const lt=it.length;if(lt<6)return;let ft=0;for(let mt=0,pt=it[lt-2],gt=it[lt-1];mt<lt;mt+=2){const bt=it[mt],wt=it[mt+1];ft+=(bt-pt)*(wt+gt),pt=bt,gt=wt}if(!_&&ft>0||_&&ft<=0){const mt=lt/2;for(let pt=mt+mt%2;pt<lt;pt+=2){const gt=lt-pt-2,bt=lt-pt-1,wt=pt,vt=pt+1;[it[gt],it[wt]]=[it[wt],it[gt]],[it[bt],it[vt]]=[it[vt],it[bt]]}}}const buildPoly={build(it){it.points=it.shape.points.slice()},triangulate(it,_){let lt=it.points;const ft=it.holes,mt=_.points,pt=_.indices;if(lt.length>=6){fixOrientation(lt,!1);const gt=[];for(let vt=0;vt<ft.length;vt++){const Ct=ft[vt];fixOrientation(Ct.points,!0),gt.push(lt.length/2),lt=lt.concat(Ct.points)}const bt=earcut$1(lt,gt,2);if(!bt)return;const wt=mt.length/2;for(let vt=0;vt<bt.length;vt+=3)pt.push(bt[vt]+wt),pt.push(bt[vt+1]+wt),pt.push(bt[vt+2]+wt);for(let vt=0;vt<lt.length;vt++)mt.push(lt[vt])}}},buildRectangle={build(it){const _=it.shape,lt=_.x,ft=_.y,mt=_.width,pt=_.height,gt=it.points;gt.length=0,mt>=0&&pt>=0&&gt.push(lt,ft,lt+mt,ft,lt+mt,ft+pt,lt,ft+pt)},triangulate(it,_){const lt=it.points,ft=_.points;if(lt.length===0)return;const mt=ft.length/2;ft.push(lt[0],lt[1],lt[2],lt[3],lt[6],lt[7],lt[4],lt[5]),_.indices.push(mt,mt+1,mt+2,mt+1,mt+2,mt+3)}},buildRoundedRectangle={build(it){buildCircle.build(it)},triangulate(it,_){buildCircle.triangulate(it,_)}};var LINE_JOIN=(it=>(it.MITER="miter",it.BEVEL="bevel",it.ROUND="round",it))(LINE_JOIN||{}),LINE_CAP=(it=>(it.BUTT="butt",it.ROUND="round",it.SQUARE="square",it))(LINE_CAP||{});const curves={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(it,_=20){if(!this.adaptive||!it||isNaN(it))return _;let lt=Math.ceil(it/this.maxLength);return lt<this.minSegments?lt=this.minSegments:lt>this.maxSegments&&(lt=this.maxSegments),lt}};class ArcUtils{static curveTo(_,lt,ft,mt,pt,gt){const bt=gt[gt.length-2],wt=gt[gt.length-1]-lt,vt=bt-_,Ct=mt-lt,Rt=ft-_,Mt=Math.abs(wt*Rt-vt*Ct);if(Mt<1e-8||pt===0)return(gt[gt.length-2]!==_||gt[gt.length-1]!==lt)&&gt.push(_,lt),null;const Ot=wt*wt+vt*vt,Nt=Ct*Ct+Rt*Rt,Ht=wt*Ct+vt*Rt,Kt=pt*Math.sqrt(Ot)/Mt,hr=pt*Math.sqrt(Nt)/Mt,Qt=Kt*Ht/Ot,mr=hr*Ht/Nt,br=Kt*Rt+hr*vt,Fr=Kt*Ct+hr*wt,kr=vt*(hr+Qt),Br=wt*(hr+Qt),Nr=Rt*(Kt+mr),jn=Ct*(Kt+mr),Yn=Math.atan2(Br-Fr,kr-br),ga=Math.atan2(jn-Fr,Nr-br);return{cx:br+_,cy:Fr+lt,radius:pt,startAngle:Yn,endAngle:ga,anticlockwise:vt*Ct>Rt*wt}}static arc(_,lt,ft,mt,pt,gt,bt,wt,vt){const Ct=bt-gt,Rt=curves._segmentsCount(Math.abs(Ct)*pt,Math.ceil(Math.abs(Ct)/PI_2)*40),Mt=Ct/(Rt*2),Ot=Mt*2,Nt=Math.cos(Mt),Ht=Math.sin(Mt),Kt=Rt-1,hr=Kt%1/Kt;for(let Qt=0;Qt<=Kt;++Qt){const mr=Qt+hr*Qt,br=Mt+gt+Ot*mr,Fr=Math.cos(br),kr=-Math.sin(br);vt.push((Nt*Fr+Ht*kr)*pt+ft,(Nt*-kr+Ht*Fr)*pt+mt)}}}class BatchPart{constructor(){this.reset()}begin(_,lt,ft){this.reset(),this.style=_,this.start=lt,this.attribStart=ft}end(_,lt){this.attribSize=lt-this.attribStart,this.size=_-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class BezierUtils{static curveLength(_,lt,ft,mt,pt,gt,bt,wt){let vt=0,Ct=0,Rt=0,Mt=0,Ot=0,Nt=0,Ht=0,Kt=0,hr=0,Qt=0,mr=0,br=_,Fr=lt;for(let kr=1;kr<=10;++kr)Ct=kr/10,Rt=Ct*Ct,Mt=Rt*Ct,Ot=1-Ct,Nt=Ot*Ot,Ht=Nt*Ot,Kt=Ht*_+3*Nt*Ct*ft+3*Ot*Rt*pt+Mt*bt,hr=Ht*lt+3*Nt*Ct*mt+3*Ot*Rt*gt+Mt*wt,Qt=br-Kt,mr=Fr-hr,br=Kt,Fr=hr,vt+=Math.sqrt(Qt*Qt+mr*mr);return vt}static curveTo(_,lt,ft,mt,pt,gt,bt){const wt=bt[bt.length-2],vt=bt[bt.length-1];bt.length-=2;const Ct=curves._segmentsCount(BezierUtils.curveLength(wt,vt,_,lt,ft,mt,pt,gt));let Rt=0,Mt=0,Ot=0,Nt=0,Ht=0;bt.push(wt,vt);for(let Kt=1,hr=0;Kt<=Ct;++Kt)hr=Kt/Ct,Rt=1-hr,Mt=Rt*Rt,Ot=Mt*Rt,Nt=hr*hr,Ht=Nt*hr,bt.push(Ot*wt+3*Mt*hr*_+3*Rt*Nt*ft+Ht*pt,Ot*vt+3*Mt*hr*lt+3*Rt*Nt*mt+Ht*gt)}}function square(it,_,lt,ft,mt,pt,gt,bt){const wt=it-lt*mt,vt=_-ft*mt,Ct=it+lt*pt,Rt=_+ft*pt;let Mt,Ot;gt?(Mt=ft,Ot=-lt):(Mt=-ft,Ot=lt);const Nt=wt+Mt,Ht=vt+Ot,Kt=Ct+Mt,hr=Rt+Ot;return bt.push(Nt,Ht,Kt,hr),2}function round(it,_,lt,ft,mt,pt,gt,bt){const wt=lt-it,vt=ft-_;let Ct=Math.atan2(wt,vt),Rt=Math.atan2(mt-it,pt-_);bt&&Ct<Rt?Ct+=Math.PI*2:!bt&&Ct>Rt&&(Rt+=Math.PI*2);let Mt=Ct;const Ot=Rt-Ct,Nt=Math.abs(Ot),Ht=Math.sqrt(wt*wt+vt*vt),Kt=(15*Nt*Math.sqrt(Ht)/Math.PI>>0)+1,hr=Ot/Kt;if(Mt+=hr,bt){gt.push(it,_,lt,ft);for(let Qt=1,mr=Mt;Qt<Kt;Qt++,mr+=hr)gt.push(it,_,it+Math.sin(mr)*Ht,_+Math.cos(mr)*Ht);gt.push(it,_,mt,pt)}else{gt.push(lt,ft,it,_);for(let Qt=1,mr=Mt;Qt<Kt;Qt++,mr+=hr)gt.push(it+Math.sin(mr)*Ht,_+Math.cos(mr)*Ht,it,_);gt.push(mt,pt,it,_)}return Kt*2}function buildNonNativeLine(it,_){const lt=it.shape;let ft=it.points||lt.points.slice();const mt=_.closePointEps;if(ft.length===0)return;const pt=it.lineStyle,gt=new Point(ft[0],ft[1]),bt=new Point(ft[ft.length-2],ft[ft.length-1]),wt=lt.type!==SHAPES.POLY||lt.closeStroke,vt=Math.abs(gt.x-bt.x)<mt&&Math.abs(gt.y-bt.y)<mt;if(wt){ft=ft.slice(),vt&&(ft.pop(),ft.pop(),bt.set(ft[ft.length-2],ft[ft.length-1]));const ro=(gt.x+bt.x)*.5,bs=(bt.y+gt.y)*.5;ft.unshift(ro,bs),ft.push(ro,bs)}const Ct=_.points,Rt=ft.length/2;let Mt=ft.length;const Ot=Ct.length/2,Nt=pt.width/2,Ht=Nt*Nt,Kt=pt.miterLimit*pt.miterLimit;let hr=ft[0],Qt=ft[1],mr=ft[2],br=ft[3],Fr=0,kr=0,Br=-(Qt-br),Nr=hr-mr,jn=0,Yn=0,ga=Math.sqrt(Br*Br+Nr*Nr);Br/=ga,Nr/=ga,Br*=Nt,Nr*=Nt;const Kn=pt.alignment,Xn=(1-Kn)*2,eo=Kn*2;wt||(pt.cap===LINE_CAP.ROUND?Mt+=round(hr-Br*(Xn-eo)*.5,Qt-Nr*(Xn-eo)*.5,hr-Br*Xn,Qt-Nr*Xn,hr+Br*eo,Qt+Nr*eo,Ct,!0)+2:pt.cap===LINE_CAP.SQUARE&&(Mt+=square(hr,Qt,Br,Nr,Xn,eo,!0,Ct))),Ct.push(hr-Br*Xn,Qt-Nr*Xn,hr+Br*eo,Qt+Nr*eo);for(let ro=1;ro<Rt-1;++ro){hr=ft[(ro-1)*2],Qt=ft[(ro-1)*2+1],mr=ft[ro*2],br=ft[ro*2+1],Fr=ft[(ro+1)*2],kr=ft[(ro+1)*2+1],Br=-(Qt-br),Nr=hr-mr,ga=Math.sqrt(Br*Br+Nr*Nr),Br/=ga,Nr/=ga,Br*=Nt,Nr*=Nt,jn=-(br-kr),Yn=mr-Fr,ga=Math.sqrt(jn*jn+Yn*Yn),jn/=ga,Yn/=ga,jn*=Nt,Yn*=Nt;const bs=mr-hr,ba=Qt-br,Zn=mr-Fr,Qn=kr-br,ip=bs*Zn+ba*Qn,Sm=ba*Zn-Qn*bs,Pm=Sm<0;if(Math.abs(Sm)<.001*Math.abs(ip)){Ct.push(mr-Br*Xn,br-Nr*Xn,mr+Br*eo,br+Nr*eo),ip>=0&&(pt.join===LINE_JOIN.ROUND?Mt+=round(mr,br,mr-Br*Xn,br-Nr*Xn,mr-jn*Xn,br-Yn*Xn,Ct,!1)+4:Mt+=2,Ct.push(mr-jn*eo,br-Yn*eo,mr+jn*Xn,br+Yn*Xn));continue}const Cm=(-Br+hr)*(-Nr+br)-(-Br+mr)*(-Nr+Qt),Im=(-jn+Fr)*(-Yn+br)-(-jn+mr)*(-Yn+kr),Rm=(bs*Im-Zn*Cm)/Sm,Nm=(Qn*Cm-ba*Im)/Sm,Vm=(Rm-mr)*(Rm-mr)+(Nm-br)*(Nm-br),Mm=mr+(Rm-mr)*Xn,Tm=br+(Nm-br)*Xn,Om=mr-(Rm-mr)*eo,$m=br-(Nm-br)*eo,Xm=Math.min(bs*bs+ba*ba,Zn*Zn+Qn*Qn),zm=Pm?Xn:eo,ny=Xm+zm*zm*Ht,zy=Vm<=ny;let iy=pt.join;if(iy===LINE_JOIN.MITER&&Vm/Ht>Kt&&(iy=LINE_JOIN.BEVEL),zy)switch(iy){case LINE_JOIN.MITER:{Ct.push(Mm,Tm,Om,$m);break}case LINE_JOIN.BEVEL:{Pm?Ct.push(Mm,Tm,mr+Br*eo,br+Nr*eo,Mm,Tm,mr+jn*eo,br+Yn*eo):Ct.push(mr-Br*Xn,br-Nr*Xn,Om,$m,mr-jn*Xn,br-Yn*Xn,Om,$m),Mt+=2;break}case LINE_JOIN.ROUND:{Pm?(Ct.push(Mm,Tm,mr+Br*eo,br+Nr*eo),Mt+=round(mr,br,mr+Br*eo,br+Nr*eo,mr+jn*eo,br+Yn*eo,Ct,!0)+4,Ct.push(Mm,Tm,mr+jn*eo,br+Yn*eo)):(Ct.push(mr-Br*Xn,br-Nr*Xn,Om,$m),Mt+=round(mr,br,mr-Br*Xn,br-Nr*Xn,mr-jn*Xn,br-Yn*Xn,Ct,!1)+4,Ct.push(mr-jn*Xn,br-Yn*Xn,Om,$m));break}}else{switch(Ct.push(mr-Br*Xn,br-Nr*Xn,mr+Br*eo,br+Nr*eo),iy){case LINE_JOIN.MITER:{Pm?Ct.push(Om,$m,Om,$m):Ct.push(Mm,Tm,Mm,Tm),Mt+=2;break}case LINE_JOIN.ROUND:{Pm?Mt+=round(mr,br,mr+Br*eo,br+Nr*eo,mr+jn*eo,br+Yn*eo,Ct,!0)+2:Mt+=round(mr,br,mr-Br*Xn,br-Nr*Xn,mr-jn*Xn,br-Yn*Xn,Ct,!1)+2;break}}Ct.push(mr-jn*Xn,br-Yn*Xn,mr+jn*eo,br+Yn*eo),Mt+=2}}hr=ft[(Rt-2)*2],Qt=ft[(Rt-2)*2+1],mr=ft[(Rt-1)*2],br=ft[(Rt-1)*2+1],Br=-(Qt-br),Nr=hr-mr,ga=Math.sqrt(Br*Br+Nr*Nr),Br/=ga,Nr/=ga,Br*=Nt,Nr*=Nt,Ct.push(mr-Br*Xn,br-Nr*Xn,mr+Br*eo,br+Nr*eo),wt||(pt.cap===LINE_CAP.ROUND?Mt+=round(mr-Br*(Xn-eo)*.5,br-Nr*(Xn-eo)*.5,mr-Br*Xn,br-Nr*Xn,mr+Br*eo,br+Nr*eo,Ct,!1)+2:pt.cap===LINE_CAP.SQUARE&&(Mt+=square(mr,br,Br,Nr,Xn,eo,!1,Ct)));const lp=_.indices,$a=curves.epsilon*curves.epsilon;for(let ro=Ot;ro<Mt+Ot-2;++ro)hr=Ct[ro*2],Qt=Ct[ro*2+1],mr=Ct[(ro+1)*2],br=Ct[(ro+1)*2+1],Fr=Ct[(ro+2)*2],kr=Ct[(ro+2)*2+1],!(Math.abs(hr*(br-kr)+mr*(kr-Qt)+Fr*(Qt-br))<$a)&&lp.push(ro,ro+1,ro+2)}function buildNativeLine(it,_){let lt=0;const ft=it.shape,mt=it.points||ft.points,pt=ft.type!==SHAPES.POLY||ft.closeStroke;if(mt.length===0)return;const gt=_.points,bt=_.indices,wt=mt.length/2,vt=gt.length/2;let Ct=vt;for(gt.push(mt[0],mt[1]),lt=1;lt<wt;lt++)gt.push(mt[lt*2],mt[lt*2+1]),bt.push(Ct,Ct+1),Ct++;pt&&bt.push(Ct,vt)}function buildLine(it,_){it.lineStyle.native?buildNativeLine(it,_):buildNonNativeLine(it,_)}class QuadraticUtils{static curveLength(_,lt,ft,mt,pt,gt){const bt=_-2*ft+pt,wt=lt-2*mt+gt,vt=2*ft-2*_,Ct=2*mt-2*lt,Rt=4*(bt*bt+wt*wt),Mt=4*(bt*vt+wt*Ct),Ot=vt*vt+Ct*Ct,Nt=2*Math.sqrt(Rt+Mt+Ot),Ht=Math.sqrt(Rt),Kt=2*Rt*Ht,hr=2*Math.sqrt(Ot),Qt=Mt/Ht;return(Kt*Nt+Ht*Mt*(Nt-hr)+(4*Ot*Rt-Mt*Mt)*Math.log((2*Ht+Qt+Nt)/(Qt+hr)))/(4*Kt)}static curveTo(_,lt,ft,mt,pt){const gt=pt[pt.length-2],bt=pt[pt.length-1],wt=curves._segmentsCount(QuadraticUtils.curveLength(gt,bt,_,lt,ft,mt));let vt=0,Ct=0;for(let Rt=1;Rt<=wt;++Rt){const Mt=Rt/wt;vt=gt+(_-gt)*Mt,Ct=bt+(lt-bt)*Mt,pt.push(vt+(_+(ft-_)*Mt-vt)*Mt,Ct+(lt+(mt-lt)*Mt-Ct)*Mt)}}}const FILL_COMMANDS={[SHAPES.POLY]:buildPoly,[SHAPES.CIRC]:buildCircle,[SHAPES.ELIP]:buildCircle,[SHAPES.RECT]:buildRectangle,[SHAPES.RREC]:buildRoundedRectangle},BATCH_POOL=[],DRAW_CALL_POOL=[];class GraphicsData{constructor(_,lt=null,ft=null,mt=null){this.points=[],this.holes=[],this.shape=_,this.lineStyle=ft,this.fillStyle=lt,this.matrix=mt,this.type=_.type}clone(){return new GraphicsData(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const tmpPoint=new Point,_GraphicsGeometry=class vv extends BatchGeometry{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Bounds,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let _=0;_<this.drawCalls.length;_++)this.drawCalls[_].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[_]);this.drawCalls.length=0;for(let _=0;_<this.batches.length;_++){const lt=this.batches[_];lt.reset(),BATCH_POOL.push(lt)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(_,lt=null,ft=null,mt=null){const pt=new GraphicsData(_,lt,ft,mt);return this.graphicsData.push(pt),this.dirty++,this}drawHole(_,lt=null){if(!this.graphicsData.length)return null;const ft=new GraphicsData(_,null,null,lt),mt=this.graphicsData[this.graphicsData.length-1];return ft.lineStyle=mt.lineStyle,mt.holes.push(ft),this.dirty++,this}destroy(){super.destroy();for(let _=0;_<this.graphicsData.length;++_)this.graphicsData[_].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(_){const lt=this.graphicsData;for(let ft=0;ft<lt.length;++ft){const mt=lt[ft];if(mt.fillStyle.visible&&mt.shape&&(mt.matrix?mt.matrix.applyInverse(_,tmpPoint):tmpPoint.copyFrom(_),mt.shape.contains(tmpPoint.x,tmpPoint.y))){let pt=!1;if(mt.holes){for(let gt=0;gt<mt.holes.length;gt++)if(mt.holes[gt].shape.contains(tmpPoint.x,tmpPoint.y)){pt=!0;break}}if(!pt)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const _=this.uvs,lt=this.graphicsData;let ft=null,mt=null;this.batches.length>0&&(ft=this.batches[this.batches.length-1],mt=ft.style);for(let wt=this.shapeIndex;wt<lt.length;wt++){this.shapeIndex++;const vt=lt[wt],Ct=vt.fillStyle,Rt=vt.lineStyle;FILL_COMMANDS[vt.type].build(vt),vt.matrix&&this.transformPoints(vt.points,vt.matrix),(Ct.visible||Rt.visible)&&this.processHoles(vt.holes);for(let Mt=0;Mt<2;Mt++){const Ot=Mt===0?Ct:Rt;if(!Ot.visible)continue;const Nt=Ot.texture.baseTexture,Ht=this.indices.length,Kt=this.points.length/2;Nt.wrapMode=WRAP_MODES.REPEAT,Mt===0?this.processFill(vt):this.processLine(vt);const hr=this.points.length/2-Kt;hr!==0&&(ft&&!this._compareStyles(mt,Ot)&&(ft.end(Ht,Kt),ft=null),ft||(ft=BATCH_POOL.pop()||new BatchPart,ft.begin(Ot,Ht,Kt),this.batches.push(ft),mt=Ot),this.addUvs(this.points,_,Ot.texture,Kt,hr,Ot.matrix))}}const pt=this.indices.length,gt=this.points.length/2;if(ft&&ft.end(pt,gt),this.batches.length===0){this.batchable=!0;return}const bt=gt>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&bt===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=bt?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(_,lt){return!(!_||!lt||_.texture.baseTexture!==lt.texture.baseTexture||_.color+_.alpha!==lt.color+lt.alpha||!!_.native!=!!lt.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let _=0,lt=this.graphicsData.length;_<lt;_++){const ft=this.graphicsData[_],mt=ft.fillStyle,pt=ft.lineStyle;if(mt&&!mt.texture.baseTexture.valid||pt&&!pt.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const _=this.batches;for(let lt=0,ft=_.length;lt<ft;lt++){const mt=_[lt];for(let pt=0;pt<mt.size;pt++){const gt=mt.start+pt;this.indicesUint16[gt]=this.indicesUint16[gt]-mt.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const _=this.batches;for(let lt=0;lt<_.length;lt++)if(_[lt].style.native)return!1;return this.points.length<vv.BATCHABLE_SIZE*2}buildDrawCalls(){let _=++BaseTexture._globalBatch;for(let Rt=0;Rt<this.drawCalls.length;Rt++)this.drawCalls[Rt].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[Rt]);this.drawCalls.length=0;const lt=this.colors,ft=this.textureIds;let mt=DRAW_CALL_POOL.pop();mt||(mt=new BatchDrawCall,mt.texArray=new BatchTextureArray),mt.texArray.count=0,mt.start=0,mt.size=0,mt.type=DRAW_MODES.TRIANGLES;let pt=0,gt=null,bt=0,wt=!1,vt=DRAW_MODES.TRIANGLES,Ct=0;this.drawCalls.push(mt);for(let Rt=0;Rt<this.batches.length;Rt++){const Mt=this.batches[Rt],Ot=8,Nt=Mt.style,Ht=Nt.texture.baseTexture;wt!==!!Nt.native&&(wt=!!Nt.native,vt=wt?DRAW_MODES.LINES:DRAW_MODES.TRIANGLES,gt=null,pt=Ot,_++),gt!==Ht&&(gt=Ht,Ht._batchEnabled!==_&&(pt===Ot&&(_++,pt=0,mt.size>0&&(mt=DRAW_CALL_POOL.pop(),mt||(mt=new BatchDrawCall,mt.texArray=new BatchTextureArray),this.drawCalls.push(mt)),mt.start=Ct,mt.size=0,mt.texArray.count=0,mt.type=vt),Ht.touched=1,Ht._batchEnabled=_,Ht._batchLocation=pt,Ht.wrapMode=WRAP_MODES.REPEAT,mt.texArray.elements[mt.texArray.count++]=Ht,pt++)),mt.size+=Mt.size,Ct+=Mt.size,bt=Ht._batchLocation,this.addColors(lt,Nt.color,Nt.alpha,Mt.attribSize,Mt.attribStart),this.addTextureIds(ft,bt,Mt.attribSize,Mt.attribStart)}BaseTexture._globalBatch=_,this.packAttributes()}packAttributes(){const _=this.points,lt=this.uvs,ft=this.colors,mt=this.textureIds,pt=new ArrayBuffer(_.length*3*4),gt=new Float32Array(pt),bt=new Uint32Array(pt);let wt=0;for(let vt=0;vt<_.length/2;vt++)gt[wt++]=_[vt*2],gt[wt++]=_[vt*2+1],gt[wt++]=lt[vt*2],gt[wt++]=lt[vt*2+1],bt[wt++]=ft[vt],gt[wt++]=mt[vt];this._buffer.update(pt),this._indexBuffer.update(this.indicesUint16)}processFill(_){_.holes.length?buildPoly.triangulate(_,this):FILL_COMMANDS[_.type].triangulate(_,this)}processLine(_){buildLine(_,this);for(let lt=0;lt<_.holes.length;lt++)buildLine(_.holes[lt],this)}processHoles(_){for(let lt=0;lt<_.length;lt++){const ft=_[lt];FILL_COMMANDS[ft.type].build(ft),ft.matrix&&this.transformPoints(ft.points,ft.matrix)}}calculateBounds(){const _=this._bounds;_.clear(),_.addVertexData(this.points,0,this.points.length),_.pad(this.boundsPadding,this.boundsPadding)}transformPoints(_,lt){for(let ft=0;ft<_.length/2;ft++){const mt=_[ft*2],pt=_[ft*2+1];_[ft*2]=lt.a*mt+lt.c*pt+lt.tx,_[ft*2+1]=lt.b*mt+lt.d*pt+lt.ty}}addColors(_,lt,ft,mt,pt=0){const gt=Color.shared.setValue(lt).toLittleEndianNumber(),bt=Color.shared.setValue(gt).toPremultiplied(ft);_.length=Math.max(_.length,pt+mt);for(let wt=0;wt<mt;wt++)_[pt+wt]=bt}addTextureIds(_,lt,ft,mt=0){_.length=Math.max(_.length,mt+ft);for(let pt=0;pt<ft;pt++)_[mt+pt]=lt}addUvs(_,lt,ft,mt,pt,gt=null){let bt=0;const wt=lt.length,vt=ft.frame;for(;bt<pt;){let Rt=_[(mt+bt)*2],Mt=_[(mt+bt)*2+1];if(gt){const Ot=gt.a*Rt+gt.c*Mt+gt.tx;Mt=gt.b*Rt+gt.d*Mt+gt.ty,Rt=Ot}bt++,lt.push(Rt/vt.width,Mt/vt.height)}const Ct=ft.baseTexture;(vt.width<Ct.width||vt.height<Ct.height)&&this.adjustUvs(lt,ft,wt,pt)}adjustUvs(_,lt,ft,mt){const pt=lt.baseTexture,gt=1e-6,bt=ft+mt*2,wt=lt.frame,vt=wt.width/pt.width,Ct=wt.height/pt.height;let Rt=wt.x/wt.width,Mt=wt.y/wt.height,Ot=Math.floor(_[ft]+gt),Nt=Math.floor(_[ft+1]+gt);for(let Ht=ft+2;Ht<bt;Ht+=2)Ot=Math.min(Ot,Math.floor(_[Ht]+gt)),Nt=Math.min(Nt,Math.floor(_[Ht+1]+gt));Rt-=Ot,Mt-=Nt;for(let Ht=ft;Ht<bt;Ht+=2)_[Ht]=(_[Ht]+Rt)*vt,_[Ht+1]=(_[Ht+1]+Mt)*Ct}};_GraphicsGeometry.BATCHABLE_SIZE=100;let GraphicsGeometry=_GraphicsGeometry;class FillStyle{constructor(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const _=new FillStyle;return _.color=this.color,_.alpha=this.alpha,_.texture=this.texture,_.matrix=this.matrix,_.visible=this.visible,_}reset(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class LineStyle extends FillStyle{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=LINE_CAP.BUTT,this.join=LINE_JOIN.MITER,this.miterLimit=10}clone(){const _=new LineStyle;return _.color=this.color,_.alpha=this.alpha,_.texture=this.texture,_.matrix=this.matrix,_.visible=this.visible,_.width=this.width,_.alignment=this.alignment,_.native=this.native,_.cap=this.cap,_.join=this.join,_.miterLimit=this.miterLimit,_}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=LINE_CAP.BUTT,this.join=LINE_JOIN.MITER,this.miterLimit=10}}const DEFAULT_SHADERS={},_Graphics=class Vy extends Container{constructor(_=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new FillStyle,this._lineStyle=new LineStyle,this._matrix=null,this._holeMode=!1,this.state=State.for2d(),this._geometry=_||new GraphicsGeometry,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Color(16777215),this.blendMode=BLEND_MODES.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Vy(this._geometry)}set blendMode(_){this.state.blendMode=_}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(_){this._tintColor.setValue(_)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(_=null,lt=0,ft,mt=.5,pt=!1){return typeof _=="number"&&(_={width:_,color:lt,alpha:ft,alignment:mt,native:pt}),this.lineTextureStyle(_)}lineTextureStyle(_){const lt={width:0,texture:Texture.WHITE,color:_!=null&&_.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10};_=Object.assign(lt,_),this.normalizeColor(_),this.currentPath&&this.startPoly();const ft=_.width>0&&_.alpha>0;return ft?(_.matrix&&(_.matrix=_.matrix.clone(),_.matrix.invert()),Object.assign(this._lineStyle,{visible:ft},_)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const _=this.currentPath.points,lt=this.currentPath.points.length;lt>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(_[lt-2],_[lt-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(_,lt){return this.startPoly(),this.currentPath.points[0]=_,this.currentPath.points[1]=lt,this}lineTo(_,lt){this.currentPath||this.moveTo(0,0);const ft=this.currentPath.points,mt=ft[ft.length-2],pt=ft[ft.length-1];return(mt!==_||pt!==lt)&&ft.push(_,lt),this}_initCurve(_=0,lt=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[_,lt]):this.moveTo(_,lt)}quadraticCurveTo(_,lt,ft,mt){this._initCurve();const pt=this.currentPath.points;return pt.length===0&&this.moveTo(0,0),QuadraticUtils.curveTo(_,lt,ft,mt,pt),this}bezierCurveTo(_,lt,ft,mt,pt,gt){return this._initCurve(),BezierUtils.curveTo(_,lt,ft,mt,pt,gt,this.currentPath.points),this}arcTo(_,lt,ft,mt,pt){this._initCurve(_,lt);const gt=this.currentPath.points,bt=ArcUtils.curveTo(_,lt,ft,mt,pt,gt);if(bt){const{cx:wt,cy:vt,radius:Ct,startAngle:Rt,endAngle:Mt,anticlockwise:Ot}=bt;this.arc(wt,vt,Ct,Rt,Mt,Ot)}return this}arc(_,lt,ft,mt,pt,gt=!1){if(mt===pt)return this;if(!gt&&pt<=mt?pt+=PI_2:gt&&mt<=pt&&(mt+=PI_2),pt-mt===0)return this;const bt=_+Math.cos(mt)*ft,wt=lt+Math.sin(mt)*ft,vt=this._geometry.closePointEps;let Ct=this.currentPath?this.currentPath.points:null;if(Ct){const Rt=Math.abs(Ct[Ct.length-2]-bt),Mt=Math.abs(Ct[Ct.length-1]-wt);Rt<vt&&Mt<vt||Ct.push(bt,wt)}else this.moveTo(bt,wt),Ct=this.currentPath.points;return ArcUtils.arc(bt,wt,_,lt,ft,mt,pt,gt,Ct),this}beginFill(_=0,lt){return this.beginTextureFill({texture:Texture.WHITE,color:_,alpha:lt})}normalizeColor(_){const lt=Color.shared.setValue(_.color??0);_.color=lt.toNumber(),_.alpha??(_.alpha=lt.alpha)}beginTextureFill(_){const lt={texture:Texture.WHITE,color:16777215,matrix:null};_=Object.assign(lt,_),this.normalizeColor(_),this.currentPath&&this.startPoly();const ft=_.alpha>0;return ft?(_.matrix&&(_.matrix=_.matrix.clone(),_.matrix.invert()),Object.assign(this._fillStyle,{visible:ft},_)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(_,lt,ft,mt){return this.drawShape(new Rectangle(_,lt,ft,mt))}drawRoundedRect(_,lt,ft,mt,pt){return this.drawShape(new RoundedRectangle(_,lt,ft,mt,pt))}drawCircle(_,lt,ft){return this.drawShape(new Circle(_,lt,ft))}drawEllipse(_,lt,ft,mt){return this.drawShape(new Ellipse(_,lt,ft,mt))}drawPolygon(..._){let lt,ft=!0;const mt=_[0];mt.points?(ft=mt.closeStroke,lt=mt.points):Array.isArray(_[0])?lt=_[0]:lt=_;const pt=new Polygon(lt);return pt.closeStroke=ft,this.drawShape(pt),this}drawShape(_){return this._holeMode?this._geometry.drawHole(_,this._matrix):this._geometry.drawShape(_,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const _=this._geometry.graphicsData;return _.length===1&&_[0].shape.type===SHAPES.RECT&&!_[0].matrix&&!_[0].holes.length&&!(_[0].lineStyle.visible&&_[0].lineStyle.width)}_render(_){this.finishPoly();const lt=this._geometry;lt.updateBatches(),lt.batchable?(this.batchDirty!==lt.batchDirty&&this._populateBatches(),this._renderBatched(_)):(_.batch.flush(),this._renderDirect(_))}_populateBatches(){const _=this._geometry,lt=this.blendMode,ft=_.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=_.batchDirty,this.batches.length=ft,this.vertexData=new Float32Array(_.points);for(let mt=0;mt<ft;mt++){const pt=_.batches[mt],gt=pt.style.color,bt=new Float32Array(this.vertexData.buffer,pt.attribStart*4*2,pt.attribSize*2),wt=new Float32Array(_.uvsFloat32.buffer,pt.attribStart*4*2,pt.attribSize*2),vt=new Uint16Array(_.indicesUint16.buffer,pt.start*2,pt.size),Ct={vertexData:bt,blendMode:lt,indices:vt,uvs:wt,_batchRGB:Color.shared.setValue(gt).toRgbArray(),_tintRGB:gt,_texture:pt.style.texture,alpha:pt.style.alpha,worldAlpha:1};this.batches[mt]=Ct}}_renderBatched(_){if(this.batches.length){_.batch.setObjectRenderer(_.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let lt=0,ft=this.batches.length;lt<ft;lt++){const mt=this.batches[lt];mt.worldAlpha=this.worldAlpha*mt.alpha,_.plugins[this.pluginName].render(mt)}}}_renderDirect(_){const lt=this._resolveDirectShader(_),ft=this._geometry,mt=this.worldAlpha,pt=lt.uniforms,gt=ft.drawCalls;pt.translationMatrix=this.transform.worldTransform,Color.shared.setValue(this._tintColor).premultiply(mt).toArray(pt.tint),_.shader.bind(lt),_.geometry.bind(ft,lt),_.state.set(this.state);for(let bt=0,wt=gt.length;bt<wt;bt++)this._renderDrawCallDirect(_,ft.drawCalls[bt])}_renderDrawCallDirect(_,lt){const{texArray:ft,type:mt,size:pt,start:gt}=lt,bt=ft.count;for(let wt=0;wt<bt;wt++)_.texture.bind(ft.elements[wt],wt);_.geometry.draw(mt,pt,gt)}_resolveDirectShader(_){let lt=this.shader;const ft=this.pluginName;if(!lt){if(!DEFAULT_SHADERS[ft]){const{maxTextures:mt}=_.plugins[ft],pt=new Int32Array(mt);for(let wt=0;wt<mt;wt++)pt[wt]=wt;const gt={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:pt},!0)},bt=_.plugins[ft]._shader.program;DEFAULT_SHADERS[ft]=new Shader(bt,gt)}lt=DEFAULT_SHADERS[ft]}return lt}_calculateBounds(){this.finishPoly();const _=this._geometry;if(!_.graphicsData.length)return;const{minX:lt,minY:ft,maxX:mt,maxY:pt}=_.bounds;this._bounds.addFrame(this.transform,lt,ft,mt,pt)}containsPoint(_){return this.worldTransform.applyInverse(_,Vy._TEMP_POINT),this._geometry.containsPoint(Vy._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let _=0;_<this.batches.length;_++){const lt=this.batches[_];lt._tintRGB=Color.shared.setValue(this._tintColor).multiply(lt._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const _=this.transform._worldID;if(this._transformID===_)return;this._transformID=_;const lt=this.transform.worldTransform,ft=lt.a,mt=lt.b,pt=lt.c,gt=lt.d,bt=lt.tx,wt=lt.ty,vt=this._geometry.points,Ct=this.vertexData;let Rt=0;for(let Mt=0;Mt<vt.length;Mt+=2){const Ot=vt[Mt],Nt=vt[Mt+1];Ct[Rt++]=ft*Ot+pt*Nt+bt,Ct[Rt++]=gt*Nt+mt*Ot+wt}}closePath(){const _=this.currentPath;return _&&(_.closeStroke=!0,this.finishPoly()),this}setMatrix(_){return this._matrix=_,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(_){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(_)}};_Graphics.curves=curves,_Graphics._TEMP_POINT=new Point;let Graphics=_Graphics;class MeshBatchUvs{constructor(_,lt){this.uvBuffer=_,this.uvMatrix=lt,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(_){if(!_&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const lt=this.uvBuffer.data;(!this.data||this.data.length!==lt.length)&&(this.data=new Float32Array(lt.length)),this.uvMatrix.multiplyUvs(lt,this.data),this._updateID++}}const tempPoint=new Point,tempPolygon=new Polygon,_Mesh=class _v extends Container{constructor(_,lt,ft,mt=DRAW_MODES.TRIANGLES){super(),this.geometry=_,this.shader=lt,this.state=ft||State.for2d(),this.drawMode=mt,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=settings.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(_){this._geometry!==_&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=_,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(_){this.shader=_}get material(){return this.shader}set blendMode(_){this.state.blendMode=_}get blendMode(){return this.state.blendMode}set roundPixels(_){this._roundPixels!==_&&(this._transformID=-1),this._roundPixels=_}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(_){this.shader.tint=_}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(_){this.shader.texture=_}_render(_){const lt=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===DRAW_MODES.TRIANGLES&&lt.length<_v.BATCHABLE_SIZE*2?this._renderToBatch(_):this._renderDefault(_)}_renderDefault(_){const lt=this.shader;lt.alpha=this.worldAlpha,lt.update&&lt.update(),_.batch.flush(),lt.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),_.shader.bind(lt),_.state.set(this.state),_.geometry.bind(this.geometry,lt),_.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(_){const lt=this.geometry,ft=this.shader;ft.uvMatrix&&(ft.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=lt.indexBuffer.data,this._tintRGB=ft._tintRGB,this._texture=ft.texture;const mt=this.material.pluginName;_.batch.setObjectRenderer(_.plugins[mt]),_.plugins[mt].render(this)}calculateVertices(){const _=this.geometry.buffers[0],lt=_.data,ft=_._updateID;if(ft===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==lt.length&&(this.vertexData=new Float32Array(lt.length));const mt=this.transform.worldTransform,pt=mt.a,gt=mt.b,bt=mt.c,wt=mt.d,vt=mt.tx,Ct=mt.ty,Rt=this.vertexData;for(let Mt=0;Mt<Rt.length/2;Mt++){const Ot=lt[Mt*2],Nt=lt[Mt*2+1];Rt[Mt*2]=pt*Ot+bt*Nt+vt,Rt[Mt*2+1]=gt*Ot+wt*Nt+Ct}if(this._roundPixels){const Mt=settings.RESOLUTION;for(let Ot=0;Ot<Rt.length;++Ot)Rt[Ot]=Math.round(Rt[Ot]*Mt)/Mt}this.vertexDirty=ft}calculateUvs(){const _=this.geometry.buffers[1],lt=this.shader;lt.uvMatrix.isSimple?this.uvs=_.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(_,lt.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(_){if(!this.getBounds().contains(_.x,_.y))return!1;this.worldTransform.applyInverse(_,tempPoint);const lt=this.geometry.getBuffer("aVertexPosition").data,ft=tempPolygon.points,mt=this.geometry.getIndex().data,pt=mt.length,gt=this.drawMode===4?3:1;for(let bt=0;bt+2<pt;bt+=gt){const wt=mt[bt]*2,vt=mt[bt+1]*2,Ct=mt[bt+2]*2;if(ft[0]=lt[wt],ft[1]=lt[wt+1],ft[2]=lt[vt],ft[3]=lt[vt+1],ft[4]=lt[Ct],ft[5]=lt[Ct+1],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}return!1}destroy(_){super.destroy(_),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};_Mesh.BATCHABLE_SIZE=100;let Mesh=_Mesh;class MeshGeometry extends Geometry{constructor(_,lt,ft){super();const mt=new Buffer$1(_),pt=new Buffer$1(lt,!0),gt=new Buffer$1(ft,!0,!0);this.addAttribute("aVertexPosition",mt,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",pt,2,!1,TYPES.FLOAT).addIndex(gt),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var fragment$1=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,vertex$1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class MeshMaterial extends Shader{constructor(_,lt){const ft={uSampler:_,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};lt=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},lt),lt.uniforms&&Object.assign(ft,lt.uniforms),super(lt.program||Program.from(vertex$1,fragment$1),ft),this._colorDirty=!1,this.uvMatrix=new TextureMatrix(_),this.batchable=lt.program===void 0,this.pluginName=lt.pluginName,this._tintColor=new Color(lt.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=lt.alpha}get texture(){return this.uniforms.uSampler}set texture(_){this.uniforms.uSampler!==_&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!_.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=_,this.uvMatrix.texture=_)}set alpha(_){_!==this._alpha&&(this._alpha=_,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(_){_!==this.tint&&(this._tintColor.setValue(_),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const _=this.texture.baseTexture.alphaMode;Color.shared.setValue(this._tintColor).premultiply(this._alpha,_).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class ParticleBuffer{constructor(_,lt,ft){this.geometry=new Geometry,this.indexBuffer=null,this.size=ft,this.dynamicProperties=[],this.staticProperties=[];for(let mt=0;mt<_.length;++mt){let pt=_[mt];pt={attributeName:pt.attributeName,size:pt.size,uploadFunction:pt.uploadFunction,type:pt.type||TYPES.FLOAT,offset:pt.offset},lt[mt]?this.dynamicProperties.push(pt):this.staticProperties.push(pt)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const _=this.geometry;let lt=0;this.indexBuffer=new Buffer$1(createIndicesForQuads(this.size),!0,!0),_.addIndex(this.indexBuffer),this.dynamicStride=0;for(let gt=0;gt<this.dynamicProperties.length;++gt){const bt=this.dynamicProperties[gt];bt.offset=lt,lt+=bt.size,this.dynamicStride+=bt.size}const ft=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(ft),this.dynamicDataUint32=new Uint32Array(ft),this.dynamicBuffer=new Buffer$1(this.dynamicData,!1,!1);let mt=0;this.staticStride=0;for(let gt=0;gt<this.staticProperties.length;++gt){const bt=this.staticProperties[gt];bt.offset=mt,mt+=bt.size,this.staticStride+=bt.size}const pt=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(pt),this.staticDataUint32=new Uint32Array(pt),this.staticBuffer=new Buffer$1(this.staticData,!0,!1);for(let gt=0;gt<this.dynamicProperties.length;++gt){const bt=this.dynamicProperties[gt];_.addAttribute(bt.attributeName,this.dynamicBuffer,0,bt.type===TYPES.UNSIGNED_BYTE,bt.type,this.dynamicStride*4,bt.offset*4)}for(let gt=0;gt<this.staticProperties.length;++gt){const bt=this.staticProperties[gt];_.addAttribute(bt.attributeName,this.staticBuffer,0,bt.type===TYPES.UNSIGNED_BYTE,bt.type,this.staticStride*4,bt.offset*4)}}uploadDynamic(_,lt,ft){for(let mt=0;mt<this.dynamicProperties.length;mt++){const pt=this.dynamicProperties[mt];pt.uploadFunction(_,lt,ft,pt.type===TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,pt.offset)}this.dynamicBuffer._updateID++}uploadStatic(_,lt,ft){for(let mt=0;mt<this.staticProperties.length;mt++){const pt=this.staticProperties[mt];pt.uploadFunction(_,lt,ft,pt.type===TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,pt.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var fragment=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class ParticleRenderer extends ObjectRenderer{constructor(_){super(_),this.shader=null,this.properties=null,this.tempMatrix=new Matrix,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Shader.from(vertex,fragment,{}),this.state=State.for2d()}render(_){const lt=_.children,ft=_._maxSize,mt=_._batchSize,pt=this.renderer;let gt=lt.length;if(gt===0)return;gt>ft&&!_.autoResize&&(gt=ft);let bt=_._buffers;bt||(bt=_._buffers=this.generateBuffers(_));const wt=lt[0]._texture.baseTexture,vt=wt.alphaMode>0;this.state.blendMode=correctBlendMode(_.blendMode,vt),pt.state.set(this.state);const Ct=pt.gl,Rt=_.worldTransform.copyTo(this.tempMatrix);Rt.prepend(pt.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=Rt.toArray(!0),this.shader.uniforms.uColor=Color.shared.setValue(_.tintRgb).premultiply(_.worldAlpha,vt).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=wt,this.renderer.shader.bind(this.shader);let Mt=!1;for(let Ot=0,Nt=0;Ot<gt;Ot+=mt,Nt+=1){let Ht=gt-Ot;Ht>mt&&(Ht=mt),Nt>=bt.length&&bt.push(this._generateOneMoreBuffer(_));const Kt=bt[Nt];Kt.uploadDynamic(lt,Ot,Ht);const hr=_._bufferUpdateIDs[Nt]||0;Mt=Mt||Kt._updateID<hr,Mt&&(Kt._updateID=_._updateID,Kt.uploadStatic(lt,Ot,Ht)),pt.geometry.bind(Kt.geometry),Ct.drawElements(Ct.TRIANGLES,Ht*6,Ct.UNSIGNED_SHORT,0)}}generateBuffers(_){const lt=[],ft=_._maxSize,mt=_._batchSize,pt=_._properties;for(let gt=0;gt<ft;gt+=mt)lt.push(new ParticleBuffer(this.properties,pt,mt));return lt}_generateOneMoreBuffer(_){const lt=_._batchSize,ft=_._properties;return new ParticleBuffer(this.properties,ft,lt)}uploadVertices(_,lt,ft,mt,pt,gt){let bt=0,wt=0,vt=0,Ct=0;for(let Rt=0;Rt<ft;++Rt){const Mt=_[lt+Rt],Ot=Mt._texture,Nt=Mt.scale.x,Ht=Mt.scale.y,Kt=Ot.trim,hr=Ot.orig;Kt?(wt=Kt.x-Mt.anchor.x*hr.width,bt=wt+Kt.width,Ct=Kt.y-Mt.anchor.y*hr.height,vt=Ct+Kt.height):(bt=hr.width*(1-Mt.anchor.x),wt=hr.width*-Mt.anchor.x,vt=hr.height*(1-Mt.anchor.y),Ct=hr.height*-Mt.anchor.y),mt[gt]=wt*Nt,mt[gt+1]=Ct*Ht,mt[gt+pt]=bt*Nt,mt[gt+pt+1]=Ct*Ht,mt[gt+pt*2]=bt*Nt,mt[gt+pt*2+1]=vt*Ht,mt[gt+pt*3]=wt*Nt,mt[gt+pt*3+1]=vt*Ht,gt+=pt*4}}uploadPosition(_,lt,ft,mt,pt,gt){for(let bt=0;bt<ft;bt++){const wt=_[lt+bt].position;mt[gt]=wt.x,mt[gt+1]=wt.y,mt[gt+pt]=wt.x,mt[gt+pt+1]=wt.y,mt[gt+pt*2]=wt.x,mt[gt+pt*2+1]=wt.y,mt[gt+pt*3]=wt.x,mt[gt+pt*3+1]=wt.y,gt+=pt*4}}uploadRotation(_,lt,ft,mt,pt,gt){for(let bt=0;bt<ft;bt++){const wt=_[lt+bt].rotation;mt[gt]=wt,mt[gt+pt]=wt,mt[gt+pt*2]=wt,mt[gt+pt*3]=wt,gt+=pt*4}}uploadUvs(_,lt,ft,mt,pt,gt){for(let bt=0;bt<ft;++bt){const wt=_[lt+bt]._texture._uvs;wt?(mt[gt]=wt.x0,mt[gt+1]=wt.y0,mt[gt+pt]=wt.x1,mt[gt+pt+1]=wt.y1,mt[gt+pt*2]=wt.x2,mt[gt+pt*2+1]=wt.y2,mt[gt+pt*3]=wt.x3,mt[gt+pt*3+1]=wt.y3,gt+=pt*4):(mt[gt]=0,mt[gt+1]=0,mt[gt+pt]=0,mt[gt+pt+1]=0,mt[gt+pt*2]=0,mt[gt+pt*2+1]=0,mt[gt+pt*3]=0,mt[gt+pt*3+1]=0,gt+=pt*4)}}uploadTint(_,lt,ft,mt,pt,gt){for(let bt=0;bt<ft;++bt){const wt=_[lt+bt],vt=Color.shared.setValue(wt._tintRGB).toPremultiplied(wt.alpha,wt.texture.baseTexture.alphaMode>0);mt[gt]=vt,mt[gt+pt]=vt,mt[gt+pt*2]=vt,mt[gt+pt*3]=vt,gt+=pt*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ParticleRenderer.extension={name:"particle",type:ExtensionType.RendererPlugin};extensions$1.add(ParticleRenderer);var TEXT_GRADIENT=(it=>(it[it.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",it[it.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",it))(TEXT_GRADIENT||{});const contextSettings={willReadFrequently:!0},_TextMetrics=class xm{static get experimentalLetterSpacingSupported(){let _=xm._experimentalLetterSpacingSupported;if(_!==void 0){const lt=settings.ADAPTER.getCanvasRenderingContext2D().prototype;_=xm._experimentalLetterSpacingSupported="letterSpacing"in lt||"textLetterSpacing"in lt}return _}constructor(_,lt,ft,mt,pt,gt,bt,wt,vt){this.text=_,this.style=lt,this.width=ft,this.height=mt,this.lines=pt,this.lineWidths=gt,this.lineHeight=bt,this.maxLineWidth=wt,this.fontProperties=vt}static measureText(_,lt,ft,mt=xm._canvas){ft=ft??lt.wordWrap;const pt=lt.toFontString(),gt=xm.measureFont(pt);gt.fontSize===0&&(gt.fontSize=lt.fontSize,gt.ascent=lt.fontSize);const bt=mt.getContext("2d",contextSettings);bt.font=pt;const wt=(ft?xm.wordWrap(_,lt,mt):_).split(/(?:\r\n|\r|\n)/),vt=new Array(wt.length);let Ct=0;for(let Nt=0;Nt<wt.length;Nt++){const Ht=xm._measureText(wt[Nt],lt.letterSpacing,bt);vt[Nt]=Ht,Ct=Math.max(Ct,Ht)}let Rt=Ct+lt.strokeThickness;lt.dropShadow&&(Rt+=lt.dropShadowDistance);const Mt=lt.lineHeight||gt.fontSize+lt.strokeThickness;let Ot=Math.max(Mt,gt.fontSize+lt.strokeThickness*2)+lt.leading+(wt.length-1)*(Mt+lt.leading);return lt.dropShadow&&(Ot+=lt.dropShadowDistance),new xm(_,lt,Rt,Ot,wt,vt,Mt+lt.leading,Ct,gt)}static _measureText(_,lt,ft){let mt=!1;xm.experimentalLetterSpacingSupported&&(xm.experimentalLetterSpacing?(ft.letterSpacing=`${lt}px`,ft.textLetterSpacing=`${lt}px`,mt=!0):(ft.letterSpacing="0px",ft.textLetterSpacing="0px"));let pt=ft.measureText(_).width;return pt>0&&(mt?pt-=lt:pt+=(xm.graphemeSegmenter(_).length-1)*lt),pt}static wordWrap(_,lt,ft=xm._canvas){const mt=ft.getContext("2d",contextSettings);let pt=0,gt="",bt="";const wt=Object.create(null),{letterSpacing:vt,whiteSpace:Ct}=lt,Rt=xm.collapseSpaces(Ct),Mt=xm.collapseNewlines(Ct);let Ot=!Rt;const Nt=lt.wordWrapWidth+vt,Ht=xm.tokenize(_);for(let Kt=0;Kt<Ht.length;Kt++){let hr=Ht[Kt];if(xm.isNewline(hr)){if(!Mt){bt+=xm.addLine(gt),Ot=!Rt,gt="",pt=0;continue}hr=" "}if(Rt){const mr=xm.isBreakingSpace(hr),br=xm.isBreakingSpace(gt[gt.length-1]);if(mr&&br)continue}const Qt=xm.getFromCache(hr,vt,wt,mt);if(Qt>Nt)if(gt!==""&&(bt+=xm.addLine(gt),gt="",pt=0),xm.canBreakWords(hr,lt.breakWords)){const mr=xm.wordWrapSplit(hr);for(let br=0;br<mr.length;br++){let Fr=mr[br],kr=Fr,Br=1;for(;mr[br+Br];){const jn=mr[br+Br];if(!xm.canBreakChars(kr,jn,hr,br,lt.breakWords))Fr+=jn;else break;kr=jn,Br++}br+=Br-1;const Nr=xm.getFromCache(Fr,vt,wt,mt);Nr+pt>Nt&&(bt+=xm.addLine(gt),Ot=!1,gt="",pt=0),gt+=Fr,pt+=Nr}}else{gt.length>0&&(bt+=xm.addLine(gt),gt="",pt=0);const mr=Kt===Ht.length-1;bt+=xm.addLine(hr,!mr),Ot=!1,gt="",pt=0}else Qt+pt>Nt&&(Ot=!1,bt+=xm.addLine(gt),gt="",pt=0),(gt.length>0||!xm.isBreakingSpace(hr)||Ot)&&(gt+=hr,pt+=Qt)}return bt+=xm.addLine(gt,!1),bt}static addLine(_,lt=!0){return _=xm.trimRight(_),_=lt?`${_}
`:_,_}static getFromCache(_,lt,ft,mt){let pt=ft[_];return typeof pt!="number"&&(pt=xm._measureText(_,lt,mt)+lt,ft[_]=pt),pt}static collapseSpaces(_){return _==="normal"||_==="pre-line"}static collapseNewlines(_){return _==="normal"}static trimRight(_){if(typeof _!="string")return"";for(let lt=_.length-1;lt>=0;lt--){const ft=_[lt];if(!xm.isBreakingSpace(ft))break;_=_.slice(0,-1)}return _}static isNewline(_){return typeof _!="string"?!1:xm._newlines.includes(_.charCodeAt(0))}static isBreakingSpace(_,lt){return typeof _!="string"?!1:xm._breakingSpaces.includes(_.charCodeAt(0))}static tokenize(_){const lt=[];let ft="";if(typeof _!="string")return lt;for(let mt=0;mt<_.length;mt++){const pt=_[mt],gt=_[mt+1];if(xm.isBreakingSpace(pt,gt)||xm.isNewline(pt)){ft!==""&&(lt.push(ft),ft=""),lt.push(pt);continue}ft+=pt}return ft!==""&&lt.push(ft),lt}static canBreakWords(_,lt){return lt}static canBreakChars(_,lt,ft,mt,pt){return!0}static wordWrapSplit(_){return xm.graphemeSegmenter(_)}static measureFont(_){if(xm._fonts[_])return xm._fonts[_];const lt={ascent:0,descent:0,fontSize:0},ft=xm._canvas,mt=xm._context;mt.font=_;const pt=xm.METRICS_STRING+xm.BASELINE_SYMBOL,gt=Math.ceil(mt.measureText(pt).width);let bt=Math.ceil(mt.measureText(xm.BASELINE_SYMBOL).width);const wt=Math.ceil(xm.HEIGHT_MULTIPLIER*bt);if(bt=bt*xm.BASELINE_MULTIPLIER|0,gt===0||wt===0)return xm._fonts[_]=lt,lt;ft.width=gt,ft.height=wt,mt.fillStyle="#f00",mt.fillRect(0,0,gt,wt),mt.font=_,mt.textBaseline="alphabetic",mt.fillStyle="#000",mt.fillText(pt,0,bt);const vt=mt.getImageData(0,0,gt,wt).data,Ct=vt.length,Rt=gt*4;let Mt=0,Ot=0,Nt=!1;for(Mt=0;Mt<bt;++Mt){for(let Ht=0;Ht<Rt;Ht+=4)if(vt[Ot+Ht]!==255){Nt=!0;break}if(!Nt)Ot+=Rt;else break}for(lt.ascent=bt-Mt,Ot=Ct-Rt,Nt=!1,Mt=wt;Mt>bt;--Mt){for(let Ht=0;Ht<Rt;Ht+=4)if(vt[Ot+Ht]!==255){Nt=!0;break}if(!Nt)Ot-=Rt;else break}return lt.descent=Mt-bt,lt.fontSize=lt.ascent+lt.descent,xm._fonts[_]=lt,lt}static clearMetrics(_=""){_?delete xm._fonts[_]:xm._fonts={}}static get _canvas(){var _;if(!xm.__canvas){let lt;try{const ft=new OffscreenCanvas(0,0);if((_=ft.getContext("2d",contextSettings))!=null&&_.measureText)return xm.__canvas=ft,ft;lt=settings.ADAPTER.createCanvas()}catch{lt=settings.ADAPTER.createCanvas()}lt.width=lt.height=10,xm.__canvas=lt}return xm.__canvas}static get _context(){return xm.__context||(xm.__context=xm._canvas.getContext("2d",contextSettings)),xm.__context}};_TextMetrics.METRICS_STRING="|q",_TextMetrics.BASELINE_SYMBOL="M",_TextMetrics.BASELINE_MULTIPLIER=1.4,_TextMetrics.HEIGHT_MULTIPLIER=2,_TextMetrics.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const it=new Intl.Segmenter;return _=>[...it.segment(_)].map(lt=>lt.segment)}return it=>[...it]})(),_TextMetrics.experimentalLetterSpacing=!1,_TextMetrics._fonts={},_TextMetrics._newlines=[10,13],_TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let TextMetrics=_TextMetrics;const genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],_TextStyle=class Ey{constructor(_){this.styleID=0,this.reset(),deepCopyProperties(this,_,_)}clone(){const _={};return deepCopyProperties(_,this,Ey.defaultStyle),new Ey(_)}reset(){deepCopyProperties(this,Ey.defaultStyle,Ey.defaultStyle)}get align(){return this._align}set align(_){this._align!==_&&(this._align=_,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(_){this._breakWords!==_&&(this._breakWords=_,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(_){this._dropShadow!==_&&(this._dropShadow=_,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(_){this._dropShadowAlpha!==_&&(this._dropShadowAlpha=_,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(_){this._dropShadowAngle!==_&&(this._dropShadowAngle=_,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(_){this._dropShadowBlur!==_&&(this._dropShadowBlur=_,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(_){const lt=getColor(_);this._dropShadowColor!==lt&&(this._dropShadowColor=lt,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(_){this._dropShadowDistance!==_&&(this._dropShadowDistance=_,this.styleID++)}get fill(){return this._fill}set fill(_){const lt=getColor(_);this._fill!==lt&&(this._fill=lt,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(_){this._fillGradientType!==_&&(this._fillGradientType=_,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(_){areArraysEqual(this._fillGradientStops,_)||(this._fillGradientStops=_,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(_){this.fontFamily!==_&&(this._fontFamily=_,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(_){this._fontSize!==_&&(this._fontSize=_,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(_){this._fontStyle!==_&&(this._fontStyle=_,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(_){this._fontVariant!==_&&(this._fontVariant=_,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(_){this._fontWeight!==_&&(this._fontWeight=_,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(_){this._letterSpacing!==_&&(this._letterSpacing=_,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(_){this._lineHeight!==_&&(this._lineHeight=_,this.styleID++)}get leading(){return this._leading}set leading(_){this._leading!==_&&(this._leading=_,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(_){this._lineJoin!==_&&(this._lineJoin=_,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(_){this._miterLimit!==_&&(this._miterLimit=_,this.styleID++)}get padding(){return this._padding}set padding(_){this._padding!==_&&(this._padding=_,this.styleID++)}get stroke(){return this._stroke}set stroke(_){const lt=getColor(_);this._stroke!==lt&&(this._stroke=lt,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(_){this._strokeThickness!==_&&(this._strokeThickness=_,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(_){this._textBaseline!==_&&(this._textBaseline=_,this.styleID++)}get trim(){return this._trim}set trim(_){this._trim!==_&&(this._trim=_,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(_){this._whiteSpace!==_&&(this._whiteSpace=_,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(_){this._wordWrap!==_&&(this._wordWrap=_,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(_){this._wordWrapWidth!==_&&(this._wordWrapWidth=_,this.styleID++)}toFontString(){const _=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let lt=this.fontFamily;Array.isArray(this.fontFamily)||(lt=this.fontFamily.split(","));for(let ft=lt.length-1;ft>=0;ft--){let mt=lt[ft].trim();!/([\"\'])[^\'\"]+\1/.test(mt)&&!genericFontFamilies.includes(mt)&&(mt=`"${mt}"`),lt[ft]=mt}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${_} ${lt.join(",")}`}};_TextStyle.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let TextStyle=_TextStyle;function getColor(it){const _=Color.shared,lt=ft=>{const mt=_.setValue(ft);return mt.alpha===1?mt.toHex():mt.toRgbaString()};return Array.isArray(it)?it.map(lt):lt(it)}function areArraysEqual(it,_){if(!Array.isArray(it)||!Array.isArray(_)||it.length!==_.length)return!1;for(let lt=0;lt<it.length;++lt)if(it[lt]!==_[lt])return!1;return!0}function deepCopyProperties(it,_,lt){for(const ft in lt)Array.isArray(_[ft])?it[ft]=_[ft].slice():it[ft]=_[ft]}const defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},_Text=class nv extends Sprite{constructor(_,lt,ft){let mt=!1;ft||(ft=settings.ADAPTER.createCanvas(),mt=!0),ft.width=3,ft.height=3;const pt=Texture.from(ft);pt.orig=new Rectangle,pt.trim=new Rectangle,super(pt),this._ownCanvas=mt,this.canvas=ft,this.context=ft.getContext("2d",{willReadFrequently:!0}),this._resolution=nv.defaultResolution??settings.RESOLUTION,this._autoResolution=nv.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=_,this.style=lt,this.localStyleID=-1}static get experimentalLetterSpacing(){return TextMetrics.experimentalLetterSpacing}static set experimentalLetterSpacing(_){deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),TextMetrics.experimentalLetterSpacing=_}updateText(_){const lt=this._style;if(this.localStyleID!==lt.styleID&&(this.dirty=!0,this.localStyleID=lt.styleID),!this.dirty&&_)return;this._font=this._style.toFontString();const ft=this.context,mt=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),pt=mt.width,gt=mt.height,bt=mt.lines,wt=mt.lineHeight,vt=mt.lineWidths,Ct=mt.maxLineWidth,Rt=mt.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,pt)+lt.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,gt)+lt.padding*2)*this._resolution),ft.scale(this._resolution,this._resolution),ft.clearRect(0,0,this.canvas.width,this.canvas.height),ft.font=this._font,ft.lineWidth=lt.strokeThickness,ft.textBaseline=lt.textBaseline,ft.lineJoin=lt.lineJoin,ft.miterLimit=lt.miterLimit;let Mt,Ot;const Nt=lt.dropShadow?2:1;for(let Ht=0;Ht<Nt;++Ht){const Kt=lt.dropShadow&&Ht===0,hr=Kt?Math.ceil(Math.max(1,gt)+lt.padding*2):0,Qt=hr*this._resolution;if(Kt){ft.fillStyle="black",ft.strokeStyle="black";const br=lt.dropShadowColor,Fr=lt.dropShadowBlur*this._resolution,kr=lt.dropShadowDistance*this._resolution;ft.shadowColor=Color.shared.setValue(br).setAlpha(lt.dropShadowAlpha).toRgbaString(),ft.shadowBlur=Fr,ft.shadowOffsetX=Math.cos(lt.dropShadowAngle)*kr,ft.shadowOffsetY=Math.sin(lt.dropShadowAngle)*kr+Qt}else ft.fillStyle=this._generateFillStyle(lt,bt,mt),ft.strokeStyle=lt.stroke,ft.shadowColor="black",ft.shadowBlur=0,ft.shadowOffsetX=0,ft.shadowOffsetY=0;let mr=(wt-Rt.fontSize)/2;wt-Rt.fontSize<0&&(mr=0);for(let br=0;br<bt.length;br++)Mt=lt.strokeThickness/2,Ot=lt.strokeThickness/2+br*wt+Rt.ascent+mr,lt.align==="right"?Mt+=Ct-vt[br]:lt.align==="center"&&(Mt+=(Ct-vt[br])/2),lt.stroke&&lt.strokeThickness&&this.drawLetterSpacing(bt[br],Mt+lt.padding,Ot+lt.padding-hr,!0),lt.fill&&this.drawLetterSpacing(bt[br],Mt+lt.padding,Ot+lt.padding-hr)}this.updateTexture()}drawLetterSpacing(_,lt,ft,mt=!1){const pt=this._style.letterSpacing;let gt=!1;if(TextMetrics.experimentalLetterSpacingSupported&&(TextMetrics.experimentalLetterSpacing?(this.context.letterSpacing=`${pt}px`,this.context.textLetterSpacing=`${pt}px`,gt=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),pt===0||gt){mt?this.context.strokeText(_,lt,ft):this.context.fillText(_,lt,ft);return}let bt=lt;const wt=TextMetrics.graphemeSegmenter(_);let vt=this.context.measureText(_).width,Ct=0;for(let Rt=0;Rt<wt.length;++Rt){const Mt=wt[Rt];mt?this.context.strokeText(Mt,bt,ft):this.context.fillText(Mt,bt,ft);let Ot="";for(let Nt=Rt+1;Nt<wt.length;++Nt)Ot+=wt[Nt];Ct=this.context.measureText(Ot).width,bt+=vt-Ct+pt,vt=Ct}}updateTexture(){const _=this.canvas;if(this._style.trim){const gt=trimCanvas(_);gt.data&&(_.width=gt.width,_.height=gt.height,this.context.putImageData(gt.data,0,0))}const lt=this._texture,ft=this._style,mt=ft.trim?0:ft.padding,pt=lt.baseTexture;lt.trim.width=lt._frame.width=_.width/this._resolution,lt.trim.height=lt._frame.height=_.height/this._resolution,lt.trim.x=-mt,lt.trim.y=-mt,lt.orig.width=lt._frame.width-mt*2,lt.orig.height=lt._frame.height-mt*2,this._onTextureUpdate(),pt.setRealSize(_.width,_.height,this._resolution),lt.updateUvs(),this.dirty=!1}_render(_){this._autoResolution&&this._resolution!==_.resolution&&(this._resolution=_.resolution,this.dirty=!0),this.updateText(!0),super._render(_)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(_,lt){return this.updateText(!0),this._textureID===-1&&(_=!1),super.getBounds(_,lt)}getLocalBounds(_){return this.updateText(!0),super.getLocalBounds.call(this,_)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(_,lt,ft){const mt=_.fill;if(Array.isArray(mt)){if(mt.length===1)return mt[0]}else return mt;let pt;const gt=_.dropShadow?_.dropShadowDistance:0,bt=_.padding||0,wt=this.canvas.width/this._resolution-gt-bt*2,vt=this.canvas.height/this._resolution-gt-bt*2,Ct=mt.slice(),Rt=_.fillGradientStops.slice();if(!Rt.length){const Mt=Ct.length+1;for(let Ot=1;Ot<Mt;++Ot)Rt.push(Ot/Mt)}if(Ct.unshift(mt[0]),Rt.unshift(0),Ct.push(mt[mt.length-1]),Rt.push(1),_.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){pt=this.context.createLinearGradient(wt/2,bt,wt/2,vt+bt);const Mt=ft.fontProperties.fontSize+_.strokeThickness;for(let Ot=0;Ot<lt.length;Ot++){const Nt=ft.lineHeight*(Ot-1)+Mt,Ht=ft.lineHeight*Ot;let Kt=Ht;Ot>0&&Nt>Ht&&(Kt=(Ht+Nt)/2);const hr=Ht+Mt,Qt=ft.lineHeight*(Ot+1);let mr=hr;Ot+1<lt.length&&Qt<hr&&(mr=(hr+Qt)/2);const br=(mr-Kt)/vt;for(let Fr=0;Fr<Ct.length;Fr++){let kr=0;typeof Rt[Fr]=="number"?kr=Rt[Fr]:kr=Fr/Ct.length;let Br=Math.min(1,Math.max(0,Kt/vt+kr*br));Br=Number(Br.toFixed(5)),pt.addColorStop(Br,Ct[Fr])}}}else{pt=this.context.createLinearGradient(bt,vt/2,wt+bt,vt/2);const Mt=Ct.length+1;let Ot=1;for(let Nt=0;Nt<Ct.length;Nt++){let Ht;typeof Rt[Nt]=="number"?Ht=Rt[Nt]:Ht=Ot/Mt,pt.addColorStop(Ht,Ct[Nt]),Ot++}}return pt}destroy(_){typeof _=="boolean"&&(_={children:_}),_=Object.assign({},defaultDestroyOptions,_),super.destroy(_),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(_){this.updateText(!0);const lt=sign(this.scale.x)||1;this.scale.x=lt*_/this._texture.orig.width,this._width=_}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(_){this.updateText(!0);const lt=sign(this.scale.y)||1;this.scale.y=lt*_/this._texture.orig.height,this._height=_}get style(){return this._style}set style(_){_=_||{},_ instanceof TextStyle?this._style=_:this._style=new TextStyle(_),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(_){_=String(_??""),this._text!==_&&(this._text=_,this.dirty=!0)}get resolution(){return this._resolution}set resolution(_){this._autoResolution=!1,this._resolution!==_&&(this._resolution=_,this.dirty=!0)}};_Text.defaultAutoResolution=!0;let Text=_Text;class CountLimiter{constructor(_){this.maxItemsPerFrame=_,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function findMultipleBaseTextures(it,_){var ft;let lt=!1;if((ft=it==null?void 0:it._textures)!=null&&ft.length){for(let mt=0;mt<it._textures.length;mt++)if(it._textures[mt]instanceof Texture){const pt=it._textures[mt].baseTexture;_.includes(pt)||(_.push(pt),lt=!0)}}return lt}function findBaseTexture(it,_){if(it.baseTexture instanceof BaseTexture){const lt=it.baseTexture;return _.includes(lt)||_.push(lt),!0}return!1}function findTexture(it,_){if(it._texture&&it._texture instanceof Texture){const lt=it._texture.baseTexture;return _.includes(lt)||_.push(lt),!0}return!1}function drawText(it,_){return _ instanceof Text?(_.updateText(!0),!0):!1}function calculateTextStyle(it,_){if(_ instanceof TextStyle){const lt=_.toFontString();return TextMetrics.measureFont(lt),!0}return!1}function findText(it,_){if(it instanceof Text){_.includes(it.style)||_.push(it.style),_.includes(it)||_.push(it);const lt=it._texture.baseTexture;return _.includes(lt)||_.push(lt),!0}return!1}function findTextStyle(it,_){return it instanceof TextStyle?(_.includes(it)||_.push(it),!0):!1}const _BasePrepare=class xv{constructor(_){this.limiter=new CountLimiter(xv.uploadsPerFrame),this.renderer=_,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}upload(_){return new Promise(lt=>{_&&this.add(_),this.queue.length?(this.completes.push(lt),this.ticking||(this.ticking=!0,Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY))):lt()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const _=this.queue[0];let lt=!1;if(_&&!_._destroyed){for(let ft=0,mt=this.uploadHooks.length;ft<mt;ft++)if(this.uploadHooks[ft](this.uploadHookHelper,_)){this.queue.shift(),lt=!0;break}}lt||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;const _=this.completes.slice(0);this.completes.length=0;for(let lt=0,ft=_.length;lt<ft;lt++)_[lt]()}}registerFindHook(_){return _&&this.addHooks.push(_),this}registerUploadHook(_){return _&&this.uploadHooks.push(_),this}add(_){for(let lt=0,ft=this.addHooks.length;lt<ft&&!this.addHooks[lt](_,this.queue);lt++);if(_ instanceof Container)for(let lt=_.children.length-1;lt>=0;lt--)this.add(_.children[lt]);return this}destroy(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};_BasePrepare.uploadsPerFrame=4;let BasePrepare=_BasePrepare;Object.defineProperties(settings,{UPLOADS_PER_FRAME:{get(){return BasePrepare.uploadsPerFrame},set(it){deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),BasePrepare.uploadsPerFrame=it}}});function uploadBaseTextures(it,_){return _ instanceof BaseTexture?(_._glTextures[it.CONTEXT_UID]||it.texture.bind(_),!0):!1}function uploadGraphics(it,_){if(!(_ instanceof Graphics))return!1;const{geometry:lt}=_;_.finishPoly(),lt.updateBatches();const{batches:ft}=lt;for(let mt=0;mt<ft.length;mt++){const{texture:pt}=ft[mt].style;pt&&uploadBaseTextures(it,pt.baseTexture)}return lt.batchable||it.geometry.bind(lt,_._resolveDirectShader(it)),!0}function findGraphics(it,_){return it instanceof Graphics?(_.push(it),!0):!1}class Prepare extends BasePrepare{constructor(_){super(_),this.uploadHookHelper=this.renderer,this.registerFindHook(findGraphics),this.registerUploadHook(uploadBaseTextures),this.registerUploadHook(uploadGraphics)}}Prepare.extension={name:"prepare",type:ExtensionType.RendererSystem};extensions$1.add(Prepare);var gl2FragmentSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,gl2VertexSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl1FragmentSrc=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,gl1VertexSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,fragmentSimpleSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const tempMat=new Matrix;class TilingSpriteRenderer extends ObjectRenderer{constructor(_){super(_),_.runners.contextChange.add(this),this.quad=new QuadUv,this.state=State.for2d()}contextChange(){const _=this.renderer,lt={globals:_.globalUniforms};this.simpleShader=Shader.from(gl1VertexSrc,fragmentSimpleSrc,lt),this.shader=_.context.webGLVersion>1?Shader.from(gl2VertexSrc,gl2FragmentSrc,lt):Shader.from(gl1VertexSrc,gl1FragmentSrc,lt)}render(_){const lt=this.renderer,ft=this.quad;let mt=ft.vertices;mt[0]=mt[6]=_._width*-_.anchor.x,mt[1]=mt[3]=_._height*-_.anchor.y,mt[2]=mt[4]=_._width*(1-_.anchor.x),mt[5]=mt[7]=_._height*(1-_.anchor.y);const pt=_.uvRespectAnchor?_.anchor.x:0,gt=_.uvRespectAnchor?_.anchor.y:0;mt=ft.uvs,mt[0]=mt[6]=-pt,mt[1]=mt[3]=-gt,mt[2]=mt[4]=1-pt,mt[5]=mt[7]=1-gt,ft.invalidate();const bt=_._texture,wt=bt.baseTexture,vt=wt.alphaMode>0,Ct=_.tileTransform.localTransform,Rt=_.uvMatrix;let Mt=wt.isPowerOfTwo&&bt.frame.width===wt.width&&bt.frame.height===wt.height;Mt&&(wt._glTextures[lt.CONTEXT_UID]?Mt=wt.wrapMode!==WRAP_MODES.CLAMP:wt.wrapMode===WRAP_MODES.CLAMP&&(wt.wrapMode=WRAP_MODES.REPEAT));const Ot=Mt?this.simpleShader:this.shader,Nt=bt.width,Ht=bt.height,Kt=_._width,hr=_._height;tempMat.set(Ct.a*Nt/Kt,Ct.b*Nt/hr,Ct.c*Ht/Kt,Ct.d*Ht/hr,Ct.tx/Kt,Ct.ty/hr),tempMat.invert(),Mt?tempMat.prepend(Rt.mapCoord):(Ot.uniforms.uMapCoord=Rt.mapCoord.toArray(!0),Ot.uniforms.uClampFrame=Rt.uClampFrame,Ot.uniforms.uClampOffset=Rt.uClampOffset),Ot.uniforms.uTransform=tempMat.toArray(!0),Ot.uniforms.uColor=Color.shared.setValue(_.tint).premultiply(_.worldAlpha,vt).toArray(Ot.uniforms.uColor),Ot.uniforms.translationMatrix=_.transform.worldTransform.toArray(!0),Ot.uniforms.uSampler=bt,lt.shader.bind(Ot),lt.geometry.bind(ft),this.state.blendMode=correctBlendMode(_.blendMode,vt),lt.state.set(this.state),lt.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}TilingSpriteRenderer.extension={name:"tilingSprite",type:ExtensionType.RendererPlugin};extensions$1.add(TilingSpriteRenderer);const _Spritesheet=class Sy{constructor(_,lt,ft){this.linkedSheets=[],(_ instanceof BaseTexture||_ instanceof Texture)&&(_={texture:_,data:lt,resolutionFilename:ft});const{texture:mt,data:pt,resolutionFilename:gt=null,cachePrefix:bt=""}=_;this.cachePrefix=bt,this._texture=mt instanceof Texture?mt:null,this.baseTexture=mt instanceof BaseTexture?mt:this._texture.baseTexture,this.textures={},this.animations={},this.data=pt;const wt=this.baseTexture.resource;this.resolution=this._updateResolution(gt||(wt?wt.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(_=null){const{scale:lt}=this.data.meta;let ft=getResolutionOfUrl(_,null);return ft===null&&(ft=typeof lt=="number"?lt:parseFloat(lt??"1")),ft!==1&&this.baseTexture.setResolution(ft),ft}parse(){return new Promise(_=>{this._callback=_,this._batchIndex=0,this._frameKeys.length<=Sy.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(_){let lt=_;const ft=Sy.BATCH_SIZE;for(;lt-_<ft&&lt<this._frameKeys.length;){const mt=this._frameKeys[lt],pt=this._frames[mt],gt=pt.frame;if(gt){let bt=null,wt=null;const vt=pt.trimmed!==!1&&pt.sourceSize?pt.sourceSize:pt.frame,Ct=new Rectangle(0,0,Math.floor(vt.w)/this.resolution,Math.floor(vt.h)/this.resolution);pt.rotated?bt=new Rectangle(Math.floor(gt.x)/this.resolution,Math.floor(gt.y)/this.resolution,Math.floor(gt.h)/this.resolution,Math.floor(gt.w)/this.resolution):bt=new Rectangle(Math.floor(gt.x)/this.resolution,Math.floor(gt.y)/this.resolution,Math.floor(gt.w)/this.resolution,Math.floor(gt.h)/this.resolution),pt.trimmed!==!1&&pt.spriteSourceSize&&(wt=new Rectangle(Math.floor(pt.spriteSourceSize.x)/this.resolution,Math.floor(pt.spriteSourceSize.y)/this.resolution,Math.floor(gt.w)/this.resolution,Math.floor(gt.h)/this.resolution)),this.textures[mt]=new Texture(this.baseTexture,bt,Ct,wt,pt.rotated?2:0,pt.anchor,pt.borders),Texture.addToCache(this.textures[mt],this.cachePrefix+mt.toString())}lt++}}_processAnimations(){const _=this.data.animations||{};for(const lt in _){this.animations[lt]=[];for(let ft=0;ft<_[lt].length;ft++){const mt=_[lt][ft];this.animations[lt].push(this.textures[mt])}}}_parseComplete(){const _=this._callback;this._callback=null,this._batchIndex=0,_.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Sy.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Sy.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(_=!1){var lt;for(const ft in this.textures)this.textures[ft].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,_&&((lt=this._texture)==null||lt.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};_Spritesheet.BATCH_SIZE=1e3;let Spritesheet=_Spritesheet;const validImages=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function getCacheableAssets(it,_,lt){const ft={};if(it.forEach(mt=>{ft[mt]=_}),Object.keys(_.textures).forEach(mt=>{ft[`${_.cachePrefix}${mt}`]=_.textures[mt]}),!lt){const mt=path.dirname(it[0]);_.linkedSheets.forEach((pt,gt)=>{Object.assign(ft,getCacheableAssets([`${mt}/${_.data.meta.related_multi_packs[gt]}`],pt,!0))})}return ft}const spritesheetAsset={extension:ExtensionType.Asset,cache:{test:it=>it instanceof Spritesheet,getCacheableAssets:(it,_)=>getCacheableAssets(it,_,!1)},resolver:{test:it=>{const _=it.split("?")[0].split("."),lt=_.pop(),ft=_.pop();return lt==="json"&&validImages.includes(ft)},parse:it=>{var lt;const _=it.split(".");return{resolution:parseFloat(((lt=settings.RETINA_PREFIX.exec(it))==null?void 0:lt[1])??"1"),format:_[_.length-2],src:it}}},loader:{name:"spritesheetLoader",extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},async testParse(it,_){return path.extname(_.src).toLowerCase()===".json"&&!!it.frames},async parse(it,_,lt){var Ct,Rt;const{texture:ft,imageFilename:mt,cachePrefix:pt}=(_==null?void 0:_.data)??{};let gt=path.dirname(_.src);gt&&gt.lastIndexOf("/")!==gt.length-1&&(gt+="/");let bt;if(ft&&ft.baseTexture)bt=ft;else{const Mt=copySearchParams(gt+(mt??it.meta.image),_.src);bt=(await lt.load([Mt]))[Mt]}const wt=new Spritesheet({texture:bt.baseTexture,data:it,resolutionFilename:_.src,cachePrefix:pt});await wt.parse();const vt=(Ct=it==null?void 0:it.meta)==null?void 0:Ct.related_multi_packs;if(Array.isArray(vt)){const Mt=[];for(const Nt of vt){if(typeof Nt!="string")continue;let Ht=gt+Nt;(Rt=_.data)!=null&&Rt.ignoreMultiPack||(Ht=copySearchParams(Ht,_.src),Mt.push(lt.load({src:Ht,data:{ignoreMultiPack:!0}})))}const Ot=await Promise.all(Mt);wt.linkedSheets=Ot,Ot.forEach(Nt=>{Nt.linkedSheets=[wt].concat(wt.linkedSheets.filter(Ht=>Ht!==Nt))})}return wt},unload(it){it.destroy(!0)}}};extensions$1.add(spritesheetAsset);class BitmapFontData{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class TextFormat{static test(_){return typeof _=="string"&&_.startsWith("info face=")}static parse(_){const lt=_.match(/^[a-z]+\s+.+$/gm),ft={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const pt in lt){const gt=lt[pt].match(/^[a-z]+/gm)[0],bt=lt[pt].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),wt={};for(const vt in bt){const Ct=bt[vt].split("="),Rt=Ct[0],Mt=Ct[1].replace(/"/gm,""),Ot=parseFloat(Mt),Nt=isNaN(Ot)?Mt:Ot;wt[Rt]=Nt}ft[gt].push(wt)}const mt=new BitmapFontData;return ft.info.forEach(pt=>mt.info.push({face:pt.face,size:parseInt(pt.size,10)})),ft.common.forEach(pt=>mt.common.push({lineHeight:parseInt(pt.lineHeight,10)})),ft.page.forEach(pt=>mt.page.push({id:parseInt(pt.id,10),file:pt.file})),ft.char.forEach(pt=>mt.char.push({id:parseInt(pt.id,10),page:parseInt(pt.page,10),x:parseInt(pt.x,10),y:parseInt(pt.y,10),width:parseInt(pt.width,10),height:parseInt(pt.height,10),xoffset:parseInt(pt.xoffset,10),yoffset:parseInt(pt.yoffset,10),xadvance:parseInt(pt.xadvance,10)})),ft.kerning.forEach(pt=>mt.kerning.push({first:parseInt(pt.first,10),second:parseInt(pt.second,10),amount:parseInt(pt.amount,10)})),ft.distanceField.forEach(pt=>mt.distanceField.push({distanceRange:parseInt(pt.distanceRange,10),fieldType:pt.fieldType})),mt}}class XMLFormat{static test(_){const lt=_;return typeof _!="string"&&"getElementsByTagName"in _&&lt.getElementsByTagName("page").length&&lt.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(_){const lt=new BitmapFontData,ft=_.getElementsByTagName("info"),mt=_.getElementsByTagName("common"),pt=_.getElementsByTagName("page"),gt=_.getElementsByTagName("char"),bt=_.getElementsByTagName("kerning"),wt=_.getElementsByTagName("distanceField");for(let vt=0;vt<ft.length;vt++)lt.info.push({face:ft[vt].getAttribute("face"),size:parseInt(ft[vt].getAttribute("size"),10)});for(let vt=0;vt<mt.length;vt++)lt.common.push({lineHeight:parseInt(mt[vt].getAttribute("lineHeight"),10)});for(let vt=0;vt<pt.length;vt++)lt.page.push({id:parseInt(pt[vt].getAttribute("id"),10)||0,file:pt[vt].getAttribute("file")});for(let vt=0;vt<gt.length;vt++){const Ct=gt[vt];lt.char.push({id:parseInt(Ct.getAttribute("id"),10),page:parseInt(Ct.getAttribute("page"),10)||0,x:parseInt(Ct.getAttribute("x"),10),y:parseInt(Ct.getAttribute("y"),10),width:parseInt(Ct.getAttribute("width"),10),height:parseInt(Ct.getAttribute("height"),10),xoffset:parseInt(Ct.getAttribute("xoffset"),10),yoffset:parseInt(Ct.getAttribute("yoffset"),10),xadvance:parseInt(Ct.getAttribute("xadvance"),10)})}for(let vt=0;vt<bt.length;vt++)lt.kerning.push({first:parseInt(bt[vt].getAttribute("first"),10),second:parseInt(bt[vt].getAttribute("second"),10),amount:parseInt(bt[vt].getAttribute("amount"),10)});for(let vt=0;vt<wt.length;vt++)lt.distanceField.push({fieldType:wt[vt].getAttribute("fieldType"),distanceRange:parseInt(wt[vt].getAttribute("distanceRange"),10)});return lt}}class XMLStringFormat{static test(_){return typeof _=="string"&&_.includes("<font>")?XMLFormat.test(settings.ADAPTER.parseXML(_)):!1}static parse(_){return XMLFormat.parse(settings.ADAPTER.parseXML(_))}}const formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(it){for(let _=0;_<formats.length;_++)if(formats[_].test(it))return formats[_];return null}function generateFillStyle(it,_,lt,ft,mt,pt){const gt=lt.fill;if(Array.isArray(gt)){if(gt.length===1)return gt[0]}else return gt;let bt;const wt=lt.dropShadow?lt.dropShadowDistance:0,vt=lt.padding||0,Ct=it.width/ft-wt-vt*2,Rt=it.height/ft-wt-vt*2,Mt=gt.slice(),Ot=lt.fillGradientStops.slice();if(!Ot.length){const Nt=Mt.length+1;for(let Ht=1;Ht<Nt;++Ht)Ot.push(Ht/Nt)}if(Mt.unshift(gt[0]),Ot.unshift(0),Mt.push(gt[gt.length-1]),Ot.push(1),lt.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){bt=_.createLinearGradient(Ct/2,vt,Ct/2,Rt+vt);let Nt=0;const Ht=(pt.fontProperties.fontSize+lt.strokeThickness)/Rt;for(let Kt=0;Kt<mt.length;Kt++){const hr=pt.lineHeight*Kt;for(let Qt=0;Qt<Mt.length;Qt++){let mr=0;typeof Ot[Qt]=="number"?mr=Ot[Qt]:mr=Qt/Mt.length;const br=hr/Rt+mr*Ht;let Fr=Math.max(Nt,br);Fr=Math.min(Fr,1),bt.addColorStop(Fr,Mt[Qt]),Nt=Fr}}}else{bt=_.createLinearGradient(vt,Rt/2,Ct+vt,Rt/2);const Nt=Mt.length+1;let Ht=1;for(let Kt=0;Kt<Mt.length;Kt++){let hr;typeof Ot[Kt]=="number"?hr=Ot[Kt]:hr=Ht/Nt,bt.addColorStop(hr,Mt[Kt]),Ht++}}return bt}function drawGlyph(it,_,lt,ft,mt,pt,gt){const bt=lt.text,wt=lt.fontProperties;_.translate(ft,mt),_.scale(pt,pt);const vt=gt.strokeThickness/2,Ct=-(gt.strokeThickness/2);if(_.font=gt.toFontString(),_.lineWidth=gt.strokeThickness,_.textBaseline=gt.textBaseline,_.lineJoin=gt.lineJoin,_.miterLimit=gt.miterLimit,_.fillStyle=generateFillStyle(it,_,gt,pt,[bt],lt),_.strokeStyle=gt.stroke,gt.dropShadow){const Rt=gt.dropShadowColor,Mt=gt.dropShadowBlur*pt,Ot=gt.dropShadowDistance*pt;_.shadowColor=Color.shared.setValue(Rt).setAlpha(gt.dropShadowAlpha).toRgbaString(),_.shadowBlur=Mt,_.shadowOffsetX=Math.cos(gt.dropShadowAngle)*Ot,_.shadowOffsetY=Math.sin(gt.dropShadowAngle)*Ot}else _.shadowColor="black",_.shadowBlur=0,_.shadowOffsetX=0,_.shadowOffsetY=0;gt.stroke&&gt.strokeThickness&&_.strokeText(bt,vt,Ct+lt.lineHeight-wt.descent),gt.fill&&_.fillText(bt,vt,Ct+lt.lineHeight-wt.descent),_.setTransform(1,0,0,1,0,0),_.fillStyle="rgba(0, 0, 0, 0)"}function extractCharCode(it){return it.codePointAt?it.codePointAt(0):it.charCodeAt(0)}function splitTextToCharacters(it){return Array.from?Array.from(it):it.split("")}function resolveCharacters(it){typeof it=="string"&&(it=[it]);const _=[];for(let lt=0,ft=it.length;lt<ft;lt++){const mt=it[lt];if(Array.isArray(mt)){if(mt.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${mt.length}.`);const pt=mt[0].charCodeAt(0),gt=mt[1].charCodeAt(0);if(gt<pt)throw new Error("[BitmapFont]: Invalid character range.");for(let bt=pt,wt=gt;bt<=wt;bt++)_.push(String.fromCharCode(bt))}else _.push(...splitTextToCharacters(mt))}if(_.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return _}const _BitmapFont=class Jm{constructor(_,lt,ft){var Ct;const[mt]=_.info,[pt]=_.common,[gt]=_.page,[bt]=_.distanceField,wt=getResolutionOfUrl(gt.file),vt={};this._ownsTextures=ft,this.font=mt.face,this.size=mt.size,this.lineHeight=pt.lineHeight/wt,this.chars={},this.pageTextures=vt;for(let Rt=0;Rt<_.page.length;Rt++){const{id:Mt,file:Ot}=_.page[Rt];vt[Mt]=lt instanceof Array?lt[Rt]:lt[Ot],bt!=null&&bt.fieldType&&bt.fieldType!=="none"&&(vt[Mt].baseTexture.alphaMode=ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,vt[Mt].baseTexture.mipmap=MIPMAP_MODES.OFF)}for(let Rt=0;Rt<_.char.length;Rt++){const{id:Mt,page:Ot}=_.char[Rt];let{x:Nt,y:Ht,width:Kt,height:hr,xoffset:Qt,yoffset:mr,xadvance:br}=_.char[Rt];Nt/=wt,Ht/=wt,Kt/=wt,hr/=wt,Qt/=wt,mr/=wt,br/=wt;const Fr=new Rectangle(Nt+vt[Ot].frame.x/wt,Ht+vt[Ot].frame.y/wt,Kt,hr);this.chars[Mt]={xOffset:Qt,yOffset:mr,xAdvance:br,kerning:{},texture:new Texture(vt[Ot].baseTexture,Fr),page:Ot}}for(let Rt=0;Rt<_.kerning.length;Rt++){let{first:Mt,second:Ot,amount:Nt}=_.kerning[Rt];Mt/=wt,Ot/=wt,Nt/=wt,this.chars[Ot]&&(this.chars[Ot].kerning[Mt]=Nt)}this.distanceFieldRange=bt==null?void 0:bt.distanceRange,this.distanceFieldType=((Ct=bt==null?void 0:bt.fieldType)==null?void 0:Ct.toLowerCase())??"none"}destroy(){for(const _ in this.chars)this.chars[_].texture.destroy(),this.chars[_].texture=null;for(const _ in this.pageTextures)this._ownsTextures&&this.pageTextures[_].destroy(!0),this.pageTextures[_]=null;this.chars=null,this.pageTextures=null}static install(_,lt,ft){let mt;if(_ instanceof BitmapFontData)mt=_;else{const gt=autoDetectFormat(_);if(!gt)throw new Error("Unrecognized data format for font.");mt=gt.parse(_)}lt instanceof Texture&&(lt=[lt]);const pt=new Jm(mt,lt,ft);return Jm.available[pt.font]=pt,pt}static uninstall(_){const lt=Jm.available[_];if(!lt)throw new Error(`No font found named '${_}'`);lt.destroy(),delete Jm.available[_]}static from(_,lt,ft){if(!_)throw new Error("[BitmapFont] Property `name` is required.");const{chars:mt,padding:pt,resolution:gt,textureWidth:bt,textureHeight:wt,...vt}=Object.assign({},Jm.defaultOptions,ft),Ct=resolveCharacters(mt),Rt=lt instanceof TextStyle?lt:new TextStyle(lt),Mt=bt,Ot=new BitmapFontData;Ot.info[0]={face:Rt.fontFamily,size:Rt.fontSize},Ot.common[0]={lineHeight:Rt.fontSize};let Nt=0,Ht=0,Kt,hr,Qt,mr=0;const br=[];for(let kr=0;kr<Ct.length;kr++){Kt||(Kt=settings.ADAPTER.createCanvas(),Kt.width=bt,Kt.height=wt,hr=Kt.getContext("2d"),Qt=new BaseTexture(Kt,{resolution:gt,...vt}),br.push(new Texture(Qt)),Ot.page.push({id:br.length-1,file:""}));const Br=Ct[kr],Nr=TextMetrics.measureText(Br,Rt,!1,Kt),jn=Nr.width,Yn=Math.ceil(Nr.height),ga=Math.ceil((Rt.fontStyle==="italic"?2:1)*jn);if(Ht>=wt-Yn*gt){if(Ht===0)throw new Error(`[BitmapFont] textureHeight ${wt}px is too small (fontFamily: '${Rt.fontFamily}', fontSize: ${Rt.fontSize}px, char: '${Br}')`);--kr,Kt=null,hr=null,Qt=null,Ht=0,Nt=0,mr=0;continue}if(mr=Math.max(Yn+Nr.fontProperties.descent,mr),ga*gt+Nt>=Mt){if(Nt===0)throw new Error(`[BitmapFont] textureWidth ${bt}px is too small (fontFamily: '${Rt.fontFamily}', fontSize: ${Rt.fontSize}px, char: '${Br}')`);--kr,Ht+=mr*gt,Ht=Math.ceil(Ht),Nt=0,mr=0;continue}drawGlyph(Kt,hr,Nr,Nt,Ht,gt,Rt);const Kn=extractCharCode(Nr.text);Ot.char.push({id:Kn,page:br.length-1,x:Nt/gt,y:Ht/gt,width:ga,height:Yn,xoffset:0,yoffset:0,xadvance:jn-(Rt.dropShadow?Rt.dropShadowDistance:0)-(Rt.stroke?Rt.strokeThickness:0)}),Nt+=(ga+2*pt)*gt,Nt=Math.ceil(Nt)}if(!(ft!=null&&ft.skipKerning))for(let kr=0,Br=Ct.length;kr<Br;kr++){const Nr=Ct[kr];for(let jn=0;jn<Br;jn++){const Yn=Ct[jn],ga=hr.measureText(Nr).width,Kn=hr.measureText(Yn).width,Xn=hr.measureText(Nr+Yn).width-(ga+Kn);Xn&&Ot.kerning.push({first:extractCharCode(Nr),second:extractCharCode(Yn),amount:Xn})}}const Fr=new Jm(Ot,br,!0);return Jm.available[_]!==void 0&&Jm.uninstall(_),Jm.available[_]=Fr,Fr}};_BitmapFont.ALPHA=[["a","z"],["A","Z"]," "],_BitmapFont.NUMERIC=[["0","9"]],_BitmapFont.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],_BitmapFont.ASCII=[[" ","~"]],_BitmapFont.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:_BitmapFont.ALPHANUMERIC},_BitmapFont.available={};let BitmapFont=_BitmapFont;var msdfFrag=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,msdfVert=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const pageMeshDataDefaultPageMeshData=[],pageMeshDataMSDFPageMeshData=[],charRenderDataPool=[],_BitmapText=class bv extends Container{constructor(_,lt={}){super();const{align:ft,tint:mt,maxWidth:pt,letterSpacing:gt,fontName:bt,fontSize:wt}=Object.assign({},bv.styleDefaults,lt);if(!BitmapFont.available[bt])throw new Error(`Missing BitmapFont "${bt}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=ft,this._tintColor=new Color(mt),this._font=void 0,this._fontName=bt,this._fontSize=wt,this.text=_,this._maxWidth=pt,this._maxLineHeight=0,this._letterSpacing=gt,this._anchor=new ObservablePoint(()=>{this.dirty=!0},this,0,0),this._roundPixels=settings.ROUND_PIXELS,this.dirty=!0,this._resolution=settings.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var ga;const _=BitmapFont.available[this._fontName],lt=this.fontSize,ft=lt/_.size,mt=new Point,pt=[],gt=[],bt=[],wt=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",vt=splitTextToCharacters(wt),Ct=this._maxWidth*_.size/lt,Rt=_.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;let Mt=null,Ot=0,Nt=0,Ht=0,Kt=-1,hr=0,Qt=0,mr=0,br=0;for(let Kn=0;Kn<vt.length;Kn++){const Xn=vt[Kn],eo=extractCharCode(Xn);if(/(?:\s)/.test(Xn)&&(Kt=Kn,hr=Ot,br++),Xn==="\r"||Xn===`
`){gt.push(Ot),bt.push(-1),Nt=Math.max(Nt,Ot),++Ht,++Qt,mt.x=0,mt.y+=_.lineHeight,Mt=null,br=0;continue}const lp=_.chars[eo];if(!lp)continue;Mt&&lp.kerning[Mt]&&(mt.x+=lp.kerning[Mt]);const $a=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point};$a.texture=lp.texture,$a.line=Ht,$a.charCode=eo,$a.position.x=Math.round(mt.x+lp.xOffset+this._letterSpacing/2),$a.position.y=Math.round(mt.y+lp.yOffset),$a.prevSpaces=br,pt.push($a),Ot=$a.position.x+Math.max(lp.xAdvance-lp.xOffset,lp.texture.orig.width),mt.x+=lp.xAdvance+this._letterSpacing,mr=Math.max(mr,lp.yOffset+lp.texture.height),Mt=eo,Kt!==-1&&Ct>0&&mt.x>Ct&&(++Qt,removeItems(pt,1+Kt-Qt,1+Kn-Kt),Kn=Kt,Kt=-1,gt.push(hr),bt.push(pt.length>0?pt[pt.length-1].prevSpaces:0),Nt=Math.max(Nt,hr),Ht++,mt.x=0,mt.y+=_.lineHeight,Mt=null,br=0)}const Fr=vt[vt.length-1];Fr!=="\r"&&Fr!==`
`&&(/(?:\s)/.test(Fr)&&(Ot=hr),gt.push(Ot),Nt=Math.max(Nt,Ot),bt.push(-1));const kr=[];for(let Kn=0;Kn<=Ht;Kn++){let Xn=0;this._align==="right"?Xn=Nt-gt[Kn]:this._align==="center"?Xn=(Nt-gt[Kn])/2:this._align==="justify"&&(Xn=bt[Kn]<0?0:(Nt-gt[Kn])/bt[Kn]),kr.push(Xn)}const Br=pt.length,Nr={},jn=[],Yn=this._activePagesMeshData;Rt.push(...Yn);for(let Kn=0;Kn<Br;Kn++){const Xn=pt[Kn].texture,eo=Xn.baseTexture.uid;if(!Nr[eo]){let lp=Rt.pop();if(!lp){const ro=new MeshGeometry;let bs,ba;_.distanceFieldType==="none"?(bs=new MeshMaterial(Texture.EMPTY),ba=BLEND_MODES.NORMAL):(bs=new MeshMaterial(Texture.EMPTY,{program:Program.from(msdfVert,msdfFrag),uniforms:{uFWidth:0}}),ba=BLEND_MODES.NORMAL_NPM);const Zn=new Mesh(ro,bs);Zn.blendMode=ba,lp={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Zn,vertices:null,uvs:null,indices:null}}lp.index=0,lp.indexCount=0,lp.vertexCount=0,lp.uvsCount=0,lp.total=0;const{_textureCache:$a}=this;$a[eo]=$a[eo]||new Texture(Xn.baseTexture),lp.mesh.texture=$a[eo],lp.mesh.tint=this._tintColor.value,jn.push(lp),Nr[eo]=lp}Nr[eo].total++}for(let Kn=0;Kn<Yn.length;Kn++)jn.includes(Yn[Kn])||this.removeChild(Yn[Kn].mesh);for(let Kn=0;Kn<jn.length;Kn++)jn[Kn].mesh.parent!==this&&this.addChild(jn[Kn].mesh);this._activePagesMeshData=jn;for(const Kn in Nr){const Xn=Nr[Kn],eo=Xn.total;if(!(((ga=Xn.indices)==null?void 0:ga.length)>6*eo)||Xn.vertices.length<Mesh.BATCHABLE_SIZE*2)Xn.vertices=new Float32Array(4*2*eo),Xn.uvs=new Float32Array(4*2*eo),Xn.indices=new Uint16Array(6*eo);else{const lp=Xn.total,$a=Xn.vertices;for(let ro=lp*4*2;ro<$a.length;ro++)$a[ro]=0}Xn.mesh.size=6*eo}for(let Kn=0;Kn<Br;Kn++){const Xn=pt[Kn];let eo=Xn.position.x+kr[Xn.line]*(this._align==="justify"?Xn.prevSpaces:1);this._roundPixels&&(eo=Math.round(eo));const lp=eo*ft,$a=Xn.position.y*ft,ro=Xn.texture,bs=Nr[ro.baseTexture.uid],ba=ro.frame,Zn=ro._uvs,Qn=bs.index++;bs.indices[Qn*6+0]=0+Qn*4,bs.indices[Qn*6+1]=1+Qn*4,bs.indices[Qn*6+2]=2+Qn*4,bs.indices[Qn*6+3]=0+Qn*4,bs.indices[Qn*6+4]=2+Qn*4,bs.indices[Qn*6+5]=3+Qn*4,bs.vertices[Qn*8+0]=lp,bs.vertices[Qn*8+1]=$a,bs.vertices[Qn*8+2]=lp+ba.width*ft,bs.vertices[Qn*8+3]=$a,bs.vertices[Qn*8+4]=lp+ba.width*ft,bs.vertices[Qn*8+5]=$a+ba.height*ft,bs.vertices[Qn*8+6]=lp,bs.vertices[Qn*8+7]=$a+ba.height*ft,bs.uvs[Qn*8+0]=Zn.x0,bs.uvs[Qn*8+1]=Zn.y0,bs.uvs[Qn*8+2]=Zn.x1,bs.uvs[Qn*8+3]=Zn.y1,bs.uvs[Qn*8+4]=Zn.x2,bs.uvs[Qn*8+5]=Zn.y2,bs.uvs[Qn*8+6]=Zn.x3,bs.uvs[Qn*8+7]=Zn.y3}this._textWidth=Nt*ft,this._textHeight=(mt.y+_.lineHeight)*ft;for(const Kn in Nr){const Xn=Nr[Kn];if(this.anchor.x!==0||this.anchor.y!==0){let ro=0;const bs=this._textWidth*this.anchor.x,ba=this._textHeight*this.anchor.y;for(let Zn=0;Zn<Xn.total;Zn++)Xn.vertices[ro++]-=bs,Xn.vertices[ro++]-=ba,Xn.vertices[ro++]-=bs,Xn.vertices[ro++]-=ba,Xn.vertices[ro++]-=bs,Xn.vertices[ro++]-=ba,Xn.vertices[ro++]-=bs,Xn.vertices[ro++]-=ba}this._maxLineHeight=mr*ft;const eo=Xn.mesh.geometry.getBuffer("aVertexPosition"),lp=Xn.mesh.geometry.getBuffer("aTextureCoord"),$a=Xn.mesh.geometry.getIndex();eo.data=Xn.vertices,lp.data=Xn.uvs,$a.data=Xn.indices,eo.update(),lp.update(),$a.update()}for(let Kn=0;Kn<pt.length;Kn++)charRenderDataPool.push(pt[Kn]);this._font=_,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(_){this._autoResolution&&this._resolution!==_.resolution&&(this._resolution=_.resolution,this.dirty=!0);const{distanceFieldRange:lt,distanceFieldType:ft,size:mt}=BitmapFont.available[this._fontName];if(ft!=="none"){const{a:pt,b:gt,c:bt,d:wt}=this.worldTransform,vt=Math.sqrt(pt*pt+gt*gt),Ct=Math.sqrt(bt*bt+wt*wt),Rt=(Math.abs(vt)+Math.abs(Ct))/2,Mt=this.fontSize/mt,Ot=_._view.resolution;for(const Nt of this._activePagesMeshData)Nt.mesh.shader.uniforms.uFWidth=Rt*lt*Mt*Ot}super._render(_)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const _=BitmapFont.available[this._fontName];if(!_)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==_&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(_){if(this.tint!==_){this._tintColor.setValue(_);for(let lt=0;lt<this._activePagesMeshData.length;lt++)this._activePagesMeshData[lt].mesh.tint=_}}get align(){return this._align}set align(_){this._align!==_&&(this._align=_,this.dirty=!0)}get fontName(){return this._fontName}set fontName(_){if(!BitmapFont.available[_])throw new Error(`Missing BitmapFont "${_}"`);this._fontName!==_&&(this._fontName=_,this.dirty=!0)}get fontSize(){return this._fontSize??BitmapFont.available[this._fontName].size}set fontSize(_){this._fontSize!==_&&(this._fontSize=_,this.dirty=!0)}get anchor(){return this._anchor}set anchor(_){typeof _=="number"?this._anchor.set(_):this._anchor.copyFrom(_)}get text(){return this._text}set text(_){_=String(_??""),this._text!==_&&(this._text=_,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(_){this._maxWidth!==_&&(this._maxWidth=_,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(_){this._letterSpacing!==_&&(this._letterSpacing=_,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(_){_!==this._roundPixels&&(this._roundPixels=_,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(_){this._autoResolution=!1,this._resolution!==_&&(this._resolution=_,this.dirty=!0)}destroy(_){const{_textureCache:lt}=this,ft=BitmapFont.available[this._fontName].distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;ft.push(...this._activePagesMeshData);for(const mt of this._activePagesMeshData)this.removeChild(mt.mesh);this._activePagesMeshData=[],ft.filter(mt=>lt[mt.mesh.texture.baseTexture.uid]).forEach(mt=>{mt.mesh.texture=Texture.EMPTY});for(const mt in lt)lt[mt].destroy(),delete lt[mt];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(_)}};_BitmapText.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const validExtensions=[".xml",".fnt"],loadBitmapFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},name:"loadBitmapFont",test(it){return validExtensions.includes(path.extname(it).toLowerCase())},async testParse(it){return TextFormat.test(it)||XMLStringFormat.test(it)},async parse(it,_,lt){const ft=TextFormat.test(it)?TextFormat.parse(it):XMLStringFormat.parse(it),{src:mt}=_,{page:pt}=ft,gt=[];for(let vt=0;vt<pt.length;++vt){const Ct=pt[vt].file;let Rt=path.join(path.dirname(mt),Ct);Rt=copySearchParams(Rt,mt),gt.push(Rt)}const bt=await lt.load(gt),wt=gt.map(vt=>bt[vt]);return BitmapFont.install(ft,wt,!0)},async load(it,_){return(await settings.ADAPTER.fetch(it)).text()},unload(it){it.destroy()}};extensions$1.add(loadBitmapFont);const _HTMLTextStyle=class py extends TextStyle{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(_){return new py(Object.keys(py.defaultOptions).reduce((lt,ft)=>({...lt,[ft]:_[ft]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(_=>{URL.revokeObjectURL(_.src),_.refs--,_.refs===0&&(_.fontFace&&document.fonts.delete(_.fontFace),delete py.availableFonts[_.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(_,lt={}){const{availableFonts:ft}=py;if(ft[_]){const mt=ft[_];return this._fonts.push(mt),mt.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return settings.ADAPTER.fetch(_).then(mt=>mt.blob()).then(async mt=>new Promise((pt,gt)=>{const bt=URL.createObjectURL(mt),wt=new FileReader;wt.onload=()=>pt([bt,wt.result]),wt.onerror=gt,wt.readAsDataURL(mt)})).then(async([mt,pt])=>{const gt=Object.assign({family:path.basename(_,path.extname(_)),weight:"normal",style:"normal",display:"auto",src:mt,dataSrc:pt,refs:1,originalUrl:_,fontFace:null},lt);ft[_]=gt,this._fonts.push(gt),this.styleID++;const bt=new FontFace(gt.family,`url(${gt.src})`,{weight:gt.weight,style:gt.style,display:gt.display});gt.fontFace=bt,await bt.load(),document.fonts.add(bt),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(..._){const lt=_.filter(ft=>!this._overrides.includes(ft));lt.length>0&&(this._overrides.push(...lt),this.styleID++)}removeOverride(..._){const lt=_.filter(ft=>this._overrides.includes(ft));lt.length>0&&(this._overrides=this._overrides.filter(ft=>!lt.includes(ft)),this.styleID++)}toCSS(_){return[`transform: scale(${_})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((_,lt)=>`${_}
            @font-face {
                font-family: "${lt.family}";
                src: url('${lt.dataSrc}');
                font-weight: ${lt.weight};
                font-style: ${lt.style};
                font-display: ${lt.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(_){this._stylesheet!==_&&(this._stylesheet=_,this.styleID++)}normalizeColor(_){return Array.isArray(_)&&(_=rgb2hex(_)),typeof _=="number"?hex2string(_):_}dropShadowToCSS(){let _=this.normalizeColor(this.dropShadowColor);const lt=this.dropShadowAlpha,ft=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),mt=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);_.startsWith("#")&&lt<1&&(_+=(lt*255|0).toString(16).padStart(2,"0"));const pt=`${ft}px ${mt}px`;return this.dropShadowBlur>0?`text-shadow: ${pt} ${this.dropShadowBlur}px ${_}`:`text-shadow: ${pt} ${_}`}reset(){Object.assign(this,py.defaultOptions)}onBeforeDraw(){const{fontsDirty:_}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&_?new Promise(lt=>setTimeout(lt,100)):Promise.resolve()}get isSafari(){const{userAgent:_}=settings.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(_)}set fillGradientStops(_){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(_){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(_){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(_){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(_){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(_){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(_){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};_HTMLTextStyle.availableFonts={},_HTMLTextStyle.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let HTMLTextStyle=_HTMLTextStyle;const _HTMLText=class my extends Sprite{constructor(_="",lt={}){super(Texture.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const ft=new Image,mt=Texture.from(ft,{scaleMode:settings.SCALE_MODE,resourceOptions:{autoLoad:!1}});mt.orig=new Rectangle,mt.trim=new Rectangle,this.texture=mt;const pt="http://www.w3.org/2000/svg",gt="http://www.w3.org/1999/xhtml",bt=document.createElementNS(pt,"svg"),wt=document.createElementNS(pt,"foreignObject"),vt=document.createElementNS(gt,"div"),Ct=document.createElementNS(gt,"style");wt.setAttribute("width","10000"),wt.setAttribute("height","10000"),wt.style.overflow="hidden",bt.appendChild(wt),this.maxWidth=my.defaultMaxWidth,this.maxHeight=my.defaultMaxHeight,this._domElement=vt,this._styleElement=Ct,this._svgRoot=bt,this._foreignObject=wt,this._foreignObject.appendChild(Ct),this._foreignObject.appendChild(vt),this._image=ft,this._loadImage=new Image,this._autoResolution=my.defaultAutoResolution,this._resolution=my.defaultResolution??settings.RESOLUTION,this.text=_,this.style=lt}measureText(_){var Ct,Rt;const{text:lt,style:ft,resolution:mt}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},_);Object.assign(this._domElement,{innerHTML:lt,style:ft.toCSS(mt)}),this._styleElement.textContent=ft.toGlobalCSS(),document.body.appendChild(this._svgRoot);const pt=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:gt,height:bt}=pt;(gt>this.maxWidth||bt>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const wt=Math.min(this.maxWidth,Math.ceil(gt)),vt=Math.min(this.maxHeight,Math.ceil(bt));return this._svgRoot.setAttribute("width",wt.toString()),this._svgRoot.setAttribute("height",vt.toString()),lt!==this._text&&(this._domElement.innerHTML=this._text),ft!==this._style&&(Object.assign(this._domElement,{style:(Ct=this._style)==null?void 0:Ct.toCSS(mt)}),this._styleElement.textContent=(Rt=this._style)==null?void 0:Rt.toGlobalCSS()),{width:wt+ft.padding*2,height:vt+ft.padding*2}}async updateText(_=!0){const{style:lt,_image:ft,_loadImage:mt}=this;if(this.localStyleID!==lt.styleID&&(this.dirty=!0,this.localStyleID=lt.styleID),!this.dirty&&_)return;const{width:pt,height:gt}=this.measureText();ft.width=mt.width=Math.ceil(Math.max(1,pt)),ft.height=mt.height=Math.ceil(Math.max(1,gt)),this._updateID++;const bt=this._updateID;await new Promise(wt=>{mt.onload=async()=>{if(bt<this._updateID){wt();return}await lt.onBeforeDraw(),ft.src=mt.src,mt.onload=null,mt.src="",this.updateTexture(),wt()};const vt=new XMLSerializer().serializeToString(this._svgRoot);mt.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(vt)}`})}get source(){return this._image}updateTexture(){const{style:_,texture:lt,_image:ft,resolution:mt}=this,{padding:pt}=_,{baseTexture:gt}=lt;lt.trim.width=lt._frame.width=ft.width/mt,lt.trim.height=lt._frame.height=ft.height/mt,lt.trim.x=-pt,lt.trim.y=-pt,lt.orig.width=lt._frame.width-pt*2,lt.orig.height=lt._frame.height-pt*2,this._onTextureUpdate(),gt.setRealSize(ft.width,ft.height,mt),this.dirty=!1}_render(_){this._autoResolution&&this._resolution!==_.resolution&&(this._resolution=_.resolution,this.dirty=!0),this.updateText(!0),super._render(_)}_renderCanvas(_){this._autoResolution&&this._resolution!==_.resolution&&(this._resolution=_.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(_)}getLocalBounds(_){return this.updateText(!0),super.getLocalBounds(_)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(_){var ft,mt,pt,gt,bt;typeof _=="boolean"&&(_={children:_}),_=Object.assign({},my.defaultDestroyOptions,_),super.destroy(_);const lt=null;this.ownsStyle&&((ft=this._style)==null||ft.cleanFonts()),this._style=lt,(mt=this._svgRoot)==null||mt.remove(),this._svgRoot=lt,(pt=this._domElement)==null||pt.remove(),this._domElement=lt,(gt=this._foreignObject)==null||gt.remove(),this._foreignObject=lt,(bt=this._styleElement)==null||bt.remove(),this._styleElement=lt,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=lt,this._image.src="",this._image=lt}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(_){this.updateText(!0);const lt=sign(this.scale.x)||1;this.scale.x=lt*_/this._image.width/this.resolution,this._width=_}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(_){this.updateText(!0);const lt=sign(this.scale.y)||1;this.scale.y=lt*_/this._image.height/this.resolution,this._height=_}get style(){return this._style}set style(_){this._style!==_&&(_=_||{},_ instanceof HTMLTextStyle?(this.ownsStyle=!1,this._style=_):_ instanceof TextStyle?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=HTMLTextStyle.from(_)):(this.ownsStyle=!0,this._style=new HTMLTextStyle(_)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(_){_=String(_===""||_===null||_===void 0?" ":_),_=this.sanitiseText(_),this._text!==_&&(this._text=_,this.dirty=!0)}get resolution(){return this._resolution}set resolution(_){this._autoResolution=!1,this._resolution!==_&&(this._resolution=_,this.dirty=!0)}sanitiseText(_){return _.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};_HTMLText.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},_HTMLText.defaultMaxWidth=2024,_HTMLText.defaultMaxHeight=2024,_HTMLText.defaultAutoResolution=!0;var dist$1={},dist={};function commonjsRequire(it){throw new Error('Could not dynamically require "'+it+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ort_min={exports:{}};/*!
 * ONNX Runtime Web v1.20.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */(function(module,exports){var ort=(()=>{var Ic=Object.create,yr=Object.defineProperty,_c=Object.getOwnPropertyDescriptor,Sc=Object.getOwnPropertyNames,Oc=Object.getPrototypeOf,Ac=Object.prototype.hasOwnProperty,Bn=(it=>typeof commonjsRequire<"u"?commonjsRequire:typeof Proxy<"u"?new Proxy(it,{get:(_,lt)=>(typeof commonjsRequire<"u"?commonjsRequire:_)[lt]}):it)(function(it){if(typeof commonjsRequire<"u")return commonjsRequire.apply(this,arguments);throw Error('Dynamic require of "'+it+'" is not supported')}),x=(it,_)=>()=>(it&&(_=it(it=0)),_),tt=(it,_)=>()=>(_||it((_={exports:{}}).exports,_),_.exports),We=(it,_)=>{for(var lt in _)yr(it,lt,{get:_[lt],enumerable:!0})},oi=(it,_,lt,ft)=>{if(_&&typeof _=="object"||typeof _=="function")for(let mt of Sc(_))!Ac.call(it,mt)&&mt!==lt&&yr(it,mt,{get:()=>_[mt],enumerable:!(ft=_c(_,mt))||ft.enumerable});return it},Ae=(it,_,lt)=>(lt=it!=null?Ic(Oc(it)):{},oi(!it||!it.__esModule?yr(lt,"default",{value:it,enumerable:!0}):lt,it)),gr=it=>oi(yr({},"__esModule",{value:!0}),it),xr,se,ue,Pc,Tr,wr=x(()=>{xr=new Map,se=[],ue=(it,_,lt)=>{if(_&&typeof _.init=="function"&&typeof _.createInferenceSessionHandler=="function"){let ft=xr.get(it);if(ft===void 0)xr.set(it,{backend:_,priority:lt});else{if(ft.priority>lt)return;if(ft.priority===lt&&ft.backend!==_)throw new Error(`cannot register backend "${it}" using priority ${lt}`)}if(lt>=0){let mt=se.indexOf(it);mt!==-1&&se.splice(mt,1);for(let pt=0;pt<se.length;pt++)if(xr.get(se[pt]).priority<=lt){se.splice(pt,0,it);return}se.push(it)}return}throw new TypeError("not a valid backend")},Pc=async it=>{let _=xr.get(it);if(!_)return"backend not found.";if(_.initialized)return _.backend;if(_.aborted)return _.error;{let lt=!!_.initPromise;try{return lt||(_.initPromise=_.backend.init(it)),await _.initPromise,_.initialized=!0,_.backend}catch(ft){return lt||(_.error=`${ft}`,_.aborted=!0),_.error}finally{delete _.initPromise}}},Tr=async it=>{let _=it.executionProviders||[],lt=_.map(wt=>typeof wt=="string"?wt:wt.name),ft=lt.length===0?se:lt,mt,pt=[],gt=new Set;for(let wt of ft){let vt=await Pc(wt);typeof vt=="string"?pt.push({name:wt,err:vt}):(mt||(mt=vt),mt===vt&&gt.add(wt))}if(!mt)throw new Error(`no available backend found. ERR: ${pt.map(wt=>`[${wt.name}] ${wt.err}`).join(", ")}`);for(let{name:wt,err:vt}of pt)lt.includes(wt)&&console.warn(`removing requested execution provider "${wt}" from session options because it is not available: ${vt}`);let bt=_.filter(wt=>gt.has(typeof wt=="string"?wt:wt.name));return[mt,new Proxy(it,{get:(wt,vt)=>vt==="executionProviders"?bt:Reflect.get(wt,vt)})]}}),ii=x(()=>{wr()}),ai,si=x(()=>{ai="1.20.0"}),ui,Tt,Fn=x(()=>{si(),ui="warning",Tt={wasm:{},webgl:{},webgpu:{},versions:{common:ai},set logLevel(it){if(it!==void 0){if(typeof it!="string"||["verbose","info","warning","error","fatal"].indexOf(it)===-1)throw new Error(`Unsupported logging level: ${it}`);ui=it}},get logLevel(){return ui}},Object.defineProperty(Tt,"logLevel",{enumerable:!0})}),$,li=x(()=>{Fn(),$=Tt}),fi,ci,pi=x(()=>{fi=(it,_)=>{let lt=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);lt.width=it.dims[3],lt.height=it.dims[2];let ft=lt.getContext("2d");if(ft!=null){let mt,pt;(_==null?void 0:_.tensorLayout)!==void 0&&_.tensorLayout==="NHWC"?(mt=it.dims[2],pt=it.dims[3]):(mt=it.dims[3],pt=it.dims[2]);let gt=(_==null?void 0:_.format)!==void 0?_.format:"RGB",bt=_==null?void 0:_.norm,wt,vt;bt===void 0||bt.mean===void 0?wt=[255,255,255,255]:typeof bt.mean=="number"?wt=[bt.mean,bt.mean,bt.mean,bt.mean]:(wt=[bt.mean[0],bt.mean[1],bt.mean[2],0],bt.mean[3]!==void 0&&(wt[3]=bt.mean[3])),bt===void 0||bt.bias===void 0?vt=[0,0,0,0]:typeof bt.bias=="number"?vt=[bt.bias,bt.bias,bt.bias,bt.bias]:(vt=[bt.bias[0],bt.bias[1],bt.bias[2],0],bt.bias[3]!==void 0&&(vt[3]=bt.bias[3]));let Ct=pt*mt,Rt=0,Mt=Ct,Ot=Ct*2,Nt=-1;gt==="RGBA"?(Rt=0,Mt=Ct,Ot=Ct*2,Nt=Ct*3):gt==="RGB"?(Rt=0,Mt=Ct,Ot=Ct*2):gt==="RBG"&&(Rt=0,Ot=Ct,Mt=Ct*2);for(let Ht=0;Ht<pt;Ht++)for(let Kt=0;Kt<mt;Kt++){let hr=(it.data[Rt++]-vt[0])*wt[0],Qt=(it.data[Mt++]-vt[1])*wt[1],mr=(it.data[Ot++]-vt[2])*wt[2],br=Nt===-1?255:(it.data[Nt++]-vt[3])*wt[3];ft.fillStyle="rgba("+hr+","+Qt+","+mr+","+br+")",ft.fillRect(Kt,Ht,1,1)}if("toDataURL"in lt)return lt.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},ci=(it,_)=>{let lt=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),ft;if(lt!=null){let mt,pt,gt;(_==null?void 0:_.tensorLayout)!==void 0&&_.tensorLayout==="NHWC"?(mt=it.dims[2],pt=it.dims[1],gt=it.dims[3]):(mt=it.dims[3],pt=it.dims[2],gt=it.dims[1]);let bt=_!==void 0&&_.format!==void 0?_.format:"RGB",wt=_==null?void 0:_.norm,vt,Ct;wt===void 0||wt.mean===void 0?vt=[255,255,255,255]:typeof wt.mean=="number"?vt=[wt.mean,wt.mean,wt.mean,wt.mean]:(vt=[wt.mean[0],wt.mean[1],wt.mean[2],255],wt.mean[3]!==void 0&&(vt[3]=wt.mean[3])),wt===void 0||wt.bias===void 0?Ct=[0,0,0,0]:typeof wt.bias=="number"?Ct=[wt.bias,wt.bias,wt.bias,wt.bias]:(Ct=[wt.bias[0],wt.bias[1],wt.bias[2],0],wt.bias[3]!==void 0&&(Ct[3]=wt.bias[3]));let Rt=pt*mt;if(_!==void 0&&(_.format!==void 0&&gt===4&&_.format!=="RGBA"||gt===3&&_.format!=="RGB"&&_.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let Mt=4,Ot=0,Nt=1,Ht=2,Kt=3,hr=0,Qt=Rt,mr=Rt*2,br=-1;bt==="RGBA"?(hr=0,Qt=Rt,mr=Rt*2,br=Rt*3):bt==="RGB"?(hr=0,Qt=Rt,mr=Rt*2):bt==="RBG"&&(hr=0,mr=Rt,Qt=Rt*2),ft=lt.createImageData(mt,pt);for(let Fr=0;Fr<pt*mt;Ot+=Mt,Nt+=Mt,Ht+=Mt,Kt+=Mt,Fr++)ft.data[Ot]=(it.data[hr++]-Ct[0])*vt[0],ft.data[Nt]=(it.data[Qt++]-Ct[1])*vt[1],ft.data[Ht]=(it.data[mr++]-Ct[2])*vt[2],ft.data[Kt]=br===-1?255:(it.data[br++]-Ct[3])*vt[3]}else throw new Error("Can not access image data");return ft}}),Nn,di,hi,mi,bi,yi,gi=x(()=>{vr(),Nn=(it,_)=>{if(it===void 0)throw new Error("Image buffer must be defined");if(_.height===void 0||_.width===void 0)throw new Error("Image height and width must be defined");if(_.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:lt,width:ft}=_,mt=_.norm??{mean:255,bias:0},pt,gt;typeof mt.mean=="number"?pt=[mt.mean,mt.mean,mt.mean,mt.mean]:pt=[mt.mean[0],mt.mean[1],mt.mean[2],mt.mean[3]??255],typeof mt.bias=="number"?gt=[mt.bias,mt.bias,mt.bias,mt.bias]:gt=[mt.bias[0],mt.bias[1],mt.bias[2],mt.bias[3]??0];let bt=_.format!==void 0?_.format:"RGBA",wt=_.tensorFormat!==void 0&&_.tensorFormat!==void 0?_.tensorFormat:"RGB",vt=lt*ft,Ct=wt==="RGBA"?new Float32Array(vt*4):new Float32Array(vt*3),Rt=4,Mt=0,Ot=1,Nt=2,Ht=3,Kt=0,hr=vt,Qt=vt*2,mr=-1;bt==="RGB"&&(Rt=3,Mt=0,Ot=1,Nt=2,Ht=-1),wt==="RGBA"?mr=vt*3:wt==="RBG"?(Kt=0,Qt=vt,hr=vt*2):wt==="BGR"&&(Qt=0,hr=vt,Kt=vt*2);for(let br=0;br<vt;br++,Mt+=Rt,Nt+=Rt,Ot+=Rt,Ht+=Rt)Ct[Kt++]=(it[Mt]+gt[0])/pt[0],Ct[hr++]=(it[Ot]+gt[1])/pt[1],Ct[Qt++]=(it[Nt]+gt[2])/pt[2],mr!==-1&&Ht!==-1&&(Ct[mr++]=(it[Ht]+gt[3])/pt[3]);return wt==="RGBA"?new st("float32",Ct,[1,4,lt,ft]):new st("float32",Ct,[1,3,lt,ft])},di=async(it,_)=>{let lt=typeof HTMLImageElement<"u"&&it instanceof HTMLImageElement,ft=typeof ImageData<"u"&&it instanceof ImageData,mt=typeof ImageBitmap<"u"&&it instanceof ImageBitmap,pt=typeof it=="string",gt,bt=_??{},wt=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},vt=Ct=>typeof HTMLCanvasElement<"u"&&Ct instanceof HTMLCanvasElement||Ct instanceof OffscreenCanvas?Ct.getContext("2d"):null;if(lt){let Ct=wt();Ct.width=it.width,Ct.height=it.height;let Rt=vt(Ct);if(Rt!=null){let Mt=it.height,Ot=it.width;if(_!==void 0&&_.resizedHeight!==void 0&&_.resizedWidth!==void 0&&(Mt=_.resizedHeight,Ot=_.resizedWidth),_!==void 0){if(bt=_,_.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");bt.tensorFormat="RGBA",bt.height=Mt,bt.width=Ot}else bt.tensorFormat="RGBA",bt.height=Mt,bt.width=Ot;Rt.drawImage(it,0,0),gt=Rt.getImageData(0,0,Ot,Mt).data}else throw new Error("Can not access image data")}else if(ft){let Ct,Rt;if(_!==void 0&&_.resizedWidth!==void 0&&_.resizedHeight!==void 0?(Ct=_.resizedHeight,Rt=_.resizedWidth):(Ct=it.height,Rt=it.width),_!==void 0&&(bt=_),bt.format="RGBA",bt.height=Ct,bt.width=Rt,_!==void 0){let Mt=wt();Mt.width=Rt,Mt.height=Ct;let Ot=vt(Mt);if(Ot!=null)Ot.putImageData(it,0,0),gt=Ot.getImageData(0,0,Rt,Ct).data;else throw new Error("Can not access image data")}else gt=it.data}else if(mt){if(_===void 0)throw new Error("Please provide image config with format for Imagebitmap");let Ct=wt();Ct.width=it.width,Ct.height=it.height;let Rt=vt(Ct);if(Rt!=null){let Mt=it.height,Ot=it.width;return Rt.drawImage(it,0,0,Ot,Mt),gt=Rt.getImageData(0,0,Ot,Mt).data,bt.height=Mt,bt.width=Ot,Nn(gt,bt)}else throw new Error("Can not access image data")}else{if(pt)return new Promise((Ct,Rt)=>{let Mt=wt(),Ot=vt(Mt);if(!it||!Ot)return Rt();let Nt=new Image;Nt.crossOrigin="Anonymous",Nt.src=it,Nt.onload=()=>{Mt.width=Nt.width,Mt.height=Nt.height,Ot.drawImage(Nt,0,0,Mt.width,Mt.height);let Ht=Ot.getImageData(0,0,Mt.width,Mt.height);bt.height=Mt.height,bt.width=Mt.width,Ct(Nn(Ht.data,bt))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(gt!==void 0)return Nn(gt,bt);throw new Error("Input data provided is not supported - aborted tensor creation")},hi=(it,_)=>{let{width:lt,height:ft,download:mt,dispose:pt}=_,gt=[1,ft,lt,4];return new st({location:"texture",type:"float32",texture:it,dims:gt,download:mt,dispose:pt})},mi=(it,_)=>{let{dataType:lt,dims:ft,download:mt,dispose:pt}=_;return new st({location:"gpu-buffer",type:lt??"float32",gpuBuffer:it,dims:ft,download:mt,dispose:pt})},bi=(it,_)=>{let{dataType:lt,dims:ft,download:mt,dispose:pt}=_;return new st({location:"ml-tensor",type:lt??"float32",mlTensor:it,dims:ft,download:mt,dispose:pt})},yi=(it,_,lt)=>new st({location:"cpu-pinned",type:it,data:_,dims:lt??[_.length]})}),le,He,xi,Ti,wi=x(()=>{le=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),He=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),xi=!1,Ti=()=>{if(!xi){xi=!0;let it=typeof BigInt64Array<"u"&&BigInt64Array.from,_=typeof BigUint64Array<"u"&&BigUint64Array.from,lt=typeof Float16Array<"u"&&Float16Array.from;it&&(le.set("int64",BigInt64Array),He.set(BigInt64Array,"int64")),_&&(le.set("uint64",BigUint64Array),He.set(BigUint64Array,"uint64")),lt?(le.set("float16",Float16Array),He.set(Float16Array,"float16")):le.set("float16",Uint16Array)}}}),vi,Ii,_i=x(()=>{vr(),vi=it=>{let _=1;for(let lt=0;lt<it.length;lt++){let ft=it[lt];if(typeof ft!="number"||!Number.isSafeInteger(ft))throw new TypeError(`dims[${lt}] must be an integer, got: ${ft}`);if(ft<0)throw new RangeError(`dims[${lt}] must be a non-negative integer, got: ${ft}`);_*=ft}return _},Ii=(it,_)=>{switch(it.location){case"cpu":return new st(it.type,it.data,_);case"cpu-pinned":return new st({location:"cpu-pinned",data:it.data,type:it.type,dims:_});case"texture":return new st({location:"texture",texture:it.texture,type:it.type,dims:_});case"gpu-buffer":return new st({location:"gpu-buffer",gpuBuffer:it.gpuBuffer,type:it.type,dims:_});case"ml-tensor":return new st({location:"ml-tensor",mlTensor:it.mlTensor,type:it.type,dims:_});default:throw new Error(`tensorReshape: tensor location ${it.location} is not supported`)}}}),st,vr=x(()=>{pi(),gi(),wi(),_i(),st=class{constructor(it,_,lt){Ti();let ft,mt;if(typeof it=="object"&&"location"in it)switch(this.dataLocation=it.location,ft=it.type,mt=it.dims,it.location){case"cpu-pinned":{let gt=le.get(ft);if(!gt)throw new TypeError(`unsupported type "${ft}" to create tensor from pinned buffer`);if(!(it.data instanceof gt))throw new TypeError(`buffer should be of type ${gt.name}`);this.cpuData=it.data;break}case"texture":{if(ft!=="float32")throw new TypeError(`unsupported type "${ft}" to create tensor from texture`);this.gpuTextureData=it.texture,this.downloader=it.download,this.disposer=it.dispose;break}case"gpu-buffer":{if(ft!=="float32"&&ft!=="float16"&&ft!=="int32"&&ft!=="int64"&&ft!=="uint32"&&ft!=="uint8"&&ft!=="bool"&&ft!=="uint4"&&ft!=="int4")throw new TypeError(`unsupported type "${ft}" to create tensor from gpu buffer`);this.gpuBufferData=it.gpuBuffer,this.downloader=it.download,this.disposer=it.dispose;break}case"ml-tensor":{if(ft!=="float32"&&ft!=="float16"&&ft!=="int32"&&ft!=="int64"&&ft!=="uint32"&&ft!=="uint64"&&ft!=="int8"&&ft!=="uint8"&&ft!=="bool")throw new TypeError(`unsupported type "${ft}" to create tensor from MLTensor`);this.mlTensorData=it.mlTensor,this.downloader=it.download,this.disposer=it.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let gt,bt;if(typeof it=="string")if(ft=it,bt=lt,it==="string"){if(!Array.isArray(_))throw new TypeError("A string tensor's data must be a string array.");gt=_}else{let wt=le.get(it);if(wt===void 0)throw new TypeError(`Unsupported tensor type: ${it}.`);if(Array.isArray(_)){if(it==="float16"&&wt===Uint16Array||it==="uint4"||it==="int4")throw new TypeError(`Creating a ${it} tensor from number array is not supported. Please use ${wt.name} as data.`);it==="uint64"||it==="int64"?gt=wt.from(_,BigInt):gt=wt.from(_)}else if(_ instanceof wt)gt=_;else if(_ instanceof Uint8ClampedArray)if(it==="uint8")gt=Uint8Array.from(_);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else throw new TypeError(`A ${ft} tensor's data must be type of ${wt}`)}else if(bt=_,Array.isArray(it)){if(it.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let wt=typeof it[0];if(wt==="string")ft="string",gt=it;else if(wt==="boolean")ft="bool",gt=Uint8Array.from(it);else throw new TypeError(`Invalid element type of data array: ${wt}.`)}else if(it instanceof Uint8ClampedArray)ft="uint8",gt=Uint8Array.from(it);else{let wt=He.get(it.constructor);if(wt===void 0)throw new TypeError(`Unsupported type for tensor data: ${it.constructor}.`);ft=wt,gt=it}if(bt===void 0)bt=[gt.length];else if(!Array.isArray(bt))throw new TypeError("A tensor's dims must be a number array");mt=bt,this.cpuData=gt,this.dataLocation="cpu"}let pt=vi(mt);if(this.cpuData&&pt!==this.cpuData.length&&!((ft==="uint4"||ft==="int4")&&Math.ceil(pt/2)===this.cpuData.length))throw new Error(`Tensor's size(${pt}) does not match data length(${this.cpuData.length}).`);this.type=ft,this.dims=mt,this.size=pt}static async fromImage(it,_){return di(it,_)}static fromTexture(it,_){return hi(it,_)}static fromGpuBuffer(it,_){return mi(it,_)}static fromMLTensor(it,_){return bi(it,_)}static fromPinnedBuffer(it,_,lt){return yi(it,_,lt)}toDataURL(it){return fi(this,it)}toImageData(it){return ci(this,it)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(it){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let _=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=_,it&&this.disposer&&(this.disposer(),this.disposer=void 0),_}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(it){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Ii(this,it)}}}),et,Ir=x(()=>{vr(),et=st}),Cn,Si,Jt,Zt,Rn=x(()=>{Fn(),Cn=(it,_)=>{(typeof Tt.trace>"u"?!Tt.wasm.trace:!Tt.trace)||console.timeStamp(`${it}::ORT::${_}`)},Si=(it,_)=>{var mt;let lt=((mt=new Error().stack)==null?void 0:mt.split(/\r\n|\r|\n/g))||[],ft=!1;for(let pt=0;pt<lt.length;pt++){if(ft&&!lt[pt].includes("TRACE_FUNC")){let gt=`FUNC_${it}::${lt[pt].trim().split(" ")[1]}`;_&&(gt+=`::${_}`),Cn("CPU",gt);return}lt[pt].includes("TRACE_FUNC")&&(ft=!0)}},Jt=it=>{(typeof Tt.trace>"u"?!Tt.wasm.trace:!Tt.trace)||Si("BEGIN",it)},Zt=it=>{(typeof Tt.trace>"u"?!Tt.wasm.trace:!Tt.trace)||Si("END",it)}}),_r,Oi=x(()=>{wr(),Ir(),Rn(),_r=class Tv{constructor(_){this.handler=_}async run(_,lt,ft){Jt();let mt={},pt={};if(typeof _!="object"||_===null||_ instanceof et||Array.isArray(_))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let gt=!0;if(typeof lt=="object"){if(lt===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(lt instanceof et)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(lt)){if(lt.length===0)throw new TypeError("'fetches' cannot be an empty array.");gt=!1;for(let vt of lt){if(typeof vt!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(vt)===-1)throw new RangeError(`'fetches' contains invalid output name: ${vt}.`);mt[vt]=null}if(typeof ft=="object"&&ft!==null)pt=ft;else if(typeof ft<"u")throw new TypeError("'options' must be an object.")}else{let vt=!1,Ct=Object.getOwnPropertyNames(lt);for(let Rt of this.outputNames)if(Ct.indexOf(Rt)!==-1){let Mt=lt[Rt];(Mt===null||Mt instanceof et)&&(vt=!0,gt=!1,mt[Rt]=Mt)}if(vt){if(typeof ft=="object"&&ft!==null)pt=ft;else if(typeof ft<"u")throw new TypeError("'options' must be an object.")}else pt=lt}}else if(typeof lt<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let vt of this.inputNames)if(typeof _[vt]>"u")throw new Error(`input '${vt}' is missing in 'feeds'.`);if(gt)for(let vt of this.outputNames)mt[vt]=null;let bt=await this.handler.run(_,mt,pt),wt={};for(let vt in bt)if(Object.hasOwnProperty.call(bt,vt)){let Ct=bt[vt];Ct instanceof et?wt[vt]=Ct:wt[vt]=new et(Ct.type,Ct.data,Ct.dims)}return Zt(),wt}async release(){return this.handler.dispose()}static async create(_,lt,ft,mt){Jt();let pt,gt={};if(typeof _=="string"){if(pt=_,typeof lt=="object"&&lt!==null)gt=lt;else if(typeof lt<"u")throw new TypeError("'options' must be an object.")}else if(_ instanceof Uint8Array){if(pt=_,typeof lt=="object"&&lt!==null)gt=lt;else if(typeof lt<"u")throw new TypeError("'options' must be an object.")}else if(_ instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&_ instanceof SharedArrayBuffer){let Ct=_,Rt=0,Mt=_.byteLength;if(typeof lt=="object"&&lt!==null)gt=lt;else if(typeof lt=="number"){if(Rt=lt,!Number.isSafeInteger(Rt))throw new RangeError("'byteOffset' must be an integer.");if(Rt<0||Rt>=Ct.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${Ct.byteLength}).`);if(Mt=_.byteLength-Rt,typeof ft=="number"){if(Mt=ft,!Number.isSafeInteger(Mt))throw new RangeError("'byteLength' must be an integer.");if(Mt<=0||Rt+Mt>Ct.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${Ct.byteLength-Rt}].`);if(typeof mt=="object"&&mt!==null)gt=mt;else if(typeof mt<"u")throw new TypeError("'options' must be an object.")}else if(typeof ft<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof lt<"u")throw new TypeError("'options' must be an object.");pt=new Uint8Array(Ct,Rt,Mt)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[bt,wt]=await Tr(gt),vt=await bt.createInferenceSessionHandler(pt,wt);return Zt(),new Tv(vt)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}}),Ai,Pi=x(()=>{Oi(),Ai=_r}),Ei=x(()=>{}),Di=x(()=>{}),Li=x(()=>{}),$i=x(()=>{}),Ec,Sr,ki=x(()=>{wr(),Ir(),Ec="Training backend could not be resolved. Make sure you're using the correct configuration & WebAssembly files.",Sr=class wv{constructor(_,lt,ft){this.handler=_,this.hasOptimizerModel=lt,this.hasEvalModel=ft}get trainingInputNames(){return this.handler.inputNames}get trainingOutputNames(){return this.handler.outputNames}get evalInputNames(){if(this.hasEvalModel)return this.handler.evalInputNames;throw new Error("This training session has no evalModel loaded.")}get evalOutputNames(){if(this.hasEvalModel)return this.handler.evalOutputNames;throw new Error("This training session has no evalModel loaded.")}static async create(_,lt){let ft=_.evalModel||"",mt=_.optimizerModel||"",pt=lt||{},[gt,bt]=await Tr(pt);if(gt.createTrainingSessionHandler){let wt=await gt.createTrainingSessionHandler(_.checkpointState,_.trainModel,ft,mt,bt);return new wv(wt,!!_.optimizerModel,!!_.evalModel)}else throw new Error(Ec)}typeNarrowingForRunStep(_,lt,ft,mt,pt){let gt={},bt={};if(typeof ft!="object"||ft===null||ft instanceof et||Array.isArray(ft))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let wt=!0;if(typeof mt=="object"){if(mt===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(mt instanceof et)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(mt)){if(mt.length===0)throw new TypeError("'fetches' cannot be an empty array.");wt=!1;for(let vt of mt){if(typeof vt!="string")throw new TypeError("'fetches' must be a string array or an object.");if(lt.indexOf(vt)===-1)throw new RangeError(`'fetches' contains invalid output name: ${vt}.`);gt[vt]=null}if(typeof pt=="object"&&pt!==null)bt=pt;else if(typeof pt<"u")throw new TypeError("'options' must be an object.")}else{let vt=!1,Ct=Object.getOwnPropertyNames(mt);for(let Rt of lt)if(Ct.indexOf(Rt)!==-1){let Mt=mt[Rt];(Mt===null||Mt instanceof et)&&(vt=!0,wt=!1,gt[Rt]=Mt)}if(vt){if(typeof pt=="object"&&pt!==null)bt=pt;else if(typeof pt<"u")throw new TypeError("'options' must be an object.")}else bt=mt}}else if(typeof mt<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let vt of _)if(typeof ft[vt]>"u")throw new Error(`input '${vt}' is missing in 'feeds'.`);if(wt)for(let vt of lt)gt[vt]=null;return[gt,bt]}convertHandlerReturnTypeToMapOfTensors(_){let lt={};for(let ft in _)if(Object.hasOwnProperty.call(_,ft)){let mt=_[ft];mt instanceof et?lt[ft]=mt:lt[ft]=new et(mt.type,mt.data,mt.dims)}return lt}async lazyResetGrad(){await this.handler.lazyResetGrad()}async runTrainStep(_,lt,ft){let[mt,pt]=this.typeNarrowingForRunStep(this.trainingInputNames,this.trainingOutputNames,_,lt,ft),gt=await this.handler.runTrainStep(_,mt,pt);return this.convertHandlerReturnTypeToMapOfTensors(gt)}async runOptimizerStep(_){if(this.hasOptimizerModel)await this.handler.runOptimizerStep(_||{});else throw new Error("This TrainingSession has no OptimizerModel loaded.")}async runEvalStep(_,lt,ft){if(this.hasEvalModel){let[mt,pt]=this.typeNarrowingForRunStep(this.evalInputNames,this.evalOutputNames,_,lt,ft),gt=await this.handler.runEvalStep(_,mt,pt);return this.convertHandlerReturnTypeToMapOfTensors(gt)}else throw new Error("This TrainingSession has no EvalModel loaded.")}async getParametersSize(_=!0){return this.handler.getParametersSize(_)}async loadParametersBuffer(_,lt=!0){let ft=await this.getParametersSize(lt);if(_.length!==4*ft)throw new Error("Size of the buffer passed into loadParametersBuffer must match the number of parameters in the model. Please use getParametersSize method to check.");return this.handler.loadParametersBuffer(_,lt)}async getContiguousParameters(_=!0){return this.handler.getContiguousParameters(_)}async release(){return this.handler.dispose()}}}),Bi,Fi=x(()=>{ki(),Bi=Sr}),Gn={};We(Gn,{InferenceSession:()=>Ai,TRACE:()=>Cn,TRACE_FUNC_BEGIN:()=>Jt,TRACE_FUNC_END:()=>Zt,Tensor:()=>et,TrainingSession:()=>Bi,env:()=>$,registerBackend:()=>ue});var kt=x(()=>{ii(),li(),Pi(),Ir(),Ei(),Di(),Rn(),Li(),$i(),Fi()});function Yt(it,_,lt,ft){if(_===void 0)return Lc(it);if(lt===void 0)Or(it,_);else if(typeof lt=="number"&&ft===void 0)Or(it,_);else if(typeof lt=="string"&&ft===void 0)Or(it,lt,1,_);else if(typeof lt=="string"&&typeof ft=="number")Or(it,lt,ft,_);else throw new TypeError("input is valid")}function Lc(it){return{verbose:Yt.verbose.bind(null,it),info:Yt.info.bind(null,it),warning:Yt.warning.bind(null,it),error:Yt.error.bind(null,it),fatal:Yt.fatal.bind(null,it)}}function Or(it,_,lt,ft){let mt=qe[ft||""]||qe[""];Ci[it]<Ci[mt.minimalSeverity]||(mt.logDateTime&&(_=`${new Date().toISOString()}|${_}`),mt.logSourceLocation,Dc[mt.provider].log(it,_,ft))}var Mn,Vn,Ci,Dc,Ri,qe,z,Pr,Er,Dr,Ar,It=x(()=>{Mn=class{log(it,_,lt){}},Vn=class{log(it,_,lt){console.log(`${this.color(it)} ${lt?"\x1B[35m"+lt+"\x1B[0m ":""}${_}`)}color(it){switch(it){case"verbose":return"\x1B[34;40mv\x1B[0m";case"info":return"\x1B[32mi\x1B[0m";case"warning":return"\x1B[30;43mw\x1B[0m";case"error":return"\x1B[31;40me\x1B[0m";case"fatal":return"\x1B[101mf\x1B[0m";default:throw new Error(`unsupported severity: ${it}`)}}},Ci={verbose:1e3,info:2e3,warning:4e3,error:5e3,fatal:6e3},Dc={none:new Mn,console:new Vn},Ri={provider:"console",minimalSeverity:"warning",logDateTime:!0,logSourceLocation:!1},qe={"":Ri},(it=>{function _(vt,Ct){it("verbose",vt,Ct)}it.verbose=_;function lt(vt,Ct){it("info",vt,Ct)}it.info=lt;function ft(vt,Ct){it("warning",vt,Ct)}it.warning=ft;function mt(vt,Ct){it("error",vt,Ct)}it.error=mt;function pt(vt,Ct){it("fatal",vt,Ct)}it.fatal=pt;function gt(vt){qe={},bt("",vt||{})}it.reset=gt;function bt(vt,Ct){if(vt==="*")gt(Ct);else{let Rt=qe[vt]||Ri;qe[vt]={provider:Ct.provider||Rt.provider,minimalSeverity:Ct.minimalSeverity||Rt.minimalSeverity,logDateTime:Ct.logDateTime===void 0?Rt.logDateTime:Ct.logDateTime,logSourceLocation:Ct.logSourceLocation===void 0?Rt.logSourceLocation:Ct.logSourceLocation}}}it.set=bt;function wt(vt){let Ct={};vt.logLevel&&(Ct.minimalSeverity=vt.logLevel),bt("",Ct)}it.setWithEnv=wt})(Yt||(Yt={})),z=Yt,Pr=class{constructor(it,_,lt,ft,mt,pt){this.category=it,this.name=_,this.startTime=lt,this.endCallback=ft,this.timer=mt,this.ctx=pt}async end(){return this.endCallback(this)}async checkTimer(){if(this.ctx===void 0||this.timer===void 0)throw new Error("No webgl timer found");return this.ctx.endTimer(),this.ctx.waitForQueryAndGetTime(this.timer)}},Er=class{constructor(it,_,lt,ft){this.category=it,this.name=_,this.startTime=lt,this.endTime=ft}},Dr=class{constructor(it,_,lt){this._started=!1,this._flushPointer=0,this._started=!1,this._maxNumberEvents=it===void 0?1e4:it,this._flushBatchSize=_===void 0?10:_,this._flushIntervalInMilliseconds=lt===void 0?5e3:lt}static create(it){return it===void 0?new this:new this(it.maxNumberEvents,it.flushBatchSize,it.flushIntervalInMilliseconds)}start(){this._started=!0,this._timingEvents=[],this._flushTime=Ar(),this._flushPointer=0}stop(){for(this._started=!1;this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer])}event(it,_,lt,ft){let mt=this._started?this.begin(it,_,ft):void 0,pt=!1,gt=lt();if(gt&&typeof gt.then=="function")return pt=!0,new Promise((bt,wt)=>{gt.then(async vt=>{mt&&await mt.end(),bt(vt)},async vt=>{mt&&await mt.end(),wt(vt)})});if(!pt&&mt){let bt=mt.end();if(bt&&typeof bt.then=="function")return new Promise((wt,vt)=>{bt.then(()=>{wt(gt)},Ct=>{vt(Ct)})})}return gt}begin(it,_,lt){if(!this._started)throw new Error("profiler is not started yet");if(lt===void 0){let ft=Ar();return this.flush(ft),new Pr(it,_,ft,mt=>this.endSync(mt))}else{let ft=lt.beginTimer();return new Pr(it,_,0,async mt=>this.end(mt),ft,lt)}}async end(it){let _=await it.checkTimer();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new Er(it.category,it.name,it.startTime,_)),this.flush(_))}endSync(it){let _=Ar();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new Er(it.category,it.name,it.startTime,_)),this.flush(_))}logOneEvent(it){z.verbose(`Profiler.${it.category}`,`${(it.endTime-it.startTime).toFixed(2)}ms on event '${it.name}' at ${it.endTime.toFixed(2)}`)}flush(it){if(this._timingEvents.length-this._flushPointer>=this._flushBatchSize||it-this._flushTime>=this._flushIntervalInMilliseconds){for(let _=this._flushPointer;this._flushPointer<_+this._flushBatchSize&&this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer]);this._flushTime=Ar()}}get started(){return this._started}},Ar=typeof performance<"u"&&performance.now?()=>performance.now():Date.now});function Gi(it,_,lt){for(let ft of lt){let mt=ft[0],pt=ft[1],gt=ft[2],bt=ft[3],wt=ft[4];if(it.opType===mt){for(let vt of _)if((vt.domain===pt||vt.domain==="ai.onnx"&&pt==="")&&$c(vt.version,gt))return{opImpl:bt,opInit:wt}}}throw new TypeError(`cannot resolve operator '${it.opType}' with opsets: ${_.map(ft=>`${ft.domain||"ai.onnx"} v${ft.version}`).join(", ")}`)}function $c(it,_){if(_.endsWith("+")){let lt=Number.parseInt(_.substring(0,_.length-1),10);return!isNaN(lt)&&lt<=it}else if(_.split("-").length===2){let lt=_.split("-"),ft=Number.parseInt(lt[0],10),mt=Number.parseInt(lt[1],10);return!isNaN(ft)&&!isNaN(mt)&&ft<=it&&it<=mt}else return Number.parseInt(_,10)===it}var Mi=x(()=>{}),Vi=tt(it=>{it.__esModule=!0;var _=function(){function lt(ft){if(!ft)throw new TypeError("Invalid argument; `value` has no value.");this.value=lt.EMPTY,ft&&lt.isGuid(ft)&&(this.value=ft)}return lt.isGuid=function(ft){var mt=ft.toString();return ft&&(ft instanceof lt||lt.validator.test(mt))},lt.create=function(){return new lt([lt.gen(2),lt.gen(1),lt.gen(1),lt.gen(1),lt.gen(3)].join("-"))},lt.createEmpty=function(){return new lt("emptyguid")},lt.parse=function(ft){return new lt(ft)},lt.raw=function(){return[lt.gen(2),lt.gen(1),lt.gen(1),lt.gen(1),lt.gen(3)].join("-")},lt.gen=function(ft){for(var mt="",pt=0;pt<ft;pt++)mt+=((1+Math.random())*65536|0).toString(16).substring(1);return mt},lt.prototype.equals=function(ft){return lt.isGuid(ft)&&this.value===ft.toString()},lt.prototype.isEmpty=function(){return this.value===lt.EMPTY},lt.prototype.toString=function(){return this.value},lt.prototype.toJSON=function(){return{value:this.value}},lt.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),lt.EMPTY="00000000-0000-0000-0000-000000000000",lt}();it.Guid=_});function H(it,_,lt){this.low=it|0,this.high=_|0,this.unsigned=!!lt}function ct(it){return(it&&it.__isLong__)===!0}function Ui(it){var _=Math.clz32(it&-it);return it?31-_:_}function fe(it,_){var lt,ft,mt;return _?(it>>>=0,(mt=0<=it&&it<256)&&(ft=Wi[it],ft)?ft:(lt=V(it,0,!0),mt&&(Wi[it]=lt),lt)):(it|=0,(mt=-128<=it&&it<128)&&(ft=zi[it],ft)?ft:(lt=V(it,it<0?-1:0,!1),mt&&(zi[it]=lt),lt))}function St(it,_){if(isNaN(it))return _?qt:Bt;if(_){if(it<0)return qt;if(it>=Xi)return Zi}else{if(it<=-qi)return yt;if(it+1>=qi)return Ji}return it<0?St(-it,_).neg():V(it%Ee|0,it/Ee|0,_)}function V(it,_,lt){return new H(it,_,lt)}function Wn(it,_,lt){if(it.length===0)throw Error("empty string");if(typeof _=="number"?(lt=_,_=!1):_=!!_,it==="NaN"||it==="Infinity"||it==="+Infinity"||it==="-Infinity")return _?qt:Bt;if(lt=lt||10,lt<2||36<lt)throw RangeError("radix");var ft;if((ft=it.indexOf("-"))>0)throw Error("interior hyphen");if(ft===0)return Wn(it.substring(1),_,lt).neg();for(var mt=St(Lr(lt,8)),pt=Bt,gt=0;gt<it.length;gt+=8){var bt=Math.min(8,it.length-gt),wt=parseInt(it.substring(gt,gt+bt),lt);if(bt<8){var vt=St(Lr(lt,bt));pt=pt.mul(vt).add(St(wt))}else pt=pt.mul(mt),pt=pt.add(St(wt))}return pt.unsigned=_,pt}function Ft(it,_){return typeof it=="number"?St(it,_):typeof it=="string"?Wn(it,_):V(it.low,it.high,typeof _=="boolean"?_:it.unsigned)}var _t,zi,Wi,Lr,Hi,Bc,Ee,Xi,qi,ji,Bt,qt,Pe,Ki,zn,Ji,Zi,yt,I,jt,Hn=x(()=>{_t=null;try{_t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}H.prototype.__isLong__,Object.defineProperty(H.prototype,"__isLong__",{value:!0}),H.isLong=ct,zi={},Wi={},H.fromInt=fe,H.fromNumber=St,H.fromBits=V,Lr=Math.pow,H.fromString=Wn,H.fromValue=Ft,Hi=65536,Bc=1<<24,Ee=Hi*Hi,Xi=Ee*Ee,qi=Xi/2,ji=fe(Bc),Bt=fe(0),H.ZERO=Bt,qt=fe(0,!0),H.UZERO=qt,Pe=fe(1),H.ONE=Pe,Ki=fe(1,!0),H.UONE=Ki,zn=fe(-1),H.NEG_ONE=zn,Ji=V(-1,2147483647,!1),H.MAX_VALUE=Ji,Zi=V(-1,-1,!0),H.MAX_UNSIGNED_VALUE=Zi,yt=V(0,-2147483648,!1),H.MIN_VALUE=yt,I=H.prototype,I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*Ee+(this.low>>>0):this.high*Ee+(this.low>>>0)},I.toString=function(it){if(it=it||10,it<2||36<it)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(yt)){var _=St(it),lt=this.div(_),ft=lt.mul(_).sub(this);return lt.toString(it)+ft.toInt().toString(it)}else return"-"+this.neg().toString(it);for(var mt=St(Lr(it,6),this.unsigned),pt=this,gt="";;){var bt=pt.div(mt),wt=pt.sub(bt.mul(mt)).toInt()>>>0,vt=wt.toString(it);if(pt=bt,pt.isZero())return vt+gt;for(;vt.length<6;)vt="0"+vt;gt=""+vt+gt}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(yt)?64:this.neg().getNumBitsAbs();for(var it=this.high!=0?this.high:this.low,_=31;_>0&&!(it&1<<_);_--);return this.high!=0?_+33:_+1},I.isZero=function(){return this.high===0&&this.low===0},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return(this.low&1)===1},I.isEven=function(){return(this.low&1)===0},I.equals=function(it){return ct(it)||(it=Ft(it)),this.unsigned!==it.unsigned&&this.high>>>31===1&&it.high>>>31===1?!1:this.high===it.high&&this.low===it.low},I.eq=I.equals,I.notEquals=function(it){return!this.eq(it)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(it){return this.comp(it)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(it){return this.comp(it)<=0},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(it){return this.comp(it)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(it){return this.comp(it)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(it){if(ct(it)||(it=Ft(it)),this.eq(it))return 0;var _=this.isNegative(),lt=it.isNegative();return _&&!lt?-1:!_&&lt?1:this.unsigned?it.high>>>0>this.high>>>0||it.high===this.high&&it.low>>>0>this.low>>>0?-1:1:this.sub(it).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(yt)?yt:this.not().add(Pe)},I.neg=I.negate,I.add=function(it){ct(it)||(it=Ft(it));var _=this.high>>>16,lt=this.high&65535,ft=this.low>>>16,mt=this.low&65535,pt=it.high>>>16,gt=it.high&65535,bt=it.low>>>16,wt=it.low&65535,vt=0,Ct=0,Rt=0,Mt=0;return Mt+=mt+wt,Rt+=Mt>>>16,Mt&=65535,Rt+=ft+bt,Ct+=Rt>>>16,Rt&=65535,Ct+=lt+gt,vt+=Ct>>>16,Ct&=65535,vt+=_+pt,vt&=65535,V(Rt<<16|Mt,vt<<16|Ct,this.unsigned)},I.subtract=function(it){return ct(it)||(it=Ft(it)),this.add(it.neg())},I.sub=I.subtract,I.multiply=function(it){if(this.isZero())return this;if(ct(it)||(it=Ft(it)),_t){var _=_t.mul(this.low,this.high,it.low,it.high);return V(_,_t.get_high(),this.unsigned)}if(it.isZero())return this.unsigned?qt:Bt;if(this.eq(yt))return it.isOdd()?yt:Bt;if(it.eq(yt))return this.isOdd()?yt:Bt;if(this.isNegative())return it.isNegative()?this.neg().mul(it.neg()):this.neg().mul(it).neg();if(it.isNegative())return this.mul(it.neg()).neg();if(this.lt(ji)&&it.lt(ji))return St(this.toNumber()*it.toNumber(),this.unsigned);var lt=this.high>>>16,ft=this.high&65535,mt=this.low>>>16,pt=this.low&65535,gt=it.high>>>16,bt=it.high&65535,wt=it.low>>>16,vt=it.low&65535,Ct=0,Rt=0,Mt=0,Ot=0;return Ot+=pt*vt,Mt+=Ot>>>16,Ot&=65535,Mt+=mt*vt,Rt+=Mt>>>16,Mt&=65535,Mt+=pt*wt,Rt+=Mt>>>16,Mt&=65535,Rt+=ft*vt,Ct+=Rt>>>16,Rt&=65535,Rt+=mt*wt,Ct+=Rt>>>16,Rt&=65535,Rt+=pt*bt,Ct+=Rt>>>16,Rt&=65535,Ct+=lt*vt+ft*wt+mt*bt+pt*gt,Ct&=65535,V(Mt<<16|Ot,Ct<<16|Rt,this.unsigned)},I.mul=I.multiply,I.divide=function(it){if(ct(it)||(it=Ft(it)),it.isZero())throw Error("division by zero");if(_t){if(!this.unsigned&&this.high===-2147483648&&it.low===-1&&it.high===-1)return this;var _=(this.unsigned?_t.div_u:_t.div_s)(this.low,this.high,it.low,it.high);return V(_,_t.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?qt:Bt;var lt,ft,mt;if(this.unsigned){if(it.unsigned||(it=it.toUnsigned()),it.gt(this))return qt;if(it.gt(this.shru(1)))return Ki;mt=qt}else{if(this.eq(yt)){if(it.eq(Pe)||it.eq(zn))return yt;if(it.eq(yt))return Pe;var pt=this.shr(1);return lt=pt.div(it).shl(1),lt.eq(Bt)?it.isNegative()?Pe:zn:(ft=this.sub(it.mul(lt)),mt=lt.add(ft.div(it)),mt)}else if(it.eq(yt))return this.unsigned?qt:Bt;if(this.isNegative())return it.isNegative()?this.neg().div(it.neg()):this.neg().div(it).neg();if(it.isNegative())return this.div(it.neg()).neg();mt=Bt}for(ft=this;ft.gte(it);){lt=Math.max(1,Math.floor(ft.toNumber()/it.toNumber()));for(var gt=Math.ceil(Math.log(lt)/Math.LN2),bt=gt<=48?1:Lr(2,gt-48),wt=St(lt),vt=wt.mul(it);vt.isNegative()||vt.gt(ft);)lt-=bt,wt=St(lt,this.unsigned),vt=wt.mul(it);wt.isZero()&&(wt=Pe),mt=mt.add(wt),ft=ft.sub(vt)}return mt},I.div=I.divide,I.modulo=function(it){if(ct(it)||(it=Ft(it)),_t){var _=(this.unsigned?_t.rem_u:_t.rem_s)(this.low,this.high,it.low,it.high);return V(_,_t.get_high(),this.unsigned)}return this.sub(this.div(it).mul(it))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return V(~this.low,~this.high,this.unsigned)},I.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},I.clz=I.countLeadingZeros,I.countTrailingZeros=function(){return this.low?Ui(this.low):Ui(this.high)+32},I.ctz=I.countTrailingZeros,I.and=function(it){return ct(it)||(it=Ft(it)),V(this.low&it.low,this.high&it.high,this.unsigned)},I.or=function(it){return ct(it)||(it=Ft(it)),V(this.low|it.low,this.high|it.high,this.unsigned)},I.xor=function(it){return ct(it)||(it=Ft(it)),V(this.low^it.low,this.high^it.high,this.unsigned)},I.shiftLeft=function(it){return ct(it)&&(it=it.toInt()),(it&=63)===0?this:it<32?V(this.low<<it,this.high<<it|this.low>>>32-it,this.unsigned):V(0,this.low<<it-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(it){return ct(it)&&(it=it.toInt()),(it&=63)===0?this:it<32?V(this.low>>>it|this.high<<32-it,this.high>>it,this.unsigned):V(this.high>>it-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(it){return ct(it)&&(it=it.toInt()),(it&=63)===0?this:it<32?V(this.low>>>it|this.high<<32-it,this.high>>>it,this.unsigned):it===32?V(this.high,0,this.unsigned):V(this.high>>>it-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.rotateLeft=function(it){var _;return ct(it)&&(it=it.toInt()),(it&=63)===0?this:it===32?V(this.high,this.low,this.unsigned):it<32?(_=32-it,V(this.low<<it|this.high>>>_,this.high<<it|this.low>>>_,this.unsigned)):(it-=32,_=32-it,V(this.high<<it|this.low>>>_,this.low<<it|this.high>>>_,this.unsigned))},I.rotl=I.rotateLeft,I.rotateRight=function(it){var _;return ct(it)&&(it=it.toInt()),(it&=63)===0?this:it===32?V(this.high,this.low,this.unsigned):it<32?(_=32-it,V(this.high<<_|this.low>>>it,this.low<<_|this.high>>>it,this.unsigned)):(it-=32,_=32-it,V(this.low<<_|this.high>>>it,this.high<<_|this.low>>>it,this.unsigned))},I.rotr=I.rotateRight,I.toSigned=function(){return this.unsigned?V(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:V(this.low,this.high,!0)},I.toBytes=function(it){return it?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var it=this.high,_=this.low;return[_&255,_>>>8&255,_>>>16&255,_>>>24,it&255,it>>>8&255,it>>>16&255,it>>>24]},I.toBytesBE=function(){var it=this.high,_=this.low;return[it>>>24,it>>>16&255,it>>>8&255,it&255,_>>>24,_>>>16&255,_>>>8&255,_&255]},H.fromBytes=function(it,_,lt){return lt?H.fromBytesLE(it,_):H.fromBytesBE(it,_)},H.fromBytesLE=function(it,_){return new H(it[0]|it[1]<<8|it[2]<<16|it[3]<<24,it[4]|it[5]<<8|it[6]<<16|it[7]<<24,_)},H.fromBytesBE=function(it,_){return new H(it[4]<<24|it[5]<<16|it[6]<<8|it[7],it[0]<<24|it[1]<<16|it[2]<<8|it[3],_)},jt=H}),b,$r=x(()=>{b={},b.Offset,b.Table,b.SIZEOF_SHORT=2,b.SIZEOF_INT=4,b.FILE_IDENTIFIER_LENGTH=4,b.SIZE_PREFIX_LENGTH=4,b.Encoding={UTF8_BYTES:1,UTF16_STRING:2},b.int32=new Int32Array(2),b.float32=new Float32Array(b.int32.buffer),b.float64=new Float64Array(b.int32.buffer),b.isLittleEndian=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1,b.Long=function(it,_){this.low=it|0,this.high=_|0},b.Long.create=function(it,_){return it==0&&_==0?b.Long.ZERO:new b.Long(it,_)},b.Long.prototype.toFloat64=function(){return(this.low>>>0)+this.high*4294967296},b.Long.prototype.equals=function(it){return this.low==it.low&&this.high==it.high},b.Long.ZERO=new b.Long(0,0),b.Builder=function(it){if(it)var _=it;else var _=1024;this.bb=b.ByteBuffer.allocate(_),this.space=_,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},b.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},b.Builder.prototype.forceDefaults=function(it){this.force_defaults=it},b.Builder.prototype.dataBuffer=function(){return this.bb},b.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},b.Builder.prototype.prep=function(it,_){it>this.minalign&&(this.minalign=it);for(var lt=~(this.bb.capacity()-this.space+_)+1&it-1;this.space<lt+it+_;){var ft=this.bb.capacity();this.bb=b.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-ft}this.pad(lt)},b.Builder.prototype.pad=function(it){for(var _=0;_<it;_++)this.bb.writeInt8(--this.space,0)},b.Builder.prototype.writeInt8=function(it){this.bb.writeInt8(this.space-=1,it)},b.Builder.prototype.writeInt16=function(it){this.bb.writeInt16(this.space-=2,it)},b.Builder.prototype.writeInt32=function(it){this.bb.writeInt32(this.space-=4,it)},b.Builder.prototype.writeInt64=function(it){this.bb.writeInt64(this.space-=8,it)},b.Builder.prototype.writeFloat32=function(it){this.bb.writeFloat32(this.space-=4,it)},b.Builder.prototype.writeFloat64=function(it){this.bb.writeFloat64(this.space-=8,it)},b.Builder.prototype.addInt8=function(it){this.prep(1,0),this.writeInt8(it)},b.Builder.prototype.addInt16=function(it){this.prep(2,0),this.writeInt16(it)},b.Builder.prototype.addInt32=function(it){this.prep(4,0),this.writeInt32(it)},b.Builder.prototype.addInt64=function(it){this.prep(8,0),this.writeInt64(it)},b.Builder.prototype.addFloat32=function(it){this.prep(4,0),this.writeFloat32(it)},b.Builder.prototype.addFloat64=function(it){this.prep(8,0),this.writeFloat64(it)},b.Builder.prototype.addFieldInt8=function(it,_,lt){(this.force_defaults||_!=lt)&&(this.addInt8(_),this.slot(it))},b.Builder.prototype.addFieldInt16=function(it,_,lt){(this.force_defaults||_!=lt)&&(this.addInt16(_),this.slot(it))},b.Builder.prototype.addFieldInt32=function(it,_,lt){(this.force_defaults||_!=lt)&&(this.addInt32(_),this.slot(it))},b.Builder.prototype.addFieldInt64=function(it,_,lt){(this.force_defaults||!_.equals(lt))&&(this.addInt64(_),this.slot(it))},b.Builder.prototype.addFieldFloat32=function(it,_,lt){(this.force_defaults||_!=lt)&&(this.addFloat32(_),this.slot(it))},b.Builder.prototype.addFieldFloat64=function(it,_,lt){(this.force_defaults||_!=lt)&&(this.addFloat64(_),this.slot(it))},b.Builder.prototype.addFieldOffset=function(it,_,lt){(this.force_defaults||_!=lt)&&(this.addOffset(_),this.slot(it))},b.Builder.prototype.addFieldStruct=function(it,_,lt){_!=lt&&(this.nested(_),this.slot(it))},b.Builder.prototype.nested=function(it){if(it!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},b.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},b.Builder.prototype.slot=function(it){this.vtable[it]=this.offset()},b.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},b.Builder.growByteBuffer=function(it){var _=it.capacity();if(_&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var lt=_<<1,ft=b.ByteBuffer.allocate(lt);return ft.setPosition(lt-_),ft.bytes().set(it.bytes(),lt-_),ft},b.Builder.prototype.addOffset=function(it){this.prep(b.SIZEOF_INT,0),this.writeInt32(this.offset()-it+b.SIZEOF_INT)},b.Builder.prototype.startObject=function(it){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=it;for(var _=0;_<it;_++)this.vtable[_]=0;this.isNested=!0,this.object_start=this.offset()},b.Builder.prototype.endObject=function(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var it=this.offset(),_=this.vtable_in_use-1;_>=0&&this.vtable[_]==0;_--);for(var lt=_+1;_>=0;_--)this.addInt16(this.vtable[_]!=0?it-this.vtable[_]:0);var ft=2;this.addInt16(it-this.object_start);var mt=(lt+ft)*b.SIZEOF_SHORT;this.addInt16(mt);var pt=0,gt=this.space;e:for(_=0;_<this.vtables.length;_++){var bt=this.bb.capacity()-this.vtables[_];if(mt==this.bb.readInt16(bt)){for(var wt=b.SIZEOF_SHORT;wt<mt;wt+=b.SIZEOF_SHORT)if(this.bb.readInt16(gt+wt)!=this.bb.readInt16(bt+wt))continue e;pt=this.vtables[_];break}}return pt?(this.space=this.bb.capacity()-it,this.bb.writeInt32(this.space,pt-it)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-it,this.offset()-it)),this.isNested=!1,it},b.Builder.prototype.finish=function(it,_,lt){var ft=lt?b.SIZE_PREFIX_LENGTH:0;if(_){var mt=_;if(this.prep(this.minalign,b.SIZEOF_INT+b.FILE_IDENTIFIER_LENGTH+ft),mt.length!=b.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+b.FILE_IDENTIFIER_LENGTH);for(var pt=b.FILE_IDENTIFIER_LENGTH-1;pt>=0;pt--)this.writeInt8(mt.charCodeAt(pt))}this.prep(this.minalign,b.SIZEOF_INT+ft),this.addOffset(it),ft&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},b.Builder.prototype.finishSizePrefixed=function(it,_){this.finish(it,_,!0)},b.Builder.prototype.requiredField=function(it,_){var lt=this.bb.capacity()-it,ft=lt-this.bb.readInt32(lt),mt=this.bb.readInt16(ft+_)!=0;if(!mt)throw new Error("FlatBuffers: field "+_+" must be set")},b.Builder.prototype.startVector=function(it,_,lt){this.notNested(),this.vector_num_elems=_,this.prep(b.SIZEOF_INT,it*_),this.prep(lt,it*_)},b.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},b.Builder.prototype.createString=function(it){if(it instanceof Uint8Array)var _=it;else for(var _=[],lt=0;lt<it.length;){var ft,mt=it.charCodeAt(lt++);if(mt<55296||mt>=56320)ft=mt;else{var pt=it.charCodeAt(lt++);ft=(mt<<10)+pt+-56613888}ft<128?_.push(ft):(ft<2048?_.push(ft>>6&31|192):(ft<65536?_.push(ft>>12&15|224):_.push(ft>>18&7|240,ft>>12&63|128),_.push(ft>>6&63|128)),_.push(ft&63|128))}this.addInt8(0),this.startVector(1,_.length,1),this.bb.setPosition(this.space-=_.length);for(var lt=0,gt=this.space,bt=this.bb.bytes();lt<_.length;lt++)bt[gt++]=_[lt];return this.endVector()},b.Builder.prototype.createLong=function(it,_){return b.Long.create(it,_)},b.ByteBuffer=function(it){this.bytes_=it,this.position_=0},b.ByteBuffer.allocate=function(it){return new b.ByteBuffer(new Uint8Array(it))},b.ByteBuffer.prototype.clear=function(){this.position_=0},b.ByteBuffer.prototype.bytes=function(){return this.bytes_},b.ByteBuffer.prototype.position=function(){return this.position_},b.ByteBuffer.prototype.setPosition=function(it){this.position_=it},b.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},b.ByteBuffer.prototype.readInt8=function(it){return this.readUint8(it)<<24>>24},b.ByteBuffer.prototype.readUint8=function(it){return this.bytes_[it]},b.ByteBuffer.prototype.readInt16=function(it){return this.readUint16(it)<<16>>16},b.ByteBuffer.prototype.readUint16=function(it){return this.bytes_[it]|this.bytes_[it+1]<<8},b.ByteBuffer.prototype.readInt32=function(it){return this.bytes_[it]|this.bytes_[it+1]<<8|this.bytes_[it+2]<<16|this.bytes_[it+3]<<24},b.ByteBuffer.prototype.readUint32=function(it){return this.readInt32(it)>>>0},b.ByteBuffer.prototype.readInt64=function(it){return new b.Long(this.readInt32(it),this.readInt32(it+4))},b.ByteBuffer.prototype.readUint64=function(it){return new b.Long(this.readUint32(it),this.readUint32(it+4))},b.ByteBuffer.prototype.readFloat32=function(it){return b.int32[0]=this.readInt32(it),b.float32[0]},b.ByteBuffer.prototype.readFloat64=function(it){return b.int32[b.isLittleEndian?0:1]=this.readInt32(it),b.int32[b.isLittleEndian?1:0]=this.readInt32(it+4),b.float64[0]},b.ByteBuffer.prototype.writeInt8=function(it,_){this.bytes_[it]=_},b.ByteBuffer.prototype.writeUint8=function(it,_){this.bytes_[it]=_},b.ByteBuffer.prototype.writeInt16=function(it,_){this.bytes_[it]=_,this.bytes_[it+1]=_>>8},b.ByteBuffer.prototype.writeUint16=function(it,_){this.bytes_[it]=_,this.bytes_[it+1]=_>>8},b.ByteBuffer.prototype.writeInt32=function(it,_){this.bytes_[it]=_,this.bytes_[it+1]=_>>8,this.bytes_[it+2]=_>>16,this.bytes_[it+3]=_>>24},b.ByteBuffer.prototype.writeUint32=function(it,_){this.bytes_[it]=_,this.bytes_[it+1]=_>>8,this.bytes_[it+2]=_>>16,this.bytes_[it+3]=_>>24},b.ByteBuffer.prototype.writeInt64=function(it,_){this.writeInt32(it,_.low),this.writeInt32(it+4,_.high)},b.ByteBuffer.prototype.writeUint64=function(it,_){this.writeUint32(it,_.low),this.writeUint32(it+4,_.high)},b.ByteBuffer.prototype.writeFloat32=function(it,_){b.float32[0]=_,this.writeInt32(it,b.int32[0])},b.ByteBuffer.prototype.writeFloat64=function(it,_){b.float64[0]=_,this.writeInt32(it,b.int32[b.isLittleEndian?0:1]),this.writeInt32(it+4,b.int32[b.isLittleEndian?1:0])},b.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+b.SIZEOF_INT+b.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var it="",_=0;_<b.FILE_IDENTIFIER_LENGTH;_++)it+=String.fromCharCode(this.readInt8(this.position_+b.SIZEOF_INT+_));return it},b.ByteBuffer.prototype.__offset=function(it,_){var lt=it-this.readInt32(it);return _<this.readInt16(lt)?this.readInt16(lt+_):0},b.ByteBuffer.prototype.__union=function(it,_){return it.bb_pos=_+this.readInt32(_),it.bb=this,it},b.ByteBuffer.prototype.__string=function(it,_){it+=this.readInt32(it);var lt=this.readInt32(it),ft="",mt=0;if(it+=b.SIZEOF_INT,_===b.Encoding.UTF8_BYTES)return this.bytes_.subarray(it,it+lt);for(;mt<lt;){var pt,gt=this.readUint8(it+mt++);if(gt<192)pt=gt;else{var bt=this.readUint8(it+mt++);if(gt<224)pt=(gt&31)<<6|bt&63;else{var wt=this.readUint8(it+mt++);if(gt<240)pt=(gt&15)<<12|(bt&63)<<6|wt&63;else{var vt=this.readUint8(it+mt++);pt=(gt&7)<<18|(bt&63)<<12|(wt&63)<<6|vt&63}}}pt<65536?ft+=String.fromCharCode(pt):(pt-=65536,ft+=String.fromCharCode((pt>>10)+55296,(pt&1023)+56320))}return ft},b.ByteBuffer.prototype.__indirect=function(it){return it+this.readInt32(it)},b.ByteBuffer.prototype.__vector=function(it){return it+this.readInt32(it)+b.SIZEOF_INT},b.ByteBuffer.prototype.__vector_len=function(it){return this.readInt32(it+this.readInt32(it))},b.ByteBuffer.prototype.__has_identifier=function(it){if(it.length!=b.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+b.FILE_IDENTIFIER_LENGTH);for(var _=0;_<b.FILE_IDENTIFIER_LENGTH;_++)if(it.charCodeAt(_)!=this.readInt8(this.position_+b.SIZEOF_INT+_))return!1;return!0},b.ByteBuffer.prototype.createLong=function(it,_){return b.Long.create(it,_)}}),P,je=x(()=>{$r(),(it=>{(_=>{(lt=>{(ft=>(ft[ft.UNDEFINED=0]="UNDEFINED",ft[ft.FLOAT=1]="FLOAT",ft[ft.INT=2]="INT",ft[ft.STRING=3]="STRING",ft[ft.TENSOR=4]="TENSOR",ft[ft.GRAPH=5]="GRAPH",ft[ft.FLOATS=6]="FLOATS",ft[ft.INTS=7]="INTS",ft[ft.STRINGS=8]="STRINGS",ft[ft.TENSORS=9]="TENSORS",ft[ft.GRAPHS=10]="GRAPHS",ft[ft.SPARSE_TENSOR=11]="SPARSE_TENSOR",ft[ft.SPARSE_TENSORS=12]="SPARSE_TENSORS"))(lt.AttributeType||(lt.AttributeType={}))})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{(ft=>(ft[ft.UNKNOWN=0]="UNKNOWN",ft[ft.VALUE=1]="VALUE",ft[ft.PARAM=2]="PARAM"))(lt.DimensionValueType||(lt.DimensionValueType={}))})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{(ft=>(ft[ft.UNDEFINED=0]="UNDEFINED",ft[ft.FLOAT=1]="FLOAT",ft[ft.UINT8=2]="UINT8",ft[ft.INT8=3]="INT8",ft[ft.UINT16=4]="UINT16",ft[ft.INT16=5]="INT16",ft[ft.INT32=6]="INT32",ft[ft.INT64=7]="INT64",ft[ft.STRING=8]="STRING",ft[ft.BOOL=9]="BOOL",ft[ft.FLOAT16=10]="FLOAT16",ft[ft.DOUBLE=11]="DOUBLE",ft[ft.UINT32=12]="UINT32",ft[ft.UINT64=13]="UINT64",ft[ft.COMPLEX64=14]="COMPLEX64",ft[ft.COMPLEX128=15]="COMPLEX128",ft[ft.BFLOAT16=16]="BFLOAT16",ft[ft.FLOAT8E4M3FN=17]="FLOAT8E4M3FN",ft[ft.FLOAT8E4M3FNUZ=18]="FLOAT8E4M3FNUZ",ft[ft.FLOAT8E5M2=19]="FLOAT8E5M2",ft[ft.FLOAT8E5M2FNUZ=20]="FLOAT8E5M2FNUZ"))(lt.TensorDataType||(lt.TensorDataType={}))})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{(ft=>(ft[ft.Primitive=0]="Primitive",ft[ft.Fused=1]="Fused"))(lt.NodeType||(lt.NodeType={}))})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{(ft=>(ft[ft.NONE=0]="NONE",ft[ft.tensor_type=1]="tensor_type",ft[ft.sequence_type=2]="sequence_type",ft[ft.map_type=3]="map_type"))(lt.TypeInfoValue||(lt.TypeInfoValue={}))})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsShape(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsShape(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}dim(pt,gt){let bt=this.bb.__offset(this.bb_pos,4);return bt?(gt||new it.experimental.fbs.Dimension).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}dimLength(){let pt=this.bb.__offset(this.bb_pos,4);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startShape(pt){pt.startObject(1)}static addDim(pt,gt){pt.addFieldOffset(0,gt,0)}static createDimVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startDimVector(pt,gt){pt.startVector(4,gt,4)}static endShape(pt){return pt.endObject()}static createShape(pt,gt){return ft.startShape(pt),ft.addDim(pt,gt),ft.endShape(pt)}}lt.Shape=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsDimension(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsDimension(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}value(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?(pt||new it.experimental.fbs.DimensionValue).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}denotation(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?this.bb.__string(this.bb_pos+gt,pt):null}static startDimension(pt){pt.startObject(2)}static addValue(pt,gt){pt.addFieldOffset(0,gt,0)}static addDenotation(pt,gt){pt.addFieldOffset(1,gt,0)}static endDimension(pt){return pt.endObject()}static createDimension(pt,gt,bt){return ft.startDimension(pt),ft.addValue(pt,gt),ft.addDenotation(pt,bt),ft.endDimension(pt)}}lt.Dimension=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsDimensionValue(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsDimensionValue(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}dimType(){let pt=this.bb.__offset(this.bb_pos,4);return pt?this.bb.readInt8(this.bb_pos+pt):0}dimValue(){let pt=this.bb.__offset(this.bb_pos,6);return pt?this.bb.readInt64(this.bb_pos+pt):this.bb.createLong(0,0)}dimParam(pt){let gt=this.bb.__offset(this.bb_pos,8);return gt?this.bb.__string(this.bb_pos+gt,pt):null}static startDimensionValue(pt){pt.startObject(3)}static addDimType(pt,gt){pt.addFieldInt8(0,gt,0)}static addDimValue(pt,gt){pt.addFieldInt64(1,gt,pt.createLong(0,0))}static addDimParam(pt,gt){pt.addFieldOffset(2,gt,0)}static endDimensionValue(pt){return pt.endObject()}static createDimensionValue(pt,gt,bt,wt){return ft.startDimensionValue(pt),ft.addDimType(pt,gt),ft.addDimValue(pt,bt),ft.addDimParam(pt,wt),ft.endDimensionValue(pt)}}lt.DimensionValue=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsTensorTypeAndShape(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsTensorTypeAndShape(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}elemType(){let pt=this.bb.__offset(this.bb_pos,4);return pt?this.bb.readInt32(this.bb_pos+pt):0}shape(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?(pt||new it.experimental.fbs.Shape).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}static startTensorTypeAndShape(pt){pt.startObject(2)}static addElemType(pt,gt){pt.addFieldInt32(0,gt,0)}static addShape(pt,gt){pt.addFieldOffset(1,gt,0)}static endTensorTypeAndShape(pt){return pt.endObject()}static createTensorTypeAndShape(pt,gt,bt){return ft.startTensorTypeAndShape(pt),ft.addElemType(pt,gt),ft.addShape(pt,bt),ft.endTensorTypeAndShape(pt)}}lt.TensorTypeAndShape=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsMapType(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsMapType(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}keyType(){let pt=this.bb.__offset(this.bb_pos,4);return pt?this.bb.readInt32(this.bb_pos+pt):0}valueType(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?(pt||new it.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}static startMapType(pt){pt.startObject(2)}static addKeyType(pt,gt){pt.addFieldInt32(0,gt,0)}static addValueType(pt,gt){pt.addFieldOffset(1,gt,0)}static endMapType(pt){return pt.endObject()}static createMapType(pt,gt,bt){return ft.startMapType(pt),ft.addKeyType(pt,gt),ft.addValueType(pt,bt),ft.endMapType(pt)}}lt.MapType=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsSequenceType(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsSequenceType(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}elemType(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?(pt||new it.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}static startSequenceType(pt){pt.startObject(1)}static addElemType(pt,gt){pt.addFieldOffset(0,gt,0)}static endSequenceType(pt){return pt.endObject()}static createSequenceType(pt,gt){return ft.startSequenceType(pt),ft.addElemType(pt,gt),ft.endSequenceType(pt)}}lt.SequenceType=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}nodeIndex(){return this.bb.readUint32(this.bb_pos)}srcArgIndex(){return this.bb.readInt32(this.bb_pos+4)}dstArgIndex(){return this.bb.readInt32(this.bb_pos+8)}static createEdgeEnd(pt,gt,bt,wt){return pt.prep(4,12),pt.writeInt32(wt),pt.writeInt32(bt),pt.writeInt32(gt),pt.offset()}}lt.EdgeEnd=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsNodeEdge(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsNodeEdge(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}nodeIndex(){let pt=this.bb.__offset(this.bb_pos,4);return pt?this.bb.readUint32(this.bb_pos+pt):0}inputEdges(pt,gt){let bt=this.bb.__offset(this.bb_pos,6);return bt?(gt||new it.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+bt)+pt*12,this.bb):null}inputEdgesLength(){let pt=this.bb.__offset(this.bb_pos,6);return pt?this.bb.__vector_len(this.bb_pos+pt):0}outputEdges(pt,gt){let bt=this.bb.__offset(this.bb_pos,8);return bt?(gt||new it.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+bt)+pt*12,this.bb):null}outputEdgesLength(){let pt=this.bb.__offset(this.bb_pos,8);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startNodeEdge(pt){pt.startObject(3)}static addNodeIndex(pt,gt){pt.addFieldInt32(0,gt,0)}static addInputEdges(pt,gt){pt.addFieldOffset(1,gt,0)}static startInputEdgesVector(pt,gt){pt.startVector(12,gt,4)}static addOutputEdges(pt,gt){pt.addFieldOffset(2,gt,0)}static startOutputEdgesVector(pt,gt){pt.startVector(12,gt,4)}static endNodeEdge(pt){return pt.endObject()}static createNodeEdge(pt,gt,bt,wt){return ft.startNodeEdge(pt),ft.addNodeIndex(pt,gt),ft.addInputEdges(pt,bt),ft.addOutputEdges(pt,wt),ft.endNodeEdge(pt)}}lt.NodeEdge=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsNode(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsNode(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}name(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.__string(this.bb_pos+gt,pt):null}docString(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?this.bb.__string(this.bb_pos+gt,pt):null}domain(pt){let gt=this.bb.__offset(this.bb_pos,8);return gt?this.bb.__string(this.bb_pos+gt,pt):null}sinceVersion(){let pt=this.bb.__offset(this.bb_pos,10);return pt?this.bb.readInt32(this.bb_pos+pt):0}index(){let pt=this.bb.__offset(this.bb_pos,12);return pt?this.bb.readUint32(this.bb_pos+pt):0}opType(pt){let gt=this.bb.__offset(this.bb_pos,14);return gt?this.bb.__string(this.bb_pos+gt,pt):null}type(){let pt=this.bb.__offset(this.bb_pos,16);return pt?this.bb.readInt32(this.bb_pos+pt):0}executionProviderType(pt){let gt=this.bb.__offset(this.bb_pos,18);return gt?this.bb.__string(this.bb_pos+gt,pt):null}inputs(pt,gt){let bt=this.bb.__offset(this.bb_pos,20);return bt?this.bb.__string(this.bb.__vector(this.bb_pos+bt)+pt*4,gt):null}inputsLength(){let pt=this.bb.__offset(this.bb_pos,20);return pt?this.bb.__vector_len(this.bb_pos+pt):0}outputs(pt,gt){let bt=this.bb.__offset(this.bb_pos,22);return bt?this.bb.__string(this.bb.__vector(this.bb_pos+bt)+pt*4,gt):null}outputsLength(){let pt=this.bb.__offset(this.bb_pos,22);return pt?this.bb.__vector_len(this.bb_pos+pt):0}attributes(pt,gt){let bt=this.bb.__offset(this.bb_pos,24);return bt?(gt||new it.experimental.fbs.Attribute).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}attributesLength(){let pt=this.bb.__offset(this.bb_pos,24);return pt?this.bb.__vector_len(this.bb_pos+pt):0}inputArgCounts(pt){let gt=this.bb.__offset(this.bb_pos,26);return gt?this.bb.readInt32(this.bb.__vector(this.bb_pos+gt)+pt*4):0}inputArgCountsLength(){let pt=this.bb.__offset(this.bb_pos,26);return pt?this.bb.__vector_len(this.bb_pos+pt):0}inputArgCountsArray(){let pt=this.bb.__offset(this.bb_pos,26);return pt?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+pt),this.bb.__vector_len(this.bb_pos+pt)):null}implicitInputs(pt,gt){let bt=this.bb.__offset(this.bb_pos,28);return bt?this.bb.__string(this.bb.__vector(this.bb_pos+bt)+pt*4,gt):null}implicitInputsLength(){let pt=this.bb.__offset(this.bb_pos,28);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startNode(pt){pt.startObject(13)}static addName(pt,gt){pt.addFieldOffset(0,gt,0)}static addDocString(pt,gt){pt.addFieldOffset(1,gt,0)}static addDomain(pt,gt){pt.addFieldOffset(2,gt,0)}static addSinceVersion(pt,gt){pt.addFieldInt32(3,gt,0)}static addIndex(pt,gt){pt.addFieldInt32(4,gt,0)}static addOpType(pt,gt){pt.addFieldOffset(5,gt,0)}static addType(pt,gt){pt.addFieldInt32(6,gt,0)}static addExecutionProviderType(pt,gt){pt.addFieldOffset(7,gt,0)}static addInputs(pt,gt){pt.addFieldOffset(8,gt,0)}static createInputsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startInputsVector(pt,gt){pt.startVector(4,gt,4)}static addOutputs(pt,gt){pt.addFieldOffset(9,gt,0)}static createOutputsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startOutputsVector(pt,gt){pt.startVector(4,gt,4)}static addAttributes(pt,gt){pt.addFieldOffset(10,gt,0)}static createAttributesVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startAttributesVector(pt,gt){pt.startVector(4,gt,4)}static addInputArgCounts(pt,gt){pt.addFieldOffset(11,gt,0)}static createInputArgCountsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addInt32(gt[bt]);return pt.endVector()}static startInputArgCountsVector(pt,gt){pt.startVector(4,gt,4)}static addImplicitInputs(pt,gt){pt.addFieldOffset(12,gt,0)}static createImplicitInputsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startImplicitInputsVector(pt,gt){pt.startVector(4,gt,4)}static endNode(pt){return pt.endObject()}static createNode(pt,gt,bt,wt,vt,Ct,Rt,Mt,Ot,Nt,Ht,Kt,hr,Qt){return ft.startNode(pt),ft.addName(pt,gt),ft.addDocString(pt,bt),ft.addDomain(pt,wt),ft.addSinceVersion(pt,vt),ft.addIndex(pt,Ct),ft.addOpType(pt,Rt),ft.addType(pt,Mt),ft.addExecutionProviderType(pt,Ot),ft.addInputs(pt,Nt),ft.addOutputs(pt,Ht),ft.addAttributes(pt,Kt),ft.addInputArgCounts(pt,hr),ft.addImplicitInputs(pt,Qt),ft.endNode(pt)}}lt.Node=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsValueInfo(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsValueInfo(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}name(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.__string(this.bb_pos+gt,pt):null}docString(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?this.bb.__string(this.bb_pos+gt,pt):null}type(pt){let gt=this.bb.__offset(this.bb_pos,8);return gt?(pt||new it.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}static startValueInfo(pt){pt.startObject(3)}static addName(pt,gt){pt.addFieldOffset(0,gt,0)}static addDocString(pt,gt){pt.addFieldOffset(1,gt,0)}static addType(pt,gt){pt.addFieldOffset(2,gt,0)}static endValueInfo(pt){return pt.endObject()}static createValueInfo(pt,gt,bt,wt){return ft.startValueInfo(pt),ft.addName(pt,gt),ft.addDocString(pt,bt),ft.addType(pt,wt),ft.endValueInfo(pt)}}lt.ValueInfo=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsTypeInfo(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsTypeInfo(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}denotation(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.__string(this.bb_pos+gt,pt):null}valueType(){let pt=this.bb.__offset(this.bb_pos,6);return pt?this.bb.readUint8(this.bb_pos+pt):0}value(pt){let gt=this.bb.__offset(this.bb_pos,8);return gt?this.bb.__union(pt,this.bb_pos+gt):null}static startTypeInfo(pt){pt.startObject(3)}static addDenotation(pt,gt){pt.addFieldOffset(0,gt,0)}static addValueType(pt,gt){pt.addFieldInt8(1,gt,0)}static addValue(pt,gt){pt.addFieldOffset(2,gt,0)}static endTypeInfo(pt){return pt.endObject()}static createTypeInfo(pt,gt,bt,wt){return ft.startTypeInfo(pt),ft.addDenotation(pt,gt),ft.addValueType(pt,bt),ft.addValue(pt,wt),ft.endTypeInfo(pt)}}lt.TypeInfo=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsOperatorSetId(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsOperatorSetId(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}domain(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.__string(this.bb_pos+gt,pt):null}version(){let pt=this.bb.__offset(this.bb_pos,6);return pt?this.bb.readInt64(this.bb_pos+pt):this.bb.createLong(0,0)}static startOperatorSetId(pt){pt.startObject(2)}static addDomain(pt,gt){pt.addFieldOffset(0,gt,0)}static addVersion(pt,gt){pt.addFieldInt64(1,gt,pt.createLong(0,0))}static endOperatorSetId(pt){return pt.endObject()}static createOperatorSetId(pt,gt,bt){return ft.startOperatorSetId(pt),ft.addDomain(pt,gt),ft.addVersion(pt,bt),ft.endOperatorSetId(pt)}}lt.OperatorSetId=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsTensor(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsTensor(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}name(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.__string(this.bb_pos+gt,pt):null}docString(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?this.bb.__string(this.bb_pos+gt,pt):null}dims(pt){let gt=this.bb.__offset(this.bb_pos,8);return gt?this.bb.readInt64(this.bb.__vector(this.bb_pos+gt)+pt*8):this.bb.createLong(0,0)}dimsLength(){let pt=this.bb.__offset(this.bb_pos,8);return pt?this.bb.__vector_len(this.bb_pos+pt):0}dataType(){let pt=this.bb.__offset(this.bb_pos,10);return pt?this.bb.readInt32(this.bb_pos+pt):0}rawData(pt){let gt=this.bb.__offset(this.bb_pos,12);return gt?this.bb.readUint8(this.bb.__vector(this.bb_pos+gt)+pt):0}rawDataLength(){let pt=this.bb.__offset(this.bb_pos,12);return pt?this.bb.__vector_len(this.bb_pos+pt):0}rawDataArray(){let pt=this.bb.__offset(this.bb_pos,12);return pt?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+pt),this.bb.__vector_len(this.bb_pos+pt)):null}stringData(pt,gt){let bt=this.bb.__offset(this.bb_pos,14);return bt?this.bb.__string(this.bb.__vector(this.bb_pos+bt)+pt*4,gt):null}stringDataLength(){let pt=this.bb.__offset(this.bb_pos,14);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startTensor(pt){pt.startObject(6)}static addName(pt,gt){pt.addFieldOffset(0,gt,0)}static addDocString(pt,gt){pt.addFieldOffset(1,gt,0)}static addDims(pt,gt){pt.addFieldOffset(2,gt,0)}static createDimsVector(pt,gt){pt.startVector(8,gt.length,8);for(let bt=gt.length-1;bt>=0;bt--)pt.addInt64(gt[bt]);return pt.endVector()}static startDimsVector(pt,gt){pt.startVector(8,gt,8)}static addDataType(pt,gt){pt.addFieldInt32(3,gt,0)}static addRawData(pt,gt){pt.addFieldOffset(4,gt,0)}static createRawDataVector(pt,gt){pt.startVector(1,gt.length,1);for(let bt=gt.length-1;bt>=0;bt--)pt.addInt8(gt[bt]);return pt.endVector()}static startRawDataVector(pt,gt){pt.startVector(1,gt,1)}static addStringData(pt,gt){pt.addFieldOffset(5,gt,0)}static createStringDataVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startStringDataVector(pt,gt){pt.startVector(4,gt,4)}static endTensor(pt){return pt.endObject()}static createTensor(pt,gt,bt,wt,vt,Ct,Rt){return ft.startTensor(pt),ft.addName(pt,gt),ft.addDocString(pt,bt),ft.addDims(pt,wt),ft.addDataType(pt,vt),ft.addRawData(pt,Ct),ft.addStringData(pt,Rt),ft.endTensor(pt)}}lt.Tensor=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsSparseTensor(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsSparseTensor(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}values(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?(pt||new it.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}indices(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?(pt||new it.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}dims(pt){let gt=this.bb.__offset(this.bb_pos,8);return gt?this.bb.readInt64(this.bb.__vector(this.bb_pos+gt)+pt*8):this.bb.createLong(0,0)}dimsLength(){let pt=this.bb.__offset(this.bb_pos,8);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startSparseTensor(pt){pt.startObject(3)}static addValues(pt,gt){pt.addFieldOffset(0,gt,0)}static addIndices(pt,gt){pt.addFieldOffset(1,gt,0)}static addDims(pt,gt){pt.addFieldOffset(2,gt,0)}static createDimsVector(pt,gt){pt.startVector(8,gt.length,8);for(let bt=gt.length-1;bt>=0;bt--)pt.addInt64(gt[bt]);return pt.endVector()}static startDimsVector(pt,gt){pt.startVector(8,gt,8)}static endSparseTensor(pt){return pt.endObject()}static createSparseTensor(pt,gt,bt,wt){return ft.startSparseTensor(pt),ft.addValues(pt,gt),ft.addIndices(pt,bt),ft.addDims(pt,wt),ft.endSparseTensor(pt)}}lt.SparseTensor=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsAttribute(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsAttribute(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}name(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.__string(this.bb_pos+gt,pt):null}docString(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?this.bb.__string(this.bb_pos+gt,pt):null}type(){let pt=this.bb.__offset(this.bb_pos,8);return pt?this.bb.readInt32(this.bb_pos+pt):0}f(){let pt=this.bb.__offset(this.bb_pos,10);return pt?this.bb.readFloat32(this.bb_pos+pt):0}i(){let pt=this.bb.__offset(this.bb_pos,12);return pt?this.bb.readInt64(this.bb_pos+pt):this.bb.createLong(0,0)}s(pt){let gt=this.bb.__offset(this.bb_pos,14);return gt?this.bb.__string(this.bb_pos+gt,pt):null}t(pt){let gt=this.bb.__offset(this.bb_pos,16);return gt?(pt||new it.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}g(pt){let gt=this.bb.__offset(this.bb_pos,18);return gt?(pt||new it.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}floats(pt){let gt=this.bb.__offset(this.bb_pos,20);return gt?this.bb.readFloat32(this.bb.__vector(this.bb_pos+gt)+pt*4):0}floatsLength(){let pt=this.bb.__offset(this.bb_pos,20);return pt?this.bb.__vector_len(this.bb_pos+pt):0}floatsArray(){let pt=this.bb.__offset(this.bb_pos,20);return pt?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+pt),this.bb.__vector_len(this.bb_pos+pt)):null}ints(pt){let gt=this.bb.__offset(this.bb_pos,22);return gt?this.bb.readInt64(this.bb.__vector(this.bb_pos+gt)+pt*8):this.bb.createLong(0,0)}intsLength(){let pt=this.bb.__offset(this.bb_pos,22);return pt?this.bb.__vector_len(this.bb_pos+pt):0}strings(pt,gt){let bt=this.bb.__offset(this.bb_pos,24);return bt?this.bb.__string(this.bb.__vector(this.bb_pos+bt)+pt*4,gt):null}stringsLength(){let pt=this.bb.__offset(this.bb_pos,24);return pt?this.bb.__vector_len(this.bb_pos+pt):0}tensors(pt,gt){let bt=this.bb.__offset(this.bb_pos,26);return bt?(gt||new it.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}tensorsLength(){let pt=this.bb.__offset(this.bb_pos,26);return pt?this.bb.__vector_len(this.bb_pos+pt):0}graphs(pt,gt){let bt=this.bb.__offset(this.bb_pos,28);return bt?(gt||new it.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}graphsLength(){let pt=this.bb.__offset(this.bb_pos,28);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startAttribute(pt){pt.startObject(13)}static addName(pt,gt){pt.addFieldOffset(0,gt,0)}static addDocString(pt,gt){pt.addFieldOffset(1,gt,0)}static addType(pt,gt){pt.addFieldInt32(2,gt,0)}static addF(pt,gt){pt.addFieldFloat32(3,gt,0)}static addI(pt,gt){pt.addFieldInt64(4,gt,pt.createLong(0,0))}static addS(pt,gt){pt.addFieldOffset(5,gt,0)}static addT(pt,gt){pt.addFieldOffset(6,gt,0)}static addG(pt,gt){pt.addFieldOffset(7,gt,0)}static addFloats(pt,gt){pt.addFieldOffset(8,gt,0)}static createFloatsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addFloat32(gt[bt]);return pt.endVector()}static startFloatsVector(pt,gt){pt.startVector(4,gt,4)}static addInts(pt,gt){pt.addFieldOffset(9,gt,0)}static createIntsVector(pt,gt){pt.startVector(8,gt.length,8);for(let bt=gt.length-1;bt>=0;bt--)pt.addInt64(gt[bt]);return pt.endVector()}static startIntsVector(pt,gt){pt.startVector(8,gt,8)}static addStrings(pt,gt){pt.addFieldOffset(10,gt,0)}static createStringsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startStringsVector(pt,gt){pt.startVector(4,gt,4)}static addTensors(pt,gt){pt.addFieldOffset(11,gt,0)}static createTensorsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startTensorsVector(pt,gt){pt.startVector(4,gt,4)}static addGraphs(pt,gt){pt.addFieldOffset(12,gt,0)}static createGraphsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startGraphsVector(pt,gt){pt.startVector(4,gt,4)}static endAttribute(pt){return pt.endObject()}static createAttribute(pt,gt,bt,wt,vt,Ct,Rt,Mt,Ot,Nt,Ht,Kt,hr,Qt){return ft.startAttribute(pt),ft.addName(pt,gt),ft.addDocString(pt,bt),ft.addType(pt,wt),ft.addF(pt,vt),ft.addI(pt,Ct),ft.addS(pt,Rt),ft.addT(pt,Mt),ft.addG(pt,Ot),ft.addFloats(pt,Nt),ft.addInts(pt,Ht),ft.addStrings(pt,Kt),ft.addTensors(pt,hr),ft.addGraphs(pt,Qt),ft.endAttribute(pt)}}lt.Attribute=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsGraph(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsGraph(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}initializers(pt,gt){let bt=this.bb.__offset(this.bb_pos,4);return bt?(gt||new it.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}initializersLength(){let pt=this.bb.__offset(this.bb_pos,4);return pt?this.bb.__vector_len(this.bb_pos+pt):0}nodeArgs(pt,gt){let bt=this.bb.__offset(this.bb_pos,6);return bt?(gt||new it.experimental.fbs.ValueInfo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}nodeArgsLength(){let pt=this.bb.__offset(this.bb_pos,6);return pt?this.bb.__vector_len(this.bb_pos+pt):0}nodes(pt,gt){let bt=this.bb.__offset(this.bb_pos,8);return bt?(gt||new it.experimental.fbs.Node).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}nodesLength(){let pt=this.bb.__offset(this.bb_pos,8);return pt?this.bb.__vector_len(this.bb_pos+pt):0}maxNodeIndex(){let pt=this.bb.__offset(this.bb_pos,10);return pt?this.bb.readUint32(this.bb_pos+pt):0}nodeEdges(pt,gt){let bt=this.bb.__offset(this.bb_pos,12);return bt?(gt||new it.experimental.fbs.NodeEdge).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}nodeEdgesLength(){let pt=this.bb.__offset(this.bb_pos,12);return pt?this.bb.__vector_len(this.bb_pos+pt):0}inputs(pt,gt){let bt=this.bb.__offset(this.bb_pos,14);return bt?this.bb.__string(this.bb.__vector(this.bb_pos+bt)+pt*4,gt):null}inputsLength(){let pt=this.bb.__offset(this.bb_pos,14);return pt?this.bb.__vector_len(this.bb_pos+pt):0}outputs(pt,gt){let bt=this.bb.__offset(this.bb_pos,16);return bt?this.bb.__string(this.bb.__vector(this.bb_pos+bt)+pt*4,gt):null}outputsLength(){let pt=this.bb.__offset(this.bb_pos,16);return pt?this.bb.__vector_len(this.bb_pos+pt):0}sparseInitializers(pt,gt){let bt=this.bb.__offset(this.bb_pos,18);return bt?(gt||new it.experimental.fbs.SparseTensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}sparseInitializersLength(){let pt=this.bb.__offset(this.bb_pos,18);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startGraph(pt){pt.startObject(8)}static addInitializers(pt,gt){pt.addFieldOffset(0,gt,0)}static createInitializersVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startInitializersVector(pt,gt){pt.startVector(4,gt,4)}static addNodeArgs(pt,gt){pt.addFieldOffset(1,gt,0)}static createNodeArgsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startNodeArgsVector(pt,gt){pt.startVector(4,gt,4)}static addNodes(pt,gt){pt.addFieldOffset(2,gt,0)}static createNodesVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startNodesVector(pt,gt){pt.startVector(4,gt,4)}static addMaxNodeIndex(pt,gt){pt.addFieldInt32(3,gt,0)}static addNodeEdges(pt,gt){pt.addFieldOffset(4,gt,0)}static createNodeEdgesVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startNodeEdgesVector(pt,gt){pt.startVector(4,gt,4)}static addInputs(pt,gt){pt.addFieldOffset(5,gt,0)}static createInputsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startInputsVector(pt,gt){pt.startVector(4,gt,4)}static addOutputs(pt,gt){pt.addFieldOffset(6,gt,0)}static createOutputsVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startOutputsVector(pt,gt){pt.startVector(4,gt,4)}static addSparseInitializers(pt,gt){pt.addFieldOffset(7,gt,0)}static createSparseInitializersVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startSparseInitializersVector(pt,gt){pt.startVector(4,gt,4)}static endGraph(pt){return pt.endObject()}static createGraph(pt,gt,bt,wt,vt,Ct,Rt,Mt,Ot){return ft.startGraph(pt),ft.addInitializers(pt,gt),ft.addNodeArgs(pt,bt),ft.addNodes(pt,wt),ft.addMaxNodeIndex(pt,vt),ft.addNodeEdges(pt,Ct),ft.addInputs(pt,Rt),ft.addOutputs(pt,Mt),ft.addSparseInitializers(pt,Ot),ft.endGraph(pt)}}lt.Graph=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsModel(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsModel(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}irVersion(){let pt=this.bb.__offset(this.bb_pos,4);return pt?this.bb.readInt64(this.bb_pos+pt):this.bb.createLong(0,0)}opsetImport(pt,gt){let bt=this.bb.__offset(this.bb_pos,6);return bt?(gt||new it.experimental.fbs.OperatorSetId).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}opsetImportLength(){let pt=this.bb.__offset(this.bb_pos,6);return pt?this.bb.__vector_len(this.bb_pos+pt):0}producerName(pt){let gt=this.bb.__offset(this.bb_pos,8);return gt?this.bb.__string(this.bb_pos+gt,pt):null}producerVersion(pt){let gt=this.bb.__offset(this.bb_pos,10);return gt?this.bb.__string(this.bb_pos+gt,pt):null}domain(pt){let gt=this.bb.__offset(this.bb_pos,12);return gt?this.bb.__string(this.bb_pos+gt,pt):null}modelVersion(){let pt=this.bb.__offset(this.bb_pos,14);return pt?this.bb.readInt64(this.bb_pos+pt):this.bb.createLong(0,0)}docString(pt){let gt=this.bb.__offset(this.bb_pos,16);return gt?this.bb.__string(this.bb_pos+gt,pt):null}graph(pt){let gt=this.bb.__offset(this.bb_pos,18);return gt?(pt||new it.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}graphDocString(pt){let gt=this.bb.__offset(this.bb_pos,20);return gt?this.bb.__string(this.bb_pos+gt,pt):null}static startModel(pt){pt.startObject(9)}static addIrVersion(pt,gt){pt.addFieldInt64(0,gt,pt.createLong(0,0))}static addOpsetImport(pt,gt){pt.addFieldOffset(1,gt,0)}static createOpsetImportVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startOpsetImportVector(pt,gt){pt.startVector(4,gt,4)}static addProducerName(pt,gt){pt.addFieldOffset(2,gt,0)}static addProducerVersion(pt,gt){pt.addFieldOffset(3,gt,0)}static addDomain(pt,gt){pt.addFieldOffset(4,gt,0)}static addModelVersion(pt,gt){pt.addFieldInt64(5,gt,pt.createLong(0,0))}static addDocString(pt,gt){pt.addFieldOffset(6,gt,0)}static addGraph(pt,gt){pt.addFieldOffset(7,gt,0)}static addGraphDocString(pt,gt){pt.addFieldOffset(8,gt,0)}static endModel(pt){return pt.endObject()}static createModel(pt,gt,bt,wt,vt,Ct,Rt,Mt,Ot,Nt){return ft.startModel(pt),ft.addIrVersion(pt,gt),ft.addOpsetImport(pt,bt),ft.addProducerName(pt,wt),ft.addProducerVersion(pt,vt),ft.addDomain(pt,Ct),ft.addModelVersion(pt,Rt),ft.addDocString(pt,Mt),ft.addGraph(pt,Ot),ft.addGraphDocString(pt,Nt),ft.endModel(pt)}}lt.Model=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsKernelCreateInfos(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsKernelCreateInfos(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}nodeIndices(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.readUint32(this.bb.__vector(this.bb_pos+gt)+pt*4):0}nodeIndicesLength(){let pt=this.bb.__offset(this.bb_pos,4);return pt?this.bb.__vector_len(this.bb_pos+pt):0}nodeIndicesArray(){let pt=this.bb.__offset(this.bb_pos,4);return pt?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+pt),this.bb.__vector_len(this.bb_pos+pt)):null}kernelDefHashes(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?this.bb.readUint64(this.bb.__vector(this.bb_pos+gt)+pt*8):this.bb.createLong(0,0)}kernelDefHashesLength(){let pt=this.bb.__offset(this.bb_pos,6);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startKernelCreateInfos(pt){pt.startObject(2)}static addNodeIndices(pt,gt){pt.addFieldOffset(0,gt,0)}static createNodeIndicesVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addInt32(gt[bt]);return pt.endVector()}static startNodeIndicesVector(pt,gt){pt.startVector(4,gt,4)}static addKernelDefHashes(pt,gt){pt.addFieldOffset(1,gt,0)}static createKernelDefHashesVector(pt,gt){pt.startVector(8,gt.length,8);for(let bt=gt.length-1;bt>=0;bt--)pt.addInt64(gt[bt]);return pt.endVector()}static startKernelDefHashesVector(pt,gt){pt.startVector(8,gt,8)}static endKernelCreateInfos(pt){return pt.endObject()}static createKernelCreateInfos(pt,gt,bt){return ft.startKernelCreateInfos(pt),ft.addNodeIndices(pt,gt),ft.addKernelDefHashes(pt,bt),ft.endKernelCreateInfos(pt)}}lt.KernelCreateInfos=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsSubGraphSessionState(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsSubGraphSessionState(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}graphId(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.__string(this.bb_pos+gt,pt):null}sessionState(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?(pt||new it.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}static startSubGraphSessionState(pt){pt.startObject(2)}static addGraphId(pt,gt){pt.addFieldOffset(0,gt,0)}static addSessionState(pt,gt){pt.addFieldOffset(1,gt,0)}static endSubGraphSessionState(pt){let gt=pt.endObject();return pt.requiredField(gt,4),gt}static createSubGraphSessionState(pt,gt,bt){return ft.startSubGraphSessionState(pt),ft.addGraphId(pt,gt),ft.addSessionState(pt,bt),ft.endSubGraphSessionState(pt)}}lt.SubGraphSessionState=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsSessionState(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsSessionState(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}kernels(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?(pt||new it.experimental.fbs.KernelCreateInfos).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}subGraphSessionStates(pt,gt){let bt=this.bb.__offset(this.bb_pos,6);return bt?(gt||new it.experimental.fbs.SubGraphSessionState).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+bt)+pt*4),this.bb):null}subGraphSessionStatesLength(){let pt=this.bb.__offset(this.bb_pos,6);return pt?this.bb.__vector_len(this.bb_pos+pt):0}static startSessionState(pt){pt.startObject(2)}static addKernels(pt,gt){pt.addFieldOffset(0,gt,0)}static addSubGraphSessionStates(pt,gt){pt.addFieldOffset(1,gt,0)}static createSubGraphSessionStatesVector(pt,gt){pt.startVector(4,gt.length,4);for(let bt=gt.length-1;bt>=0;bt--)pt.addOffset(gt[bt]);return pt.endVector()}static startSubGraphSessionStatesVector(pt,gt){pt.startVector(4,gt,4)}static endSessionState(pt){return pt.endObject()}static createSessionState(pt,gt,bt){return ft.startSessionState(pt),ft.addKernels(pt,gt),ft.addSubGraphSessionStates(pt,bt),ft.endSessionState(pt)}}lt.SessionState=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={})),(it=>{(_=>{(lt=>{class ft{constructor(){this.bb=null,this.bb_pos=0}__init(pt,gt){return this.bb_pos=pt,this.bb=gt,this}static getRootAsInferenceSession(pt,gt){return(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static getSizePrefixedRootAsInferenceSession(pt,gt){return pt.setPosition(pt.position()+b.SIZE_PREFIX_LENGTH),(gt||new ft).__init(pt.readInt32(pt.position())+pt.position(),pt)}static bufferHasIdentifier(pt){return pt.__has_identifier("ORTM")}ortVersion(pt){let gt=this.bb.__offset(this.bb_pos,4);return gt?this.bb.__string(this.bb_pos+gt,pt):null}model(pt){let gt=this.bb.__offset(this.bb_pos,6);return gt?(pt||new it.experimental.fbs.Model).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}sessionState(pt){let gt=this.bb.__offset(this.bb_pos,8);return gt?(pt||new it.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+gt),this.bb):null}static startInferenceSession(pt){pt.startObject(3)}static addOrtVersion(pt,gt){pt.addFieldOffset(0,gt,0)}static addModel(pt,gt){pt.addFieldOffset(1,gt,0)}static addSessionState(pt,gt){pt.addFieldOffset(2,gt,0)}static endInferenceSession(pt){return pt.endObject()}static finishInferenceSessionBuffer(pt,gt){pt.finish(gt,"ORTM")}static finishSizePrefixedInferenceSessionBuffer(pt,gt){pt.finish(gt,"ORTM",!0)}static createInferenceSession(pt,gt,bt,wt){return ft.startInferenceSession(pt),ft.addOrtVersion(pt,gt),ft.addModel(pt,bt),ft.addSessionState(pt,wt),ft.endInferenceSession(pt)}}lt.InferenceSession=ft})(_.fbs||(_.fbs={}))})(it.experimental||(it.experimental={}))})(P||(P={}))}),Qi=tt((it,_)=>{_.exports=lt;function lt(ft,mt){for(var pt=new Array(arguments.length-1),gt=0,bt=2,wt=!0;bt<arguments.length;)pt[gt++]=arguments[bt++];return new Promise(function(vt,Ct){pt[gt]=function(Rt){if(wt)if(wt=!1,Rt)Ct(Rt);else{for(var Mt=new Array(arguments.length-1),Ot=0;Ot<Mt.length;)Mt[Ot++]=arguments[Ot];vt.apply(null,Mt)}};try{ft.apply(mt||null,pt)}catch(Rt){wt&&(wt=!1,Ct(Rt))}})}}),na=tt(it=>{var _=it;_.length=function(gt){var bt=gt.length;if(!bt)return 0;for(var wt=0;--bt%4>1&&gt.charAt(bt)==="=";)++wt;return Math.ceil(gt.length*3)/4-wt};var lt=new Array(64),ft=new Array(123);for(mt=0;mt<64;)ft[lt[mt]=mt<26?mt+65:mt<52?mt+71:mt<62?mt-4:mt-59|43]=mt++;var mt;_.encode=function(gt,bt,wt){for(var vt=null,Ct=[],Rt=0,Mt=0,Ot;bt<wt;){var Nt=gt[bt++];switch(Mt){case 0:Ct[Rt++]=lt[Nt>>2],Ot=(Nt&3)<<4,Mt=1;break;case 1:Ct[Rt++]=lt[Ot|Nt>>4],Ot=(Nt&15)<<2,Mt=2;break;case 2:Ct[Rt++]=lt[Ot|Nt>>6],Ct[Rt++]=lt[Nt&63],Mt=0;break}Rt>8191&&((vt||(vt=[])).push(String.fromCharCode.apply(String,Ct)),Rt=0)}return Mt&&(Ct[Rt++]=lt[Ot],Ct[Rt++]=61,Mt===1&&(Ct[Rt++]=61)),vt?(Rt&&vt.push(String.fromCharCode.apply(String,Ct.slice(0,Rt))),vt.join("")):String.fromCharCode.apply(String,Ct.slice(0,Rt))};var pt="invalid encoding";_.decode=function(gt,bt,wt){for(var vt=wt,Ct=0,Rt,Mt=0;Mt<gt.length;){var Ot=gt.charCodeAt(Mt++);if(Ot===61&&Ct>1)break;if((Ot=ft[Ot])===void 0)throw Error(pt);switch(Ct){case 0:Rt=Ot,Ct=1;break;case 1:bt[wt++]=Rt<<2|(Ot&48)>>4,Rt=Ot,Ct=2;break;case 2:bt[wt++]=(Rt&15)<<4|(Ot&60)>>2,Rt=Ot,Ct=3;break;case 3:bt[wt++]=(Rt&3)<<6|Ot,Ct=0;break}}if(Ct===1)throw Error(pt);return wt-vt},_.test=function(gt){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(gt)}}),ia=tt((it,_)=>{_.exports=lt;function lt(){this._listeners={}}lt.prototype.on=function(ft,mt,pt){return(this._listeners[ft]||(this._listeners[ft]=[])).push({fn:mt,ctx:pt||this}),this},lt.prototype.off=function(ft,mt){if(ft===void 0)this._listeners={};else if(mt===void 0)this._listeners[ft]=[];else for(var pt=this._listeners[ft],gt=0;gt<pt.length;)pt[gt].fn===mt?pt.splice(gt,1):++gt;return this},lt.prototype.emit=function(ft){var mt=this._listeners[ft];if(mt){for(var pt=[],gt=1;gt<arguments.length;)pt.push(arguments[gt++]);for(gt=0;gt<mt.length;)mt[gt].fn.apply(mt[gt++].ctx,pt)}return this}}),pa=tt((it,_)=>{_.exports=lt(lt);function lt(bt){return typeof Float32Array<"u"?function(){var wt=new Float32Array([-0]),vt=new Uint8Array(wt.buffer),Ct=vt[3]===128;function Rt(Ht,Kt,hr){wt[0]=Ht,Kt[hr]=vt[0],Kt[hr+1]=vt[1],Kt[hr+2]=vt[2],Kt[hr+3]=vt[3]}function Mt(Ht,Kt,hr){wt[0]=Ht,Kt[hr]=vt[3],Kt[hr+1]=vt[2],Kt[hr+2]=vt[1],Kt[hr+3]=vt[0]}bt.writeFloatLE=Ct?Rt:Mt,bt.writeFloatBE=Ct?Mt:Rt;function Ot(Ht,Kt){return vt[0]=Ht[Kt],vt[1]=Ht[Kt+1],vt[2]=Ht[Kt+2],vt[3]=Ht[Kt+3],wt[0]}function Nt(Ht,Kt){return vt[3]=Ht[Kt],vt[2]=Ht[Kt+1],vt[1]=Ht[Kt+2],vt[0]=Ht[Kt+3],wt[0]}bt.readFloatLE=Ct?Ot:Nt,bt.readFloatBE=Ct?Nt:Ot}():function(){function wt(Ct,Rt,Mt,Ot){var Nt=Rt<0?1:0;if(Nt&&(Rt=-Rt),Rt===0)Ct(1/Rt>0?0:2147483648,Mt,Ot);else if(isNaN(Rt))Ct(2143289344,Mt,Ot);else if(Rt>34028234663852886e22)Ct((Nt<<31|2139095040)>>>0,Mt,Ot);else if(Rt<11754943508222875e-54)Ct((Nt<<31|Math.round(Rt/1401298464324817e-60))>>>0,Mt,Ot);else{var Ht=Math.floor(Math.log(Rt)/Math.LN2),Kt=Math.round(Rt*Math.pow(2,-Ht)*8388608)&8388607;Ct((Nt<<31|Ht+127<<23|Kt)>>>0,Mt,Ot)}}bt.writeFloatLE=wt.bind(null,ft),bt.writeFloatBE=wt.bind(null,mt);function vt(Ct,Rt,Mt){var Ot=Ct(Rt,Mt),Nt=(Ot>>31)*2+1,Ht=Ot>>>23&255,Kt=Ot&8388607;return Ht===255?Kt?NaN:Nt*(1/0):Ht===0?Nt*1401298464324817e-60*Kt:Nt*Math.pow(2,Ht-150)*(Kt+8388608)}bt.readFloatLE=vt.bind(null,pt),bt.readFloatBE=vt.bind(null,gt)}(),typeof Float64Array<"u"?function(){var wt=new Float64Array([-0]),vt=new Uint8Array(wt.buffer),Ct=vt[7]===128;function Rt(Ht,Kt,hr){wt[0]=Ht,Kt[hr]=vt[0],Kt[hr+1]=vt[1],Kt[hr+2]=vt[2],Kt[hr+3]=vt[3],Kt[hr+4]=vt[4],Kt[hr+5]=vt[5],Kt[hr+6]=vt[6],Kt[hr+7]=vt[7]}function Mt(Ht,Kt,hr){wt[0]=Ht,Kt[hr]=vt[7],Kt[hr+1]=vt[6],Kt[hr+2]=vt[5],Kt[hr+3]=vt[4],Kt[hr+4]=vt[3],Kt[hr+5]=vt[2],Kt[hr+6]=vt[1],Kt[hr+7]=vt[0]}bt.writeDoubleLE=Ct?Rt:Mt,bt.writeDoubleBE=Ct?Mt:Rt;function Ot(Ht,Kt){return vt[0]=Ht[Kt],vt[1]=Ht[Kt+1],vt[2]=Ht[Kt+2],vt[3]=Ht[Kt+3],vt[4]=Ht[Kt+4],vt[5]=Ht[Kt+5],vt[6]=Ht[Kt+6],vt[7]=Ht[Kt+7],wt[0]}function Nt(Ht,Kt){return vt[7]=Ht[Kt],vt[6]=Ht[Kt+1],vt[5]=Ht[Kt+2],vt[4]=Ht[Kt+3],vt[3]=Ht[Kt+4],vt[2]=Ht[Kt+5],vt[1]=Ht[Kt+6],vt[0]=Ht[Kt+7],wt[0]}bt.readDoubleLE=Ct?Ot:Nt,bt.readDoubleBE=Ct?Nt:Ot}():function(){function wt(Ct,Rt,Mt,Ot,Nt,Ht){var Kt=Ot<0?1:0;if(Kt&&(Ot=-Ot),Ot===0)Ct(0,Nt,Ht+Rt),Ct(1/Ot>0?0:2147483648,Nt,Ht+Mt);else if(isNaN(Ot))Ct(0,Nt,Ht+Rt),Ct(2146959360,Nt,Ht+Mt);else if(Ot>17976931348623157e292)Ct(0,Nt,Ht+Rt),Ct((Kt<<31|2146435072)>>>0,Nt,Ht+Mt);else{var hr;if(Ot<22250738585072014e-324)hr=Ot/5e-324,Ct(hr>>>0,Nt,Ht+Rt),Ct((Kt<<31|hr/4294967296)>>>0,Nt,Ht+Mt);else{var Qt=Math.floor(Math.log(Ot)/Math.LN2);Qt===1024&&(Qt=1023),hr=Ot*Math.pow(2,-Qt),Ct(hr*4503599627370496>>>0,Nt,Ht+Rt),Ct((Kt<<31|Qt+1023<<20|hr*1048576&1048575)>>>0,Nt,Ht+Mt)}}}bt.writeDoubleLE=wt.bind(null,ft,0,4),bt.writeDoubleBE=wt.bind(null,mt,4,0);function vt(Ct,Rt,Mt,Ot,Nt){var Ht=Ct(Ot,Nt+Rt),Kt=Ct(Ot,Nt+Mt),hr=(Kt>>31)*2+1,Qt=Kt>>>20&2047,mr=4294967296*(Kt&1048575)+Ht;return Qt===2047?mr?NaN:hr*(1/0):Qt===0?hr*5e-324*mr:hr*Math.pow(2,Qt-1075)*(mr+4503599627370496)}bt.readDoubleLE=vt.bind(null,pt,0,4),bt.readDoubleBE=vt.bind(null,gt,4,0)}(),bt}function ft(bt,wt,vt){wt[vt]=bt&255,wt[vt+1]=bt>>>8&255,wt[vt+2]=bt>>>16&255,wt[vt+3]=bt>>>24}function mt(bt,wt,vt){wt[vt]=bt>>>24,wt[vt+1]=bt>>>16&255,wt[vt+2]=bt>>>8&255,wt[vt+3]=bt&255}function pt(bt,wt){return(bt[wt]|bt[wt+1]<<8|bt[wt+2]<<16|bt[wt+3]<<24)>>>0}function gt(bt,wt){return(bt[wt]<<24|bt[wt+1]<<16|bt[wt+2]<<8|bt[wt+3])>>>0}}),da=tt((exports,module)=>{module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(it){}return null}}),ma=tt(it=>{var _=it;_.length=function(lt){for(var ft=0,mt=0,pt=0;pt<lt.length;++pt)mt=lt.charCodeAt(pt),mt<128?ft+=1:mt<2048?ft+=2:(mt&64512)===55296&&(lt.charCodeAt(pt+1)&64512)===56320?(++pt,ft+=4):ft+=3;return ft},_.read=function(lt,ft,mt){var pt=mt-ft;if(pt<1)return"";for(var gt=null,bt=[],wt=0,vt;ft<mt;)vt=lt[ft++],vt<128?bt[wt++]=vt:vt>191&&vt<224?bt[wt++]=(vt&31)<<6|lt[ft++]&63:vt>239&&vt<365?(vt=((vt&7)<<18|(lt[ft++]&63)<<12|(lt[ft++]&63)<<6|lt[ft++]&63)-65536,bt[wt++]=55296+(vt>>10),bt[wt++]=56320+(vt&1023)):bt[wt++]=(vt&15)<<12|(lt[ft++]&63)<<6|lt[ft++]&63,wt>8191&&((gt||(gt=[])).push(String.fromCharCode.apply(String,bt)),wt=0);return gt?(wt&&gt.push(String.fromCharCode.apply(String,bt.slice(0,wt))),gt.join("")):String.fromCharCode.apply(String,bt.slice(0,wt))},_.write=function(lt,ft,mt){for(var pt=mt,gt,bt,wt=0;wt<lt.length;++wt)gt=lt.charCodeAt(wt),gt<128?ft[mt++]=gt:gt<2048?(ft[mt++]=gt>>6|192,ft[mt++]=gt&63|128):(gt&64512)===55296&&((bt=lt.charCodeAt(wt+1))&64512)===56320?(gt=65536+((gt&1023)<<10)+(bt&1023),++wt,ft[mt++]=gt>>18|240,ft[mt++]=gt>>12&63|128,ft[mt++]=gt>>6&63|128,ft[mt++]=gt&63|128):(ft[mt++]=gt>>12|224,ft[mt++]=gt>>6&63|128,ft[mt++]=gt&63|128);return mt-pt}}),ya=tt((it,_)=>{_.exports=lt;function lt(ft,mt,pt){var gt=pt||8192,bt=gt>>>1,wt=null,vt=gt;return function(Ct){if(Ct<1||Ct>bt)return ft(Ct);vt+Ct>gt&&(wt=ft(gt),vt=0);var Rt=mt.call(wt,vt,vt+=Ct);return vt&7&&(vt=(vt|7)+1),Rt}}}),xa=tt((it,_)=>{_.exports=ft;var lt=te();function ft(bt,wt){this.lo=bt>>>0,this.hi=wt>>>0}var mt=ft.zero=new ft(0,0);mt.toNumber=function(){return 0},mt.zzEncode=mt.zzDecode=function(){return this},mt.length=function(){return 1};var pt=ft.zeroHash="\0\0\0\0\0\0\0\0";ft.fromNumber=function(bt){if(bt===0)return mt;var wt=bt<0;wt&&(bt=-bt);var vt=bt>>>0,Ct=(bt-vt)/4294967296>>>0;return wt&&(Ct=~Ct>>>0,vt=~vt>>>0,++vt>4294967295&&(vt=0,++Ct>4294967295&&(Ct=0))),new ft(vt,Ct)},ft.from=function(bt){if(typeof bt=="number")return ft.fromNumber(bt);if(lt.isString(bt))if(lt.Long)bt=lt.Long.fromString(bt);else return ft.fromNumber(parseInt(bt,10));return bt.low||bt.high?new ft(bt.low>>>0,bt.high>>>0):mt},ft.prototype.toNumber=function(bt){if(!bt&&this.hi>>>31){var wt=~this.lo+1>>>0,vt=~this.hi>>>0;return wt||(vt=vt+1>>>0),-(wt+vt*4294967296)}return this.lo+this.hi*4294967296},ft.prototype.toLong=function(bt){return lt.Long?new lt.Long(this.lo|0,this.hi|0,!!bt):{low:this.lo|0,high:this.hi|0,unsigned:!!bt}};var gt=String.prototype.charCodeAt;ft.fromHash=function(bt){return bt===pt?mt:new ft((gt.call(bt,0)|gt.call(bt,1)<<8|gt.call(bt,2)<<16|gt.call(bt,3)<<24)>>>0,(gt.call(bt,4)|gt.call(bt,5)<<8|gt.call(bt,6)<<16|gt.call(bt,7)<<24)>>>0)},ft.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},ft.prototype.zzEncode=function(){var bt=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^bt)>>>0,this.lo=(this.lo<<1^bt)>>>0,this},ft.prototype.zzDecode=function(){var bt=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^bt)>>>0,this.hi=(this.hi>>>1^bt)>>>0,this},ft.prototype.length=function(){var bt=this.lo,wt=(this.lo>>>28|this.hi<<4)>>>0,vt=this.hi>>>24;return vt===0?wt===0?bt<16384?bt<128?1:2:bt<2097152?3:4:wt<16384?wt<128?5:6:wt<2097152?7:8:vt<128?9:10}}),te=tt(it=>{var _=it;_.asPromise=Qi(),_.base64=na(),_.EventEmitter=ia(),_.float=pa(),_.inquire=da(),_.utf8=ma(),_.pool=ya(),_.LongBits=xa(),_.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),_.global=_.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||it,_.emptyArray=Object.freeze?Object.freeze([]):[],_.emptyObject=Object.freeze?Object.freeze({}):{},_.isInteger=Number.isInteger||function(mt){return typeof mt=="number"&&isFinite(mt)&&Math.floor(mt)===mt},_.isString=function(mt){return typeof mt=="string"||mt instanceof String},_.isObject=function(mt){return mt&&typeof mt=="object"},_.isset=_.isSet=function(mt,pt){var gt=mt[pt];return gt!=null&&mt.hasOwnProperty(pt)?typeof gt!="object"||(Array.isArray(gt)?gt.length:Object.keys(gt).length)>0:!1},_.Buffer=function(){try{var mt=_.inquire("buffer").Buffer;return mt.prototype.utf8Write?mt:null}catch{return null}}(),_._Buffer_from=null,_._Buffer_allocUnsafe=null,_.newBuffer=function(mt){return typeof mt=="number"?_.Buffer?_._Buffer_allocUnsafe(mt):new _.Array(mt):_.Buffer?_._Buffer_from(mt):typeof Uint8Array>"u"?mt:new Uint8Array(mt)},_.Array=typeof Uint8Array<"u"?Uint8Array:Array,_.Long=_.global.dcodeIO&&_.global.dcodeIO.Long||_.global.Long||_.inquire("long"),_.key2Re=/^true|false|0|1$/,_.key32Re=/^-?(?:0|[1-9][0-9]*)$/,_.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,_.longToHash=function(mt){return mt?_.LongBits.from(mt).toHash():_.LongBits.zeroHash},_.longFromHash=function(mt,pt){var gt=_.LongBits.fromHash(mt);return _.Long?_.Long.fromBits(gt.lo,gt.hi,pt):gt.toNumber(!!pt)};function lt(mt,pt,gt){for(var bt=Object.keys(pt),wt=0;wt<bt.length;++wt)(mt[bt[wt]]===void 0||!gt)&&(mt[bt[wt]]=pt[bt[wt]]);return mt}_.merge=lt,_.lcFirst=function(mt){return mt.charAt(0).toLowerCase()+mt.substring(1)};function ft(mt){function pt(gt,bt){if(!(this instanceof pt))return new pt(gt,bt);Object.defineProperty(this,"message",{get:function(){return gt}}),Error.captureStackTrace?Error.captureStackTrace(this,pt):Object.defineProperty(this,"stack",{value:new Error().stack||""}),bt&&lt(this,bt)}return pt.prototype=Object.create(Error.prototype,{constructor:{value:pt,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return mt},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),pt}_.newError=ft,_.ProtocolError=ft("ProtocolError"),_.oneOfGetter=function(mt){for(var pt={},gt=0;gt<mt.length;++gt)pt[mt[gt]]=1;return function(){for(var bt=Object.keys(this),wt=bt.length-1;wt>-1;--wt)if(pt[bt[wt]]===1&&this[bt[wt]]!==void 0&&this[bt[wt]]!==null)return bt[wt]}},_.oneOfSetter=function(mt){return function(pt){for(var gt=0;gt<mt.length;++gt)mt[gt]!==pt&&delete this[mt[gt]]}},_.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},_._configure=function(){var mt=_.Buffer;if(!mt){_._Buffer_from=_._Buffer_allocUnsafe=null;return}_._Buffer_from=mt.from!==Uint8Array.from&&mt.from||function(pt,gt){return new mt(pt,gt)},_._Buffer_allocUnsafe=mt.allocUnsafe||function(pt){return new mt(pt)}}}),to=tt((it,_)=>{_.exports=Ct;var lt=te(),ft,mt=lt.LongBits,pt=lt.base64,gt=lt.utf8;function bt(Qt,mr,br){this.fn=Qt,this.len=mr,this.next=void 0,this.val=br}function wt(){}function vt(Qt){this.head=Qt.head,this.tail=Qt.tail,this.len=Qt.len,this.next=Qt.states}function Ct(){this.len=0,this.head=new bt(wt,0,0),this.tail=this.head,this.states=null}var Rt=function(){return lt.Buffer?function(){return(Ct.create=function(){return new ft})()}:function(){return new Ct}};Ct.create=Rt(),Ct.alloc=function(Qt){return new lt.Array(Qt)},lt.Array!==Array&&(Ct.alloc=lt.pool(Ct.alloc,lt.Array.prototype.subarray)),Ct.prototype._push=function(Qt,mr,br){return this.tail=this.tail.next=new bt(Qt,mr,br),this.len+=mr,this};function Mt(Qt,mr,br){mr[br]=Qt&255}function Ot(Qt,mr,br){for(;Qt>127;)mr[br++]=Qt&127|128,Qt>>>=7;mr[br]=Qt}function Nt(Qt,mr){this.len=Qt,this.next=void 0,this.val=mr}Nt.prototype=Object.create(bt.prototype),Nt.prototype.fn=Ot,Ct.prototype.uint32=function(Qt){return this.len+=(this.tail=this.tail.next=new Nt((Qt=Qt>>>0)<128?1:Qt<16384?2:Qt<2097152?3:Qt<268435456?4:5,Qt)).len,this},Ct.prototype.int32=function(Qt){return Qt<0?this._push(Ht,10,mt.fromNumber(Qt)):this.uint32(Qt)},Ct.prototype.sint32=function(Qt){return this.uint32((Qt<<1^Qt>>31)>>>0)};function Ht(Qt,mr,br){for(;Qt.hi;)mr[br++]=Qt.lo&127|128,Qt.lo=(Qt.lo>>>7|Qt.hi<<25)>>>0,Qt.hi>>>=7;for(;Qt.lo>127;)mr[br++]=Qt.lo&127|128,Qt.lo=Qt.lo>>>7;mr[br++]=Qt.lo}Ct.prototype.uint64=function(Qt){var mr=mt.from(Qt);return this._push(Ht,mr.length(),mr)},Ct.prototype.int64=Ct.prototype.uint64,Ct.prototype.sint64=function(Qt){var mr=mt.from(Qt).zzEncode();return this._push(Ht,mr.length(),mr)},Ct.prototype.bool=function(Qt){return this._push(Mt,1,Qt?1:0)};function Kt(Qt,mr,br){mr[br]=Qt&255,mr[br+1]=Qt>>>8&255,mr[br+2]=Qt>>>16&255,mr[br+3]=Qt>>>24}Ct.prototype.fixed32=function(Qt){return this._push(Kt,4,Qt>>>0)},Ct.prototype.sfixed32=Ct.prototype.fixed32,Ct.prototype.fixed64=function(Qt){var mr=mt.from(Qt);return this._push(Kt,4,mr.lo)._push(Kt,4,mr.hi)},Ct.prototype.sfixed64=Ct.prototype.fixed64,Ct.prototype.float=function(Qt){return this._push(lt.float.writeFloatLE,4,Qt)},Ct.prototype.double=function(Qt){return this._push(lt.float.writeDoubleLE,8,Qt)};var hr=lt.Array.prototype.set?function(Qt,mr,br){mr.set(Qt,br)}:function(Qt,mr,br){for(var Fr=0;Fr<Qt.length;++Fr)mr[br+Fr]=Qt[Fr]};Ct.prototype.bytes=function(Qt){var mr=Qt.length>>>0;if(!mr)return this._push(Mt,1,0);if(lt.isString(Qt)){var br=Ct.alloc(mr=pt.length(Qt));pt.decode(Qt,br,0),Qt=br}return this.uint32(mr)._push(hr,mr,Qt)},Ct.prototype.string=function(Qt){var mr=gt.length(Qt);return mr?this.uint32(mr)._push(gt.write,mr,Qt):this._push(Mt,1,0)},Ct.prototype.fork=function(){return this.states=new vt(this),this.head=this.tail=new bt(wt,0,0),this.len=0,this},Ct.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new bt(wt,0,0),this.len=0),this},Ct.prototype.ldelim=function(){var Qt=this.head,mr=this.tail,br=this.len;return this.reset().uint32(br),br&&(this.tail.next=Qt.next,this.tail=mr,this.len+=br),this},Ct.prototype.finish=function(){for(var Qt=this.head.next,mr=this.constructor.alloc(this.len),br=0;Qt;)Qt.fn(Qt.val,mr,br),br+=Qt.len,Qt=Qt.next;return mr},Ct._configure=function(Qt){ft=Qt,Ct.create=Rt(),ft._configure()}}),Pa=tt((it,_)=>{_.exports=mt;var lt=to();(mt.prototype=Object.create(lt.prototype)).constructor=mt;var ft=te();function mt(){lt.call(this)}mt._configure=function(){mt.alloc=ft._Buffer_allocUnsafe,mt.writeBytesBuffer=ft.Buffer&&ft.Buffer.prototype instanceof Uint8Array&&ft.Buffer.prototype.set.name==="set"?function(gt,bt,wt){bt.set(gt,wt)}:function(gt,bt,wt){if(gt.copy)gt.copy(bt,wt,0,gt.length);else for(var vt=0;vt<gt.length;)bt[wt++]=gt[vt++]}},mt.prototype.bytes=function(gt){ft.isString(gt)&&(gt=ft._Buffer_from(gt,"base64"));var bt=gt.length>>>0;return this.uint32(bt),bt&&this._push(mt.writeBytesBuffer,bt,gt),this};function pt(gt,bt,wt){gt.length<40?ft.utf8.write(gt,bt,wt):bt.utf8Write?bt.utf8Write(gt,wt):bt.write(gt,wt)}mt.prototype.string=function(gt){var bt=ft.Buffer.byteLength(gt);return this.uint32(bt),bt&&this._push(pt,bt,gt),this},mt._configure()}),no=tt((it,_)=>{_.exports=bt;var lt=te(),ft,mt=lt.LongBits,pt=lt.utf8;function gt(Ot,Nt){return RangeError("index out of range: "+Ot.pos+" + "+(Nt||1)+" > "+Ot.len)}function bt(Ot){this.buf=Ot,this.pos=0,this.len=Ot.length}var wt=typeof Uint8Array<"u"?function(Ot){if(Ot instanceof Uint8Array||Array.isArray(Ot))return new bt(Ot);throw Error("illegal buffer")}:function(Ot){if(Array.isArray(Ot))return new bt(Ot);throw Error("illegal buffer")},vt=function(){return lt.Buffer?function(Ot){return(bt.create=function(Nt){return lt.Buffer.isBuffer(Nt)?new ft(Nt):wt(Nt)})(Ot)}:wt};bt.create=vt(),bt.prototype._slice=lt.Array.prototype.subarray||lt.Array.prototype.slice,bt.prototype.uint32=function(){var Ot=4294967295;return function(){if(Ot=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(Ot=(Ot|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(Ot=(Ot|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(Ot=(Ot|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(Ot=(Ot|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return Ot;if((this.pos+=5)>this.len)throw this.pos=this.len,gt(this,10);return Ot}}(),bt.prototype.int32=function(){return this.uint32()|0},bt.prototype.sint32=function(){var Ot=this.uint32();return Ot>>>1^-(Ot&1)|0};function Ct(){var Ot=new mt(0,0),Nt=0;if(this.len-this.pos>4){for(;Nt<4;++Nt)if(Ot.lo=(Ot.lo|(this.buf[this.pos]&127)<<Nt*7)>>>0,this.buf[this.pos++]<128)return Ot;if(Ot.lo=(Ot.lo|(this.buf[this.pos]&127)<<28)>>>0,Ot.hi=(Ot.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return Ot;Nt=0}else{for(;Nt<3;++Nt){if(this.pos>=this.len)throw gt(this);if(Ot.lo=(Ot.lo|(this.buf[this.pos]&127)<<Nt*7)>>>0,this.buf[this.pos++]<128)return Ot}return Ot.lo=(Ot.lo|(this.buf[this.pos++]&127)<<Nt*7)>>>0,Ot}if(this.len-this.pos>4){for(;Nt<5;++Nt)if(Ot.hi=(Ot.hi|(this.buf[this.pos]&127)<<Nt*7+3)>>>0,this.buf[this.pos++]<128)return Ot}else for(;Nt<5;++Nt){if(this.pos>=this.len)throw gt(this);if(Ot.hi=(Ot.hi|(this.buf[this.pos]&127)<<Nt*7+3)>>>0,this.buf[this.pos++]<128)return Ot}throw Error("invalid varint encoding")}bt.prototype.bool=function(){return this.uint32()!==0};function Rt(Ot,Nt){return(Ot[Nt-4]|Ot[Nt-3]<<8|Ot[Nt-2]<<16|Ot[Nt-1]<<24)>>>0}bt.prototype.fixed32=function(){if(this.pos+4>this.len)throw gt(this,4);return Rt(this.buf,this.pos+=4)},bt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw gt(this,4);return Rt(this.buf,this.pos+=4)|0};function Mt(){if(this.pos+8>this.len)throw gt(this,8);return new mt(Rt(this.buf,this.pos+=4),Rt(this.buf,this.pos+=4))}bt.prototype.float=function(){if(this.pos+4>this.len)throw gt(this,4);var Ot=lt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,Ot},bt.prototype.double=function(){if(this.pos+8>this.len)throw gt(this,4);var Ot=lt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,Ot},bt.prototype.bytes=function(){var Ot=this.uint32(),Nt=this.pos,Ht=this.pos+Ot;if(Ht>this.len)throw gt(this,Ot);if(this.pos+=Ot,Array.isArray(this.buf))return this.buf.slice(Nt,Ht);if(Nt===Ht){var Kt=lt.Buffer;return Kt?Kt.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,Nt,Ht)},bt.prototype.string=function(){var Ot=this.bytes();return pt.read(Ot,0,Ot.length)},bt.prototype.skip=function(Ot){if(typeof Ot=="number"){if(this.pos+Ot>this.len)throw gt(this,Ot);this.pos+=Ot}else do if(this.pos>=this.len)throw gt(this);while(this.buf[this.pos++]&128);return this},bt.prototype.skipType=function(Ot){switch(Ot){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(Ot=this.uint32()&7)!==4;)this.skipType(Ot);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+Ot+" at offset "+this.pos)}return this},bt._configure=function(Ot){ft=Ot,bt.create=vt(),ft._configure();var Nt=lt.Long?"toLong":"toNumber";lt.merge(bt.prototype,{int64:function(){return Ct.call(this)[Nt](!1)},uint64:function(){return Ct.call(this)[Nt](!0)},sint64:function(){return Ct.call(this).zzDecode()[Nt](!1)},fixed64:function(){return Mt.call(this)[Nt](!0)},sfixed64:function(){return Mt.call(this)[Nt](!1)}})}}),Ca=tt((it,_)=>{_.exports=mt;var lt=no();(mt.prototype=Object.create(lt.prototype)).constructor=mt;var ft=te();function mt(pt){lt.call(this,pt)}mt._configure=function(){ft.Buffer&&(mt.prototype._slice=ft.Buffer.prototype.slice)},mt.prototype.string=function(){var pt=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+pt,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+pt,this.len))},mt._configure()}),Ga=tt((it,_)=>{_.exports=ft;var lt=te();(ft.prototype=Object.create(lt.EventEmitter.prototype)).constructor=ft;function ft(mt,pt,gt){if(typeof mt!="function")throw TypeError("rpcImpl must be a function");lt.EventEmitter.call(this),this.rpcImpl=mt,this.requestDelimited=!!pt,this.responseDelimited=!!gt}ft.prototype.rpcCall=function mt(pt,gt,bt,wt,vt){if(!wt)throw TypeError("request must be specified");var Ct=this;if(!vt)return lt.asPromise(mt,Ct,pt,gt,bt,wt);if(!Ct.rpcImpl){setTimeout(function(){vt(Error("already ended"))},0);return}try{return Ct.rpcImpl(pt,gt[Ct.requestDelimited?"encodeDelimited":"encode"](wt).finish(),function(Rt,Mt){if(Rt)return Ct.emit("error",Rt,pt),vt(Rt);if(Mt===null){Ct.end(!0);return}if(!(Mt instanceof bt))try{Mt=bt[Ct.responseDelimited?"decodeDelimited":"decode"](Mt)}catch(Ot){return Ct.emit("error",Ot,pt),vt(Ot)}return Ct.emit("data",Mt,pt),vt(null,Mt)})}catch(Rt){Ct.emit("error",Rt,pt),setTimeout(function(){vt(Rt)},0);return}},ft.prototype.end=function(mt){return this.rpcImpl&&(mt||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}}),Va=tt(it=>{var _=it;_.Service=Ga()}),za=tt((it,_)=>{_.exports={}}),qa=tt(it=>{var _=it;_.build="minimal",_.Writer=to(),_.BufferWriter=Pa(),_.Reader=no(),_.BufferReader=Ca(),_.util=te(),_.rpc=Va(),_.roots=za(),_.configure=lt;function lt(){_.util._configure(),_.Writer._configure(_.BufferWriter),_.Reader._configure(_.BufferReader)}lt()}),Xa=tt((it,_)=>{_.exports=qa()}),Le=tt((it,_)=>{var lt=Xa(),ft=lt.Reader,mt=lt.Writer,pt=lt.util,gt=lt.roots.default||(lt.roots.default={});gt.onnx=function(){var bt={};return bt.Version=function(){var wt={},vt=Object.create(wt);return vt[wt[0]="_START_VERSION"]=0,vt[wt[1]="IR_VERSION_2017_10_10"]=1,vt[wt[2]="IR_VERSION_2017_10_30"]=2,vt[wt[3]="IR_VERSION_2017_11_3"]=3,vt[wt[4]="IR_VERSION_2019_1_22"]=4,vt[wt[5]="IR_VERSION_2019_3_18"]=5,vt[wt[6]="IR_VERSION_2019_9_19"]=6,vt[wt[7]="IR_VERSION_2020_5_8"]=7,vt[wt[8]="IR_VERSION_2021_7_30"]=8,vt[wt[9]="IR_VERSION"]=9,vt}(),bt.AttributeProto=function(){function wt(vt){if(this.floats=[],this.ints=[],this.strings=[],this.tensors=[],this.graphs=[],this.sparseTensors=[],this.typeProtos=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.name="",wt.prototype.refAttrName="",wt.prototype.docString="",wt.prototype.type=0,wt.prototype.f=0,wt.prototype.i=pt.Long?pt.Long.fromBits(0,0,!1):0,wt.prototype.s=pt.newBuffer([]),wt.prototype.t=null,wt.prototype.g=null,wt.prototype.sparseTensor=null,wt.prototype.tp=null,wt.prototype.floats=pt.emptyArray,wt.prototype.ints=pt.emptyArray,wt.prototype.strings=pt.emptyArray,wt.prototype.tensors=pt.emptyArray,wt.prototype.graphs=pt.emptyArray,wt.prototype.sparseTensors=pt.emptyArray,wt.prototype.typeProtos=pt.emptyArray,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.name!=null&&Object.hasOwnProperty.call(vt,"name")&&Ct.uint32(10).string(vt.name),vt.f!=null&&Object.hasOwnProperty.call(vt,"f")&&Ct.uint32(21).float(vt.f),vt.i!=null&&Object.hasOwnProperty.call(vt,"i")&&Ct.uint32(24).int64(vt.i),vt.s!=null&&Object.hasOwnProperty.call(vt,"s")&&Ct.uint32(34).bytes(vt.s),vt.t!=null&&Object.hasOwnProperty.call(vt,"t")&&gt.onnx.TensorProto.encode(vt.t,Ct.uint32(42).fork()).ldelim(),vt.g!=null&&Object.hasOwnProperty.call(vt,"g")&&gt.onnx.GraphProto.encode(vt.g,Ct.uint32(50).fork()).ldelim(),vt.floats!=null&&vt.floats.length){Ct.uint32(58).fork();for(var Rt=0;Rt<vt.floats.length;++Rt)Ct.float(vt.floats[Rt]);Ct.ldelim()}if(vt.ints!=null&&vt.ints.length){Ct.uint32(66).fork();for(var Rt=0;Rt<vt.ints.length;++Rt)Ct.int64(vt.ints[Rt]);Ct.ldelim()}if(vt.strings!=null&&vt.strings.length)for(var Rt=0;Rt<vt.strings.length;++Rt)Ct.uint32(74).bytes(vt.strings[Rt]);if(vt.tensors!=null&&vt.tensors.length)for(var Rt=0;Rt<vt.tensors.length;++Rt)gt.onnx.TensorProto.encode(vt.tensors[Rt],Ct.uint32(82).fork()).ldelim();if(vt.graphs!=null&&vt.graphs.length)for(var Rt=0;Rt<vt.graphs.length;++Rt)gt.onnx.GraphProto.encode(vt.graphs[Rt],Ct.uint32(90).fork()).ldelim();if(vt.docString!=null&&Object.hasOwnProperty.call(vt,"docString")&&Ct.uint32(106).string(vt.docString),vt.tp!=null&&Object.hasOwnProperty.call(vt,"tp")&&gt.onnx.TypeProto.encode(vt.tp,Ct.uint32(114).fork()).ldelim(),vt.typeProtos!=null&&vt.typeProtos.length)for(var Rt=0;Rt<vt.typeProtos.length;++Rt)gt.onnx.TypeProto.encode(vt.typeProtos[Rt],Ct.uint32(122).fork()).ldelim();if(vt.type!=null&&Object.hasOwnProperty.call(vt,"type")&&Ct.uint32(160).int32(vt.type),vt.refAttrName!=null&&Object.hasOwnProperty.call(vt,"refAttrName")&&Ct.uint32(170).string(vt.refAttrName),vt.sparseTensor!=null&&Object.hasOwnProperty.call(vt,"sparseTensor")&&gt.onnx.SparseTensorProto.encode(vt.sparseTensor,Ct.uint32(178).fork()).ldelim(),vt.sparseTensors!=null&&vt.sparseTensors.length)for(var Rt=0;Rt<vt.sparseTensors.length;++Rt)gt.onnx.SparseTensorProto.encode(vt.sparseTensors[Rt],Ct.uint32(186).fork()).ldelim();return Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.AttributeProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.name=vt.string();break}case 21:{Mt.refAttrName=vt.string();break}case 13:{Mt.docString=vt.string();break}case 20:{Mt.type=vt.int32();break}case 2:{Mt.f=vt.float();break}case 3:{Mt.i=vt.int64();break}case 4:{Mt.s=vt.bytes();break}case 5:{Mt.t=gt.onnx.TensorProto.decode(vt,vt.uint32());break}case 6:{Mt.g=gt.onnx.GraphProto.decode(vt,vt.uint32());break}case 22:{Mt.sparseTensor=gt.onnx.SparseTensorProto.decode(vt,vt.uint32());break}case 14:{Mt.tp=gt.onnx.TypeProto.decode(vt,vt.uint32());break}case 7:{if(Mt.floats&&Mt.floats.length||(Mt.floats=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.floats.push(vt.float());else Mt.floats.push(vt.float());break}case 8:{if(Mt.ints&&Mt.ints.length||(Mt.ints=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.ints.push(vt.int64());else Mt.ints.push(vt.int64());break}case 9:{Mt.strings&&Mt.strings.length||(Mt.strings=[]),Mt.strings.push(vt.bytes());break}case 10:{Mt.tensors&&Mt.tensors.length||(Mt.tensors=[]),Mt.tensors.push(gt.onnx.TensorProto.decode(vt,vt.uint32()));break}case 11:{Mt.graphs&&Mt.graphs.length||(Mt.graphs=[]),Mt.graphs.push(gt.onnx.GraphProto.decode(vt,vt.uint32()));break}case 23:{Mt.sparseTensors&&Mt.sparseTensors.length||(Mt.sparseTensors=[]),Mt.sparseTensors.push(gt.onnx.SparseTensorProto.decode(vt,vt.uint32()));break}case 15:{Mt.typeProtos&&Mt.typeProtos.length||(Mt.typeProtos=[]),Mt.typeProtos.push(gt.onnx.TypeProto.decode(vt,vt.uint32()));break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.name!=null&&vt.hasOwnProperty("name")&&!pt.isString(vt.name))return"name: string expected";if(vt.refAttrName!=null&&vt.hasOwnProperty("refAttrName")&&!pt.isString(vt.refAttrName))return"refAttrName: string expected";if(vt.docString!=null&&vt.hasOwnProperty("docString")&&!pt.isString(vt.docString))return"docString: string expected";if(vt.type!=null&&vt.hasOwnProperty("type"))switch(vt.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 11:case 13:case 6:case 7:case 8:case 9:case 10:case 12:case 14:break}if(vt.f!=null&&vt.hasOwnProperty("f")&&typeof vt.f!="number")return"f: number expected";if(vt.i!=null&&vt.hasOwnProperty("i")&&!pt.isInteger(vt.i)&&!(vt.i&&pt.isInteger(vt.i.low)&&pt.isInteger(vt.i.high)))return"i: integer|Long expected";if(vt.s!=null&&vt.hasOwnProperty("s")&&!(vt.s&&typeof vt.s.length=="number"||pt.isString(vt.s)))return"s: buffer expected";if(vt.t!=null&&vt.hasOwnProperty("t")){var Ct=gt.onnx.TensorProto.verify(vt.t);if(Ct)return"t."+Ct}if(vt.g!=null&&vt.hasOwnProperty("g")){var Ct=gt.onnx.GraphProto.verify(vt.g);if(Ct)return"g."+Ct}if(vt.sparseTensor!=null&&vt.hasOwnProperty("sparseTensor")){var Ct=gt.onnx.SparseTensorProto.verify(vt.sparseTensor);if(Ct)return"sparseTensor."+Ct}if(vt.tp!=null&&vt.hasOwnProperty("tp")){var Ct=gt.onnx.TypeProto.verify(vt.tp);if(Ct)return"tp."+Ct}if(vt.floats!=null&&vt.hasOwnProperty("floats")){if(!Array.isArray(vt.floats))return"floats: array expected";for(var Rt=0;Rt<vt.floats.length;++Rt)if(typeof vt.floats[Rt]!="number")return"floats: number[] expected"}if(vt.ints!=null&&vt.hasOwnProperty("ints")){if(!Array.isArray(vt.ints))return"ints: array expected";for(var Rt=0;Rt<vt.ints.length;++Rt)if(!pt.isInteger(vt.ints[Rt])&&!(vt.ints[Rt]&&pt.isInteger(vt.ints[Rt].low)&&pt.isInteger(vt.ints[Rt].high)))return"ints: integer|Long[] expected"}if(vt.strings!=null&&vt.hasOwnProperty("strings")){if(!Array.isArray(vt.strings))return"strings: array expected";for(var Rt=0;Rt<vt.strings.length;++Rt)if(!(vt.strings[Rt]&&typeof vt.strings[Rt].length=="number"||pt.isString(vt.strings[Rt])))return"strings: buffer[] expected"}if(vt.tensors!=null&&vt.hasOwnProperty("tensors")){if(!Array.isArray(vt.tensors))return"tensors: array expected";for(var Rt=0;Rt<vt.tensors.length;++Rt){var Ct=gt.onnx.TensorProto.verify(vt.tensors[Rt]);if(Ct)return"tensors."+Ct}}if(vt.graphs!=null&&vt.hasOwnProperty("graphs")){if(!Array.isArray(vt.graphs))return"graphs: array expected";for(var Rt=0;Rt<vt.graphs.length;++Rt){var Ct=gt.onnx.GraphProto.verify(vt.graphs[Rt]);if(Ct)return"graphs."+Ct}}if(vt.sparseTensors!=null&&vt.hasOwnProperty("sparseTensors")){if(!Array.isArray(vt.sparseTensors))return"sparseTensors: array expected";for(var Rt=0;Rt<vt.sparseTensors.length;++Rt){var Ct=gt.onnx.SparseTensorProto.verify(vt.sparseTensors[Rt]);if(Ct)return"sparseTensors."+Ct}}if(vt.typeProtos!=null&&vt.hasOwnProperty("typeProtos")){if(!Array.isArray(vt.typeProtos))return"typeProtos: array expected";for(var Rt=0;Rt<vt.typeProtos.length;++Rt){var Ct=gt.onnx.TypeProto.verify(vt.typeProtos[Rt]);if(Ct)return"typeProtos."+Ct}}return null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.AttributeProto)return vt;var Ct=new gt.onnx.AttributeProto;switch(vt.name!=null&&(Ct.name=String(vt.name)),vt.refAttrName!=null&&(Ct.refAttrName=String(vt.refAttrName)),vt.docString!=null&&(Ct.docString=String(vt.docString)),vt.type){default:if(typeof vt.type=="number"){Ct.type=vt.type;break}break;case"UNDEFINED":case 0:Ct.type=0;break;case"FLOAT":case 1:Ct.type=1;break;case"INT":case 2:Ct.type=2;break;case"STRING":case 3:Ct.type=3;break;case"TENSOR":case 4:Ct.type=4;break;case"GRAPH":case 5:Ct.type=5;break;case"SPARSE_TENSOR":case 11:Ct.type=11;break;case"TYPE_PROTO":case 13:Ct.type=13;break;case"FLOATS":case 6:Ct.type=6;break;case"INTS":case 7:Ct.type=7;break;case"STRINGS":case 8:Ct.type=8;break;case"TENSORS":case 9:Ct.type=9;break;case"GRAPHS":case 10:Ct.type=10;break;case"SPARSE_TENSORS":case 12:Ct.type=12;break;case"TYPE_PROTOS":case 14:Ct.type=14;break}if(vt.f!=null&&(Ct.f=Number(vt.f)),vt.i!=null&&(pt.Long?(Ct.i=pt.Long.fromValue(vt.i)).unsigned=!1:typeof vt.i=="string"?Ct.i=parseInt(vt.i,10):typeof vt.i=="number"?Ct.i=vt.i:typeof vt.i=="object"&&(Ct.i=new pt.LongBits(vt.i.low>>>0,vt.i.high>>>0).toNumber())),vt.s!=null&&(typeof vt.s=="string"?pt.base64.decode(vt.s,Ct.s=pt.newBuffer(pt.base64.length(vt.s)),0):vt.s.length>=0&&(Ct.s=vt.s)),vt.t!=null){if(typeof vt.t!="object")throw TypeError(".onnx.AttributeProto.t: object expected");Ct.t=gt.onnx.TensorProto.fromObject(vt.t)}if(vt.g!=null){if(typeof vt.g!="object")throw TypeError(".onnx.AttributeProto.g: object expected");Ct.g=gt.onnx.GraphProto.fromObject(vt.g)}if(vt.sparseTensor!=null){if(typeof vt.sparseTensor!="object")throw TypeError(".onnx.AttributeProto.sparseTensor: object expected");Ct.sparseTensor=gt.onnx.SparseTensorProto.fromObject(vt.sparseTensor)}if(vt.tp!=null){if(typeof vt.tp!="object")throw TypeError(".onnx.AttributeProto.tp: object expected");Ct.tp=gt.onnx.TypeProto.fromObject(vt.tp)}if(vt.floats){if(!Array.isArray(vt.floats))throw TypeError(".onnx.AttributeProto.floats: array expected");Ct.floats=[];for(var Rt=0;Rt<vt.floats.length;++Rt)Ct.floats[Rt]=Number(vt.floats[Rt])}if(vt.ints){if(!Array.isArray(vt.ints))throw TypeError(".onnx.AttributeProto.ints: array expected");Ct.ints=[];for(var Rt=0;Rt<vt.ints.length;++Rt)pt.Long?(Ct.ints[Rt]=pt.Long.fromValue(vt.ints[Rt])).unsigned=!1:typeof vt.ints[Rt]=="string"?Ct.ints[Rt]=parseInt(vt.ints[Rt],10):typeof vt.ints[Rt]=="number"?Ct.ints[Rt]=vt.ints[Rt]:typeof vt.ints[Rt]=="object"&&(Ct.ints[Rt]=new pt.LongBits(vt.ints[Rt].low>>>0,vt.ints[Rt].high>>>0).toNumber())}if(vt.strings){if(!Array.isArray(vt.strings))throw TypeError(".onnx.AttributeProto.strings: array expected");Ct.strings=[];for(var Rt=0;Rt<vt.strings.length;++Rt)typeof vt.strings[Rt]=="string"?pt.base64.decode(vt.strings[Rt],Ct.strings[Rt]=pt.newBuffer(pt.base64.length(vt.strings[Rt])),0):vt.strings[Rt].length>=0&&(Ct.strings[Rt]=vt.strings[Rt])}if(vt.tensors){if(!Array.isArray(vt.tensors))throw TypeError(".onnx.AttributeProto.tensors: array expected");Ct.tensors=[];for(var Rt=0;Rt<vt.tensors.length;++Rt){if(typeof vt.tensors[Rt]!="object")throw TypeError(".onnx.AttributeProto.tensors: object expected");Ct.tensors[Rt]=gt.onnx.TensorProto.fromObject(vt.tensors[Rt])}}if(vt.graphs){if(!Array.isArray(vt.graphs))throw TypeError(".onnx.AttributeProto.graphs: array expected");Ct.graphs=[];for(var Rt=0;Rt<vt.graphs.length;++Rt){if(typeof vt.graphs[Rt]!="object")throw TypeError(".onnx.AttributeProto.graphs: object expected");Ct.graphs[Rt]=gt.onnx.GraphProto.fromObject(vt.graphs[Rt])}}if(vt.sparseTensors){if(!Array.isArray(vt.sparseTensors))throw TypeError(".onnx.AttributeProto.sparseTensors: array expected");Ct.sparseTensors=[];for(var Rt=0;Rt<vt.sparseTensors.length;++Rt){if(typeof vt.sparseTensors[Rt]!="object")throw TypeError(".onnx.AttributeProto.sparseTensors: object expected");Ct.sparseTensors[Rt]=gt.onnx.SparseTensorProto.fromObject(vt.sparseTensors[Rt])}}if(vt.typeProtos){if(!Array.isArray(vt.typeProtos))throw TypeError(".onnx.AttributeProto.typeProtos: array expected");Ct.typeProtos=[];for(var Rt=0;Rt<vt.typeProtos.length;++Rt){if(typeof vt.typeProtos[Rt]!="object")throw TypeError(".onnx.AttributeProto.typeProtos: object expected");Ct.typeProtos[Rt]=gt.onnx.TypeProto.fromObject(vt.typeProtos[Rt])}}return Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.floats=[],Rt.ints=[],Rt.strings=[],Rt.tensors=[],Rt.graphs=[],Rt.typeProtos=[],Rt.sparseTensors=[]),Ct.defaults){if(Rt.name="",Rt.f=0,pt.Long){var Mt=new pt.Long(0,0,!1);Rt.i=Ct.longs===String?Mt.toString():Ct.longs===Number?Mt.toNumber():Mt}else Rt.i=Ct.longs===String?"0":0;Ct.bytes===String?Rt.s="":(Rt.s=[],Ct.bytes!==Array&&(Rt.s=pt.newBuffer(Rt.s))),Rt.t=null,Rt.g=null,Rt.docString="",Rt.tp=null,Rt.type=Ct.enums===String?"UNDEFINED":0,Rt.refAttrName="",Rt.sparseTensor=null}if(vt.name!=null&&vt.hasOwnProperty("name")&&(Rt.name=vt.name),vt.f!=null&&vt.hasOwnProperty("f")&&(Rt.f=Ct.json&&!isFinite(vt.f)?String(vt.f):vt.f),vt.i!=null&&vt.hasOwnProperty("i")&&(typeof vt.i=="number"?Rt.i=Ct.longs===String?String(vt.i):vt.i:Rt.i=Ct.longs===String?pt.Long.prototype.toString.call(vt.i):Ct.longs===Number?new pt.LongBits(vt.i.low>>>0,vt.i.high>>>0).toNumber():vt.i),vt.s!=null&&vt.hasOwnProperty("s")&&(Rt.s=Ct.bytes===String?pt.base64.encode(vt.s,0,vt.s.length):Ct.bytes===Array?Array.prototype.slice.call(vt.s):vt.s),vt.t!=null&&vt.hasOwnProperty("t")&&(Rt.t=gt.onnx.TensorProto.toObject(vt.t,Ct)),vt.g!=null&&vt.hasOwnProperty("g")&&(Rt.g=gt.onnx.GraphProto.toObject(vt.g,Ct)),vt.floats&&vt.floats.length){Rt.floats=[];for(var Ot=0;Ot<vt.floats.length;++Ot)Rt.floats[Ot]=Ct.json&&!isFinite(vt.floats[Ot])?String(vt.floats[Ot]):vt.floats[Ot]}if(vt.ints&&vt.ints.length){Rt.ints=[];for(var Ot=0;Ot<vt.ints.length;++Ot)typeof vt.ints[Ot]=="number"?Rt.ints[Ot]=Ct.longs===String?String(vt.ints[Ot]):vt.ints[Ot]:Rt.ints[Ot]=Ct.longs===String?pt.Long.prototype.toString.call(vt.ints[Ot]):Ct.longs===Number?new pt.LongBits(vt.ints[Ot].low>>>0,vt.ints[Ot].high>>>0).toNumber():vt.ints[Ot]}if(vt.strings&&vt.strings.length){Rt.strings=[];for(var Ot=0;Ot<vt.strings.length;++Ot)Rt.strings[Ot]=Ct.bytes===String?pt.base64.encode(vt.strings[Ot],0,vt.strings[Ot].length):Ct.bytes===Array?Array.prototype.slice.call(vt.strings[Ot]):vt.strings[Ot]}if(vt.tensors&&vt.tensors.length){Rt.tensors=[];for(var Ot=0;Ot<vt.tensors.length;++Ot)Rt.tensors[Ot]=gt.onnx.TensorProto.toObject(vt.tensors[Ot],Ct)}if(vt.graphs&&vt.graphs.length){Rt.graphs=[];for(var Ot=0;Ot<vt.graphs.length;++Ot)Rt.graphs[Ot]=gt.onnx.GraphProto.toObject(vt.graphs[Ot],Ct)}if(vt.docString!=null&&vt.hasOwnProperty("docString")&&(Rt.docString=vt.docString),vt.tp!=null&&vt.hasOwnProperty("tp")&&(Rt.tp=gt.onnx.TypeProto.toObject(vt.tp,Ct)),vt.typeProtos&&vt.typeProtos.length){Rt.typeProtos=[];for(var Ot=0;Ot<vt.typeProtos.length;++Ot)Rt.typeProtos[Ot]=gt.onnx.TypeProto.toObject(vt.typeProtos[Ot],Ct)}if(vt.type!=null&&vt.hasOwnProperty("type")&&(Rt.type=Ct.enums===String?gt.onnx.AttributeProto.AttributeType[vt.type]===void 0?vt.type:gt.onnx.AttributeProto.AttributeType[vt.type]:vt.type),vt.refAttrName!=null&&vt.hasOwnProperty("refAttrName")&&(Rt.refAttrName=vt.refAttrName),vt.sparseTensor!=null&&vt.hasOwnProperty("sparseTensor")&&(Rt.sparseTensor=gt.onnx.SparseTensorProto.toObject(vt.sparseTensor,Ct)),vt.sparseTensors&&vt.sparseTensors.length){Rt.sparseTensors=[];for(var Ot=0;Ot<vt.sparseTensors.length;++Ot)Rt.sparseTensors[Ot]=gt.onnx.SparseTensorProto.toObject(vt.sparseTensors[Ot],Ct)}return Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.AttributeProto"},wt.AttributeType=function(){var vt={},Ct=Object.create(vt);return Ct[vt[0]="UNDEFINED"]=0,Ct[vt[1]="FLOAT"]=1,Ct[vt[2]="INT"]=2,Ct[vt[3]="STRING"]=3,Ct[vt[4]="TENSOR"]=4,Ct[vt[5]="GRAPH"]=5,Ct[vt[11]="SPARSE_TENSOR"]=11,Ct[vt[13]="TYPE_PROTO"]=13,Ct[vt[6]="FLOATS"]=6,Ct[vt[7]="INTS"]=7,Ct[vt[8]="STRINGS"]=8,Ct[vt[9]="TENSORS"]=9,Ct[vt[10]="GRAPHS"]=10,Ct[vt[12]="SPARSE_TENSORS"]=12,Ct[vt[14]="TYPE_PROTOS"]=14,Ct}(),wt}(),bt.ValueInfoProto=function(){function wt(vt){if(vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.name="",wt.prototype.type=null,wt.prototype.docString="",wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){return Ct||(Ct=mt.create()),vt.name!=null&&Object.hasOwnProperty.call(vt,"name")&&Ct.uint32(10).string(vt.name),vt.type!=null&&Object.hasOwnProperty.call(vt,"type")&&gt.onnx.TypeProto.encode(vt.type,Ct.uint32(18).fork()).ldelim(),vt.docString!=null&&Object.hasOwnProperty.call(vt,"docString")&&Ct.uint32(26).string(vt.docString),Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.ValueInfoProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.name=vt.string();break}case 2:{Mt.type=gt.onnx.TypeProto.decode(vt,vt.uint32());break}case 3:{Mt.docString=vt.string();break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.name!=null&&vt.hasOwnProperty("name")&&!pt.isString(vt.name))return"name: string expected";if(vt.type!=null&&vt.hasOwnProperty("type")){var Ct=gt.onnx.TypeProto.verify(vt.type);if(Ct)return"type."+Ct}return vt.docString!=null&&vt.hasOwnProperty("docString")&&!pt.isString(vt.docString)?"docString: string expected":null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.ValueInfoProto)return vt;var Ct=new gt.onnx.ValueInfoProto;if(vt.name!=null&&(Ct.name=String(vt.name)),vt.type!=null){if(typeof vt.type!="object")throw TypeError(".onnx.ValueInfoProto.type: object expected");Ct.type=gt.onnx.TypeProto.fromObject(vt.type)}return vt.docString!=null&&(Ct.docString=String(vt.docString)),Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};return Ct.defaults&&(Rt.name="",Rt.type=null,Rt.docString=""),vt.name!=null&&vt.hasOwnProperty("name")&&(Rt.name=vt.name),vt.type!=null&&vt.hasOwnProperty("type")&&(Rt.type=gt.onnx.TypeProto.toObject(vt.type,Ct)),vt.docString!=null&&vt.hasOwnProperty("docString")&&(Rt.docString=vt.docString),Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.ValueInfoProto"},wt}(),bt.NodeProto=function(){function wt(vt){if(this.input=[],this.output=[],this.attribute=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.input=pt.emptyArray,wt.prototype.output=pt.emptyArray,wt.prototype.name="",wt.prototype.opType="",wt.prototype.domain="",wt.prototype.attribute=pt.emptyArray,wt.prototype.docString="",wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.input!=null&&vt.input.length)for(var Rt=0;Rt<vt.input.length;++Rt)Ct.uint32(10).string(vt.input[Rt]);if(vt.output!=null&&vt.output.length)for(var Rt=0;Rt<vt.output.length;++Rt)Ct.uint32(18).string(vt.output[Rt]);if(vt.name!=null&&Object.hasOwnProperty.call(vt,"name")&&Ct.uint32(26).string(vt.name),vt.opType!=null&&Object.hasOwnProperty.call(vt,"opType")&&Ct.uint32(34).string(vt.opType),vt.attribute!=null&&vt.attribute.length)for(var Rt=0;Rt<vt.attribute.length;++Rt)gt.onnx.AttributeProto.encode(vt.attribute[Rt],Ct.uint32(42).fork()).ldelim();return vt.docString!=null&&Object.hasOwnProperty.call(vt,"docString")&&Ct.uint32(50).string(vt.docString),vt.domain!=null&&Object.hasOwnProperty.call(vt,"domain")&&Ct.uint32(58).string(vt.domain),Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.NodeProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.input&&Mt.input.length||(Mt.input=[]),Mt.input.push(vt.string());break}case 2:{Mt.output&&Mt.output.length||(Mt.output=[]),Mt.output.push(vt.string());break}case 3:{Mt.name=vt.string();break}case 4:{Mt.opType=vt.string();break}case 7:{Mt.domain=vt.string();break}case 5:{Mt.attribute&&Mt.attribute.length||(Mt.attribute=[]),Mt.attribute.push(gt.onnx.AttributeProto.decode(vt,vt.uint32()));break}case 6:{Mt.docString=vt.string();break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.input!=null&&vt.hasOwnProperty("input")){if(!Array.isArray(vt.input))return"input: array expected";for(var Ct=0;Ct<vt.input.length;++Ct)if(!pt.isString(vt.input[Ct]))return"input: string[] expected"}if(vt.output!=null&&vt.hasOwnProperty("output")){if(!Array.isArray(vt.output))return"output: array expected";for(var Ct=0;Ct<vt.output.length;++Ct)if(!pt.isString(vt.output[Ct]))return"output: string[] expected"}if(vt.name!=null&&vt.hasOwnProperty("name")&&!pt.isString(vt.name))return"name: string expected";if(vt.opType!=null&&vt.hasOwnProperty("opType")&&!pt.isString(vt.opType))return"opType: string expected";if(vt.domain!=null&&vt.hasOwnProperty("domain")&&!pt.isString(vt.domain))return"domain: string expected";if(vt.attribute!=null&&vt.hasOwnProperty("attribute")){if(!Array.isArray(vt.attribute))return"attribute: array expected";for(var Ct=0;Ct<vt.attribute.length;++Ct){var Rt=gt.onnx.AttributeProto.verify(vt.attribute[Ct]);if(Rt)return"attribute."+Rt}}return vt.docString!=null&&vt.hasOwnProperty("docString")&&!pt.isString(vt.docString)?"docString: string expected":null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.NodeProto)return vt;var Ct=new gt.onnx.NodeProto;if(vt.input){if(!Array.isArray(vt.input))throw TypeError(".onnx.NodeProto.input: array expected");Ct.input=[];for(var Rt=0;Rt<vt.input.length;++Rt)Ct.input[Rt]=String(vt.input[Rt])}if(vt.output){if(!Array.isArray(vt.output))throw TypeError(".onnx.NodeProto.output: array expected");Ct.output=[];for(var Rt=0;Rt<vt.output.length;++Rt)Ct.output[Rt]=String(vt.output[Rt])}if(vt.name!=null&&(Ct.name=String(vt.name)),vt.opType!=null&&(Ct.opType=String(vt.opType)),vt.domain!=null&&(Ct.domain=String(vt.domain)),vt.attribute){if(!Array.isArray(vt.attribute))throw TypeError(".onnx.NodeProto.attribute: array expected");Ct.attribute=[];for(var Rt=0;Rt<vt.attribute.length;++Rt){if(typeof vt.attribute[Rt]!="object")throw TypeError(".onnx.NodeProto.attribute: object expected");Ct.attribute[Rt]=gt.onnx.AttributeProto.fromObject(vt.attribute[Rt])}}return vt.docString!=null&&(Ct.docString=String(vt.docString)),Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.input=[],Rt.output=[],Rt.attribute=[]),Ct.defaults&&(Rt.name="",Rt.opType="",Rt.docString="",Rt.domain=""),vt.input&&vt.input.length){Rt.input=[];for(var Mt=0;Mt<vt.input.length;++Mt)Rt.input[Mt]=vt.input[Mt]}if(vt.output&&vt.output.length){Rt.output=[];for(var Mt=0;Mt<vt.output.length;++Mt)Rt.output[Mt]=vt.output[Mt]}if(vt.name!=null&&vt.hasOwnProperty("name")&&(Rt.name=vt.name),vt.opType!=null&&vt.hasOwnProperty("opType")&&(Rt.opType=vt.opType),vt.attribute&&vt.attribute.length){Rt.attribute=[];for(var Mt=0;Mt<vt.attribute.length;++Mt)Rt.attribute[Mt]=gt.onnx.AttributeProto.toObject(vt.attribute[Mt],Ct)}return vt.docString!=null&&vt.hasOwnProperty("docString")&&(Rt.docString=vt.docString),vt.domain!=null&&vt.hasOwnProperty("domain")&&(Rt.domain=vt.domain),Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.NodeProto"},wt}(),bt.TrainingInfoProto=function(){function wt(vt){if(this.initializationBinding=[],this.updateBinding=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.initialization=null,wt.prototype.algorithm=null,wt.prototype.initializationBinding=pt.emptyArray,wt.prototype.updateBinding=pt.emptyArray,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.initialization!=null&&Object.hasOwnProperty.call(vt,"initialization")&&gt.onnx.GraphProto.encode(vt.initialization,Ct.uint32(10).fork()).ldelim(),vt.algorithm!=null&&Object.hasOwnProperty.call(vt,"algorithm")&&gt.onnx.GraphProto.encode(vt.algorithm,Ct.uint32(18).fork()).ldelim(),vt.initializationBinding!=null&&vt.initializationBinding.length)for(var Rt=0;Rt<vt.initializationBinding.length;++Rt)gt.onnx.StringStringEntryProto.encode(vt.initializationBinding[Rt],Ct.uint32(26).fork()).ldelim();if(vt.updateBinding!=null&&vt.updateBinding.length)for(var Rt=0;Rt<vt.updateBinding.length;++Rt)gt.onnx.StringStringEntryProto.encode(vt.updateBinding[Rt],Ct.uint32(34).fork()).ldelim();return Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.TrainingInfoProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.initialization=gt.onnx.GraphProto.decode(vt,vt.uint32());break}case 2:{Mt.algorithm=gt.onnx.GraphProto.decode(vt,vt.uint32());break}case 3:{Mt.initializationBinding&&Mt.initializationBinding.length||(Mt.initializationBinding=[]),Mt.initializationBinding.push(gt.onnx.StringStringEntryProto.decode(vt,vt.uint32()));break}case 4:{Mt.updateBinding&&Mt.updateBinding.length||(Mt.updateBinding=[]),Mt.updateBinding.push(gt.onnx.StringStringEntryProto.decode(vt,vt.uint32()));break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.initialization!=null&&vt.hasOwnProperty("initialization")){var Ct=gt.onnx.GraphProto.verify(vt.initialization);if(Ct)return"initialization."+Ct}if(vt.algorithm!=null&&vt.hasOwnProperty("algorithm")){var Ct=gt.onnx.GraphProto.verify(vt.algorithm);if(Ct)return"algorithm."+Ct}if(vt.initializationBinding!=null&&vt.hasOwnProperty("initializationBinding")){if(!Array.isArray(vt.initializationBinding))return"initializationBinding: array expected";for(var Rt=0;Rt<vt.initializationBinding.length;++Rt){var Ct=gt.onnx.StringStringEntryProto.verify(vt.initializationBinding[Rt]);if(Ct)return"initializationBinding."+Ct}}if(vt.updateBinding!=null&&vt.hasOwnProperty("updateBinding")){if(!Array.isArray(vt.updateBinding))return"updateBinding: array expected";for(var Rt=0;Rt<vt.updateBinding.length;++Rt){var Ct=gt.onnx.StringStringEntryProto.verify(vt.updateBinding[Rt]);if(Ct)return"updateBinding."+Ct}}return null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.TrainingInfoProto)return vt;var Ct=new gt.onnx.TrainingInfoProto;if(vt.initialization!=null){if(typeof vt.initialization!="object")throw TypeError(".onnx.TrainingInfoProto.initialization: object expected");Ct.initialization=gt.onnx.GraphProto.fromObject(vt.initialization)}if(vt.algorithm!=null){if(typeof vt.algorithm!="object")throw TypeError(".onnx.TrainingInfoProto.algorithm: object expected");Ct.algorithm=gt.onnx.GraphProto.fromObject(vt.algorithm)}if(vt.initializationBinding){if(!Array.isArray(vt.initializationBinding))throw TypeError(".onnx.TrainingInfoProto.initializationBinding: array expected");Ct.initializationBinding=[];for(var Rt=0;Rt<vt.initializationBinding.length;++Rt){if(typeof vt.initializationBinding[Rt]!="object")throw TypeError(".onnx.TrainingInfoProto.initializationBinding: object expected");Ct.initializationBinding[Rt]=gt.onnx.StringStringEntryProto.fromObject(vt.initializationBinding[Rt])}}if(vt.updateBinding){if(!Array.isArray(vt.updateBinding))throw TypeError(".onnx.TrainingInfoProto.updateBinding: array expected");Ct.updateBinding=[];for(var Rt=0;Rt<vt.updateBinding.length;++Rt){if(typeof vt.updateBinding[Rt]!="object")throw TypeError(".onnx.TrainingInfoProto.updateBinding: object expected");Ct.updateBinding[Rt]=gt.onnx.StringStringEntryProto.fromObject(vt.updateBinding[Rt])}}return Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.initializationBinding=[],Rt.updateBinding=[]),Ct.defaults&&(Rt.initialization=null,Rt.algorithm=null),vt.initialization!=null&&vt.hasOwnProperty("initialization")&&(Rt.initialization=gt.onnx.GraphProto.toObject(vt.initialization,Ct)),vt.algorithm!=null&&vt.hasOwnProperty("algorithm")&&(Rt.algorithm=gt.onnx.GraphProto.toObject(vt.algorithm,Ct)),vt.initializationBinding&&vt.initializationBinding.length){Rt.initializationBinding=[];for(var Mt=0;Mt<vt.initializationBinding.length;++Mt)Rt.initializationBinding[Mt]=gt.onnx.StringStringEntryProto.toObject(vt.initializationBinding[Mt],Ct)}if(vt.updateBinding&&vt.updateBinding.length){Rt.updateBinding=[];for(var Mt=0;Mt<vt.updateBinding.length;++Mt)Rt.updateBinding[Mt]=gt.onnx.StringStringEntryProto.toObject(vt.updateBinding[Mt],Ct)}return Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.TrainingInfoProto"},wt}(),bt.ModelProto=function(){function wt(vt){if(this.opsetImport=[],this.metadataProps=[],this.trainingInfo=[],this.functions=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.irVersion=pt.Long?pt.Long.fromBits(0,0,!1):0,wt.prototype.opsetImport=pt.emptyArray,wt.prototype.producerName="",wt.prototype.producerVersion="",wt.prototype.domain="",wt.prototype.modelVersion=pt.Long?pt.Long.fromBits(0,0,!1):0,wt.prototype.docString="",wt.prototype.graph=null,wt.prototype.metadataProps=pt.emptyArray,wt.prototype.trainingInfo=pt.emptyArray,wt.prototype.functions=pt.emptyArray,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.irVersion!=null&&Object.hasOwnProperty.call(vt,"irVersion")&&Ct.uint32(8).int64(vt.irVersion),vt.producerName!=null&&Object.hasOwnProperty.call(vt,"producerName")&&Ct.uint32(18).string(vt.producerName),vt.producerVersion!=null&&Object.hasOwnProperty.call(vt,"producerVersion")&&Ct.uint32(26).string(vt.producerVersion),vt.domain!=null&&Object.hasOwnProperty.call(vt,"domain")&&Ct.uint32(34).string(vt.domain),vt.modelVersion!=null&&Object.hasOwnProperty.call(vt,"modelVersion")&&Ct.uint32(40).int64(vt.modelVersion),vt.docString!=null&&Object.hasOwnProperty.call(vt,"docString")&&Ct.uint32(50).string(vt.docString),vt.graph!=null&&Object.hasOwnProperty.call(vt,"graph")&&gt.onnx.GraphProto.encode(vt.graph,Ct.uint32(58).fork()).ldelim(),vt.opsetImport!=null&&vt.opsetImport.length)for(var Rt=0;Rt<vt.opsetImport.length;++Rt)gt.onnx.OperatorSetIdProto.encode(vt.opsetImport[Rt],Ct.uint32(66).fork()).ldelim();if(vt.metadataProps!=null&&vt.metadataProps.length)for(var Rt=0;Rt<vt.metadataProps.length;++Rt)gt.onnx.StringStringEntryProto.encode(vt.metadataProps[Rt],Ct.uint32(114).fork()).ldelim();if(vt.trainingInfo!=null&&vt.trainingInfo.length)for(var Rt=0;Rt<vt.trainingInfo.length;++Rt)gt.onnx.TrainingInfoProto.encode(vt.trainingInfo[Rt],Ct.uint32(162).fork()).ldelim();if(vt.functions!=null&&vt.functions.length)for(var Rt=0;Rt<vt.functions.length;++Rt)gt.onnx.FunctionProto.encode(vt.functions[Rt],Ct.uint32(202).fork()).ldelim();return Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.ModelProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.irVersion=vt.int64();break}case 8:{Mt.opsetImport&&Mt.opsetImport.length||(Mt.opsetImport=[]),Mt.opsetImport.push(gt.onnx.OperatorSetIdProto.decode(vt,vt.uint32()));break}case 2:{Mt.producerName=vt.string();break}case 3:{Mt.producerVersion=vt.string();break}case 4:{Mt.domain=vt.string();break}case 5:{Mt.modelVersion=vt.int64();break}case 6:{Mt.docString=vt.string();break}case 7:{Mt.graph=gt.onnx.GraphProto.decode(vt,vt.uint32());break}case 14:{Mt.metadataProps&&Mt.metadataProps.length||(Mt.metadataProps=[]),Mt.metadataProps.push(gt.onnx.StringStringEntryProto.decode(vt,vt.uint32()));break}case 20:{Mt.trainingInfo&&Mt.trainingInfo.length||(Mt.trainingInfo=[]),Mt.trainingInfo.push(gt.onnx.TrainingInfoProto.decode(vt,vt.uint32()));break}case 25:{Mt.functions&&Mt.functions.length||(Mt.functions=[]),Mt.functions.push(gt.onnx.FunctionProto.decode(vt,vt.uint32()));break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.irVersion!=null&&vt.hasOwnProperty("irVersion")&&!pt.isInteger(vt.irVersion)&&!(vt.irVersion&&pt.isInteger(vt.irVersion.low)&&pt.isInteger(vt.irVersion.high)))return"irVersion: integer|Long expected";if(vt.opsetImport!=null&&vt.hasOwnProperty("opsetImport")){if(!Array.isArray(vt.opsetImport))return"opsetImport: array expected";for(var Ct=0;Ct<vt.opsetImport.length;++Ct){var Rt=gt.onnx.OperatorSetIdProto.verify(vt.opsetImport[Ct]);if(Rt)return"opsetImport."+Rt}}if(vt.producerName!=null&&vt.hasOwnProperty("producerName")&&!pt.isString(vt.producerName))return"producerName: string expected";if(vt.producerVersion!=null&&vt.hasOwnProperty("producerVersion")&&!pt.isString(vt.producerVersion))return"producerVersion: string expected";if(vt.domain!=null&&vt.hasOwnProperty("domain")&&!pt.isString(vt.domain))return"domain: string expected";if(vt.modelVersion!=null&&vt.hasOwnProperty("modelVersion")&&!pt.isInteger(vt.modelVersion)&&!(vt.modelVersion&&pt.isInteger(vt.modelVersion.low)&&pt.isInteger(vt.modelVersion.high)))return"modelVersion: integer|Long expected";if(vt.docString!=null&&vt.hasOwnProperty("docString")&&!pt.isString(vt.docString))return"docString: string expected";if(vt.graph!=null&&vt.hasOwnProperty("graph")){var Rt=gt.onnx.GraphProto.verify(vt.graph);if(Rt)return"graph."+Rt}if(vt.metadataProps!=null&&vt.hasOwnProperty("metadataProps")){if(!Array.isArray(vt.metadataProps))return"metadataProps: array expected";for(var Ct=0;Ct<vt.metadataProps.length;++Ct){var Rt=gt.onnx.StringStringEntryProto.verify(vt.metadataProps[Ct]);if(Rt)return"metadataProps."+Rt}}if(vt.trainingInfo!=null&&vt.hasOwnProperty("trainingInfo")){if(!Array.isArray(vt.trainingInfo))return"trainingInfo: array expected";for(var Ct=0;Ct<vt.trainingInfo.length;++Ct){var Rt=gt.onnx.TrainingInfoProto.verify(vt.trainingInfo[Ct]);if(Rt)return"trainingInfo."+Rt}}if(vt.functions!=null&&vt.hasOwnProperty("functions")){if(!Array.isArray(vt.functions))return"functions: array expected";for(var Ct=0;Ct<vt.functions.length;++Ct){var Rt=gt.onnx.FunctionProto.verify(vt.functions[Ct]);if(Rt)return"functions."+Rt}}return null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.ModelProto)return vt;var Ct=new gt.onnx.ModelProto;if(vt.irVersion!=null&&(pt.Long?(Ct.irVersion=pt.Long.fromValue(vt.irVersion)).unsigned=!1:typeof vt.irVersion=="string"?Ct.irVersion=parseInt(vt.irVersion,10):typeof vt.irVersion=="number"?Ct.irVersion=vt.irVersion:typeof vt.irVersion=="object"&&(Ct.irVersion=new pt.LongBits(vt.irVersion.low>>>0,vt.irVersion.high>>>0).toNumber())),vt.opsetImport){if(!Array.isArray(vt.opsetImport))throw TypeError(".onnx.ModelProto.opsetImport: array expected");Ct.opsetImport=[];for(var Rt=0;Rt<vt.opsetImport.length;++Rt){if(typeof vt.opsetImport[Rt]!="object")throw TypeError(".onnx.ModelProto.opsetImport: object expected");Ct.opsetImport[Rt]=gt.onnx.OperatorSetIdProto.fromObject(vt.opsetImport[Rt])}}if(vt.producerName!=null&&(Ct.producerName=String(vt.producerName)),vt.producerVersion!=null&&(Ct.producerVersion=String(vt.producerVersion)),vt.domain!=null&&(Ct.domain=String(vt.domain)),vt.modelVersion!=null&&(pt.Long?(Ct.modelVersion=pt.Long.fromValue(vt.modelVersion)).unsigned=!1:typeof vt.modelVersion=="string"?Ct.modelVersion=parseInt(vt.modelVersion,10):typeof vt.modelVersion=="number"?Ct.modelVersion=vt.modelVersion:typeof vt.modelVersion=="object"&&(Ct.modelVersion=new pt.LongBits(vt.modelVersion.low>>>0,vt.modelVersion.high>>>0).toNumber())),vt.docString!=null&&(Ct.docString=String(vt.docString)),vt.graph!=null){if(typeof vt.graph!="object")throw TypeError(".onnx.ModelProto.graph: object expected");Ct.graph=gt.onnx.GraphProto.fromObject(vt.graph)}if(vt.metadataProps){if(!Array.isArray(vt.metadataProps))throw TypeError(".onnx.ModelProto.metadataProps: array expected");Ct.metadataProps=[];for(var Rt=0;Rt<vt.metadataProps.length;++Rt){if(typeof vt.metadataProps[Rt]!="object")throw TypeError(".onnx.ModelProto.metadataProps: object expected");Ct.metadataProps[Rt]=gt.onnx.StringStringEntryProto.fromObject(vt.metadataProps[Rt])}}if(vt.trainingInfo){if(!Array.isArray(vt.trainingInfo))throw TypeError(".onnx.ModelProto.trainingInfo: array expected");Ct.trainingInfo=[];for(var Rt=0;Rt<vt.trainingInfo.length;++Rt){if(typeof vt.trainingInfo[Rt]!="object")throw TypeError(".onnx.ModelProto.trainingInfo: object expected");Ct.trainingInfo[Rt]=gt.onnx.TrainingInfoProto.fromObject(vt.trainingInfo[Rt])}}if(vt.functions){if(!Array.isArray(vt.functions))throw TypeError(".onnx.ModelProto.functions: array expected");Ct.functions=[];for(var Rt=0;Rt<vt.functions.length;++Rt){if(typeof vt.functions[Rt]!="object")throw TypeError(".onnx.ModelProto.functions: object expected");Ct.functions[Rt]=gt.onnx.FunctionProto.fromObject(vt.functions[Rt])}}return Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.opsetImport=[],Rt.metadataProps=[],Rt.trainingInfo=[],Rt.functions=[]),Ct.defaults){if(pt.Long){var Mt=new pt.Long(0,0,!1);Rt.irVersion=Ct.longs===String?Mt.toString():Ct.longs===Number?Mt.toNumber():Mt}else Rt.irVersion=Ct.longs===String?"0":0;if(Rt.producerName="",Rt.producerVersion="",Rt.domain="",pt.Long){var Mt=new pt.Long(0,0,!1);Rt.modelVersion=Ct.longs===String?Mt.toString():Ct.longs===Number?Mt.toNumber():Mt}else Rt.modelVersion=Ct.longs===String?"0":0;Rt.docString="",Rt.graph=null}if(vt.irVersion!=null&&vt.hasOwnProperty("irVersion")&&(typeof vt.irVersion=="number"?Rt.irVersion=Ct.longs===String?String(vt.irVersion):vt.irVersion:Rt.irVersion=Ct.longs===String?pt.Long.prototype.toString.call(vt.irVersion):Ct.longs===Number?new pt.LongBits(vt.irVersion.low>>>0,vt.irVersion.high>>>0).toNumber():vt.irVersion),vt.producerName!=null&&vt.hasOwnProperty("producerName")&&(Rt.producerName=vt.producerName),vt.producerVersion!=null&&vt.hasOwnProperty("producerVersion")&&(Rt.producerVersion=vt.producerVersion),vt.domain!=null&&vt.hasOwnProperty("domain")&&(Rt.domain=vt.domain),vt.modelVersion!=null&&vt.hasOwnProperty("modelVersion")&&(typeof vt.modelVersion=="number"?Rt.modelVersion=Ct.longs===String?String(vt.modelVersion):vt.modelVersion:Rt.modelVersion=Ct.longs===String?pt.Long.prototype.toString.call(vt.modelVersion):Ct.longs===Number?new pt.LongBits(vt.modelVersion.low>>>0,vt.modelVersion.high>>>0).toNumber():vt.modelVersion),vt.docString!=null&&vt.hasOwnProperty("docString")&&(Rt.docString=vt.docString),vt.graph!=null&&vt.hasOwnProperty("graph")&&(Rt.graph=gt.onnx.GraphProto.toObject(vt.graph,Ct)),vt.opsetImport&&vt.opsetImport.length){Rt.opsetImport=[];for(var Ot=0;Ot<vt.opsetImport.length;++Ot)Rt.opsetImport[Ot]=gt.onnx.OperatorSetIdProto.toObject(vt.opsetImport[Ot],Ct)}if(vt.metadataProps&&vt.metadataProps.length){Rt.metadataProps=[];for(var Ot=0;Ot<vt.metadataProps.length;++Ot)Rt.metadataProps[Ot]=gt.onnx.StringStringEntryProto.toObject(vt.metadataProps[Ot],Ct)}if(vt.trainingInfo&&vt.trainingInfo.length){Rt.trainingInfo=[];for(var Ot=0;Ot<vt.trainingInfo.length;++Ot)Rt.trainingInfo[Ot]=gt.onnx.TrainingInfoProto.toObject(vt.trainingInfo[Ot],Ct)}if(vt.functions&&vt.functions.length){Rt.functions=[];for(var Ot=0;Ot<vt.functions.length;++Ot)Rt.functions[Ot]=gt.onnx.FunctionProto.toObject(vt.functions[Ot],Ct)}return Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.ModelProto"},wt}(),bt.StringStringEntryProto=function(){function wt(vt){if(vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.key="",wt.prototype.value="",wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){return Ct||(Ct=mt.create()),vt.key!=null&&Object.hasOwnProperty.call(vt,"key")&&Ct.uint32(10).string(vt.key),vt.value!=null&&Object.hasOwnProperty.call(vt,"value")&&Ct.uint32(18).string(vt.value),Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.StringStringEntryProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.key=vt.string();break}case 2:{Mt.value=vt.string();break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){return typeof vt!="object"||vt===null?"object expected":vt.key!=null&&vt.hasOwnProperty("key")&&!pt.isString(vt.key)?"key: string expected":vt.value!=null&&vt.hasOwnProperty("value")&&!pt.isString(vt.value)?"value: string expected":null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.StringStringEntryProto)return vt;var Ct=new gt.onnx.StringStringEntryProto;return vt.key!=null&&(Ct.key=String(vt.key)),vt.value!=null&&(Ct.value=String(vt.value)),Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};return Ct.defaults&&(Rt.key="",Rt.value=""),vt.key!=null&&vt.hasOwnProperty("key")&&(Rt.key=vt.key),vt.value!=null&&vt.hasOwnProperty("value")&&(Rt.value=vt.value),Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.StringStringEntryProto"},wt}(),bt.TensorAnnotation=function(){function wt(vt){if(this.quantParameterTensorNames=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.tensorName="",wt.prototype.quantParameterTensorNames=pt.emptyArray,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.tensorName!=null&&Object.hasOwnProperty.call(vt,"tensorName")&&Ct.uint32(10).string(vt.tensorName),vt.quantParameterTensorNames!=null&&vt.quantParameterTensorNames.length)for(var Rt=0;Rt<vt.quantParameterTensorNames.length;++Rt)gt.onnx.StringStringEntryProto.encode(vt.quantParameterTensorNames[Rt],Ct.uint32(18).fork()).ldelim();return Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.TensorAnnotation;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.tensorName=vt.string();break}case 2:{Mt.quantParameterTensorNames&&Mt.quantParameterTensorNames.length||(Mt.quantParameterTensorNames=[]),Mt.quantParameterTensorNames.push(gt.onnx.StringStringEntryProto.decode(vt,vt.uint32()));break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.tensorName!=null&&vt.hasOwnProperty("tensorName")&&!pt.isString(vt.tensorName))return"tensorName: string expected";if(vt.quantParameterTensorNames!=null&&vt.hasOwnProperty("quantParameterTensorNames")){if(!Array.isArray(vt.quantParameterTensorNames))return"quantParameterTensorNames: array expected";for(var Ct=0;Ct<vt.quantParameterTensorNames.length;++Ct){var Rt=gt.onnx.StringStringEntryProto.verify(vt.quantParameterTensorNames[Ct]);if(Rt)return"quantParameterTensorNames."+Rt}}return null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.TensorAnnotation)return vt;var Ct=new gt.onnx.TensorAnnotation;if(vt.tensorName!=null&&(Ct.tensorName=String(vt.tensorName)),vt.quantParameterTensorNames){if(!Array.isArray(vt.quantParameterTensorNames))throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: array expected");Ct.quantParameterTensorNames=[];for(var Rt=0;Rt<vt.quantParameterTensorNames.length;++Rt){if(typeof vt.quantParameterTensorNames[Rt]!="object")throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: object expected");Ct.quantParameterTensorNames[Rt]=gt.onnx.StringStringEntryProto.fromObject(vt.quantParameterTensorNames[Rt])}}return Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.quantParameterTensorNames=[]),Ct.defaults&&(Rt.tensorName=""),vt.tensorName!=null&&vt.hasOwnProperty("tensorName")&&(Rt.tensorName=vt.tensorName),vt.quantParameterTensorNames&&vt.quantParameterTensorNames.length){Rt.quantParameterTensorNames=[];for(var Mt=0;Mt<vt.quantParameterTensorNames.length;++Mt)Rt.quantParameterTensorNames[Mt]=gt.onnx.StringStringEntryProto.toObject(vt.quantParameterTensorNames[Mt],Ct)}return Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.TensorAnnotation"},wt}(),bt.GraphProto=function(){function wt(vt){if(this.node=[],this.initializer=[],this.sparseInitializer=[],this.input=[],this.output=[],this.valueInfo=[],this.quantizationAnnotation=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.node=pt.emptyArray,wt.prototype.name="",wt.prototype.initializer=pt.emptyArray,wt.prototype.sparseInitializer=pt.emptyArray,wt.prototype.docString="",wt.prototype.input=pt.emptyArray,wt.prototype.output=pt.emptyArray,wt.prototype.valueInfo=pt.emptyArray,wt.prototype.quantizationAnnotation=pt.emptyArray,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.node!=null&&vt.node.length)for(var Rt=0;Rt<vt.node.length;++Rt)gt.onnx.NodeProto.encode(vt.node[Rt],Ct.uint32(10).fork()).ldelim();if(vt.name!=null&&Object.hasOwnProperty.call(vt,"name")&&Ct.uint32(18).string(vt.name),vt.initializer!=null&&vt.initializer.length)for(var Rt=0;Rt<vt.initializer.length;++Rt)gt.onnx.TensorProto.encode(vt.initializer[Rt],Ct.uint32(42).fork()).ldelim();if(vt.docString!=null&&Object.hasOwnProperty.call(vt,"docString")&&Ct.uint32(82).string(vt.docString),vt.input!=null&&vt.input.length)for(var Rt=0;Rt<vt.input.length;++Rt)gt.onnx.ValueInfoProto.encode(vt.input[Rt],Ct.uint32(90).fork()).ldelim();if(vt.output!=null&&vt.output.length)for(var Rt=0;Rt<vt.output.length;++Rt)gt.onnx.ValueInfoProto.encode(vt.output[Rt],Ct.uint32(98).fork()).ldelim();if(vt.valueInfo!=null&&vt.valueInfo.length)for(var Rt=0;Rt<vt.valueInfo.length;++Rt)gt.onnx.ValueInfoProto.encode(vt.valueInfo[Rt],Ct.uint32(106).fork()).ldelim();if(vt.quantizationAnnotation!=null&&vt.quantizationAnnotation.length)for(var Rt=0;Rt<vt.quantizationAnnotation.length;++Rt)gt.onnx.TensorAnnotation.encode(vt.quantizationAnnotation[Rt],Ct.uint32(114).fork()).ldelim();if(vt.sparseInitializer!=null&&vt.sparseInitializer.length)for(var Rt=0;Rt<vt.sparseInitializer.length;++Rt)gt.onnx.SparseTensorProto.encode(vt.sparseInitializer[Rt],Ct.uint32(122).fork()).ldelim();return Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.GraphProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.node&&Mt.node.length||(Mt.node=[]),Mt.node.push(gt.onnx.NodeProto.decode(vt,vt.uint32()));break}case 2:{Mt.name=vt.string();break}case 5:{Mt.initializer&&Mt.initializer.length||(Mt.initializer=[]),Mt.initializer.push(gt.onnx.TensorProto.decode(vt,vt.uint32()));break}case 15:{Mt.sparseInitializer&&Mt.sparseInitializer.length||(Mt.sparseInitializer=[]),Mt.sparseInitializer.push(gt.onnx.SparseTensorProto.decode(vt,vt.uint32()));break}case 10:{Mt.docString=vt.string();break}case 11:{Mt.input&&Mt.input.length||(Mt.input=[]),Mt.input.push(gt.onnx.ValueInfoProto.decode(vt,vt.uint32()));break}case 12:{Mt.output&&Mt.output.length||(Mt.output=[]),Mt.output.push(gt.onnx.ValueInfoProto.decode(vt,vt.uint32()));break}case 13:{Mt.valueInfo&&Mt.valueInfo.length||(Mt.valueInfo=[]),Mt.valueInfo.push(gt.onnx.ValueInfoProto.decode(vt,vt.uint32()));break}case 14:{Mt.quantizationAnnotation&&Mt.quantizationAnnotation.length||(Mt.quantizationAnnotation=[]),Mt.quantizationAnnotation.push(gt.onnx.TensorAnnotation.decode(vt,vt.uint32()));break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.node!=null&&vt.hasOwnProperty("node")){if(!Array.isArray(vt.node))return"node: array expected";for(var Ct=0;Ct<vt.node.length;++Ct){var Rt=gt.onnx.NodeProto.verify(vt.node[Ct]);if(Rt)return"node."+Rt}}if(vt.name!=null&&vt.hasOwnProperty("name")&&!pt.isString(vt.name))return"name: string expected";if(vt.initializer!=null&&vt.hasOwnProperty("initializer")){if(!Array.isArray(vt.initializer))return"initializer: array expected";for(var Ct=0;Ct<vt.initializer.length;++Ct){var Rt=gt.onnx.TensorProto.verify(vt.initializer[Ct]);if(Rt)return"initializer."+Rt}}if(vt.sparseInitializer!=null&&vt.hasOwnProperty("sparseInitializer")){if(!Array.isArray(vt.sparseInitializer))return"sparseInitializer: array expected";for(var Ct=0;Ct<vt.sparseInitializer.length;++Ct){var Rt=gt.onnx.SparseTensorProto.verify(vt.sparseInitializer[Ct]);if(Rt)return"sparseInitializer."+Rt}}if(vt.docString!=null&&vt.hasOwnProperty("docString")&&!pt.isString(vt.docString))return"docString: string expected";if(vt.input!=null&&vt.hasOwnProperty("input")){if(!Array.isArray(vt.input))return"input: array expected";for(var Ct=0;Ct<vt.input.length;++Ct){var Rt=gt.onnx.ValueInfoProto.verify(vt.input[Ct]);if(Rt)return"input."+Rt}}if(vt.output!=null&&vt.hasOwnProperty("output")){if(!Array.isArray(vt.output))return"output: array expected";for(var Ct=0;Ct<vt.output.length;++Ct){var Rt=gt.onnx.ValueInfoProto.verify(vt.output[Ct]);if(Rt)return"output."+Rt}}if(vt.valueInfo!=null&&vt.hasOwnProperty("valueInfo")){if(!Array.isArray(vt.valueInfo))return"valueInfo: array expected";for(var Ct=0;Ct<vt.valueInfo.length;++Ct){var Rt=gt.onnx.ValueInfoProto.verify(vt.valueInfo[Ct]);if(Rt)return"valueInfo."+Rt}}if(vt.quantizationAnnotation!=null&&vt.hasOwnProperty("quantizationAnnotation")){if(!Array.isArray(vt.quantizationAnnotation))return"quantizationAnnotation: array expected";for(var Ct=0;Ct<vt.quantizationAnnotation.length;++Ct){var Rt=gt.onnx.TensorAnnotation.verify(vt.quantizationAnnotation[Ct]);if(Rt)return"quantizationAnnotation."+Rt}}return null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.GraphProto)return vt;var Ct=new gt.onnx.GraphProto;if(vt.node){if(!Array.isArray(vt.node))throw TypeError(".onnx.GraphProto.node: array expected");Ct.node=[];for(var Rt=0;Rt<vt.node.length;++Rt){if(typeof vt.node[Rt]!="object")throw TypeError(".onnx.GraphProto.node: object expected");Ct.node[Rt]=gt.onnx.NodeProto.fromObject(vt.node[Rt])}}if(vt.name!=null&&(Ct.name=String(vt.name)),vt.initializer){if(!Array.isArray(vt.initializer))throw TypeError(".onnx.GraphProto.initializer: array expected");Ct.initializer=[];for(var Rt=0;Rt<vt.initializer.length;++Rt){if(typeof vt.initializer[Rt]!="object")throw TypeError(".onnx.GraphProto.initializer: object expected");Ct.initializer[Rt]=gt.onnx.TensorProto.fromObject(vt.initializer[Rt])}}if(vt.sparseInitializer){if(!Array.isArray(vt.sparseInitializer))throw TypeError(".onnx.GraphProto.sparseInitializer: array expected");Ct.sparseInitializer=[];for(var Rt=0;Rt<vt.sparseInitializer.length;++Rt){if(typeof vt.sparseInitializer[Rt]!="object")throw TypeError(".onnx.GraphProto.sparseInitializer: object expected");Ct.sparseInitializer[Rt]=gt.onnx.SparseTensorProto.fromObject(vt.sparseInitializer[Rt])}}if(vt.docString!=null&&(Ct.docString=String(vt.docString)),vt.input){if(!Array.isArray(vt.input))throw TypeError(".onnx.GraphProto.input: array expected");Ct.input=[];for(var Rt=0;Rt<vt.input.length;++Rt){if(typeof vt.input[Rt]!="object")throw TypeError(".onnx.GraphProto.input: object expected");Ct.input[Rt]=gt.onnx.ValueInfoProto.fromObject(vt.input[Rt])}}if(vt.output){if(!Array.isArray(vt.output))throw TypeError(".onnx.GraphProto.output: array expected");Ct.output=[];for(var Rt=0;Rt<vt.output.length;++Rt){if(typeof vt.output[Rt]!="object")throw TypeError(".onnx.GraphProto.output: object expected");Ct.output[Rt]=gt.onnx.ValueInfoProto.fromObject(vt.output[Rt])}}if(vt.valueInfo){if(!Array.isArray(vt.valueInfo))throw TypeError(".onnx.GraphProto.valueInfo: array expected");Ct.valueInfo=[];for(var Rt=0;Rt<vt.valueInfo.length;++Rt){if(typeof vt.valueInfo[Rt]!="object")throw TypeError(".onnx.GraphProto.valueInfo: object expected");Ct.valueInfo[Rt]=gt.onnx.ValueInfoProto.fromObject(vt.valueInfo[Rt])}}if(vt.quantizationAnnotation){if(!Array.isArray(vt.quantizationAnnotation))throw TypeError(".onnx.GraphProto.quantizationAnnotation: array expected");Ct.quantizationAnnotation=[];for(var Rt=0;Rt<vt.quantizationAnnotation.length;++Rt){if(typeof vt.quantizationAnnotation[Rt]!="object")throw TypeError(".onnx.GraphProto.quantizationAnnotation: object expected");Ct.quantizationAnnotation[Rt]=gt.onnx.TensorAnnotation.fromObject(vt.quantizationAnnotation[Rt])}}return Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.node=[],Rt.initializer=[],Rt.input=[],Rt.output=[],Rt.valueInfo=[],Rt.quantizationAnnotation=[],Rt.sparseInitializer=[]),Ct.defaults&&(Rt.name="",Rt.docString=""),vt.node&&vt.node.length){Rt.node=[];for(var Mt=0;Mt<vt.node.length;++Mt)Rt.node[Mt]=gt.onnx.NodeProto.toObject(vt.node[Mt],Ct)}if(vt.name!=null&&vt.hasOwnProperty("name")&&(Rt.name=vt.name),vt.initializer&&vt.initializer.length){Rt.initializer=[];for(var Mt=0;Mt<vt.initializer.length;++Mt)Rt.initializer[Mt]=gt.onnx.TensorProto.toObject(vt.initializer[Mt],Ct)}if(vt.docString!=null&&vt.hasOwnProperty("docString")&&(Rt.docString=vt.docString),vt.input&&vt.input.length){Rt.input=[];for(var Mt=0;Mt<vt.input.length;++Mt)Rt.input[Mt]=gt.onnx.ValueInfoProto.toObject(vt.input[Mt],Ct)}if(vt.output&&vt.output.length){Rt.output=[];for(var Mt=0;Mt<vt.output.length;++Mt)Rt.output[Mt]=gt.onnx.ValueInfoProto.toObject(vt.output[Mt],Ct)}if(vt.valueInfo&&vt.valueInfo.length){Rt.valueInfo=[];for(var Mt=0;Mt<vt.valueInfo.length;++Mt)Rt.valueInfo[Mt]=gt.onnx.ValueInfoProto.toObject(vt.valueInfo[Mt],Ct)}if(vt.quantizationAnnotation&&vt.quantizationAnnotation.length){Rt.quantizationAnnotation=[];for(var Mt=0;Mt<vt.quantizationAnnotation.length;++Mt)Rt.quantizationAnnotation[Mt]=gt.onnx.TensorAnnotation.toObject(vt.quantizationAnnotation[Mt],Ct)}if(vt.sparseInitializer&&vt.sparseInitializer.length){Rt.sparseInitializer=[];for(var Mt=0;Mt<vt.sparseInitializer.length;++Mt)Rt.sparseInitializer[Mt]=gt.onnx.SparseTensorProto.toObject(vt.sparseInitializer[Mt],Ct)}return Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.GraphProto"},wt}(),bt.TensorProto=function(){function wt(vt){if(this.dims=[],this.floatData=[],this.int32Data=[],this.stringData=[],this.int64Data=[],this.externalData=[],this.doubleData=[],this.uint64Data=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.dims=pt.emptyArray,wt.prototype.dataType=0,wt.prototype.segment=null,wt.prototype.floatData=pt.emptyArray,wt.prototype.int32Data=pt.emptyArray,wt.prototype.stringData=pt.emptyArray,wt.prototype.int64Data=pt.emptyArray,wt.prototype.name="",wt.prototype.docString="",wt.prototype.rawData=pt.newBuffer([]),wt.prototype.externalData=pt.emptyArray,wt.prototype.dataLocation=0,wt.prototype.doubleData=pt.emptyArray,wt.prototype.uint64Data=pt.emptyArray,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.dims!=null&&vt.dims.length){Ct.uint32(10).fork();for(var Rt=0;Rt<vt.dims.length;++Rt)Ct.int64(vt.dims[Rt]);Ct.ldelim()}if(vt.dataType!=null&&Object.hasOwnProperty.call(vt,"dataType")&&Ct.uint32(16).int32(vt.dataType),vt.segment!=null&&Object.hasOwnProperty.call(vt,"segment")&&gt.onnx.TensorProto.Segment.encode(vt.segment,Ct.uint32(26).fork()).ldelim(),vt.floatData!=null&&vt.floatData.length){Ct.uint32(34).fork();for(var Rt=0;Rt<vt.floatData.length;++Rt)Ct.float(vt.floatData[Rt]);Ct.ldelim()}if(vt.int32Data!=null&&vt.int32Data.length){Ct.uint32(42).fork();for(var Rt=0;Rt<vt.int32Data.length;++Rt)Ct.int32(vt.int32Data[Rt]);Ct.ldelim()}if(vt.stringData!=null&&vt.stringData.length)for(var Rt=0;Rt<vt.stringData.length;++Rt)Ct.uint32(50).bytes(vt.stringData[Rt]);if(vt.int64Data!=null&&vt.int64Data.length){Ct.uint32(58).fork();for(var Rt=0;Rt<vt.int64Data.length;++Rt)Ct.int64(vt.int64Data[Rt]);Ct.ldelim()}if(vt.name!=null&&Object.hasOwnProperty.call(vt,"name")&&Ct.uint32(66).string(vt.name),vt.rawData!=null&&Object.hasOwnProperty.call(vt,"rawData")&&Ct.uint32(74).bytes(vt.rawData),vt.doubleData!=null&&vt.doubleData.length){Ct.uint32(82).fork();for(var Rt=0;Rt<vt.doubleData.length;++Rt)Ct.double(vt.doubleData[Rt]);Ct.ldelim()}if(vt.uint64Data!=null&&vt.uint64Data.length){Ct.uint32(90).fork();for(var Rt=0;Rt<vt.uint64Data.length;++Rt)Ct.uint64(vt.uint64Data[Rt]);Ct.ldelim()}if(vt.docString!=null&&Object.hasOwnProperty.call(vt,"docString")&&Ct.uint32(98).string(vt.docString),vt.externalData!=null&&vt.externalData.length)for(var Rt=0;Rt<vt.externalData.length;++Rt)gt.onnx.StringStringEntryProto.encode(vt.externalData[Rt],Ct.uint32(106).fork()).ldelim();return vt.dataLocation!=null&&Object.hasOwnProperty.call(vt,"dataLocation")&&Ct.uint32(112).int32(vt.dataLocation),Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.TensorProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{if(Mt.dims&&Mt.dims.length||(Mt.dims=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.dims.push(vt.int64());else Mt.dims.push(vt.int64());break}case 2:{Mt.dataType=vt.int32();break}case 3:{Mt.segment=gt.onnx.TensorProto.Segment.decode(vt,vt.uint32());break}case 4:{if(Mt.floatData&&Mt.floatData.length||(Mt.floatData=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.floatData.push(vt.float());else Mt.floatData.push(vt.float());break}case 5:{if(Mt.int32Data&&Mt.int32Data.length||(Mt.int32Data=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.int32Data.push(vt.int32());else Mt.int32Data.push(vt.int32());break}case 6:{Mt.stringData&&Mt.stringData.length||(Mt.stringData=[]),Mt.stringData.push(vt.bytes());break}case 7:{if(Mt.int64Data&&Mt.int64Data.length||(Mt.int64Data=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.int64Data.push(vt.int64());else Mt.int64Data.push(vt.int64());break}case 8:{Mt.name=vt.string();break}case 12:{Mt.docString=vt.string();break}case 9:{Mt.rawData=vt.bytes();break}case 13:{Mt.externalData&&Mt.externalData.length||(Mt.externalData=[]),Mt.externalData.push(gt.onnx.StringStringEntryProto.decode(vt,vt.uint32()));break}case 14:{Mt.dataLocation=vt.int32();break}case 10:{if(Mt.doubleData&&Mt.doubleData.length||(Mt.doubleData=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.doubleData.push(vt.double());else Mt.doubleData.push(vt.double());break}case 11:{if(Mt.uint64Data&&Mt.uint64Data.length||(Mt.uint64Data=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.uint64Data.push(vt.uint64());else Mt.uint64Data.push(vt.uint64());break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.dims!=null&&vt.hasOwnProperty("dims")){if(!Array.isArray(vt.dims))return"dims: array expected";for(var Ct=0;Ct<vt.dims.length;++Ct)if(!pt.isInteger(vt.dims[Ct])&&!(vt.dims[Ct]&&pt.isInteger(vt.dims[Ct].low)&&pt.isInteger(vt.dims[Ct].high)))return"dims: integer|Long[] expected"}if(vt.dataType!=null&&vt.hasOwnProperty("dataType")&&!pt.isInteger(vt.dataType))return"dataType: integer expected";if(vt.segment!=null&&vt.hasOwnProperty("segment")){var Rt=gt.onnx.TensorProto.Segment.verify(vt.segment);if(Rt)return"segment."+Rt}if(vt.floatData!=null&&vt.hasOwnProperty("floatData")){if(!Array.isArray(vt.floatData))return"floatData: array expected";for(var Ct=0;Ct<vt.floatData.length;++Ct)if(typeof vt.floatData[Ct]!="number")return"floatData: number[] expected"}if(vt.int32Data!=null&&vt.hasOwnProperty("int32Data")){if(!Array.isArray(vt.int32Data))return"int32Data: array expected";for(var Ct=0;Ct<vt.int32Data.length;++Ct)if(!pt.isInteger(vt.int32Data[Ct]))return"int32Data: integer[] expected"}if(vt.stringData!=null&&vt.hasOwnProperty("stringData")){if(!Array.isArray(vt.stringData))return"stringData: array expected";for(var Ct=0;Ct<vt.stringData.length;++Ct)if(!(vt.stringData[Ct]&&typeof vt.stringData[Ct].length=="number"||pt.isString(vt.stringData[Ct])))return"stringData: buffer[] expected"}if(vt.int64Data!=null&&vt.hasOwnProperty("int64Data")){if(!Array.isArray(vt.int64Data))return"int64Data: array expected";for(var Ct=0;Ct<vt.int64Data.length;++Ct)if(!pt.isInteger(vt.int64Data[Ct])&&!(vt.int64Data[Ct]&&pt.isInteger(vt.int64Data[Ct].low)&&pt.isInteger(vt.int64Data[Ct].high)))return"int64Data: integer|Long[] expected"}if(vt.name!=null&&vt.hasOwnProperty("name")&&!pt.isString(vt.name))return"name: string expected";if(vt.docString!=null&&vt.hasOwnProperty("docString")&&!pt.isString(vt.docString))return"docString: string expected";if(vt.rawData!=null&&vt.hasOwnProperty("rawData")&&!(vt.rawData&&typeof vt.rawData.length=="number"||pt.isString(vt.rawData)))return"rawData: buffer expected";if(vt.externalData!=null&&vt.hasOwnProperty("externalData")){if(!Array.isArray(vt.externalData))return"externalData: array expected";for(var Ct=0;Ct<vt.externalData.length;++Ct){var Rt=gt.onnx.StringStringEntryProto.verify(vt.externalData[Ct]);if(Rt)return"externalData."+Rt}}if(vt.dataLocation!=null&&vt.hasOwnProperty("dataLocation"))switch(vt.dataLocation){default:return"dataLocation: enum value expected";case 0:case 1:break}if(vt.doubleData!=null&&vt.hasOwnProperty("doubleData")){if(!Array.isArray(vt.doubleData))return"doubleData: array expected";for(var Ct=0;Ct<vt.doubleData.length;++Ct)if(typeof vt.doubleData[Ct]!="number")return"doubleData: number[] expected"}if(vt.uint64Data!=null&&vt.hasOwnProperty("uint64Data")){if(!Array.isArray(vt.uint64Data))return"uint64Data: array expected";for(var Ct=0;Ct<vt.uint64Data.length;++Ct)if(!pt.isInteger(vt.uint64Data[Ct])&&!(vt.uint64Data[Ct]&&pt.isInteger(vt.uint64Data[Ct].low)&&pt.isInteger(vt.uint64Data[Ct].high)))return"uint64Data: integer|Long[] expected"}return null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.TensorProto)return vt;var Ct=new gt.onnx.TensorProto;if(vt.dims){if(!Array.isArray(vt.dims))throw TypeError(".onnx.TensorProto.dims: array expected");Ct.dims=[];for(var Rt=0;Rt<vt.dims.length;++Rt)pt.Long?(Ct.dims[Rt]=pt.Long.fromValue(vt.dims[Rt])).unsigned=!1:typeof vt.dims[Rt]=="string"?Ct.dims[Rt]=parseInt(vt.dims[Rt],10):typeof vt.dims[Rt]=="number"?Ct.dims[Rt]=vt.dims[Rt]:typeof vt.dims[Rt]=="object"&&(Ct.dims[Rt]=new pt.LongBits(vt.dims[Rt].low>>>0,vt.dims[Rt].high>>>0).toNumber())}if(vt.dataType!=null&&(Ct.dataType=vt.dataType|0),vt.segment!=null){if(typeof vt.segment!="object")throw TypeError(".onnx.TensorProto.segment: object expected");Ct.segment=gt.onnx.TensorProto.Segment.fromObject(vt.segment)}if(vt.floatData){if(!Array.isArray(vt.floatData))throw TypeError(".onnx.TensorProto.floatData: array expected");Ct.floatData=[];for(var Rt=0;Rt<vt.floatData.length;++Rt)Ct.floatData[Rt]=Number(vt.floatData[Rt])}if(vt.int32Data){if(!Array.isArray(vt.int32Data))throw TypeError(".onnx.TensorProto.int32Data: array expected");Ct.int32Data=[];for(var Rt=0;Rt<vt.int32Data.length;++Rt)Ct.int32Data[Rt]=vt.int32Data[Rt]|0}if(vt.stringData){if(!Array.isArray(vt.stringData))throw TypeError(".onnx.TensorProto.stringData: array expected");Ct.stringData=[];for(var Rt=0;Rt<vt.stringData.length;++Rt)typeof vt.stringData[Rt]=="string"?pt.base64.decode(vt.stringData[Rt],Ct.stringData[Rt]=pt.newBuffer(pt.base64.length(vt.stringData[Rt])),0):vt.stringData[Rt].length>=0&&(Ct.stringData[Rt]=vt.stringData[Rt])}if(vt.int64Data){if(!Array.isArray(vt.int64Data))throw TypeError(".onnx.TensorProto.int64Data: array expected");Ct.int64Data=[];for(var Rt=0;Rt<vt.int64Data.length;++Rt)pt.Long?(Ct.int64Data[Rt]=pt.Long.fromValue(vt.int64Data[Rt])).unsigned=!1:typeof vt.int64Data[Rt]=="string"?Ct.int64Data[Rt]=parseInt(vt.int64Data[Rt],10):typeof vt.int64Data[Rt]=="number"?Ct.int64Data[Rt]=vt.int64Data[Rt]:typeof vt.int64Data[Rt]=="object"&&(Ct.int64Data[Rt]=new pt.LongBits(vt.int64Data[Rt].low>>>0,vt.int64Data[Rt].high>>>0).toNumber())}if(vt.name!=null&&(Ct.name=String(vt.name)),vt.docString!=null&&(Ct.docString=String(vt.docString)),vt.rawData!=null&&(typeof vt.rawData=="string"?pt.base64.decode(vt.rawData,Ct.rawData=pt.newBuffer(pt.base64.length(vt.rawData)),0):vt.rawData.length>=0&&(Ct.rawData=vt.rawData)),vt.externalData){if(!Array.isArray(vt.externalData))throw TypeError(".onnx.TensorProto.externalData: array expected");Ct.externalData=[];for(var Rt=0;Rt<vt.externalData.length;++Rt){if(typeof vt.externalData[Rt]!="object")throw TypeError(".onnx.TensorProto.externalData: object expected");Ct.externalData[Rt]=gt.onnx.StringStringEntryProto.fromObject(vt.externalData[Rt])}}switch(vt.dataLocation){default:if(typeof vt.dataLocation=="number"){Ct.dataLocation=vt.dataLocation;break}break;case"DEFAULT":case 0:Ct.dataLocation=0;break;case"EXTERNAL":case 1:Ct.dataLocation=1;break}if(vt.doubleData){if(!Array.isArray(vt.doubleData))throw TypeError(".onnx.TensorProto.doubleData: array expected");Ct.doubleData=[];for(var Rt=0;Rt<vt.doubleData.length;++Rt)Ct.doubleData[Rt]=Number(vt.doubleData[Rt])}if(vt.uint64Data){if(!Array.isArray(vt.uint64Data))throw TypeError(".onnx.TensorProto.uint64Data: array expected");Ct.uint64Data=[];for(var Rt=0;Rt<vt.uint64Data.length;++Rt)pt.Long?(Ct.uint64Data[Rt]=pt.Long.fromValue(vt.uint64Data[Rt])).unsigned=!0:typeof vt.uint64Data[Rt]=="string"?Ct.uint64Data[Rt]=parseInt(vt.uint64Data[Rt],10):typeof vt.uint64Data[Rt]=="number"?Ct.uint64Data[Rt]=vt.uint64Data[Rt]:typeof vt.uint64Data[Rt]=="object"&&(Ct.uint64Data[Rt]=new pt.LongBits(vt.uint64Data[Rt].low>>>0,vt.uint64Data[Rt].high>>>0).toNumber(!0))}return Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.dims=[],Rt.floatData=[],Rt.int32Data=[],Rt.stringData=[],Rt.int64Data=[],Rt.doubleData=[],Rt.uint64Data=[],Rt.externalData=[]),Ct.defaults&&(Rt.dataType=0,Rt.segment=null,Rt.name="",Ct.bytes===String?Rt.rawData="":(Rt.rawData=[],Ct.bytes!==Array&&(Rt.rawData=pt.newBuffer(Rt.rawData))),Rt.docString="",Rt.dataLocation=Ct.enums===String?"DEFAULT":0),vt.dims&&vt.dims.length){Rt.dims=[];for(var Mt=0;Mt<vt.dims.length;++Mt)typeof vt.dims[Mt]=="number"?Rt.dims[Mt]=Ct.longs===String?String(vt.dims[Mt]):vt.dims[Mt]:Rt.dims[Mt]=Ct.longs===String?pt.Long.prototype.toString.call(vt.dims[Mt]):Ct.longs===Number?new pt.LongBits(vt.dims[Mt].low>>>0,vt.dims[Mt].high>>>0).toNumber():vt.dims[Mt]}if(vt.dataType!=null&&vt.hasOwnProperty("dataType")&&(Rt.dataType=vt.dataType),vt.segment!=null&&vt.hasOwnProperty("segment")&&(Rt.segment=gt.onnx.TensorProto.Segment.toObject(vt.segment,Ct)),vt.floatData&&vt.floatData.length){Rt.floatData=[];for(var Mt=0;Mt<vt.floatData.length;++Mt)Rt.floatData[Mt]=Ct.json&&!isFinite(vt.floatData[Mt])?String(vt.floatData[Mt]):vt.floatData[Mt]}if(vt.int32Data&&vt.int32Data.length){Rt.int32Data=[];for(var Mt=0;Mt<vt.int32Data.length;++Mt)Rt.int32Data[Mt]=vt.int32Data[Mt]}if(vt.stringData&&vt.stringData.length){Rt.stringData=[];for(var Mt=0;Mt<vt.stringData.length;++Mt)Rt.stringData[Mt]=Ct.bytes===String?pt.base64.encode(vt.stringData[Mt],0,vt.stringData[Mt].length):Ct.bytes===Array?Array.prototype.slice.call(vt.stringData[Mt]):vt.stringData[Mt]}if(vt.int64Data&&vt.int64Data.length){Rt.int64Data=[];for(var Mt=0;Mt<vt.int64Data.length;++Mt)typeof vt.int64Data[Mt]=="number"?Rt.int64Data[Mt]=Ct.longs===String?String(vt.int64Data[Mt]):vt.int64Data[Mt]:Rt.int64Data[Mt]=Ct.longs===String?pt.Long.prototype.toString.call(vt.int64Data[Mt]):Ct.longs===Number?new pt.LongBits(vt.int64Data[Mt].low>>>0,vt.int64Data[Mt].high>>>0).toNumber():vt.int64Data[Mt]}if(vt.name!=null&&vt.hasOwnProperty("name")&&(Rt.name=vt.name),vt.rawData!=null&&vt.hasOwnProperty("rawData")&&(Rt.rawData=Ct.bytes===String?pt.base64.encode(vt.rawData,0,vt.rawData.length):Ct.bytes===Array?Array.prototype.slice.call(vt.rawData):vt.rawData),vt.doubleData&&vt.doubleData.length){Rt.doubleData=[];for(var Mt=0;Mt<vt.doubleData.length;++Mt)Rt.doubleData[Mt]=Ct.json&&!isFinite(vt.doubleData[Mt])?String(vt.doubleData[Mt]):vt.doubleData[Mt]}if(vt.uint64Data&&vt.uint64Data.length){Rt.uint64Data=[];for(var Mt=0;Mt<vt.uint64Data.length;++Mt)typeof vt.uint64Data[Mt]=="number"?Rt.uint64Data[Mt]=Ct.longs===String?String(vt.uint64Data[Mt]):vt.uint64Data[Mt]:Rt.uint64Data[Mt]=Ct.longs===String?pt.Long.prototype.toString.call(vt.uint64Data[Mt]):Ct.longs===Number?new pt.LongBits(vt.uint64Data[Mt].low>>>0,vt.uint64Data[Mt].high>>>0).toNumber(!0):vt.uint64Data[Mt]}if(vt.docString!=null&&vt.hasOwnProperty("docString")&&(Rt.docString=vt.docString),vt.externalData&&vt.externalData.length){Rt.externalData=[];for(var Mt=0;Mt<vt.externalData.length;++Mt)Rt.externalData[Mt]=gt.onnx.StringStringEntryProto.toObject(vt.externalData[Mt],Ct)}return vt.dataLocation!=null&&vt.hasOwnProperty("dataLocation")&&(Rt.dataLocation=Ct.enums===String?gt.onnx.TensorProto.DataLocation[vt.dataLocation]===void 0?vt.dataLocation:gt.onnx.TensorProto.DataLocation[vt.dataLocation]:vt.dataLocation),Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.TensorProto"},wt.DataType=function(){var vt={},Ct=Object.create(vt);return Ct[vt[0]="UNDEFINED"]=0,Ct[vt[1]="FLOAT"]=1,Ct[vt[2]="UINT8"]=2,Ct[vt[3]="INT8"]=3,Ct[vt[4]="UINT16"]=4,Ct[vt[5]="INT16"]=5,Ct[vt[6]="INT32"]=6,Ct[vt[7]="INT64"]=7,Ct[vt[8]="STRING"]=8,Ct[vt[9]="BOOL"]=9,Ct[vt[10]="FLOAT16"]=10,Ct[vt[11]="DOUBLE"]=11,Ct[vt[12]="UINT32"]=12,Ct[vt[13]="UINT64"]=13,Ct[vt[14]="COMPLEX64"]=14,Ct[vt[15]="COMPLEX128"]=15,Ct[vt[16]="BFLOAT16"]=16,Ct[vt[17]="FLOAT8E4M3FN"]=17,Ct[vt[18]="FLOAT8E4M3FNUZ"]=18,Ct[vt[19]="FLOAT8E5M2"]=19,Ct[vt[20]="FLOAT8E5M2FNUZ"]=20,Ct}(),wt.Segment=function(){function vt(Ct){if(Ct)for(var Rt=Object.keys(Ct),Mt=0;Mt<Rt.length;++Mt)Ct[Rt[Mt]]!=null&&(this[Rt[Mt]]=Ct[Rt[Mt]])}return vt.prototype.begin=pt.Long?pt.Long.fromBits(0,0,!1):0,vt.prototype.end=pt.Long?pt.Long.fromBits(0,0,!1):0,vt.create=function(Ct){return new vt(Ct)},vt.encode=function(Ct,Rt){return Rt||(Rt=mt.create()),Ct.begin!=null&&Object.hasOwnProperty.call(Ct,"begin")&&Rt.uint32(8).int64(Ct.begin),Ct.end!=null&&Object.hasOwnProperty.call(Ct,"end")&&Rt.uint32(16).int64(Ct.end),Rt},vt.encodeDelimited=function(Ct,Rt){return this.encode(Ct,Rt).ldelim()},vt.decode=function(Ct,Rt){Ct instanceof ft||(Ct=ft.create(Ct));for(var Mt=Rt===void 0?Ct.len:Ct.pos+Rt,Ot=new gt.onnx.TensorProto.Segment;Ct.pos<Mt;){var Nt=Ct.uint32();switch(Nt>>>3){case 1:{Ot.begin=Ct.int64();break}case 2:{Ot.end=Ct.int64();break}default:Ct.skipType(Nt&7);break}}return Ot},vt.decodeDelimited=function(Ct){return Ct instanceof ft||(Ct=new ft(Ct)),this.decode(Ct,Ct.uint32())},vt.verify=function(Ct){return typeof Ct!="object"||Ct===null?"object expected":Ct.begin!=null&&Ct.hasOwnProperty("begin")&&!pt.isInteger(Ct.begin)&&!(Ct.begin&&pt.isInteger(Ct.begin.low)&&pt.isInteger(Ct.begin.high))?"begin: integer|Long expected":Ct.end!=null&&Ct.hasOwnProperty("end")&&!pt.isInteger(Ct.end)&&!(Ct.end&&pt.isInteger(Ct.end.low)&&pt.isInteger(Ct.end.high))?"end: integer|Long expected":null},vt.fromObject=function(Ct){if(Ct instanceof gt.onnx.TensorProto.Segment)return Ct;var Rt=new gt.onnx.TensorProto.Segment;return Ct.begin!=null&&(pt.Long?(Rt.begin=pt.Long.fromValue(Ct.begin)).unsigned=!1:typeof Ct.begin=="string"?Rt.begin=parseInt(Ct.begin,10):typeof Ct.begin=="number"?Rt.begin=Ct.begin:typeof Ct.begin=="object"&&(Rt.begin=new pt.LongBits(Ct.begin.low>>>0,Ct.begin.high>>>0).toNumber())),Ct.end!=null&&(pt.Long?(Rt.end=pt.Long.fromValue(Ct.end)).unsigned=!1:typeof Ct.end=="string"?Rt.end=parseInt(Ct.end,10):typeof Ct.end=="number"?Rt.end=Ct.end:typeof Ct.end=="object"&&(Rt.end=new pt.LongBits(Ct.end.low>>>0,Ct.end.high>>>0).toNumber())),Rt},vt.toObject=function(Ct,Rt){Rt||(Rt={});var Mt={};if(Rt.defaults){if(pt.Long){var Ot=new pt.Long(0,0,!1);Mt.begin=Rt.longs===String?Ot.toString():Rt.longs===Number?Ot.toNumber():Ot}else Mt.begin=Rt.longs===String?"0":0;if(pt.Long){var Ot=new pt.Long(0,0,!1);Mt.end=Rt.longs===String?Ot.toString():Rt.longs===Number?Ot.toNumber():Ot}else Mt.end=Rt.longs===String?"0":0}return Ct.begin!=null&&Ct.hasOwnProperty("begin")&&(typeof Ct.begin=="number"?Mt.begin=Rt.longs===String?String(Ct.begin):Ct.begin:Mt.begin=Rt.longs===String?pt.Long.prototype.toString.call(Ct.begin):Rt.longs===Number?new pt.LongBits(Ct.begin.low>>>0,Ct.begin.high>>>0).toNumber():Ct.begin),Ct.end!=null&&Ct.hasOwnProperty("end")&&(typeof Ct.end=="number"?Mt.end=Rt.longs===String?String(Ct.end):Ct.end:Mt.end=Rt.longs===String?pt.Long.prototype.toString.call(Ct.end):Rt.longs===Number?new pt.LongBits(Ct.end.low>>>0,Ct.end.high>>>0).toNumber():Ct.end),Mt},vt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},vt.getTypeUrl=function(Ct){return Ct===void 0&&(Ct="type.googleapis.com"),Ct+"/onnx.TensorProto.Segment"},vt}(),wt.DataLocation=function(){var vt={},Ct=Object.create(vt);return Ct[vt[0]="DEFAULT"]=0,Ct[vt[1]="EXTERNAL"]=1,Ct}(),wt}(),bt.SparseTensorProto=function(){function wt(vt){if(this.dims=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.values=null,wt.prototype.indices=null,wt.prototype.dims=pt.emptyArray,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.values!=null&&Object.hasOwnProperty.call(vt,"values")&&gt.onnx.TensorProto.encode(vt.values,Ct.uint32(10).fork()).ldelim(),vt.indices!=null&&Object.hasOwnProperty.call(vt,"indices")&&gt.onnx.TensorProto.encode(vt.indices,Ct.uint32(18).fork()).ldelim(),vt.dims!=null&&vt.dims.length){Ct.uint32(26).fork();for(var Rt=0;Rt<vt.dims.length;++Rt)Ct.int64(vt.dims[Rt]);Ct.ldelim()}return Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.SparseTensorProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.values=gt.onnx.TensorProto.decode(vt,vt.uint32());break}case 2:{Mt.indices=gt.onnx.TensorProto.decode(vt,vt.uint32());break}case 3:{if(Mt.dims&&Mt.dims.length||(Mt.dims=[]),(Ot&7)===2)for(var Nt=vt.uint32()+vt.pos;vt.pos<Nt;)Mt.dims.push(vt.int64());else Mt.dims.push(vt.int64());break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.values!=null&&vt.hasOwnProperty("values")){var Ct=gt.onnx.TensorProto.verify(vt.values);if(Ct)return"values."+Ct}if(vt.indices!=null&&vt.hasOwnProperty("indices")){var Ct=gt.onnx.TensorProto.verify(vt.indices);if(Ct)return"indices."+Ct}if(vt.dims!=null&&vt.hasOwnProperty("dims")){if(!Array.isArray(vt.dims))return"dims: array expected";for(var Rt=0;Rt<vt.dims.length;++Rt)if(!pt.isInteger(vt.dims[Rt])&&!(vt.dims[Rt]&&pt.isInteger(vt.dims[Rt].low)&&pt.isInteger(vt.dims[Rt].high)))return"dims: integer|Long[] expected"}return null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.SparseTensorProto)return vt;var Ct=new gt.onnx.SparseTensorProto;if(vt.values!=null){if(typeof vt.values!="object")throw TypeError(".onnx.SparseTensorProto.values: object expected");Ct.values=gt.onnx.TensorProto.fromObject(vt.values)}if(vt.indices!=null){if(typeof vt.indices!="object")throw TypeError(".onnx.SparseTensorProto.indices: object expected");Ct.indices=gt.onnx.TensorProto.fromObject(vt.indices)}if(vt.dims){if(!Array.isArray(vt.dims))throw TypeError(".onnx.SparseTensorProto.dims: array expected");Ct.dims=[];for(var Rt=0;Rt<vt.dims.length;++Rt)pt.Long?(Ct.dims[Rt]=pt.Long.fromValue(vt.dims[Rt])).unsigned=!1:typeof vt.dims[Rt]=="string"?Ct.dims[Rt]=parseInt(vt.dims[Rt],10):typeof vt.dims[Rt]=="number"?Ct.dims[Rt]=vt.dims[Rt]:typeof vt.dims[Rt]=="object"&&(Ct.dims[Rt]=new pt.LongBits(vt.dims[Rt].low>>>0,vt.dims[Rt].high>>>0).toNumber())}return Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.dims=[]),Ct.defaults&&(Rt.values=null,Rt.indices=null),vt.values!=null&&vt.hasOwnProperty("values")&&(Rt.values=gt.onnx.TensorProto.toObject(vt.values,Ct)),vt.indices!=null&&vt.hasOwnProperty("indices")&&(Rt.indices=gt.onnx.TensorProto.toObject(vt.indices,Ct)),vt.dims&&vt.dims.length){Rt.dims=[];for(var Mt=0;Mt<vt.dims.length;++Mt)typeof vt.dims[Mt]=="number"?Rt.dims[Mt]=Ct.longs===String?String(vt.dims[Mt]):vt.dims[Mt]:Rt.dims[Mt]=Ct.longs===String?pt.Long.prototype.toString.call(vt.dims[Mt]):Ct.longs===Number?new pt.LongBits(vt.dims[Mt].low>>>0,vt.dims[Mt].high>>>0).toNumber():vt.dims[Mt]}return Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.SparseTensorProto"},wt}(),bt.TensorShapeProto=function(){function wt(vt){if(this.dim=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.dim=pt.emptyArray,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.dim!=null&&vt.dim.length)for(var Rt=0;Rt<vt.dim.length;++Rt)gt.onnx.TensorShapeProto.Dimension.encode(vt.dim[Rt],Ct.uint32(10).fork()).ldelim();return Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.TensorShapeProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.dim&&Mt.dim.length||(Mt.dim=[]),Mt.dim.push(gt.onnx.TensorShapeProto.Dimension.decode(vt,vt.uint32()));break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.dim!=null&&vt.hasOwnProperty("dim")){if(!Array.isArray(vt.dim))return"dim: array expected";for(var Ct=0;Ct<vt.dim.length;++Ct){var Rt=gt.onnx.TensorShapeProto.Dimension.verify(vt.dim[Ct]);if(Rt)return"dim."+Rt}}return null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.TensorShapeProto)return vt;var Ct=new gt.onnx.TensorShapeProto;if(vt.dim){if(!Array.isArray(vt.dim))throw TypeError(".onnx.TensorShapeProto.dim: array expected");Ct.dim=[];for(var Rt=0;Rt<vt.dim.length;++Rt){if(typeof vt.dim[Rt]!="object")throw TypeError(".onnx.TensorShapeProto.dim: object expected");Ct.dim[Rt]=gt.onnx.TensorShapeProto.Dimension.fromObject(vt.dim[Rt])}}return Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.dim=[]),vt.dim&&vt.dim.length){Rt.dim=[];for(var Mt=0;Mt<vt.dim.length;++Mt)Rt.dim[Mt]=gt.onnx.TensorShapeProto.Dimension.toObject(vt.dim[Mt],Ct)}return Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.TensorShapeProto"},wt.Dimension=function(){function vt(Rt){if(Rt)for(var Mt=Object.keys(Rt),Ot=0;Ot<Mt.length;++Ot)Rt[Mt[Ot]]!=null&&(this[Mt[Ot]]=Rt[Mt[Ot]])}vt.prototype.dimValue=null,vt.prototype.dimParam=null,vt.prototype.denotation="";var Ct;return Object.defineProperty(vt.prototype,"value",{get:pt.oneOfGetter(Ct=["dimValue","dimParam"]),set:pt.oneOfSetter(Ct)}),vt.create=function(Rt){return new vt(Rt)},vt.encode=function(Rt,Mt){return Mt||(Mt=mt.create()),Rt.dimValue!=null&&Object.hasOwnProperty.call(Rt,"dimValue")&&Mt.uint32(8).int64(Rt.dimValue),Rt.dimParam!=null&&Object.hasOwnProperty.call(Rt,"dimParam")&&Mt.uint32(18).string(Rt.dimParam),Rt.denotation!=null&&Object.hasOwnProperty.call(Rt,"denotation")&&Mt.uint32(26).string(Rt.denotation),Mt},vt.encodeDelimited=function(Rt,Mt){return this.encode(Rt,Mt).ldelim()},vt.decode=function(Rt,Mt){Rt instanceof ft||(Rt=ft.create(Rt));for(var Ot=Mt===void 0?Rt.len:Rt.pos+Mt,Nt=new gt.onnx.TensorShapeProto.Dimension;Rt.pos<Ot;){var Ht=Rt.uint32();switch(Ht>>>3){case 1:{Nt.dimValue=Rt.int64();break}case 2:{Nt.dimParam=Rt.string();break}case 3:{Nt.denotation=Rt.string();break}default:Rt.skipType(Ht&7);break}}return Nt},vt.decodeDelimited=function(Rt){return Rt instanceof ft||(Rt=new ft(Rt)),this.decode(Rt,Rt.uint32())},vt.verify=function(Rt){if(typeof Rt!="object"||Rt===null)return"object expected";var Mt={};if(Rt.dimValue!=null&&Rt.hasOwnProperty("dimValue")&&(Mt.value=1,!pt.isInteger(Rt.dimValue)&&!(Rt.dimValue&&pt.isInteger(Rt.dimValue.low)&&pt.isInteger(Rt.dimValue.high))))return"dimValue: integer|Long expected";if(Rt.dimParam!=null&&Rt.hasOwnProperty("dimParam")){if(Mt.value===1)return"value: multiple values";if(Mt.value=1,!pt.isString(Rt.dimParam))return"dimParam: string expected"}return Rt.denotation!=null&&Rt.hasOwnProperty("denotation")&&!pt.isString(Rt.denotation)?"denotation: string expected":null},vt.fromObject=function(Rt){if(Rt instanceof gt.onnx.TensorShapeProto.Dimension)return Rt;var Mt=new gt.onnx.TensorShapeProto.Dimension;return Rt.dimValue!=null&&(pt.Long?(Mt.dimValue=pt.Long.fromValue(Rt.dimValue)).unsigned=!1:typeof Rt.dimValue=="string"?Mt.dimValue=parseInt(Rt.dimValue,10):typeof Rt.dimValue=="number"?Mt.dimValue=Rt.dimValue:typeof Rt.dimValue=="object"&&(Mt.dimValue=new pt.LongBits(Rt.dimValue.low>>>0,Rt.dimValue.high>>>0).toNumber())),Rt.dimParam!=null&&(Mt.dimParam=String(Rt.dimParam)),Rt.denotation!=null&&(Mt.denotation=String(Rt.denotation)),Mt},vt.toObject=function(Rt,Mt){Mt||(Mt={});var Ot={};return Mt.defaults&&(Ot.denotation=""),Rt.dimValue!=null&&Rt.hasOwnProperty("dimValue")&&(typeof Rt.dimValue=="number"?Ot.dimValue=Mt.longs===String?String(Rt.dimValue):Rt.dimValue:Ot.dimValue=Mt.longs===String?pt.Long.prototype.toString.call(Rt.dimValue):Mt.longs===Number?new pt.LongBits(Rt.dimValue.low>>>0,Rt.dimValue.high>>>0).toNumber():Rt.dimValue,Mt.oneofs&&(Ot.value="dimValue")),Rt.dimParam!=null&&Rt.hasOwnProperty("dimParam")&&(Ot.dimParam=Rt.dimParam,Mt.oneofs&&(Ot.value="dimParam")),Rt.denotation!=null&&Rt.hasOwnProperty("denotation")&&(Ot.denotation=Rt.denotation),Ot},vt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},vt.getTypeUrl=function(Rt){return Rt===void 0&&(Rt="type.googleapis.com"),Rt+"/onnx.TensorShapeProto.Dimension"},vt}(),wt}(),bt.TypeProto=function(){function wt(Ct){if(Ct)for(var Rt=Object.keys(Ct),Mt=0;Mt<Rt.length;++Mt)Ct[Rt[Mt]]!=null&&(this[Rt[Mt]]=Ct[Rt[Mt]])}wt.prototype.tensorType=null,wt.prototype.sequenceType=null,wt.prototype.mapType=null,wt.prototype.optionalType=null,wt.prototype.sparseTensorType=null,wt.prototype.denotation="";var vt;return Object.defineProperty(wt.prototype,"value",{get:pt.oneOfGetter(vt=["tensorType","sequenceType","mapType","optionalType","sparseTensorType"]),set:pt.oneOfSetter(vt)}),wt.create=function(Ct){return new wt(Ct)},wt.encode=function(Ct,Rt){return Rt||(Rt=mt.create()),Ct.tensorType!=null&&Object.hasOwnProperty.call(Ct,"tensorType")&&gt.onnx.TypeProto.Tensor.encode(Ct.tensorType,Rt.uint32(10).fork()).ldelim(),Ct.sequenceType!=null&&Object.hasOwnProperty.call(Ct,"sequenceType")&&gt.onnx.TypeProto.Sequence.encode(Ct.sequenceType,Rt.uint32(34).fork()).ldelim(),Ct.mapType!=null&&Object.hasOwnProperty.call(Ct,"mapType")&&gt.onnx.TypeProto.Map.encode(Ct.mapType,Rt.uint32(42).fork()).ldelim(),Ct.denotation!=null&&Object.hasOwnProperty.call(Ct,"denotation")&&Rt.uint32(50).string(Ct.denotation),Ct.sparseTensorType!=null&&Object.hasOwnProperty.call(Ct,"sparseTensorType")&&gt.onnx.TypeProto.SparseTensor.encode(Ct.sparseTensorType,Rt.uint32(66).fork()).ldelim(),Ct.optionalType!=null&&Object.hasOwnProperty.call(Ct,"optionalType")&&gt.onnx.TypeProto.Optional.encode(Ct.optionalType,Rt.uint32(74).fork()).ldelim(),Rt},wt.encodeDelimited=function(Ct,Rt){return this.encode(Ct,Rt).ldelim()},wt.decode=function(Ct,Rt){Ct instanceof ft||(Ct=ft.create(Ct));for(var Mt=Rt===void 0?Ct.len:Ct.pos+Rt,Ot=new gt.onnx.TypeProto;Ct.pos<Mt;){var Nt=Ct.uint32();switch(Nt>>>3){case 1:{Ot.tensorType=gt.onnx.TypeProto.Tensor.decode(Ct,Ct.uint32());break}case 4:{Ot.sequenceType=gt.onnx.TypeProto.Sequence.decode(Ct,Ct.uint32());break}case 5:{Ot.mapType=gt.onnx.TypeProto.Map.decode(Ct,Ct.uint32());break}case 9:{Ot.optionalType=gt.onnx.TypeProto.Optional.decode(Ct,Ct.uint32());break}case 8:{Ot.sparseTensorType=gt.onnx.TypeProto.SparseTensor.decode(Ct,Ct.uint32());break}case 6:{Ot.denotation=Ct.string();break}default:Ct.skipType(Nt&7);break}}return Ot},wt.decodeDelimited=function(Ct){return Ct instanceof ft||(Ct=new ft(Ct)),this.decode(Ct,Ct.uint32())},wt.verify=function(Ct){if(typeof Ct!="object"||Ct===null)return"object expected";var Rt={};if(Ct.tensorType!=null&&Ct.hasOwnProperty("tensorType")){Rt.value=1;{var Mt=gt.onnx.TypeProto.Tensor.verify(Ct.tensorType);if(Mt)return"tensorType."+Mt}}if(Ct.sequenceType!=null&&Ct.hasOwnProperty("sequenceType")){if(Rt.value===1)return"value: multiple values";Rt.value=1;{var Mt=gt.onnx.TypeProto.Sequence.verify(Ct.sequenceType);if(Mt)return"sequenceType."+Mt}}if(Ct.mapType!=null&&Ct.hasOwnProperty("mapType")){if(Rt.value===1)return"value: multiple values";Rt.value=1;{var Mt=gt.onnx.TypeProto.Map.verify(Ct.mapType);if(Mt)return"mapType."+Mt}}if(Ct.optionalType!=null&&Ct.hasOwnProperty("optionalType")){if(Rt.value===1)return"value: multiple values";Rt.value=1;{var Mt=gt.onnx.TypeProto.Optional.verify(Ct.optionalType);if(Mt)return"optionalType."+Mt}}if(Ct.sparseTensorType!=null&&Ct.hasOwnProperty("sparseTensorType")){if(Rt.value===1)return"value: multiple values";Rt.value=1;{var Mt=gt.onnx.TypeProto.SparseTensor.verify(Ct.sparseTensorType);if(Mt)return"sparseTensorType."+Mt}}return Ct.denotation!=null&&Ct.hasOwnProperty("denotation")&&!pt.isString(Ct.denotation)?"denotation: string expected":null},wt.fromObject=function(Ct){if(Ct instanceof gt.onnx.TypeProto)return Ct;var Rt=new gt.onnx.TypeProto;if(Ct.tensorType!=null){if(typeof Ct.tensorType!="object")throw TypeError(".onnx.TypeProto.tensorType: object expected");Rt.tensorType=gt.onnx.TypeProto.Tensor.fromObject(Ct.tensorType)}if(Ct.sequenceType!=null){if(typeof Ct.sequenceType!="object")throw TypeError(".onnx.TypeProto.sequenceType: object expected");Rt.sequenceType=gt.onnx.TypeProto.Sequence.fromObject(Ct.sequenceType)}if(Ct.mapType!=null){if(typeof Ct.mapType!="object")throw TypeError(".onnx.TypeProto.mapType: object expected");Rt.mapType=gt.onnx.TypeProto.Map.fromObject(Ct.mapType)}if(Ct.optionalType!=null){if(typeof Ct.optionalType!="object")throw TypeError(".onnx.TypeProto.optionalType: object expected");Rt.optionalType=gt.onnx.TypeProto.Optional.fromObject(Ct.optionalType)}if(Ct.sparseTensorType!=null){if(typeof Ct.sparseTensorType!="object")throw TypeError(".onnx.TypeProto.sparseTensorType: object expected");Rt.sparseTensorType=gt.onnx.TypeProto.SparseTensor.fromObject(Ct.sparseTensorType)}return Ct.denotation!=null&&(Rt.denotation=String(Ct.denotation)),Rt},wt.toObject=function(Ct,Rt){Rt||(Rt={});var Mt={};return Rt.defaults&&(Mt.denotation=""),Ct.tensorType!=null&&Ct.hasOwnProperty("tensorType")&&(Mt.tensorType=gt.onnx.TypeProto.Tensor.toObject(Ct.tensorType,Rt),Rt.oneofs&&(Mt.value="tensorType")),Ct.sequenceType!=null&&Ct.hasOwnProperty("sequenceType")&&(Mt.sequenceType=gt.onnx.TypeProto.Sequence.toObject(Ct.sequenceType,Rt),Rt.oneofs&&(Mt.value="sequenceType")),Ct.mapType!=null&&Ct.hasOwnProperty("mapType")&&(Mt.mapType=gt.onnx.TypeProto.Map.toObject(Ct.mapType,Rt),Rt.oneofs&&(Mt.value="mapType")),Ct.denotation!=null&&Ct.hasOwnProperty("denotation")&&(Mt.denotation=Ct.denotation),Ct.sparseTensorType!=null&&Ct.hasOwnProperty("sparseTensorType")&&(Mt.sparseTensorType=gt.onnx.TypeProto.SparseTensor.toObject(Ct.sparseTensorType,Rt),Rt.oneofs&&(Mt.value="sparseTensorType")),Ct.optionalType!=null&&Ct.hasOwnProperty("optionalType")&&(Mt.optionalType=gt.onnx.TypeProto.Optional.toObject(Ct.optionalType,Rt),Rt.oneofs&&(Mt.value="optionalType")),Mt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(Ct){return Ct===void 0&&(Ct="type.googleapis.com"),Ct+"/onnx.TypeProto"},wt.Tensor=function(){function Ct(Rt){if(Rt)for(var Mt=Object.keys(Rt),Ot=0;Ot<Mt.length;++Ot)Rt[Mt[Ot]]!=null&&(this[Mt[Ot]]=Rt[Mt[Ot]])}return Ct.prototype.elemType=0,Ct.prototype.shape=null,Ct.create=function(Rt){return new Ct(Rt)},Ct.encode=function(Rt,Mt){return Mt||(Mt=mt.create()),Rt.elemType!=null&&Object.hasOwnProperty.call(Rt,"elemType")&&Mt.uint32(8).int32(Rt.elemType),Rt.shape!=null&&Object.hasOwnProperty.call(Rt,"shape")&&gt.onnx.TensorShapeProto.encode(Rt.shape,Mt.uint32(18).fork()).ldelim(),Mt},Ct.encodeDelimited=function(Rt,Mt){return this.encode(Rt,Mt).ldelim()},Ct.decode=function(Rt,Mt){Rt instanceof ft||(Rt=ft.create(Rt));for(var Ot=Mt===void 0?Rt.len:Rt.pos+Mt,Nt=new gt.onnx.TypeProto.Tensor;Rt.pos<Ot;){var Ht=Rt.uint32();switch(Ht>>>3){case 1:{Nt.elemType=Rt.int32();break}case 2:{Nt.shape=gt.onnx.TensorShapeProto.decode(Rt,Rt.uint32());break}default:Rt.skipType(Ht&7);break}}return Nt},Ct.decodeDelimited=function(Rt){return Rt instanceof ft||(Rt=new ft(Rt)),this.decode(Rt,Rt.uint32())},Ct.verify=function(Rt){if(typeof Rt!="object"||Rt===null)return"object expected";if(Rt.elemType!=null&&Rt.hasOwnProperty("elemType")&&!pt.isInteger(Rt.elemType))return"elemType: integer expected";if(Rt.shape!=null&&Rt.hasOwnProperty("shape")){var Mt=gt.onnx.TensorShapeProto.verify(Rt.shape);if(Mt)return"shape."+Mt}return null},Ct.fromObject=function(Rt){if(Rt instanceof gt.onnx.TypeProto.Tensor)return Rt;var Mt=new gt.onnx.TypeProto.Tensor;if(Rt.elemType!=null&&(Mt.elemType=Rt.elemType|0),Rt.shape!=null){if(typeof Rt.shape!="object")throw TypeError(".onnx.TypeProto.Tensor.shape: object expected");Mt.shape=gt.onnx.TensorShapeProto.fromObject(Rt.shape)}return Mt},Ct.toObject=function(Rt,Mt){Mt||(Mt={});var Ot={};return Mt.defaults&&(Ot.elemType=0,Ot.shape=null),Rt.elemType!=null&&Rt.hasOwnProperty("elemType")&&(Ot.elemType=Rt.elemType),Rt.shape!=null&&Rt.hasOwnProperty("shape")&&(Ot.shape=gt.onnx.TensorShapeProto.toObject(Rt.shape,Mt)),Ot},Ct.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},Ct.getTypeUrl=function(Rt){return Rt===void 0&&(Rt="type.googleapis.com"),Rt+"/onnx.TypeProto.Tensor"},Ct}(),wt.Sequence=function(){function Ct(Rt){if(Rt)for(var Mt=Object.keys(Rt),Ot=0;Ot<Mt.length;++Ot)Rt[Mt[Ot]]!=null&&(this[Mt[Ot]]=Rt[Mt[Ot]])}return Ct.prototype.elemType=null,Ct.create=function(Rt){return new Ct(Rt)},Ct.encode=function(Rt,Mt){return Mt||(Mt=mt.create()),Rt.elemType!=null&&Object.hasOwnProperty.call(Rt,"elemType")&&gt.onnx.TypeProto.encode(Rt.elemType,Mt.uint32(10).fork()).ldelim(),Mt},Ct.encodeDelimited=function(Rt,Mt){return this.encode(Rt,Mt).ldelim()},Ct.decode=function(Rt,Mt){Rt instanceof ft||(Rt=ft.create(Rt));for(var Ot=Mt===void 0?Rt.len:Rt.pos+Mt,Nt=new gt.onnx.TypeProto.Sequence;Rt.pos<Ot;){var Ht=Rt.uint32();switch(Ht>>>3){case 1:{Nt.elemType=gt.onnx.TypeProto.decode(Rt,Rt.uint32());break}default:Rt.skipType(Ht&7);break}}return Nt},Ct.decodeDelimited=function(Rt){return Rt instanceof ft||(Rt=new ft(Rt)),this.decode(Rt,Rt.uint32())},Ct.verify=function(Rt){if(typeof Rt!="object"||Rt===null)return"object expected";if(Rt.elemType!=null&&Rt.hasOwnProperty("elemType")){var Mt=gt.onnx.TypeProto.verify(Rt.elemType);if(Mt)return"elemType."+Mt}return null},Ct.fromObject=function(Rt){if(Rt instanceof gt.onnx.TypeProto.Sequence)return Rt;var Mt=new gt.onnx.TypeProto.Sequence;if(Rt.elemType!=null){if(typeof Rt.elemType!="object")throw TypeError(".onnx.TypeProto.Sequence.elemType: object expected");Mt.elemType=gt.onnx.TypeProto.fromObject(Rt.elemType)}return Mt},Ct.toObject=function(Rt,Mt){Mt||(Mt={});var Ot={};return Mt.defaults&&(Ot.elemType=null),Rt.elemType!=null&&Rt.hasOwnProperty("elemType")&&(Ot.elemType=gt.onnx.TypeProto.toObject(Rt.elemType,Mt)),Ot},Ct.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},Ct.getTypeUrl=function(Rt){return Rt===void 0&&(Rt="type.googleapis.com"),Rt+"/onnx.TypeProto.Sequence"},Ct}(),wt.Map=function(){function Ct(Rt){if(Rt)for(var Mt=Object.keys(Rt),Ot=0;Ot<Mt.length;++Ot)Rt[Mt[Ot]]!=null&&(this[Mt[Ot]]=Rt[Mt[Ot]])}return Ct.prototype.keyType=0,Ct.prototype.valueType=null,Ct.create=function(Rt){return new Ct(Rt)},Ct.encode=function(Rt,Mt){return Mt||(Mt=mt.create()),Rt.keyType!=null&&Object.hasOwnProperty.call(Rt,"keyType")&&Mt.uint32(8).int32(Rt.keyType),Rt.valueType!=null&&Object.hasOwnProperty.call(Rt,"valueType")&&gt.onnx.TypeProto.encode(Rt.valueType,Mt.uint32(18).fork()).ldelim(),Mt},Ct.encodeDelimited=function(Rt,Mt){return this.encode(Rt,Mt).ldelim()},Ct.decode=function(Rt,Mt){Rt instanceof ft||(Rt=ft.create(Rt));for(var Ot=Mt===void 0?Rt.len:Rt.pos+Mt,Nt=new gt.onnx.TypeProto.Map;Rt.pos<Ot;){var Ht=Rt.uint32();switch(Ht>>>3){case 1:{Nt.keyType=Rt.int32();break}case 2:{Nt.valueType=gt.onnx.TypeProto.decode(Rt,Rt.uint32());break}default:Rt.skipType(Ht&7);break}}return Nt},Ct.decodeDelimited=function(Rt){return Rt instanceof ft||(Rt=new ft(Rt)),this.decode(Rt,Rt.uint32())},Ct.verify=function(Rt){if(typeof Rt!="object"||Rt===null)return"object expected";if(Rt.keyType!=null&&Rt.hasOwnProperty("keyType")&&!pt.isInteger(Rt.keyType))return"keyType: integer expected";if(Rt.valueType!=null&&Rt.hasOwnProperty("valueType")){var Mt=gt.onnx.TypeProto.verify(Rt.valueType);if(Mt)return"valueType."+Mt}return null},Ct.fromObject=function(Rt){if(Rt instanceof gt.onnx.TypeProto.Map)return Rt;var Mt=new gt.onnx.TypeProto.Map;if(Rt.keyType!=null&&(Mt.keyType=Rt.keyType|0),Rt.valueType!=null){if(typeof Rt.valueType!="object")throw TypeError(".onnx.TypeProto.Map.valueType: object expected");Mt.valueType=gt.onnx.TypeProto.fromObject(Rt.valueType)}return Mt},Ct.toObject=function(Rt,Mt){Mt||(Mt={});var Ot={};return Mt.defaults&&(Ot.keyType=0,Ot.valueType=null),Rt.keyType!=null&&Rt.hasOwnProperty("keyType")&&(Ot.keyType=Rt.keyType),Rt.valueType!=null&&Rt.hasOwnProperty("valueType")&&(Ot.valueType=gt.onnx.TypeProto.toObject(Rt.valueType,Mt)),Ot},Ct.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},Ct.getTypeUrl=function(Rt){return Rt===void 0&&(Rt="type.googleapis.com"),Rt+"/onnx.TypeProto.Map"},Ct}(),wt.Optional=function(){function Ct(Rt){if(Rt)for(var Mt=Object.keys(Rt),Ot=0;Ot<Mt.length;++Ot)Rt[Mt[Ot]]!=null&&(this[Mt[Ot]]=Rt[Mt[Ot]])}return Ct.prototype.elemType=null,Ct.create=function(Rt){return new Ct(Rt)},Ct.encode=function(Rt,Mt){return Mt||(Mt=mt.create()),Rt.elemType!=null&&Object.hasOwnProperty.call(Rt,"elemType")&&gt.onnx.TypeProto.encode(Rt.elemType,Mt.uint32(10).fork()).ldelim(),Mt},Ct.encodeDelimited=function(Rt,Mt){return this.encode(Rt,Mt).ldelim()},Ct.decode=function(Rt,Mt){Rt instanceof ft||(Rt=ft.create(Rt));for(var Ot=Mt===void 0?Rt.len:Rt.pos+Mt,Nt=new gt.onnx.TypeProto.Optional;Rt.pos<Ot;){var Ht=Rt.uint32();switch(Ht>>>3){case 1:{Nt.elemType=gt.onnx.TypeProto.decode(Rt,Rt.uint32());break}default:Rt.skipType(Ht&7);break}}return Nt},Ct.decodeDelimited=function(Rt){return Rt instanceof ft||(Rt=new ft(Rt)),this.decode(Rt,Rt.uint32())},Ct.verify=function(Rt){if(typeof Rt!="object"||Rt===null)return"object expected";if(Rt.elemType!=null&&Rt.hasOwnProperty("elemType")){var Mt=gt.onnx.TypeProto.verify(Rt.elemType);if(Mt)return"elemType."+Mt}return null},Ct.fromObject=function(Rt){if(Rt instanceof gt.onnx.TypeProto.Optional)return Rt;var Mt=new gt.onnx.TypeProto.Optional;if(Rt.elemType!=null){if(typeof Rt.elemType!="object")throw TypeError(".onnx.TypeProto.Optional.elemType: object expected");Mt.elemType=gt.onnx.TypeProto.fromObject(Rt.elemType)}return Mt},Ct.toObject=function(Rt,Mt){Mt||(Mt={});var Ot={};return Mt.defaults&&(Ot.elemType=null),Rt.elemType!=null&&Rt.hasOwnProperty("elemType")&&(Ot.elemType=gt.onnx.TypeProto.toObject(Rt.elemType,Mt)),Ot},Ct.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},Ct.getTypeUrl=function(Rt){return Rt===void 0&&(Rt="type.googleapis.com"),Rt+"/onnx.TypeProto.Optional"},Ct}(),wt.SparseTensor=function(){function Ct(Rt){if(Rt)for(var Mt=Object.keys(Rt),Ot=0;Ot<Mt.length;++Ot)Rt[Mt[Ot]]!=null&&(this[Mt[Ot]]=Rt[Mt[Ot]])}return Ct.prototype.elemType=0,Ct.prototype.shape=null,Ct.create=function(Rt){return new Ct(Rt)},Ct.encode=function(Rt,Mt){return Mt||(Mt=mt.create()),Rt.elemType!=null&&Object.hasOwnProperty.call(Rt,"elemType")&&Mt.uint32(8).int32(Rt.elemType),Rt.shape!=null&&Object.hasOwnProperty.call(Rt,"shape")&&gt.onnx.TensorShapeProto.encode(Rt.shape,Mt.uint32(18).fork()).ldelim(),Mt},Ct.encodeDelimited=function(Rt,Mt){return this.encode(Rt,Mt).ldelim()},Ct.decode=function(Rt,Mt){Rt instanceof ft||(Rt=ft.create(Rt));for(var Ot=Mt===void 0?Rt.len:Rt.pos+Mt,Nt=new gt.onnx.TypeProto.SparseTensor;Rt.pos<Ot;){var Ht=Rt.uint32();switch(Ht>>>3){case 1:{Nt.elemType=Rt.int32();break}case 2:{Nt.shape=gt.onnx.TensorShapeProto.decode(Rt,Rt.uint32());break}default:Rt.skipType(Ht&7);break}}return Nt},Ct.decodeDelimited=function(Rt){return Rt instanceof ft||(Rt=new ft(Rt)),this.decode(Rt,Rt.uint32())},Ct.verify=function(Rt){if(typeof Rt!="object"||Rt===null)return"object expected";if(Rt.elemType!=null&&Rt.hasOwnProperty("elemType")&&!pt.isInteger(Rt.elemType))return"elemType: integer expected";if(Rt.shape!=null&&Rt.hasOwnProperty("shape")){var Mt=gt.onnx.TensorShapeProto.verify(Rt.shape);if(Mt)return"shape."+Mt}return null},Ct.fromObject=function(Rt){if(Rt instanceof gt.onnx.TypeProto.SparseTensor)return Rt;var Mt=new gt.onnx.TypeProto.SparseTensor;if(Rt.elemType!=null&&(Mt.elemType=Rt.elemType|0),Rt.shape!=null){if(typeof Rt.shape!="object")throw TypeError(".onnx.TypeProto.SparseTensor.shape: object expected");Mt.shape=gt.onnx.TensorShapeProto.fromObject(Rt.shape)}return Mt},Ct.toObject=function(Rt,Mt){Mt||(Mt={});var Ot={};return Mt.defaults&&(Ot.elemType=0,Ot.shape=null),Rt.elemType!=null&&Rt.hasOwnProperty("elemType")&&(Ot.elemType=Rt.elemType),Rt.shape!=null&&Rt.hasOwnProperty("shape")&&(Ot.shape=gt.onnx.TensorShapeProto.toObject(Rt.shape,Mt)),Ot},Ct.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},Ct.getTypeUrl=function(Rt){return Rt===void 0&&(Rt="type.googleapis.com"),Rt+"/onnx.TypeProto.SparseTensor"},Ct}(),wt}(),bt.OperatorSetIdProto=function(){function wt(vt){if(vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.domain="",wt.prototype.version=pt.Long?pt.Long.fromBits(0,0,!1):0,wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){return Ct||(Ct=mt.create()),vt.domain!=null&&Object.hasOwnProperty.call(vt,"domain")&&Ct.uint32(10).string(vt.domain),vt.version!=null&&Object.hasOwnProperty.call(vt,"version")&&Ct.uint32(16).int64(vt.version),Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.OperatorSetIdProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.domain=vt.string();break}case 2:{Mt.version=vt.int64();break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){return typeof vt!="object"||vt===null?"object expected":vt.domain!=null&&vt.hasOwnProperty("domain")&&!pt.isString(vt.domain)?"domain: string expected":vt.version!=null&&vt.hasOwnProperty("version")&&!pt.isInteger(vt.version)&&!(vt.version&&pt.isInteger(vt.version.low)&&pt.isInteger(vt.version.high))?"version: integer|Long expected":null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.OperatorSetIdProto)return vt;var Ct=new gt.onnx.OperatorSetIdProto;return vt.domain!=null&&(Ct.domain=String(vt.domain)),vt.version!=null&&(pt.Long?(Ct.version=pt.Long.fromValue(vt.version)).unsigned=!1:typeof vt.version=="string"?Ct.version=parseInt(vt.version,10):typeof vt.version=="number"?Ct.version=vt.version:typeof vt.version=="object"&&(Ct.version=new pt.LongBits(vt.version.low>>>0,vt.version.high>>>0).toNumber())),Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if(Ct.defaults)if(Rt.domain="",pt.Long){var Mt=new pt.Long(0,0,!1);Rt.version=Ct.longs===String?Mt.toString():Ct.longs===Number?Mt.toNumber():Mt}else Rt.version=Ct.longs===String?"0":0;return vt.domain!=null&&vt.hasOwnProperty("domain")&&(Rt.domain=vt.domain),vt.version!=null&&vt.hasOwnProperty("version")&&(typeof vt.version=="number"?Rt.version=Ct.longs===String?String(vt.version):vt.version:Rt.version=Ct.longs===String?pt.Long.prototype.toString.call(vt.version):Ct.longs===Number?new pt.LongBits(vt.version.low>>>0,vt.version.high>>>0).toNumber():vt.version),Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.OperatorSetIdProto"},wt}(),bt.OperatorStatus=function(){var wt={},vt=Object.create(wt);return vt[wt[0]="EXPERIMENTAL"]=0,vt[wt[1]="STABLE"]=1,vt}(),bt.FunctionProto=function(){function wt(vt){if(this.input=[],this.output=[],this.attribute=[],this.attributeProto=[],this.node=[],this.opsetImport=[],vt)for(var Ct=Object.keys(vt),Rt=0;Rt<Ct.length;++Rt)vt[Ct[Rt]]!=null&&(this[Ct[Rt]]=vt[Ct[Rt]])}return wt.prototype.name="",wt.prototype.input=pt.emptyArray,wt.prototype.output=pt.emptyArray,wt.prototype.attribute=pt.emptyArray,wt.prototype.attributeProto=pt.emptyArray,wt.prototype.node=pt.emptyArray,wt.prototype.docString="",wt.prototype.opsetImport=pt.emptyArray,wt.prototype.domain="",wt.create=function(vt){return new wt(vt)},wt.encode=function(vt,Ct){if(Ct||(Ct=mt.create()),vt.name!=null&&Object.hasOwnProperty.call(vt,"name")&&Ct.uint32(10).string(vt.name),vt.input!=null&&vt.input.length)for(var Rt=0;Rt<vt.input.length;++Rt)Ct.uint32(34).string(vt.input[Rt]);if(vt.output!=null&&vt.output.length)for(var Rt=0;Rt<vt.output.length;++Rt)Ct.uint32(42).string(vt.output[Rt]);if(vt.attribute!=null&&vt.attribute.length)for(var Rt=0;Rt<vt.attribute.length;++Rt)Ct.uint32(50).string(vt.attribute[Rt]);if(vt.node!=null&&vt.node.length)for(var Rt=0;Rt<vt.node.length;++Rt)gt.onnx.NodeProto.encode(vt.node[Rt],Ct.uint32(58).fork()).ldelim();if(vt.docString!=null&&Object.hasOwnProperty.call(vt,"docString")&&Ct.uint32(66).string(vt.docString),vt.opsetImport!=null&&vt.opsetImport.length)for(var Rt=0;Rt<vt.opsetImport.length;++Rt)gt.onnx.OperatorSetIdProto.encode(vt.opsetImport[Rt],Ct.uint32(74).fork()).ldelim();if(vt.domain!=null&&Object.hasOwnProperty.call(vt,"domain")&&Ct.uint32(82).string(vt.domain),vt.attributeProto!=null&&vt.attributeProto.length)for(var Rt=0;Rt<vt.attributeProto.length;++Rt)gt.onnx.AttributeProto.encode(vt.attributeProto[Rt],Ct.uint32(90).fork()).ldelim();return Ct},wt.encodeDelimited=function(vt,Ct){return this.encode(vt,Ct).ldelim()},wt.decode=function(vt,Ct){vt instanceof ft||(vt=ft.create(vt));for(var Rt=Ct===void 0?vt.len:vt.pos+Ct,Mt=new gt.onnx.FunctionProto;vt.pos<Rt;){var Ot=vt.uint32();switch(Ot>>>3){case 1:{Mt.name=vt.string();break}case 4:{Mt.input&&Mt.input.length||(Mt.input=[]),Mt.input.push(vt.string());break}case 5:{Mt.output&&Mt.output.length||(Mt.output=[]),Mt.output.push(vt.string());break}case 6:{Mt.attribute&&Mt.attribute.length||(Mt.attribute=[]),Mt.attribute.push(vt.string());break}case 11:{Mt.attributeProto&&Mt.attributeProto.length||(Mt.attributeProto=[]),Mt.attributeProto.push(gt.onnx.AttributeProto.decode(vt,vt.uint32()));break}case 7:{Mt.node&&Mt.node.length||(Mt.node=[]),Mt.node.push(gt.onnx.NodeProto.decode(vt,vt.uint32()));break}case 8:{Mt.docString=vt.string();break}case 9:{Mt.opsetImport&&Mt.opsetImport.length||(Mt.opsetImport=[]),Mt.opsetImport.push(gt.onnx.OperatorSetIdProto.decode(vt,vt.uint32()));break}case 10:{Mt.domain=vt.string();break}default:vt.skipType(Ot&7);break}}return Mt},wt.decodeDelimited=function(vt){return vt instanceof ft||(vt=new ft(vt)),this.decode(vt,vt.uint32())},wt.verify=function(vt){if(typeof vt!="object"||vt===null)return"object expected";if(vt.name!=null&&vt.hasOwnProperty("name")&&!pt.isString(vt.name))return"name: string expected";if(vt.input!=null&&vt.hasOwnProperty("input")){if(!Array.isArray(vt.input))return"input: array expected";for(var Ct=0;Ct<vt.input.length;++Ct)if(!pt.isString(vt.input[Ct]))return"input: string[] expected"}if(vt.output!=null&&vt.hasOwnProperty("output")){if(!Array.isArray(vt.output))return"output: array expected";for(var Ct=0;Ct<vt.output.length;++Ct)if(!pt.isString(vt.output[Ct]))return"output: string[] expected"}if(vt.attribute!=null&&vt.hasOwnProperty("attribute")){if(!Array.isArray(vt.attribute))return"attribute: array expected";for(var Ct=0;Ct<vt.attribute.length;++Ct)if(!pt.isString(vt.attribute[Ct]))return"attribute: string[] expected"}if(vt.attributeProto!=null&&vt.hasOwnProperty("attributeProto")){if(!Array.isArray(vt.attributeProto))return"attributeProto: array expected";for(var Ct=0;Ct<vt.attributeProto.length;++Ct){var Rt=gt.onnx.AttributeProto.verify(vt.attributeProto[Ct]);if(Rt)return"attributeProto."+Rt}}if(vt.node!=null&&vt.hasOwnProperty("node")){if(!Array.isArray(vt.node))return"node: array expected";for(var Ct=0;Ct<vt.node.length;++Ct){var Rt=gt.onnx.NodeProto.verify(vt.node[Ct]);if(Rt)return"node."+Rt}}if(vt.docString!=null&&vt.hasOwnProperty("docString")&&!pt.isString(vt.docString))return"docString: string expected";if(vt.opsetImport!=null&&vt.hasOwnProperty("opsetImport")){if(!Array.isArray(vt.opsetImport))return"opsetImport: array expected";for(var Ct=0;Ct<vt.opsetImport.length;++Ct){var Rt=gt.onnx.OperatorSetIdProto.verify(vt.opsetImport[Ct]);if(Rt)return"opsetImport."+Rt}}return vt.domain!=null&&vt.hasOwnProperty("domain")&&!pt.isString(vt.domain)?"domain: string expected":null},wt.fromObject=function(vt){if(vt instanceof gt.onnx.FunctionProto)return vt;var Ct=new gt.onnx.FunctionProto;if(vt.name!=null&&(Ct.name=String(vt.name)),vt.input){if(!Array.isArray(vt.input))throw TypeError(".onnx.FunctionProto.input: array expected");Ct.input=[];for(var Rt=0;Rt<vt.input.length;++Rt)Ct.input[Rt]=String(vt.input[Rt])}if(vt.output){if(!Array.isArray(vt.output))throw TypeError(".onnx.FunctionProto.output: array expected");Ct.output=[];for(var Rt=0;Rt<vt.output.length;++Rt)Ct.output[Rt]=String(vt.output[Rt])}if(vt.attribute){if(!Array.isArray(vt.attribute))throw TypeError(".onnx.FunctionProto.attribute: array expected");Ct.attribute=[];for(var Rt=0;Rt<vt.attribute.length;++Rt)Ct.attribute[Rt]=String(vt.attribute[Rt])}if(vt.attributeProto){if(!Array.isArray(vt.attributeProto))throw TypeError(".onnx.FunctionProto.attributeProto: array expected");Ct.attributeProto=[];for(var Rt=0;Rt<vt.attributeProto.length;++Rt){if(typeof vt.attributeProto[Rt]!="object")throw TypeError(".onnx.FunctionProto.attributeProto: object expected");Ct.attributeProto[Rt]=gt.onnx.AttributeProto.fromObject(vt.attributeProto[Rt])}}if(vt.node){if(!Array.isArray(vt.node))throw TypeError(".onnx.FunctionProto.node: array expected");Ct.node=[];for(var Rt=0;Rt<vt.node.length;++Rt){if(typeof vt.node[Rt]!="object")throw TypeError(".onnx.FunctionProto.node: object expected");Ct.node[Rt]=gt.onnx.NodeProto.fromObject(vt.node[Rt])}}if(vt.docString!=null&&(Ct.docString=String(vt.docString)),vt.opsetImport){if(!Array.isArray(vt.opsetImport))throw TypeError(".onnx.FunctionProto.opsetImport: array expected");Ct.opsetImport=[];for(var Rt=0;Rt<vt.opsetImport.length;++Rt){if(typeof vt.opsetImport[Rt]!="object")throw TypeError(".onnx.FunctionProto.opsetImport: object expected");Ct.opsetImport[Rt]=gt.onnx.OperatorSetIdProto.fromObject(vt.opsetImport[Rt])}}return vt.domain!=null&&(Ct.domain=String(vt.domain)),Ct},wt.toObject=function(vt,Ct){Ct||(Ct={});var Rt={};if((Ct.arrays||Ct.defaults)&&(Rt.input=[],Rt.output=[],Rt.attribute=[],Rt.node=[],Rt.opsetImport=[],Rt.attributeProto=[]),Ct.defaults&&(Rt.name="",Rt.docString="",Rt.domain=""),vt.name!=null&&vt.hasOwnProperty("name")&&(Rt.name=vt.name),vt.input&&vt.input.length){Rt.input=[];for(var Mt=0;Mt<vt.input.length;++Mt)Rt.input[Mt]=vt.input[Mt]}if(vt.output&&vt.output.length){Rt.output=[];for(var Mt=0;Mt<vt.output.length;++Mt)Rt.output[Mt]=vt.output[Mt]}if(vt.attribute&&vt.attribute.length){Rt.attribute=[];for(var Mt=0;Mt<vt.attribute.length;++Mt)Rt.attribute[Mt]=vt.attribute[Mt]}if(vt.node&&vt.node.length){Rt.node=[];for(var Mt=0;Mt<vt.node.length;++Mt)Rt.node[Mt]=gt.onnx.NodeProto.toObject(vt.node[Mt],Ct)}if(vt.docString!=null&&vt.hasOwnProperty("docString")&&(Rt.docString=vt.docString),vt.opsetImport&&vt.opsetImport.length){Rt.opsetImport=[];for(var Mt=0;Mt<vt.opsetImport.length;++Mt)Rt.opsetImport[Mt]=gt.onnx.OperatorSetIdProto.toObject(vt.opsetImport[Mt],Ct)}if(vt.domain!=null&&vt.hasOwnProperty("domain")&&(Rt.domain=vt.domain),vt.attributeProto&&vt.attributeProto.length){Rt.attributeProto=[];for(var Mt=0;Mt<vt.attributeProto.length;++Mt)Rt.attributeProto[Mt]=gt.onnx.AttributeProto.toObject(vt.attributeProto[Mt],Ct)}return Rt},wt.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},wt.getTypeUrl=function(vt){return vt===void 0&&(vt="type.googleapis.com"),vt+"/onnx.FunctionProto"},wt}(),bt}(),_.exports=gt});function $e(it,_){if(!it)throw new Error(typeof _=="string"?_:_())}function Ye(it){return new TextDecoder().decode(it)}var j,de,io,dt,Cr,ut,xt,A,Ze,he,me,be,U=x(()=>{$r(),Hn(),j=Ae(Le()),ye(),de=class{static arraysEqual(it,_){if(it.length!==_.length)return!1;for(let lt=0;lt<it.length;lt++)if(it[lt]!==_[lt])return!1;return!0}},io=class{static preprocessInputShapes(it,_){let lt=it.length===1?[1,it[0]]:it,ft=_.length===1?[_[0],1]:_;return[lt,ft]}static postprocessOutputShape(it,_,lt){_===1&&it.splice(it.length-2,1),lt===1&&it.pop()}static calcMatMulShape(it,_){return it[1]!==_[0]?void 0:[it[0],_[1]]}},dt=class Py{static calcShape(_,lt,ft=!1){let mt=_.length,pt=lt.length;if(mt===0)return lt;if(pt===0)return _;let gt=Math.max(_.length,lt.length),bt=new Array(gt);if(ft){if(mt<2||pt<2)return;let wt=io.calcMatMulShape([_[mt-2],_[mt-1]],[lt[pt-2],lt[pt-1]]);if(wt===void 0)return;[bt[gt-2],bt[gt-1]]=wt}for(let wt=ft?3:1;wt<=gt;wt++){let vt=mt-wt<0?1:_[mt-wt],Ct=pt-wt<0?1:lt[pt-wt];if(vt!==Ct&&vt>1&&Ct>1)return;bt[gt-wt]=Math.max(vt,Ct)}return bt}static index(_,lt){let ft=new Array(lt.length);return Py.fillIndex(_,lt,ft),ft}static fillIndex(_,lt,ft){let mt=_.length-lt.length;for(let pt=0;pt<lt.length;pt++)ft[pt]=_[mt+pt]%lt[pt]}static calc(_,lt,ft,mt,pt){let gt=Py.calcShape(_.dims,lt.dims);if(gt){if(mt&&!A.areEqual(gt,_.dims))return;let bt=A.size(gt),wt=mt?_:new rt(gt,pt||_.type);if(gt.length===0)wt.set([],ft(_.get([]),lt.get([])));else{let vt=new Array(gt.length),Ct=new Array(_.dims.length),Rt=new Array(lt.dims.length),Mt=0,Ot=0,Nt=!1,Ht=!1;_.dims.length===0&&(Mt=_.get([]),Nt=!0),lt.dims.length===0&&(Ot=lt.get([]),Ht=!0);let Kt;for(let hr=0;hr<bt;hr++){Kt=hr;for(let Qt=gt.length-1;Qt>=0;Qt--)vt[Qt]=Kt%gt[Qt],Kt=Math.floor(Kt/gt[Qt]);Nt||(Py.fillIndex(vt,_.dims,Ct),Mt=_.get(Ct)),Ht||(Py.fillIndex(vt,lt.dims,Rt),Ot=lt.get(Rt)),wt.set(vt,ft(Mt,Ot))}}return wt}}static isValidBroadcast(_,lt){let ft=_.length,mt=lt.length;if(ft>mt)return!1;for(let pt=1;pt<=ft;pt++)if(_[ft-pt]!==1&&_[ft-pt]!==lt[mt-pt])return!1;return!0}static getBroadcastDims(_,lt){let ft=_.length,mt=[];for(let pt=0;pt<ft;pt++){let gt=ft-1-pt,bt=_[gt]||1;(lt[lt.length-1-pt]||1)>1&&bt===1&&mt.unshift(gt)}return mt}},Cr=class{static getShapeOfGemmResult(it,_,lt,ft,mt){if(it.length!==2||lt.length!==2)throw new Error("shape need to be of size 2");let pt,gt,bt;_?(pt=it[1],gt=it[0]):(pt=it[0],gt=it[1]);let wt=-1;if(ft?(bt=lt[0],wt=1):(bt=lt[1],wt=0),lt[wt]!==gt)throw new Error("dimension mismatch");if(pt<=0||bt<=0||gt<=0)throw new Error("invalid shape specified");if(mt&&!dt.isValidBroadcast(mt,[pt,bt]))throw new Error("gemm: invalid bias shape for broadcast");return[pt,bt,gt]}},ut=class iv{static tensorDataTypeFromProto(_){switch(_){case j.onnx.TensorProto.DataType.INT8:return"int8";case j.onnx.TensorProto.DataType.UINT8:return"uint8";case j.onnx.TensorProto.DataType.BOOL:return"bool";case j.onnx.TensorProto.DataType.INT16:return"int16";case j.onnx.TensorProto.DataType.UINT16:return"uint16";case j.onnx.TensorProto.DataType.INT32:return"int32";case j.onnx.TensorProto.DataType.UINT32:return"uint32";case j.onnx.TensorProto.DataType.FLOAT:return"float32";case j.onnx.TensorProto.DataType.DOUBLE:return"float64";case j.onnx.TensorProto.DataType.STRING:return"string";case j.onnx.TensorProto.DataType.INT64:return"int32";case j.onnx.TensorProto.DataType.UINT64:return"uint32";default:throw new Error(`unsupported data type: ${j.onnx.TensorProto.DataType[_]}`)}}static tensorDataTypeStringToEnum(_){switch(_){case"int8":return j.onnx.TensorProto.DataType.INT8;case"uint8":return j.onnx.TensorProto.DataType.UINT8;case"bool":return j.onnx.TensorProto.DataType.BOOL;case"int16":return j.onnx.TensorProto.DataType.INT16;case"uint16":return j.onnx.TensorProto.DataType.UINT16;case"int32":return j.onnx.TensorProto.DataType.INT32;case"uint32":return j.onnx.TensorProto.DataType.UINT32;case"float32":return j.onnx.TensorProto.DataType.FLOAT;case"float64":return j.onnx.TensorProto.DataType.DOUBLE;case"string":return j.onnx.TensorProto.DataType.STRING;case"int64":return j.onnx.TensorProto.DataType.INT64;case"uint64":return j.onnx.TensorProto.DataType.UINT64;default:throw new Error(`unsupported data type: ${_}`)}}static tensorDimsFromProto(_){return _.map(lt=>jt.isLong(lt)?lt.toNumber():lt)}static tensorValueTypeFromProto(_){return{tensorType:iv.tensorDataTypeFromProto(_.elemType),shape:{dims:iv.tensorDimsFromProto(_.shape.dim.map(lt=>lt.dimValue))}}}static tensorDimsFromORTFormat(_){let lt=[];for(let ft=0;ft<_.dimsLength();ft++)lt.push(xt.longToNumber(_.dims(ft)));return lt}static tensorAttributesFromORTFormat(_){let lt=[];for(let ft=0;ft<_.attributesLength();ft++)lt.push(_.attributes(ft));return lt}},xt=class{static longToNumber(it,_){return jt.isLong(it)?it.toNumber():it instanceof b.Long?jt.fromValue({low:it.low,high:it.high,unsigned:_??!1}).toNumber():it}static isLong(it){return jt.isLong(it)||it instanceof b.Long}},A=class ry{static size(_){return ry.getSizeFromDimensionRange(_,0,_.length)}static sizeFromDimension(_,lt){if(lt<0||lt>_.length)throw new Error(`invalid dimension of ${lt} for sizeFromDimension as Tensor has ${_.length} dimensions.`);return ry.getSizeFromDimensionRange(_,lt,_.length)}static sizeToDimension(_,lt){if(lt<0||lt>_.length)throw new Error(`invalid dimension of ${lt} for sizeToDimension as Tensor has ${_.length} dimensions.`);return ry.getSizeFromDimensionRange(_,0,lt)}static getSizeFromDimensionRange(_,lt,ft){let mt=1;for(let pt=lt;pt<ft;pt++){if(_[pt]<=0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains 0 or negative values in them.");mt*=_[pt]}return mt}static computeStrides(_){let lt=_.length;if(lt===0)return[];if(lt===1)return[1];let ft=new Array(lt);ft[lt-1]=1,ft[lt-2]=_[lt-1];for(let mt=lt-3;mt>=0;--mt)ft[mt]=ft[mt+1]*_[mt+1];return ft}static transpose(_){return _.slice().reverse()}static indicesToOffset(_,lt,ft){ft===void 0&&(ft=_.length);let mt=0;for(let pt=0;pt<ft;++pt)mt+=lt[pt]*_[pt];return mt}static offsetToIndices(_,lt){let ft=lt.length;if(ft===0)return[];if(ft===1)return[_*lt[0]];let mt=new Array(lt.length);for(let pt=0;pt<mt.length-1;++pt)mt[pt]=Math.floor(_/lt[pt]),_-=mt[pt]*lt[pt];return mt[mt.length-1]=_,mt}static normalizeAxis(_,lt){if(_<-lt&&_>=lt)throw new Error("unsupported axis for this operation.");return _<0?_+lt:_}static normalizeAxes(_,lt){return _.map(ft=>this.normalizeAxis(ft,lt))}static incrementIndex(_,lt,ft){if(lt.length===0||_.length===0)throw new Error("Index incrementing unsupported for scalar Tensor");if(ft===void 0)ft=lt.length;else if(ft<=0||ft>lt.length)throw new Error("Incorrect axis to increment on");for(let mt=ft-1;mt>=0&&(_[mt]++,!(_[mt]<lt[mt]));--mt)_[mt]=0}static calculateReshapedDims(_,lt){if(lt.length===0){if(_.length===0||ry.size(_)===1)return[];throw new Error("cannot reshape to a scalar Tensor")}let ft=lt.length,mt=new Array(ft),pt=-1,gt=1;for(let wt=0;wt<ft;wt++){if(lt[wt]<-1)throw new Error("a dimension in shape hints cannot be less than -1");if(lt[wt]===-1){if(pt!==-1)throw new Error("at most one dimension in shape hints can be -1");pt=wt}else{if(lt[wt]===0){if(wt>=_.length)throw new Error("the dimension with value zero exceeds the dimension size of the input tensor");mt[wt]=_[wt]}else mt[wt]=lt[wt];gt*=mt[wt]}}let bt=ry.size(_);if(pt!==-1){if(bt%gt!==0)throw new Error(`the input tensor cannot be reshaped to the requested shape. Input shape: [${_}] Output shape: [${lt}]`);mt[pt]=bt/gt}else if(gt!==bt)throw new Error("reshapedDims and originalDims don't have matching sizes");return mt}static sortBasedOnPerm(_,lt){return lt?lt.map(ft=>_[ft]):_.slice().reverse()}static padShape(_,lt){let ft=_.length;return _.map((mt,pt)=>mt+lt[pt]+lt[pt+ft])}static areEqual(_,lt){return _.length!==lt.length?!1:_.every((ft,mt)=>ft===lt[mt])}static validateDimsAndCalcSize(_){if(_.length>6)throw new TypeError("Only rank 0 to 6 is supported for tensor shape.");let lt=1;for(let ft of _){if(!Number.isInteger(ft))throw new TypeError(`Invalid shape: ${ft} is not an integer`);if(ft<0||ft>2147483647)throw new TypeError(`Invalid shape: length ${ft} is not allowed`);lt*=ft}return lt}static flattenShape(_,lt){lt<0&&(lt+=_.length);let ft=_.reduce((pt,gt)=>pt*gt,1),mt=_.slice(lt).reduce((pt,gt)=>pt*gt,1);return[ft/mt,mt]}static squeezeShape(_,lt){let ft=new Array;lt=ry.normalizeAxes(lt,_.length);for(let mt=0;mt<_.length;mt++){let pt=lt.indexOf(mt)>=0;if(pt&&_[mt]!==1)throw new Error("squeeze an axis of size different than 1");(lt.length===0&&_[mt]>1||lt.length>0&&!pt)&&ft.push(_[mt])}return ft}static unsqueezeShape(_,lt){let ft=new Array(_.length+lt.length);ft.fill(0);for(let pt=0;pt<lt.length;pt++){let gt=ry.normalizeAxis(lt[pt],ft.length);if(gt>=ft.length)throw new Error("'axes' has an out of range axis");if(ft[gt]!==0)throw new Error("'axes' has a duplicate axis");ft[gt]=1}let mt=0;for(let pt=0;pt<ft.length;pt++)ft[pt]===0&&(ft[pt]=_[mt++]);if(mt!==_.length)throw new Error("the unsqueezed dimension could not be established");return ft}},Ze=class Ev{static splitShape(_,lt,ft,mt){if(ft.length===0){if(!mt)throw new Error("need to know number of outputs when the 'split' attribute is not specified");Ev.determineSplit(_[lt],mt,ft)}let pt=[],gt=[0];for(let bt=0;bt<ft.length;++bt){bt!==0&&gt.push(gt[bt-1]+ft[bt-1]);let wt=_.slice();wt[lt]=ft[bt],pt.push(wt)}return[pt,gt]}static determineSplit(_,lt,ft){if(_%lt!==0)throw new Error("cannot split tensor to equal sized parts");for(let mt=0;mt<lt;++mt)ft.push(_/lt)}},he=class Ay{static adjustPoolAttributes(_,lt,ft,mt,pt,gt){if(!_&&ft.length!==lt.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(_)for(let bt=0;bt<lt.length-2;bt++)bt>=ft.length?ft.push(lt[bt+2]):ft[bt]=lt[bt+2];for(let bt=0;bt<ft.length;bt++)if(bt<mt.length){if(mt[bt]<0)throw new Error("strides should be greater than or equal to 1")}else mt.push(1);for(let bt=0;bt<ft.length;bt++)if(bt<pt.length){if(pt[bt]<0)throw new Error("dilations should be greater than or equal to 1")}else pt.push(1);for(let bt=0;bt<ft.length*2;bt++)if(bt<gt.length){if(gt[bt]<0)throw new Error("pad should be greater than or equal to 1")}else gt.push(0);for(let bt=0;bt<ft.length;bt++){if(ft[bt]<=0)throw new Error("kernel shapes need to be greater than 0");if(gt[bt]>=ft[bt]||gt[bt+ft.length]>=ft[bt])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(_,lt,ft,mt,pt,gt){if(gt){if(pt.length!==2*(_.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(lt.length!==_.length-2)throw new Error("length of strides should be the length of data dimensions");if(mt.length!==_.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let bt=0;bt<_.length-2;bt++)Ay.adjustPadAndReturnShape(_[bt+2],lt[bt],ft[bt],mt[bt],pt,bt,bt+_.length-2,gt)}}static computePoolOutputShape(_,lt,ft,mt,pt,gt,bt){if(lt.length<=0)throw new Error("input shape must be of size greater than 0");let wt=[lt[0],lt[1]];return Ay.computeShapeHelper(_,lt,wt,ft,mt,pt,gt,bt),wt}static computeConvOutputShape(_,lt,ft,mt,pt,gt,bt){if(_.length<=0||lt.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let wt=[_[0],lt[0]];return Ay.computeShapeHelper(!1,_,wt,ft,mt,pt,gt,bt),wt}static computeShapeHelper(_,lt,ft,mt,pt,gt,bt,wt){if(_)for(let vt=0;vt<lt.length-2;vt++)ft.push(1);else for(let vt=0;vt<lt.length-2;vt++)ft.push(Ay.adjustPadAndReturnShape(lt[vt+2],mt[vt],pt[vt],gt[vt],bt,vt,vt+lt.length-2,wt))}static adjustPadAndReturnShape(_,lt,ft,mt,pt,gt,bt,wt){let vt=ft*(mt-1)+1;if(wt&&wt!=="NOTSET")switch(wt){case"VALID":return pt[gt]=0,pt[bt]=0,Math.floor((_-vt)/lt+1);case"SAME_LOWER":case"SAME_UPPER":if(ft!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let Ct=((_+lt-1)/lt-1)*lt+mt-_;return pt[gt]=Math.floor(wt==="SAME_LOWER"?(Ct+1)/2:Ct/2),pt[bt]=Ct-pt[gt],Math.floor((_+Ct-mt)/lt+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((_+pt[gt]+pt[bt]-vt)/lt+1)}},me=-34028234663852886e22,be=34028234663852886e22});function Wc(it){switch(it){case"bool":case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;case"float64":return 8;default:throw new Error(`cannot calculate sizeof() on type ${it}`)}}function Ja(it){switch(it){case N.onnx.TensorProto.DataType.UINT8:case N.onnx.TensorProto.DataType.INT8:case N.onnx.TensorProto.DataType.BOOL:return 1;case N.onnx.TensorProto.DataType.UINT16:case N.onnx.TensorProto.DataType.INT16:return 2;case N.onnx.TensorProto.DataType.FLOAT:case N.onnx.TensorProto.DataType.INT32:case N.onnx.TensorProto.DataType.UINT32:return 4;case N.onnx.TensorProto.DataType.INT64:case N.onnx.TensorProto.DataType.DOUBLE:case N.onnx.TensorProto.DataType.UINT64:return 8;default:throw new Error(`cannot calculate sizeof() on type ${N.onnx.TensorProto.DataType[it]}`)}}function Hc(it,_){return new(Qa(_))(it)}function Qa(it){switch(it){case"bool":case"uint8":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"float32":return Float32Array;case"float64":return Float64Array;default:throw new Error("unspecified error")}}function so(it,_){if(_===N.onnx.TensorProto.DataType.INT64||_===ao.TensorDataType.INT64){if(it.greaterThanOrEqual(2147483648)||it.lessThan(-2147483648))throw new TypeError("int64 is not supported")}else if(_===N.onnx.TensorProto.DataType.UINT32||_===ao.TensorDataType.UINT32||_===N.onnx.TensorProto.DataType.UINT64||_===ao.TensorDataType.UINT64){if(it.greaterThanOrEqual(4294967296)||it.lessThan(0))throw new TypeError("uint64 is not supported")}else throw new TypeError(`not a LONG type: ${N.onnx.TensorProto.DataType[_]}`);return it.toNumber()}function Za(it,_,lt){switch(_){case N.onnx.TensorProto.DataType.BOOL:case N.onnx.TensorProto.DataType.UINT8:return it.getUint8(lt);case N.onnx.TensorProto.DataType.INT8:return it.getInt8(lt);case N.onnx.TensorProto.DataType.UINT16:return it.getUint16(lt,!0);case N.onnx.TensorProto.DataType.INT16:return it.getInt16(lt,!0);case N.onnx.TensorProto.DataType.FLOAT:return it.getFloat32(lt,!0);case N.onnx.TensorProto.DataType.INT32:return it.getInt32(lt,!0);case N.onnx.TensorProto.DataType.UINT32:return it.getUint32(lt,!0);case N.onnx.TensorProto.DataType.INT64:return so(jt.fromBits(it.getUint32(lt,!0),it.getUint32(lt+4,!0),!1),_);case N.onnx.TensorProto.DataType.DOUBLE:return it.getFloat64(lt,!0);case N.onnx.TensorProto.DataType.UINT64:return so(jt.fromBits(it.getUint32(lt,!0),it.getUint32(lt+4,!0),!0),_);default:throw new Error(`cannot read from DataView for type ${N.onnx.TensorProto.DataType[_]}`)}}var Ya,N,ao,rt,ye=x(()=>{Ya=Ae(Vi()),Hn(),je(),N=Ae(Le()),U(),ao=P.experimental.fbs,rt=class Gy{constructor(_,lt,ft,mt,pt,gt=Ya.Guid.create()){this.dims=_,this.type=lt,this.dataProvider=ft,this.asyncDataProvider=mt,this.cache=pt,this.dataId=gt,this.size=A.validateDimsAndCalcSize(_);let bt=this.size,wt=ft===void 0&&mt===void 0&&pt===void 0;if(pt!==void 0&&pt.length!==bt)throw new RangeError("Input dims doesn't match data length.");if(lt==="string"){if(pt!==void 0&&(!Array.isArray(pt)||!pt.every(vt=>typeof vt=="string")))throw new TypeError("cache should be a string array");wt&&(this.cache=new Array(bt))}else{if(pt!==void 0){let vt=Qa(lt);if(!(pt instanceof vt))throw new TypeError(`cache should be type ${vt.name}`)}if(wt){let vt=new ArrayBuffer(bt*Wc(lt));this.cache=Hc(vt,lt)}}}get data(){if(this.cache===void 0){let _=this.dataProvider(this.dataId);if(_.length!==this.size)throw new Error("Length of data provided by the Data Provider is inconsistent with the dims of this Tensor.");this.cache=_}return this.cache}get stringData(){if(this.type!=="string")throw new TypeError("data type is not string");return this.data}get integerData(){switch(this.type){case"uint8":case"int8":case"uint16":case"int16":case"int32":case"uint32":case"bool":return this.data;default:throw new TypeError("data type is not integer (uint8, int8, uint16, int16, int32, uint32, bool)")}}get floatData(){switch(this.type){case"float32":case"float64":return this.data;default:throw new TypeError("data type is not float (float32, float64)")}}get numberData(){if(this.type!=="string")return this.data;throw new TypeError("type cannot be non-number (string)")}get(_){return this.data[A.indicesToOffset(_,this.strides)]}set(_,lt){this.data[A.indicesToOffset(_,this.strides)]=lt}async getData(){return this.cache===void 0&&(this.cache=await this.asyncDataProvider(this.dataId)),this.cache}get strides(){return this._strides||(this._strides=A.computeStrides(this.dims)),this._strides}static fromProto(_){if(!_)throw new Error("cannot construct Value from an empty tensor");let lt=ut.tensorDataTypeFromProto(_.dataType),ft=ut.tensorDimsFromProto(_.dims),mt=new Gy(ft,lt);if(lt==="string")_.stringData.forEach((pt,gt)=>{mt.data[gt]=Ye(pt)});else if(_.rawData&&typeof _.rawData.byteLength=="number"&&_.rawData.byteLength>0){let pt=mt.data,gt=new DataView(_.rawData.buffer,_.rawData.byteOffset,_.rawData.byteLength),bt=Ja(_.dataType),wt=_.rawData.byteLength/bt;if(_.rawData.byteLength%bt!==0)throw new Error("invalid buffer length");if(pt.length!==wt)throw new Error("buffer length mismatch");for(let vt=0;vt<wt;vt++){let Ct=Za(gt,_.dataType,vt*bt);pt[vt]=Ct}}else{let pt;switch(_.dataType){case N.onnx.TensorProto.DataType.FLOAT:pt=_.floatData;break;case N.onnx.TensorProto.DataType.INT32:case N.onnx.TensorProto.DataType.INT16:case N.onnx.TensorProto.DataType.UINT16:case N.onnx.TensorProto.DataType.INT8:case N.onnx.TensorProto.DataType.UINT8:case N.onnx.TensorProto.DataType.BOOL:pt=_.int32Data;break;case N.onnx.TensorProto.DataType.INT64:pt=_.int64Data;break;case N.onnx.TensorProto.DataType.DOUBLE:pt=_.doubleData;break;case N.onnx.TensorProto.DataType.UINT32:case N.onnx.TensorProto.DataType.UINT64:pt=_.uint64Data;break;default:throw new Error("unspecific error")}if(pt==null)throw new Error("failed to populate data from a tensorproto value");let gt=mt.data;if(gt.length!==pt.length)throw new Error("array length mismatch");for(let bt=0;bt<pt.length;bt++){let wt=pt[bt];jt.isLong(wt)?gt[bt]=so(wt,_.dataType):gt[bt]=wt}}return mt}static fromData(_,lt,ft){return new Gy(lt,ft,void 0,void 0,_)}static fromOrtTensor(_){if(!_)throw new Error("cannot construct Value from an empty tensor");let lt=ut.tensorDimsFromORTFormat(_),ft=ut.tensorDataTypeFromProto(_.dataType()),mt=new Gy(lt,ft);if(ft==="string")for(let pt=0;pt<_.stringDataLength();pt++)mt.data[pt]=_.stringData(pt);else if(_.rawDataArray()&&typeof _.rawDataLength()=="number"&&_.rawDataLength()>0){let pt=mt.data,gt=new DataView(_.rawDataArray().buffer,_.rawDataArray().byteOffset,_.rawDataLength()),bt=Ja(_.dataType()),wt=_.rawDataLength()/bt;if(_.rawDataLength()%bt!==0)throw new Error("invalid buffer length");if(pt.length!==wt)throw new Error("buffer length mismatch");for(let vt=0;vt<wt;vt++){let Ct=Za(gt,_.dataType(),vt*bt);pt[vt]=Ct}}return mt}}});function D(it){return it===1?qc:jc}function ts(it){let _=D(it);return`${_.version}
      precision highp float;
      ${_.attribute} vec3 position;
      ${_.attribute} vec2 textureCoord;

      ${_.varyingVertex} vec2 TexCoords;

      void main()
      {
          gl_Position = vec4(position, 1.0);
          TexCoords = textureCoord;
      }`}function es(it){let _=D(it);return`${_.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${_.varyingFrag} vec2 TexCoords;
    ${_.outputDeclaration}
    const vec2 halfCR = vec2(0.5, 0.5);

    // Custom vector types to handle higher dimenalities.
    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    `}function rs(it,_){let lt=D(it);return`
  void main() {
    int indices[${_}];
    toVec(TexCoords, indices);
    vec4 result = vec4(process(indices));
    ${lt.output} = result;
  }
  `}var qc,jc,X=x(()=>{qc={version:"",attribute:"attribute",varyingVertex:"varying",varyingFrag:"varying",texture2D:"texture2D",output:"gl_FragColor",outputDeclaration:""},jc={version:"#version 300 es",attribute:"in",varyingVertex:"out",varyingFrag:"in",texture2D:"texture",output:"outputColor",outputDeclaration:"out vec4 outputColor;"}}),R=x(()=>{});async function uo(it,_=ft=>0,lt){return new Promise((ft,mt)=>{let pt=0,gt=()=>{if(it()){ft();return}pt++;let bt=_(pt);setTimeout(gt,bt)};gt()})}function Rr(it){return $e(typeof it<"u"&&it.length!==0,()=>"empty string found for sampler name"),"get"+it.charAt(0).toUpperCase()+it.slice(1)}function ns(it){return $e(typeof it<"u"&&it.length!==0,()=>"empty string found for sampler name"),"get"+it.charAt(0).toUpperCase()+it.slice(1)+"AtOutCoords"}function ke(it,_){let lt=JSON.parse(JSON.stringify(it));return lt=_,lt}function Be(it,_){return _.map(lt=>it[lt]).join(", ")}function ht(it){if(it<=1)return"int";if(it===2)return"ivec2";if(it===3)return"ivec3";if(it===4)return"ivec4";if(it===5)return"ivec5";if(it===6)return"ivec6";throw Error(`GPU for rank ${it} is not yet supported`)}function Gt(it=6){return["x","y","z","w","u","v"].slice(0,it)}var Vt=x(()=>{U()});function Xc(it,_){return Gt(_).map(lt=>`${it}.${lt}`)}function Fe(it,_){return _===1?[it]:Xc(it,_)}function Ut(){return`
    float getChannel(vec4 frag, int dim) {
      int modCoord = imod(dim, 2);
      return modCoord == 0 ? frag.r : frag.g;
    }

    float getChannel(vec4 frag, vec2 innerDims) {
      vec2 modCoord = mod(innerDims, 2.);
      return modCoord.x == 0. ?
        (modCoord.y == 0. ? frag.r : frag.g) :
        (modCoord.y == 0. ? frag.b : frag.a);
    }
  `}var ge=x(()=>{Vt()});function Jc(it,_,lt){if(it===0)return"false";if(it===1)return`rc > ${_[0]}`;let ft="";for(let mt=it-2;mt<it;mt++)ft+=`${lt[mt]} >= ${_[mt-it+2]}`,mt<it-1&&(ft+="||");return ft}function Zc(it,_){let lt=it.length;if(lt===0)return"getA(), 0, 0, 0";if(lt===1)return`getA(rc),
            rc + 1 >= ${it[0]} ? 0. : getA(rc + 1),
            0, 0`;let ft="r, c",mt="r, cp1",pt="rp1, c",gt="rp1, cp1",bt="";if(lt>2)for(let wt=0;wt<lt-2;++wt)bt=bt+`${_[wt]},`;return`getA(${bt}${ft}),
          rEdge ? 0. : getA(${bt}${pt}),
          cEdge ? 0. : getA(${bt}${mt}),
          rEdge || cEdge ? 0. : getA(${bt}${gt})`}function Yc(it,_,lt,ft){return it===0||it===1?"":`
    int r = ${_[it-2]};
    int c = ${_[it-1]};
    int rp1 = ${_[it-2]} + 1;
    int cp1 = ${_[it-1]} + 1;
    bool rEdge = rp1 >= ${ft};
    bool cEdge = cp1 >= ${lt};
    `}var os,Kc,is,as=x(()=>{X(),R(),Vt(),ge(),os={name:"pack",inputNames:["A"],inputTypes:[1]},Kc=(it,_)=>{let lt=D(it.session.backend.glContext.version),ft=_.dims,mt=ft.length,pt=_.dims.length,gt=ht(pt),bt=Fe("rc",pt),wt=Yc(pt,bt,ft[ft.length-2],ft[ft.length-1]),vt;mt===0?vt=[1,1]:mt===1?vt=[ft[0],1]:vt=[ft[pt-1],ft[pt-2]];let Ct=Jc(pt,vt,bt),Rt=Zc(ft,bt),Mt=`
        void main() {
          ${gt} rc = getOutputCoords();

          if(${Ct}) {
            ${lt.output} = vec4(0);
          } else {
            ${wt}

            ${lt.output} = vec4(${Rt});
          }
        }
      `;return{...os,hasMain:!0,output:{dims:_.dims,type:_.type,textureType:2},shaderSource:Mt}},is=(it,_)=>({...os,get:()=>Kc(it,_)})});function lo(it){if(it.length===0)return[1,1,1];let _=1;for(let lt=0;lt<it.length-2;++lt)_*=it[lt];return[_,it.length>1?it[it.length-2]:1,it[it.length-1]]}function us(it,_){let lt=!1;return it.length===0||_.length===0?lt=!0:it.length<2||_.length<2?lt=it[it.length-1]===_[_.length-1]:lt=it[it.length-1]===_[_.length-1]&&it[it.length-2]===_[_.length-2],lt}function ep(it){let _=A.computeStrides(it),lt=["b","r","c"],ft="index";return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${_.map((mt,pt)=>{let gt=`int ${lt[pt]} = ${ft} / ${mt}`,bt=pt===_.length-1?`int ${lt[pt+1]} = ${ft} - ${lt[pt]} * ${mt}`:`index -= ${lt[pt]} * ${mt}`;return`${gt}; ${bt};`}).join("")}
      return ivec3(b, r, c);
    }
  `}function rp(it){let _=A.computeStrides(it);return`
  int getFlattenedIndex(ivec3 coords) {
    // reverse y, z order
    return coords.x * ${_[0]} + coords.z * ${_[1]} + coords.y;
  }
`}var Qc,tp,ss,ls=x(()=>{U(),X(),R(),ge(),Qc=it=>({name:"Reshape (packed)",inputTypes:[2],inputNames:["A"],cacheHint:`${it}`}),tp=(it,_,lt,ft)=>{let mt=_.dims,pt=ft,gt="";for(let vt=0;vt<4;vt++){let Ct="";switch(vt){case 0:Ct="outputCoords = rc;";break;case 1:Ct="outputCoords = ivec3(rc.x, rc.y+1, rc.z);";break;case 2:Ct="outputCoords = ivec3(rc.x, rc.y, rc.z+1);";break;case 3:Ct="outputCoords = ivec3(rc.x, rc.y+1, rc.z+1);";break;default:throw new Error}gt+=`
        ${Ct}
        ${vt>0?"if(outputCoords.y < rows && outputCoords.z < cols){":""}
          int flattenedIndex = getFlattenedIndex(outputCoords);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flattenedIndex);
          vec2 innerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${vt}] = getChannel(getA(inputRC.x, inputRC.y, inputRC.z), innerDims);

        ${vt>0?"}":""}
      `}let bt=D(it.session.backend.glContext.version),wt=`
      ${ep(mt)}
      ${rp(pt)}
      ${Ut()}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.0);

        ivec3 outputCoords;
        int rows = ${pt[2]};
        int cols = ${pt[1]};

        ${gt}
        ${bt.output} = result;
      }
    `;return{...lt,output:{dims:pt,type:_.type,textureType:2},shaderSource:wt,hasMain:!0}},ss=(it,_,lt)=>{let ft=Qc(lt);return{...ft,get:()=>tp(it,_,ft,lt)}}}),fo,fs=x(()=>{X(),R(),fo=(it,_)=>{let lt=_.shape,ft=D(it.session.backend.glContext.version),mt=`
    const float FLOAT_MAX = 1.70141184e38;
    const float FLOAT_MIN = 1.17549435e-38;

    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    highp vec4 encodeAsUint8(highp float v) {
      if (isNaN(v)) {
        return vec4(255, 255, 255, 255);
      }

      highp float av = abs(v);

      if(av < FLOAT_MIN) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      } else if(v > FLOAT_MAX) {
        return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
      } else if(v < -FLOAT_MAX) {
        return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
      }

      highp vec4 c = vec4(0,0,0,0);

      highp float e = floor(log2(av));
      highp float m = exp2(fract(log2(av))) - 1.0;

      c[2] = floor(128.0 * m);
      m -= c[2] / 128.0;
      c[1] = floor(32768.0 * m);
      m -= c[1] / 32768.0;
      c[0] = floor(8388608.0 * m);

      highp float ebias = e + 127.0;
      c[3] = floor(ebias / 2.0);
      ebias -= c[3] * 2.0;
      c[2] += floor(ebias) * 128.0;

      c[3] += 128.0 * step(0.0, -v);

      return c / 255.0;
    }

    void main() {
      float value = ${ft.texture2D}(X,TexCoords).r;
      ${ft.output} = encodeAsUint8(value);
    }`,pt={name:"Uint8Encode",inputTypes:[0],inputNames:["X"],output:{dims:lt,type:_.tensor.type,textureType:3},shaderSource:mt,hasMain:!0};return it.executeProgram(pt,[_.tensor])}});function op(it,_){if(it===1)return"rc";let lt="";for(let ft=0;ft<it;ft++)lt+=_[ft],ft<it-1&&(lt+=",");return lt}var cs,np,ps,ds=x(()=>{X(),R(),Vt(),ge(),cs={name:"unpack",inputNames:["A"],inputTypes:[2]},np=(it,_)=>{let lt=_.dims.length,ft=Fe("rc",lt),mt=ft.slice(-2),pt=ht(lt),gt=Ut(),bt=_.dims.length===0?"":op(lt,ft),wt=lt<=1?"rc":`vec2(${mt.join(",")})`,vt=D(it.session.backend.glContext.version),Ct=`
    ${gt}
    void main() {
      ${pt} rc = getOutputCoords();

       // Sample the texture with the coords to get the rgba channel value.
       vec4 packedInput = getA(${bt});

       ${vt.output} = vec4(getChannel(packedInput, ${wt}), 0, 0, 0);
     }
   `;return{...cs,hasMain:!0,output:{dims:_.dims,type:_.type,textureType:0},shaderSource:Ct}},ps=(it,_)=>({...cs,get:()=>np(it,_)})}),Gr,Qe,Mr,tr=x(()=>{It(),Gr=class{constructor(it,_=1){if(_===1)this.internalFormat=it.R32F,this.format=it.RED,this.textureType=it.FLOAT,this.channelSize=_;else if(_===4)this.internalFormat=it.RGBA32F,this.format=it.RGBA,this.textureType=it.FLOAT,this.channelSize=_;else throw new Error(`Invalid number of channels: ${_}`)}encode(it,_){let lt,ft;return it.constructor!==Float32Array&&(z.warning("Encoder","data was not of type Float32; creating new Float32Array"),ft=new Float32Array(it)),_*this.channelSize>it.length?(z.warning("Encoder","Source data too small. Allocating larger array"),ft=it,lt=this.allocate(_*this.channelSize),ft.forEach((mt,pt)=>lt[pt]=mt)):(ft=it,lt=ft),lt}allocate(it){return new Float32Array(it*4)}decode(it,_){return this.channelSize===1?it.filter((lt,ft)=>ft%4===0).subarray(0,_):it.subarray(0,_)}},Qe=class{constructor(it,_=1,lt){if(_!==1&&_!==4)throw new Error(`Invalid number of channels: ${_}`);this.internalFormat=it.RGBA,this.format=it.RGBA,this.channelSize=_,this.textureType=lt||it.FLOAT}encode(it,_){let lt=it;return this.channelSize===1&&(z.verbose("Encoder","Exploding into a larger array"),lt=this.allocate(_),it.forEach((ft,mt)=>lt[mt*4]=ft)),lt}allocate(it){return new Float32Array(it*4)}decode(it,_){return this.channelSize===1?it.filter((lt,ft)=>ft%4===0).subarray(0,_):it.subarray(0,_)}},Mr=class{constructor(it,_=1){if(this.channelSize=4,_===1)this.internalFormat=it.ALPHA,this.format=it.ALPHA,this.textureType=it.UNSIGNED_BYTE,this.channelSize=_;else if(_===4)this.internalFormat=it.RGBA,this.format=it.RGBA,this.textureType=it.UNSIGNED_BYTE,this.channelSize=_;else throw new Error(`Invalid number of channels: ${_}`)}encode(it,_){return new Uint8Array(it.buffer,it.byteOffset,it.byteLength)}allocate(it){return new Uint8Array(it*this.channelSize)}decode(it,_){if(it instanceof Uint8Array)return it.subarray(0,_);throw new Error(`Invalid array type: ${it.constructor}`)}}}),er,hs,co,ms=x(()=>{U(),R(),er=(it,_,lt)=>{let ft=lt===0||lt===1?1:4,mt=lt===2,pt=lt===1||lt===2,gt=lt===4?_.length-1:void 0,bt=lt===4?_.map((wt,vt)=>vt===_.length-1?wt*4:wt):void 0;return co(it,_,ft,bt,{isPacked:mt,reverseWH:pt,breakAxis:gt})},hs=(it,_,lt)=>{let ft=er(it,_,lt);return[ft.width,ft.height]},co=(it,_,lt=1,ft,mt)=>{let pt=!!(mt&&mt.isPacked),[gt,bt]=it.computeTextureWH(pt&&ft||_,mt),wt=_.length,vt=_.slice(0);if(wt===0&&(vt=[1]),lt===1)ft=_;else if(pt){if(lt!==4)throw new Error("a packed texture must be 4-channel");ft=_,wt>0&&(vt[wt-1]=Math.ceil(vt[wt-1]/2)),wt>1&&(vt[wt-2]=Math.ceil(vt[wt-2]/2))}else if(!ft)throw new Error("Unpacked shape is needed when using channels > 1");return{width:gt,height:bt,channels:lt,isPacked:pt,shape:vt,strides:A.computeStrides(vt),unpackedShape:ft,reversedWH:mt&&mt.reverseWH}}}),ap,Vr,ys=x(()=>{It(),ye(),U(),as(),ls(),fs(),ds(),tr(),ms(),R(),ap=(it,_)=>{let lt=_.map(mt=>`${mt.unpackedShape.join(",")};${mt.width}x${mt.height}`).join("_"),ft=it.name;return it.cacheHint&&(ft+="["+it.cacheHint+"]"),ft+=":"+lt,ft},Vr=class{constructor(it){this.session=it,this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map}calculateTextureWidthAndHeight(it,_){return hs(this.session.layoutStrategy,it,_)}executeProgram(it,_){if(_.length<it.inputNames.length)throw new Error(`Input size mustn't be less than ${it.inputNames.length}.`);if(it.inputNames.length!==it.inputTypes.length)throw new Error("input names size does not match input types");let lt=[];for(let wt=0;wt<it.inputNames.length;++wt)lt[wt]=this.getOrCreateTextureData(_[wt],it.inputTypes[wt]);let ft=ap(it,lt),mt=this.session.programManager.getArtifact(ft),pt=mt?mt.programInfo:typeof it.get=="function"?it.get():it,gt=er(this.session.layoutStrategy,pt.output.dims,pt.output.textureType),bt=this.createTextureData(gt,pt.output.type);return mt||(mt=this.session.programManager.build(pt,lt,bt),this.session.programManager.setArtifact(ft,mt)),this.runProgram(mt,lt,bt),bt}run(it,_){return this.executeProgram(it,_).tensor}runProgram(it,_,lt){for(let ft=0;ft<_.length;++ft)if(!!_[ft].isPacked!=(it.programInfo.inputTypes[ft]===2))throw new Error(`input[${ft}] property packed inconsistent`);if(!!lt.isPacked!=(it.programInfo.output.textureType===2))throw new Error("output property packed inconsistent");this.session.programManager.run(it,_,lt)}getOrCreateTextureData(it,_){let lt=this.getTextureData(it.dataId,_===2);if(!lt&&(lt=this.getTextureData(it.dataId,_!==2),lt))return _===2?this.pack(lt):this.unpack(lt);if(!lt){let ft=er(this.session.layoutStrategy,it.dims,_);if(_===4){let mt=it.dims;if(mt.length===4){let pt=[mt[0],Math.ceil(mt[1]*mt[2]*mt[3]/4)],gt=er(this.session.layoutStrategy,pt,_),bt=it.numberData;if(mt[1]*mt[2]*mt[3]%4!==0){let wt=mt[0],vt=mt[1]*mt[2]*mt[3],Ct=Math.ceil(vt*1/4)*4,Rt=wt*Ct;bt=new Float32Array(Rt);for(let Mt=0;Mt<wt;++Mt){let Ot=Mt*vt,Nt=Mt*Ct+Mt%1*vt;bt.set(it.numberData.subarray(Ot,Ot+vt),Nt)}}return this.createTextureData(gt,it.type,bt,it,1)}}if(_===2){let mt=co(this.session.layoutStrategy,it.dims,1,[],{reverseWH:!0}),pt=this.createTextureData(mt,it.type,it.numberData,it,1);lt=this.pack(pt)}else lt=this.createTextureData(ft,it.type,it.numberData,it,1)}return lt}createTextureDataFromLayoutBindTensor(it,_,lt,ft){return this.createTextureData(it,_,lt,ft,1)}createTextureData(it,_,lt,ft,mt){z.verbose("InferenceHandler",`Creating TextureData: layout:[${JSON.stringify(it)}]`);let pt=this.session.textureManager.createTextureFromLayout(_,it,lt,mt);return this.createTextureDataFromTexture(it,_,pt,ft)}reshapeUnpacked(it,_){let lt=this.getOrCreateTextureData(it,0),ft={channels:lt.channels,height:lt.height,width:lt.width,shape:_.length!==0?_:[1],strides:A.computeStrides(_),unpackedShape:_};return this.createTextureDataFromTexture(ft,it.type,lt.texture).tensor}reshapePacked(it,_){let lt=this.getOrCreateTextureData(it,2);if(us(it.dims,_)){let bt={channels:lt.channels,height:lt.height,width:lt.width,shape:_.length!==0?_:[1],strides:A.computeStrides(_),unpackedShape:_,isPacked:!0};return this.createTextureDataFromTexture(bt,it.type,lt.texture).tensor}let ft=lo(it.dims),mt=lo(_),pt=this.reshapePacked(it,ft),gt=this.run(ss(this,pt,mt),[pt]);return this.reshapePacked(gt,_)}cast(it,_){let lt=this.getOrCreateTextureData(it,0);return this.createTextureDataFromTexture(lt,_,lt.texture).tensor}createTextureDataFromTexture(it,_,lt,ft,mt){let pt={...it,tensor:ft||new rt(it.unpackedShape,_,gt=>this.readTexture(pt),async gt=>this.readTextureAsync(pt),void 0,mt),texture:lt};return this.setTextureData(pt.tensor.dataId,pt,it.isPacked),pt}getTextureData(it,_=!1){return this.session.isInitializer(it)?this.session.getTextureData(it,_):_?this.packedTextureDataCache.get(it):this.unpackedTextureDataCache.get(it)}setTextureData(it,_,lt=!1){this.session.isInitializer(it)?this.session.setTextureData(it,_,lt):(lt?this.packedTextureDataCache:this.unpackedTextureDataCache).set(it,_)}isTextureLayoutCached(it,_=!1){return!!this.getTextureData(it.dataId,_)}dispose(){this.session.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach(it=>this.session.textureManager.releaseTexture(it)),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach(it=>this.session.textureManager.releaseTexture(it)),this.unpackedTextureDataCache=new Map}readTexture(it){return it.isPacked?this.readTexture(this.unpack(it)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTexture(it,it.tensor.type,it.channels):this.session.textureManager.readUint8TextureAsFloat(fo(this,it))}async readTextureAsync(it){return it.isPacked?this.readTextureAsync(this.unpack(it)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTextureAsync(it,it.tensor.type,it.channels):this.session.textureManager.readUint8TextureAsFloat(fo(this,it))}pack(it){return this.executeProgram(is(this,it.tensor),[it.tensor])}unpack(it){return this.executeProgram(ps(this,it.tensor),[it.tensor])}}}),po,F,at=x(()=>{po=class{constructor(it){Object.assign(this,it)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(it=>`${this[it]}`).join(";")),this.key}},F=it=>new po(it)}),gs,xs,Ts,sp,up,ws=x(()=>{at(),X(),R(),gs={name:"BatchNormalization",inputNames:["A","Scale","B","Mean","Variance"],inputTypes:[0,0,0,0,0]},xs=(it,_,lt)=>(up(_),[it.run({...gs,cacheHint:lt.cacheKey,get:()=>sp(it,_,lt)},_)]),Ts=it=>{let _=it.attributes.getFloat("epsilon",1e-5),lt=it.attributes.getFloat("momentum",.9),ft=it.attributes.getInt("spatial",1);return F({epsilon:_,momentum:lt,spatial:ft})},sp=(it,_,lt)=>{let ft=D(it.session.backend.glContext.version),mt=_[0].dims.length,[pt,gt]=it.calculateTextureWidthAndHeight(_[1].dims,0),bt=`
  float process(int[${mt}] indices) {
    vec2 position = offsetToCoords(indices[1], ${pt}, ${gt});
    float scale = getColorAsFloat(${ft.texture2D}(Scale, position));
    float mean = getColorAsFloat(${ft.texture2D}(Mean, position));
    float variance = getColorAsFloat(${ft.texture2D}(Variance, position));
    float b = getColorAsFloat(${ft.texture2D}(B, position));

    return scale * ( (_A(indices) - mean) / sqrt(variance + float(${lt.epsilon})) ) + b;
  }`;return{...gs,output:{dims:_[0].dims,type:_[0].type,textureType:0},shaderSource:bt}},up=it=>{if(!it||it.length!==5)throw new Error("BatchNormalization requires 5 inputs.");let _=it[0],lt=it[1],ft=it[2],mt=it[3],pt=it[4];if(_.dims.length<3||lt.dims.length!==1||ft.dims.length!==1||mt.dims.length!==1||pt.dims.length!==1)throw new Error("invalid input shape.");if(lt.dims[0]!==_.dims[1]||ft.dims[0]!==_.dims[1]||mt.dims[0]!==_.dims[1]||pt.dims[0]!==_.dims[1])throw new Error("invalid input shape.");if(_.type!=="float32"&&_.type!=="float64"||lt.type!=="float32"&&lt.type!=="float64"||ft.type!=="float32"&&ft.type!=="float64"||mt.type!=="float32"&&mt.type!=="float64"||pt.type!=="float32"&&pt.type!=="float64")throw new Error("invalid input tensor types.")}}),Ur,At,O,rr,zr,Xt=x(()=>{Ur=class{constructor(it,_,lt,ft){this.glContext=it,this.programInfo=_,this.inputTextureLayouts=lt,this.outputTextureLayout=ft}},At=class{constructor(it){this.context=it}},O=class{constructor(it,_){this.routineBody=it,this.dependencies=_}},rr=class{constructor(it,_,lt){this.name=it,lt?this.dependencies=lt:this.dependencies=[],_&&(this.routineBody=_)}addDependency(it){it&&this.dependencies.push(it)}},zr=class{static returnOrderedNodes(it){if(!it||it.length===0)return[];if(it.length===1)return it;let _=new Set,lt=new Set,ft=new Array;return this.createOrderedNodes(it,_,lt,ft),ft}static createOrderedNodes(it,_,lt,ft){for(let mt=0;mt<it.length;++mt)this.dfsTraverse(it[mt],_,lt,ft)}static dfsTraverse(it,_,lt,ft){if(!it||lt.has(it.name))return;if(_.has(it.name))throw new Error("Cyclic dependency detected. Can't topologically sort routines needed for shader.");_.add(it.name);let mt=it.dependencies;if(mt&&mt.length>0)for(let pt=0;pt<mt.length;++pt)this.dfsTraverse(mt[pt],_,lt,ft);ft.push(it),lt.add(it.name),_.delete(it.name)}}});function fp(){let it="add_";return{body:`
  float ${it}(float a, float b) {
    return a + b;
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    return v1 + v2;
  }
  `,name:it,type:0}}function cp(){let it="div_";return{body:`
  float ${it}(float a, float b) {
    return a / b;
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    return v1 / v2;
  }
  `,name:it,type:0}}function pp(){let it="mul_";return{body:`
  float ${it}(float a, float b) {
    return a * b;
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    return v1 * v2;
  }
  `,name:it,type:0}}function dp(){let it="sub_";return{body:`
  float ${it}(float a, float b) {
    return a - b;
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    return v1 - v2;
  }
  `,name:it,type:0}}function hp(){let it="equal_";return{body:`
  float ${it}(float a, float b) {
    return float(a == b);
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    return vec4(equal(v1, v2));
  }
  `,name:it,type:0}}function mp(){let it="greater_";return{body:`
  float ${it}(float a, float b) {
    return float(a > b);
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    return vec4( v1.r > v2.r ,
      v1.g > v2.g,
      v1.b > v2.b,
      v1.a > v2.a );
  }
  `,name:it,type:0}}function bp(){let it="less_";return{body:`
  float ${it}(float a, float b) {
    return float(a < b);
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    return vec4( v1.r < v2.r ,
                v1.g < v2.g,
                v1.b < v2.b,
                v1.a < v2.a );
  }
  `,name:it,type:0}}function yp(){let it="and_";return{body:`
  float ${it}(float a, float b) {
    return float( bool(a) && bool(b) );
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r && b2.r ,
                b1.g && b2.g,
                b1.b && b2.b,
                b1.a && b2.a );
  }
  `,name:it,type:0}}function gp(){let it="or_";return{body:`
  float ${it}(float a, float b) {
    return float( bool(a) || bool(b) );
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r || b2.r ,
                b1.g || b2.g,
                b1.b || b2.b,
                b1.a || b2.a );
  }
  `,name:it,type:0}}function xp(){let it="xor_";return{body:`
  float ${it}(float a, float b) {
    return float( bool(a) ^^ bool(b) );
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r ^^ b2.r ,
                b1.g ^^ b2.g,
                b1.b ^^ b2.b,
                b1.a ^^ b2.a );
  }
  `,name:it,type:0}}function Tp(){return vp("pow")}function wp(){let it="prelu_";return{body:`
  float ${it}(float a, float b) {
    return a < 0.0 ? a * b: a;
  }
  vec4 ${it}(vec4 v1, vec4 v2) {
    return vec4(
      v1.r < 0.0 ? v1.r * v2.r: v1.r,
      v1.g < 0.0 ? v1.g * v2.g: v1.g,
      v1.b < 0.0 ? v1.b * v2.b: v1.b,
      v1.a < 0.0 ? v1.a * v2.a: v1.a
      );
  }
  `,name:it,type:0}}function vp(it){let _=`${it}_`;return{body:`
  float ${_}(float a, float b) {
    return ${it}(a, b);
  }
  vec4 ${_}(vec4 v1, vec4 v2) {
    return ${it}(v1, v2);
  }
  `,name:_,type:0}}var Pt,Ip,vs,Is,_s,Ss,Os,As,Ps,Es,Ds,Ls,$s,ks,Bs=x(()=>{U(),Xt(),X(),R(),Pt=(it,_,lt,ft=_[0].type,mt)=>{let pt=it.session.pack?2:0;return{name:lt.name,inputNames:["A","B"],inputTypes:[pt,pt],cacheHint:mt,get:()=>Ip(it,_,lt,ft)}},Ip=(it,_,lt,ft=_[0].type)=>{let mt=it.session.pack?2:0,pt=!A.areEqual(_[0].dims,_[1].dims),gt=_[0].dims,bt=it.session.pack;if(pt){let Ct=dt.calcShape(_[0].dims,_[1].dims,!1);if(!Ct)throw new Error("Can't perform binary op on the given tensors");gt=Ct;let Rt=gt.length,Mt=_[0].dims.length!==0?_[0].dims.length:1,Ot=_[1].dims.length!==0?_[1].dims.length:1,Nt=_[0].dims.length!==0?"bcastIndices_A(indices, aindices);":"aindices[0] = 0;",Ht=_[1].dims.length!==0?"bcastIndices_B(indices, bindices);":"bindices[0] = 0;",Kt=D(it.session.backend.glContext.version),hr=bt?`
      ${lt.body}
      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        vec4 result = ${lt.name}(a, b);
        ${Kt.output} = result;
      }`:`
      ${lt.body}
      float process(int indices[${Rt}]) {
        int aindices[${Mt}];
        int bindices[${Ot}];
        ${Nt}
        ${Ht}
        return ${lt.name}(_A(aindices), _B(bindices));
      }`;return{name:lt.name,inputNames:["A","B"],inputTypes:[mt,mt],output:{dims:gt,type:ft,textureType:mt},shaderSource:hr,hasMain:bt}}let wt=D(it.session.backend.glContext.version),vt=`
    ${lt.body}
    void main() {
      vec4 v1 = ${wt.texture2D}(A, TexCoords);
      vec4 v2 = ${wt.texture2D}(B, TexCoords);
      vec4 result = ${lt.name}(v1, v2);
      ${wt.output} = result;
    }
    `;return{name:lt.name,inputNames:["A","B"],inputTypes:[mt,mt],output:{dims:_[0].dims,type:ft,textureType:mt},shaderSource:vt,hasMain:!0}},vs=(it,_)=>[it.run(Pt(it,_,fp()),_)],Is=(it,_)=>[it.run(Pt(it,_,yp(),"bool"),_)],_s=(it,_)=>[it.run(Pt(it,_,cp()),_)],Ss=(it,_)=>[it.run(Pt(it,_,hp(),"bool"),_)],Os=(it,_)=>[it.run(Pt(it,_,mp(),"bool"),_)],As=(it,_)=>[it.run(Pt(it,_,bp(),"bool"),_)],Ps=(it,_)=>[it.run(Pt(it,_,pp()),_)],Es=(it,_)=>[it.run(Pt(it,_,gp(),"bool"),_)],Ds=(it,_)=>[it.run(Pt(it,_,Tp()),_)],Ls=(it,_)=>[it.run(Pt(it,_,wp()),_)],$s=(it,_)=>[it.run(Pt(it,_,dp()),_)],ks=(it,_)=>[it.run(Pt(it,_,xp(),"bool"),_)]}),Fs,Ns,Sp,Cs=x(()=>{U(),Fs=(it,_,lt)=>(Sp(_),[it.cast(_[0],lt)]),Ns=it=>ut.tensorDataTypeFromProto(it.attributes.getInt("to")),Sp=it=>{if(!it||it.length!==1)throw new Error("Cast requires 1 input.");if(it[0].type==="string")throw new Error("Invalid input type.")}}),Op,Ap,Rs,Wr,Gs=x(()=>{X(),R(),Vt(),ge(),Op=(it,_)=>({name:"Concat (packed)",inputNames:Array.from({length:it},(lt,ft)=>`X${ft}`),inputTypes:Array(it).fill(2),cacheHint:_}),Ap=(it,_,lt,ft)=>{let mt=lt[0].dims.slice();if(ft>=mt.length||ft<-1*mt.length)throw new Error("axis specified for concat doesn't match input dimensionality");ft<0&&(ft=mt.length+ft);let pt=mt.slice(0);for(let Fr=1;Fr<lt.length;Fr++){let kr=lt[Fr].dims.slice();for(let Br=0;Br<mt.length;Br++)if(Br===ft)pt[ft]+=kr[Br];else if(mt[Br]!==kr[Br])throw new Error("non concat dimensions must match")}let gt=pt.length,bt=Fe("coords",gt),wt=ht(gt),vt=Ut(),Ct=lt.map(Fr=>Fr.dims),Rt=Gt(gt),Mt=new Array(Ct.length-1);Mt[0]=Ct[0][ft];for(let Fr=1;Fr<Mt.length;Fr++)Mt[Fr]=Mt[Fr-1]+Ct[Fr][ft];let Ot=Rt[ft],Nt=Rt.slice(-2),Ht=Rt.join(),Kt=`if (${Ot} < ${Mt[0]}) {
        return getChannel(
            getX0(${Ht}), vec2(${Nt.join()}));
        }`;for(let Fr=1;Fr<Mt.length;Fr++){let kr=Mt[Fr-1];Kt+=`
            if (${Ot} < ${Mt[Fr]}  && ${Ot} >= ${Mt[Fr-1]}) {
              return getChannel(
                getX${Fr}(${Wr(Rt,Ot,kr)}),
                vec2(${Wr(Nt,Ot,kr)}));
            }`}let hr=Mt.length,Qt=Mt[Mt.length-1];Kt+=`
            return getChannel(
              getX${hr}(${Wr(Rt,Ot,Qt)}),
              vec2(${Wr(Nt,Ot,Qt)}));`;let mr=D(it.session.backend.glContext.version),br=`
          ${vt}
          float getValue(${Rt.map(Fr=>"int "+Fr)}) {
            ${Kt}
          }

          void main() {
            ${wt} coords = getOutputCoords();
            int lastDim = coords.${Rt[gt-1]};
            coords.${Rt[gt-1]} = coords.${Rt[gt-2]};
            coords.${Rt[gt-2]} = lastDim;

            vec4 result = vec4(getValue(${bt}), 0., 0., 0.);

            ${bt[gt-1]} = ${bt[gt-1]} + 1;
            if (${bt[gt-1]} < ${pt[gt-1]}) {
              result.g = getValue(${bt});
            }

            ${bt[gt-2]} = ${bt[gt-2]} + 1;
            if (${bt[gt-2]} < ${pt[gt-2]}) {
              result.a = getValue(${bt});
            }

            ${bt[gt-1]} = ${bt[gt-1]} - 1;
            if (${bt[gt-2]} < ${pt[gt-2]} &&
                ${bt[gt-1]} < ${pt[gt-1]}) {
              result.b = getValue(${bt});
            }
            ${mr.output} = result;
          }
        `;return{..._,output:{dims:pt,type:lt[0].type,textureType:2},shaderSource:br,hasMain:!0}},Rs=(it,_,lt)=>{let ft=Op(_.length,lt.cacheKey);return{...ft,get:()=>Ap(it,ft,_,lt.axis)}},Wr=(it,_,lt)=>{let ft=it.indexOf(_);return it.map((mt,pt)=>pt===ft?`${mt} - ${lt}`:mt).join()}}),Ms,Pp,Ep,Dp,Vs,Lp,$p,kp,Us,Bp,zs=x(()=>{at(),R(),Gs(),Ms=(it,_,lt)=>(Bp(_),it.session.pack&&_[0].dims.length>1?[it.run(Rs(it,_,lt),_)]:[it.run(Dp(it,_,lt),_)]),Pp=(it,_)=>({name:"Concat",inputNames:Array.from({length:it},(lt,ft)=>`X${ft}`),inputTypes:Array(it).fill(0),cacheHint:_}),Ep=(it,_,lt,ft)=>{let mt=lt[0].dims.slice();if(ft>=mt.length||ft<-1*mt.length)throw new Error("axis specified for concat doesn't match input dimensionality");ft<0&&(ft=mt.length+ft);let pt=mt.slice(0);for(let Ot=1;Ot<lt.length;Ot++){let Nt=lt[Ot].dims.slice();for(let Ht=0;Ht<mt.length;Ht++)if(Ht===ft)pt[ft]+=Nt[Ht];else if(mt[Ht]!==Nt[Ht])throw new Error("non concat dimensions must match")}let gt=pt.length,bt=new Array(lt.length),wt=0;for(let Ot=0;Ot<bt.length;++Ot)wt+=lt[Ot].dims[ft],bt[Ot]=wt;let vt="";lt.length<5?vt=Vs(bt):vt=Lp(bt);let Ct=$p(lt.length,gt),Rt=kp(bt),Mt=`
        ${Ct}
        ${Rt}
        ${vt}
        float process(int indices[${gt}]) {
          int textureIndex = getTextureWhereDataResides (indices[${ft}]);

          if(textureIndex != 0) {
            indices[${ft}] = indices[${ft}] - int(getSizeInConcatAxisValueFromIndex(textureIndex-int(1)));
          }

          return fetchDataFromCorrectTexture(textureIndex, indices);
        }`;return{..._,output:{dims:pt,type:lt[0].type,textureType:0},shaderSource:Mt}},Dp=(it,_,lt)=>{let ft=Pp(_.length,lt.cacheKey);return{...ft,get:()=>Ep(it,ft,_,lt.axis)}},Vs=it=>`int getTextureWhereDataResides(int index) {
      ${it.map((_,lt)=>`if(index<${_}) {return ${lt};}
`).join("")}
    }`,Lp=it=>Vs(it),$p=(it,_)=>{let lt=[`float fetchDataFromCorrectTexture(int textureIndex, int indices[${_}]) {`];for(let ft=0;ft<it;++ft)ft===0?lt.push(`	if (textureIndex == ${ft}) { return _X${ft}(indices); }`):ft===it-1?lt.push(`	else { return _X${ft}(indices); }`):lt.push(`	else if (textureIndex == ${ft}) { return _X${ft}(indices); }`);return lt.push("	}"),lt.join(`
`)},kp=it=>{let _=["int getSizeInConcatAxisValueFromIndex(int index) {"];for(let lt=0;lt<it.length;++lt)lt===0?_.push(`	if (index == ${lt}) { return ${it[lt]}; }`):lt===it.length-1?_.push(`	else { return ${it[lt]}; }`):_.push(`	else if (index == ${lt}) { return ${it[lt]}; }`);return _.push("	}"),_.join(`
`)},Us=it=>F({axis:it.attributes.getInt("axis")}),Bp=it=>{if(!it||it.length<1)throw new Error("too few inputs");let _=it[0].type,lt=it[0].dims.length;if(_==="string")throw new Error("string tensor is not supported yet");for(let ft of it){if(ft.type!==_)throw new Error("input tensors should be one type");if(ft.dims.length!==lt)throw new Error("input tensors should have the same shape")}}});function Fp(){return Et("abs")}function Np(){return Et("acos")}function Cp(){return Et("asin")}function Rp(){return Et("atan")}function Gp(){return Et("ceil")}function Mp(){return Et("cos")}function Vp(it){let _="elu";return{body:`
  const float alpha = float(${it});

  float ${_}_(float a) {
    return a >= 0.0 ? a: (exp(a) - 1.0) * alpha;
  }
  vec4 ${_}_(vec4 v) {
    return vec4(${_}_(v.x), ${_}_(v.y), ${_}_(v.z), ${_}_(v.w));
  }
  `,name:_,type:0}}function Up(){return Et("exp")}function zp(){return Et("floor")}function ho(it,_){let lt="clip";return{body:`
  const float min = float(${it});
  const float max = float(${_});

  float ${lt}_(float a) {
    return clamp(a, min, max);
  }
  vec4 ${lt}_(vec4 v) {
    return clamp(v, min, max);
  }
  `,name:lt,type:0}}function Wp(){let it="indentity";return{body:`
  float ${it}_(float a) {
    return a;
  }
  vec4 ${it}_(vec4 v) {
    return v;
  }
  `,name:it,type:0}}function Hp(it){let _="leakyRelu";return{body:`
  const float alpha = float(${it});

  float ${_}_(float a) {
    return a < 0.0 ? a * alpha : a;
  }
  vec4 ${_}_(vec4 v) {
    return vec4(${_}_(v.x), ${_}_(v.y), ${_}_(v.z), ${_}_(v.w));
  }
  `,name:_,type:0}}function qp(){return Et("log")}function jp(){let it="neg";return{body:`
  float ${it}_(float a) {
    return -a;
  }
  vec4 ${it}_(vec4 v) {
    return -v;
  }
  `,name:it,type:0}}function Xp(){let it="not";return{body:`
  float ${it}_(float a) {
    return float( ! bool(a) );
  }
  bool ${it}_(bool a) {
    return !a;
  }
  vec4 ${it}_(vec4 v) {
    return vec4(!bool(v.x), !bool(v.y), !bool(v.z), !bool(v.w));
  }
  bvec4 ${it}_(bvec4 v) {
    return bvec4(!v.x, !v.y, !v.z, !v.w);
  }
  `,name:it,type:0}}function Kp(){return Et("sin")}function mo(){let it="relu";return{body:`
  float ${it}_(float a) {
    return max( a, 0.0 );
  }
  vec4 ${it}_(vec4 v) {
    return max( v, 0.0 );
  }
  `,name:it,type:0}}function bo(){let it="sigmoid";return{body:`
  float ${it}_(float a) {
    return 1.0 / (1.0 + exp(-a));
  }
  vec4 ${it}_(vec4 v) {
    return 1.0 / (1.0 + exp(-v));
  }
  `,name:it,type:0}}function Jp(){return Et("sqrt")}function Zp(){return Et("tan")}function Yp(){let it="tanh";return{body:`
  float ${it}_(float a) {
    a = clamp(a, -10., 10.);
    a = exp(2.*a);
    return (a - 1.) / (a + 1.);
  }
  vec4 ${it}_(vec4 v) {
    v = clamp(v, -10., 10.);
    v = exp(2.*v);
    return (v - 1.) / (v + 1.);
  }
  `,name:it,type:0}}function Et(it){return{body:`
  float ${it}_(float a) {
    return ${it}(a);
  }
  vec4 ${it}_(vec4 v) {
    return ${it}(v);
  }
  `,name:it,type:0}}var Qp,Z,Ws,Hs,qs,js,yo,Xs,Ks,td,Js,Zs,Ys,Qs,tu,eu,go,ru,nu,ou,iu,au,su,uu,lu,fu,cu,pu,xo=x(()=>{at(),U(),Xt(),X(),R(),Qp=(it,_,lt,ft)=>{let mt=it.session.pack?2:0,pt=D(it.session.backend.glContext.version);return{..._,output:{dims:lt.dims,type:lt.type,textureType:mt},shaderSource:`
     ${ft.body}
     void main() {
       vec4 v = ${pt.texture2D}(A, TexCoords);
       v = ${ft.name}_(v);
       ${pt.output} = v;
     }
     `,hasMain:!0}},Z=(it,_,lt,ft)=>{let mt=it.session.pack?2:0,pt={name:lt.name,inputTypes:[mt],inputNames:["A"],cacheHint:ft};return{...pt,get:()=>Qp(it,pt,_,lt)}},Ws=(it,_)=>[it.run(Z(it,_[0],Fp()),_)],Hs=(it,_)=>[it.run(Z(it,_[0],Np()),_)],qs=(it,_)=>[it.run(Z(it,_[0],Cp()),_)],js=(it,_)=>[it.run(Z(it,_[0],Rp()),_)],yo=(it,_,lt)=>[it.run(Z(it,_[0],ho(lt.min,lt.max),lt.cacheKey),_)],Xs=it=>F({min:it.attributes.getFloat("min",me),max:it.attributes.getFloat("max",be)}),Ks=(it,_)=>{let lt=td(it,_);return yo(it,[_[0]],lt)},td=(it,_)=>{if(_.length>=3&&(!it.session.isInitializer(_[1].dataId)||!it.session.isInitializer(_[2].dataId)))throw new Error("dynamic clip attributes are not allowed");let lt=_.length>=3?_[1].numberData[0]:me,ft=_.length>=3?_[2].numberData[0]:be;return F({min:lt,max:ft})},Js=(it,_)=>[it.run(Z(it,_[0],Gp()),_)],Zs=(it,_)=>[it.run(Z(it,_[0],Mp()),_)],Ys=(it,_,lt)=>[it.run(Z(it,_[0],Vp(lt.alpha),lt.cacheKey),_)],Qs=it=>F({alpha:it.attributes.getFloat("alpha",1)}),tu=(it,_)=>[it.run(Z(it,_[0],Up()),_)],eu=(it,_)=>[it.run(Z(it,_[0],zp()),_)],go=(it,_)=>[it.run(Z(it,_[0],Wp()),_)],ru=(it,_,lt)=>[it.run(Z(it,_[0],Hp(lt.alpha),lt.cacheKey),_)],nu=it=>F({alpha:it.attributes.getFloat("alpha",.01)}),ou=(it,_)=>[it.run(Z(it,_[0],qp()),_)],iu=(it,_)=>[it.run(Z(it,_[0],jp()),_)],au=(it,_)=>[it.run(Z(it,_[0],Xp()),_)],su=(it,_)=>[it.run(Z(it,_[0],mo()),_)],uu=(it,_)=>[it.run(Z(it,_[0],bo()),_)],lu=(it,_)=>[it.run(Z(it,_[0],Kp()),_)],fu=(it,_)=>[it.run(Z(it,_[0],Jp()),_)],cu=(it,_)=>[it.run(Z(it,_[0],Zp()),_)],pu=(it,_)=>[it.run(Z(it,_[0],Yp()),_)]});function zt(it){let _;switch(it.activation){case"Relu":_=mo();break;case"Sigmoid":_=bo();break;case"Clip":_=ho(it.clipMin,it.clipMax);break;default:return{activationFunction:"",applyActivation:""}}let lt=_.name,ft=_.body,mt=`value = ${lt}_(value);`;return{activationFunction:ft,applyActivation:mt}}var Ne,xe=x(()=>{U(),xo(),Ne=it=>{let _=it.getString("activation","");if(_==="Clip"){let[lt,ft]=it.getFloats("activation_params",[me,be]);return{activation:_,clipMax:ft,clipMin:lt,activationCacheKey:`${_}:${lt},${ft}`}}return{activation:_,activationCacheKey:_}}}),rd,nd,du,hu=x(()=>{It(),X(),R(),Hr(),xe(),rd=(it,_)=>({name:"GroupedConv",inputNames:it?["X","W","Bias"]:["X","W"],inputTypes:it?[0,0,0]:[0,0],cacheHint:_}),nd=(it,_,lt,ft)=>{let mt=_.length>2?"value += getBias(output_channel);":"",pt=_[0].dims.slice(),gt=_[1].dims.slice(),bt=gt[0]/ft.group;z.verbose("GroupedConv",`autpPad:${ft.autoPad}, dilations:${ft.dilations}, group:${ft.group}, kernelShape:${ft.kernelShape}, pads:${ft.pads}, strides:${ft.strides}`);let wt=Ce(pt,gt,ft.dilations,ft.pads,ft.strides),vt=D(it.session.backend.glContext.version),{activationFunction:Ct,applyActivation:Rt}=zt(ft),Mt=`
  const ivec2 strides = ivec2(${ft.strides[0]}, ${ft.strides[1]});
  const ivec2 pads = ivec2(${ft.pads[0]}, ${ft.pads[1]});
  ${Ct}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;
    ivec2 xRCCorner = coords.zw * strides - pads;
    int group_id = output_channel / ${bt};

    float value = 0.0;
    for (int wInChannel = 0; wInChannel < ${gt[1]}; wInChannel++) {
      int input_channel = group_id * ${gt[1]} + wInChannel;
      for (int wHeight = 0; wHeight < ${gt[2]}; wHeight++) {
        int xHeight = xRCCorner.x + wHeight * ${ft.dilations[0]};

        if (xHeight < 0 || xHeight >= ${pt[2]}) {
          continue;
        }

        for (int wWidth = 0; wWidth < ${gt[3]}; wWidth++) {
          int xWidth = xRCCorner.y + wWidth * ${ft.dilations[1]};
          if (xWidth < 0 || xWidth >= ${pt[3]}) {
            continue;
          }

          float xVal = getX(batch, input_channel, xWidth, xHeight);
          float wVal = getW(output_channel, wInChannel, wWidth, wHeight);
          value += xVal*wVal;
        }
      }
    }
    ${mt}
    ${Rt}
    ${vt.output} = vec4(value, .0, .0, .0);
  }
`;return{...lt,output:{dims:wt,type:_[0].type,textureType:0},shaderSource:Mt,hasMain:!0}},du=(it,_,lt)=>{let ft=rd(_.length>2,lt.cacheKey);return{...ft,get:()=>nd(it,_,ft,lt)}}}),od,id,mu,bu=x(()=>{X(),R(),ge(),od=it=>({name:"Im2Col (packed)",inputNames:["A"],inputTypes:[2],cacheHint:it}),id=(it,_,lt,ft,mt,pt)=>{let gt=lt.dims,bt=ft.dims,wt=2,vt=3,Ct=mt.length,Rt=[bt[1]*bt[2]*bt[3],mt[2]*mt[3]],Mt=bt[2]*bt[3],Ot=Ut(),Nt=D(it.session.backend.glContext.version),Ht="";for(let hr=0;hr<=1;hr++)for(let Qt=0;Qt<=1;Qt++)Ht+=`
            blockIndex = rc.x + ${Qt};
            pos = rc.y + ${hr};

            if(blockIndex < ${Rt[1]} && pos < ${Rt[0]}) {
              offsetY = int(blockIndex / (${mt[Ct-1]})) * ${pt.strides[0]} -
                ${pt.pads[0]};
              d0 = offsetY + ${pt.dilations[0]} * (imod(pos, ${Mt}) / ${bt[2]});

              if(d0 < ${gt[wt]} && d0 >= 0) {
                offsetX = imod(blockIndex, ${mt[Ct-1]}) * ${pt.strides[1]} -
                  ${pt.pads[1]};
                d1 = offsetX + ${pt.dilations[1]} * imod(imod(pos, ${Mt}), ${bt[2]});

                if(d1 < ${gt[vt]} && d1 >= 0) {

                  ch = int(float(pos)/ ${Mt}.);
                    innerDims = vec2(d0, d1);
                    result[${hr*2+Qt}] = getChannel(
                      getA(0, ch, int(innerDims.x),
                      int(innerDims.y)), innerDims);
                }
              }
            }

          `;let Kt=`
      ${Ot}

      void main() {
        ivec2 rc = getOutputCoords();
          vec4 result = vec4(0.0);
          int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
          vec2 innerDims;
          ${Ht}
          ${Nt.output} = result;
      }
            `;return{..._,output:{dims:Rt,type:lt.type,textureType:2},shaderSource:Kt,hasMain:!0}},mu=(it,_,lt,ft,mt)=>{let pt=od(mt.cacheKey);return{...pt,get:()=>id(it,pt,_,lt,ft,mt)}}});function sd(it,_,lt){let ft=_[0].dims,mt=_[1].dims,pt=dt.calcShape(ft,mt,!0);if(!pt)throw new Error("Can't use matmul on the given tensors");let gt=ht(pt.length),bt=Gt(),{activationFunction:wt,applyActivation:vt}=zt(lt),Ct=_.length>2,Rt=Ct?"value += getBiasForMatmul();":"",Mt=Ct?`${wo(gt,bt,_[2].dims,pt,!1)}`:"",Ot=pt.length,Nt=ft.length,Ht=mt.length,Kt=ft[ft.length-1],hr=`
    ${wt}
    ${Mt}
    float process(int indices[${Ot}]) {
        int a[${Nt}];
        int b[${Ht}];
        bcastMatmulIndices_A(indices, a);
        bcastMatmulIndices_B(indices, b);

        float value;
        for (int k=0; k<${Kt}; ++k) {
            a[${Nt-1}] = k;
            b[${Ht-2}] = k;
            value += _A(a) * _B(b);
        }
        ${Rt}
        ${vt}
        return value;
    }`;return{...it,output:{dims:pt,type:_[0].type,textureType:0},shaderSource:hr}}function To(it,_){let lt=ad(it.length>2,_.activationCacheKey);return{...lt,get:()=>sd(lt,it,_)}}function wo(it,_,lt,ft,mt){let pt="",gt=lt.length,bt=ft.length,wt=bt-gt;bt<2&&gt>0?pt="coords":pt=lt.map((Mt,Ot)=>`coords.${_[Ot+wt]}`).join(", ");let vt=dt.getBroadcastDims(lt,ft).map(Mt=>`coords.${_[Mt+wt]} = 0;`).join(`
`),Ct=A.size(lt)===1,Rt="vec4(outputValue.xx, outputValue.yy)";return Ct&&(Rt="vec4(outputValue.x)"),mt?`
vec4 getBiasForMatmul() {
  ${it} coords = getOutputCoords();
  ${vt}
  vec4 outputValue = getBias(${pt});
  return ${Rt};
}`:`
float getBiasForMatmul() {
  ${it} coords = getOutputCoords();
  ${vt}
  return getBias(coords.x);
}`}var yu,gu,ad,ud,qr=x(()=>{U(),R(),Vt(),xe(),vo(),yu=(it,_,lt)=>(ud(_),it.session.pack?[it.run(jr(it,_,lt),_)]:[it.run(To(_,lt),_)]),gu=it=>Ne(it.attributes),ad=(it,_)=>({name:"MatMul",inputNames:it?["A","B","Bias"]:["A","B"],inputTypes:it?[0,0,0]:[0,0],cacheHint:_}),ud=it=>{if(!it||it.length!==2)throw new Error("MatMul requires 2 inputs.");if(it[0].dims[it[0].dims.length-1]!==it[1].dims[it[1].dims.length-2])throw new Error("shared dimension does not match.");if(it[0].type!=="float32"&&it[0].type!=="float64"||it[1].type!=="float32"&&it[1].type!=="float64")throw new Error("inputs should be float type");if(it[0].type!==it[1].type)throw new Error("inputs types should match")}});function cd(it,_,lt,ft){let mt=[],pt=[],gt=lt[0].dims,bt=lt[1].dims,wt=gt.length,vt=bt.length,Ct=ft.length,Rt=Ct-wt,Mt=Ct-vt;mt=gt.map((Qt,mr)=>`coords.${_[mr+Rt]}`),mt[wt-1]="i*2",mt.join(", "),pt=bt.map((Qt,mr)=>`coords.${_[mr+Mt]}`),pt[vt-2]="i*2",pt.join(", ");let Ot=dt.getBroadcastDims(gt,ft),Nt=dt.getBroadcastDims(bt,ft),Ht=Ot.map(Qt=>`coords.${_[Qt+Rt]} = 0;`).join(`
`),Kt=Nt.map(Qt=>`coords.${_[Qt+Mt]} = 0;`).join(`
`),hr=`int lastDim = coords.${_[Ct-1]};
  coords.${_[Ct-1]} = coords.${_[Ct-2]};
  coords.${_[Ct-2]} = lastDim;`;return`
vec4 getAAtOutCoordsMatmul(int i) {
  ${it} coords = getOutputCoords();
  ${hr}
  ${Ht}
  vec4 outputValue = getA(${mt});
  return outputValue;
}

vec4 getBAtOutCoordsMatmul(int i) {
  ${it} coords = getOutputCoords();
  ${hr}
  ${Kt}
  vec4 outputValue = getB(${pt});
  return outputValue;
}`}function pd(it,_){let lt="";for(let ft=0;ft<_-2;ft++)lt+=`rc.${it[ft]}, `;return lt+=`rc.${it[_-2]}, i*2`,lt}function dd(it,_){let lt="";for(let ft=0;ft<_-2;ft++)lt+=`rc.${it[ft]}, `;return lt+=`i*2, rc.${it[_-1]}`,lt}var ld,fd,jr,vo=x(()=>{U(),X(),R(),Vt(),xe(),qr(),ld=(it,_)=>({name:"MatMul (packed)",inputNames:it?["A","B","Bias"]:["A","B"],inputTypes:it?[2,2,2]:[2,2],cacheHint:_}),fd=(it,_,lt,ft)=>{let mt=lt.length>2,pt=mt?"value += getBiasForMatmul();":"",gt=lt[0].dims,bt=lt[1].dims,wt=dt.calcShape(gt,bt,!0),vt=!A.areEqual(lt[0].dims,lt[1].dims);if(!wt)throw new Error("Can't use matmul on the given tensors");let Ct=gt[gt.length-1],Rt=Math.ceil(Ct/2),Mt=gt.length,Ot=bt.length,Nt=D(it.session.backend.glContext.version),Ht=ht(wt.length),Kt=wt.length,hr=Gt(),{activationFunction:Qt,applyActivation:mr}=zt(ft),br=mt?`${wo(Ht,hr,lt[2].dims,wt,!0)}`:"",Fr=vt?`${cd(Ht,hr,lt,wt)}`:"",kr=vt?"getAAtOutCoordsMatmul(i)":`getA(${pd(hr,Mt)})`,Br=vt?"getBAtOutCoordsMatmul(i)":`getB(${dd(hr,Ot)})`,Nr=vt?"":`${Ht} rc =
          getOutputCoords(); int lastDim = rc.${hr[Kt-1]}; rc.${hr[Kt-1]} =
          rc.${hr[Kt-2]}; rc.${hr[Kt-2]} = lastDim;
      `,jn=`
            ${Fr}
            ${br}
            ${Qt}
            void main() {
              ${Nr}

              vec4 value = vec4(0);
              for (int i = 0; i < ${Rt}; i++) {
                vec4 a = ${kr};
                vec4 b = ${Br};

                value += (a.rrbb * b.rgrg);
                value += (a.ggaa * b.baba);
              }
              ${pt}
              ${mr}
              ${Nt.output} = value;
            }`;return{..._,output:{dims:wt,type:lt[0].type,textureType:2},shaderSource:jn,hasMain:!0}},jr=(it,_,lt)=>{let ft=ld(_.length>2,lt.activationCacheKey);return{...ft,get:()=>fd(it,ft,_,lt)}}}),xu,Tu=x(()=>{Hr(),bu(),vo(),xu=(it,_,lt)=>{let ft=_[0].dims,mt=_[1].dims,pt=Ce(ft,mt,lt.dilations,lt.pads,lt.strides),gt=it.run(mu(it,_[0],_[1],pt,lt),[_[0]]),bt=it.reshapePacked(_[1],[mt[0],mt[1]*mt[2]*mt[3]]),wt=_.length===3?[bt,gt,_[2]]:[bt,gt],vt=it.run(jr(it,wt,lt),wt);return it.reshapePacked(vt,pt)}}),hd,md,wu,Io,_o=x(()=>{R(),hd=it=>({name:"Im2Col",inputNames:["X"],inputTypes:[0],cacheHint:it}),md=(it,_,lt,ft,mt,pt)=>{let gt=lt.dims,bt=ft.dims,wt=mt.length,vt=Io(gt,bt,mt,4),Ct=`
        const int XC = ${gt[1]};
        const int XH = ${gt[2]};
        const int XW = ${gt[3]};
        const int KH = ${pt.kernelShape[0]};
        const int KW = ${pt.kernelShape[1]};
        const int dilationH = ${pt.dilations[0]};
        const int dilationW = ${pt.dilations[1]};
        const int strideH = ${pt.strides[0]};
        const int strideW = ${pt.strides[1]};
        const int padH = ${pt.pads[0]};
        const int padW = ${pt.pads[1]};
        const int KHKW = KH*KW;
        const int XCKHKW = XC * KHKW;
        const int outputChannels = 4;
        vec4 process(int indices[${wt}]) {
          int b  = indices[0]; // batch size
          int oh = indices[1] * strideH - padH; //output height
          int ow = indices[2] * strideW - padW; //output width
          int p = indices[3] * outputChannels; //patch
          vec4 value = vec4(0.0);
          for(int i=0; i < outputChannels; ++i) {
            if(p < XCKHKW) {
              int patchC = p / KHKW;
              int patchH = (p - patchC*KHKW) / KW;
              int patchW = (p - patchC*KHKW) - patchH * KW;
              int xh2 = oh + patchH * dilationH;
              int xw2 = ow + patchW * dilationW;
              int x[${gt.length}];
              x[0] = b;
              x[1] = patchC;
              x[2] = xh2;
              x[3] = xw2;
              if(xh2 >= 0 &&
                  xh2 < XH &&
                  xw2 >= 0 &&
                  xw2 < XW) {
                value[i] = _X(x);
              }
            }
            ++p;
          }
          return value;
        }
        `;return{..._,output:{dims:vt,type:lt.type,textureType:4},shaderSource:Ct}},wu=(it,_,lt,ft,mt)=>{let pt=hd(mt.cacheKey);return{...pt,get:()=>md(it,pt,_,lt,ft,mt)}},Io=(it,_,lt,ft=4)=>[lt[0],lt[2],lt[3],Math.ceil(it[1]*_[2]*_[3]/ft)]}),bd,yd,vu,Iu=x(()=>{U(),X(),R(),xe(),_o(),bd=(it,_)=>({name:"ConvDotProduct",inputNames:it?["Im2Col","K","B"]:["Im2Col","K"],inputTypes:it?[0,4,0]:[0,4],cacheKey:_.activationCacheKey}),yd=(it,_,lt,ft,mt)=>{let pt=lt[0].dims,gt=lt[1].dims,bt=[gt[0],Math.ceil(pt[1]*gt[2]*gt[3]/4)],wt=Io(pt,gt,ft),[vt,Ct]=it.calculateTextureWidthAndHeight(bt,4),Rt=A.computeStrides(wt),[Mt,Ot]=it.calculateTextureWidthAndHeight(wt,4),Nt=ft.length,Ht=lt.length<3?"0.0":"_B(b)",Kt=Math.ceil(pt[1]*gt[2]*gt[3]/4),{activationFunction:hr,applyActivation:Qt}=zt(mt),mr=D(it.session.backend.glContext.version),br=`
${hr}
float process(int indices[${Nt}]) {
  int b[1];
  b[0] = indices[1];
  int im2col[4];
  im2col[0] = indices[0];
  im2col[1] = indices[2];
  im2col[2] = indices[3];
  int im2colOffset = im2col[0] * ${Rt[0]} + im2col[1] * ${Rt[1]} + im2col[2] * ${Rt[2]};
  int kernelOffset = indices[1] * ${bt[1]};
  float value = ${Ht};
  for (int i = 0; i < ${Kt}; ++i) {
    vec2 im2colCoords = offsetToCoords(im2colOffset, ${Mt}, ${Ot});
    vec2 kernelCoords = offsetToCoords(kernelOffset, ${vt}, ${Ct});
    value += dot(${mr.texture2D}(Im2Col, im2colCoords), ${mr.texture2D}(K, kernelCoords));
    ++im2colOffset;
    ++kernelOffset;
  }
  ${Qt}
  return value;
}`;return{..._,output:{dims:ft,type:lt[0].type,textureType:0},shaderSource:br}},vu=(it,_,lt,ft)=>{let mt=bd(_.length>2,ft);return{...mt,get:()=>yd(it,mt,_,lt,ft)}}}),Ce,So,gd,xd,Td,wd,Oo,vd,Hr=x(()=>{at(),U(),hu(),Tu(),Iu(),xe(),_o(),qr(),Ce=(it,_,lt,ft,mt)=>{let pt=it[0],gt=it.slice(2),bt=gt.length,wt=_[0],vt=_.slice(2).map((Rt,Mt)=>Rt+(Rt-1)*(lt[Mt]-1)),Ct=gt.map((Rt,Mt)=>Rt+ft[Mt]+ft[Mt+bt]).map((Rt,Mt)=>Math.floor((Rt-vt[Mt]+mt[Mt])/mt[Mt]));return[pt,wt].concat(...Ct)},So=(it,_,lt)=>(vd(_,lt),gd(it,_,lt)),gd=(it,_,lt)=>{let ft=wd(lt,_),mt=it.session.pack,pt=ft.kernelShape[0]===1&&ft.kernelShape[1]===1;return ft.group>1?[it.run(du(it,_,ft),_)]:pt&&mt?[xd(it,_,ft)]:mt&&_[0].dims.length===4&&_[0].dims[0]===1&&!pt?[xu(it,_,ft)]:[Td(it,_,ft)]},xd=(it,_,lt)=>{let ft=_[0].dims,mt=_[1].dims,pt=Ce(ft,mt,lt.dilations,lt.pads,lt.strides),gt=it.reshapeUnpacked(_[0],[ft[1],ft[2]*ft[3]]),bt=it.reshapeUnpacked(_[1],[mt[0],mt[1]]),wt=_.length>2?[bt,gt,_[2]]:[bt,gt],vt=it.run(To(wt,lt),wt);return it.reshapeUnpacked(vt,pt)},Td=(it,_,lt)=>{let ft=_[0].dims,mt=_[1].dims,pt=Ce(ft,mt,lt.dilations,lt.pads,lt.strides),gt=it.run(wu(it,_[0],_[1],pt,lt),[_[0]]),bt=_.length===3?[gt,_[1],_[2]]:[gt,_[1]];return it.run(vu(it,_,pt,lt),bt)},wd=(it,_)=>{let lt=it.kernelShape.slice();if(it.kernelShape.length===0)for(let pt=2;pt<_[1].dims.length;++pt)lt.push(_[1].dims[pt]);let ft=it.pads.slice();he.adjustPadsBasedOnAutoPad(_[0].dims,it.strides,it.dilations,lt,ft,it.autoPad);let mt=Object.assign({},it);return Object.assign(mt,{kernelShape:lt,pads:ft,cacheKey:it.cacheKey}),mt},Oo=it=>{let _=it.attributes,lt=Ne(_),ft=_.getString("auto_pad","NOTSET"),mt=_.getInts("dilations",[1,1]),pt=_.getInt("group",1),gt=_.getInts("kernel_shape",[]),bt=_.getInts("pads",[0,0,0,0]),wt=_.getInts("strides",[1,1]);return F({autoPad:ft,dilations:mt,group:pt,kernelShape:gt,pads:bt,strides:wt,...lt})},vd=(it,_)=>{if(!it||it.length!==2&&it.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(it[0].dims.length!==4||it[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");let lt=it[0].dims[1],ft=it[1].dims[1]*_.group;if(lt!==ft)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(it.length===3&&(it[2].dims.length!==1||it[1].dims[0]!==it[2].dims[0]))throw new Error("invalid bias");let mt=it[0].dims.length-2;if(_.dilations.length!==mt)throw new Error(`dilations should be ${mt}D`);if(_.strides.length!==mt)throw new Error(`strides should be ${mt}D`);if(_.pads.length!==mt*2)throw new Error(`pads should be ${mt*2}D`);if(_.kernelShape.length!==0&&_.kernelShape.length!==it[1].dims.length-2)throw new Error("invalid kernel shape");if(it[0].type!=="float32"||it[1].type!=="float32")throw new Error("Conv input(X,W) should be float tensor");if(it.length===3&&it[2].type!=="float32")throw new Error("Conv input(bias) should be float tensor")}}),Id,_d,Sd,_u,Od,Ad,Pd,Ed,Dd,Ld,Su,$d,Ou=x(()=>{at(),X(),R(),xe(),Id=(it,_,lt,ft,mt,pt)=>(it-1)*_+lt+(ft-1)*mt+1-pt,_d=(it,_,lt,ft,mt)=>{let pt=Math.floor(it/2);_==="SAME_UPPER"?(lt[ft]=pt,lt[mt]=it-pt):_==="SAME_LOWER"&&(lt[ft]=it-pt,lt[mt]=pt)},Sd=(it,_,lt,ft,mt,pt,gt,bt)=>{let wt=it.length-2,vt=bt.length===0;for(let Ct=0;Ct<wt;++Ct){let Rt=vt?it[Ct+2]*pt[Ct]:bt[Ct],Mt=Id(it[Ct+2],pt[Ct],mt[Ct],_[Ct],lt[Ct],Rt);_d(Mt,ft,mt,Ct,Ct+wt),vt&&bt.push(pt[Ct]*(it[Ct+2]-1)+gt[Ct]+(_[Ct]-1)*lt[Ct]+1-mt[Ct]-mt[Ct+wt])}},_u=(it,_,lt)=>($d(_,lt),Od(it,_,lt)),Od=(it,_,lt)=>{let ft=Ld(lt,_);return[Dd(it,_,ft)]},Ad=(it,_)=>({name:"ConvTranspose",inputNames:it?["X","W","B"]:["X","W"],inputTypes:it?[0,0,0]:[0,0],cacheHint:_}),Pd=(it,_,lt,ft)=>{let mt=_.length>2?"getB(output_channel)":"0.0",pt=_[0].dims,gt=_[1].dims,bt=gt[1],wt=gt[0]/ft.group,vt=[_[0].dims[0],_[1].dims[1]*ft.group,...ft.outputShape],Ct=D(it.session.backend.glContext.version),{activationFunction:Rt,applyActivation:Mt}=zt(ft),Ot=`
  const ivec2 strides = ivec2(${ft.strides[0]}, ${ft.strides[1]});
  const ivec2 pads = ivec2(${ft.pads[0]}, ${ft.pads[1]});
  ${Rt}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;

    ivec2 loc = coords.zw + pads;

    int group_id = output_channel / ${bt};
    int wOutChannel = output_channel - group_id * ${bt};

    float value = ${mt};
    for (int inChannelOffset = 0; inChannelOffset < ${wt}; inChannelOffset++) {
      int input_channel = group_id * ${wt} + inChannelOffset;
      for (int wWOff = 0; wWOff < ${gt[2]}; wWOff++) {
        for (int wHOff = 0; wHOff < ${gt[3]}; wHOff++) {
          ivec2 wOff = ivec2(wWOff * ${ft.dilations[0]}, wHOff * ${ft.dilations[1]});
          ivec2 wLoc = loc - wOff;
          ivec2 wLocIn = wLoc / strides;
          if (
            wLocIn * strides == wLoc &&
            wLocIn.x >= 0 && wLocIn.x < ${pt[2]} &&
            wLocIn.y >= 0 && wLocIn.y < ${pt[3]}
          ) {
            float xVal = getX(batch, input_channel, wLocIn.y, wLocIn.x);
            float wVal = getW(input_channel, wOutChannel, wHOff, wWOff);
            value += xVal * wVal;
          }
        }
      }
    }
    ${Mt}
    ${Ct.output} = vec4(value, .0, .0, .0);
  }
`;return{...lt,output:{dims:vt,type:_[0].type,textureType:0},shaderSource:Ot,hasMain:!0}},Ed=(it,_,lt)=>{let ft=Ad(_.length>2,lt.cacheKey);return{...ft,get:()=>Pd(it,_,ft,lt)}},Dd=(it,_,lt)=>it.run(Ed(it,_,lt),_),Ld=(it,_)=>{let lt=it.kernelShape.slice();if(it.kernelShape.length===0)for(let bt=2;bt<_[1].dims.length;++bt)lt.push(_[1].dims[bt]);let ft=it.pads.slice(),mt=it.outputShape.slice(),pt=_[0].dims;Sd(pt,lt,it.dilations,it.autoPad,ft,it.strides,it.outputPadding,mt);let gt=Object.assign({},it);return Object.assign(gt,{kernelShape:lt,pads:ft,outputShape:mt,cacheKey:it.cacheKey}),gt},Su=it=>{let _=it.attributes,lt=Ne(_),ft=_.getString("auto_pad","NOTSET"),mt=_.getInts("dilations",[1,1]),pt=_.getInt("group",1),gt=_.getInts("kernel_shape",[]),bt=_.getInts("output_padding",[0,0]),wt=_.getInts("output_shape",[]),vt=_.getInts("pads",[0,0,0,0]),Ct=_.getInts("strides",[1,1]);return F({autoPad:ft,dilations:mt,group:pt,kernelShape:gt,outputPadding:bt,outputShape:wt,pads:vt,strides:Ct,...lt})},$d=(it,_)=>{if(!it||it.length!==2&&it.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(it[0].dims.length!==4||it[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");let lt=it[0].dims[1],ft=it[1].dims[0];if(lt!==ft)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let mt=it[1].dims[1]*_.group;if(it.length===3&&(it[2].dims.length!==1||it[2].dims[0]!==mt))throw new Error("invalid bias");let pt=it[0].dims.length-2;if(_.dilations.length!==pt)throw new Error(`dilations should be ${pt}D`);if(_.strides.length!==pt)throw new Error(`strides should be ${pt}D`);if(_.pads.length!==pt*2)throw new Error(`pads should be ${pt*2}D`);if(_.outputPadding.length!==pt)throw new Error(`output_padding should be ${pt}D`);if(_.kernelShape.length!==0&&_.kernelShape.length!==it[1].dims.length-2)throw new Error("invalid kernel shape");if(_.outputShape.length!==0&&_.outputShape.length!==it[0].dims.length-2)throw new Error("invalid output shape");if(it[0].type!=="float32"||it[1].type!=="float32")throw new Error("ConvTranspose input(X,W) should be float tensor");if(it.length===3&&it[2].type!=="float32")throw new Error("ConvTranspose input(bias) should be float tensor")}}),Au,Te,Pu,kd,Eu,Bd,Fd,Nd,Xr=x(()=>{at(),U(),R(),Au={name:"Transpose",inputNames:["A"],inputTypes:[0]},Te=(it,_,lt)=>(Nd(_),[it.run({...Au,cacheHint:lt.cacheKey,get:()=>kd(it,_[0],lt.perm)},_)]),Pu=it=>F({perm:it.attributes.getInts("perm",[])}),kd=(it,_,lt)=>{let ft=_.dims;lt=Eu(ft,lt);let mt=Bd(ft,lt),pt=ft.length,gt=`
      ${Fd("perm",lt,pt)}
      float process(int indices[${pt}]) {
        int a[${pt}];
        perm(a, indices);
        return _A(a);
      }`;return{...Au,output:{dims:mt,type:_.type,textureType:0},shaderSource:gt}},Eu=(it,_)=>(_&&_.length!==it.length&&(_=[...it.keys()].reverse()),_),Bd=(it,_)=>(_=Eu(it,_),A.sortBasedOnPerm(it,_)),Fd=(it,_,lt)=>{let ft=[];ft.push(`void ${it}(out int a[${lt}], int src[${lt}]) {`);for(let mt=0;mt<lt;++mt)ft.push(`	a[${_[mt]}]=src[${mt}];`);return ft.push("	}"),ft.join(`
`)},Nd=it=>{if(!it||it.length!==1)throw new Error("Transpose requires 1 input.");if(it[0].type!=="float32"&&it[0].type!=="float64")throw new Error("input should be float tensor")}}),Du,Lu,Cd,$u=x(()=>{Xr(),Du=(it,_,lt)=>{Cd(_);let ft=lt.blocksize,mt=ft*ft,pt=lt.mode==="DCR"?[0,3,4,1,5,2]:[0,1,4,2,5,3],gt=lt.mode==="DCR"?[_[0].dims[0],ft,ft,_[0].dims[1]/mt,_[0].dims[2],_[0].dims[3]]:[_[0].dims[0],_[0].dims[1]/mt,ft,ft,_[0].dims[2],_[0].dims[3]],bt=it.reshapeUnpacked(_[0],gt),wt={perm:pt,cacheKey:`${pt}`},[vt]=Te(it,[bt],wt),Ct=[_[0].dims[0],_[0].dims[1]/mt,_[0].dims[2]*ft,_[0].dims[3]*ft];return[it.reshapeUnpacked(vt,Ct)]},Lu=it=>{let _=it.attributes.getInt("blocksize");if(_<1)throw new Error(`blocksize must be >= 1, but got : ${_} for DepthToSpace`);let lt=it.attributes.getString("mode","DCR");if(lt!=="DCR"&&lt!=="CRD")throw new Error(`unrecognized mode: ${lt} for DepthToSpace`);return{mode:lt,blocksize:_}},Cd=it=>{if(it.length!==1)throw new Error(`DepthToSpace expect 1 inputs, but got ${it.length}`);if(it[0].type==="string"||it[0].dims.length!==4)throw new TypeError("DepthToSpace input should be a 4-D numeric tensor")}}),ku,Bu,Rd,Fu=x(()=>{U(),ku=(it,_,lt)=>{Rd(_,lt);let ft=A.flattenShape(_[0].dims,lt);return[it.reshapeUnpacked(_[0],ft)]},Bu=it=>it.attributes.getInt("axis",1),Rd=(it,_)=>{if(!it||it.length!==1)throw new Error("Flatten requires 1 input.");let lt=it[0].dims.length;if(lt===0)throw new Error("scalar tensor is not supported.");if(_<-lt||_>lt)throw new Error("Invalid axis");if(it[0].type==="string")throw new Error("string tensor is not supported.")}}),re,nr=x(()=>{re=["float32","float64","int32","int16","int8","uint16","uint32","uint8"]}),Nu,Cu,Gd,Md,Vd,Ud,Ru=x(()=>{at(),nr(),U(),R(),Nu=(it,_,lt)=>(Ud(_,lt.axis),[it.run(Vd(it,_,lt),_)]),Cu=it=>F({axis:it.attributes.getInt("axis",0)}),Gd={name:"Gather",inputNames:["A","B"],inputTypes:[0,0]},Md=(it,_,lt,ft)=>{let mt=lt[0].dims.slice(),pt=lt[1].dims.slice(),gt=new Array(mt.length+pt.length-1);ft=A.normalizeAxis(ft,mt.length);let bt=[];for(let Mt=0;Mt<gt.length;Mt++)Mt<ft?(gt[Mt]=mt[Mt],bt.push(`inputIdx[${Mt}] = outputIdx[${Mt}];`)):Mt<ft+pt.length?(gt[Mt]=pt[Mt-ft],bt.push(`indexDataIdx[${Mt-ft}] = outputIdx[${Mt}];`)):(gt[Mt]=mt[Mt-pt.length+1],bt.push(`inputIdx[${Mt-pt.length+1}] = outputIdx[${Mt}];`));let wt=gt.length||1,vt=mt.length,Ct=pt.length||1,Rt=`
      float process(int outputIdx[${wt}]) {
        int inputIdx[${vt}];
        int indexDataIdx[${Ct}];
        indexDataIdx[0] = 0;
        ${bt.join(`
        `)}
        int idx = int(_B(indexDataIdx));
        inputIdx[${ft}] = idx < 0 ? idx + ${mt[ft]} : idx;
        return _A(inputIdx);
      }`;return{..._,output:{dims:gt,type:lt[0].type,textureType:0},shaderSource:Rt}},Vd=(it,_,lt)=>{let ft={...Gd,cacheHint:lt.cacheKey};return{...ft,get:()=>Md(it,ft,_,lt.axis)}},Ud=(it,_)=>{if(!it||it.length!==2)throw new Error("Gather requires 2 inputs.");let lt=it[0].dims.length;if(lt<1)throw new Error("Invalid input shape.");if(_<-lt||_>lt-1)throw new Error("Invalid axis.");if(re.indexOf(it[0].type)===-1)throw new Error("Invaid input type.");if(it[1].type!=="int32"&&it[1].type!=="int16")throw new Error("Invaid input type.")}}),Ao,Gu,Mu,Vu,zd,Wd,Hd,Uu=x(()=>{at(),U(),R(),Ao=(it,_,lt)=>(Hd(_,lt),[it.run(zd(_,lt),_)]),Gu=(it,_)=>{let lt=it.attributes.getInt("transA",0)!==0,ft=it.attributes.getInt("transB",0)!==0,mt=it.attributes.getFloat("alpha",1),pt=it.attributes.getFloat("beta",1);return F({transA:lt,transB:ft,alpha:mt,beta:pt,isOptionalC:_})},Mu=it=>Gu(it,!1),Vu=it=>Gu(it,!0),zd=(it,_)=>{let lt={name:"Gemm",inputNames:it.length===3?["A","B","C"]:["A","B"],inputTypes:it.length===3?[0,0,0]:[0,0],key:_.cacheKey};return{...lt,get:()=>Wd(lt,it,_)}},Wd=(it,_,lt)=>{let ft=_[0].dims.slice(),mt=_[1].dims.slice(),[pt,gt]=Cr.getShapeOfGemmResult(ft,lt.transA,mt,lt.transB,_.length===3?_[2].dims:void 0),bt=[pt,gt];if(!bt)throw new Error("Can't use gemm on the given tensors");let wt=ft[ft.length-1],vt="";lt.transA&&(wt=ft[0]),lt.transA&&lt.transB?vt="value += _A_T(a) * _B_T(b);":lt.transA&&!lt.transB?vt="value += _A_T(a) * _B(b);":!lt.transA&&lt.transB?vt="value += _A(a) * _B_T(b);":!lt.transA&&!lt.transB&&(vt="value += _A(a) * _B(b);");let Ct=bt.length,Rt=_.length===3?`int c[${_[2].dims.length}];`:"",Mt=_.length===3?"bcastIndices_C(indices, c);":"",Ot=_.length===3?"value += beta * _C(c);":"",Nt=`
      float process(int indices[${Ct}]) {
          int a[${Ct}];
          int b[${Ct}];
          ${Rt}

          copyVec(indices, a);
          copyVec(indices, b);
          ${Mt}

          float value = 0.0;
          for (int k=0; k<${wt}; ++k) {
              a[${Ct-1}] = k;
              b[${Ct-2}] = k;
              ${vt}
          }

          value = value * alpha;
          ${Ot}
          return value;
      }`;return{...it,output:{dims:bt,type:_[0].type,textureType:0},variables:[{name:"alpha",type:"float",data:lt.alpha},{name:"beta",type:"float",data:lt.beta}],shaderSource:Nt}},Hd=(it,_)=>{if(!it)throw new Error("Input is missing");if(_.isOptionalC&&(it.length<2||it.length>3))throw new Error("Invaid input shape.");if(!_.isOptionalC&&it.length!==3)throw new Error("Gemm requires 3 inputs");if(it.length===3&&it[2].dims.length!==1&&it[2].dims.length!==2)throw new Error("Invalid input shape of C");if(it[0].type!=="float32"&&it[0].type!=="float64"||it[1].type!=="float32"&&it[1].type!=="float64"||it.length===3&&it[2].type!=="float32"&&it[2].type!=="float64")throw new Error("Invalid input type.");if(it[0].type!==it[1].type||it.length===3&&it[0].type!==it[2].type)throw new Error("Input types are mismatched")}}),zu,Wu,qd,jd,Xd,Kd,Jd,Hu=x(()=>{at(),R(),zu=(it,_,lt)=>(Jd(_),[it.run(Xd(it,_,lt),_)]),Wu=it=>{let _=it.attributes.getFloat("scale"),lt=it.attributes.getFloats("bias");return F({scale:_,bias:lt})},qd={name:"ImageScaler",inputNames:["X"],inputTypes:[0]},jd=(it,_,lt,ft)=>{let mt=lt[0].dims.slice(),pt=mt.length,gt=`
      ${Kd(ft.bias.length)}
      float process(int indices[${pt}]) {
        return _X(indices) * scale + getBias(bias, indices[1]);
      }`;return{..._,output:{dims:mt,type:lt[0].type,textureType:0},variables:[{name:"bias",type:"float",arrayLength:ft.bias.length,data:ft.bias},{name:"scale",type:"float",data:ft.scale}],shaderSource:gt}},Xd=(it,_,lt)=>{let ft={...qd,cacheHint:lt.cacheKey};return{...ft,get:()=>jd(it,ft,_,lt)}},Kd=it=>{let _=[`float getBias(float bias[${it}], int channel) {`];for(let lt=0;lt<it;++lt)lt===0?_.push(`	if (channel == ${lt}) { return bias[${lt}]; }`):lt===it-1?_.push(`	else { return bias[${lt}]; }`):_.push(`	else if (channel == ${lt}) { return bias[${lt}]; }`);return _.push("	}"),_.join(`
`)},Jd=it=>{if(!it||it.length!==1)throw new Error("ImageScaler requires 1 input.");if(it[0].dims.length!==4)throw new Error("Invalid input shape.");if(it[0].type!=="float32"&&it[0].type!=="float64")throw new Error("Invalid input type.")}}),ju,Xu,qu,Zd,Yd,Qd,th,eh,rh,Ku=x(()=>{X(),R(),ju=(it,_,lt)=>{rh(_);let ft=it.run(Yd(_[0]),_);return[it.run(eh(it,_[0],lt,ft.dims),[_[0],ft,_[1],_[2]])]},Xu=it=>it.attributes.getFloat("epsilon",1e-5),qu={name:"InstanceNormalization_MeanAndVariance",inputNames:["X"],inputTypes:[0]},Zd=(it,_)=>{let lt=_.dims.slice(),ft=lt[1],mt=lt[2]*lt[3],pt=[lt[0],ft],gt=`
      vec4 process(int[2] indices) {
        vec4 v = vec4(0.0);
        int a[4];
        a[0] = indices[0];
        a[1] = indices[1];
        float temp = 0.0;
        for(int a2=0; a2<${lt[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${lt[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += x;
          }
        }
        float mean = temp / float(${mt});
        temp = 0.0;
        for(int a2=0; a2<${lt[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${lt[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += (x - mean) * (x - mean);
          }
        }
        v.r = mean;
        v.g = temp / float(${mt});

        return v;
      }`;return{...it,output:{dims:pt,type:_.type,textureType:4},shaderSource:gt}},Yd=it=>({...qu,get:()=>Zd(qu,it)}),Qd={name:"InstanceNormalization_ComputeOutput",inputNames:["X","MeanAndVariance","Scale","B"],inputTypes:[0,4,0,0]},th=(it,_,lt,ft,mt)=>{let pt=D(it.session.backend.glContext.version),[gt,bt]=it.calculateTextureWidthAndHeight(mt,4),[wt,vt]=[gt/4,bt],Ct=`
      vec4 get_MeanAndVariance(int[2] mv) {
        int offset = indicesToOffset_MeanAndVariance(mv);
        vec2 coords = offsetToCoords(offset, ${wt}, ${vt});
        return ${pt.texture2D}(MeanAndVariance, coords);
      }

      float process(int[4] indices) {
        int mv[2];
        mv[0] = indices[0];
        mv[1] = indices[1];
        vec4 mean_and_variance = get_MeanAndVariance(mv);
        float mean = mean_and_variance.r;
        float variance = mean_and_variance.g;

        int sb[1];
        sb[0] = indices[1];
        float scale = _Scale(sb);
        float b = _B(sb);

        return scale * (_X(indices) - mean) / sqrt(variance + epsilon) + b;
      }`;return{..._,output:{dims:lt.dims,type:lt.type,textureType:0},variables:[{name:"epsilon",type:"float",data:ft}],shaderSource:Ct}},eh=(it,_,lt,ft)=>{let mt={...Qd,cacheHint:`${lt}`};return{...mt,get:()=>th(it,mt,_,lt,ft)}},rh=it=>{if(!it||it.length!==3)throw new Error("InstanceNormalization requires 3 inputs.");let _=it[0],lt=it[1],ft=it[2];if(_.dims.length<3||lt.dims.length!==1||ft.dims.length!==1)throw new Error("Invalid input shape.");if(lt.dims[0]!==_.dims[1]||ft.dims[0]!==_.dims[1])throw new Error("Input shapes are mismatched.");if(_.type!=="float32"&&_.type!=="float64"||lt.type!=="float32"&&lt.type!=="float64"||ft.type!=="float32"&&ft.type!=="float64")throw new Error("Invalid input type.");if(it[0].dims.length!==4)throw new Error("Only support 4-D input shape.")}});function nh(it,_){let lt=it[0].dims[1],ft=it[0].dims.length,mt=-Math.floor((_.size-1)/2),pt=Math.ceil((_.size-1)/2),gt=`float(${_.alpha}) / float(${_.size})`,bt=`float(${_.bias})`,wt=`float(${_.beta})`,vt=`
    float process(int indices[${ft}]) {
        int c = indices[1];
        float x = _X(indices);
        float square_sum = 0.0;

        for (int i = ${mt}; i <= ${pt}; i++) {
          int idx = c + i;
          if (c >= 0 && c < ${lt}) {
            indices[1] = idx;
            float j = _X(indices);
            square_sum += j * j;
          }
        }
        return x / pow(${bt} + ${gt} * square_sum, ${wt});
    }`;return{...Yu,cacheHint:_.cacheKey,output:{dims:it[0].dims,type:it[0].type,textureType:0},shaderSource:vt}}function oh(it,_){return{...Yu,cacheHint:_.cacheKey,get:()=>nh(it,_)}}var Ju,Zu,Yu,ih,Qu=x(()=>{at(),R(),Ju=(it,_,lt)=>(ih(_),[it.run(oh(_,lt),_)]),Zu=it=>{let _=it.attributes.getFloat("alpha",1e-4),lt=it.attributes.getFloat("beta",.75),ft=it.attributes.getFloat("bias",1),mt=it.attributes.getInt("size");return F({alpha:_,beta:lt,bias:ft,size:mt})},Yu={name:"LRN",inputNames:["X"],inputTypes:[0]},ih=it=>{if(!it||it.length!==1)throw new Error("LRN requires 1 input.");if(it[0].dims.length!==4)throw new Error('currently only support LRN for input with "NCHW" format');if(it[0].type!=="float32")throw new Error("input should be float type")}}),ah,Po,tl,el,rl,sh,uh,lh,fh,ch,ph,dh,hh,nl=x(()=>{at(),U(),X(),R(),ah={name:"Pad",inputNames:["A"],inputTypes:[0]},Po=(it,_,lt)=>(lh(_),[it.run({...ah,cacheHint:lt.cacheKey,get:()=>uh(it,_[0],lt)},_)]),tl=it=>{let _=it.attributes.getString("mode","constant"),lt=it.attributes.getFloat("value",0),ft=it.attributes.getInts("pads");return F({mode:_,value:lt,pads:ft})},el=(it,_,lt)=>{fh(_);let ft=sh(it,_,lt);return Po(it,[_[0]],ft)},rl=it=>it.attributes.getString("mode","constant"),sh=(it,_,lt)=>{if(!it.session.isInitializer(_[1].dataId)||_.length>=3&&!it.session.isInitializer(_[2].dataId))throw new Error("dynamic pad attributes are not allowed");let ft=Array.from(_[1].integerData),mt=_.length>=3?_[2].floatData[0]:0;return F({mode:lt,pads:ft,value:mt})},uh=(it,_,lt)=>{let ft=A.padShape(_.dims.slice(),lt.pads),mt=ft.length,pt=`
      ${ch(it,_,lt)}
      float process(int[${mt}] indices) {
          return padA(indices);
      }`;return{name:"Pad",inputNames:["A"],inputTypes:[0],output:{dims:ft,type:_.type,textureType:0},shaderSource:pt}},lh=it=>{if(!it||it.length!==1)throw new Error("Pad requires 1 input");if(it[0].type!=="float32"&&it[0].type!=="float64")throw new Error("Invalid input type.")},fh=it=>{if(!it||it.length!==2&&it.length!==3)throw new Error("Pad requires 2 or 3 inputs");if(it[1].type!=="int32")throw new Error("Invalid input type.");if(it.length>=3&&it[2].type==="string")throw new Error("Invalid input type.")},ch=(it,_,lt)=>{let ft=D(it.session.backend.glContext.version),[mt,pt]=it.calculateTextureWidthAndHeight(_.dims,0),gt=A.computeStrides(_.dims);switch(lt.mode){case"constant":return ph(ft,_.dims,gt,mt,pt,lt.pads,lt.value);case"reflect":return dh(ft,_.dims,gt,mt,pt,lt.pads);case"edge":return hh(ft,_.dims,gt,mt,pt,lt.pads);default:throw new Error("Invalid mode")}},ph=(it,_,lt,ft,mt,pt,gt)=>{let bt=_.length,wt="";for(let vt=bt-1;vt>=0;--vt)wt+=`
        k = m[${vt}] - ${pt[vt]};
        if (k < 0)  return constant;
        if (k >= ${_[vt]}) return constant;
        offset += k * ${lt[vt]};
        `;return`
      float padA(int m[${bt}]) {
        const float constant = float(${gt});
        int offset = 0;
        int k = 0;
        ${wt}
        vec2 coords = offsetToCoords(offset, ${ft}, ${mt});
        float value = getColorAsFloat(${it.texture2D}(A, coords));
        return value;
      }
      `},dh=(it,_,lt,ft,mt,pt)=>{let gt=_.length,bt="";for(let wt=gt-1;wt>=0;--wt)bt+=`
        k = m[${wt}] - ${pt[wt]};
        if (k < 0) { k = -k; }
        {
          const int _2n_1 = ${2*(_[wt]-1)};
          k = int( mod( float(k), float(_2n_1) ) ) ;
          if(k >= ${_[wt]}) { k = _2n_1 - k; }
        }
        offset += k * ${lt[wt]};
        `;return`
      float padA(int m[${gt}]) {
        int offset = 0;
        int k = 0;
        ${bt}
        vec2 coords = offsetToCoords(offset, ${ft}, ${mt});
        float value = getColorAsFloat(${it.texture2D}(A, coords));
        return value;
      }
      `},hh=(it,_,lt,ft,mt,pt)=>{let gt=_.length,bt="";for(let wt=gt-1;wt>=0;--wt)bt+=`
        k = m[${wt}] - ${pt[wt]};
        if (k < 0)  k = 0;
        if (k >= ${_[wt]}) k = ${_[wt]-1};
        offset += k * ${lt[wt]};
      `;return`
      float padA(int m[${gt}]) {
        int offset = 0;
        int k = 0;
        ${bt}
        vec2 coords = offsetToCoords(offset, ${ft}, ${mt});
        float value = getColorAsFloat(${it.texture2D}(A, coords));
        return value;
      }
      `}}),il,al,sl,ul,ll,fl,cl,pl,dl,mh,ol,hl,Jr,ml,Kr,bh,bl=x(()=>{at(),U(),R(),il=(it,_,lt)=>{Jr(_);let ft={name:"AveragePool",inputNames:["X"],inputTypes:[0],cacheHint:lt.cacheKey};return[it.run({...ft,get:()=>sl(_,ft,!1,lt)},_)]},al=it=>{let _=it.attributes.getString("auto_pad","NOTSET"),lt=it.attributes.getInt("ceil_mode",0),ft=it.attributes.getInt("count_include_pad",0)!==0,mt=it.attributes.getInts("kernel_shape"),pt=it.attributes.getInts("strides",[]),gt=it.attributes.getInts("pads",[]);if(lt!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");return F({autoPad:_,ceilMode:lt,countIncludePad:ft,kernelShape:mt,strides:pt,pads:gt})},sl=(it,_,lt,ft)=>{let[mt,pt]=dl(it,ft,lt),gt=A.size(mt.kernelShape),bt="value += _X(x);",wt="";mt.countIncludePad?wt+=`value /= float(${gt});`:wt+=`value /= float(${gt} - pad);`;let vt=`
        ${ml(it[0].dims,mt,bt,wt,"0.0")}
      `;return{..._,output:{dims:pt,type:it[0].type,textureType:0},shaderSource:vt}},ul=(it,_,lt)=>{Jr(_);let ft={name:"GlobalAveragePool",inputNames:["X"],inputTypes:[0],cacheHint:`${lt.countIncludePad}`};return[it.run({...ft,get:()=>sl(_,ft,!0,lt)},_)]},ll=it=>{let _=it.attributes.getInt("count_include_pad",0)!==0;return F({autoPad:"",ceilMode:0,countIncludePad:_,kernelShape:[],strides:[],pads:[]})},fl=(it,_,lt)=>{Jr(_);let ft={name:"MaxPool",inputNames:["X"],inputTypes:[0],cacheHint:lt.cacheKey};return[it.run({...ft,get:()=>pl(_,ft,!1,lt)},_)]},cl=it=>{let _=it.attributes.getString("auto_pad","NOTSET"),lt=it.attributes.getInt("ceil_mode",0),ft=it.attributes.getInts("kernel_shape"),mt=it.attributes.getInts("strides",[]),pt=it.attributes.getInts("pads",[]),gt=it.attributes.getInt("storage_order",0),bt=it.attributes.getInts("dilations",[]);if(gt!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(lt!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");return F({autoPad:_,ceilMode:lt,countIncludePad:!1,kernelShape:ft,strides:mt,pads:pt,storageOrder:gt,dilations:bt})},pl=(it,_,lt,ft)=>{let[mt,pt]=dl(it,ft,lt),gt=`
      value = max(_X(x), value);
    `,bt="",wt=`
      ${ml(it[0].dims,mt,gt,bt,"-1e5")}
    `;return{..._,output:{dims:pt,type:it[0].type,textureType:0},shaderSource:wt}},dl=(it,_,lt)=>{let ft=it[0].dims.slice(),mt=Object.hasOwnProperty.call(_,"dilations"),pt=_.kernelShape.slice(),gt=_.strides.slice(),bt=mt?_.dilations.slice():[],wt=_.pads.slice();he.adjustPoolAttributes(lt,ft,pt,gt,bt,wt);let vt=he.computePoolOutputShape(lt,ft,gt,bt,pt,wt,_.autoPad),Ct=Object.assign({},_);return mt?Object.assign(Ct,{kernelShape:pt,strides:gt,pads:wt,dilations:bt,cacheKey:_.cacheKey}):Object.assign(Ct,{kernelShape:pt,strides:gt,pads:wt,cacheKey:_.cacheKey}),[Ct,vt]},mh={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[],cacheKey:""},ol={name:"GlobalMaxPool",inputNames:["X"],inputTypes:[0]},hl=(it,_)=>(Jr(_),[it.run({...ol,get:()=>pl(_,ol,!0,mh)},_)]),Jr=it=>{if(!it||it.length!==1)throw new Error("Pool ops requires 1 input.");if(it[0].type!=="float32"&&it[0].type!=="float64")throw new Error("Invalid input type.")},ml=(it,_,lt,ft,mt)=>{let pt=it.length;if(_.kernelShape.length<=2){let gt=_.kernelShape[_.kernelShape.length-1],bt=_.strides[_.strides.length-1],wt=_.pads[_.pads.length/2-1],vt=_.pads[_.pads.length-1],Ct=it[pt-1],Rt="",Mt="",Ot="";if(wt+vt!==0?Rt=`
          for (int i = 0; i < ${gt}; i++) {
            x[${pt} - 1] = indices[${pt} - 1] * ${bt} - ${wt} + i;
            if (x[${pt} - 1] < 0 || x[${pt} - 1] >= ${Ct}) {
              pad++;
              continue;
            }
            ${lt}
          }`:Rt=`
          for (int i = 0; i < ${gt}; i++) {
            x[${pt} - 1] = indices[${pt} - 1] * ${bt} - ${wt} + i;
            ${lt}
          }`,_.kernelShape.length===2){let Nt=_.kernelShape[_.kernelShape.length-2],Ht=_.strides[_.strides.length-2],Kt=_.pads[_.pads.length/2-2],hr=_.pads[_.pads.length-2],Qt=it[pt-2];Kt+hr!==0?Mt=`
            for (int j = 0; j < ${Nt}; j++) {
              x[${pt} - 2] = indices[${pt} - 2] * ${Ht} - ${Kt} + j;
              if (x[${pt} - 2] < 0 || x[${pt} - 2] >= ${Qt}) {
                pad+= ${gt};
                continue;
              }
          `:Mt=`
            for (int j = 0; j < ${Nt}; j++) {
              x[${pt} - 2] = indices[${pt} - 2] * ${Ht} - ${Kt} + j;
            `,Ot=`
          }
        `}return`
        float process(int indices[${pt}]) {
          int x[${pt}];
          copyVec(indices, x);

          float value = ${mt};
          int pad = 0;
          ${Mt}
          ${Rt}
          ${Ot}
          ${ft}
          return value;
        }
      `}else{let gt=A.size(_.kernelShape),bt=A.computeStrides(_.kernelShape),wt=bt.length,vt=_.pads.length,Ct=bh(wt),Rt=Kr(it,"inputDims"),Mt=Kr(_.pads,"pads"),Ot=Kr(bt,"kernelStrides"),Nt=Kr(_.strides,"strides"),Ht=_.pads.reduce((hr,Qt)=>hr+Qt),Kt="";return Ht?Kt=`
            if (x[j] >= inputDims[j] || x[j] < 0) {
              pad++;
              isPad = true;
              break;
            }
          }
          if (!isPad) {
            ${lt}
          }`:Kt=`
          }
          ${lt}
        `,`
        ${Ct}
        float process(int indices[${pt}]) {
          int x[${pt}];
          copyVec(indices, x);
          int offset[${wt}];
          int pads[${vt}];
          int inputDims[${pt}];
          int kernelStrides[${wt}];
          int strides[${wt}];
          ${Mt}
          ${Rt}
          ${Nt}
          ${Ot}

          float value = ${mt};
          int pad = 0;
          bool isPad = false;
          for (int i = 0; i < ${gt}; i++) {
            offsetToIndices(i, kernelStrides, offset);
            isPad = false;
            for (int j = ${pt} - ${wt}; j < ${pt}; j++) {
              x[j] = indices[j] * strides[j - ${pt} + ${wt}]
                + offset[j - ${pt} + ${wt}] - pads[j - 2];
              ${Kt}
          }
          ${ft}

          return value;
        }
      `}},Kr=(it,_)=>{let lt="";for(let ft=0;ft<it.length;ft++)lt+=`
      ${_}[${ft}] = ${it[ft]};
    `;return lt},bh=it=>`
  void offsetToIndices(int offset, int[${it}] strides, out int[${it}] indices) {
    if (${it} == 0) {
      return;
    }
    for (int i = 0; i < ${it} - 1; ++i) {
      indices[i] = offset / strides[i];
      offset -= indices[i] * strides[i];
    }
    indices[${it} - 1] = offset;
  }`}),we,ne,yh,gh,yl,gl,xl,Tl,wl,vl,Il,_l=x(()=>{at(),nr(),U(),R(),we=(it,_,lt,ft,mt)=>{gh(_);let pt={name:ft,inputNames:["A"],inputTypes:[0]};return[it.run({...pt,cacheHint:lt.cacheKey,get:()=>yh(it,_,lt,ft,mt,pt)},_)]},ne=it=>{let _=it.attributes.getInts("axes",[]),lt=it.attributes.getInt("keepdims",1)===1;return F({axes:_,keepDims:lt})},yh=(it,_,lt,ft,mt,pt)=>{let gt=[],bt=_[0].dims.length||1,wt=[],vt=A.normalizeAxes(lt.axes,_[0].dims.length),Ct=mt(_,vt),Rt=Ct[1];for(let Ot=0;Ot<_[0].dims.length;Ot++)vt.indexOf(Ot)>=0||vt.length===0?(lt.keepDims&&gt.push(1),Rt=`
          for(int j${Ot} = 0; j${Ot} < ${_[0].dims[Ot]}; j${Ot}++) {
            inputIdx[${Ot}] = j${Ot};
            ${Rt}
          }`):(wt.push(`inputIdx[${Ot}] = outputIdx[${gt.length}];`),gt.push(_[0].dims[Ot]));let Mt=`
      float process(int outputIdx[${gt.length||1}]) {
        float value;                 // final result
        int inputIdx[${bt}];      // addressing input data
        ${wt.join(`
`)}
        ${Ct[0]}       // init ops for reduce max/min
        ${Rt}
        ${Ct[2]}       // final computation for reduce mean
        return value;
      }`;return{...pt,output:{dims:gt,type:_[0].type,textureType:0},shaderSource:Mt}},gh=it=>{if(!it||it.length!==1)throw new Error("Reduce op requires 1 input.");if(re.indexOf(it[0].type)===-1)throw new Error("Invalid input type.")},yl=(it,_,lt)=>we(it,_,lt,"ReduceSum",()=>["value = 0.0;","value += _A(inputIdx);",""]),gl=(it,_,lt)=>we(it,_,lt,"ReduceMean",(ft,mt)=>{let pt=1;for(let gt=0;gt<ft[0].dims.length;gt++)(mt.indexOf(gt)>=0||mt.length===0)&&(pt*=ft[0].dims[gt]);return["value = 0.0;","value += _A(inputIdx);",`value /= ${pt}.;`]}),xl=(it,_,lt)=>we(it,_,lt,"ReduceMax",(ft,mt)=>{let pt=[];for(let gt=0;gt<ft[0].dims.length;gt++)(mt.indexOf(gt)>=0||mt.length===0)&&pt.push(`inputIdx[${gt}] = 0;`);return[`${pt.join(`
`)}
value = _A(inputIdx);`,"value = max(value, _A(inputIdx));",""]}),Tl=(it,_,lt)=>we(it,_,lt,"ReduceMin",(ft,mt)=>{let pt=[];for(let gt=0;gt<ft[0].dims.length;gt++)(mt.indexOf(gt)>=0||mt.length===0)&&pt.push(`inputIdx[${gt}] = 0;`);return[`${pt.join(`
`)}
value = _A(inputIdx);`,"value = min(value, _A(inputIdx));",""]}),wl=(it,_,lt)=>we(it,_,lt,"ReduceProd",()=>["value = 1.0;","value *= _A(inputIdx);",""]),vl=(it,_,lt)=>we(it,_,lt,"ReduceLogSum",()=>["value = 0.0;","value += _A(inputIdx);","value = log(value);"]),Il=(it,_,lt)=>we(it,_,lt,"ReduceLogSumSquare",()=>["float t; value = 0.0;","t = _A(inputIdx); value += t * t;",""])}),Sl,Ol=x(()=>{U(),Sl=(it,_)=>{let lt=A.calculateReshapedDims(_[0].dims,_[1].integerData);return it.session.pack?[it.reshapePacked(_[0],lt)]:[it.reshapeUnpacked(_[0],lt)]}}),Al,Eo,Pl,El,or,xh,Do,Zr,Lo=x(()=>{at(),X(),R(),Al={name:"Upsample",inputNames:["X"],inputTypes:[0]},Eo=(it,_,lt)=>(Do(_,lt),[it.run({...Al,cacheHint:lt.cacheKey,get:()=>xh(it,_,lt)},_)]),Pl=it=>or(it,7),El=it=>or(it,9),or=(it,_)=>{let lt=_>=10,ft=it.attributes.getString("mode","nearest");if(ft!=="nearest"&&ft!=="linear"&&(_<11||ft!=="cubic"))throw new Error(`unrecognized mode: ${ft}`);let mt=[];_<9&&(mt=it.attributes.getFloats("scales"),Zr(mt,ft,lt));let pt=it.attributes.getFloat("extrapolation_value",0),gt=_>10?it.attributes.getString("coordinate_transformation_mode","half_pixel"):"asymmetric";if(["asymmetric","pytorch_half_pixel","tf_half_pixel_for_nn","align_corners","tf_crop_and_resize","half_pixel"].indexOf(gt)===-1)throw new Error(`coordinate_transform_mode '${gt}' is not supported`);let bt=gt==="tf_crop_and_resize",wt=bt,vt=ft==="nearest"&&_>=11?it.attributes.getString("nearest_mode","round_prefer_floor"):"";if(["round_prefer_floor","round_prefer_ceil","floor","ceil",""].indexOf(vt)===-1)throw new Error(`nearest_mode '${vt}' is not supported`);let Ct=it.attributes.getFloat("cubic_coeff_a",-.75),Rt=it.attributes.getInt("exclude_outside",0)!==0;if(Rt&&ft!=="cubic")throw new Error("exclude_outside can be set to 1 only when mode is CUBIC.");let Mt=_<11?!0:ft==="nearest"&&gt==="asymmetric"&&vt==="floor",Ot=0,Nt=0,Ht=0;return _>10?it.inputs.length>2?(Ot=1,Nt=2,Ht=3):(Nt=1,Ht=2):_===9&&(Nt=1),F({opset:_,isResize:lt,mode:ft,scales:mt,extrapolationValue:pt,coordinateTransformMode:gt,useExtrapolation:wt,needRoiInput:bt,nearestMode:vt,cubicCoefficientA:Ct,excludeOutside:Rt,useNearest2xOptimization:Mt,roiInputIdx:Ot,scalesInputIdx:Nt,sizesInputIdx:Ht})},xh=(it,_,lt)=>{let ft=D(it.session.backend.glContext.version),[mt,pt]=it.calculateTextureWidthAndHeight(_[0].dims,0),gt=_[0].dims.map((Ht,Kt)=>Math.floor(Ht*lt.scales[Kt])),[bt,wt]=it.calculateTextureWidthAndHeight(gt,0),vt=gt.length,Ct=new Array(vt),Rt=new Array(vt),Mt=`
      int output_pitches[${vt}];
      int input_pitches[${vt}];
      `;for(let Ht=vt-1;Ht>=0;Ht--)Ct[Ht]=Ht===vt-1?1:Ct[Ht+1]*gt[Ht+1],Rt[Ht]=Ht===vt-1?1:Rt[Ht+1]*_[0].dims[Ht+1],Mt+=`
        output_pitches[${Ht}] = ${Ct[Ht]};
        input_pitches[${Ht}] = ${Rt[Ht]};
        `;let Ot=`
      float getInputFloat(int index) {
        vec2 coords = offsetToCoords(index, ${mt}, ${pt});
        float value = getColorAsFloat(${ft.texture2D}(X, coords));
        return value;
      }
      `,Nt=lt.mode==="nearest"?`
    ${Ot}
    float process(int indices[${vt}]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${bt}, ${wt});

      ${Mt}

      int d, m;
      for (int dim = 0; dim < ${vt}; ++dim) {
        d = output_index / output_pitches[dim];
        m = output_index - d * output_pitches[dim];
        output_index = m;

        if (scales[dim] != 1 && d > 0) {
          int d2 = d / scales[dim];
          m = d - d2 * scales[dim];
          d = d2;
        }
        input_index += input_pitches[dim] * d;
      }

      return getInputFloat(input_index);
    }`:vt===4?`
    ${Ot}
    float process(int indices[4]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${bt}, ${wt});

      ${Mt}

      int m;
      int index_of_dim0, index_of_dim1, index_of_dim2, index_of_dim3;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m / output_pitches[1];
      m = m - index_of_dim1 * output_pitches[1];
      index_of_dim2 = m / output_pitches[2];
      m = m - index_of_dim2 * output_pitches[2];
      index_of_dim3 = m;

      int index_of_input_dim2, index_of_input_dim3, x_offset, y_offset;
      index_of_input_dim2 = index_of_dim2 / scales[2];
      y_offset = index_of_dim2 - index_of_input_dim2 * scales[2];
      index_of_input_dim3 = index_of_dim3 / scales[3];
      x_offset = index_of_dim3 - index_of_input_dim3 * scales[3];

      input_index = index_of_dim0 * input_pitches[0] +
            index_of_dim1 * input_pitches[1] +
            index_of_input_dim2 * input_pitches[2] +
            index_of_input_dim3;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim2 = false;
      if (index_of_input_dim2 == (${_[0].dims[2]} - 1)) {
        // It's the end in dimension 2
        x01 = x00;
        end_of_dim2 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[2]);
      }

      if (index_of_input_dim3 == (input_pitches[2] - 1)) {
        // It's the end in dimension 3
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim2 ? x10 : getInputFloat(input_index + input_pitches[2] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[2]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[2]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[3]);
    }`:`
    ${Ot}
    float process(int indices[2]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${bt}, ${wt});

      ${Mt}

      int m;
      int index_of_dim0, index_of_dim1;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m;

      int index_of_input_dim0, index_of_input_dim1, x_offset, y_offset;
      index_of_input_dim0 = index_of_dim0 / scales[0];
      y_offset = index_of_dim0 - index_of_input_dim0 * scales[0];
      index_of_input_dim1 = index_of_dim1 / scales[1];
      x_offset = index_of_dim1 - index_of_input_dim1 * scales[1];

      input_index = index_of_input_dim0 * input_pitches[0] + index_of_input_dim1;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim0 = false;
      if (index_of_input_dim0 == (${_[0].dims[0]} - 1)) {
        // It's the end in dimension 0
        x01 = x00;
        end_of_dim0 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[0]);
      }

      if (index_of_input_dim1 == (input_pitches[0] - 1)) {
        // It's the end in dimension 1
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim0 ? x10 : getInputFloat(input_index + input_pitches[0] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[0]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[0]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[1]);
    }`;return{...Al,output:{dims:gt,type:_[0].type,textureType:0},shaderSource:Nt,variables:[{name:"scales",type:"int",arrayLength:lt.scales.length,data:lt.scales.map(Ht=>Math.ceil(Ht))}]}},Do=(it,_)=>{if(!it||_.opset<9&&it.length!==1||_.opset>=9&&_.opset<11&&it.length!==2||_.opset>=11&&it.length<2)throw new Error("invalid inputs.");if(_.scales.length>0&&it[0].dims.length!==_.scales.length)throw new Error("Invalid input shape.");if(it[0].type==="string")throw new Error("Invalid input tensor types.")},Zr=(it,_,lt)=>{if(lt){for(let ft of it)if(ft<=0)throw new Error("Scale value should be greater than 0.")}else for(let ft of it)if(ft<1)throw new Error("Scale value should be greater than or equal to 1.");if((_==="linear"||_==="cubic")&&it.length!==2&&(it.length!==4||it[0]!==1||it[1]!==1))throw new Error(`'Linear' mode and 'Cubic' mode only support 2-D inputs ('Bilinear', 'Bicubic')         or 4-D inputs with the corresponding outermost 2 scale values being 1         in the ${lt?"Resize":"Upsample"} opeartor.`)}}),$o,ko,Dl,Ll,Th,wh,vh,Ih,$l=x(()=>{X(),R(),Vt(),ge(),Lo(),$o={name:"Resize",inputNames:["A"],inputTypes:[2]},ko=(it,_,lt)=>(Do(_,lt),[it.run({...$o,cacheHint:lt.cacheKey,get:()=>Th(it,_,lt)},_)]),Dl=it=>or(it,10),Ll=it=>or(it,11),Th=(it,_,lt)=>{let ft=D(it.session.backend.glContext.version),[mt,pt]=wh(_,lt);if(mt.every(Qt=>Qt===1)&&lt.coordinateTransformMode!=="tf_crop_and_resize")return{...$o,output:{dims:pt,type:_[0].type,textureType:2},hasMain:!0,shaderSource:`void main() {
                    vec4 v = ${ft.texture2D}(X, TexCoords);
                    ${ft.output} = v;
                }`};let gt=pt.length;if(gt<2)throw new Error(`output dimension should be at least 2, but got ${gt}`);let bt=pt[gt-2],wt=pt[gt-1],vt=_[0].dims;if(gt!==vt.length)throw new Error(`output dimension should match input ${vt.length}, but got ${gt}`);let Ct=vt[gt-2],Rt=vt[gt-1],Mt=mt[gt-2],Ot=mt[gt-1],Nt="";if(lt.mode!=="linear")throw new Error(`resize (packed) does not support mode: '${lt.mode}'`);switch(lt.coordinateTransformMode){case"asymmetric":Nt=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return vec4(coords) / scaleWHWH;
                    }
                `;break;case"half_pixel":Nt=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return (vec4(coords) + 0.5) / scaleWHWH - 0.5;
                    }
                `;break;case"pytorch_half_pixel":Nt=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 fcoords = vec4(coords);
                        return vec4(
                            ${wt}.0 > 1.0 ? (fcoords.x + 0.5) / scaleWHWH.x - 0.5 : 0.0,
                            ${bt}.0 > 1.0 ? (fcoords.y + 0.5) / scaleWHWH.y - 0.5 : 0.0,
                            ${wt}.0 > 1.0 ? (fcoords.z + 0.5) / scaleWHWH.z - 0.5 : 0.0,
                            ${bt}.0 > 1.0 ? (fcoords.w + 0.5) / scaleWHWH.w - 0.5 : 0.0
                          );
                    }
                `;break;case"align_corners":Nt=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 resized = vec4(${wt}.0 - 1.0, ${bt}.0 - 1.0, ${wt}.0 - 1.0,
                            ${bt}.0 - 1.0);
                        vec4 original = vec4(${Rt}.0 - 1.0, ${Ct}.0 - 1.0, ${Rt}.0 - 1.0,
                            ${Ct}.0 - 1.0);
                        vec4 new_scale = original / resized;
                        return vec4(coords) * new_scale;
                    }
                `;break;default:throw new Error(`resize (packed) does not support coordinateTransformMode:                                 '${lt.coordinateTransformMode}'`)}let Ht=ht(gt),Kt=Ut(),hr=`
            const vec2 inputWH = vec2(${Ct}.0, ${Rt}.0);
            const vec4 scaleWHWH = vec4(float(${Mt}), float(${Ot}), float(${Mt}), float(${Ot}));
            ${Kt}
            ${Nt}
            float getAValue(int x10, int r, int c, int d) {
                return getChannel(getA(x10, r, c, d), vec2(c, d));
            }
            void main() {
                ${Ht} rc = getOutputCoords();

                int batch = rc[0];
                int depth = rc[1];

                // retrieve the 4 coordinates that is used in the 4 packed output values.
                ivec4 coords = ivec4(rc.wz, rc.w + 1, rc.z + 1);

                // calculate the source index in fraction
                vec4 sourceFrac = getSourceFracIndex(coords);

                // get the lower and upper bound of the 4 values that will be packed into one texel.
                ivec4 x00 = ivec4(max(sourceFrac.xy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xy)));
                ivec4 x01 = ivec4(max(sourceFrac.xw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xw)));
                ivec4 x10 = ivec4(max(sourceFrac.zy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zy)));
                ivec4 x11 = ivec4(max(sourceFrac.zw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zw)));

                bool hasNextRow = rc.w < ${bt-1};
                bool hasNextCol = rc.z < ${wt-1};

                // pack x00, x01, x10, x11's top-left corner into one vec4 structure
                vec4 topLeft = vec4(
                    getAValue(batch, depth, x00.x, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.y) : 0.0);

                // pack x00, x01, x10, x11's top-right corner into one vec4 structure
                vec4 topRight = vec4(
                    getAValue(batch, depth, x00.x, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.w) : 0.0);

                // pack x00, x01, x10, x11's bottom-left corner into one vec4 structure
                vec4 bottomLeft = vec4(
                    getAValue(batch, depth, x00.z, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.y) : 0.0);

                // pack x00, x01, x10, x11's bottom-right corner into one vec4 structure
                vec4 bottomRight = vec4(
                    getAValue(batch, depth, x00.z, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.w) : 0.0);

                // calculate the interpolation fraction on u and v direction
                vec4 frac = vec4(sourceFrac) - floor(sourceFrac);
                vec4 clampFrac = clamp(frac, vec4(0.0), vec4(1.0));

                vec4 top = mix(topLeft, topRight, clampFrac.ywyw);
                vec4 bottom = mix(bottomLeft, bottomRight, clampFrac.ywyw);
                vec4 newValue = mix(top, bottom, clampFrac.xxzz);

                ${ft.output} = vec4(newValue);
            }
        `;return{...$o,output:{dims:pt,type:_[0].type,textureType:2},hasMain:!0,shaderSource:hr}},wh=(it,_)=>{let lt=it[0].dims,ft=_.scales,mt;if(ft.length===0){let gt=it[_.scalesInputIdx];if(gt&&gt.size!==0){if(it[_.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");ft=vh(gt,_.mode,_.isResize)}else{let bt=it[_.sizesInputIdx];if(!bt||bt.size===0)throw new Error("Either scales or sizes MUST be provided as input.");mt=Array.from(bt.integerData),ft=Ih(mt,lt,_.mode,_.isResize)}}else if(it[_.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");let pt=mt||lt.map((gt,bt)=>Math.floor(gt*ft[bt]));return[ft,pt]},vh=(it,_,lt)=>{let ft=Array.from(it.floatData);return Zr(ft,_,lt),ft},Ih=(it,_,lt,ft)=>{let mt=_.length,pt=new Array(mt);for(let gt=0,bt=mt;gt<bt;gt++)if(_[gt]===0){if(it[gt]!==0)throw new Error("Input dim is zero but required output dim is non-zero.");pt[gt]=1}else pt[gt]=it[gt]/_[gt];return Zr(pt,lt,ft),pt}}),kl,_h,Bl=x(()=>{ye(),kl=(it,_)=>(_h(_),[new rt([_[0].dims.length],"int32",void 0,void 0,new Int32Array(_[0].dims))]),_h=it=>{if(!it||it.length!==1)throw new Error("Shape requires 1 input.")}}),Bo,Fl,Nl,Cl,Sh,Rl,Oh,Ah,Gl=x(()=>{at(),nr(),U(),R(),Bo={name:"Slice",inputNames:["A"],inputTypes:[0]},Fl=(it,_,lt)=>(Sh(_),[it.run({...Bo,cacheHint:lt.cacheKey,get:()=>Cl(it,_[0],lt)},_)]),Nl=it=>{let _=it.attributes.getInts("starts"),lt=it.attributes.getInts("ends"),ft=it.attributes.getInts("axes",[]);return F({starts:_,ends:lt,axes:ft})},Cl=(it,_,lt)=>{let ft=lt.axes.length===0?_.dims.slice(0).map((Ct,Rt)=>Rt):lt.axes,mt=A.normalizeAxes(ft,_.dims.length),pt=lt.starts.map((Ct,Rt)=>Ct>_.dims[mt[Rt]]-1?_.dims[mt[Rt]]:A.normalizeAxis(Ct,_.dims[mt[Rt]])),gt=lt.ends.map((Ct,Rt)=>Ct>_.dims[mt[Rt]]-1?_.dims[mt[Rt]]:A.normalizeAxis(Ct,_.dims[mt[Rt]])),bt=_.dims.slice(),wt=[];for(let Ct=0;Ct<mt.length;Ct++)bt[mt[Ct]]=gt[Ct]-pt[Ct],pt[Ct]>0&&wt.push(`outputIdx[${mt[Ct]}] += ${pt[Ct]};`);let vt=`
      float process(int outputIdx[${bt.length}]) {
        ${wt.join(`
      `)}
        return _A(outputIdx);
      }`;return{...Bo,output:{dims:bt,type:_.type,textureType:0},shaderSource:vt}},Sh=it=>{if(!it||it.length!==1)throw new Error("Slice requires 1 input.");if(re.indexOf(it[0].type)===-1)throw new Error("Invalid input type.")},Rl=(it,_)=>{Ah(_);let lt=Oh(it,_);return[it.run({...Bo,cacheHint:lt.cacheKey,get:()=>Cl(it,_[0],lt)},[_[0]])]},Oh=(it,_)=>{if(!it.session.isInitializer(_[1].dataId)||!it.session.isInitializer(_[2].dataId)||_.length>=4&&!it.session.isInitializer(_[3].dataId)||_.length>=5&&!it.session.isInitializer(_[4].dataId))throw new Error("dynamic slice attributes are not allowed");if(_.length>=5&&_[4].integerData.some(gt=>gt!==1))throw new Error("currently non-1 steps is not supported for Slice");let lt=Array.from(_[1].integerData),ft=Array.from(_[2].integerData),mt=_.length>=4?Array.from(_[3].integerData):[],pt=`${mt};${lt};${ft}`;return{starts:lt,ends:ft,axes:mt,cacheKey:pt}},Ah=it=>{if(!it||it.length<3||it.length>5)throw new Error("Invalid input number.");if(it[1].type!=="int32"||it[1].dims.length!==1)throw new Error("Invalid input type.");if(it[2].type!=="int32"||it[2].dims.length!==1)throw new Error("Invalid input type.");if(it.length>=4&&(it[3].type!=="int32"||it[3].dims.length!==1))throw new Error("Invalid input type.");if(it.length>=5&&(it[4].type!=="int32"||it[4].dims.length!==1))throw new Error("Invalid input type.")}}),Ml,Vl,Ul,zl,Wl,Hl,ql,jl,Ph,Eh,Dh,Xl,Kl=x(()=>{at(),U(),X(),R(),Xr(),Ml={name:"SoftmaxComputeMax",inputNames:["A"],inputTypes:[0]},Vl={name:"SoftmaxComputeScale",inputNames:["A","Max"],inputTypes:[0,0]},Ul={name:"SoftMax",inputNames:["A","Max","Norm"],inputTypes:[0,0,0]},zl=(it,_,lt)=>{Xl(_);let ft=_[0].dims.slice(),mt=A.normalizeAxis(lt.axis,ft.length),pt=A.sizeToDimension(ft,mt),gt=A.sizeFromDimension(ft,mt);return jl(it,_,lt,pt,gt)},Wl=it=>F({axis:it.attributes.getInt("axis",1)}),Hl=it=>F({axis:it.attributes.getInt("axis",-1)}),ql=(it,_,lt)=>{Xl(_);let ft=_[0].dims.slice(),mt=A.normalizeAxis(lt.axis,ft.length),pt=ft.length,gt=mt!==pt-1,bt=[],wt=[],vt=[],Ct;gt&&(wt=Array.from({length:pt}).map((Nt,Ht)=>Ht),wt[mt]=pt-1,wt[pt-1]=mt,wt.map(Nt=>bt.push(ft[Nt])),Ct=F({perm:wt}),vt=Te(it,_,Ct));let Rt=gt?A.sizeToDimension(bt,pt-1):A.sizeToDimension(ft,pt-1),Mt=gt?A.sizeFromDimension(bt,pt-1):A.sizeFromDimension(ft,pt-1),Ot=jl(it,gt?vt:_,lt,Rt,Mt);return gt?Te(it,Ot,Ct):Ot},jl=(it,_,lt,ft,mt)=>{let pt=Ph(it,_[0],ft,mt,[ft]),gt=it.run({...Ml,cacheHint:lt.cacheKey,get:()=>pt},_),bt=Eh(it,_[0],ft,mt,pt.output.dims,[ft]),wt=it.run({...Vl,cacheHint:lt.cacheKey,get:()=>bt},[_[0],gt]),vt=Dh(it,_[0],ft,mt,pt.output.dims,bt.output.dims);return[it.run({...Ul,cacheHint:lt.cacheKey,get:()=>vt},[_[0],gt,wt])]},Ph=(it,_,lt,ft,mt)=>{let[pt,gt]=it.calculateTextureWidthAndHeight(_.dims,0),bt=mt.length;if(lt<1||ft<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(mt.length!==1)throw new Error("Dimensionality of the output should be 1");if(mt[0]!==lt)throw new Error("Shape of the output should be equal to logical row count");let wt=D(it.session.backend.glContext.version),vt=`
      float process(int[${bt}] indices) {
        int logical_row_start_offset = indices[0] * ${ft};

        float max = getColorAsFloat(${wt.texture2D}(A, offsetToCoords(logical_row_start_offset, ${pt},
        ${gt} )));
        for(int i=1; i<${ft}; ++i)
        {
          float current = getColorAsFloat(${wt.texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${pt}, ${gt})));
          if(current > max)
          max = current;
        }

        return max;
      }`;return{...Ml,output:{dims:mt,type:_.type,textureType:0},shaderSource:vt}},Eh=(it,_,lt,ft,mt,pt)=>{let[gt,bt]=it.calculateTextureWidthAndHeight(_.dims,0),wt=pt.length;if(lt<1||ft<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(pt.length!==1)throw new Error("Dimensionality of the output should be 1");if(pt[0]!==lt)throw new Error("Shape of the output should be equal to logical row count");if(mt.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(mt[0]!==lt)throw new Error("Shape of the intermediate results should be equal to logical row count");let vt=D(it.session.backend.glContext.version),Ct=`
      float process(int[${wt}] indices) {
        int logical_row_start_offset = indices[0] * ${ft};

        float norm_factor = 0.0;
        float max = _Max(indices);
        for(int i=0; i<${ft}; ++i)
        {
          norm_factor += exp(getColorAsFloat(${vt.texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${gt}, ${bt}))) - max);
        }

        return norm_factor;
      }`;return{...Vl,output:{dims:pt,type:_.type,textureType:0},shaderSource:Ct}},Dh=(it,_,lt,ft,mt,pt)=>{let[gt,bt]=it.calculateTextureWidthAndHeight(_.dims,0),wt=_.dims.length;if(lt<1||ft<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(mt.length!==1||pt.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(mt[0]!==lt||pt[0]!==lt)throw new Error("Shape of the intermediate results should be equal to logical row count");let vt=`
      float process(int[${wt}] indices) {

      // get offset of current logical tensor index from the 2-D texture coordinates (TexCoords)
      int offset = coordsToOffset(TexCoords, ${gt}, ${bt});

      //determine the logical row for this index
      int logical_row_index[1];
      logical_row_index[0] = offset / ${ft};

      float norm_factor = _Norm(logical_row_index);

      // avoid possible division by 0
      // if norm_facor is 0, all elements are zero
      // if so, return 0
      if(norm_factor == 0.0)
        return 0.0;

      return exp(_A(indices) - _Max(logical_row_index)) / norm_factor;
    }`;return{...Ul,output:{dims:_.dims,type:_.type,textureType:0},shaderSource:vt}},Xl=it=>{if(!it||it.length!==1)throw new Error("Softmax requires 1 input.");if(it[0].type!=="float32"&&it[0].type!=="float64")throw new Error("Invalid input type")}}),Jl,Zl,Yl,Lh,$h,kh,Ql=x(()=>{at(),U(),R(),Jl={name:"Split",inputNames:["A"],inputTypes:[0]},Zl=(it,_,lt)=>{kh(_);let ft=A.normalizeAxis(lt.axis,_[0].dims.length),mt=Lh(it,_,ft,lt),pt=[];for(let gt=0;gt<mt;++gt)pt.push(it.run({...Jl,cacheHint:`${lt.cacheKey};${gt}`,get:()=>$h(it,_[0],lt,ft,gt)},_));return pt},Yl=it=>{let _=it.attributes.getInt("axis",0),lt=it.attributes.getInts("split",[]),ft=it.outputs.length;return F({axis:_,split:lt,numOutputs:ft})},Lh=(it,_,lt,ft)=>{let[,mt]=Ze.splitShape(_[0].dims,lt,ft.split,ft.numOutputs);return mt.length},$h=(it,_,lt,ft,mt)=>{let[pt,gt]=Ze.splitShape(_.dims,ft,lt.split,lt.numOutputs),bt=gt[mt],wt=pt[mt],vt=`
      float process(int indices[${wt.length}]) {
        indices[${ft}] += ${bt};
        return _A(indices);
      }
    `;return{...Jl,cacheHint:`${lt.cacheKey}:${mt}`,output:{dims:wt,type:_.type,textureType:0},shaderSource:vt}},kh=it=>{if(!it||it.length!==1)throw new Error("Split requires one input.");if(it[0].type!=="int8"&&it[0].type!=="uint8"&&it[0].type!=="int16"&&it[0].type!=="uint16"&&it[0].type!=="int32"&&it[0].type!=="uint32"&&it[0].type!=="float32"&&it[0].type!=="float64"&&it[0].type!=="bool")throw new Error("Invalid input type.")}}),Fo,tf,ef,Bh,Fh,rf=x(()=>{U(),Fo=(it,_,lt)=>{Bh(_);let ft=A.squeezeShape(_[0].dims,lt);return[it.reshapeUnpacked(_[0],ft)]},tf=(it,_)=>(Fh(_),Fo(it,[_[0]],Array.from(_[1].integerData))),ef=it=>it.attributes.getInts("axes"),Bh=it=>{if(!it||it.length!==1)throw new Error("Squeeze requires 1 input.");if(it[0].type==="string")throw new Error("invalid input tensor types.")},Fh=it=>{if(!it||it.length!==2)throw new Error("Squeeze requires 2 inputs.");if(it[1].type!=="int32")throw new Error("Invalid input type.")}}),nf,Nh,Ch,of=x(()=>{X(),R(),nf=(it,_)=>{Ch(_);let lt={name:"Sum",inputNames:_.map((ft,mt)=>`X${mt}`),inputTypes:new Array(_.length).fill(0)};return[it.run({...lt,get:()=>Nh(it,_,lt)},_)]},Nh=(it,_,lt)=>{let ft=D(it.session.backend.glContext.version),mt=_[0].dims.slice(),pt=`
      void main() {
        vec4 result = ${_.map((gt,bt)=>`${ft.texture2D}(X${bt},TexCoords)`).join(" + ")};
        ${ft.output} = result;
      }
    `;return{...lt,output:{dims:mt,type:_[0].type,textureType:0},hasMain:!0,shaderSource:pt}},Ch=it=>{if(!it||it.length===0)throw new Error("Sum requires inputs.");let _=it[0].dims.length;for(let lt=1;lt<it.length;lt++){if(_!==it[lt].dims.length)throw new Error("Input shapes are mismatched.");for(let ft=0;ft<_;ft++)if(it[0].dims[ft]!==it[lt].dims[ft])throw new Error("Input shapes are not matched.")}if(it[0].type!=="float32"&&it[0].type!=="float64")throw new Error("Invalid input type.");for(let lt=1;lt<it.length;lt++)if(it[0].type!==it[lt].type)throw new Error("Input types are not matched.")}}),af,Rh,Gh,sf=x(()=>{nr(),R(),af=(it,_)=>{Gh(_);let lt={name:"Tile",inputNames:["A"],inputTypes:[0]};return[it.run({...lt,get:()=>Rh(it,_,lt)},_)]},Rh=(it,_,lt)=>{let ft=_[0].dims.slice(),mt=new Array(ft.length),pt=[];for(let wt=0;wt<ft.length;wt++)mt[wt]=ft[wt]*_[1].numberData[wt],pt.push(`inputIdx[${wt}] = int(mod(float(outputIdx[${wt}]), ${ft[wt]}.));`);let gt=mt.length,bt=`
      float process(int outputIdx[${gt}]) {
        int inputIdx[${gt}];
        ${pt.join(`
`)}
        return _A(inputIdx);
      }
    `;return{...lt,output:{dims:mt,type:_[0].type,textureType:0},shaderSource:bt}},Gh=it=>{if(!it||it.length!==2)throw new Error("Tile requires 2 input.");if(it[1].dims.length!==1)throw new Error("The second input shape must 1 dimension.");if(it[1].dims[0]!==it[0].dims.length)throw new Error("Invalid input shape.");if(re.indexOf(it[0].type)===-1)throw new Error("Invalid input type.");if(it[1].type!=="int32"&&it[1].type!=="int16")throw new Error("Invalid repeat type.")}}),No,uf,lf,Mh,Vh,ff=x(()=>{U(),No=(it,_,lt)=>{Mh(_);let ft=A.unsqueezeShape(_[0].dims,lt);return[it.reshapeUnpacked(_[0],ft)]},uf=(it,_)=>(Vh(_),No(it,[_[0]],Array.from(_[1].integerData))),lf=it=>it.attributes.getInts("axes"),Mh=it=>{if(!it||it.length!==1)throw new Error("Unsqueeze requires 1 input.");if(it[0].type==="string")throw new Error("invalid input tensor types.")},Vh=it=>{if(!it||it.length!==2)throw new Error("Unsqueeze requires 2 inputs.");if(it[1].type!=="int32")throw new Error("Invalid input type.")}}),cf,pf=x(()=>{ws(),Bs(),Cs(),zs(),Hr(),Ou(),$u(),Fu(),Ru(),Uu(),Hu(),Ku(),Qu(),qr(),nl(),bl(),_l(),Ol(),$l(),Bl(),Gl(),Kl(),Ql(),rf(),of(),sf(),Xr(),xo(),ff(),Lo(),cf=[["Abs","","6+",Ws],["Acos","","7+",Hs],["Add","","7+",vs],["And","","7+",Is],["Asin","","7+",qs],["Atan","","7+",js],["AveragePool","","7+",il,al],["BatchNormalization","","7+",xs,Ts],["Cast","","6+",Fs,Ns],["Ceil","","6+",Js],["Clip","","6-10",yo,Xs],["Clip","","11+",Ks],["Concat","","4+",Ms,Us],["Conv","","1+",So,Oo],["ConvTranspose","","1+",_u,Su],["Cos","","7+",Zs],["Div","","7+",_s],["Dropout","","7+",go],["DepthToSpace","","1+",Du,Lu],["Equal","","7+",Ss],["Elu","","6+",Ys,Qs],["Exp","","6+",tu],["Flatten","","1+",ku,Bu],["Floor","","6+",eu],["FusedConv","com.microsoft","1+",So,Oo],["Gather","","1+",Nu,Cu],["Gemm","","7-10",Ao,Mu],["Gemm","","11+",Ao,Vu],["GlobalAveragePool","","1+",ul,ll],["GlobalMaxPool","","1+",hl],["Greater","","7+",Os],["Identity","","1+",go],["ImageScaler","","1+",zu,Wu],["InstanceNormalization","","6+",ju,Xu],["LeakyRelu","","6+",ru,nu],["Less","","7+",As],["LRN","","1+",Ju,Zu],["Log","","6+",ou],["MatMul","","1+",yu,gu],["MaxPool","","1+",fl,cl],["Mul","","7+",Ps],["Neg","","6+",iu],["Not","","1+",au],["Or","","7+",Es],["Pad","","2-10",Po,tl],["Pad","","11+",el,rl],["Pow","","7+",Ds],["PRelu","","7+",Ls],["ReduceLogSum","","1+",vl,ne],["ReduceMax","","1+",xl,ne],["ReduceMean","","1+",gl,ne],["ReduceMin","","1+",Tl,ne],["ReduceProd","","1+",wl,ne],["ReduceSum","","1-12",yl,ne],["ReduceSumSquare","","1+",Il,ne],["Relu","","6+",su],["Reshape","","5+",Sl],["Resize","","10",ko,Dl],["Resize","","11+",ko,Ll],["Shape","","1+",kl],["Sigmoid","","6+",uu],["Sin","","7+",lu],["Slice","","10+",Rl],["Slice","","1-9",Fl,Nl],["Softmax","","1-12",zl,Wl],["Softmax","","13+",ql,Hl],["Split","","2-12",Zl,Yl],["Sqrt","","6+",fu],["Squeeze","","1-12",Fo,ef],["Squeeze","","13+",tf],["Sub","","7+",$s],["Sum","","6+",nf],["Tan","","7+",cu],["Tanh","","6+",pu],["Tile","","6+",af],["Transpose","","1+",Te,Pu],["Upsample","","7-8",Eo,Pl],["Upsample","","9",Eo,El],["Unsqueeze","","1-12",No,lf],["Unsqueeze","","13+",uf],["Xor","","7+",ks]]});function hf(it){let _={},lt;for(;(lt=df.exec(it))!==null;){let ft=lt[3].split(",").map(mt=>{let pt=mt.trim().split(" ");return pt&&pt.length===2?{type:pt[0],name:pt[1]}:null}).filter(mt=>mt!==null);_[lt[2]]={params:ft,body:lt[4]}}for(let ft in _){let mt=Uh.replace("__FUNC__",ft),pt=new RegExp(mt,"gm");for(;(lt=pt.exec(it))!==null;){let gt=lt[1],bt=lt[2],wt=lt[3].split(","),vt=gt?`${gt} ${bt};`:"",Ct=_[ft].body,Rt="";_[ft].params.forEach((Ot,Nt)=>{Ot&&(Rt+=`${Ot.type} ${Ot.name} = ${wt[Nt]};
`)}),Ct=`${Rt}
 ${Ct}`,Ct=Ct.replace("return",`${bt} = `);let Mt=`
      ${vt}
      {
        ${Ct}
      }
      `;it=it.replace(lt[0],Mt)}}return it=it.replace(df,""),it}var df,Uh,mf=x(()=>{df=/@inline[\s\n\r]+(\w+)[\s\n\r]+([0-9a-zA-Z_]+)\s*\(([^)]*)\)\s*{(([^}]|[\n\r])*)}/gm,Uh="(\\w+)?\\s+([_0-9a-zA-Z]+)\\s+=\\s+__FUNC__\\((.*)\\)\\s*;"});function Re(it,_){let lt=[],ft=[];for(let mt=0;mt<it.length;++mt)it[mt]!==1&&(lt.push(it[mt]),ft.push(mt));return{newShape:lt,keptDims:ft}}function Hh(it){if(it.length===0)return 1;let _=it[0];for(let lt=1;lt<it.length;lt++)_*=it[lt];return _}function bf(it){let _=Math.ceil(Math.sqrt(it));return[_,Math.ceil(it/_)]}var Yr,Co=x(()=>{It(),U(),Yr=class{constructor(it){this.maxTextureSize=it}computeTextureWH(it,_){let lt=this.computeTexture(it,_);return _&&_.isPacked&&(lt[0]/=2,lt[1]/=2),_&&_.reverseWH?[lt[1],lt[0]]:lt}computeTexture(it,_){let lt=_&&_.isPacked;if(it.length===0)return lt?[2,2]:[1,1];let ft=this.maxTextureSize;if(_&&_.breakAxis!==void 0){let gt=_.breakAxis>=it.length?1:it.slice(_.breakAxis).reduce((wt,vt)=>wt*vt),bt=_.breakAxis<=0?1:it.slice(0,_.breakAxis).reduce((wt,vt)=>wt*vt);if(gt>ft||bt>ft)z.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${it}, breakAxis:${_.breakAxis}`);else return[gt,bt]}let mt=it.slice(0);lt&&(ft=ft*2,mt=mt.map((gt,bt)=>bt>=mt.length-2?mt[bt]%2===0?mt[bt]:mt[bt]+1:mt[bt]),mt.length===1&&(mt=[2,mt[0]])),mt.length!==2&&(mt=Re(mt).newShape);let pt=Hh(mt);return mt.length<=1&&pt<=ft?[1,pt]:mt.length===2&&mt[0]<=ft&&mt[1]<=ft?mt:mt.length===3&&mt[0]*mt[1]<=ft&&mt[2]<=ft?[mt[0]*mt[1],mt[2]]:mt.length===3&&mt[0]<=ft&&mt[1]*mt[2]<=ft?[mt[0],mt[1]*mt[2]]:mt.length===4&&mt[0]*mt[1]*mt[2]<=ft&&mt[3]<=ft?[mt[0]*mt[1]*mt[2],mt[3]]:mt.length===4&&mt[0]<=ft&&mt[1]*mt[2]*mt[3]<=ft?[mt[0],mt[1]*mt[2]*mt[3]]:lt?bf(pt/4).map(gt=>gt*2):bf(pt)}}}),Qr,yf=x(()=>{U(),Xt(),X(),Co(),Vt(),Qr=class extends At{constructor(it){super(it)}getFunctions(){return{...this.offsetToCoords(),...this.coordsToOffset(),...this.toVec(),...this.valueFrom(),...this.getCommonUtilFuncs(),...this.getInputsSamplingSnippets(),...this.getOutputSamplingSnippet()}}getCustomTypes(){return{}}offsetToCoords(){let it="offsetToCoords";return{offsetToCoords:new O(`
      vec2 ${it}(int offset, int width, int height) {
        int t = offset / width;
        int s = offset - t*width;
        vec2 coords = (vec2(s,t) + vec2(0.5,0.5)) / vec2(width, height);
        return coords;
      }
      `)}}coordsToOffset(){let it="coordsToOffset";return{coordsToOffset:new O(`
      int ${it}(vec2 coords, int width, int height) {
        float s = coords.s * float(width);
        float t = coords.t * float(height);
        int offset = int(t) * width + int(s);
        return offset;
      }
      `)}}getOutputSamplingSnippet(){let it=this.context.outputTextureLayout;return it.isPacked?this.getPackedOutputSamplingSnippet(it):this.getUnpackedOutputSamplingSnippet(it)}getPackedOutputSamplingSnippet(it){let _=it.unpackedShape,lt=[it.width,it.height],ft={},mt="getOutputCoords";switch(_.length){case 0:ft[mt]=this.getOutputScalarCoords();break;case 1:ft[mt]=this.getOutputPacked1DCoords(_,lt);break;case 2:ft[mt]=this.getOutputPacked2DCoords(_,lt);break;case 3:ft[mt]=this.getOutputPacked3DCoords(_,lt);break;default:ft[mt]=this.getOutputPackedNDCoords(_,lt)}let pt=`
      void setOutput(vec4 val) {
        ${D(this.context.glContext.version).output} = val;
      }
    `,gt="floatTextureSetRGBA";return ft[gt]=new O(pt),ft}getUnpackedOutputSamplingSnippet(it){let _=it.unpackedShape,lt=[it.width,it.height],ft={},mt="getOutputCoords";switch(_.length){case 0:ft[mt]=this.getOutputScalarCoords();break;case 1:ft[mt]=this.getOutputUnpacked1DCoords(_,lt);break;case 2:ft[mt]=this.getOutputUnpacked2DCoords(_,lt);break;case 3:ft[mt]=this.getOutputUnpacked3DCoords(_,lt);break;case 4:ft[mt]=this.getOutputUnpacked4DCoords(_,lt);break;case 5:ft[mt]=this.getOutputUnpacked5DCoords(_,lt);break;case 6:ft[mt]=this.getOutputUnpacked6DCoords(_,lt);break;default:throw new Error(`Unsupported output dimensionality: ${_.length}`)}let pt=`
        void setOutput(float val) {
          ${D(this.context.glContext.version).output} = vec4(val, 0, 0, 0);
        }
    `,gt="floatTextureSetR";return ft[gt]=new O(pt),ft}getOutputScalarCoords(){return new O(`
      int getOutputCoords() {
        return 0;
      }
    `)}getOutputPacked1DCoords(it,_){let lt=_,ft="";return lt[0]===1?(ft=`
          int getOutputCoords() {
            return 2 * int(TexCoords.y * ${lt[1]}.0);
          }
        `,new O(ft)):lt[1]===1?(ft=`
          int getOutputCoords() {
            return 2 * int(TexCoords.x * ${lt[0]}.0);
          }
        `,new O(ft)):(ft=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                 vec2(${lt[0]}, ${lt[1]}));
          return 2 * (resTexRC.y * ${lt[0]} + resTexRC.x);
        }
      `,new O(ft))}getOutputPacked2DCoords(it,_){let lt="";if(de.arraysEqual(it,_))return lt=`
        ivec2 getOutputCoords() {
          return 2 * ivec2(TexCoords.xy * vec2(${_[0]}, ${_[1]}));
        }
      `,new O(lt);let ft=_,mt=Math.ceil(it[1]/2);return lt=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${ft[0]}, ${ft[1]}));

          int index = resTexRC.y * ${ft[0]} + resTexRC.x;

          // reverse r and c order for packed texture
          int r = imod(index, ${mt}) * 2;
          int c = 2 * (index / ${mt});

          return ivec2(r, c);
        }
      `,new O(lt)}getOutputPacked3DCoords(it,_){let lt=[_[0],_[1]],ft=Math.ceil(it[2]/2),mt=ft*Math.ceil(it[1]/2),pt=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${lt[0]}, ${lt[1]}));
          int index = resTexRC.y * ${lt[0]} + resTexRC.x;

          int b = index / ${mt};
          index -= b * ${mt};

          // reverse r and c order for packed texture
          int r = imod(index, ${ft}) * 2;
          int c = 2 * (index / ${ft});

          return ivec3(b, r, c);
        }
      `;return new O(pt)}getOutputPackedNDCoords(it,_){let lt=[_[0],_[1]],ft=Math.ceil(it[it.length-1]/2),mt=ft*Math.ceil(it[it.length-2]/2),pt=mt,gt="",bt="b, r, c";for(let vt=2;vt<it.length-1;vt++)pt*=it[it.length-vt-1],gt=`
      int b${vt} = index / ${pt};
      index -= b${vt} * ${pt};
    `+gt,bt=`b${vt}, `+bt;let wt=`
      ivec${it.length} getOutputCoords() {
        ivec2 resTexRC = ivec2(TexCoords.xy *
                              vec2(${lt[0]}, ${lt[1]}));
        int index = resTexRC.y * ${lt[0]} + resTexRC.x;

        ${gt}

        int b = index / ${mt};
        index -= b * ${mt};

        // reverse r and c order for packed texture
        int r = imod(index, ${ft}) * 2;
        int c = 2 * (index / ${ft});

        return ivec${it.length}(${bt});
      }
    `;return new O(wt)}getOutputUnpacked1DCoords(it,_){let lt=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${_[0]}, ${_[1]}));
          return resTexRC.y * ${_[0]} + resTexRC.x;
        }
      `;return new O(lt)}getOutputUnpacked2DCoords(it,_){let lt=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${_[0]}, ${_[1]}));
          int index = resTexRC.y * ${_[0]} + resTexRC.x;
          int r = index / ${it[1]};
          int c = index - r * ${it[1]};
          return ivec2(r, c);
        }
      `;return new O(lt)}getOutputUnpacked3DCoords(it,_){let lt="",ft=it.length,mt=null;ft<2&&(mt=[]),mt=new Array(ft-1),mt[ft-2]=it[ft-1];for(let bt=ft-3;bt>=0;--bt)mt[bt]=mt[bt+1]*it[bt+1];let pt=["r","c","d"],gt=mt.map((bt,wt)=>{let vt=`int ${pt[wt]} = index / ${bt}`,Ct=wt===mt.length-1?`int ${pt[wt+1]} = index - ${pt[wt]} * ${bt}`:`index -= ${pt[wt]} * ${bt}`;return`${vt}; ${Ct};`}).join("");return lt=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${_[0]}, ${_[1]}));
          int index = resTexRC.y * ${_[0]} + resTexRC.x;
          ${gt}
          return ivec3(r, c, d);
        }
      `,new O(lt)}getOutputUnpacked4DCoords(it,_){let lt="",ft=it.length,mt=null;ft<2&&(mt=[]),mt=new Array(ft-1),mt[ft-2]=it[ft-1];for(let bt=ft-3;bt>=0;--bt)mt[bt]=mt[bt+1]*it[bt+1];let pt=["r","c","d","d2"],gt=mt.map((bt,wt)=>{let vt=`int ${pt[wt]} = index / ${bt}`,Ct=wt===mt.length-1?`int ${pt[wt+1]} = index - ${pt[wt]} * ${bt}`:`index -= ${pt[wt]} * ${bt}`;return`${vt}; ${Ct};`}).join("");return lt=`
      ivec4 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${_[0]}, ${_[1]}));
          int index = resTexRC.y * ${_[0]} + resTexRC.x;
          ${gt}
          return ivec4(r, c, d, d2);
        }
      `,new O(lt)}getOutputUnpacked5DCoords(it,_){let lt="",ft=it.length,mt=null;ft<2&&(mt=[]),mt=new Array(ft-1),mt[ft-2]=it[ft-1];for(let bt=ft-3;bt>=0;--bt)mt[bt]=mt[bt+1]*it[bt+1];let pt=["r","c","d","d2","d3"],gt=mt.map((bt,wt)=>{let vt=`int ${pt[wt]} = index / ${bt}`,Ct=wt===mt.length-1?`int ${pt[wt+1]} = index - ${pt[wt]} * ${bt}`:`index -= ${pt[wt]} * ${bt}`;return`${vt}; ${Ct};`}).join("");return lt=`
      ivec5 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${_[0]}, ${_[1]}));
          int index = resTexRC.y * ${_[0]} + resTexRC.x;
          ${gt}
          return ivec5(r, c, d, d2, d3);
        }
      `,new O(lt)}getOutputUnpacked6DCoords(it,_){let lt="",ft=it.length,mt=null;ft<2&&(mt=[]),mt=new Array(ft-1),mt[ft-2]=it[ft-1];for(let bt=ft-3;bt>=0;--bt)mt[bt]=mt[bt+1]*it[bt+1];let pt=["r","c","d","d2","d3","d4"],gt=mt.map((bt,wt)=>{let vt=`int ${pt[wt]} = index / ${bt}`,Ct=wt===mt.length-1?`int ${pt[wt+1]} = index - ${pt[wt]} * ${bt}`:`index -= ${pt[wt]} * ${bt}`;return`${vt}; ${Ct};`}).join("");return lt=`
     ivec6 getOutputCoords() {
         ivec2 resTexRC = ivec2(TexCoords.xy *
                               vec2(${_[0]}, ${_[1]}));
         int index = resTexRC.y * ${_[0]} + resTexRC.x;
         ${gt}
         return ivec6(r, c, d, d2, d3, d4);
       }
     `,new O(lt)}getCommonUtilFuncs(){let it={},_="uvFromFlat";it[_]=new O(`
    vec2 uvFromFlat(int texNumR, int texNumC, int index) {
      int texC = index / texNumR;
      int texR = index - texC * texNumR;
      // TODO: swap texR, texC order in following function so row is corresponding to u and column is corresponding to
      //       v.
      return (vec2(texR, texC) + halfCR) / vec2(texNumR, texNumC);
    }
    `),_="packedUVfrom1D",it[_]=new O(`
      vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
        int texelIndex = index / 2;
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),_="packedUVfrom2D",it[_]=new O(`
      vec2 packedUVfrom2D(int texNumR, int texNumC, int texelsInLogicalRow, int row, int col) {
        int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),_="packedUVfrom3D",it[_]=new O(`
      vec2 packedUVfrom3D(int texNumR, int texNumC,
          int texelsInBatch, int texelsInLogicalRow, int b,
          int row, int col) {
        int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = index / texNumC;
        int texC = index - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),_="sampleTexture";let lt=D(this.context.glContext.version);return it[_]=new O(`
        float sampleTexture(sampler2D textureSampler, vec2 uv) {
            return ${lt.texture2D}(textureSampler, uv).r;
        }`),it}getInputsSamplingSnippets(){let it={},_=this.context.outputTextureLayout;return this.context.programInfo.inputNames.forEach((lt,ft)=>{let mt=this.context.inputTextureLayouts[ft],pt=Rr(lt);mt.isPacked?it[pt]=this.getPackedSamplerFromInput(pt,lt,mt):it[pt]=this.getUnpackedSamplerFromInput(pt,lt,mt);let gt=ns(lt);mt.unpackedShape.length<=_.unpackedShape.length&&(mt.isPacked?it[gt]=this.getPackedSamplerAtOutputCoords(gt,mt,_,lt):it[gt]=this.getUnpackedSamplerAtOutputCoords(gt,mt,_,lt))}),it}getPackedSamplerAtOutputCoords(it,_,lt,ft){let mt=_.unpackedShape,pt=lt.unpackedShape,gt=Rr(ft),bt=mt.length,wt=pt.length,vt=dt.getBroadcastDims(mt,pt),Ct=ht(wt),Rt=wt-bt,Mt,Ot=Gt();bt===0?Mt="":wt<2&&vt.length>=1?Mt="coords = 0;":Mt=vt.map(br=>`coords.${Ot[br+Rt]} = 0;`).join(`
`);let Nt="";wt<2&&bt>0?Nt="coords":Nt=mt.map((br,Fr)=>`coords.${Ot[Fr+Rt]}`).join(", ");let Ht="return outputValue;",Kt=A.size(mt)===1,hr=A.size(pt)===1;if(bt===1&&!Kt&&!hr)Ht=`
        return vec4(outputValue.xy, outputValue.xy);
      `;else if(Kt&&!hr)wt===1?Ht=`
          return vec4(outputValue.x, outputValue.x, 0., 0.);
        `:Ht=`
          return vec4(outputValue.x);
        `;else if(vt.length){let br=bt-2,Fr=bt-1;vt.indexOf(br)>-1&&vt.indexOf(Fr)>-1?Ht="return vec4(outputValue.x);":vt.indexOf(br)>-1?Ht="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":vt.indexOf(Fr)>-1&&(Ht="return vec4(outputValue.xx, outputValue.zz);")}let Qt=`
        int lastDim = coords.${Ot[wt-1]};
        coords.${Ot[wt-1]} = coords.${Ot[wt-2]};
        coords.${Ot[wt-2]} = lastDim;
      `,mr=`
      vec4 ${it}() {
        ${Ct} coords = getOutputCoords();
        ${Qt}
        ${Mt}
        vec4 outputValue = ${gt}(${Nt});
        ${Ht}
      }
    `;return new O(mr,["coordinates.getOutputCoords"])}getUnpackedSamplerAtOutputCoords(it,_,lt,ft){let mt=[lt.width,lt.height],pt=[_.width,_.height],gt=_.unpackedShape.length,bt=lt.unpackedShape.length,wt=_.unpackedShape,vt=lt.unpackedShape,Ct=Rr(ft);if(gt===bt&&de.arraysEqual(pt,mt)){let Qt=`
          float ${it}() {
            return sampleTexture(${ft}, TexCoords);
          }
        `;return new O(Qt,["coordinates.sampleTexture"])}let Rt=ht(bt),Mt=dt.getBroadcastDims(wt,vt),Ot=bt-gt,Nt,Ht=Gt();gt===0?Nt="":bt<2&&Mt.length>=1?Nt="coords = 0;":Nt=Mt.map(Qt=>`coords.${Ht[Qt+Ot]} = 0;`).join(`
`);let Kt="";bt<2&&gt>0?Kt="coords":Kt=_.unpackedShape.map((Qt,mr)=>`coords.${Ht[mr+Ot]}`).join(", ");let hr=`
        float ${it}() {
          ${Rt} coords = getOutputCoords();
          ${Nt}
          return ${Ct}(${Kt});
        }
      `;return new O(hr,["coordinates.getOutputCoords"])}getPackedSamplerFromInput(it,_,lt){switch(lt.unpackedShape.length){case 0:return this.getPackedSamplerScalar(it,_);case 1:return this.getPackedSampler1D(it,_,lt);case 2:return this.getPackedSampler2D(it,_,lt);case 3:return this.getPackedSampler3D(it,_,lt);default:return this.getPackedSamplerND(it,_,lt)}}getUnpackedSamplerFromInput(it,_,lt){let ft=lt.unpackedShape;switch(ft.length){case 0:return this.getUnpackedSamplerScalar(it,_,lt);case 1:return this.getUnpackedSampler1D(it,_,lt);case 2:return this.getUnpackedSampler2D(it,_,lt);case 3:return this.getUnpackedSampler3D(it,_,lt);case 4:return this.getUnpackedSampler4D(it,_,lt);case 5:return this.getUnpackedSampler5D(it,_,lt);case 6:return this.getUnpackedSampler6D(it,_,lt);default:throw new Error(`Unsupported dimension ${ft.length}-D`)}}getPackedSamplerScalar(it,_){let lt=D(this.context.glContext.version),ft=`
          vec4 ${it}() {
            return ${lt.texture2D}(${_}, halfCR);
          }
        `;return new O(ft)}getPackedSampler1D(it,_,lt){let ft=[lt.width,lt.height],mt=[ft[1],ft[0]],pt=D(this.context.glContext.version),gt=`vec4 ${it}(int index) {
      vec2 uv = packedUVfrom1D(
      ${mt[0]}, ${mt[1]}, index);
      return ${pt.texture2D}(${_}, uv);
    }`;return new O(gt,["coordinates.packedUVfrom1D"])}getPackedSampler2D(it,_,lt){let ft=lt.unpackedShape,mt=[lt.width,lt.height],pt=D(this.context.glContext.version),gt=mt[0],bt=mt[1];if(mt!=null&&de.arraysEqual(ft,mt)){let Rt=`vec4 ${it}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${bt}.0, ${gt}.0);
        return ${pt.texture2D}(${_}, uv);
      }`;return new O(Rt)}let wt=mt,vt=Math.ceil(ft[1]/2),Ct=`vec4 ${it}(int row, int col) {
      vec2 uv = packedUVfrom2D(${wt[1]}, ${wt[0]}, ${vt}, row, col);
      return ${pt.texture2D}(${_}, uv);
    }`;return new O(Ct,["coordinates.packedUVfrom2D"])}getPackedSampler3D(it,_,lt){let ft=lt.unpackedShape,mt=[lt.width,lt.height],pt=[mt[0],mt[1]],gt=D(this.context.glContext.version);if(ft[0]===1){let Mt=ft.slice(1),Ot=[1,2],Nt=ke(ft,Mt),Ht=["b","row","col"],Kt=JSON.parse(JSON.stringify(lt));Kt.unpackedShape=Nt;let hr=this.getPackedSamplerFromInput(it,_,Kt),Qt=`${hr.routineBody}
      vec4 ${it}(int b, int row, int col) {
        return ${it}(${Be(Ht,Ot)});
      } `;return new O(Qt,hr.dependencies)}let bt=pt[0],wt=pt[1],vt=Math.ceil(ft[2]/2),Ct=vt*Math.ceil(ft[1]/2),Rt=`vec4 ${it}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${wt}, ${bt}, ${Ct}, ${vt}, b, row, col);
      return ${gt.texture2D}(${_}, uv);}`;return new O(Rt,["coordinates.packedUVfrom3D"])}getPackedSamplerND(it,_,lt){let ft=lt.unpackedShape,mt=ft.length,pt=[lt.width,lt.height],gt=D(this.context.glContext.version),bt=[pt[0],pt[1]],wt=bt[1],vt=bt[0],Ct=Math.ceil(ft[mt-1]/2),Rt=Ct*Math.ceil(ft[mt-2]/2),Mt="int b, int row, int col",Ot=`b * ${Rt} + (row / 2) * ${Ct} + (col / 2)`;for(let Ht=2;Ht<mt-1;Ht++)Mt=`int b${Ht}, `+Mt,Rt*=ft[mt-Ht-1],Ot=`b${Ht} * ${Rt} + `+Ot;let Nt=`vec4 ${it}(${Mt}) {
      int index = ${Ot};
      int texR = index / ${vt};
      int texC = index - texR * ${vt};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${vt}, ${wt});
      return ${gt.texture2D}(${_}, uv);
    }`;return new O(Nt)}getUnpackedSamplerScalar(it,_,lt){let[ft,mt]=[lt.width,lt.height];if(ft===1&&mt===1){let gt=`
          float ${it}() {
            return sampleTexture(${_}, halfCR);
          }
        `;return new O(gt,["coordinates.sampleTexture"])}let pt=`
        float ${it}() {
          int offset_${_} = coordsToOffset(TexCoords, ${ft}, ${mt});
          vec2 uv = uvFromFlat(${ft}, ${mt}, offset_${_});
          return sampleTexture(${_}, uv);
        }
      `;return new O(pt,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler1D(it,_,lt){let ft=lt.width,mt=lt.height;if(mt===1&&ft===1){let gt=`
        float ${it}(int index) {
          return sampleTexture(${_}, halfCR);
        }
      `;return new O(gt,["coordinates.sampleTexture"])}if(mt===1){let gt=`
          float ${it}(int index) {
            vec2 uv = vec2((float(index) + 0.5) / ${ft}.0, 0.5);
            return sampleTexture(${_}, uv);
          }
        `;return new O(gt,["coordinates.sampleTexture"])}if(ft===1){let gt=`
          float ${it}(int index) {
            vec2 uv = vec2(0.5, (float(index) + 0.5) / ${mt}.0);
            return sampleTexture(${_}, uv);
          }
        `;return new O(gt,["coordinates.sampleTexture"])}let pt=`
        float ${it}(int index) {
          vec2 uv = uvFromFlat(${ft}, ${mt}, index);
          return sampleTexture(${_}, uv);
        }
      `;return new O(pt,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler2D(it,_,lt){let ft=lt.unpackedShape,mt=[lt.height,lt.width];if(mt!=null&&de.arraysEqual(ft,mt)){let Rt=mt[1],Mt=mt[0],Ot=`
          float ${it}(int row, int col) {
            vec2 uv = (vec2(row, col) + halfCR) / vec2(${Rt}.0, ${Mt}.0);
            return sampleTexture(${_}, uv);
          }
        `;return new O(Ot,["coordinates.sampleTexture"])}let{newShape:pt,keptDims:gt}=Re(ft),bt=pt;if(bt.length<ft.length){let Rt=ke(ft,bt),Mt=JSON.parse(JSON.stringify(lt));Mt.unpackedShape=Rt;let Ot=["col","row"],Nt=`
          ${this.getUnpackedSamplerFromInput(it,_,Mt).routineBody}
          float ${it}(int row, int col) {
            return ${it}(${Be(Ot,gt)});
          }
        `;return new O(Nt,["coordinates.sampleTexture"])}let wt=mt[1],vt=mt[0];if(vt===1){let Rt=`
          float ${it}(int row, int col) {
            int offset_${_} = coordsToOffset(TexCoords, ${wt}, ${vt});
            float index = dot(vec3(row, col, offset_${_}), vec3(${ft[1]}, 1, 1));
            vec2 uv = vec2(0.5, (index + 0.5) / ${wt}.0);
            return sampleTexture(${_}, uv);
          }
        `;return new O(Rt,["coordinates.sampleTexture","coordinates.coordsToOffset"])}if(wt===1){let Rt=`
          float ${it}(int row, int col) {
            int offset_${_} = coordsToOffset(TexCoords, ${wt}, ${vt});
            float index = dot(vec3(row, col, offset_${_}), vec3(${ft[1]}, 1, 1));
            vec2 uv = vec2((index + 0.5) / ${vt}.0, 0.5);
            return sampleTexture(${_}, uv);
          }
        `;return new O(Rt,["coordinates.sampleTexture","coordinates.coordsToOffset"])}let Ct=`
        float ${it}(int row, int col) {
          int index = col * ${ft[1]} + row;
          vec2 uv = uvFromFlat(${wt}, ${vt}, index);
          return sampleTexture(${_}, uv);
        }
      `;return new O(Ct,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler3D(it,_,lt){let ft=lt.unpackedShape,mt=ft[1]*ft[2],pt=ft[2],{newShape:gt,keptDims:bt}=Re(ft),wt=gt;if(wt.length<ft.length){let Mt=ke(ft,wt),Ot=["batch","col","row"],Nt=JSON.parse(JSON.stringify(lt));Nt.unpackedShape=Mt;let Ht=this.getUnpackedSamplerFromInput(it,_,Nt),Kt=bt.reverse(),hr=`
          ${Ht.routineBody}
          float ${it}(int batch, int row, int col) {
            return ${it}(${Be(Ot,Kt)});
          }
        `;return new O(hr,Ht.dependencies)}let vt=lt.width,Ct=lt.height,Rt=`
          float ${it}(int depth, int row, int col) {
            // Explicitly use integer operations as dot() only works on floats.
            int index = depth * ${mt} + col * ${pt} + row;
            vec2 uv = uvFromFlat(${vt}, ${Ct}, index);
            return sampleTexture(${_}, uv);
          }
      `;return new O(Rt,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler4D(it,_,lt){let ft=lt.unpackedShape,mt=ft[3],pt=ft[2]*mt,gt=ft[1]*pt,bt=lt.width,wt=lt.height,vt=`
        float ${it}(int row, int col, int depth, int depth2) {
          int index = row * ${gt} + col * ${pt} +
              depth2 * ${mt} + depth;
          vec2 uv = uvFromFlat(${bt}, ${wt}, index);
          return sampleTexture(${_}, uv);
        }
      `;return new O(vt,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler5D(it,_,lt){let ft=lt.unpackedShape,mt=ft[4],pt=ft[3]*mt,gt=ft[2]*pt,bt=ft[1]*gt,{newShape:wt,keptDims:vt}=Re(ft);if(wt.length<ft.length){let Ot=ke(ft,wt),Nt=["row","col","depth","depth2","depth3"],Ht=JSON.parse(JSON.stringify(lt));Ht.unpackedShape=Ot;let Kt=`
          ${this.getUnpackedSamplerFromInput(it,_,Ht).routineBody}
          float ${it}(int row, int col, int depth, int depth2, int depth3) {
            return ${it}(${Be(Nt,vt)});
          }
        `;return new O(Kt,["coordinates.sampleTexture","coordinates.uvFromFlat"])}let Ct=lt.width,Rt=lt.height,Mt=`
        float ${it}(int row, int col, int depth, int depth2, int depth3) {
          int index = row * ${bt} + col * ${gt} + depth * ${pt} +
          depth3 * ${mt} + depth2;
          vec2 uv = uvFromFlat(${Ct}, ${Rt}, index);
          return sampleTexture(${_}, uv);
        }
      `;return new O(Mt,["coordinates.sampleTexture","coordinates.uvFromFlat"])}getUnpackedSampler6D(it,_,lt){let ft=lt.unpackedShape,mt=ft[5],pt=ft[4]*mt,gt=ft[3]*pt,bt=ft[2]*gt,wt=ft[1]*bt,{newShape:vt,keptDims:Ct}=Re(ft);if(vt.length<ft.length){let Nt=ke(ft,vt),Ht=["row","col","depth","depth2","depth3","depth4"],Kt=JSON.parse(JSON.stringify(lt));Kt.unpackedShape=Nt;let hr=`
            ${this.getUnpackedSamplerFromInput(it,_,Kt).routineBody}
            float ${it}(int row, int col, int depth,
              int depth2, int depth3, int depth4) {
              return ${it}(${Be(Ht,Ct)});
            }
          `;return new O(hr,["coordinates.sampleTexture","coordinates.uvFromFlat"])}let Rt=lt.width,Mt=lt.height,Ot=`
          float ${it}(int row, int col, int depth,
            int depth2, int depth3, int depth4) {
            int index = row * ${wt} + col * ${bt} + depth * ${gt} +
            depth2 * ${pt} + depth3 * ${mt} + depth4;
            vec2 uv = uvFromFlat(${Rt}, ${Mt}, index);
            return sampleTexture(${_}, uv);
          }
        `;return new O(Ot,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}toVec(){let it=this.context.outputTextureLayout,_=it.shape.length,lt=it.strides,ft=it.width,mt=it.height,pt=[];for(let bt=0;bt<_-1;++bt)pt.push(`
        c[${bt}] = offset / ${lt[bt]};`),pt.push(`
        offset -= c[${bt}] * ${lt[bt]};`);pt.push(`
        c[${_-1}] = offset;`);let gt=`
      void toVec(vec2 texCoords, out int c[${_}]) {
        int offset = coordsToOffset(texCoords, ${ft}, ${mt});
        ${pt.join("")}
      }
      void toVec(int offset, out int c[${_}]) {
        ${pt.join("")}
      }
    `;return{toVec:new O(gt,["coordinates.coordsToOffset"])}}valueFrom(){let it={};return this.context.programInfo.inputNames.forEach((_,lt)=>{let ft=this.context.inputTextureLayouts[lt],mt=(ft.unpackedShape.length>0?ft.unpackedShape:ft.shape).length,pt=`_${_}`;it[pt]=new O(this.getValueFromSingle(_,mt,ft.width,ft.height,!1),[`shapeUtils.indicesToOffset${pt}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"]),pt=pt+"_T",it[pt]=new O(this.getValueFromSingle(_,mt,ft.width,ft.height,!0),[`shapeUtils.indicesToOffset${pt}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"])}),it}getValueFromSingle(it,_,lt,ft,mt){let pt=`_${it}`;mt&&(pt=pt+"_T");let gt=D(this.context.glContext.version);return`
        float ${pt}(int m[${_}]) {
          int offset = indicesToOffset${pt}(m);
          vec2 coords = offsetToCoords(offset, ${lt}, ${ft});
          float value = getColorAsFloat(${gt.texture2D}(${it}, coords));
          return value;
        }
        `}getPackedValueFrom(it,_,lt,ft,mt){let pt=`_${it}_Pack`;mt&&(pt=pt+"_T");let gt=D(this.context.glContext.version);return`
        vec4 ${pt}(int m[${_}]) {
          int offset = indicesToOffset_${it}(m);
          vec2 coords = offsetToCoords(offset, ${lt}, ${ft});
          return ${gt.texture2D}(${it}, coords);
        }
        `}}}),tn,gf=x(()=>{Xt(),tn=class sv extends At{constructor(_){super(_)}getFunctions(){return{...this.encodeFloat32(),...this.decodeFloat32()}}getCustomTypes(){return{}}encodeFloat32(){return{encode:new O(`highp vec4 encode(highp float f) {
        return vec4(f, 0.0, 0.0, 0.0);
      }
        `)}}decodeFloat32(){return{decode:new O(`highp float decode(highp vec4 rgba) {
        return rgba.r;
      }
        `)}}encodeUint8(){let _=sv.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{encode:new O(`
      highp vec4 encode(highp float f) {
        highp float F = abs(f);
        highp float Sign = step(0.0,-f);
        highp float Exponent = floor(log2(F));
        highp float Mantissa = (exp2(- Exponent) * F);
        Exponent = floor(log2(F) + 127.0) + floor(log2(Mantissa));
        highp vec4 rgba;
        rgba[0] = 128.0 * Sign  + floor(Exponent*exp2(-1.0));
        rgba[1] = 128.0 * mod(Exponent,2.0) + mod(floor(Mantissa*128.0),128.0);
        rgba[2] = floor(mod(floor(Mantissa*exp2(23.0 -8.0)),exp2(8.0)));
        rgba[3] = floor(exp2(23.0)*mod(Mantissa,exp2(-15.0)));
        ${_}
        rgba = rgba / 255.0; // values need to be normalized to [0,1]
        return rgba;
    }
        `)}}decodeUint8(){let _=sv.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{decode:new O(`
        highp float decode(highp vec4 rgba) {
          rgba = rgba * 255.0; // values need to be de-normalized from [0,1] to [0,255]
          ${_}
          highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;
          highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;
          highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);
          highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));
          return Result;
      }
        `)}}static isLittleEndian(){let _=new ArrayBuffer(4),lt=new Uint32Array(_),ft=new Uint8Array(_);if(lt[0]=3735928559,ft[0]===239)return!0;if(ft[0]===222)return!1;throw new Error("unknown endianness")}}}),en,xf=x(()=>{Xt(),X(),en=class extends At{constructor(it){super(it)}getFunctions(){return{...this.setFragColor(),...this.getColorAsFloat()}}getCustomTypes(){return{}}setFragColor(){let it=D(this.context.glContext.version);return{setFragColor:new O(`
        void setFragColor(float value) {
            ${it.output} = encode(value);
        }
        `,["encoding.encode"])}}getColorAsFloat(){return{getColorAsFloat:new O(`
        float getColorAsFloat(vec4 color) {
            return decode(color);
        }
        `,["encoding.decode"])}}}}),rn,Tf=x(()=>{Xt(),rn=class Cy extends At{constructor(_){super(_)}getFunctions(){return{...this.bcastIndex(),...this.bcastMatmulIndex(),...this.offsetToIndices(),...this.indicesToOffset(),...this.incrementIndices()}}getCustomTypes(){return{}}bcastIndex(){let _=this.context.outputTextureLayout.shape.length,lt={};return this.context.programInfo.inputNames.forEach((ft,mt)=>{let pt=this.context.inputTextureLayouts[mt].unpackedShape;if(pt.length<=_){let gt=pt.length,bt=_-gt,wt=`bcastIndices_${ft}`,vt="";for(let Rt=0;Rt<gt;++Rt)vt+=`
          realIndices[${Rt}] = int( mod(float(bcastedIndices[${bt+Rt}]), ${pt[Rt]}.0) );
          `;let Ct=`
        void ${wt} (int bcastedIndices[${_}], out int realIndices[${gt}]) {
          ${vt}
        }
        `;lt[wt]=new O(Ct)}}),lt}bcastMatmulIndex(){let _=this.context.outputTextureLayout.shape.length,lt={};return this.context.programInfo.inputNames.forEach((ft,mt)=>{let pt=this.context.inputTextureLayouts[mt].shape;if(!(pt.length<2||pt.length>_)){let gt=pt.length,bt=_-gt,wt=`bcastMatmulIndices_${ft}`,vt="";for(let Rt=0;Rt<gt-2;++Rt)vt+=`
          realIndices[${Rt}] = int( mod(float(bcastedIndices[${bt+Rt}]), ${pt[Rt]}.0) );
          `;let Ct=`
        void ${wt}(int bcastedIndices[${_}], out int realIndices[${gt}]) {
          ${vt}
          realIndices[${gt-1}] = bcastedIndices[${_-1}];
          realIndices[${gt-2}] = bcastedIndices[${_-2}];
        }
        `;lt[wt]=new O(Ct)}}),lt}indicesToOffset(){let _={};return this.context.programInfo.inputNames.forEach((lt,ft)=>{let mt=this.context.inputTextureLayouts[ft].shape,pt=this.context.inputTextureLayouts[ft].strides,gt=mt.length,bt=`indicesToOffset_${lt}`;_[bt]=new O(Cy.indexToOffsetSingle(bt,gt,pt)),bt=`indicesToOffset_${lt}_T`,_[bt]=new O(Cy.indexToOffsetSingle(bt,gt,pt.slice().reverse()))}),_}static indexToOffsetSingle(_,lt,ft){let mt="";for(let pt=lt-1;pt>=0;--pt)mt+=`
        offset += indices[${pt}] * ${ft[pt]};
        `;return`
      int ${_}(int indices[${lt}]) {
        int offset = 0;
        ${mt}
        return offset;
      }
      `}offsetToIndices(){let _={};return this.context.programInfo.inputNames.forEach((lt,ft)=>{let mt=this.context.inputTextureLayouts[ft].shape,pt=this.context.inputTextureLayouts[ft].strides,gt=mt.length,bt=`offsetToIndices_${lt}`;_[bt]=new O(Cy.offsetToIndicesSingle(bt,gt,pt)),bt=`offsetToIndices_${lt}_T`,_[bt]=new O(Cy.offsetToIndicesSingle(bt,gt,pt.slice().reverse()))}),_}static offsetToIndicesSingle(_,lt,ft){let mt=[];for(let pt=0;pt<lt-1;++pt)mt.push(`
      indices[${pt}] = offset / ${ft[pt]};`),mt.push(`
        offset -= indices[${pt}] * ${ft[pt]};`);return mt.push(`
      indices[${lt-1}] = offset;`),`
      void ${_}(int offset, out int indices[${lt}]) {
        ${mt.join("")}
      }
      `}incrementIndices(){let _={};return this.context.programInfo.inputNames.forEach((lt,ft)=>{let mt=this.context.inputTextureLayouts[ft].shape,pt=mt.length,gt=`incrementIndices_${lt}`,bt="";for(let vt=0;vt<pt;++vt)bt+=`
        shape[${vt}] = ${mt[vt]};`;let wt=`
        void ${gt}(int axis, out int indices[${pt}]) {
          int shape[${pt}];
          ${bt};
          for(int i = ${pt} -1 ; i >= 0; --i) {
            if(i > axis) continue;
            indices[i] += 1;
            if(indices[i] < shape[i]) {
              break;
            }
            indices[i] = 0;
          }
        }
        `;_[gt]=new O(wt)}),_}}}),nn,wf=x(()=>{Xt(),nn=class extends At{constructor(it){super(it)}getCustomTypes(){return{}}getFunctions(){return{...this.binaryVecFunctions(),...this.copyVec(),...this.setVecItem(),...this.getVecItem()}}binaryVecFunctions(){let it=this.context.outputTextureLayout.shape.length,_={add:"+=",sub:"-=",mul:"*=",div:"/="},lt={};for(let ft in _){let mt=`${ft}Vec`,pt="";for(let bt=0;bt<it;++bt)pt+=`
          dest[${bt}] ${_[ft]} src[${bt}];
          `;let gt=`
        void ${mt}(int src[${it}], out int dest[${it}]) {
          ${pt}
        }
        `;lt[mt]=new O(gt)}return lt}copyVec(){let it=this.context.outputTextureLayout.shape.length,_="";for(let ft=0;ft<it;++ft)_+=`
        dest[${ft}] = src[${ft}];
        `;let lt=`
      void copyVec(int src[${it}], out int dest[${it}]) {
        ${_}
      }
      `;return{copyVec:new O(lt)}}setVecItem(){let it=this.context.outputTextureLayout.shape.length,_=`
        if(index < 0)
            index =${it} + index;
        if (index == 0)
            m[0] = value;
        `;for(let ft=1;ft<it-1;++ft)_+=`
        else if (index == ${ft})
            m[${ft}] = value;
            `;_+=`
        else
            m[${it-1}] = value;
        `;let lt=`
      void setVecItem(out int m[${it}], int index, int value) {
        ${_}
      }
        `;return{setVecItem:new O(lt)}}getVecItem(){let it=this.context.outputTextureLayout.shape.length,_=`
        if(index < 0)
            index = ${it} + index;
        if (index == 0)
            return m[0];
      `;for(let ft=1;ft<it-1;++ft)_+=`
        else if (index == ${ft})
            return m[${ft}];
      `;_+=`
        else
            return m[${it-1}];
        `;let lt=`
      int getVecItem(int m[${it}], int index) {
        ${_}
      }
    `;return{getVecItem:new O(lt)}}}}),Ro,vf=x(()=>{yf(),gf(),xf(),Tf(),wf(),Ro={encoding:tn,fragcolor:en,vec:nn,shapeUtils:rn,coordinates:Qr}}),on,If=x(()=>{Xt(),mf(),vf(),X(),on=class{constructor(it,_,lt,ft){this.libs={},this.glslLibRoutineDependencyGraph={},this.context=new Ur(it,_,lt,ft),Object.keys(Ro).forEach(pt=>{let gt=new Ro[pt](this.context);this.libs[pt]=gt});let mt=this.glslLibRoutineDependencyGraph;for(let pt in this.libs){let gt=this.libs[pt].getFunctions();for(let bt in gt){let wt=pt+"."+bt,vt;mt[wt]?(vt=mt[wt],vt.routineBody=gt[bt].routineBody):(vt=new rr(wt,gt[bt].routineBody),mt[wt]=vt);let Ct=gt[bt].dependencies;if(Ct)for(let Rt=0;Rt<Ct.length;++Rt)if(mt[Ct[Rt]])vt.addDependency(mt[Ct[Rt]]);else{let Mt=new rr(Ct[Rt]);mt[Ct[Rt]]=Mt,vt.addDependency(Mt)}}}}preprocess(){let it=this.context.programInfo,_=it.shaderSource;return this.context.programInfo.hasMain||(_=`${_}
      ${rs(this.context.glContext.version,this.context.outputTextureLayout.shape.length)}`),_=hf(_),`${es(this.context.glContext.version)}
    ${this.getUniforms(it.inputNames,it.variables)}
    ${this.getImports(_)}
    ${_}`}getImports(it){let _=this.selectGlslLibRoutinesToBeIncluded(it);if(_.length===0)return"";let lt="";for(let ft=0;ft<_.length;++ft)if(_[ft].routineBody)lt+=_[ft].routineBody+`
`;else throw new Error(`Missing body for the Glsl Library routine: ${_[ft].name}`);return lt}selectGlslLibRoutinesToBeIncluded(it){let _=[];return Object.keys(this.glslLibRoutineDependencyGraph).forEach(lt=>{let ft=lt.split(".")[1];it.indexOf(ft)!==-1&&_.push(this.glslLibRoutineDependencyGraph[lt])}),zr.returnOrderedNodes(_)}getUniforms(it,_){let lt=[];if(it)for(let ft of it)lt.push(`uniform sampler2D ${ft};`);if(_)for(let ft of _)lt.push(`uniform ${ft.type} ${ft.name}${ft.arrayLength?`[${ft.arrayLength}]`:""};`);return lt.join(`
`)}}}),an,_f=x(()=>{kt(),It(),If(),X(),an=class{constructor(it,_,lt){this.profiler=it,this.glContext=_,this.textureLayoutStrategy=lt,this.repo=new Map,this.attributesBound=!1}getArtifact(it){return this.repo.get(it)}setArtifact(it,_){this.repo.set(it,_)}run(it,_,lt){this.profiler.event("op",`ProgramManager.run ${it.programInfo.name??"unknown kernel"}`,()=>{let ft=this.glContext.gl,mt=it.program;ft.useProgram(mt);try{this.bindOutput(lt),this.attributesBound||this.bindAttributes(it.attribLocations),this.bindUniforms(it.uniformLocations,it.programInfo.variables??[],_)}catch(pt){throw z.error("ProgramManager",it.programInfo.shaderSource),pt}this.profiler.event("backend","GlContext.draw()",()=>{this.glContext.draw()})},this.glContext)}dispose(){this.vertexShader&&this.glContext.deleteShader(this.vertexShader),this.repo.forEach(it=>this.glContext.deleteProgram(it.program))}build(it,_,lt){return this.profiler.event("backend","ProgramManager.build",()=>{let ft=new on(this.glContext,it,_,lt),mt=ft.preprocess(),pt=this.compile(mt);return{programInfo:it,program:pt,uniformLocations:this.getUniformLocations(pt,ft.context.programInfo.inputNames,ft.context.programInfo.variables),attribLocations:this.getAttribLocations(pt)}})}compile(it){if(!this.vertexShader){z.verbose("ProrgramManager","Compiling and caching Vertex shader for the first time");let ft=ts(this.glContext.version);this.vertexShader=this.glContext.compileShader(ft,this.glContext.gl.VERTEX_SHADER)}$.debug&&z.verbose("ProrgramManager",`FragShader:
${it}
`);let _=this.glContext.compileShader(it,this.glContext.gl.FRAGMENT_SHADER),lt=this.glContext.createProgram(this.vertexShader,_);return this.glContext.deleteShader(_),lt}bindOutput(it){let _=it.width,lt=it.height;z.verbose("ProrgramManager",`Binding output texture to Framebuffer: w/h=${_}/${lt}, shape=${it.shape}, type=${it.tensor.type}`),this.glContext.attachFramebuffer(it.texture,_,lt)}bindAttributes(it){let _=it.position,lt=it.textureCoord;this.glContext.setVertexAttributes(_,lt),this.attributesBound=!0}bindUniforms(it,_,lt){var pt;let ft=this.glContext.gl,mt=0;for(let{name:gt,type:bt,location:wt,arrayLength:vt}of it){let Ct=(pt=_.find(Rt=>Rt.name===gt))==null?void 0:pt.data;if(bt!=="sampler2D"&&!Ct)throw new Error(`variable '${gt}' does not have data defined in program info`);switch(bt){case"sampler2D":this.bindTexture(lt[mt],wt,mt),mt++;break;case"float":vt?ft.uniform1fv(wt,Ct):ft.uniform1f(wt,Ct);break;case"int":vt?ft.uniform1iv(wt,Ct):ft.uniform1i(wt,Ct);break;default:throw new Error(`Uniform not implemented: ${bt}`)}}}bindTexture(it,_,lt){this.glContext.bindTextureToUniform(it.texture,lt,_)}getAttribLocations(it){return{position:this.getAttribLocation(it,"position"),textureCoord:this.getAttribLocation(it,"textureCoord")}}getUniformLocations(it,_,lt){let ft=[];if(_)for(let mt of _)ft.push({name:mt,type:"sampler2D",location:this.getUniformLocation(it,mt)});if(lt)for(let mt of lt)ft.push({...mt,location:this.getUniformLocation(it,mt.name)});return ft}getUniformLocation(it,_){let lt=this.glContext.gl.getUniformLocation(it,_);if(lt===null)throw new Error(`Uniform ${_} not found.`);return lt}getAttribLocation(it,_){return this.glContext.gl.getAttribLocation(it,_)}}}),sn,Sf=x(()=>{It(),tr(),sn=class{constructor(it,_,lt,ft){this.glContext=it,this.layoutStrategy=_,this.profiler=lt,this.config=ft,this.pendingRead=new Map,ft.reuseTextures&&(this.inUseTextures=new Map,this.idleTextures=new Map,this.textureLookup=new Map)}createTextureFromLayout(it,_,lt,ft){let mt=this.toEncoderType(it),pt=this.glContext.getEncoder(mt,_.channels||1,ft);if(_.isPacked&&ft===1)throw new Error("not implemented");let gt=_.width,bt=_.height,wt,vt;if(this.config.reuseTextures){wt=`${gt}x${bt}_${pt.format}_${pt.internalFormat}_${pt.textureType}`,vt=this.inUseTextures.get(wt),vt||(vt=[],this.inUseTextures.set(wt,vt));let Rt=this.idleTextures.get(wt);if(Rt&&Rt.length>0){let Mt=Rt.pop();return vt.push(Mt),ft===1&&this.glContext.updateTexture(Mt,gt,bt,pt,this.toTextureData(it,lt)),Mt}}z.verbose("TextureManager",`Creating new texture of size ${_.width}x${_.height}`);let Ct=this.glContext.allocateTexture(gt,bt,pt,this.toTextureData(it,lt));return this.config.reuseTextures&&(vt.push(Ct),this.textureLookup.set(Ct,wt)),Ct}readTexture(it,_,lt){return lt||(lt=1),this.profiler.event("backend","TextureManager.readTexture",()=>{let ft=it.shape.reduce((pt,gt)=>pt*gt)*lt,mt=this.glContext.readTexture(it.texture,it.width,it.height,ft,this.toEncoderType(_),lt);return this.toTensorData(_,mt)})}async readTextureAsync(it,_,lt){let ft=it.tensor.dataId;if(lt||(lt=1),this.pendingRead.has(ft)){let mt=this.pendingRead.get(ft);return new Promise(pt=>mt==null?void 0:mt.push(pt))}return this.profiler.event("backend","TextureManager.readTextureAsync",async()=>{this.pendingRead.set(ft,[]);let mt=it.shape.reduce((wt,vt)=>wt*vt)*lt;await this.glContext.createAndWaitForFence();let pt=this.glContext.readTexture(it.texture,it.width,it.height,mt,this.toEncoderType(_),lt),gt=this.toTensorData(_,pt),bt=this.pendingRead.get(ft);return this.pendingRead.delete(ft),bt==null||bt.forEach(wt=>wt(gt)),gt})}readUint8TextureAsFloat(it){return this.profiler.event("backend","TextureManager.readUint8TextureAsFloat",()=>{let _=it.shape.reduce((ft,mt)=>ft*mt),lt=this.glContext.readTexture(it.texture,it.width,it.height,_*4,"byte",4);return new Float32Array(lt.buffer,lt.byteOffset,_)})}releaseTexture(it,_){let lt;if(this.config.reuseTextures&&(lt=this.textureLookup.get(it.texture),lt)){_&&this.textureLookup.delete(lt);let ft=this.inUseTextures.get(lt);if(ft){let mt=ft.indexOf(it.texture);if(mt!==-1){ft.splice(mt,1);let pt=this.idleTextures.get(lt);pt||(pt=[],this.idleTextures.set(lt,pt)),pt.push(it.texture)}}}(!lt||_)&&(z.verbose("TextureManager",`Deleting texture of size ${it.width}x${it.height}`),this.glContext.deleteTexture(it.texture))}toTensorData(it,_){switch(it){case"int16":return _ instanceof Int16Array?_:Int16Array.from(_);case"int32":return _ instanceof Int32Array?_:Int32Array.from(_);case"int8":return _ instanceof Int8Array?_:Int8Array.from(_);case"uint16":return _ instanceof Uint16Array?_:Uint16Array.from(_);case"uint32":return _ instanceof Uint32Array?_:Uint32Array.from(_);case"uint8":case"bool":return _ instanceof Uint8Array?_:Uint8Array.from(_);case"float32":return _ instanceof Float32Array?_:Float32Array.from(_);case"float64":return _ instanceof Float64Array?_:Float64Array.from(_);default:throw new Error(`TensorData type ${it} is not supported`)}}toTextureData(it,_){if(_)return _ instanceof Float32Array?_:new Float32Array(_)}toEncoderType(it){return"float"}clearActiveTextures(){this.glContext.clearActiveTextures()}}}),un,Of=x(()=>{It(),Mi(),ys(),pf(),_f(),Co(),Sf(),un=class{constructor(it,_){this.backend=it,this.context=_,this.layoutStrategy=new Yr(it.glContext.maxTextureSize),this.programManager=new an(this.context.profiler,it.glContext,this.layoutStrategy),this.textureManager=new sn(it.glContext,this.layoutStrategy,this.context.profiler,{reuseTextures:it.textureCacheMode==="full"}),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map,this.pack=it.pack,this.pack2unpackMap=new Map,this.unpack2packMap=new Map}createInferenceHandler(){return new Vr(this)}onGraphInitialized(it){let _=it.getValues().filter(lt=>lt.from===-1&&lt.tensor).map(lt=>lt.tensor.dataId);this.initializers=new Set(_)}isInitializer(it){return this.initializers?this.initializers.has(it):!1}addInitializer(it){this.initializers.add(it)}getTextureData(it,_){return _?this.packedTextureDataCache.get(it):this.unpackedTextureDataCache.get(it)}setTextureData(it,_,lt=!1){z.verbose("WebGLSessionHandler","Storing Texture data in cache"),lt?this.packedTextureDataCache.set(it,_):this.unpackedTextureDataCache.set(it,_)}dispose(){this.programManager.dispose(),this.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach(it=>this.textureManager.releaseTexture(it,!0)),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach(it=>this.textureManager.releaseTexture(it,!0)),this.unpackedTextureDataCache=new Map}resolve(it,_,lt){let ft=Gi(it,_,cf);return{impl:ft.opImpl,context:ft.opInit?ft.opInit(it,lt):it}}}});function qh(it){let _=0;for(;_<it.length&&it[_]();++_);return _-1}var ir,Af=x(()=>{kt(),tr(),tr(),Vt(),ir=class{constructor(it,_){this.frameBufferBound=!1,this.itemsToPoll=[],this.gl=it,this.version=_,this.getExtensions(),this.vertexbuffer=this.createVertexbuffer(),this.framebuffer=this.createFramebuffer(),this.queryVitalParameters()}allocateTexture(it,_,lt,ft){let mt=this.gl,pt=mt.createTexture();mt.bindTexture(mt.TEXTURE_2D,pt),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_MIN_FILTER,mt.NEAREST),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_MAG_FILTER,mt.NEAREST),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_WRAP_S,mt.CLAMP_TO_EDGE),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_WRAP_T,mt.CLAMP_TO_EDGE);let gt=ft?lt.encode(ft,it*_):null;return mt.texImage2D(mt.TEXTURE_2D,0,lt.internalFormat,it,_,0,lt.format,lt.textureType,gt),this.checkError(),pt}updateTexture(it,_,lt,ft,mt){let pt=this.gl;pt.bindTexture(pt.TEXTURE_2D,it);let gt=ft.encode(mt,_*lt);pt.texSubImage2D(pt.TEXTURE_2D,0,0,0,_,lt,ft.format,ft.textureType,gt),this.checkError()}attachFramebuffer(it,_,lt){let ft=this.gl;ft.bindTexture(ft.TEXTURE_2D,it),ft.bindFramebuffer(ft.FRAMEBUFFER,this.framebuffer),ft.framebufferTexture2D(ft.FRAMEBUFFER,ft.COLOR_ATTACHMENT0,ft.TEXTURE_2D,it,0),this.checkError(),ft.viewport(0,0,_,lt),ft.scissor(0,0,_,lt)}readTexture(it,_,lt,ft,mt,pt){let gt=this.gl;pt||(pt=1),this.frameBufferBound||this.attachFramebuffer(it,_,lt);let bt=this.getEncoder(mt,pt),wt=bt.allocate(_*lt);return gt.bindTexture(gt.TEXTURE_2D,it),gt.framebufferTexture2D(gt.FRAMEBUFFER,gt.COLOR_ATTACHMENT0,gt.TEXTURE_2D,it,0),gt.readPixels(0,0,_,lt,gt.RGBA,bt.textureType,wt),this.checkError(),bt.decode(wt,ft)}isFramebufferReady(){return!0}getActiveTexture(){let it=this.gl;return`TEXTURE${it.getParameter(this.gl.ACTIVE_TEXTURE)-it.TEXTURE0}`}getTextureBinding(){return this.gl.getParameter(this.gl.TEXTURE_BINDING_2D)}getFramebufferBinding(){return this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING)}setVertexAttributes(it,_){let lt=this.gl;lt.vertexAttribPointer(it,3,lt.FLOAT,!1,20,0),lt.enableVertexAttribArray(it),_!==-1&&(lt.vertexAttribPointer(_,2,lt.FLOAT,!1,20,12),lt.enableVertexAttribArray(_)),this.checkError()}createProgram(it,_){let lt=this.gl,ft=lt.createProgram();return lt.attachShader(ft,it),lt.attachShader(ft,_),lt.linkProgram(ft),ft}compileShader(it,_){let lt=this.gl,ft=lt.createShader(_);if(!ft)throw new Error(`createShader() returned null with type ${_}`);if(lt.shaderSource(ft,it),lt.compileShader(ft),lt.getShaderParameter(ft,lt.COMPILE_STATUS)===!1)throw new Error(`Failed to compile shader: ${lt.getShaderInfoLog(ft)}
Shader source:
${it}`);return ft}deleteShader(it){this.gl.deleteShader(it)}bindTextureToUniform(it,_,lt){let ft=this.gl;ft.activeTexture(ft.TEXTURE0+_),this.checkError(),ft.bindTexture(ft.TEXTURE_2D,it),this.checkError(),ft.uniform1i(lt,_),this.checkError()}draw(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.checkError()}checkError(){if($.debug){let it=this.gl,_=it.getError(),lt="";switch(_){case it.NO_ERROR:return;case it.INVALID_ENUM:lt="INVALID_ENUM";break;case it.INVALID_VALUE:lt="INVALID_VALUE";break;case it.INVALID_OPERATION:lt="INVALID_OPERATION";break;case it.INVALID_FRAMEBUFFER_OPERATION:lt="INVALID_FRAMEBUFFER_OPERATION";break;case it.OUT_OF_MEMORY:lt="OUT_OF_MEMORY";break;case it.CONTEXT_LOST_WEBGL:lt="CONTEXT_LOST_WEBGL";break;default:lt=`Unknown WebGL Error: ${_.toString(16)}`}throw new Error(lt)}}deleteTexture(it){this.gl.deleteTexture(it)}deleteProgram(it){this.gl.deleteProgram(it)}getEncoder(it,_,lt=0){if(this.version===2)return new Gr(this.gl,_);switch(it){case"float":return lt===1||this.isRenderFloat32Supported?new Qe(this.gl,_):new Qe(this.gl,_,this.textureHalfFloatExtension.HALF_FLOAT_OES);case"int":throw new Error("not implemented");case"byte":return new Mr(this.gl,_);default:throw new Error(`Invalid dataType: ${it}`)}}clearActiveTextures(){let it=this.gl;for(let _=0;_<this.maxTextureImageUnits;++_)it.activeTexture(it.TEXTURE0+_),it.bindTexture(it.TEXTURE_2D,null)}dispose(){if(this.disposed)return;let it=this.gl;it.bindFramebuffer(it.FRAMEBUFFER,null),it.deleteFramebuffer(this.framebuffer),it.bindBuffer(it.ARRAY_BUFFER,null),it.deleteBuffer(this.vertexbuffer),it.bindBuffer(it.ELEMENT_ARRAY_BUFFER,null),it.finish(),this.disposed=!0}createDefaultGeometry(){return new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0])}createVertexbuffer(){let it=this.gl,_=it.createBuffer();if(!_)throw new Error("createBuffer() returned null");let lt=this.createDefaultGeometry();return it.bindBuffer(it.ARRAY_BUFFER,_),it.bufferData(it.ARRAY_BUFFER,lt,it.STATIC_DRAW),this.checkError(),_}createFramebuffer(){let it=this.gl.createFramebuffer();if(!it)throw new Error("createFramebuffer returned null");return it}queryVitalParameters(){let it=this.gl;if(this.isFloatTextureAttachableToFrameBuffer=this.checkFloatTextureAttachableToFrameBuffer(),this.isRenderFloat32Supported=this.checkRenderFloat32(),this.isFloat32DownloadSupported=this.checkFloat32Download(),this.version===1&&!this.textureHalfFloatExtension&&!this.isRenderFloat32Supported)throw new Error("both float32 and float16 TextureType are not supported");this.isBlendSupported=!this.isRenderFloat32Supported||this.checkFloat32Blend(),this.maxTextureSize=it.getParameter(it.MAX_TEXTURE_SIZE),this.maxTextureImageUnits=it.getParameter(it.MAX_TEXTURE_IMAGE_UNITS),this.version}getExtensions(){this.version===2?(this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float"),this.disjointTimerQueryWebgl2Extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")):(this.textureFloatExtension=this.gl.getExtension("OES_texture_float"),this.textureHalfFloatExtension=this.gl.getExtension("OES_texture_half_float"))}checkFloatTextureAttachableToFrameBuffer(){let it=this.gl,_=it.createTexture();it.bindTexture(it.TEXTURE_2D,_);let lt=this.version===2?it.RGBA32F:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,lt,1,1,0,it.RGBA,it.FLOAT,null);let ft=it.createFramebuffer();it.bindFramebuffer(it.FRAMEBUFFER,ft),it.framebufferTexture2D(it.FRAMEBUFFER,it.COLOR_ATTACHMENT0,it.TEXTURE_2D,_,0);let mt=it.checkFramebufferStatus(it.FRAMEBUFFER)===it.FRAMEBUFFER_COMPLETE;return it.bindTexture(it.TEXTURE_2D,null),it.bindFramebuffer(it.FRAMEBUFFER,null),it.deleteTexture(_),it.deleteFramebuffer(ft),mt}checkRenderFloat32(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension)return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Download(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension||!this.gl.getExtension("WEBGL_color_buffer_float"))return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Blend(){let it=this.gl,_,lt,ft,mt,pt;try{_=it.createTexture(),lt=it.createFramebuffer(),it.bindTexture(it.TEXTURE_2D,_);let gt=this.version===2?it.RGBA32F:it.RGBA;return it.texImage2D(it.TEXTURE_2D,0,gt,1,1,0,it.RGBA,it.FLOAT,null),it.bindFramebuffer(it.FRAMEBUFFER,lt),it.framebufferTexture2D(it.FRAMEBUFFER,it.COLOR_ATTACHMENT0,it.TEXTURE_2D,_,0),it.enable(it.BLEND),ft=it.createShader(it.VERTEX_SHADER),!ft||(it.shaderSource(ft,"void main(){}"),it.compileShader(ft),mt=it.createShader(it.FRAGMENT_SHADER),!mt)||(it.shaderSource(mt,"precision highp float;void main(){gl_FragColor=vec4(0.5);}"),it.compileShader(mt),pt=it.createProgram(),!pt)?!1:(it.attachShader(pt,ft),it.attachShader(pt,mt),it.linkProgram(pt),it.useProgram(pt),it.drawArrays(it.POINTS,0,1),it.getError()===it.NO_ERROR)}finally{it.disable(it.BLEND),pt&&it.deleteProgram(pt),ft&&it.deleteShader(ft),mt&&it.deleteShader(mt),lt&&(it.bindFramebuffer(it.FRAMEBUFFER,null),it.deleteFramebuffer(lt)),_&&(it.bindTexture(it.TEXTURE_2D,null),it.deleteTexture(_))}}beginTimer(){if(this.version===2&&this.disjointTimerQueryWebgl2Extension){let it=this.gl,_=this.disjointTimerQueryWebgl2Extension,lt=it.createQuery();return it.beginQuery(_.TIME_ELAPSED_EXT,lt),lt}else throw new Error("WebGL1 profiling currently not supported.")}endTimer(){if(this.version===2&&this.disjointTimerQueryWebgl2Extension){let it=this.gl,_=this.disjointTimerQueryWebgl2Extension;it.endQuery(_.TIME_ELAPSED_EXT);return}else throw new Error("WebGL1 profiling currently not supported")}isTimerResultAvailable(it){let _=!1,lt=!1;if(this.version===2&&this.disjointTimerQueryWebgl2Extension){let ft=this.gl,mt=this.disjointTimerQueryWebgl2Extension;_=ft.getQueryParameter(it,ft.QUERY_RESULT_AVAILABLE),lt=ft.getParameter(mt.GPU_DISJOINT_EXT)}else throw new Error("WebGL1 profiling currently not supported");return _&&!lt}getTimerResult(it){let _=0;if(this.version===2){let lt=this.gl;_=lt.getQueryParameter(it,lt.QUERY_RESULT),lt.deleteQuery(it)}else throw new Error("WebGL1 profiling currently not supported");return _/1e6}async waitForQueryAndGetTime(it){return await uo(()=>this.isTimerResultAvailable(it)),this.getTimerResult(it)}async createAndWaitForFence(){let it=this.createFence(this.gl);return this.pollFence(it)}createFence(it){let _,lt=it,ft=lt.fenceSync(lt.SYNC_GPU_COMMANDS_COMPLETE,0);return it.flush(),ft===null?_=()=>!0:_=()=>{let mt=lt.clientWaitSync(ft,0,0);return mt===lt.ALREADY_SIGNALED||mt===lt.CONDITION_SATISFIED},{query:ft,isFencePassed:_}}async pollFence(it){return new Promise(_=>{this.addItemToPoll(()=>it.isFencePassed(),()=>_())})}pollItems(){let it=qh(this.itemsToPoll.map(_=>_.isDoneFn));for(let _=0;_<=it;++_){let{resolveFn:lt}=this.itemsToPoll[_];lt()}this.itemsToPoll=this.itemsToPoll.slice(it+1)}async addItemToPoll(it,_){this.itemsToPoll.push({isDoneFn:it,resolveFn:_}),!(this.itemsToPoll.length>1)&&await uo(()=>(this.pollItems(),this.itemsToPoll.length===0))}}});function Go(it){let _;if((!it||it==="webgl2")&&"webgl2"in Ge?_=Ge.webgl2:(!it||it==="webgl")&&"webgl"in Ge&&(_=Ge.webgl),!_)try{let ft=Xh();_=Pf(ft,it)}catch{let ft=jh();_=Pf(ft,it)}it=it||_.version===1?"webgl":"webgl2";let lt=_.gl;return Ge[it]=_,lt.isContextLost()?(delete Ge[it],Go(it)):(lt.disable(lt.DEPTH_TEST),lt.disable(lt.STENCIL_TEST),lt.disable(lt.BLEND),lt.disable(lt.DITHER),lt.disable(lt.POLYGON_OFFSET_FILL),lt.disable(lt.SAMPLE_COVERAGE),lt.enable(lt.SCISSOR_TEST),lt.enable(lt.CULL_FACE),lt.cullFace(lt.BACK),_)}function Pf(it,_){let lt={alpha:!1,depth:!1,antialias:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1},ft,mt=lt;if((!_||_==="webgl2")&&(ft=it.getContext("webgl2",mt),ft))try{return new ir(ft,2)}catch(pt){z.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl2'. Error: ${pt}`)}if((!_||_==="webgl")&&(ft=it.getContext("webgl",mt)||it.getContext("experimental-webgl",mt),ft))try{return new ir(ft,1)}catch(pt){z.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl' or 'experimental-webgl'. Error: ${pt}`)}throw new Error("WebGL is not supported")}function jh(){if(typeof document>"u")throw new TypeError("failed to create canvas: document is not supported");let it=document.createElement("canvas");return it.width=1,it.height=1,it}function Xh(){if(typeof OffscreenCanvas>"u")throw new TypeError("failed to create offscreen canvas: OffscreenCanvas is not supported");return new OffscreenCanvas(1,1)}var Ge,Ef=x(()=>{It(),Af(),Ge={}}),ln,Df=x(()=>{kt(),It(),Of(),Ef(),ln=class{get contextId(){return $.webgl.contextId}set contextId(it){$.webgl.contextId=it}get matmulMaxBatchSize(){return $.webgl.matmulMaxBatchSize}set matmulMaxBatchSize(it){$.webgl.matmulMaxBatchSize=it}get textureCacheMode(){return $.webgl.textureCacheMode}set textureCacheMode(it){$.webgl.textureCacheMode=it}get pack(){return $.webgl.pack}set pack(it){$.webgl.pack=it}get async(){return $.webgl.async}set async(it){$.webgl.async=it}initialize(){try{return this.glContext=Go(this.contextId),typeof this.matmulMaxBatchSize!="number"&&(this.matmulMaxBatchSize=16),typeof this.textureCacheMode!="string"&&(this.textureCacheMode="full"),typeof this.pack!="boolean"&&(this.pack=!1),typeof this.async!="boolean"&&(this.async=!1),z.setWithEnv($),$.webgl.context||Object.defineProperty($.webgl,"context",{value:this.glContext.gl}),z.verbose("WebGLBackend",`Created WebGLContext: ${typeof this.glContext} with matmulMaxBatchSize: ${this.matmulMaxBatchSize}; textureCacheMode: ${this.textureCacheMode}; pack: ${this.pack}; async: ${this.async}.`),!0}catch(it){return z.warning("WebGLBackend",`Unable to initialize WebGLBackend. ${it}`),!1}}createSessionHandler(it){return new un(this,it)}dispose(){this.glContext.dispose()}}});async function Mo(it){if(it){let _=typeof it=="string"?[it]:it;for(let lt of _){let ft=Lf.get(lt);if(ft)return ft;let mt=await Jh(lt);if(mt)return mt}}else return Mo(["webgl"]);throw new Error("no available backend to use")}async function Jh(it){let _=Kh;if(typeof _[it]<"u"&&Zh(_[it])){let lt=_[it],ft=lt.initialize();if(typeof ft=="object"&&"then"in ft&&(ft=await ft),ft)return Lf.set(it,lt),lt}}function Zh(it){let _=it;return"initialize"in _&&typeof _.initialize=="function"&&"createSessionHandler"in _&&typeof _.createSessionHandler=="function"&&"dispose"in _&&typeof _.dispose=="function"}var Lf,Kh,$f=x(()=>{Df(),Lf=new Map,Kh={webgl:new ln}}),Vo,fn,kf=x(()=>{It(),Vo=class{constructor(it,_){this.op=it,this.node=_}},fn=class{constructor(it,_,lt){this.graph=it,this.profiler=lt,this.initialize(_)}initialize(it){this.profiler.event("session","ExecutionPlan.initialize",()=>{let _=this.graph.getNodes();if(_.length!==it.length)throw new Error("The size of nodes and OPs do not match.");this._ops=it.map((lt,ft)=>new Vo(lt,_[ft])),this.reset(),this._starter=[],this._ops.forEach((lt,ft)=>{let mt=!0;for(let pt of lt.node.inputs)if(!this._values[pt]&&this.graph.getInputIndices().indexOf(pt)===-1){mt=!1;break}mt&&this._starter.push(ft)})})}reset(){this._values=this.graph.getValues().map(it=>it.tensor)}async execute(it,_){return this.profiler.event("session","ExecutionPlan.execute",async()=>{this.reset();let lt=it.createInferenceHandler(),ft=this.graph.getInputIndices();if(_.length!==ft.length)throw new Error(`number of input tensors don't match the number of inputs to the model: actual: ${_.length} expected: ${ft.length}`);_.forEach((vt,Ct)=>{let Rt=ft[Ct];this._values[Rt]=vt});let mt=this._starter.slice(0),pt=this.graph.getValues(),gt=this.graph.getNodes(),bt=0;for(;bt<mt.length;){let vt=mt[bt++],Ct=this._ops[vt],Rt=Ct.node.inputs.map(Ht=>this._values[Ht]);if(Rt.indexOf(void 0)!==-1)throw new Error(`unresolved input detected: op: ${Ct.node}`);let Mt=Rt;z.verbose("ExecPlan",`Running op:${Ct.node.name} (${Mt.map((Ht,Kt)=>`'${Ct.node.inputs[Kt]}': ${Ht.type}[${Ht.dims.join(",")}]`).join(", ")})`);let Ot=await this.profiler.event("node",Ct.node.name,async()=>Ct.op.impl(lt,Mt,Ct.op.context));if(Ot.length!==Ct.node.outputs.length)throw new Error("the size of output does not match model definition.");Ot.forEach((Ht,Kt)=>{let hr=Ct.node.outputs[Kt];if(this._values[hr])throw new Error(`output [${hr}] already has value: op:${Ct.node.name}`);this._values[hr]=Ht});let Nt=new Set;Ot.forEach((Ht,Kt)=>{let hr=Ct.node.outputs[Kt];for(let Qt of pt[hr].to){let mr=gt[Qt],br=!0;for(let Fr of mr.inputs)if(!this._values[Fr]){br=!1;break}br&&Nt.add(Qt)}}),mt.push(...Nt)}let wt=[];for(let vt=0;vt<this.graph.getOutputIndices().length;vt++){let Ct=this.graph.getOutputIndices()[vt],Rt=this._values[Ct];if(Rt===void 0)throw new Error(`required output [${Ct}] does not have value`);Ct===0?await Rt.getData():Rt.data,wt.push(Rt)}return z.verbose("ExecPlan","disposing of inferenceHandler"),lt.dispose(),wt})}}}),C,Dt,ar,Bf=x(()=>{je(),C=Ae(Le()),ye(),U(),Dt=P.experimental.fbs,ar=class Iy{constructor(_){if(this._attributes=new Map,_!=null){for(let lt of _)lt instanceof C.onnx.AttributeProto?this._attributes.set(lt.name,[Iy.getValue(lt),Iy.getType(lt)]):lt instanceof Dt.Attribute&&this._attributes.set(lt.name(),[Iy.getValue(lt),Iy.getType(lt)]);if(this._attributes.size<_.length)throw new Error("duplicated attribute names")}}set(_,lt,ft){this._attributes.set(_,[ft,lt])}delete(_){this._attributes.delete(_)}getFloat(_,lt){return this.get(_,"float",lt)}getInt(_,lt){return this.get(_,"int",lt)}getString(_,lt){return this.get(_,"string",lt)}getTensor(_,lt){return this.get(_,"tensor",lt)}getFloats(_,lt){return this.get(_,"floats",lt)}getInts(_,lt){return this.get(_,"ints",lt)}getStrings(_,lt){return this.get(_,"strings",lt)}getTensors(_,lt){return this.get(_,"tensors",lt)}get(_,lt,ft){let mt=this._attributes.get(_);if(mt===void 0){if(ft!==void 0)return ft;throw new Error(`required attribute not found: ${_}`)}if(mt[1]!==lt)throw new Error(`type mismatch: expected ${lt} but got ${mt[1]}`);return mt[0]}static getType(_){let lt=_ instanceof C.onnx.AttributeProto?_.type:_.type();switch(lt){case C.onnx.AttributeProto.AttributeType.FLOAT:return"float";case C.onnx.AttributeProto.AttributeType.INT:return"int";case C.onnx.AttributeProto.AttributeType.STRING:return"string";case C.onnx.AttributeProto.AttributeType.TENSOR:return"tensor";case C.onnx.AttributeProto.AttributeType.FLOATS:return"floats";case C.onnx.AttributeProto.AttributeType.INTS:return"ints";case C.onnx.AttributeProto.AttributeType.STRINGS:return"strings";case C.onnx.AttributeProto.AttributeType.TENSORS:return"tensors";default:throw new Error(`attribute type is not supported yet: ${C.onnx.AttributeProto.AttributeType[lt]}`)}}static getValue(_){let lt=_ instanceof C.onnx.AttributeProto?_.type:_.type();if(lt===C.onnx.AttributeProto.AttributeType.GRAPH||lt===C.onnx.AttributeProto.AttributeType.GRAPHS)throw new Error("graph attribute is not supported yet");let ft=this.getValueNoCheck(_);if(lt===C.onnx.AttributeProto.AttributeType.INT&&xt.isLong(ft))return xt.longToNumber(ft);if(lt===C.onnx.AttributeProto.AttributeType.INTS){let mt=ft,pt=new Array(mt.length);for(let gt=0;gt<mt.length;gt++){let bt=mt[gt];pt[gt]=xt.longToNumber(bt)}return pt}if(lt===C.onnx.AttributeProto.AttributeType.TENSOR)return _ instanceof C.onnx.AttributeProto?rt.fromProto(ft):rt.fromOrtTensor(ft);if(lt===C.onnx.AttributeProto.AttributeType.TENSORS){if(_ instanceof C.onnx.AttributeProto)return ft.map(mt=>rt.fromProto(mt));if(_ instanceof Dt.Attribute)return ft.map(mt=>rt.fromOrtTensor(mt))}return lt===C.onnx.AttributeProto.AttributeType.STRING&&_ instanceof C.onnx.AttributeProto?Ye(ft):lt===C.onnx.AttributeProto.AttributeType.STRINGS&&_ instanceof C.onnx.AttributeProto?ft.map(Ye):ft}static getValueNoCheck(_){return _ instanceof C.onnx.AttributeProto?this.getValueNoCheckFromOnnxFormat(_):this.getValueNoCheckFromOrtFormat(_)}static getValueNoCheckFromOnnxFormat(_){switch(_.type){case C.onnx.AttributeProto.AttributeType.FLOAT:return _.f;case C.onnx.AttributeProto.AttributeType.INT:return _.i;case C.onnx.AttributeProto.AttributeType.STRING:return _.s;case C.onnx.AttributeProto.AttributeType.TENSOR:return _.t;case C.onnx.AttributeProto.AttributeType.GRAPH:return _.g;case C.onnx.AttributeProto.AttributeType.FLOATS:return _.floats;case C.onnx.AttributeProto.AttributeType.INTS:return _.ints;case C.onnx.AttributeProto.AttributeType.STRINGS:return _.strings;case C.onnx.AttributeProto.AttributeType.TENSORS:return _.tensors;case C.onnx.AttributeProto.AttributeType.GRAPHS:return _.graphs;default:throw new Error(`unsupported attribute type: ${C.onnx.AttributeProto.AttributeType[_.type]}`)}}static getValueNoCheckFromOrtFormat(_){switch(_.type()){case Dt.AttributeType.FLOAT:return _.f();case Dt.AttributeType.INT:return _.i();case Dt.AttributeType.STRING:return _.s();case Dt.AttributeType.TENSOR:return _.t();case Dt.AttributeType.GRAPH:return _.g();case Dt.AttributeType.FLOATS:return _.floatsArray();case Dt.AttributeType.INTS:{let lt=[];for(let ft=0;ft<_.intsLength();ft++)lt.push(_.ints(ft));return lt}case Dt.AttributeType.STRINGS:{let lt=[];for(let ft=0;ft<_.stringsLength();ft++)lt.push(_.strings(ft));return lt}case Dt.AttributeType.TENSORS:{let lt=[];for(let ft=0;ft<_.tensorsLength();ft++)lt.push(_.tensors(ft));return lt}default:throw new Error(`unsupported attribute type: ${Dt.AttributeType[_.type()]}`)}}}}),zo,cn,Wo,Wt,pn,Uo,Ff=x(()=>{Bf(),je(),zo=Ae(Le()),ye(),U(),cn=P.experimental.fbs,Wo={from:(it,_)=>new Uo(it,_)},Wt=class{constructor(it){this._from=void 0,this._to=[],this.tensor=void 0,this.type=void 0,it&&(this.type=ut.tensorValueTypeFromProto(it.type.tensorType))}get from(){return this._from}get to(){return this._to}},pn=class{constructor(it,_){it instanceof zo.onnx.NodeProto?(this.name=it.name,this.opType=it.opType,this.attributes=new ar(it.attribute)):it instanceof cn.Node&&(this.name=_??it.name(),this.opType=it.opType(),this.attributes=new ar(ut.tensorAttributesFromORTFormat(it))),this.inputs=[],this.outputs=[],this.executeNode=!0}},Uo=class{constructor(it,_){if(!it)throw new TypeError("graph is empty");this.buildGraph(it),this.transformGraph(_),this.checkIsAcyclic()}getInputIndices(){return this._allInputIndices}getInputNames(){return this._allInputNames}getOutputIndices(){return this._allOutputIndices}getOutputNames(){return this._allOutputNames}getValues(){return this._allData}getNodes(){return this._nodes}buildGraph(it){if(it instanceof zo.onnx.GraphProto)this.buildGraphFromOnnxFormat(it);else if(it instanceof cn.Graph)this.buildGraphFromOrtFormat(it);else throw new TypeError("Graph type is not supported.")}buildGraphFromOnnxFormat(it){let _=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];let lt=new Map;if(!it.input)throw new Error("missing information in graph: input");let ft=[];for(let mt of it.input){if(_.has(mt.name))throw new Error(`duplicated input name: ${mt.name}`);let pt=this._allData.push(new Wt(mt))-1;_.set(mt.name,pt),ft.push(mt.name)}if(!it.initializer)throw new Error("missing information in graph: initializer");for(let mt of it.initializer){let pt=_.get(mt.name);if(pt===void 0){let gt=new Wt;gt.type={shape:{dims:ut.tensorDimsFromProto(mt.dims)},tensorType:ut.tensorDataTypeFromProto(mt.dataType)},pt=this._allData.push(gt)-1,_.set(mt.name,pt)}this._allData[pt]._from=-1,this._allData[pt].tensor=rt.fromProto(mt)}for(let mt=0;mt<this._allData.length;mt++)this._allData[mt].tensor||(this._allInputIndices.push(mt),this._allInputNames.push(ft[mt]));if(!it.output)throw new Error("missing information in graph: output");for(let mt of it.output){if(_.has(mt.name))throw new Error(`duplicated output name: ${mt.name}`);let pt=this._allData.push(new Wt(mt))-1;_.set(mt.name,pt),this._allOutputIndices.push(pt),this._allOutputNames.push(mt.name)}if(!it.node)throw new Error("missing information in graph: node");for(let mt of it.node){if(!mt.name)for(let gt=0;;gt++){let bt=`unnamed_${mt.opType}_${gt}`;if(!lt.has(bt)){mt.name=bt;break}}if(lt.has(mt.name))throw new Error(`duplicated node name: ${mt.name}`);let pt=this._nodes.push(new pn(mt))-1;lt.set(mt.name,pt)}for(let mt=0;mt<this._nodes.length;mt++){let pt=this._nodes[mt],gt=it.node[mt];if(!gt.output)throw new Error(`missing output for node: ${gt.name}`);for(let bt of gt.output){let wt=_.get(bt);if(typeof wt>"u"&&(wt=this._allData.push(new Wt)-1,_.set(bt,wt)),pt.outputs.push(wt),this._allData[wt]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${wt}`);if(this._allData[wt]._from=mt,gt.opType==="Constant"){if(!gt.attribute||gt.attribute.length!==1||!gt.attribute[0].t)throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(!gt.output||gt.output.length!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");pt.outputs.pop(),pt.executeNode=!1,this._allData[wt]._from=-1,this._allData[wt].tensor=rt.fromProto(gt.attribute[0].t)}}}for(let mt=0;mt<this._nodes.length;mt++){let pt=this._nodes[mt],gt=it.node[mt];if(!gt.input)throw new Error(`missing input for node: ${gt.name}`);for(let bt of gt.input){let wt=_.get(bt);if(typeof wt>"u"){if(bt===""&&(gt.input.length===3||gt.input.length===4)&&gt.opType==="Resize")continue;throw new Error(`unrecognized input '${bt}' for node: ${gt.name}`)}pt.inputs.push(wt),this._allData[wt]._to.push(mt)}}return!0}buildGraphFromOrtFormat(it){var mt,pt,gt;let _=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];let lt=new Map,ft=[];for(let bt=0;bt<it.inputsLength();bt++){let wt=it.inputs(bt);if(_.has(wt))throw new Error(`duplicated input name: ${wt}`);for(let vt=0;vt<it.nodeArgsLength();vt++)if(((mt=it.nodeArgs(vt))==null?void 0:mt.name())===wt){let Ct=new Wt;if(((gt=(pt=it.nodeArgs(vt))==null?void 0:pt.type())==null?void 0:gt.valueType())!==cn.TypeInfoValue.tensor_type)throw new Error("Unexpected value type for the nodeArg.");let Rt=it.nodeArgs(vt).type().value(new cn.TensorTypeAndShape),Mt=ut.tensorDataTypeFromProto(Rt.elemType()),Ot=Rt.shape(),Nt=[];for(let Kt=0;Kt<Ot.dimLength();Kt++)Nt.push(xt.longToNumber(Ot.dim(Kt).value().dimValue()));Ct.type={shape:{dims:Nt},tensorType:Mt};let Ht=this._allData.push(Ct)-1;_.set(wt,Ht),ft.push(wt)}}for(let bt=0;bt<it.initializersLength();bt++){let wt=it.initializers(bt),vt=_.get(wt.name());if(vt===void 0){let Ct=new Wt,Rt=ut.tensorDimsFromORTFormat(wt),Mt=ut.tensorDataTypeFromProto(wt.dataType());Ct.type={shape:{dims:Rt},tensorType:Mt},vt=this._allData.push(Ct)-1,_.set(wt.name(),vt)}this._allData[vt]._from=-1,this._allData[vt].tensor=rt.fromOrtTensor(wt)}for(let bt=0;bt<this._allData.length;bt++)this._allData[bt].tensor||(this._allInputIndices.push(bt),this._allInputNames.push(ft[bt]));for(let bt=0;bt<it.outputsLength();bt++){let wt=it.outputs(bt);if(_.has(wt))throw new Error(`duplicated output name: ${wt}`);let vt=this._allData.push(new Wt)-1;_.set(wt,vt),this._allOutputIndices.push(vt),this._allOutputNames.push(wt)}if(!it.nodes)throw new Error("missing information in graph: node");for(let bt=0;bt<it.nodesLength();bt++){let wt=it.nodes(bt),vt=wt.name();if(!vt)for(let Rt=0;vt=`unnamed_${wt.opType()}_${Rt}`,!!lt.has(vt);Rt++);if(lt.has(vt))throw new Error(`duplicated node name: ${vt}`);let Ct=this._nodes.push(new pn(wt,vt))-1;lt.set(vt,Ct)}for(let bt=0;bt<this._nodes.length;bt++){let wt=this._nodes[bt],vt=it.nodes(bt);if(vt==null)throw new Error(`No node exists at index ${bt}`);if((vt==null?void 0:vt.outputsLength())===0)throw new Error(`missing output for node: ${vt.name}`);for(let Ct=0;Ct<(vt==null?void 0:vt.outputsLength());Ct++){let Rt=vt==null?void 0:vt.outputs(Ct),Mt=_.get(Rt);if(typeof Mt>"u"&&(Mt=this._allData.push(new Wt)-1,_.set(Rt,Mt)),wt.outputs.push(Mt),this._allData[Mt]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${Mt}`);if(this._allData[Mt]._from=bt,vt.opType()==="Constant"){if(vt.attributesLength()!==1||!vt.attributes(0).t())throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(vt.outputsLength()!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");wt.outputs.pop(),wt.executeNode=!1,this._allData[Mt]._from=-1,this._allData[Mt].tensor=rt.fromOrtTensor(vt.attributes(0).t())}}}for(let bt=0;bt<this._nodes.length;bt++){let wt=this._nodes[bt],vt=it.nodes(bt);if(vt.inputsLength()===0)throw new Error(`missing input for node: ${vt.name}`);for(let Ct=0;Ct<vt.inputsLength();Ct++){let Rt=vt.inputs(Ct),Mt=_.get(Rt);if(typeof Mt>"u")throw new Error(`unrecognized input '${Rt}' for node: ${vt.name()}`);wt.inputs.push(Mt),this._allData[Mt]._to.push(bt)}}}checkIsAcyclic(){let it=new Set;this._allInputIndices.forEach(ft=>{this._allData[ft]._to.forEach(mt=>{it.add(mt)})});let _=Array.from(it),lt=new Array(this._nodes.length).fill("white");for(;_.length>0;){let ft=_.pop();lt[ft]==="gray"?lt[ft]="black":(_.push(ft),lt[ft]="gray",this._nodes[ft].outputs.forEach(mt=>{let pt=this._allData[mt];if(typeof pt.tensor<"u")throw new Error("node outputs should not be initialized");if(pt._from!==ft)throw new Error("from property of the Value object doesn't match index of Node being processed");pt._to.forEach(gt=>{if(lt[gt]==="gray")throw new Error("model graph is cyclic");lt[gt]==="white"&&_.push(gt)})}))}}transformGraph(it){this.removeAllIdentityNodes(),this.removeAllDropoutNodes(),this.fuseConvActivationNodes(),it&&it.transformGraph(this),this.finalizeGraph()}finalizeGraph(){let it=0,_=new Array(this._nodes.length,0),lt=0;for(let ft=0;ft<this._nodes.length;ft++)_[ft]=lt,this._nodes[ft].executeNode?(lt!==ft&&(this._nodes[lt]=this._nodes[ft]),lt++):this._nodes[ft].outputs.forEach(mt=>{this._allData[mt]._from=-2});this._nodes.splice(lt,this._nodes.length-lt);for(let ft=0;ft<this._allData.length;ft++){let mt=this._allData[ft];mt._from!==void 0&&mt._from!==-1&&mt._from!==-2&&(mt._from=_[mt._from]);for(let pt=0;pt<mt._to.length;pt++)if(mt._to[pt]>=0)mt._to[pt]=_[mt._to[pt]];else throw new Error("Trying to update a removed node")}it=0;for(let ft=0;ft<this._allData.length;ft++){if(this._allData[ft].from===-2&&this._allOutputIndices.indexOf(ft+it)===-1){it++,this._allData.splice(ft,1),ft--;continue}if(it>0){let mt=-1;this._allData[ft].from!==void 0&&this._allData[ft].from!==-1?(mt=this._nodes[this._allData[ft].from].outputs.indexOf(ft+it),mt!==-1&&(this._nodes[this._allData[ft].from].outputs[mt]=ft)):(mt=this._allInputIndices.indexOf(ft+it),mt!==-1&&(this._allInputIndices[mt]=ft)),this._allData[ft].to.forEach(pt=>{mt=this._nodes[pt].inputs.indexOf(ft+it),mt!==-1&&(this._nodes[pt].inputs[mt]=ft)}),this._allData[ft].to.length===0&&(mt=this._allOutputIndices.indexOf(ft+it),mt!==-1&&(this._allOutputIndices[mt]=ft))}}}deleteNode(it){let _=this._nodes[it];if(_.outputs.length>1){for(let gt=1;gt<_.outputs.length;gt++)if(this._allData[_.outputs[gt]].to.length>0)throw new Error("Node deletion with more than one output connected to other nodes is not supported. ")}_.executeNode=!1;let lt=_.inputs[0],ft=_.outputs[0],mt=this._allData[ft].to;for(let gt=0;gt<_.inputs.length;gt++){let bt=this._allData[_.inputs[gt]].to.indexOf(it);if(bt===-1)throw new Error("The Value object doesn't have the current Node in it's 'to' property ");this._allData[_.inputs[gt]].to.splice(bt,1)}this._allData[ft]._to=[];let pt=this._allOutputIndices.indexOf(ft);if(pt!==-1&&(this._allOutputIndices[pt]=lt),mt&&mt.length>0)for(let gt of mt){let bt=this._nodes[gt].inputs.indexOf(ft);if(bt===-1)throw new Error("The Node object doesn't have the output Value in it's 'inputs' property ");this._nodes[gt].inputs[bt]=lt,this._allData[lt].to.push(gt)}}removeAllDropoutNodes(){let it=0;for(let _ of this._nodes){if(_.opType==="Dropout"){if(_.inputs.length!==1)throw new Error("Dropout nodes should only contain one input. ");if(_.outputs.length!==1&&_.outputs.length!==2)throw new Error("Dropout nodes should contain either 1 or 2 output(s)");if(_.outputs.length===2&&this._allData[_.outputs[1]]._to.length!==0)throw new Error("Dropout nodes's second output should not be referenced by other nodes");this.deleteNode(it)}it++}}removeAllIdentityNodes(){let it=0;for(let _ of this._nodes)_.opType==="Identity"&&this.deleteNode(it),it++}isActivation(it){switch(it.opType){case"Relu":case"Sigmoid":case"Clip":return!0;default:return!1}}fuseConvActivationNodes(){for(let it of this._nodes)if(it.opType==="Conv"){let _=this._allData[it.outputs[0]]._to;if(_.length===1&&this.isActivation(this._nodes[_[0]])){let lt=this._nodes[_[0]];if(lt.opType==="Clip")if(lt.inputs.length===1)try{it.attributes.set("activation_params","floats",[lt.attributes.getFloat("min"),lt.attributes.getFloat("max")])}catch{it.attributes.set("activation_params","floats",[me,be])}else if(lt.inputs.length>=3&&this._allData[lt.inputs[1]].tensor!==void 0&&this._allData[lt.inputs[2]].tensor!==void 0)it.attributes.set("activation_params","floats",[this._allData[lt.inputs[1]].tensor.floatData[0],this._allData[lt.inputs[2]].tensor.floatData[0]]);else continue;it.attributes.set("activation","string",lt.opType),this.deleteNode(_[0])}}}}}),Nf,Yh,dn,Cf=x(()=>{$r(),Ff(),je(),Nf=Ae(Le()),U(),Yh=P.experimental.fbs,dn=class{constructor(){}load(it,_,lt){let ft;if(!lt)try{this.loadFromOnnxFormat(it,_);return}catch(mt){if(lt!==void 0)throw mt;ft=mt}try{this.loadFromOrtFormat(it,_)}catch(mt){throw lt!==void 0?mt:new Error(`Failed to load model as ONNX format: ${ft}
as ORT format: ${mt}`)}}loadFromOnnxFormat(it,_){let lt=Nf.onnx.ModelProto.decode(it);if(xt.longToNumber(lt.irVersion)<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=lt.opsetImport.map(ft=>({domain:ft.domain,version:xt.longToNumber(ft.version)})),this._graph=Wo.from(lt.graph,_)}loadFromOrtFormat(it,_){let lt=new b.ByteBuffer(it),ft=Yh.InferenceSession.getRootAsInferenceSession(lt).model();if(xt.longToNumber(ft.irVersion())<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=[];for(let mt=0;mt<ft.opsetImportLength();mt++){let pt=ft.opsetImport(mt);this._opsets.push({domain:pt==null?void 0:pt.domain(),version:xt.longToNumber(pt.version())})}this._graph=Wo.from(ft.graph(),_)}get graph(){return this._graph}get opsets(){return this._opsets}}}),hn,Rf=x(()=>{$f(),kf(),It(),Cf(),hn=class{constructor(it={}){this._initialized=!1,this.backendHint=it.backendHint,this.profiler=Dr.create(it.profiler),this.context={profiler:this.profiler,graphInputTypes:[],graphInputDims:[]}}get inputNames(){return this._model.graph.getInputNames()}get outputNames(){return this._model.graph.getOutputNames()}startProfiling(){this.profiler.start()}endProfiling(){this.profiler.stop()}async loadModel(it,_,lt){await this.profiler.event("session","Session.loadModel",async()=>{let ft=await Mo(this.backendHint);if(this.sessionHandler=ft.createSessionHandler(this.context),this._model=new dn,typeof it=="string"){let mt=it.endsWith(".ort");{let pt=await(await fetch(it)).arrayBuffer();this.initialize(new Uint8Array(pt),mt)}}else if(ArrayBuffer.isView(it))this.initialize(it);else{let mt=new Uint8Array(it,_||0,lt||it.byteLength);this.initialize(mt)}})}initialize(it,_){if(this._initialized)throw new Error("already initialized");this.profiler.event("session","Session.initialize",()=>{let lt=this.sessionHandler.transformGraph?this.sessionHandler:void 0;this._model.load(it,lt,_),this.sessionHandler.onGraphInitialized&&this.sessionHandler.onGraphInitialized(this._model.graph),this.initializeOps(this._model.graph),this._executionPlan=new fn(this._model.graph,this._ops,this.profiler)}),this._initialized=!0}async run(it){if(!this._initialized)throw new Error("session not initialized yet");return this.profiler.event("session","Session.run",async()=>{let _=this.normalizeAndValidateInputs(it),lt=await this._executionPlan.execute(this.sessionHandler,_);return this.createOutput(lt)})}normalizeAndValidateInputs(it){let _=this._model.graph.getInputNames();if(Array.isArray(it)){if(it.length!==_.length)throw new Error(`incorrect input array length: expected ${_.length} but got ${it.length}`)}else{if(it.size!==_.length)throw new Error(`incorrect input map size: expected ${_.length} but got ${it.size}`);let lt=new Array(it.size),ft=0;for(let mt=0;mt<_.length;++mt){let pt=it.get(_[mt]);if(!pt)throw new Error(`missing input tensor for: '${name}'`);lt[ft++]=pt}it=lt}if(!this.context.graphInputTypes||this.context.graphInputTypes.length===0||!this.context.graphInputDims||this.context.graphInputDims.length===0){let lt=this._model.graph.getInputIndices(),ft=this._model.graph.getValues(),mt=new Array(lt.length);for(let pt=0;pt<lt.length;++pt){let gt=ft[lt[pt]];mt[pt]=gt.type.shape.dims,this.context.graphInputTypes.push(gt.type.tensorType),this.context.graphInputDims.push(it[pt].dims)}this.validateInputTensorDims(mt,it,!0)}else this.validateInputTensorDims(this.context.graphInputDims,it,!1);return this.validateInputTensorTypes(this.context.graphInputTypes,it),it}validateInputTensorTypes(it,_){for(let lt=0;lt<_.length;lt++){let ft=it[lt],mt=_[lt].type;if(ft!==mt)throw new Error(`input tensor[${lt}] check failed: expected type '${ft}' but got ${mt}`)}}validateInputTensorDims(it,_,lt){for(let ft=0;ft<_.length;ft++){let mt=it[ft],pt=_[ft].dims;if(!this.compareTensorDims(mt,pt,lt))throw new Error(`input tensor[${ft}] check failed: expected shape '[${mt.join(",")}]' but got [${pt.join(",")}]`)}}compareTensorDims(it,_,lt){if(it.length!==_.length)return!1;for(let ft=0;ft<it.length;++ft)if(it[ft]!==_[ft]&&(!lt||it[ft]!==0))return!1;return!0}createOutput(it){let _=this._model.graph.getOutputNames();if(it.length!==_.length)throw new Error("expected number of outputs do not match number of generated outputs");let lt=new Map;for(let ft=0;ft<_.length;++ft)lt.set(_[ft],it[ft]);return lt}initializeOps(it){let _=it.getNodes();this._ops=new Array(_.length);for(let lt=0;lt<_.length;lt++)this._ops[lt]=this.sessionHandler.resolve(_[lt],this._model.opsets,it)}}}),mn,Gf=x(()=>{kt(),ye(),mn=class{constructor(it){this.session=it,this.inputNames=this.session.inputNames,this.outputNames=this.session.outputNames}async dispose(){}async run(it,_,lt){let ft=new Map;for(let gt in it)if(Object.hasOwnProperty.call(it,gt)){let bt=it[gt];ft.set(gt,new rt(bt.dims,bt.type,void 0,void 0,bt.data))}let mt=await this.session.run(ft),pt={};return mt.forEach((gt,bt)=>{pt[bt]=new et(gt.type,gt.data,gt.dims)}),pt}startProfiling(){this.session.startProfiling()}endProfiling(){this.session.endProfiling()}}}),Mf={};We(Mf,{onnxjsBackend:()=>Qh});var Ho,Qh,Vf=x(()=>{Rf(),Gf(),Ho=class{async init(){}async createInferenceSessionHandler(it,_){let lt=new hn(_);return typeof it=="string"?await lt.loadModel(it):await lt.loadModel(it),new mn(lt)}},Qh=new Ho}),bn=x(()=>{}),Wf={};We(Wf,{default:()=>tm});var Uf,zf,tm,Hf=x(()=>{var it;qo(),ve(),sr(),Uf="ort-wasm-proxy-worker",zf=((it=globalThis.self)==null?void 0:it.name)===Uf,zf&&(self.onmessage=_=>{let{type:lt,in:ft}=_.data;try{switch(lt){case"init-wasm":yn(ft.wasm).then(()=>{gn(ft).then(()=>{postMessage({type:lt})},mt=>{postMessage({type:lt,err:mt})})},mt=>{postMessage({type:lt,err:mt})});break;case"init-ep":{let{epName:mt,env:pt}=ft;xn(pt,mt).then(()=>{postMessage({type:lt})},gt=>{postMessage({type:lt,err:gt})});break}case"copy-from":{let{buffer:mt}=ft,pt=ur(mt);postMessage({type:lt,out:pt});break}case"create":{let{model:mt,options:pt}=ft;Tn(mt,pt).then(gt=>{postMessage({type:lt,out:gt})},gt=>{postMessage({type:lt,err:gt})});break}case"release":wn(ft),postMessage({type:lt});break;case"run":{let{sessionId:mt,inputIndices:pt,inputs:gt,outputIndices:bt,options:wt}=ft;vn(mt,pt,gt,bt,new Array(bt.length).fill(null),wt).then(vt=>{vt.some(Ct=>Ct[3]!=="cpu")?postMessage({type:lt,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:lt,out:vt},_n([...gt,...vt]))},vt=>{postMessage({type:lt,err:vt})});break}case"end-profiling":In(ft),postMessage({type:lt});break;default:}}catch(mt){postMessage({type:lt,err:mt})}}),tm=zf?null:_=>new Worker(_??Lt,{type:"classic",name:Uf})}),Lt,em,jf,rm,nm,Xf,om,qf,Kf,Jf,sr=x(()=>{var it,_;bn(),Lt=typeof document<"u"?(it=document.currentScript)==null?void 0:it.src:typeof self<"u"?(_=self.location)==null?void 0:_.href:void 0,em=typeof location>"u"?void 0:location.origin,jf=(lt,ft)=>{try{let mt=ft??Lt;return(mt?new URL(lt,mt):new URL(lt)).origin===em}catch{return!1}},rm=(lt,ft)=>{let mt=ft??Lt;try{return(mt?new URL(lt,mt):new URL(lt)).href}catch{return}},nm=(lt,ft)=>`${ft??"./"}${lt}`,Xf=async lt=>{let ft=await(await fetch(lt,{credentials:"same-origin"})).blob();return URL.createObjectURL(ft)},om=async lt=>(await import(lt)).default,qf=(Hf(),gr(Wf)).default,Kf=async()=>{if(!Lt)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(jf(Lt))return[void 0,qf()];let lt=await Xf(Lt);return[lt,qf(lt)]},Jf=async(lt,ft,mt)=>{{let pt="ort-wasm-simd-threaded.mjs",gt=lt??rm(pt,ft),bt=mt&&gt&&!jf(gt,ft),wt=bt?await Xf(gt):gt??nm(pt,ft);return[bt?wt:void 0,await om(wt)]}}}),jo,Xo,Sn,Zf,im,am,yn,nt,ve=x(()=>{sr(),Xo=!1,Sn=!1,Zf=!1,im=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},am=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},yn=async it=>{if(Xo)return Promise.resolve();if(Sn)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Zf)throw new Error("previous call to 'initializeWebAssembly()' failed.");Sn=!0;let _=it.initTimeout,lt=it.numThreads;if(!am())throw new Error("WebAssembly SIMD is not supported in the current environment.");let ft=im();lt>1&&!ft&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+lt+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),it.numThreads=lt=1);let mt=it.wasmPaths,pt=typeof mt=="string"?mt:void 0,gt=mt==null?void 0:mt.mjs,bt=(gt==null?void 0:gt.href)??gt,wt=mt==null?void 0:mt.wasm,vt=(wt==null?void 0:wt.href)??wt,Ct=it.wasmBinary,[Rt,Mt]=await Jf(bt,pt,lt>1),Ot=!1,Nt=[];if(_>0&&Nt.push(new Promise(Ht=>{setTimeout(()=>{Ot=!0,Ht()},_)})),Nt.push(new Promise((Ht,Kt)=>{let hr={numThreads:lt};Ct?hr.wasmBinary=Ct:(vt||pt)&&(hr.locateFile=(Qt,mr)=>vt??(pt??mr)+Qt),Mt(hr).then(Qt=>{Sn=!1,Xo=!0,jo=Qt,Ht(),Rt&&URL.revokeObjectURL(Rt)},Qt=>{Sn=!1,Zf=!0,Kt(Qt)})})),await Promise.race(Nt),Ot)throw new Error(`WebAssembly backend initializing failed due to timeout: ${_}ms`)},nt=()=>{if(Xo&&jo)return jo;throw new Error("WebAssembly is not initialized yet.")}}),ot,lr,Y,On=x(()=>{ve(),ot=(it,_)=>{let lt=nt(),ft=lt.lengthBytesUTF8(it)+1,mt=lt._malloc(ft);return lt.stringToUTF8(it,mt,ft),_.push(mt),mt},lr=(it,_,lt,ft)=>{if(typeof it=="object"&&it!==null){if(lt.has(it))throw new Error("Circular reference in options");lt.add(it)}Object.entries(it).forEach(([mt,pt])=>{let gt=_?_+mt:mt;if(typeof pt=="object")lr(pt,gt+".",lt,ft);else if(typeof pt=="string"||typeof pt=="number")ft(gt,pt.toString());else if(typeof pt=="boolean")ft(gt,pt?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof pt}`)})},Y=it=>{let _=nt(),lt=_.stackSave();try{let ft=_.stackAlloc(8);_._OrtGetLastError(ft,ft+4);let mt=_.HEAP32[ft/4],pt=_.HEAPU32[ft/4+1],gt=pt?_.UTF8ToString(pt):"";throw new Error(`${it} ERROR_CODE: ${mt}, ERROR_MESSAGE: ${gt}`)}finally{_.stackRestore(lt)}}}),Yf,Qf=x(()=>{ve(),On(),Yf=it=>{let _=nt(),lt=0,ft=[],mt=it||{};try{if((it==null?void 0:it.logSeverityLevel)===void 0)mt.logSeverityLevel=2;else if(typeof it.logSeverityLevel!="number"||!Number.isInteger(it.logSeverityLevel)||it.logSeverityLevel<0||it.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${it.logSeverityLevel}`);if((it==null?void 0:it.logVerbosityLevel)===void 0)mt.logVerbosityLevel=0;else if(typeof it.logVerbosityLevel!="number"||!Number.isInteger(it.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${it.logVerbosityLevel}`);(it==null?void 0:it.terminate)===void 0&&(mt.terminate=!1);let pt=0;return(it==null?void 0:it.tag)!==void 0&&(pt=ot(it.tag,ft)),lt=_._OrtCreateRunOptions(mt.logSeverityLevel,mt.logVerbosityLevel,!!mt.terminate,pt),lt===0&&Y("Can't create run options."),(it==null?void 0:it.extra)!==void 0&&lr(it.extra,"",new WeakSet,(gt,bt)=>{let wt=ot(gt,ft),vt=ot(bt,ft);_._OrtAddRunConfigEntry(lt,wt,vt)!==0&&Y(`Can't set a run config entry: ${gt} - ${bt}.`)}),[lt,ft]}catch(pt){throw lt!==0&&_._OrtReleaseRunOptions(lt),ft.forEach(gt=>_._free(gt)),pt}}}),sm,um,lm,fm,tc,ec=x(()=>{ve(),On(),sm=it=>{switch(it){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${it}`)}},um=it=>{switch(it){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${it}`)}},lm=it=>{it.extra||(it.extra={}),it.extra.session||(it.extra.session={});let _=it.extra.session;_.use_ort_model_bytes_directly||(_.use_ort_model_bytes_directly="1"),it.executionProviders&&it.executionProviders.some(lt=>(typeof lt=="string"?lt:lt.name)==="webgpu")&&(it.enableMemPattern=!1)},fm=(it,_,lt)=>{for(let ft of _){let mt=typeof ft=="string"?ft:ft.name;switch(mt){case"webnn":if(mt="WEBNN",typeof ft!="string"){let gt=ft==null?void 0:ft.deviceType;if(gt){let bt=ot("deviceType",lt),wt=ot(gt,lt);nt()._OrtAddSessionConfigEntry(it,bt,wt)!==0&&Y(`Can't set a session config entry: 'deviceType' - ${gt}.`)}}break;case"webgpu":if(mt="JS",typeof ft!="string"){let gt=ft;if(gt!=null&&gt.preferredLayout){if(gt.preferredLayout!=="NCHW"&&gt.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${gt.preferredLayout}`);let bt=ot("preferredLayout",lt),wt=ot(gt.preferredLayout,lt);nt()._OrtAddSessionConfigEntry(it,bt,wt)!==0&&Y(`Can't set a session config entry: 'preferredLayout' - ${gt.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${mt}`)}let pt=ot(mt,lt);nt()._OrtAppendExecutionProvider(it,pt)!==0&&Y(`Can't append execution provider: ${mt}.`)}},tc=it=>{let _=nt(),lt=0,ft=[],mt=it||{};lm(mt);try{let pt=sm(mt.graphOptimizationLevel??"all"),gt=um(mt.executionMode??"sequential"),bt=typeof mt.logId=="string"?ot(mt.logId,ft):0,wt=mt.logSeverityLevel??2;if(!Number.isInteger(wt)||wt<0||wt>4)throw new Error(`log serverity level is not valid: ${wt}`);let vt=mt.logVerbosityLevel??0;if(!Number.isInteger(vt)||vt<0||vt>4)throw new Error(`log verbosity level is not valid: ${vt}`);let Ct=typeof mt.optimizedModelFilePath=="string"?ot(mt.optimizedModelFilePath,ft):0;if(lt=_._OrtCreateSessionOptions(pt,!!mt.enableCpuMemArena,!!mt.enableMemPattern,gt,!!mt.enableProfiling,0,bt,wt,vt,Ct),lt===0&&Y("Can't create session options."),mt.executionProviders&&fm(lt,mt.executionProviders,ft),mt.enableGraphCapture!==void 0){if(typeof mt.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${mt.enableGraphCapture}`);let Rt=ot("enableGraphCapture",ft),Mt=ot(mt.enableGraphCapture.toString(),ft);_._OrtAddSessionConfigEntry(lt,Rt,Mt)!==0&&Y(`Can't set a session config entry: 'enableGraphCapture' - ${mt.enableGraphCapture}.`)}if(mt.freeDimensionOverrides)for(let[Rt,Mt]of Object.entries(mt.freeDimensionOverrides)){if(typeof Rt!="string")throw new Error(`free dimension override name must be a string: ${Rt}`);if(typeof Mt!="number"||!Number.isInteger(Mt)||Mt<0)throw new Error(`free dimension override value must be a non-negative integer: ${Mt}`);let Ot=ot(Rt,ft);_._OrtAddFreeDimensionOverride(lt,Ot,Mt)!==0&&Y(`Can't set a free dimension override: ${Rt} - ${Mt}.`)}return mt.extra!==void 0&&lr(mt.extra,"",new WeakSet,(Rt,Mt)=>{let Ot=ot(Rt,ft),Nt=ot(Mt,ft);_._OrtAddSessionConfigEntry(lt,Ot,Nt)!==0&&Y(`Can't set a session config entry: ${Rt} - ${Mt}.`)}),[lt,ft]}catch(pt){throw lt!==0&&_._OrtReleaseSessionOptions(lt),ft.forEach(gt=>_._free(gt)),pt}}}),fr,rc,cr,nc,oc,An,Pn,ic,Ko=x(()=>{fr=it=>{switch(it){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${it}`)}},rc=it=>{switch(it){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${it}`)}},cr=(it,_)=>{let lt=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][it],ft=typeof _=="number"?_:_.reduce((mt,pt)=>mt*pt,1);return lt>0?Math.ceil(ft*lt):void 0},nc=it=>{switch(it){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${it}`)}},oc=it=>{switch(it){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${it}`)}},An=it=>it==="float32"||it==="float16"||it==="int32"||it==="int64"||it==="uint32"||it==="uint8"||it==="bool"||it==="uint4"||it==="int4",Pn=it=>it==="float32"||it==="float16"||it==="int32"||it==="int64"||it==="uint32"||it==="uint64"||it==="int8"||it==="uint8"||it==="bool",ic=it=>{switch(it){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${it}`)}}}),pr,Jo=x(()=>{bn(),pr=async it=>{if(typeof it=="string"){let _=await fetch(it);if(!_.ok)throw new Error(`failed to load external data file: ${it}`);let lt=_.headers.get("Content-Length"),ft=lt?parseInt(lt,10):0;if(ft<1073741824)return new Uint8Array(await _.arrayBuffer());{if(!_.body)throw new Error(`failed to load external data file: ${it}, no response body.`);let mt=_.body.getReader(),pt;try{pt=new ArrayBuffer(ft)}catch(bt){if(bt instanceof RangeError){let wt=Math.ceil(ft/65536);pt=new WebAssembly.Memory({initial:wt,maximum:wt}).buffer}else throw bt}let gt=0;for(;;){let{done:bt,value:wt}=await mt.read();if(bt)break;let vt=wt.byteLength;new Uint8Array(pt,gt,vt).set(wt),gt+=vt}return new Uint8Array(pt,0,ft)}}else return it instanceof Blob?new Uint8Array(await it.arrayBuffer()):it instanceof Uint8Array?it:new Uint8Array(it)}}),cm,gn,xn,Me,pm,ur,Tn,wn,ac,vn,In,_n,qo=x(()=>{Qf(),ec(),Ko(),ve(),On(),Jo(),cm=(it,_)=>{nt()._OrtInit(it,_)!==0&&Y("Can't initialize onnxruntime.")},gn=async it=>{cm(it.wasm.numThreads,oc(it.logLevel))},xn=async(it,_)=>{},Me=new Map,pm=it=>{let _=nt(),lt=_.stackSave();try{let ft=_.stackAlloc(8);return _._OrtGetInputOutputCount(it,ft,ft+4)!==0&&Y("Can't get session input/output count."),[_.HEAP32[ft/4],_.HEAP32[ft/4+1]]}finally{_.stackRestore(lt)}},ur=it=>{let _=nt(),lt=_._malloc(it.byteLength);if(lt===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${it.byteLength}.`);return _.HEAPU8.set(it,lt),[lt,it.byteLength]},Tn=async(it,_)=>{var Ct;let lt,ft,mt=nt();Array.isArray(it)?[lt,ft]=it:it.buffer===mt.HEAPU8.buffer?[lt,ft]=[it.byteOffset,it.byteLength]:[lt,ft]=ur(it);let pt=0,gt=0,bt=[],wt=[],vt=[];try{if([gt,bt]=tc(_),(_==null?void 0:_.externalData)&&mt.mountExternalData){let Qt=[];for(let mr of _.externalData){let br=typeof mr=="string"?mr:mr.path;Qt.push(pr(typeof mr=="string"?mr:mr.data).then(Fr=>{mt.mountExternalData(br,Fr)}))}await Promise.all(Qt)}for(let Qt of(_==null?void 0:_.executionProviders)??[])if((typeof Qt=="string"?Qt:Qt.name)==="webnn"){if(mt.shouldTransferToMLTensor=!1,mt.currentContext)throw new Error("WebNN execution provider is already set.");if(typeof Qt!="string"){let mr=Qt,br=mr==null?void 0:mr.context,Fr=mr==null?void 0:mr.gpuDevice,kr=mr==null?void 0:mr.deviceType,Br=mr==null?void 0:mr.numThreads,Nr=mr==null?void 0:mr.powerPreference;br?mt.currentContext=br:Fr?mt.currentContext=await navigator.ml.createContext(Fr):mt.currentContext=await navigator.ml.createContext({deviceType:kr,numThreads:Br,powerPreference:Nr})}else mt.currentContext=await navigator.ml.createContext();break}pt=await mt._OrtCreateSession(lt,ft,gt),pt===0&&Y("Can't create a session."),mt.currentContext&&(mt.jsepRegisterMLContext(pt,mt.currentContext),mt.currentContext=void 0,mt.shouldTransferToMLTensor=!0);let[Rt,Mt]=pm(pt),Ot=!!(_!=null&&_.enableGraphCapture),Nt=[],Ht=[],Kt=[];for(let Qt=0;Qt<Rt;Qt++){let mr=mt._OrtGetInputName(pt,Qt);mr===0&&Y("Can't get an input name."),wt.push(mr),Nt.push(mt.UTF8ToString(mr))}for(let Qt=0;Qt<Mt;Qt++){let mr=mt._OrtGetOutputName(pt,Qt);mr===0&&Y("Can't get an output name."),vt.push(mr);let br=mt.UTF8ToString(mr);Ht.push(br)}return Me.set(pt,[pt,wt,vt,null,Ot,!1]),[pt,Nt,Ht]}catch(Rt){throw wt.forEach(Mt=>mt._OrtFree(Mt)),vt.forEach(Mt=>mt._OrtFree(Mt)),pt!==0&&mt._OrtReleaseSession(pt),Rt}finally{mt._free(lt),gt!==0&&mt._OrtReleaseSessionOptions(gt),bt.forEach(Rt=>mt._free(Rt)),(Ct=mt.unmountExternalData)==null||Ct.call(mt)}},wn=it=>{var wt;let _=nt(),lt=Me.get(it);if(!lt)throw new Error(`cannot release session. invalid session id: ${it}`);let[ft,mt,pt,gt,bt]=lt;gt&&(bt&&_._OrtClearBoundOutputs(gt.handle),_._OrtReleaseBinding(gt.handle)),(wt=_.jsepOnReleaseSession)==null||wt.call(_,it),mt.forEach(vt=>_._OrtFree(vt)),pt.forEach(vt=>_._OrtFree(vt)),_._OrtReleaseSession(ft),Me.delete(it)},ac=(it,_,lt,ft,mt,pt=!1)=>{if(!it){_.push(0);return}let gt=nt(),bt=it[0],wt=it[1],vt=it[3],Ct,Rt;if(bt==="string"&&(vt==="gpu-buffer"||vt==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(pt&&vt!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${mt} when enableGraphCapture is true.`);if(vt==="gpu-buffer"){let Nt=it[2].gpuBuffer;Rt=cr(fr(bt),wt);let Ht=gt.jsepRegisterBuffer;if(!Ht)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');Ct=Ht(ft,mt,Nt,Rt)}else if(vt==="ml-tensor"){let Nt=it[2].mlTensor;Rt=cr(fr(bt),wt);let Ht=gt.jsepRegisterMLTensor;if(!Ht)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');Ct=Ht(Nt,fr(bt),wt)}else{let Nt=it[2];if(Array.isArray(Nt)){Rt=4*Nt.length,Ct=gt._malloc(Rt),lt.push(Ct);let Ht=Ct/4;for(let Kt=0;Kt<Nt.length;Kt++){if(typeof Nt[Kt]!="string")throw new TypeError(`tensor data at index ${Kt} is not a string`);gt.HEAPU32[Ht++]=ot(Nt[Kt],lt)}}else Rt=Nt.byteLength,Ct=gt._malloc(Rt),lt.push(Ct),gt.HEAPU8.set(new Uint8Array(Nt.buffer,Nt.byteOffset,Rt),Ct)}let Mt=gt.stackSave(),Ot=gt.stackAlloc(4*wt.length);try{let Nt=Ot/4;wt.forEach(Kt=>gt.HEAP32[Nt++]=Kt);let Ht=gt._OrtCreateTensor(fr(bt),Ct,Rt,Ot,wt.length,ic(vt));Ht===0&&Y(`Can't create tensor for input/output. session=${ft}, index=${mt}.`),_.push(Ht)}finally{gt.stackRestore(Mt)}},vn=async(it,_,lt,ft,mt,pt)=>{var jn;let gt=nt(),bt=Me.get(it);if(!bt)throw new Error(`cannot run inference. invalid session id: ${it}`);let wt=bt[0],vt=bt[1],Ct=bt[2],Rt=bt[3],Mt=bt[4];bt[5];let Ot=_.length,Nt=ft.length,Ht=0,Kt=[],hr=[],Qt=[],mr=[],br=gt.stackSave(),Fr=gt.stackAlloc(Ot*4),kr=gt.stackAlloc(Ot*4),Br=gt.stackAlloc(Nt*4),Nr=gt.stackAlloc(Nt*4);try{(jn=gt.jsepOnRunStart)==null||jn.call(gt,wt),[Ht,Kt]=Yf(pt);for(let $a=0;$a<Ot;$a++)ac(lt[$a],hr,mr,it,_[$a],Mt);for(let $a=0;$a<Nt;$a++)ac(mt[$a],Qt,mr,it,Ot+ft[$a],Mt);let Yn=Fr/4,ga=kr/4,Kn=Br/4,Xn=Nr/4;for(let $a=0;$a<Ot;$a++)gt.HEAPU32[Yn++]=hr[$a],gt.HEAPU32[ga++]=vt[_[$a]];for(let $a=0;$a<Nt;$a++)gt.HEAPU32[Kn++]=Qt[$a],gt.HEAPU32[Xn++]=Ct[ft[$a]];let eo;eo=await gt._OrtRun(wt,kr,Fr,Ot,Nr,Nt,Br,Ht),eo!==0&&Y("failed to call OrtRun().");let lp=[];for(let $a=0;$a<Nt;$a++){let ro=gt.HEAPU32[Br/4+$a];if(ro===Qt[$a]){lp.push(mt[$a]);continue}let bs=gt.stackSave(),ba=gt.stackAlloc(4*4),Zn=!1,Qn,ip=0;try{gt._OrtGetTensorData(ro,ba,ba+4,ba+8,ba+12)!==0&&Y(`Can't access output tensor data on index ${$a}.`);let Sm=ba/4,Pm=gt.HEAPU32[Sm++];ip=gt.HEAPU32[Sm++];let Cm=gt.HEAPU32[Sm++],Im=gt.HEAPU32[Sm++],Rm=[];for(let Mm=0;Mm<Im;Mm++)Rm.push(gt.HEAPU32[Cm/4+Mm]);gt._OrtFree(Cm);let Nm=Rm.reduce((Mm,Tm)=>Mm*Tm,1);Qn=rc(Pm);let Vm=Rt==null?void 0:Rt.outputPreferredLocations[ft[$a]];if(Qn==="string"){if(Vm==="gpu-buffer"||Vm==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Mm=[],Tm=ip/4;for(let Om=0;Om<Nm;Om++){let $m=gt.HEAPU32[Tm++],Xm=Om===Nm-1?void 0:gt.HEAPU32[Tm]-$m;Mm.push(gt.UTF8ToString($m,Xm))}lp.push([Qn,Rm,Mm,"cpu"])}else if(Vm==="gpu-buffer"&&Nm>0){let Mm=gt.jsepGetBuffer;if(!Mm)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Tm=Mm(ip),Om=cr(Pm,Nm);if(Om===void 0||!An(Qn))throw new Error(`Unsupported data type: ${Qn}`);Zn=!0,lp.push([Qn,Rm,{gpuBuffer:Tm,download:gt.jsepCreateDownloader(Tm,Om,Qn),dispose:()=>{gt._OrtReleaseTensor(ro)}},"gpu-buffer"])}else if(Vm==="ml-tensor"&&Nm>0){let Mm=gt.jsepEnsureTensor;if(!Mm)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(cr(Pm,Nm)===void 0||!Pn(Qn))throw new Error(`Unsupported data type: ${Qn}`);let Tm=await Mm(ip,Pm,Rm,!1);Zn=!0,lp.push([Qn,Rm,{mlTensor:Tm,download:gt.jsepCreateMLTensorDownloader(ip,Qn),dispose:()=>{gt.jsepReleaseTensorId(ip),gt._OrtReleaseTensor(ro)}},"ml-tensor"])}else{let Mm=nc(Qn),Tm=new Mm(Nm);new Uint8Array(Tm.buffer,Tm.byteOffset,Tm.byteLength).set(gt.HEAPU8.subarray(ip,ip+Tm.byteLength)),lp.push([Qn,Rm,Tm,"cpu"])}}finally{gt.stackRestore(bs),Qn==="string"&&ip&&gt._free(ip),Zn||gt._OrtReleaseTensor(ro)}}return Rt&&!Mt&&(gt._OrtClearBoundOutputs(Rt.handle),Me.set(it,[wt,vt,Ct,Rt,Mt,!1])),lp}finally{gt.stackRestore(br),hr.forEach(Yn=>gt._OrtReleaseTensor(Yn)),Qt.forEach(Yn=>gt._OrtReleaseTensor(Yn)),mr.forEach(Yn=>gt._free(Yn)),Ht!==0&&gt._OrtReleaseRunOptions(Ht),Kt.forEach(Yn=>gt._free(Yn))}},In=it=>{let _=nt(),lt=Me.get(it);if(!lt)throw new Error("invalid session id");let ft=lt[0],mt=_._OrtEndProfiling(ft);mt===0&&Y("Can't get an profile file name."),_._OrtFree(mt)},_n=it=>{let _=[];for(let lt of it){let ft=lt[2];!Array.isArray(ft)&&"buffer"in ft&&_.push(ft.buffer)}return _}}),_e,$t,dr,Dn,Ln,En,Zo,Yo,Ve,Ue,hm,sc,uc,lc,fc,cc,pc,dc,Qo=x(()=>{kt(),qo(),ve(),sr(),_e=()=>!!$.wasm.proxy&&typeof document<"u",dr=!1,Dn=!1,Ln=!1,Yo=new Map,Ve=(it,_)=>{let lt=Yo.get(it);lt?lt.push(_):Yo.set(it,[_])},Ue=()=>{if(dr||!Dn||Ln||!$t)throw new Error("worker not ready")},hm=it=>{switch(it.data.type){case"init-wasm":dr=!1,it.data.err?(Ln=!0,Zo[1](it.data.err)):(Dn=!0,Zo[0]()),En&&(URL.revokeObjectURL(En),En=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let _=Yo.get(it.data.type);it.data.err?_.shift()[1](it.data.err):_.shift()[0](it.data.out);break}}},sc=async()=>{if(!Dn){if(dr)throw new Error("multiple calls to 'initWasm()' detected.");if(Ln)throw new Error("previous call to 'initWasm()' failed.");if(dr=!0,_e())return new Promise((it,_)=>{$t==null||$t.terminate(),Kf().then(([lt,ft])=>{try{$t=ft,$t.onerror=pt=>_(pt),$t.onmessage=hm,Zo=[it,_];let mt={type:"init-wasm",in:$};$t.postMessage(mt),En=lt}catch(mt){_(mt)}},_)});try{await yn($.wasm),await gn($),Dn=!0}catch(it){throw Ln=!0,it}finally{dr=!1}}},uc=async it=>{if(_e())return Ue(),new Promise((_,lt)=>{Ve("init-ep",[_,lt]);let ft={type:"init-ep",in:{epName:it,env:$}};$t.postMessage(ft)});await xn($,it)},lc=async it=>_e()?(Ue(),new Promise((_,lt)=>{Ve("copy-from",[_,lt]);let ft={type:"copy-from",in:{buffer:it}};$t.postMessage(ft,[it.buffer])})):ur(it),fc=async(it,_)=>{if(_e()){if(_!=null&&_.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Ue(),new Promise((lt,ft)=>{Ve("create",[lt,ft]);let mt={type:"create",in:{model:it,options:{..._}}},pt=[];it instanceof Uint8Array&&pt.push(it.buffer),$t.postMessage(mt,pt)})}else return Tn(it,_)},cc=async it=>{if(_e())return Ue(),new Promise((_,lt)=>{Ve("release",[_,lt]);let ft={type:"release",in:it};$t.postMessage(ft)});wn(it)},pc=async(it,_,lt,ft,mt,pt)=>{if(_e()){if(lt.some(gt=>gt[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(mt.some(gt=>gt))throw new Error("pre-allocated output tensor is not supported for proxy.");return Ue(),new Promise((gt,bt)=>{Ve("run",[gt,bt]);let wt=lt,vt={type:"run",in:{sessionId:it,inputIndices:_,inputs:wt,outputIndices:ft,options:pt}};$t.postMessage(vt,_n(wt))})}else return vn(it,_,lt,ft,mt,pt)},dc=async it=>{if(_e())return Ue(),new Promise((_,lt)=>{Ve("end-profiling",[_,lt]);let ft={type:"end-profiling",in:it};$t.postMessage(ft)});In(it)}}),hc,mm,$n,mc=x(()=>{kt(),Qo(),Ko(),bn(),Jo(),hc=(it,_)=>{switch(it.location){case"cpu":return[it.type,it.dims,it.data,"cpu"];case"gpu-buffer":return[it.type,it.dims,{gpuBuffer:it.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[it.type,it.dims,{mlTensor:it.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${it.location} for ${_()}`)}},mm=it=>{switch(it[3]){case"cpu":return new et(it[0],it[2],it[1]);case"gpu-buffer":{let _=it[0];if(!An(_))throw new Error(`not supported data type: ${_} for deserializing GPU tensor`);let{gpuBuffer:lt,download:ft,dispose:mt}=it[2];return et.fromGpuBuffer(lt,{dataType:_,dims:it[1],download:ft,dispose:mt})}case"ml-tensor":{let _=it[0];if(!Pn(_))throw new Error(`not supported data type: ${_} for deserializing MLTensor tensor`);let{mlTensor:lt,download:ft,dispose:mt}=it[2];return et.fromMLTensor(lt,{dataType:_,dims:it[1],download:ft,dispose:mt})}default:throw new Error(`invalid data location: ${it[3]}`)}},$n=class{async fetchModelAndCopyToWasmMemory(it){return lc(await pr(it))}async loadModel(it,_){Jt();let lt;typeof it=="string"?lt=await this.fetchModelAndCopyToWasmMemory(it):lt=it,[this.sessionId,this.inputNames,this.outputNames]=await fc(lt,_),Zt()}async dispose(){return cc(this.sessionId)}async run(it,_,lt){Jt();let ft=[],mt=[];Object.entries(it).forEach(Rt=>{let Mt=Rt[0],Ot=Rt[1],Nt=this.inputNames.indexOf(Mt);if(Nt===-1)throw new Error(`invalid input '${Mt}'`);ft.push(Ot),mt.push(Nt)});let pt=[],gt=[];Object.entries(_).forEach(Rt=>{let Mt=Rt[0],Ot=Rt[1],Nt=this.outputNames.indexOf(Mt);if(Nt===-1)throw new Error(`invalid output '${Mt}'`);pt.push(Ot),gt.push(Nt)});let bt=ft.map((Rt,Mt)=>hc(Rt,()=>`input "${this.inputNames[mt[Mt]]}"`)),wt=pt.map((Rt,Mt)=>Rt?hc(Rt,()=>`output "${this.outputNames[gt[Mt]]}"`):null),vt=await pc(this.sessionId,mt,bt,gt,wt,lt),Ct={};for(let Rt=0;Rt<vt.length;Rt++)Ct[this.outputNames[gt[Rt]]]=pt[Rt]??mm(vt[Rt]);return Zt(),Ct}startProfiling(){}endProfiling(){dc(this.sessionId)}}}),yc={};We(yc,{OnnxruntimeWebAssemblyBackend:()=>kn,initializeFlags:()=>bc,wasmBackend:()=>bm});var bc,kn,bm,gc=x(()=>{kt(),Qo(),mc(),sr(),bc=()=>{if((typeof $.wasm.initTimeout!="number"||$.wasm.initTimeout<0)&&($.wasm.initTimeout=0),$.wasm.simd===!1&&console.warn('Deprecated property "env.wasm.simd" is set to false. non-SIMD build is no longer provided, and this setting will be ignored.'),typeof $.wasm.proxy!="boolean"&&($.wasm.proxy=!1),typeof $.wasm.trace!="boolean"&&($.wasm.trace=!1),typeof $.wasm.numThreads!="number"||!Number.isInteger($.wasm.numThreads)||$.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)$.wasm.numThreads=1;else{let it=typeof navigator>"u"?Bn("node:os").cpus().length:navigator.hardwareConcurrency;$.wasm.numThreads=Math.min(4,Math.ceil((it||1)/2))}$.wasm.wasmPaths===void 0&&Lt&&Lt.indexOf("blob:")!==0&&($.wasm.wasmPaths=Lt.substring(0,Lt.lastIndexOf("/")+1))},kn=class{async init(it){bc(),await sc(),await uc(it)}async createInferenceSessionHandler(it,_){let lt=new $n;return await lt.loadModel(it,_),Promise.resolve(lt)}},bm=new kn}),gm={};We(gm,{InferenceSession:()=>Ai,TRACE:()=>Cn,TRACE_FUNC_BEGIN:()=>Jt,TRACE_FUNC_END:()=>Zt,Tensor:()=>et,TrainingSession:()=>Bi,default:()=>ym,env:()=>$,registerBackend:()=>ue}),kt(),kt(),kt();var Ni="1.20.0",ym=Gn;{let it=(Vf(),gr(Mf)).onnxjsBackend;ue("webgl",it,-10)}{let it=(gc(),gr(yc)).wasmBackend;ue("cpu",it,10),ue("wasm",it,10)}return Object.defineProperty($.versions,"web",{value:Ni,enumerable:!0}),gr(gm)})();/*! Bundled license information:

	long/index.js:
	  (**
	   * @license
	   * Copyright 2009 The Closure Library Authors
	   * Copyright 2020 Daniel Wirtz / The long.js Authors.
	   *
	   * Licensed under the Apache License, Version 2.0 (the "License");
	   * you may not use this file except in compliance with the License.
	   * You may obtain a copy of the License at
	   *
	   *     http://www.apache.org/licenses/LICENSE-2.0
	   *
	   * Unless required by applicable law or agreed to in writing, software
	   * distributed under the License is distributed on an "AS IS" BASIS,
	   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	   * See the License for the specific language governing permissions and
	   * limitations under the License.
	   *
	   * SPDX-License-Identifier: Apache-2.0
	   *)
	*/module.exports=ort})(ort_min);var ort_minExports=ort_min.exports,assetPath$1={};Object.defineProperty(assetPath$1,"__esModule",{value:!0});assetPath$1.assetPath=void 0;const isWeb=typeof window<"u"&&typeof window.document<"u",currentScript=isWeb?window.document.currentScript:null;let basePath="/";currentScript&&(basePath=currentScript.src.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"));const assetPath=it=>basePath+it;assetPath$1.assetPath=assetPath;var defaultModelFetcher$1={};Object.defineProperty(defaultModelFetcher$1,"__esModule",{value:!0});defaultModelFetcher$1.defaultModelFetcher=void 0;const defaultModelFetcher=it=>fetch(it).then(_=>_.arrayBuffer());defaultModelFetcher$1.defaultModelFetcher=defaultModelFetcher;var frameProcessor={},logging={};(function(it){Object.defineProperty(it,"__esModule",{value:!0}),it.log=it.LOG_PREFIX=void 0,it.LOG_PREFIX="[VAD]";const _=["error","debug","warn"];function lt(mt){return(...pt)=>{console[mt](it.LOG_PREFIX,...pt)}}const ft=_.reduce((mt,pt)=>(mt[pt]=lt(pt),mt),{});it.log=ft})(logging);var messages={};Object.defineProperty(messages,"__esModule",{value:!0});messages.Message=void 0;var Message;(function(it){it.AudioFrame="AUDIO_FRAME",it.SpeechStart="SPEECH_START",it.VADMisfire="VAD_MISFIRE",it.SpeechEnd="SPEECH_END",it.SpeechStop="SPEECH_STOP"})(Message||(messages.Message=Message={}));Object.defineProperty(frameProcessor,"__esModule",{value:!0});frameProcessor.FrameProcessor=frameProcessor.validateOptions=frameProcessor.defaultFrameProcessorOptions=void 0;const logging_1$2=logging,messages_1=messages,RECOMMENDED_FRAME_SAMPLES=[512,1024,1536];frameProcessor.defaultFrameProcessorOptions={positiveSpeechThreshold:.5,negativeSpeechThreshold:.5-.15,preSpeechPadFrames:1,redemptionFrames:8,frameSamples:1536,minSpeechFrames:3,submitUserSpeechOnPause:!1};function validateOptions(it){RECOMMENDED_FRAME_SAMPLES.includes(it.frameSamples)||logging_1$2.log.warn("You are using an unusual frame size"),(it.positiveSpeechThreshold<0||it.positiveSpeechThreshold>1)&&logging_1$2.log.error("positiveSpeechThreshold should be a number between 0 and 1"),(it.negativeSpeechThreshold<0||it.negativeSpeechThreshold>it.positiveSpeechThreshold)&&logging_1$2.log.error("negativeSpeechThreshold should be between 0 and positiveSpeechThreshold"),it.preSpeechPadFrames<0&&logging_1$2.log.error("preSpeechPadFrames should be positive"),it.redemptionFrames<0&&logging_1$2.log.error("redemptionFrames should be positive")}frameProcessor.validateOptions=validateOptions;const concatArrays=it=>{const _=it.reduce((ft,mt)=>(ft.push(ft.at(-1)+mt.length),ft),[0]),lt=new Float32Array(_.at(-1));return it.forEach((ft,mt)=>{const pt=_[mt];lt.set(ft,pt)}),lt};class FrameProcessor{constructor(_,lt,ft){this.modelProcessFunc=_,this.modelResetFunc=lt,this.options=ft,this.speaking=!1,this.redemptionCounter=0,this.active=!1,this.reset=()=>{this.speaking=!1,this.audioBuffer=[],this.modelResetFunc(),this.redemptionCounter=0},this.pause=()=>(this.active=!1,this.options.submitUserSpeechOnPause?this.endSegment():(this.reset(),{})),this.resume=()=>{this.active=!0},this.endSegment=()=>{const mt=this.audioBuffer;this.audioBuffer=[];const pt=this.speaking;this.reset();const gt=mt.reduce((bt,wt)=>bt+ +wt.isSpeech,0);if(pt)if(gt>=this.options.minSpeechFrames){const bt=concatArrays(mt.map(wt=>wt.frame));return{msg:messages_1.Message.SpeechEnd,audio:bt}}else return{msg:messages_1.Message.VADMisfire};return{}},this.process=async mt=>{if(!this.active)return{};const pt=await this.modelProcessFunc(mt);if(this.audioBuffer.push({frame:mt,isSpeech:pt.isSpeech>=this.options.positiveSpeechThreshold}),pt.isSpeech>=this.options.positiveSpeechThreshold&&this.redemptionCounter&&(this.redemptionCounter=0),pt.isSpeech>=this.options.positiveSpeechThreshold&&!this.speaking)return this.speaking=!0,{probs:pt,msg:messages_1.Message.SpeechStart,frame:mt};if(pt.isSpeech<this.options.negativeSpeechThreshold&&this.speaking&&++this.redemptionCounter>=this.options.redemptionFrames){this.redemptionCounter=0,this.speaking=!1;const gt=this.audioBuffer;if(this.audioBuffer=[],gt.reduce((wt,vt)=>wt+ +vt.isSpeech,0)>=this.options.minSpeechFrames){const wt=concatArrays(gt.map(vt=>vt.frame));return{probs:pt,msg:messages_1.Message.SpeechEnd,audio:wt,frame:mt}}else return{probs:pt,msg:messages_1.Message.VADMisfire,frame:mt}}if(!this.speaking)for(;this.audioBuffer.length>this.options.preSpeechPadFrames;)this.audioBuffer.shift();return{probs:pt,frame:mt}},this.audioBuffer=[],this.reset()}}frameProcessor.FrameProcessor=FrameProcessor;var nonRealTimeVad={},models={},_a;Object.defineProperty(models,"__esModule",{value:!0});models.Silero=void 0;const logging_1$1=logging;class Silero{constructor(_,lt){this.ort=_,this.modelFetcher=lt,this.init=async()=>{logging_1$1.log.debug("initializing vad");const ft=await this.modelFetcher();this._session=await this.ort.InferenceSession.create(ft),this._sr=new this.ort.Tensor("int64",[16000n]),this.reset_state(),logging_1$1.log.debug("vad is initialized")},this.reset_state=()=>{const ft=Array(128).fill(0);this._h=new this.ort.Tensor("float32",ft,[2,1,64]),this._c=new this.ort.Tensor("float32",ft,[2,1,64])},this.process=async ft=>{const pt={input:new this.ort.Tensor("float32",ft,[1,ft.length]),h:this._h,c:this._c,sr:this._sr},gt=await this._session.run(pt);this._h=gt.hn,this._c=gt.cn;const[bt]=gt.output.data;return{notSpeech:1-bt,isSpeech:bt}}}}models.Silero=Silero;_a=Silero;Silero.new=async(it,_)=>{const lt=new _a(it,_);return await lt.init(),lt};var resampler={};Object.defineProperty(resampler,"__esModule",{value:!0});resampler.Resampler=void 0;const logging_1=logging;class Resampler{constructor(_){this.options=_,this.process=lt=>{const ft=[];for(const mt of lt)for(this.inputBuffer.push(mt);this.hasEnoughDataForFrame();){const pt=this.generateOutputFrame();ft.push(pt)}return ft},this.stream=async function*(lt){for(const ft of lt)for(this.inputBuffer.push(ft);this.hasEnoughDataForFrame();)yield this.generateOutputFrame()},_.nativeSampleRate<16e3&&logging_1.log.error("nativeSampleRate is too low. Should have 16000 = targetSampleRate <= nativeSampleRate"),this.inputBuffer=[]}hasEnoughDataForFrame(){return this.inputBuffer.length*this.options.targetSampleRate/this.options.nativeSampleRate>=this.options.targetFrameSize}generateOutputFrame(){const _=new Float32Array(this.options.targetFrameSize);let lt=0,ft=0;for(;lt<this.options.targetFrameSize;){let mt=0,pt=0;for(;ft<Math.min(this.inputBuffer.length,(lt+1)*this.options.nativeSampleRate/this.options.targetSampleRate);){const gt=this.inputBuffer[ft];gt!==void 0&&(mt+=gt,pt++),ft++}_[lt]=mt/pt,lt++}return this.inputBuffer=this.inputBuffer.slice(ft),_}}resampler.Resampler=Resampler;(function(it){Object.defineProperty(it,"__esModule",{value:!0}),it.PlatformAgnosticNonRealTimeVAD=it.defaultNonRealTimeVADOptions=void 0;const _=frameProcessor,lt=messages,ft=models,mt=resampler;it.defaultNonRealTimeVADOptions={..._.defaultFrameProcessorOptions,ortConfig:void 0};class pt{static async _new(bt,wt,vt={}){const Ct={...it.defaultNonRealTimeVADOptions,...vt};Ct.ortConfig!==void 0&&Ct.ortConfig(wt);const Rt=new this(bt,wt,Ct);return await Rt.init(),Rt}constructor(bt,wt,vt){this.modelFetcher=bt,this.ort=wt,this.options=vt,this.init=async()=>{const Ct=await ft.Silero.new(this.ort,this.modelFetcher);this.frameProcessor=new _.FrameProcessor(Ct.process,Ct.reset_state,{frameSamples:this.options.frameSamples,positiveSpeechThreshold:this.options.positiveSpeechThreshold,negativeSpeechThreshold:this.options.negativeSpeechThreshold,redemptionFrames:this.options.redemptionFrames,preSpeechPadFrames:this.options.preSpeechPadFrames,minSpeechFrames:this.options.minSpeechFrames,submitUserSpeechOnPause:this.options.submitUserSpeechOnPause}),this.frameProcessor.resume()},this.run=async function*(Ct,Rt){const Mt={nativeSampleRate:Rt,targetSampleRate:16e3,targetFrameSize:this.options.frameSamples},Ot=new mt.Resampler(Mt);let Nt=0,Ht=0,Kt=0;for await(const mr of Ot.stream(Ct)){const{msg:br,audio:Fr}=await this.frameProcessor.process(mr);switch(br){case lt.Message.SpeechStart:Nt=Kt*this.options.frameSamples/16;break;case lt.Message.SpeechEnd:Ht=(Kt+1)*this.options.frameSamples/16,yield{audio:Fr,start:Nt,end:Ht};break}Kt++}const{msg:hr,audio:Qt}=this.frameProcessor.endSegment();hr==lt.Message.SpeechEnd&&(yield{audio:Qt,start:Nt,end:Kt*this.options.frameSamples/16})},(0,_.validateOptions)(vt)}}it.PlatformAgnosticNonRealTimeVAD=pt})(nonRealTimeVad);var utils={};Object.defineProperty(utils,"__esModule",{value:!0});utils.audioFileToArray=utils.encodeWAV=utils.arrayBufferToBase64=utils.minFramesForTargetMS=void 0;function minFramesForTargetMS(it,_,lt=16e3){return Math.ceil(it*lt/1e3/_)}utils.minFramesForTargetMS=minFramesForTargetMS;function arrayBufferToBase64(it){const _=new Uint8Array(it),lt=_.byteLength,ft=new Array(lt);for(var mt=0;mt<lt;mt++){const pt=_[mt];if(pt===void 0)break;ft[mt]=String.fromCharCode(pt)}return btoa(ft.join(""))}utils.arrayBufferToBase64=arrayBufferToBase64;function encodeWAV(it,_=3,lt=16e3,ft=1,mt=32){var pt=mt/8,gt=ft*pt,bt=new ArrayBuffer(44+it.length*pt),wt=new DataView(bt);return writeString(wt,0,"RIFF"),wt.setUint32(4,36+it.length*pt,!0),writeString(wt,8,"WAVE"),writeString(wt,12,"fmt "),wt.setUint32(16,16,!0),wt.setUint16(20,_,!0),wt.setUint16(22,ft,!0),wt.setUint32(24,lt,!0),wt.setUint32(28,lt*gt,!0),wt.setUint16(32,gt,!0),wt.setUint16(34,mt,!0),writeString(wt,36,"data"),wt.setUint32(40,it.length*pt,!0),_===1?floatTo16BitPCM(wt,44,it):writeFloat32(wt,44,it),bt}utils.encodeWAV=encodeWAV;function writeFloat32(it,_,lt){for(var ft=0;ft<lt.length;ft++,_+=4)it.setFloat32(_,lt[ft],!0)}function floatTo16BitPCM(it,_,lt){for(var ft=0;ft<lt.length;ft++,_+=2){var mt=Math.max(-1,Math.min(1,lt[ft]));it.setInt16(_,mt<0?mt*32768:mt*32767,!0)}}function writeString(it,_,lt){for(var ft=0;ft<lt.length;ft++)it.setUint8(_+ft,lt.charCodeAt(ft))}async function audioFileToArray(it){const _=new OfflineAudioContext(1,1,44100),lt=new FileReader;let ft=null;if(await new Promise(gt=>{lt.addEventListener("loadend",bt=>{const wt=lt.result;_.decodeAudioData(wt,vt=>{ft=vt,_.startRendering().then(Ct=>{console.log("Rendering completed successfully"),gt()}).catch(Ct=>{console.error(`Rendering failed: ${Ct}`)})},vt=>{console.log(`Error with decoding audio data: ${vt}`)})}),lt.readAsArrayBuffer(it)}),ft===null)throw Error("some shit");let mt=ft,pt=new Float32Array(mt.length);for(let gt=0;gt<mt.length;gt++)for(let bt=0;bt<mt.numberOfChannels;bt++)pt[gt]+=mt.getChannelData(bt)[gt];return{audio:pt,sampleRate:mt.sampleRate}}utils.audioFileToArray=audioFileToArray;var realTimeVad={};(function(it){var _=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Ot,Nt,Ht,Kt){Kt===void 0&&(Kt=Ht);var hr=Object.getOwnPropertyDescriptor(Nt,Ht);(!hr||("get"in hr?!Nt.__esModule:hr.writable||hr.configurable))&&(hr={enumerable:!0,get:function(){return Nt[Ht]}}),Object.defineProperty(Ot,Kt,hr)}:function(Ot,Nt,Ht,Kt){Kt===void 0&&(Kt=Ht),Ot[Kt]=Nt[Ht]}),lt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(Ot,Nt){Object.defineProperty(Ot,"default",{enumerable:!0,value:Nt})}:function(Ot,Nt){Ot.default=Nt}),ft=commonjsGlobal&&commonjsGlobal.__importStar||function(Ot){if(Ot&&Ot.__esModule)return Ot;var Nt={};if(Ot!=null)for(var Ht in Ot)Ht!=="default"&&Object.prototype.hasOwnProperty.call(Ot,Ht)&&_(Nt,Ot,Ht);return lt(Nt,Ot),Nt};Object.defineProperty(it,"__esModule",{value:!0}),it.AudioNodeVAD=it.MicVAD=it.defaultRealTimeVADOptions=it.ort=void 0;const mt=ft(ort_minExports),pt=assetPath$1,gt=defaultModelFetcher$1,bt=frameProcessor,wt=logging,vt=messages,Ct=models;it.ort=mt,it.defaultRealTimeVADOptions={...bt.defaultFrameProcessorOptions,onFrameProcessed:Ot=>{},onVADMisfire:()=>{wt.log.debug("VAD misfire")},onSpeechStart:()=>{wt.log.debug("Detected speech start")},onSpeechEnd:()=>{wt.log.debug("Detected speech end")},workletURL:(0,pt.assetPath)("vad.worklet.bundle.min.js"),modelURL:(0,pt.assetPath)("silero_vad.onnx"),modelFetcher:gt.defaultModelFetcher,stream:void 0,ortConfig:void 0,workletOptions:{processorOptions:{frameSamples:bt.defaultFrameProcessorOptions.frameSamples}}};class Rt{static async new(Nt={}){const Ht={...it.defaultRealTimeVADOptions,...Nt};(0,bt.validateOptions)(Ht);let Kt;Ht.stream===void 0?Kt=await navigator.mediaDevices.getUserMedia({audio:{...Ht.additionalAudioConstraints,channelCount:1,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}}):Kt=Ht.stream;const hr=new AudioContext,Qt=new MediaStreamAudioSourceNode(hr,{mediaStream:Kt}),mr=await Mt.new(hr,Ht);return mr.receive(Qt),new Rt(Ht,hr,Kt,mr,Qt)}constructor(Nt,Ht,Kt,hr,Qt,mr=!1){this.options=Nt,this.audioContext=Ht,this.stream=Kt,this.audioNodeVAD=hr,this.sourceNode=Qt,this.listening=mr,this.pause=()=>{this.audioNodeVAD.pause(),this.listening=!1},this.start=()=>{this.audioNodeVAD.start(),this.listening=!0},this.destroy=()=>{this.listening&&this.pause(),this.options.stream===void 0&&this.stream.getTracks().forEach(br=>br.stop()),this.sourceNode.disconnect(),this.audioNodeVAD.destroy(),this.audioContext.close()}}}it.MicVAD=Rt;class Mt{static async new(Nt,Ht={}){const Kt={...it.defaultRealTimeVADOptions,...Ht};(0,bt.validateOptions)(Kt),Kt.ortConfig!==void 0&&Kt.ortConfig(it.ort);try{await Nt.audioWorklet.addModule(Kt.workletURL)}catch(Fr){throw console.error(`Encountered an error while loading worklet. Please make sure the worklet vad.bundle.min.js included with @ricky0123/vad-web is available at the specified path:
        ${Kt.workletURL}
        If need be, you can customize the worklet file location using the \`workletURL\` option.`),Fr}const hr=new AudioWorkletNode(Nt,"vad-helper-worklet",Kt.workletOptions);let Qt;try{Qt=await Ct.Silero.new(it.ort,()=>Kt.modelFetcher(Kt.modelURL))}catch(Fr){throw console.error(`Encountered an error while loading model file. Please make sure silero_vad.onnx, included with @ricky0123/vad-web, is available at the specified path:
      ${Kt.modelURL}
      If need be, you can customize the model file location using the \`modelURL\` option.`),Fr}const mr=new bt.FrameProcessor(Qt.process,Qt.reset_state,{frameSamples:Kt.frameSamples,positiveSpeechThreshold:Kt.positiveSpeechThreshold,negativeSpeechThreshold:Kt.negativeSpeechThreshold,redemptionFrames:Kt.redemptionFrames,preSpeechPadFrames:Kt.preSpeechPadFrames,minSpeechFrames:Kt.minSpeechFrames,submitUserSpeechOnPause:Kt.submitUserSpeechOnPause}),br=new Mt(Nt,Kt,mr,hr);return hr.port.onmessage=async Fr=>{var kr;switch((kr=Fr.data)==null?void 0:kr.message){case vt.Message.AudioFrame:let Br=Fr.data.data;Br instanceof ArrayBuffer||(Br=new ArrayBuffer(Fr.data.data.byteLength),new Uint8Array(Br).set(new Uint8Array(Fr.data.data)));const Nr=new Float32Array(Br);await br.processFrame(Nr);break}},br}constructor(Nt,Ht,Kt,hr){this.ctx=Nt,this.options=Ht,this.frameProcessor=Kt,this.entryNode=hr,this.pause=()=>{const Qt=this.frameProcessor.pause();this.handleFrameProcessorEvent(Qt)},this.start=()=>{this.frameProcessor.resume()},this.receive=Qt=>{Qt.connect(this.entryNode)},this.processFrame=async Qt=>{const mr=await this.frameProcessor.process(Qt);this.handleFrameProcessorEvent(mr)},this.handleFrameProcessorEvent=Qt=>{switch(Qt.probs!==void 0&&this.options.onFrameProcessed(Qt.probs,Qt.frame),Qt.msg){case vt.Message.SpeechStart:this.options.onSpeechStart();break;case vt.Message.VADMisfire:this.options.onVADMisfire();break;case vt.Message.SpeechEnd:this.options.onSpeechEnd(Qt.audio);break}},this.destroy=()=>{this.entryNode.port.postMessage({message:vt.Message.SpeechStop}),this.entryNode.disconnect()}}}it.AudioNodeVAD=Mt})(realTimeVad);(function(it){var _=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Ot,Nt,Ht,Kt){Kt===void 0&&(Kt=Ht);var hr=Object.getOwnPropertyDescriptor(Nt,Ht);(!hr||("get"in hr?!Nt.__esModule:hr.writable||hr.configurable))&&(hr={enumerable:!0,get:function(){return Nt[Ht]}}),Object.defineProperty(Ot,Kt,hr)}:function(Ot,Nt,Ht,Kt){Kt===void 0&&(Kt=Ht),Ot[Kt]=Nt[Ht]}),lt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(Ot,Nt){Object.defineProperty(Ot,"default",{enumerable:!0,value:Nt})}:function(Ot,Nt){Ot.default=Nt}),ft=commonjsGlobal&&commonjsGlobal.__importStar||function(Ot){if(Ot&&Ot.__esModule)return Ot;var Nt={};if(Ot!=null)for(var Ht in Ot)Ht!=="default"&&Object.prototype.hasOwnProperty.call(Ot,Ht)&&_(Nt,Ot,Ht);return lt(Nt,Ot),Nt};Object.defineProperty(it,"__esModule",{value:!0}),it.NonRealTimeVAD=it.Message=it.FrameProcessor=it.defaultRealTimeVADOptions=it.MicVAD=it.AudioNodeVAD=it.utils=it.defaultNonRealTimeVADOptions=void 0;const mt=ft(ort_minExports),pt=assetPath$1,gt=defaultModelFetcher$1,bt=frameProcessor;Object.defineProperty(it,"FrameProcessor",{enumerable:!0,get:function(){return bt.FrameProcessor}});const wt=messages;Object.defineProperty(it,"Message",{enumerable:!0,get:function(){return wt.Message}});const vt=nonRealTimeVad,Ct=utils;it.defaultNonRealTimeVADOptions={modelURL:(0,pt.assetPath)("silero_vad.onnx"),modelFetcher:gt.defaultModelFetcher};class Rt extends vt.PlatformAgnosticNonRealTimeVAD{static async new(Nt={}){const{modelURL:Ht,modelFetcher:Kt}={...it.defaultNonRealTimeVADOptions,...Nt};return await this._new(()=>Kt(Ht),mt,Nt)}}it.NonRealTimeVAD=Rt,it.utils={audioFileToArray:Ct.audioFileToArray,minFramesForTargetMS:Ct.minFramesForTargetMS,arrayBufferToBase64:Ct.arrayBufferToBase64,encodeWAV:Ct.encodeWAV};var Mt=realTimeVad;Object.defineProperty(it,"AudioNodeVAD",{enumerable:!0,get:function(){return Mt.AudioNodeVAD}}),Object.defineProperty(it,"MicVAD",{enumerable:!0,get:function(){return Mt.MicVAD}}),Object.defineProperty(it,"defaultRealTimeVADOptions",{enumerable:!0,get:function(){return Mt.defaultRealTimeVADOptions}})})(dist);(function(it){var _=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Ht,Kt,hr,Qt){Qt===void 0&&(Qt=hr);var mr=Object.getOwnPropertyDescriptor(Kt,hr);(!mr||("get"in mr?!Kt.__esModule:mr.writable||mr.configurable))&&(mr={enumerable:!0,get:function(){return Kt[hr]}}),Object.defineProperty(Ht,Qt,mr)}:function(Ht,Kt,hr,Qt){Qt===void 0&&(Qt=hr),Ht[Qt]=Kt[hr]}),lt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(Ht,Kt){Object.defineProperty(Ht,"default",{enumerable:!0,value:Kt})}:function(Ht,Kt){Ht.default=Kt}),ft=commonjsGlobal&&commonjsGlobal.__importStar||function(Ht){if(Ht&&Ht.__esModule)return Ht;var Kt={};if(Ht!=null)for(var hr in Ht)hr!=="default"&&Object.prototype.hasOwnProperty.call(Ht,hr)&&_(Kt,Ht,hr);return lt(Kt,Ht),Kt};Object.defineProperty(it,"__esModule",{value:!0}),it.useMicVAD=it.defaultReactRealTimeVADOptions=it.utils=void 0;const mt=dist,pt=ft(reactExports);var gt=dist;Object.defineProperty(it,"utils",{enumerable:!0,get:function(){return gt.utils}});const bt={startOnLoad:!0,userSpeakingThreshold:.6};it.defaultReactRealTimeVADOptions={...mt.defaultRealTimeVADOptions,...bt};const wt=Object.keys(bt),vt=Object.keys(mt.defaultRealTimeVADOptions),Ct=(Ht,Kt)=>Ht.reduce((hr,Qt)=>(hr[Qt]=Kt[Qt],hr),{});function Rt(Ht){Ht={...it.defaultReactRealTimeVADOptions,...Ht};const Kt=Ct(wt,Ht),hr=Ct(vt,Ht);return[Kt,hr]}function Mt(Ht){const Kt=pt.default.useRef(Ht);return Nt(()=>{Kt.current=Ht}),pt.default.useCallback((...hr)=>Kt.current.apply(void 0,hr),[])}function Ot(Ht){const[Kt,hr]=Rt(Ht),[Qt,mr]=(0,pt.useReducer)((ip,Sm)=>Sm>Kt.userSpeakingThreshold,!1),[br,Fr]=(0,pt.useState)(!0),[kr,Br]=(0,pt.useState)(!1),[Nr,jn]=(0,pt.useState)(!1),[Yn,ga]=(0,pt.useState)(null),Kn=Mt(hr.onFrameProcessed);hr.onFrameProcessed=Mt((ip,Sm)=>{mr(ip.isSpeech),Kn(ip,Sm)});const{onSpeechEnd:Xn,onSpeechStart:eo,onVADMisfire:lp}=hr,$a=Mt(Xn),ro=Mt(eo),bs=Mt(lp);hr.onSpeechEnd=$a,hr.onSpeechStart=ro,hr.onVADMisfire=bs,(0,pt.useEffect)(()=>{let ip,Sm=!1;return(async()=>{try{if(ip=await mt.MicVAD.new(hr),Sm){ip.destroy();return}}catch(Cm){Fr(!1),Cm instanceof Error?Br({message:Cm.message}):Br({message:Cm});return}ga(ip),Fr(!1),Kt.startOnLoad&&(ip==null||ip.start(),jn(!0))})().catch(Cm=>{console.log("Well that didn't work")}),function(){ip==null||ip.destroy(),Sm=!0,!br&&!kr&&jn(!1)}},[]);const ba=()=>{!br&&!kr&&(Yn==null||Yn.pause(),jn(!1))},Zn=()=>{!br&&!kr&&(Yn==null||Yn.start(),jn(!0))};return{listening:Nr,errored:kr,loading:br,userSpeaking:Qt,pause:ba,start:Zn,toggle:()=>{Nr?ba():Zn()}}}it.useMicVAD=Ot;const Nt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?pt.default.useLayoutEffect:pt.default.useEffect})(dist$1);const MicContext=reactExports.createContext({toggleAudio:()=>{},onSpeechEndFunctions:{current:[]},isMicOn:!1}),MicProvider=({children:it})=>{const{subdomain:_}=reactExports.useContext(SubdomainContext),[lt,ft]=reactExports.useState(!1),[mt,pt]=reactExports.useState(null),gt=reactExports.useRef([]),bt=async()=>{if(lt)mt&&(mt.getTracks().forEach(wt=>(mt.removeTrack(wt),wt.stop())),pt(null)),ft(!1);else try{const wt=await navigator.mediaDevices.getUserMedia({audio:!0});pt(wt),ft(!0)}catch(wt){console.error("Mikrofon ama hatas:",wt)}};return reactExports.useEffect(()=>{if(_&&!mt){async function wt(){try{const vt=await navigator.mediaDevices.getUserMedia({audio:!0});pt(vt),ft(!0)}catch(vt){console.error("Mikrofon ama hatas:",vt)}}wt()}},[_]),jsxRuntimeExports.jsxs(MicContext.Provider,{value:{toggleAudio:bt,onSpeechEndFunctions:gt,isMicOn:lt},children:[mt&&jsxRuntimeExports.jsx(VadProvider,{stream:mt,isMicOn:lt,onSpeechEndFunctions:gt}),it]})},VadProvider=({stream:it,isMicOn:_,onSpeechEndFunctions:lt})=>{const{val:ft,isReady:mt}=reactExports.useContext(WebSocketContext),pt=dist$1.useMicVAD({preSpeechPadFrames:10,minSpeechFrames:10,negativeSpeechThreshold:.2,positiveSpeechThreshold:.5,redemptionFrames:5,ortConfig:gt=>{gt.env.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.19.0/dist/"},workletURL:"https://cdn.jsdelivr.net/npm/@ricky0123/vad-web@0.0.18/dist/vad.worklet.bundle.min.js",modelURL:"https://cdn.jsdelivr.net/npm/@ricky0123/vad-web@0.0.18/dist/silero_vad.onnx",startOnLoad:!0,onSpeechEnd:gt=>{console.log("User stopped talking"),lt.current.length>0&&lt.current.forEach(bt=>bt(gt)),pt.pause()},stream:it});return reactExports.useEffect(()=>{_?pt.start():pt.pause()},[_]),reactExports.useEffect(()=>{if(mt&&ft){const gt=JSON.parse(ft);gt.type==="control"&&gt.text==="conversation-chain-end"&&pt.start()}},[ft,mt]),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})},model_info={name:"shizuku-local",description:"Orange-Haired Girl, locally available. no internet required.",url:"/live2d-models/shizuku/shizuku.model.json",kScale:.001725,kXOffset:1150,idleMotionGroupName:"Idle",emotionMap:{neutral:0,anger:2,disgust:2,fear:1,joy:3,smirk:3,sadness:1,surprise:3}};function isMobile(){return window.innerWidth<=768}var app=null,model=null,fabric=null;const Model=({userInput:it,setModelResponse:_,setIsModelWhispering:lt,startThinking:ft})=>{const{val:mt,send:pt,isReady:gt,ws:bt}=reactExports.useContext(WebSocketContext),{onSpeechEndFunctions:wt}=reactExports.useContext(MicContext),vt=4096,Ct=reactExports.useRef(null),Rt=reactExports.useRef(null);reactExports.useEffect(()=>{Ct.current&&Rt.current&&(app=new Application({view:Ct.current,autoStart:!0,resizeTo:Rt.current,backgroundAlpha:0}),app.stage.sortableChildren=!0,async function(){model=await Live2DModel.from(model_info.url),app.stage.addChild(model),model.anchor.set(.5),model.scale.set(.7),model.y=app.screen.height/1.5,model.x=app.screen.width/1.8,model.zIndex=1}(),Assets.load("/white.png").then(Ht=>{fabric=Sprite.from(Ht),fabric.anchor.set(.5),fabric.scale.set(.7),console.log(`app.screen.height: ${app.screen.height}, app.screen.width: ${app.screen.width}`),fabric.x=app.screen.width/2,fabric.y=app.screen.height/2,fabric.zIndex=-1,app.stage.addChild(fabric)}))},[Ct,Rt]);const Mt=()=>{console.log("..sda.asd"),setTimeout(()=>{app&&fabric?(Rt.current&&(console.log(`canvasWrapper.current.clientWidth: ${Rt.current.clientWidth}, canvasWrapper.current.clientHeight: ${Rt.current.clientHeight}`),app.renderer.resize(Rt.current.clientWidth,Rt.current.clientHeight)),fabric.x=app.screen.width/2,fabric.y=app.screen.height/2,model.y=app.screen.height/1.6,model.x=app.screen.width/1.95,isMobile()?fabric.scale.set(.6):fabric.scale.set(.7)):console.log("app not ready")},60)};reactExports.useEffect(()=>(window.addEventListener("resize",Mt),()=>{}),[]),reactExports.useEffect(()=>{gt&&it&&pt(JSON.stringify({type:"user_input",text:it}))},[it]),reactExports.useEffect(()=>{if(console.log("val=> ",mt),model&&mt){const Nt=JSON.parse(mt);if(Nt.type==="audio-response"){console.log(Nt);const Ht=Nt.file_path;fetch(`/audio?audio_path=${Ht}`).then(Kt=>Kt.json()).then(Kt=>{const hr=Kt.audio;console.log(hr),model.speak(hr,{onFinish:()=>{lt(!1)}}),_(Nt.text)})}}},[mt]),reactExports.useEffect(()=>{gt&&(wt.current=[],wt.current.push(Nt=>{ft();for(let Ht=0;Ht<Nt.length;Ht+=vt){const Kt=Math.min(Ht+vt,Nt.length),hr=Nt.slice(Ht,Kt);pt(JSON.stringify({type:"mic-audio-data",audio:hr}))}Ot(()=>pt(JSON.stringify({type:"mic-audio-end"})))}))},[gt]);const Ot=Nt=>{console.log("...waiting for buffer to empty..."),bt&&(console.log("sd",bt.bufferedAmount),bt.bufferedAmount===0?Nt():setTimeout(()=>Ot(Nt),50))};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,marginTop:-50},animate:{opacity:1,marginTop:0},transition:{duration:.3},ref:Rt,className:"w-full h-full",children:jsxRuntimeExports.jsx("canvas",{ref:Ct})})})},MicButton=it=>jsxRuntimeExports.jsx(motion.div,{initial:{marginRight:0,borderRadius:6},animate:{marginRight:10,borderRadius:26},transition:{ease:"linear",duration:1},className:"shrink-0",children:jsxRuntimeExports.jsxs(Button,{type:"button",size:"sm",onClick:it.toggleAudio,className:it.isAudioOn?"outline-none ring-2 ring-ring ring-offset-2 animate-[glow_1.5s_ease-in-out_infinite]":"",children:[it.isAudioOn?jsxRuntimeExports.jsx(Mic,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(MicOff,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:it.isAudioOn?"Turn off microphone":"Turn on microphone"})]})});function Subdomain(){var ga;const{session:it}=reactExports.useContext(SessionContext),{isLocal:_}=reactExports.useContext(SubdomainContext),[lt,ft]=reactExports.useState(!1),mt=reactExports.useRef(null),pt=reactExports.useRef(null),gt=reactExports.useRef(null),bt=reactExports.useRef(null),[wt,vt]=reactExports.useState(0),[Ct,Rt]=reactExports.useState(""),[Mt,Ot]=reactExports.useState(""),[Nt,Ht]=reactExports.useState(""),[Kt,hr]=reactExports.useState(!1),[Qt,mr]=reactExports.useState(!1),{toggleAudio:br,isMicOn:Fr}=reactExports.useContext(MicContext);reactExports.useEffect(()=>{if(!Kt){Ht("");return}let Kn=0;if(!Ct)return Ht("");Ht(`${Ct.charAt(0)}`);const Xn=setInterval(()=>{Kn<Ct.length?(Ht(eo=>eo+Ct.charAt(Kn)),Kn++):clearInterval(Xn)},50);return()=>clearInterval(Xn)},[Ct,Kt]);const kr=()=>{hr(!1),Rt("")},Br=Kn=>{Kn.preventDefault(),Ot(Ct),Rt("")},Nr=Kn=>{Rt(Kn),hr(!0),mr(!1)},jn=()=>{mr(!0),hr(!1),Rt("Thinking...")};reactExports.useEffect(()=>{const Kn=setTimeout(()=>{ft(!0)},300);return()=>clearTimeout(Kn)},[]),reactExports.useEffect(()=>(Yn(),window.addEventListener("resize",Yn),()=>window.removeEventListener("resize",Yn)),[mt,pt,gt,bt]);const Yn=reactExports.useCallback(()=>{setTimeout(()=>{if(!mt.current||!pt.current||!gt.current||!bt.current)return;const Kn=window.innerHeight;console.log(`
            windowHeight: ${Kn}
            headerRef.current.clientHeight: ${mt.current.clientHeight}
            innerH1Ref.current.clientHeight: ${gt.current.clientHeight}
            innerDivRef.current.clientHeight: ${bt.current.clientHeight}
            topDivBottom: ${mt.current.clientHeight+gt.current.clientHeight+bt.current.clientHeight}
            footerHeight: ${pt.current.offsetHeight}
            `);const Xn=mt.current.clientHeight+gt.current.clientHeight+bt.current.clientHeight,eo=pt.current.offsetHeight,lp=Kn-Xn-eo;vt(lp)},40)},[]);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 -z-10",children:jsxRuntimeExports.jsx("img",{src:"/ws.png",alt:"Background pattern",className:"object-contain pointer-events-none translate-y-32 p-2 md:p-36 md:translate-y-0"})}),jsxRuntimeExports.jsxs("header",{ref:mt,className:"flex items-center justify-between p-4 md:p-6",children:[_?jsxRuntimeExports.jsx("a",{href:"http://localhost:8000",className:"text-xl font-bold",children:"ws"}):jsxRuntimeExports.jsx("a",{href:"https://whispershirt.com",className:"text-xl font-bold",children:"ws"}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-4",children:it&&it.user?jsxRuntimeExports.jsx(Button,{variant:"ghost",asChild:!0,children:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(PersonStanding,{}),(ga=it.user.email)==null?void 0:ga.split("@")[0]]})}):jsxRuntimeExports.jsx(Button,{asChild:!0,children:jsxRuntimeExports.jsx(Link,{to:"/login",children:"Sign In"})})})]}),jsxRuntimeExports.jsx("main",{className:"flex-1 flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"relative w-full max-w-2xl space-y-8 text-center",children:[jsxRuntimeExports.jsx("h1",{ref:gt,id:"dene",className:"text-4xl md:text-5xl font-bold tracking-tight",children:"What can I help you ship?"}),jsxRuntimeExports.jsx("div",{ref:bt,className:"!mt-0 !mb-0 py-10",children:jsxRuntimeExports.jsxs(motion.form,{onSubmit:Br,initial:{borderRadius:6},animate:{borderRadius:36},transition:{ease:"linear",duration:3.5},className:"flex gap-2 p-1.5 border rounded-lg bg-background shadow-sm",children:[jsxRuntimeExports.jsx(Input,{className:"border-0 focus-visible:ring-0 rounded-[20px]",placeholder:"Ask v0 a question...",disabled:Kt||Qt,isLarge:Kt||Qt,value:Kt?Nt:Ct,onChange:Kn=>{Rt(Kn.target.value)},onFocus:kr,onClick:kr}),!Kt&&!Qt&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{marginRight:0,borderRadius:6},animate:{marginRight:10,borderRadius:26},transition:{ease:"linear",duration:1},className:"shrink-0",children:jsxRuntimeExports.jsxs(Button,{type:"submit",size:"sm",children:[jsxRuntimeExports.jsx(ArrowRight,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Send"})]})}),jsxRuntimeExports.jsx(MicButton,{isAudioOn:Fr,toggleAudio:br})]})]})}),lt&&jsxRuntimeExports.jsx("div",{style:{height:wt,maxHeight:wt},className:"w-full !mt-0 !mb-0",children:jsxRuntimeExports.jsx(Model,{userInput:Mt,setModelResponse:Nr,setIsModelWhispering:hr,startThinking:jn})})]})}),jsxRuntimeExports.jsx("footer",{ref:pt,className:"border-t",children:jsxRuntimeExports.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-4 flex flex-wrap justify-center gap-x-2 text-xs",children:[jsxRuntimeExports.jsx(Link,{to:"/pricing",className:"text-muted-foreground hover:text-foreground",children:"Pricing"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/enterprise",className:"text-muted-foreground hover:text-foreground",children:"Enterprise"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/faq",className:"text-muted-foreground hover:text-foreground",children:"FAQ"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/legal",className:"text-muted-foreground hover:text-foreground",children:"Legal"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/privacy",className:"text-muted-foreground hover:text-foreground",children:"Privacy"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/legacy",className:"text-muted-foreground hover:text-foreground",children:"Legacy v0"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/vercel",className:"text-muted-foreground hover:text-foreground",children:"Vercel "})]})})]})}function Home(){var bt,wt,vt;const{session:it}=reactExports.useContext(SessionContext),{subdomain:_,isLocal:lt}=reactExports.useContext(SubdomainContext),ft=useNavigate(),[mt,pt]=reactExports.useState(""),gt=Ct=>{Ct.preventDefault(),lt?window.location.href=`http://${mt}.localhost:8000`:window.location.href=`https://${mt}.whispershirt.com`};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:_!==""&&_!==null?jsxRuntimeExports.jsx(Subdomain,{}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 -z-10",children:jsxRuntimeExports.jsx("img",{src:"/ws.png",alt:"Background pattern",className:"object-contain pointer-events-none translate-y-32 p-2 md:p-36 md:translate-y-0"})}),jsxRuntimeExports.jsxs("header",{className:"flex items-center justify-between p-4 md:p-6",children:[lt?jsxRuntimeExports.jsx("a",{href:"http://localhost:8000",className:"text-xl font-bold",children:"ws"}):jsxRuntimeExports.jsx("a",{href:"https://whispershirt.com",className:"text-xl font-bold",children:"ws"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[it&&it.user?jsxRuntimeExports.jsx(Button,{variant:"ghost",asChild:!0,children:jsxRuntimeExports.jsxs("a",{href:lt?`http://${(bt=it.user.email)==null?void 0:bt.split("@")[0]}.localhost:8000`:`https://${(wt=it.user.email)==null?void 0:wt.split("@")[0]}.whispershirt.com`,children:[jsxRuntimeExports.jsx(PersonStanding,{}),(vt=it.user.email)==null?void 0:vt.split("@")[0]]})}):jsxRuntimeExports.jsx(Button,{variant:"ghost",asChild:!0,children:jsxRuntimeExports.jsx(Link,{to:"/login",children:"Sign In"})}),jsxRuntimeExports.jsx(Button,{asChild:!0,children:jsxRuntimeExports.jsx(Link,{to:"/shop",children:"Buy a Shirt"})})]})]}),jsxRuntimeExports.jsx("main",{className:"flex-1 flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-2xl space-y-8 text-center",children:[jsxRuntimeExports.jsx("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight",children:"Who's Shirt you want to talk?"}),jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsxs("form",{onSubmit:gt,className:"flex gap-2 p-1.5 border rounded-lg bg-background shadow-sm",children:[jsxRuntimeExports.jsx(Input,{className:"border-0 focus-visible:ring-0",placeholder:"Enter username...",value:mt,onChange:Ct=>pt(Ct.target.value)}),jsxRuntimeExports.jsxs(Button,{type:"submit",size:"sm",className:"shrink-0",children:[jsxRuntimeExports.jsx(ArrowRight,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Search"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"sm",onClick:()=>ft("/about"),children:"What is Whisper Shirts? "}),jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"sm",onClick:()=>ft("/how"),children:"How does a Shirt Talk (Whisper)? "}),jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"sm",children:"How can i order a Whisper Shirt "})]})]})}),jsxRuntimeExports.jsx("footer",{className:"border-t",children:jsxRuntimeExports.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-4 flex flex-wrap justify-center gap-x-2 text-xs",children:[jsxRuntimeExports.jsx(Link,{to:"/pricing",className:"text-muted-foreground hover:text-foreground",children:"Pricing"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/enterprise",className:"text-muted-foreground hover:text-foreground",children:"Enterprise"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/faq",className:"text-muted-foreground hover:text-foreground",children:"FAQ"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/legal",className:"text-muted-foreground hover:text-foreground",children:"Legal"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/privacy",className:"text-muted-foreground hover:text-foreground",children:"Privacy"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/",className:"text-muted-foreground hover:text-foreground",children:"Ws "})]})})]})})}const Card=reactExports.forwardRef(({className:it,..._},lt)=>jsxRuntimeExports.jsx("div",{ref:lt,className:cn("rounded-lg border bg-card text-card-foreground shadow-sm",it),..._}));Card.displayName="Card";const CardHeader=reactExports.forwardRef(({className:it,..._},lt)=>jsxRuntimeExports.jsx("div",{ref:lt,className:cn("flex flex-col space-y-1.5 p-6",it),..._}));CardHeader.displayName="CardHeader";const CardTitle=reactExports.forwardRef(({className:it,..._},lt)=>jsxRuntimeExports.jsx("h3",{ref:lt,className:cn("text-2xl font-semibold leading-none tracking-tight",it),..._}));CardTitle.displayName="CardTitle";const CardDescription=reactExports.forwardRef(({className:it,..._},lt)=>jsxRuntimeExports.jsx("p",{ref:lt,className:cn("text-sm text-muted-foreground",it),..._}));CardDescription.displayName="CardDescription";const CardContent=reactExports.forwardRef(({className:it,..._},lt)=>jsxRuntimeExports.jsx("div",{ref:lt,className:cn("p-6 pt-0",it),..._}));CardContent.displayName="CardContent";const CardFooter=reactExports.forwardRef(({className:it,..._},lt)=>jsxRuntimeExports.jsx("div",{ref:lt,className:cn("flex items-center p-6 pt-0",it),..._}));CardFooter.displayName="CardFooter";var NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Primitive=NODES.reduce((it,_)=>{const lt=reactExports.forwardRef((ft,mt)=>{const{asChild:pt,...gt}=ft,bt=pt?Slot:_;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(bt,{...gt,ref:mt})});return lt.displayName=`Primitive.${_}`,{...it,[_]:lt}},{}),NAME="Label",Label$1=reactExports.forwardRef((it,_)=>jsxRuntimeExports.jsx(Primitive.label,{...it,ref:_,onMouseDown:lt=>{var mt;lt.target.closest("button, input, select, textarea")||((mt=it.onMouseDown)==null||mt.call(it,lt),!lt.defaultPrevented&&lt.detail>1&&lt.preventDefault())}}));Label$1.displayName=NAME;var Root=Label$1;const labelVariants=cva("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Label=reactExports.forwardRef(({className:it,..._},lt)=>jsxRuntimeExports.jsx(Root,{ref:lt,className:cn(labelVariants(),it),..._}));Label.displayName=Root.displayName;function Login(){const{session:it}=reactExports.useContext(SessionContext),{isLocal:_,subdomain:lt}=reactExports.useContext(SubdomainContext),[ft,mt]=reactExports.useState(""),[pt,gt]=reactExports.useState(""),[bt,wt]=reactExports.useState(""),vt=useNavigate();async function Ct(Ot,Nt){try{await supabase.auth.signInWithPassword({email:Ot,password:Nt})}catch(Ht){console.log("hata var=>"),console.log(Ht)}}reactExports.useEffect(()=>{var Ot;if(it){const Nt=it.user,Ht=(Ot=Nt==null?void 0:Nt.email)==null?void 0:Ot.split("@")[0];Ht===lt?vt("/"):_?window.location.href=`http://${Ht}.localhost:8000`:window.location.href=`https://${Ht}.whispershirt.com`}},[it]);const Rt=Ot=>{Ot.preventDefault(),pt.length!==6?wt("Kod 6 haneli olmaldr."):(wt(""),fetch("/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:pt,subdomain:ft})}).then(Nt=>{if(Nt.ok)return Nt.json();throw wt("There was an error. Please try again later."),new Error("There was an error.")}).then(Nt=>{console.log("data=>"),console.log(Nt),console.log("-----------"),Nt.type==="error"?(console.log(Nt.message),wt(Nt.message)):Nt.type==="exist"?Ct(Nt.email,Nt.password):(console.log("Kullanici olusturuldu."),Nt.email&&Nt.password&&Ct(Nt.email,Nt.password))}).catch(Nt=>{console.error(Nt),wt("Bir hata olutu. Ltfen daha sonra tekrar deneyin.")}))},Mt=()=>{console.log("Ana sayfaya dn"),vt("/")};return jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-4",children:jsxRuntimeExports.jsxs(Card,{className:"w-full max-w-md relative",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",className:"absolute left-4 top-4 p-0 w-8 h-8",onClick:Mt,"aria-label":"Ana sayfaya dn",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"h-4 w-4"})}),jsxRuntimeExports.jsxs(CardHeader,{className:"space-y-1 pt-14",children:[jsxRuntimeExports.jsx(CardTitle,{className:"text-2xl font-bold text-center",children:"Login"}),jsxRuntimeExports.jsx(CardDescription,{className:"text-center",children:"You can login with the code sent to you."})]}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsx("form",{onSubmit:Rt,children:jsxRuntimeExports.jsxs("div",{className:"grid gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid gap-2",children:[jsxRuntimeExports.jsx(Label,{htmlFor:"domain",children:"Your Name"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{className:"pl-10",id:"domain",type:"text",value:ft,onChange:Ot=>mt(Ot.target.value)}),jsxRuntimeExports.jsx(Key,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20})]}),ft&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Your domain will be:"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-500",children:[ft,".whispershirt.com"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-2",children:[jsxRuntimeExports.jsx(Label,{htmlFor:"code",children:"Code"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{id:"code",placeholder:"6 digit code",type:"text",value:pt,onChange:Ot=>gt(Ot.target.value),maxLength:6,className:"pl-10"}),jsxRuntimeExports.jsx(Lock,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20})]})]}),bt&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-500",children:bt})]})})}),jsxRuntimeExports.jsx(CardFooter,{children:jsxRuntimeExports.jsx("div",{className:"flex flex-col gap-3 w-full",children:jsxRuntimeExports.jsx(Button,{className:"w-full",onClick:Rt,children:"Login"})})})]})})}function About(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-amber-50 text-gray-800 p-4 md:p-8 font-serif",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center justify-start p-4 md:p-6",children:jsxRuntimeExports.jsx(Link,{to:"/",className:"text-xl font-bold",children:"ws"})}),jsxRuntimeExports.jsxs("div",{className:"max-w-4xl mx-auto",children:[jsxRuntimeExports.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-center mb-8 text-brown-600",children:"What are Whisper Shirts?"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-center",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-4 order-2 md:order-1",children:[jsxRuntimeExports.jsx("p",{className:"text-lg leading-relaxed",children:"In a world where technology whispers secrets of the future, Whisper Shirts stand as silent heralds of the AI revolution. These aren't just garments; they're wearable whispers of wisdom, each thread interwoven with the essence of artificial intelligence."}),jsxRuntimeExports.jsx("p",{className:"text-lg leading-relaxed",children:"Imagine donning a shirt that knows your thoughts before you do, or wearing a design crafted by an algorithm that understands beauty better than any human eye. That's the magic of Whisper Shirts  where silicon dreams meet cotton reality."})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4 order-1 md:order-2",children:[jsxRuntimeExports.jsx("img",{src:"/about1.jpg",width:200,height:200,alt:"AI-designed shirt 1",className:"w-full h-auto rounded-lg shadow-md"}),jsxRuntimeExports.jsx("img",{src:"/about2.jpg",width:200,height:200,alt:"AI-designed shirt 2",className:"w-full h-auto rounded-lg shadow-md"}),jsxRuntimeExports.jsx("img",{src:"/about3.jpg",width:200,height:200,alt:"AI-designed shirt 3",className:"w-full h-auto rounded-lg shadow-md"}),jsxRuntimeExports.jsx("img",{src:"/about4.jpg",width:200,height:200,alt:"AI-designed shirt 4",className:"w-full h-auto rounded-lg shadow-md"})]})]}),jsxRuntimeExports.jsx("div",{className:"mt-12 text-center",children:jsxRuntimeExports.jsx("p",{className:"text-xl italic",children:'"In the soft rustle of fabric, hear the future speak."'})}),jsxRuntimeExports.jsxs("div",{className:"mt-8 border-t border-brown-300 pt-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"The Story Continues..."}),jsxRuntimeExports.jsx("p",{className:"text-lg leading-relaxed",children:"As you turn the page of fashion, Whisper Shirts invite you to a new chapter where your wardrobe becomes a library of innovation. Each shirt is a page, each design a paragraph in the ever-unfolding story of human-AI collaboration."})]})]})]})}function How(){const{isLocal:it}=reactExports.useContext(SubdomainContext),[_,lt]=reactExports.useState(!1),ft=reactExports.useRef(null),mt=reactExports.useRef(null),pt=reactExports.useRef(null),gt=reactExports.useRef(null),[bt,wt]=reactExports.useState(0),[vt,Ct]=reactExports.useState(""),Rt=Array.from({length:9},(br,Fr)=>`/how${Fr+1}.mp3`),Mt=["Hi, I'm talking shirt.","Yes, I can talk.","And you can train me.","When you get me, your friends and family can talk to me.","For example, you can tell me that if you talk to my brother, say hi to him.","And if I talk to your brother, I'll say hi.","Or if you talk to my friend with the red hair, you can tell him to flip me off.","I'll subtly ask the people I talk to about their hair color and their closeness to you.","And if the person has red hair, I might snap at them.","So you will be able to ask people if they want to talk to me in my t-shirt."],[Ot,Nt]=reactExports.useState(""),[Ht,Kt]=reactExports.useState(null),[hr,Qt]=reactExports.useState(!1);reactExports.useEffect(()=>{const br=setInterval(()=>{model&&(clearInterval(br),Kt(1))},100);return()=>clearInterval(br)},[]),reactExports.useEffect(()=>{console.log(`animationState-->: ${Ht}`),Ht&&hr&&fetch(Rt[Ht-1]).then(br=>br.blob()).then(br=>{const Fr=new FileReader;Fr.readAsDataURL(br),Fr.onloadend=function(){const kr=Fr.result;Ct(Mt[Ht-1]),model.speak(kr,{onFinish:()=>{console.log("bittiiiii"),setTimeout(()=>{Kt(Br=>Br===9?null:Br?Br+1:0)},200)}})}})},[Ht,hr]),reactExports.useEffect(()=>{let br=0;if(!vt)return;Nt(""),Nt(`${vt.charAt(0)}`);const Fr=setInterval(()=>{br<vt.length?(Nt(kr=>kr+vt.charAt(br)),br++):clearInterval(Fr)},50);return()=>clearInterval(Fr)},[vt]),reactExports.useEffect(()=>{const br=setTimeout(()=>{lt(!0)},300);return()=>clearTimeout(br)},[]),reactExports.useEffect(()=>(mr(),window.addEventListener("resize",mr),()=>window.removeEventListener("resize",mr)),[ft,mt,pt,gt]);const mr=reactExports.useCallback(()=>{setTimeout(()=>{if(!ft.current||!mt.current||!pt.current||!gt.current)return;const br=window.innerHeight;console.log(`
            windowHeight: ${br}
            headerRef.current.clientHeight: ${ft.current.clientHeight}
            innerH1Ref.current.clientHeight: ${pt.current.clientHeight}
            innerDivRef.current.clientHeight: ${gt.current.clientHeight}
            topDivBottom: ${ft.current.clientHeight+pt.current.clientHeight+gt.current.clientHeight}
            footerHeight: ${mt.current.offsetHeight}
            `);const Fr=ft.current.clientHeight+pt.current.clientHeight+gt.current.clientHeight,kr=mt.current.offsetHeight,Br=br-Fr-kr;wt(Br)},40)},[]);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 -z-10",children:jsxRuntimeExports.jsx("img",{src:"/ws.png",alt:"Background pattern",className:"object-contain pointer-events-none translate-y-32 p-2 md:p-36 md:translate-y-0"})}),jsxRuntimeExports.jsxs("header",{ref:ft,className:"flex items-center justify-between p-4 md:p-6",children:[it?jsxRuntimeExports.jsx("a",{href:"http://localhost:8000",className:"text-xl font-bold",children:"ws"}):jsxRuntimeExports.jsx("a",{href:"https://whispershirt.com",className:"text-xl font-bold",children:"ws"}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-4",children:jsxRuntimeExports.jsx(Button,{asChild:!0,children:jsxRuntimeExports.jsx(Link,{to:"/buy",children:"Buy a shirt"})})})]}),jsxRuntimeExports.jsx("main",{className:"flex-1 flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"relative w-full max-w-2xl space-y-8 text-center",children:[jsxRuntimeExports.jsx("h1",{ref:pt,id:"dene",className:"text-4xl md:text-5xl font-bold tracking-tight",children:"How does a Shirt Talk?"}),jsxRuntimeExports.jsx("div",{ref:gt,className:"!mt-0 !mb-0 py-10",children:hr?jsxRuntimeExports.jsx(motion.form,{onSubmit:br=>{br.preventDefault()},initial:{borderRadius:6},animate:{borderRadius:36},transition:{ease:"linear",duration:3.5},className:"flex gap-2 p-1.5 border rounded-lg bg-background shadow-sm",children:jsxRuntimeExports.jsx(Input,{className:"border-0 focus-visible:ring-0 rounded-[20px]",placeholder:"Ask v0 a question...",disabled:!0,isLarge:!0,value:Ot})}):jsxRuntimeExports.jsx(Button,{onClick:()=>Qt(!0),children:"Start explanation"})}),_&&jsxRuntimeExports.jsx("div",{style:{height:bt,maxHeight:bt},className:"w-full !mt-0 !mb-0",children:jsxRuntimeExports.jsx(Model,{userInput:"",setModelResponse:br=>{console.log(br)},setIsModelWhispering:()=>{},startThinking:()=>{}})})]})}),jsxRuntimeExports.jsx("footer",{ref:mt,className:"border-t",children:jsxRuntimeExports.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-4 flex flex-wrap justify-center gap-x-2 text-xs",children:[jsxRuntimeExports.jsx(Link,{to:"/pricing",className:"text-muted-foreground hover:text-foreground",children:"Pricing"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/enterprise",className:"text-muted-foreground hover:text-foreground",children:"Enterprise"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/faq",className:"text-muted-foreground hover:text-foreground",children:"FAQ"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/legal",className:"text-muted-foreground hover:text-foreground",children:"Legal"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/privacy",className:"text-muted-foreground hover:text-foreground",children:"Privacy"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/legacy",className:"text-muted-foreground hover:text-foreground",children:"Legacy v0"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"|"}),jsxRuntimeExports.jsx(Link,{to:"/vercel",className:"text-muted-foreground hover:text-foreground",children:"Vercel "})]})})]})}function App(){const it=createBrowserRouter([{path:"/",element:jsxRuntimeExports.jsx(Home,{})},{path:"/login",element:jsxRuntimeExports.jsx(Login,{})},{path:"/about",element:jsxRuntimeExports.jsx(About,{})},{path:"/how",element:jsxRuntimeExports.jsx(How,{})}]);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(SessionProvider,{children:jsxRuntimeExports.jsx(SubdomainProvider,{children:jsxRuntimeExports.jsx(WebSocketProvider,{children:jsxRuntimeExports.jsx(MicProvider,{children:jsxRuntimeExports.jsx(RouterProvider,{router:it})})})})})})}createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(App,{})}));export{getDefaultExportFromCjs as g};
